import{r as b,a as ve,R as oe}from"./dndkit-57209f9c.js";import{F as De,f as Ae,a as We,b as ze,c as ae}from"./fa-b4bcccb0.js";import{D as ee,A as be,S as ie,X as Te,C as Re,M as Le,P as re,a as Be,T as Ne,b as Pe,c as He,d as le,F as Fe,e as de,f as ce}from"./lucide-cb4aabd8.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))c(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const x of a.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&c(x)}).observe(document,{childList:!0,subtree:!0});function d(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function c(s){if(s.ep)return;s.ep=!0;const a=d(s);fetch(s.href,a)}})();var we={exports:{}},J={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Oe=b,$e=Symbol.for("react.element"),Ve=Symbol.for("react.fragment"),_e=Object.prototype.hasOwnProperty,qe=Oe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Xe={key:!0,ref:!0,__self:!0,__source:!0};function Ce(e,t,d){var c,s={},a=null,x=null;d!==void 0&&(a=""+d),t.key!==void 0&&(a=""+t.key),t.ref!==void 0&&(x=t.ref);for(c in t)_e.call(t,c)&&!Xe.hasOwnProperty(c)&&(s[c]=t[c]);if(e&&e.defaultProps)for(c in t=e.defaultProps,t)s[c]===void 0&&(s[c]=t[c]);return{$$typeof:$e,type:e,key:a,ref:x,props:s,_owner:qe.current}}J.Fragment=Ve;J.jsx=Ce;J.jsxs=Ce;we.exports=J;var r=we.exports,te={},pe=ve;te.createRoot=pe.createRoot,te.hydrateRoot=pe.hydrateRoot;const ue={fear:{icon:Ae,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"0.125rem",maxWidth:"none"},pipStyle:{fontSize:"var(--text-lg)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0,imageRendering:"crisp-edges"},filledColor:"var(--purple)",emptyColor:"var(--gray-dark)",tooltipTitle:"Click anywhere in header to adjust fear:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease fear by 1"},{text:"Right of boundary:",description:"Click to increase fear by 1"}]},hp:{icon:We,maxValue:20,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stress:{icon:ze,maxValue:12,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},countdown:{icon:ae,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust countdown:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease countdown by 1"},{text:"Right of boundary:",description:"Click to increase countdown by 1"}]},hpDots:{maxValue:20,containerStyle:{display:"flex",flexWrap:"wrap",gap:"2px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--red)",borderColor:"var(--red)",boxShadow:"0 0 4px rgba(239, 68, 68, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stressDots:{maxValue:12,containerStyle:{display:"flex",flexWrap:"wrap",gap:"2px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--purple)",borderColor:"var(--purple)",boxShadow:"0 0 4px rgba(139, 92, 246, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},adversaryHP:{icon:ee,maxValue:20,containerStyle:{display:"flex",gap:"0.125rem",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust HP:",tooltipInstructions:[{text:"Filled pip:",description:"Click to heal (reduce damage)"},{text:"Empty pip:",description:"Click to take damage"}]},adversaryStress:{icon:be,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust stress:",tooltipInstructions:[{text:"Filled pip:",description:"Click to reduce stress"},{text:"Empty pip:",description:"Click to increase stress"}]},countdownDistributed:{icon:ae,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Countdown progress:",tooltipInstructions:[{text:"Progress:",description:"Current countdown value"}]}},K=({type:e="fear",value:t=0,maxValue:d,onChange:c,size:s="lg",showTooltip:a=!0,containerStyle:x={},pipStyle:p={},countdownType:l=null,distributedGroups:f=null,onPipClick:h=null,enableBoundaryClick:o=!1,clickContainerWidth:u="auto",centerPips:y=!0})=>{const[i,C]=b.useState(!1),w=ue[e]||ue.fear,E=d||w.maxValue,j=Math.max(0,Math.min(E,t));let M=w.filledColor;e==="countdown"&&l&&(["progress","dynamic-progress","simple-hope"].includes(l)?M="var(--gold)":["consequence","dynamic-consequence","simple-fear"].includes(l)?M="var(--purple)":["long-term","standard"].includes(l)&&(M="var(--text-secondary)"));const R=(z,T)=>{if(h)h(z,T);else if(c){const O=z+1;c(O)}},W=z=>{if(!o||!c||h)return;z.currentTarget.getBoundingClientRect();const T=z.currentTarget.querySelector(".pip-container");if(!T)return;const O=T.getBoundingClientRect(),H=z.clientX-O.left;if(H<0){j>0&&c(j-1);return}if(H>O.width){j<E&&c(j+1);return}const $=O.width,F=$*.05,q=$-2*F,n=H-F,g=j/E,v=q*g;n<v?j>0&&c(j-1):j<E&&c(j+1)},D=(()=>{if(!f||e!=="countdownDistributed")return[{start:0,end:E,groupIndex:0}];let z=0;return f.map((T,O)=>{const H={start:z,end:z+T,groupIndex:O};return z+=T,H})})(),V=()=>r.jsxs(r.Fragment,{children:[D.map(z=>r.jsx(oe.Fragment,{children:[...Array(z.end-z.start)].map((T,O)=>{const H=z.start+O,$=H<j;if(w.isDots)return r.jsx("div",{style:{...w.pipStyle,...$?w.filledStyle:w.emptyStyle,...p,cursor:c||h?"pointer":"default"},onClick:o?void 0:()=>R(H,$),title:`${H+1} of ${E}`},H);{const F=w.icon,q=F&&typeof F=="object"&&F.iconName,n=$?M:w.emptyColor;return r.jsx("span",{className:`fear-pip ${$?"filled":"empty"}`,style:{...w.pipStyle,color:n,cursor:c||h?"pointer":"default",...p},onClick:o?void 0:()=>R(H,$),title:`${H+1} of ${E}`,children:q?r.jsx(De,{icon:F,size:s}):r.jsx(F,{size:16})},H)}})},z.groupIndex)),a&&r.jsx("div",{style:{position:"relative",cursor:"help",pointerEvents:"none"},children:r.jsxs("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:i?"translateX(-50%) translateY(-5px)":"translateX(-50%)",background:"rgba(15, 23, 42, 0.95)",border:"1px solid var(--gray)",borderRadius:"var(--radius-md)",padding:"var(--space-md)",minWidth:"250px",zIndex:1e3,opacity:i?1:0,visibility:i?"visible":"hidden",transition:"all 0.2s ease",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.5)"},children:[r.jsx("div",{style:{fontWeight:600,color:"var(--gray-200)",marginBottom:"0.75rem",fontSize:"var(--text-sm)"},children:w.tooltipTitle}),w.tooltipInstructions.map((z,T)=>r.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.8rem",color:"var(--gray-300)",lineHeight:1.4},children:[r.jsx("strong",{style:{color:"var(--gray-200)"},children:z.text})," ",z.description]},T))]})})]});return r.jsx("div",{style:{width:u,height:"100%",cursor:c||h?"pointer":"default",touchAction:"manipulation",userSelect:"none",display:y?"flex":"block",alignItems:y?"center":"stretch",justifyContent:y?"center":"flex-start",...x},onClick:z=>{z.stopPropagation(),z.preventDefault(),o&&W(z)},onMouseEnter:()=>C(a),onMouseLeave:()=>C(!1),children:r.jsx("div",{className:"pip-container",style:{...w.containerStyle,width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},children:V()})})};function se(e){const t=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return e?`${e}-${t}`:t}const Ye=(e,t)=>({createAdversary:x=>{const p=se("adv"),l=e().adversaries||[],f=x.name||"Unknown",h=l.filter(y=>y.baseName===f);let o=1;if(h.length===0)o=1;else{const y=h.map(C=>C.duplicateNumber||1);let i=1;for(;y.includes(i);)i++;o=i}const u={...x,id:p,baseName:f,duplicateNumber:o,name:`${f} (${o})`,hp:0,stress:0,isVisible:!0};t(y=>({...y,adversaries:[...y.adversaries,u]}))},updateAdversary:(x,p)=>{t(l=>({...l,adversaries:l.adversaries.map(f=>{if(f.id===x){const h={...f,...p};if(p.baseName!==void 0){const o=p.baseName,u=h.duplicateNumber||1;h.name=u===1?o:`${o} (${u})`}return h}return f})}))},deleteAdversary:x=>{t(p=>({...p,adversaries:p.adversaries.filter(l=>l.id!==x)}))},reorderAdversaries:x=>{t(p=>{const[l,f]=x,h=[...p.adversaries],[o]=h.splice(l,1);return h.splice(f,0,o),{...p,adversaries:h}})}}),Ge=e=>({createCountdown:l=>{const f={id:se("countdown"),name:l.name||"Countdown",max:parseInt(l.max)||1,value:0,visible:!0,type:l.type||"standard",loop:l.loop||"none",source:l.source||"campaign"};e(h=>({...h,countdowns:[...h.countdowns,f]}))},updateCountdown:(l,f)=>{e(h=>({...h,countdowns:h.countdowns.map(o=>o.id===l?{...o,...f}:o)}))},deleteCountdown:l=>{e(f=>({...f,countdowns:f.countdowns.filter(h=>h.id!==l)}))},advanceCountdown:(l,f)=>{e(h=>({...h,countdowns:h.countdowns.map(o=>{if(o.id!==l)return o;let u=f;if(o.loop==="loop")u>o.max?u=(u-1)%o.max+1:u<0&&(u=o.max);else if(o.loop==="increasing"){if(u>o.max)return{...o,max:o.max+1,value:1};if(u<0)return{...o,max:Math.max(1,o.max-1),value:1};u=Math.max(0,u)}else if(o.loop==="decreasing"){if(u>o.max)return{...o,max:Math.max(1,o.max-1),value:1};if(u<0)return{...o,max:o.max+1,value:1};u=Math.min(o.max,u)}else u=Math.max(0,Math.min(u,o.max));return{...o,value:u}})}))},incrementCountdown:(l,f=1)=>{e(h=>({...h,countdowns:h.countdowns.map(o=>{if(o.id!==l)return o;let u=o.value+f;if(o.loop==="loop")u>o.max&&(u=(u-1)%o.max+1);else if(o.loop==="increasing"){if(u>o.max)return{...o,max:o.max+1,value:1}}else if(o.loop==="decreasing"){if(u>o.max)return{...o,max:Math.max(1,o.max-1),value:1}}else u=Math.min(u,o.max);return{...o,value:u}})}))},decrementCountdown:l=>{e(f=>({...f,countdowns:f.countdowns.map(h=>{if(h.id!==l)return h;let o=h.value-1;if(h.loop==="loop")o<0&&(o=h.max);else if(h.loop==="increasing"){if(o<0)return{...h,max:Math.max(1,h.max-1),value:h.max};o=Math.max(0,o)}else if(h.loop==="decreasing"){if(o<0)return{...h,max:h.max+1,value:1}}else o=Math.max(0,o);return{...h,value:o}})}))},reorderCountdowns:l=>{e(f=>{const[h,o]=l,u=[...f.countdowns],[y]=u.splice(h,1);return u.splice(o,0,y),{...f,countdowns:u}})}}),Ke=(e,t)=>({createEnvironment:x=>{const p=se("env"),f=(e().environments||[]).filter(u=>u.name.replace(/\s+\(\d+\)$/,"")===x.name);let h=x.name||"Unknown";if(f.length===0)h=x.name;else if(f.length===1){const u=f[0],y=u.name.replace(/\s+\(\d+\)$/,""),i=e().environments.map(C=>C.id===u.id?{...C,name:`${y} (1)`}:C);t(C=>({...C,environments:i})),h=`${x.name} (2)`}else{const u=f.map(i=>{const C=i.name.match(/\((\d+)\)$/);return C?parseInt(C[1]):null}).filter(i=>i!==null);let y=1;for(;u.includes(y);)y++;h=`${x.name} (${y})`}const o={...x,id:p,name:h,isVisible:!0};t(u=>({...u,environments:[...u.environments,o]}))},updateEnvironment:(x,p)=>{t(l=>({...l,environments:l.environments.map(f=>f.id===x?{...f,...p}:f)}))},deleteEnvironment:x=>{t(p=>({...p,environments:p.environments.filter(l=>l.id!==x)}))},reorderEnvironments:x=>{t(p=>{const[l,f]=x,h=[...p.environments],[o]=h.splice(l,1);return h.splice(f,0,o),{...p,environments:h}})}});function Ue(e,t){const d=(e==null?void 0:e.type)||"standard";if(d==="standard")return 1;if(d==="progress"||d==="dynamic-progress")switch(t){case"success-hope":return 2;case"success-fear":return 1;case"critical-success":return 3;default:return 0}if(d==="consequence"||d==="dynamic-consequence")switch(t){case"success-fear":return 1;case"failure-hope":return 2;case"failure-fear":return 3;default:return 0}return d==="simple-fear"?t==="simple-fear"||t==="success-fear"||t==="failure-fear"?1:0:d==="simple-hope"&&(t==="simple-hope"||t==="success-hope"||t==="failure-hope"||t==="critical-success")?1:0}function Je(e){return((e==null?void 0:e.type)||"standard")==="standard"?1:0}function Qe({adversaries:e,updateAdversary:t,deleteAdversary:d,selectedItem:c,setSelectedItem:s}){const a=b.useCallback((l,f,h,o)=>{var E,j;const u=e.find(M=>M.id===l);if(!u)return;const y=u.type==="Minion",i=(E=u.features)==null?void 0:E.find(M=>{var R;return(R=M.name)==null?void 0:R.startsWith("Minion (")}),C=i?parseInt(((j=i.name.match(/\((\d+)\)/))==null?void 0:j[1])||"1"):1;if(y){d(l);const M=Math.floor(f/C);if(M>0){const R=e.filter(W=>W.type==="Minion"&&W.id!==l&&W.name===u.name);for(let W=0;W<Math.min(M,R.length);W++)d(R[W].id)}return}const w=Math.min(h+f,o);c&&c.id===l&&s(M=>({...M,hp:w})),t(l,{hp:w})},[e,t,d,c,s]),x=b.useCallback((l,f,h)=>{const o=Math.max(0,h-f);c&&c.id===l&&s(u=>({...u,hp:o})),t(l,{hp:o})},[t,c,s]),p=b.useCallback((l,f,h,o)=>{const u=e.find(C=>C.id===l);if(!u)return;let y=h+f,i=u.hp||0;if(y>o){const C=y-o;y=o,i=Math.min(u.hpMax||0,i+C)}y=Math.max(0,y),c&&c.id===l&&s(C=>({...C,stress:y,hp:i})),t(l,{stress:y,hp:i})},[e,t,c,s]);return{handleAdversaryDamage:a,handleAdversaryHealing:x,handleAdversaryStressChange:p}}const B={transitions:{hoverIn:"all 0.1s ease",hoverOut:"all 0.3s ease",colorIn:"color 0.1s ease",colorOut:"color 0.3s ease",backgroundIn:"background-color 0.1s ease",backgroundOut:"background-color 0.3s ease"},card:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"12px",marginTop:"0.5rem",cursor:"pointer",transition:"all 0.1s ease",position:"relative"},cardHover:{backgroundColor:"var(--bg-card-hover)"},cardDead:{opacity:.6,backgroundColor:"var(--gray-800)",borderColor:"var(--border)"},cardAtMax:{backgroundColor:"var(--success)",borderColor:"var(--success)"},rowMain:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},rowTitle:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",margin:0},rowMeta:{display:"flex",gap:"8px",alignItems:"center"},cardActions:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px"},controlButtons:{display:"flex",gap:"8px",alignItems:"center"},pipSymbols:{display:"flex",gap:"4px",alignItems:"center",cursor:"pointer",padding:"2px"},pipSymbol:{fontSize:"16px",transition:"color 0.1s ease"},pipGroup:{display:"flex",gap:"4px",marginBottom:"4px"},badge:{padding:"2px 6px",borderRadius:"3px",fontSize:"10px",fontWeight:"600",textTransform:"uppercase"},typeBadge:{backgroundColor:"var(--purple)",color:"var(--text-primary)"},difficultyBadge:{backgroundColor:"var(--gray-500)",color:"var(--text-primary)",cursor:"pointer",transition:"background-color 0.1s ease"},tierBadge:{backgroundColor:"var(--info)",color:"var(--text-primary)"},inputBase:{padding:"8px",borderColor:"var(--gray-500)",backgroundColor:"var(--gray-900)",color:"var(--text-primary)",fontSize:"14px",transition:"all 0.2s ease"},inputBaseFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 2px rgba(79, 70, 229, 0.1)"},inputBaseDisabled:{opacity:.6,cursor:"not-allowed"},button:{backgroundColor:"var(--danger)",color:"var(--text-primary)",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease"},incrementButton:{backgroundColor:"var(--success)",color:"var(--text-primary)",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease"},decrementButton:{backgroundColor:"var(--warning)",color:"var(--text-primary)",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease"},damageInputPopup:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,borderRadius:"8px"},damageInputContent:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"8px",padding:"16px",display:"flex",flexDirection:"column",gap:"12px",minWidth:"200px"},damageInput:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"4px",padding:"8px",color:"var(--text-primary)",fontSize:"14px"},damageIndicators:{display:"flex",gap:"8px",alignItems:"center",justifyContent:"center"},damageDrop:{fontSize:"16px",color:"var(--text-secondary)",cursor:"pointer",transition:"color 0.1s ease"},applyButton:{backgroundColor:"var(--success)",color:"var(--text-primary)",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease"}},Ze=(e,t,d,c)=>{const[s,a]=b.useState(!1),[x,p]=b.useState(""),l=y=>{y.stopPropagation(),y.preventDefault();const i=e.hp||0,C=e.hpMax||1,w=y.currentTarget.getBoundingClientRect(),E=y.clientX-w.left,j=w.width/C;Math.floor(E/j)<i?d&&d(e.id,1,e.hp):t&&t(e.id,1,e.hp,e.hpMax)},f=y=>{y.stopPropagation(),y.preventDefault();const i=e.stress||0,C=e.stressMax||1,w=y.currentTarget.getBoundingClientRect(),E=y.clientX-w.left,j=w.width/C;Math.floor(E/j)<i?c&&c(e.id,-1,e.stress,e.stressMax):c&&c(e.id,1,e.stress,e.stressMax)},h=y=>{y.stopPropagation(),(e.thresholds&&e.thresholds.major&&e.thresholds.severe||e.type==="Minion")&&(a(!0),p(e.type==="Minion"?"1":""))},o=()=>{const y=parseInt(x);if(y>0){if(e.type==="Minion")t&&t(e.id,y,e.hp,e.hpMax);else{let i=0;y>=e.thresholds.severe?i=3:y>=e.thresholds.major?i=2:y>=1&&(i=1),t&&t(e.id,i,e.hp,e.hpMax)}a(!1),p("")}};return{showDamageInput:s,damageValue:x,setDamageValue:p,setShowDamageInput:a,handleHpClick:l,handleStressClick:f,handleDifficultyClick:h,applyDamage:o,handleKeyDown:y=>{y.key==="Enter"?o():y.key==="Escape"&&(a(!1),p(""))}}},er=(e,t,d)=>({renderDistributedPips:()=>{const s=e.max,a=[];for(let x=0;x<s;x+=5){const p=Math.min(5,s-x);a.push(p)}return a.map((x,p)=>r.jsx("div",{style:B.pipGroup,children:Array.from({length:x},(l,f)=>{const h=p*5+f;return r.jsx("span",{style:{...B.pipSymbol,color:h<(e.value||0)?"var(--red)":"var(--text-secondary)"},title:`${h+1} of ${e.max}`,children:h<(e.value||0)?"●":"○"},h)})},p))}}),G=({item:e,type:t,mode:d="compact",onClick:c,onDelete:s,onApplyDamage:a,onApplyHealing:x,onApplyStressChange:p,onUpdate:l,onIncrement:f,onDecrement:h,dragAttributes:o,dragListeners:u,adversaries:y=[]})=>{const i=Ze(e,a,x,p),C=er(e),w=t==="adversary"||t==="adversaries"?i.handleDifficultyClick:()=>{console.warn("adversaryLogic.handleDifficultyClick not available for type:",t)},[E,j]=b.useState(!1),M=()=>{j(!0)},R=()=>{j(!1)},W=(n=!1)=>{let g={...B.card};if(g.transition=E?B.transitions.hoverIn:B.transitions.hoverOut,n){const{marginTop:v,...m}=g;g=m}return E&&d!=="expanded"&&(g={...g,...B.cardHover}),t==="adversary"&&(e.hp||0)>=(e.hpMax||1)&&(g={...g,...B.cardDead}),t==="countdown"&&(e.value||0)>=e.max&&(g={...g,...B.cardAtMax}),g},N=()=>{let n="border rounded-lg";return E&&d!=="expanded"&&(n+=" border-hover"),n},D=()=>{var n,g;if(t==="adversary"||t==="adversaries"){const v=e.baseName||((n=e.name)==null?void 0:n.replace(/\s+\(\d+\)$/,""))||"",m=e.duplicateNumber||((g=e.name)!=null&&g.match(/\((\d+)\)$/)?parseInt(e.name.match(/\((\d+)\)$/)[1]):1),P=[...y];return y.some(I=>I.id===e.id)||P.push(e),P.filter(I=>I.baseName===v).length>1?`${v} (${m})`:v}return e.name},V=()=>{const n=[];return e.type&&n.push(r.jsx("span",{style:{...B.badge,...B.typeBadge},children:e.type},"type")),t==="environment"&&e.tier&&n.push(r.jsxs("span",{style:{...B.badge,...B.tierBadge},children:["Tier ",e.tier]},"tier")),n},z=()=>r.jsxs("div",{style:B.cardActions,children:[r.jsxs("div",{style:B.controlButtons,children:[r.jsx("div",{style:{display:"flex",alignItems:"center"},children:r.jsx("div",{style:{display:"flex",gap:"0.25rem",alignItems:"center",cursor:"pointer",padding:"0.125rem",borderRadius:"0.5rem",transition:"all 0.2s ease"},onClick:t==="adversary"||t==="adversaries"?i.handleHpClick:void 0,onMouseEnter:n=>n.target.style.background="var(--gray-800)",onMouseLeave:n=>n.target.style.background="transparent",children:Array.from({length:e.hpMax||1},(n,g)=>r.jsx("span",{style:{fontSize:"1rem",transition:"color 0.1s ease",cursor:"pointer",color:g<(e.hp||0)?"var(--red)":"var(--text-secondary)"},title:g<(e.hp||0)?"Click to heal (reduce damage)":"Click to take damage",children:r.jsx(ee,{size:16})},g))})}),e.stressMax>0&&r.jsx("div",{style:{display:"flex",alignItems:"center"},children:r.jsx("div",{style:{display:"flex",gap:"0.25rem",alignItems:"center",cursor:"pointer",padding:"0.125rem",borderRadius:"0.5rem",transition:"all 0.2s ease"},onClick:t==="adversary"||t==="adversaries"?i.handleStressClick:void 0,onMouseEnter:n=>n.target.style.background="var(--gray-800)",onMouseLeave:n=>n.target.style.background="transparent",children:Array.from({length:e.stressMax},(n,g)=>r.jsx("span",{style:{fontSize:"1rem",transition:"color 0.1s ease",cursor:"pointer",color:g<(e.stress||0)?"var(--gold)":"var(--text-secondary)"},title:g<(e.stress||0)?"Click to reduce stress":"Click to increase stress",children:r.jsx(be,{size:16})},g))})}),e.difficulty&&r.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:r.jsx("div",{onClick:t==="adversary"||t==="adversaries"?i.handleDifficultyClick:void 0,style:{cursor:e.thresholds&&e.thresholds.major&&e.thresholds.severe||e.type==="Minion"?"pointer":"default"},title:e.thresholds&&e.thresholds.major&&e.thresholds.severe?`Click to enter damage (thresholds: ${e.thresholds.major}/${e.thresholds.severe})`:e.type==="Minion"?"Click to enter damage (minion mechanics)":"",children:r.jsx("div",{className:"border rounded-md",style:{display:"flex",alignItems:"center",gap:"0.25rem",background:"var(--gray-900)",borderColor:"var(--border)",padding:"0.25rem 0.5rem",transition:"all 0.2s ease"},onMouseEnter:n=>n.target.style.background="var(--gray-800)",onMouseLeave:n=>n.target.style.background="var(--gray-900)",children:r.jsx("span",{style:{fontSize:"0.875rem",fontWeight:600,color:"var(--text-primary)"},children:e.difficulty})})})})]}),r.jsx("div",{style:{display:"flex",alignItems:"center"},children:o&&u&&r.jsx("button",{style:{background:"var(--gray-800)",border:"0.5px solid var(--gray-600)",borderRadius:"0.5rem",padding:"0.25rem",minWidth:"1.5rem",height:"1.5rem",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.1s ease",color:"var(--text-primary)",fontSize:"1rem"},onClick:n=>{n.stopPropagation(),n.preventDefault(),s&&s(e.id)},onMouseEnter:n=>n.target.style.background="var(--gray-700)",onMouseLeave:n=>n.target.style.background="var(--gray-800)",title:"Delete adversary",children:"×"})})]}),T=()=>null,O=()=>r.jsxs(r.Fragment,{children:[r.jsx("button",{style:B.decrementButton,onClick:n=>{n.stopPropagation(),n.preventDefault(),h&&h(e.id)},title:"Decrease progress",children:r.jsx(Le,{size:16})}),r.jsx("button",{style:B.incrementButton,onClick:n=>{n.stopPropagation(),n.preventDefault(),f&&f(e.id)},title:e.value>=e.max?e.loop&&e.loop!=="none"?"Loop countdown":"Countdown at max":"Increase progress",children:e.value>=e.max?e.loop&&e.loop!=="none"?"⟳":r.jsx(re,{size:16}):r.jsx(re,{size:16})})]}),H=()=>{switch(t){case"adversary":return z();case"environment":return T();case"countdown":return O();default:return null}},$=()=>t==="countdown"?r.jsx("div",{style:B.pipSymbols,children:t==="countdown"?C.renderDistributedPips():null}):null,F=()=>t!=="adversary"||!i.showDamageInput||!(e.thresholds&&e.thresholds.major&&e.thresholds.severe||e.type==="Minion")?null:r.jsx("div",{style:B.damageInputPopup,onClick:n=>{n.stopPropagation(),n.target===n.currentTarget&&(t==="adversary"||t==="adversaries")&&(i.setShowDamageInput(!1),i.setDamageValue(""))},children:r.jsxs("div",{className:"border rounded-lg",style:{...B.damageInputContent,borderColor:"var(--border)"},onClick:n=>n.stopPropagation(),children:[r.jsx("input",{type:"number",inputMode:"numeric",enterKeyHint:"done",placeholder:"Damage",min:e.type==="Minion"?"1":"0",value:t==="adversary"||t==="adversaries"?i.damageValue:"",onChange:n=>{(t==="adversary"||t==="adversaries")&&i.setDamageValue(n.target.value)},onKeyDown:t==="adversary"||t==="adversaries"?i.handleKeyDown:void 0,className:"border rounded-sm",style:{...B.damageInput,borderColor:"var(--border)"},autoFocus:!0}),r.jsxs("div",{style:B.damageIndicators,children:[e.type==="Minion"?(()=>{var P,k;const n=parseInt(t==="adversary"||t==="adversaries"?i.damageValue:"0")||0,g=(P=e.features)==null?void 0:P.find(S=>{var I;return(I=S.name)==null?void 0:I.startsWith("Minion (")}),v=g?parseInt(((k=g.name.match(/\((\d+)\)/))==null?void 0:k[1])||"1"):1,m=Math.floor(n/v);return n>=v&&m>0?r.jsxs("span",{style:{...B.damageDrop,color:"var(--success)"},title:`${n} damage can defeat ${m+1} minion${m+1!==1?"s":""} (1 + ${m} additional)`,children:["+",m," additional minion(s)"]}):r.jsx("span",{style:B.damageDrop,title:`${n} damage defeats this minion only`,children:"+0 additional minion(s)"})})():[1,2,3].map(n=>{const g=parseInt(t==="adversary"||t==="adversaries"?i.damageValue:"0")||0;let v=!1;return n===1&&g>=1&&(v=!0),n===2&&g>=e.thresholds.major&&(v=!0),n===3&&g>=e.thresholds.severe&&(v=!0),r.jsx("span",{style:{...B.damageDrop,color:v?"var(--red)":"var(--text-secondary)"},onClick:m=>{m.stopPropagation(),(t==="adversary"||t==="adversaries")&&(n===1?i.setDamageValue("1"):n===2?i.setDamageValue(e.thresholds.major.toString()):n===3&&i.setDamageValue(e.thresholds.severe.toString()))},title:`Click to set damage to ${n===1?"1":n===2?e.thresholds.major:e.thresholds.severe}`,children:r.jsx(ee,{size:16})},n)}),r.jsx("button",{style:{...B.applyButton,backgroundColor:!i.damageValue||parseInt(i.damageValue)<1?"var(--gray-600)":"var(--success)"},onClick:n=>{n.stopPropagation(),(t==="adversary"||t==="adversaries")&&i.applyDamage()},title:"Apply damage",disabled:!i.damageValue||parseInt(i.damageValue)<1,children:r.jsx(Re,{size:16})})]})]})}),q=()=>{const n=!!(o&&u),g=(e.hp||0)>=(e.hpMax||1),v=d==="edit";return r.jsxs("div",{className:N(),style:{...W(!0),padding:0,minHeight:"400px",opacity:g?.7:1,backgroundColor:g?"var(--gray-900)":W(!0).backgroundColor,borderColor:g?"color-mix(in srgb, var(--gray-600) 40%, transparent)":E&&d!=="expanded"?"var(--border-hover)":"var(--border)",display:"flex",flexDirection:"column",position:"relative"},...o,...u,onClick:c,...d!=="expanded"&&{onMouseEnter:M,onMouseLeave:R},children:[g&&r.jsxs(r.Fragment,{children:[r.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                45deg,
                transparent,
                transparent 8px,
                var(--gray-600) 1px,
                var(--gray-600) 9px
              )`,pointerEvents:"none",zIndex:9999}}),r.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"var(--text-secondary)",fontSize:"1rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em",zIndex:1e4,pointerEvents:"none",textShadow:"1px 1px 2px rgba(0, 0, 0, 0.5)",backgroundColor:"var(--gray-900)",padding:"0.25rem 0.5rem",borderRadius:"0.5rem",border:"0.5px solid var(--gray-600)"},children:"DEFEATED"})]}),r.jsx("div",{className:"border-b",style:{padding:"1rem",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative",zIndex:g?1:"auto"},children:r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"0.5rem"},children:[r.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.25rem"},children:[r.jsx("h2",{style:{fontSize:"1rem",fontWeight:600,color:g?"color-mix(in srgb, var(--gray-400) 80%, transparent)":"var(--text-primary)",margin:0},children:D()}),(e.tier||e.type)&&r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.tier&&r.jsxs("span",{style:{fontSize:"0.75rem",fontWeight:500,color:g?"color-mix(in srgb, var(--gray-400) 80%, transparent)":"var(--text-secondary)",letterSpacing:"0.5px"},children:["Tier ",e.tier]}),e.type&&r.jsx("span",{style:{fontSize:"0.75rem",fontWeight:500,color:g?"color-mix(in srgb, var(--gray-400) 80%, transparent)":"var(--text-secondary)",letterSpacing:"0.5px"},children:e.type})]})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.125rem",alignItems:"flex-end"},children:[r.jsx(K,{type:"adversaryHP",value:e.hp||0,maxValue:e.hpMax||1,onChange:m=>{const P=e.hp||0;m>P?a&&a(e.id,m-P,e.hp,e.hpMax):m<P&&x&&x(e.id,P-m,e.hp)},containerStyle:{cursor:"pointer",padding:"0.0625rem",borderRadius:"0.125rem",transition:"all 0.2s ease"},pipStyle:{fontSize:"0.75rem"},showTooltip:!1,enableBoundaryClick:!0}),e.stressMax>0&&r.jsx(K,{type:"adversaryStress",value:e.stress||0,maxValue:e.stressMax,onChange:m=>{const P=e.stress||0,k=m-P;p&&p(e.id,k,e.stress)},containerStyle:{cursor:"pointer",padding:"0.0625rem",borderRadius:"0.125rem",transition:"all 0.2s ease"},pipStyle:{fontSize:"0.75rem"},showTooltip:!1,enableBoundaryClick:!0})]}),e.difficulty&&r.jsxs("div",{onClick:w,style:{cursor:e.thresholds&&e.thresholds.major&&e.thresholds.severe||e.type==="Minion"?"pointer":"default",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},title:e.thresholds&&e.thresholds.major&&e.thresholds.severe?`Click to enter damage (thresholds: ${e.thresholds.major}/${e.thresholds.severe})`:e.type==="Minion"?"Click to enter damage (minion mechanics)":"",children:[r.jsx(ie,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)"}}),r.jsx("span",{style:{position:"absolute",fontSize:"0.75rem",fontWeight:600,color:"var(--text-primary)",pointerEvents:"none"},children:e.difficulty})]}),n&&r.jsx("button",{className:"border rounded-md",style:{background:"var(--gray-800)",borderColor:"var(--border)",padding:"0.25rem",minWidth:"1.5rem",height:"1.5rem",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.1s ease",color:"var(--text-primary)",fontSize:"1rem"},onClick:m=>{m.stopPropagation(),m.preventDefault(),s&&s(e.id)},onMouseEnter:m=>m.target.style.background="var(--gray-700)",onMouseLeave:m=>m.target.style.background="var(--gray-800)",title:"Delete item",children:"×"})]})]})}),r.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"1rem",borderRadius:"0 0 8px 8px",position:"relative",zIndex:g?1:"auto"},children:[e.description&&r.jsxs("div",{style:{marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--border)"},children:[r.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:"0 0 0.5rem 0"},children:"Description"}),v?r.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-secondary)",color:"var(--text-primary)",fontSize:"0.875rem",lineHeight:1.5,resize:"vertical",fontFamily:"inherit"},value:e.description,onChange:m=>{l&&l(e.id,{description:m.target.value})},placeholder:"Enter adversary description..."}):r.jsx("p",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",margin:0,whiteSpace:"pre-wrap"},children:e.description})]}),e.motives&&r.jsxs("div",{style:{marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--border)"},children:[r.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:"0 0 0.5rem 0"},children:"Motives"}),v?r.jsx("textarea",{style:{width:"100%",minHeight:"80px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-secondary)",color:"var(--text-primary)",fontSize:"0.875rem",lineHeight:1.5,resize:"vertical",fontFamily:"inherit"},value:e.motives,onChange:m=>{l&&l(e.id,{motives:m.target.value})},placeholder:"Enter adversary motives..."}):r.jsx("p",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",margin:0,whiteSpace:"pre-wrap"},children:e.motives})]}),r.jsx("div",{style:{marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--border)"},children:r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",fontSize:"0.875rem"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[r.jsxs("span",{children:[r.jsx("strong",{children:"Difficulty:"})," ",e.difficulty]}),e.thresholds&&r.jsxs("span",{children:[r.jsx("strong",{children:"Thresholds:"})," ",e.thresholds.major,"/",e.thresholds.severe]}),r.jsxs("span",{children:[r.jsx("strong",{children:"HP:"})," ",e.hpMax]}),e.stressMax>0&&r.jsxs("span",{children:[r.jsx("strong",{children:"Stress:"})," ",e.stressMax]})]}),(e.atk!==void 0||e.weapon||e.damage)&&r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[e.atk!==void 0&&r.jsxs("span",{children:[r.jsx("strong",{children:"ATK:"})," ",e.atk>=0?"+":"",e.atk]}),e.weapon&&r.jsxs("span",{children:[r.jsxs("strong",{children:[e.weapon,":"]})," ",e.range||"Melee"]}),e.damage&&r.jsxs("span",{children:[r.jsx("strong",{children:"Damage:"})," ",e.damage]})]}),e.experience&&e.experience.length>0&&r.jsxs("div",{children:[r.jsx("strong",{children:"Experience:"})," ",e.experience.map(m=>typeof m=="string"?m:`${m.name} ${m.modifier>=0?"+":""}${m.modifier}`).join(", ")]})]})}),e.features&&e.features.length>0&&r.jsxs("div",{style:{marginBottom:"1rem"},children:[e.features.filter(m=>m.type==="Passive").length>0&&r.jsxs("div",{style:{marginBottom:"1rem"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[r.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"var(--text-primary)",margin:0,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Passives"}),r.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:e.features.filter(m=>m.type==="Passive").map((m,P)=>r.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[r.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:m.name}),m.description&&r.jsxs(r.Fragment,{children:[r.jsx("span",{children:" - "}),r.jsx("span",{children:m.description})]})]},P))})]}),e.features.filter(m=>m.type==="Action").length>0&&r.jsxs("div",{style:{marginBottom:"1rem"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[r.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"var(--text-primary)",margin:0,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Actions"}),r.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:e.features.filter(m=>m.type==="Action").map((m,P)=>r.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[r.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:m.name}),m.description&&r.jsxs(r.Fragment,{children:[r.jsx("span",{children:" - "}),r.jsx("span",{children:m.description})]})]},P))})]}),e.features.filter(m=>m.type==="Reaction").length>0&&r.jsxs("div",{style:{marginBottom:"1rem"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[r.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"var(--text-primary)",margin:0,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Reactions"}),r.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:e.features.filter(m=>m.type==="Reaction").map((m,P)=>r.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[r.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:m.name}),m.description&&r.jsxs(r.Fragment,{children:[r.jsx("span",{children:" - "}),r.jsx("span",{children:m.description})]})]},P))})]})]})]}),F()]})};if((d==="expanded"||d==="edit")&&(t==="adversary"||t==="adversaries"))return q();if(d!=="compact")return r.jsxs("div",{className:N(),style:W(!0),children:[r.jsxs("div",{style:B.rowMain,children:[r.jsx("h4",{style:B.rowTitle,children:D()}),r.jsx("div",{style:B.rowMeta,children:V()})]}),r.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"12px",margin:0},children:["Expanded view coming soon for ",t]})]});if(t==="adversary"||t==="adversaries"){const n=!!(o&&u),g=(e.hp||0)>=(e.hpMax||1);return r.jsxs("div",{className:N(),style:{...W(),opacity:g?.7:1,backgroundColor:g?"var(--gray-900)":W().backgroundColor,borderColor:g?"color-mix(in srgb, var(--gray-600) 40%, transparent)":E&&d!=="expanded"?"var(--border-hover)":"var(--border)",paddingLeft:n?"2.25rem":"0.75rem",position:"relative"},onClick:c,...d!=="expanded"&&{onMouseEnter:M,onMouseLeave:R},...o,...u,children:[g&&r.jsxs(r.Fragment,{children:[r.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                45deg,
                transparent,
                transparent 8px,
                var(--gray-600) 1px,
                var(--gray-600) 9px
              )`,pointerEvents:"none",zIndex:9999}}),r.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"var(--text-secondary)",fontSize:"1rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em",zIndex:1e4,pointerEvents:"none",textShadow:"1px 1px 2px rgba(0, 0, 0, 0.5)",backgroundColor:"var(--gray-900)",padding:"0.25rem 0.5rem",borderRadius:"0.5rem",border:"0.5px solid var(--gray-600)"},children:"DEFEATED"})]}),n&&r.jsx("div",{style:{position:"absolute",left:"0.5rem",top:"50%",transform:"translateY(-50%)",color:"var(--text-secondary)",cursor:"grab",fontSize:"0.875rem",lineHeight:1,padding:"0.25rem",borderRadius:"0.5rem",transition:"all 0.2s ease"},...o,...u,children:"⋮⋮"}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"0.5rem",position:"relative",zIndex:g?1:"auto"},children:[r.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.25rem"},children:[r.jsx("h4",{style:{...B.rowTitle,color:g?"color-mix(in srgb, var(--gray-400) 80%, transparent)":B.rowTitle.color},children:D()}),e.type&&r.jsx("span",{style:{fontSize:"0.75rem",fontWeight:500,color:g?"color-mix(in srgb, var(--gray-400) 80%, transparent)":"var(--text-secondary)",letterSpacing:"0.5px"},children:e.type})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.125rem",alignItems:"flex-end"},children:[r.jsx(K,{type:"adversaryHP",value:e.hp||0,maxValue:e.hpMax||1,onChange:v=>{const m=e.hp||0;v>m?a&&a(e.id,v-m,e.hp,e.hpMax):v<m&&x&&x(e.id,m-v,e.hp)},containerStyle:{cursor:"pointer",padding:"0.0625rem",borderRadius:"0.125rem",transition:"all 0.2s ease"},pipStyle:{fontSize:"0.75rem"},showTooltip:!1,enableBoundaryClick:!0}),e.stressMax>0&&r.jsx(K,{type:"adversaryStress",value:e.stress||0,maxValue:e.stressMax,onChange:v=>{const m=e.stress||0,P=v-m;p&&p(e.id,P,e.stress)},containerStyle:{cursor:"pointer",padding:"0.0625rem",borderRadius:"0.125rem",transition:"all 0.2s ease"},pipStyle:{fontSize:"0.75rem"},showTooltip:!1,enableBoundaryClick:!0})]}),e.difficulty&&r.jsxs("div",{onClick:w,style:{cursor:e.thresholds&&e.thresholds.major&&e.thresholds.severe||e.type==="Minion"?"pointer":"default",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},title:e.thresholds&&e.thresholds.major&&e.thresholds.severe?`Click to enter damage (thresholds: ${e.thresholds.major}/${e.thresholds.severe})`:e.type==="Minion"?"Click to enter damage (minion mechanics)":"",children:[r.jsx(ie,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)"}}),r.jsx("span",{style:{position:"absolute",fontSize:"0.75rem",fontWeight:600,color:"var(--text-primary)",pointerEvents:"none"},children:e.difficulty})]}),o&&u&&r.jsx("button",{className:"border rounded-md",style:{background:"var(--gray-800)",borderColor:"var(--border)",padding:"0.25rem",minWidth:"1.5rem",height:"1.5rem",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.1s ease",color:"var(--text-primary)",fontSize:"1rem"},onClick:v=>{v.stopPropagation(),v.preventDefault(),s&&s(e.id)},onMouseEnter:v=>v.target.style.background="var(--gray-700)",onMouseLeave:v=>v.target.style.background="var(--gray-800)",title:"Delete item",children:"×"})]})]}),F()]})}return r.jsxs("div",{className:N(),style:W(),onClick:c,onMouseEnter:()=>j(!0),onMouseLeave:()=>j(!1),...o,...u,children:[r.jsxs("div",{style:B.rowMain,children:[r.jsx("h4",{style:B.rowTitle,children:D()}),r.jsx("div",{style:B.rowMeta,children:V()})]}),$(),r.jsxs("div",{style:B.cardActions,children:[r.jsx("div",{style:B.controlButtons,children:H()}),r.jsx("div",{style:{display:"flex",alignItems:"center"},children:o&&u&&r.jsx("button",{style:B.button,onClick:n=>{n.stopPropagation(),n.preventDefault(),s&&s(e.id)},title:`Delete ${t}`,children:r.jsx(Te,{size:16})})})]}),F()]})},je=b.createContext();function ne(e){if(typeof localStorage>"u")return null;try{const t=localStorage.getItem(e);return t==null?null:JSON.parse(t)}catch{return null}}function ke(e,t){if(!(typeof localStorage>"u"))try{localStorage.setItem(e,JSON.stringify(t))}catch{}}const Se=({children:e})=>{const[t,d]=b.useState({fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[]});b.useEffect(()=>{var O,H,$;const T=ne("daggerheart-game-state");if(T)try{(((O=T.adversaries)==null?void 0:O.length)>0||((H=T.environments)==null?void 0:H.length)>0||(($=T.countdowns)==null?void 0:$.length)>0)&&d(T)}catch(F){console.error("Failed to load saved state:",F)}},[]),b.useEffect(()=>{ke("daggerheart-game-state",t)},[t]);const c=T=>{d(O=>({...O,fear:{...O.fear,value:T}}))},s=()=>{d(T=>({...T,fear:{...T.fear,visible:!T.fear.visible}}))},a=b.useRef(t);b.useEffect(()=>{a.current=t},[t]);const x=()=>a.current,p=Ge(d),l=Ye(x,d),f=Ke(x,d),{createCountdown:h,updateCountdown:o,deleteCountdown:u,advanceCountdown:y,incrementCountdown:i,decrementCountdown:C,reorderCountdowns:w}=p,{createAdversary:E,updateAdversary:j,deleteAdversary:M,reorderAdversaries:R}=l,{createEnvironment:W,updateEnvironment:N,deleteEnvironment:D,reorderEnvironments:V}=f,z={gameState:t,updateFear:c,toggleFearVisibility:s,createCountdown:h,updateCountdown:o,deleteCountdown:u,advanceCountdown:y,incrementCountdown:i,decrementCountdown:C,reorderCountdowns:w,createAdversary:E,updateAdversary:j,deleteAdversary:M,reorderAdversaries:R,createEnvironment:W,updateEnvironment:N,deleteEnvironment:D,reorderEnvironments:V};return r.jsx(je.Provider,{value:z,children:e})},Ee=()=>{const e=b.useContext(je);if(!e)return console.warn("useGameState: Context not available yet, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],updateFear:()=>{},toggleFearVisibility:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{gameState:t,...d}=e;if(!t)return console.warn("useGameState: gameState not available, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],updateFear:()=>{},toggleFearVisibility:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{fear:c,countdowns:s,adversaries:a,environments:x}=t;return{gameState:t,fear:c,countdowns:s,adversaries:a,environments:x,...d,hasCountdowns:s.length>0,hasAdversaries:a.length>0,hasEnvironments:x.length>0,getCountdownById:p=>s.find(l=>l.id===p),getAdversaryById:p=>a.find(l=>l.id===p),getEnvironmentById:p=>x.find(l=>l.id===p)}},rr=(e,t)=>{const[d,c]=b.useState(()=>{const s=ne(e);return s??t});return b.useEffect(()=>{const s=ne(e);c(s??t)},[e]),b.useEffect(()=>{ke(e,d)},[e,d]),[d,c]},tr="/Daggerheart/assets/daggerheart-logo-fe7815ad.svg",nr=()=>{const[e,t]=b.useState(!1),[d,c]=b.useState(!1);return b.useEffect(()=>{const s=a=>{a.target.closest(".help-button")||t(!1)};return document.addEventListener("click",s),()=>document.removeEventListener("click",s)},[]),b.useEffect(()=>{const s=window.matchMedia("(max-width: 800px)"),a=x=>c(x.matches);return c(s.matches),s.addEventListener("change",a),()=>s.removeEventListener("change",a)},[]),r.jsxs("div",{className:"help-button",style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",padding:"0.5rem",color:"var(--text-primary)",borderRadius:"var(--radius-md)",cursor:"pointer",transition:"background-color 0.2s ease",minWidth:"44px",minHeight:"44px",backgroundColor:e?"var(--purple)":"transparent"},onMouseEnter:s=>{e||(s.target.style.backgroundColor="var(--gray-dark)")},onMouseLeave:s=>{e||(s.target.style.backgroundColor="transparent")},onClick:s=>{s.stopPropagation(),t(!e)},title:"Help & Info",children:[r.jsx("div",{style:{width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center",color:"inherit"},children:r.jsx(Be,{size:20})}),r.jsxs("div",{style:{position:"absolute",bottom:"100%",left:d?"auto":"50%",right:d?"0":"auto",transform:d?"none":"translateX(-50%)",background:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,opacity:e?1:0,visibility:e?"visible":"hidden",transition:"opacity 0.2s ease, visibility 0.2s ease, transform 0.2s ease",pointerEvents:e?"auto":"none",minWidth:"280px",maxWidth:d?"calc(100vw - 2rem)":"320px",marginBottom:d?"0.5rem":"0"},children:[r.jsxs("div",{style:{padding:"0.75rem",borderTop:"1px solid rgba(255, 255, 255, 0.1)",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",background:"var(--bg-primary)",maxWidth:"280px"},children:[r.jsx("img",{src:tr,alt:"Daggerheart Community Content Logo",style:{width:"100%",maxWidth:"200px",height:"auto",margin:"0 auto 0.75rem auto",display:"block"},onError:s=>{console.error("Failed to load Daggerheart logo:",s.target.src),s.target.style.display="none";const a=document.createElement("div");a.style.cssText="text-align: center; margin-bottom: 0.75rem; font-size: 1.5rem; font-weight: bold; color: var(--purple);",a.textContent="⚔️ DAGGERHEART ⚔️",s.target.parentNode.insertBefore(a,s.target)},onLoad:()=>{}}),r.jsxs("div",{style:{fontSize:"0.7rem",lineHeight:1.3,color:"var(--text-secondary)",textAlign:"left",wordWrap:"break-word",overflowWrap:"break-word"},children:[r.jsx("p",{children:"This product includes materials from the Daggerheart System Reference Document 1.0, © Critical Role, LLC, under the terms of the Darrington Press Community Gaming (DPCGL) License."}),r.jsxs("p",{children:["More information can be found at ",r.jsx("a",{href:"https://www.daggerheart.com",target:"_blank",rel:"noopener noreferrer",children:"daggerheart.com"})]}),r.jsx("p",{children:r.jsx("em",{children:"This project is unofficial and not endorsed by Darrington Press or Critical Role."})})]})]}),r.jsx("button",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"0.25rem 1rem",color:"var(--text-primary)",border:"none",background:"none",width:"100%",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"0.875rem",minHeight:"32px",borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},onMouseEnter:s=>{s.target.style.backgroundColor="var(--gray-dark)"},onMouseLeave:s=>{s.target.style.backgroundColor="transparent"},onClick:s=>{s.stopPropagation(),t(!1),window.open("https://github.com/Splinter714/Daggerheart","_blank")},children:r.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.25rem"},children:r.jsx("span",{children:"GitHub"})})}),r.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"0.25rem 1rem",color:"var(--text-secondary)",border:"none",background:"none",width:"100%",textAlign:"left",cursor:"default",fontSize:"0.875rem",minHeight:"32px"},children:r.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.25rem"},children:r.jsxs("span",{children:["Version ","0.2.3 (0b38957)"]})})})]})]})},or=({adversaries:e,environments:t,countdowns:d,deleteAdversary:c,deleteEnvironment:s,deleteCountdown:a})=>{const[x,p]=b.useState(!1);b.useEffect(()=>{const i=C=>{C.target.closest(".delete-clear-container")||p(!1)};return document.addEventListener("click",i),()=>document.removeEventListener("click",i)},[]);const l=((e==null?void 0:e.length)||0)>0||((t==null?void 0:t.length)||0)>0||((d==null?void 0:d.length)||0)>0,f=(e||[]).some(i=>(i.hp||0)>=(i.hpMax||1)),h={position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",padding:"0.5rem",minWidth:"200px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,display:x?"block":"none"},o={background:"none",border:"none",color:l?"var(--text-primary)":"var(--text-secondary)",cursor:l?"pointer":"not-allowed",padding:"0.5rem",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s",opacity:l?1:.5},u={background:"none",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:"0.5rem",borderRadius:"var(--radius-sm)",width:"100%",textAlign:"left",display:"flex",alignItems:"center",gap:"0.5rem",transition:"background-color 0.2s"},y={backgroundColor:"var(--bg-hover)"};return r.jsxs("div",{className:"delete-clear-container",style:{position:"relative"},children:[r.jsx("button",{style:o,onClick:i=>{i.stopPropagation(),l&&p(!x)},title:l?"Clear Items":"Nothing to clear",children:r.jsx(Ne,{size:20})}),r.jsxs("div",{style:h,children:[e&&e.length>0&&r.jsxs("button",{style:u,onMouseEnter:i=>Object.assign(i.target.style,y),onMouseLeave:i=>Object.assign(i.target.style,u),onClick:i=>{i.stopPropagation(),p(!1),e.forEach(C=>c(C.id))},children:[r.jsx("span",{children:"×"}),r.jsx("span",{children:"All Adversaries"})]}),e&&e.length>0&&f&&r.jsxs("button",{style:u,onMouseEnter:i=>Object.assign(i.target.style,y),onMouseLeave:i=>Object.assign(i.target.style,u),onClick:i=>{i.stopPropagation(),p(!1),e.filter(w=>(w.hp||0)>=(w.hpMax||1)).forEach(w=>c(w.id))},children:[r.jsx("span",{children:"×"}),r.jsx("span",{children:"Dead Adversaries"})]}),t&&t.length>0&&r.jsxs("button",{style:u,onMouseEnter:i=>Object.assign(i.target.style,y),onMouseLeave:i=>Object.assign(i.target.style,u),onClick:i=>{i.stopPropagation(),p(!1),t.forEach(C=>s(C.id))},children:[r.jsx("span",{children:"×"}),r.jsx("span",{children:"All Environments"})]}),d&&d.length>0&&r.jsxs("button",{style:u,onMouseEnter:i=>Object.assign(i.target.style,y),onMouseLeave:i=>Object.assign(i.target.style,u),onClick:i=>{i.stopPropagation(),p(!1),d.forEach(C=>a(C.id))},children:[r.jsx("span",{children:"×"}),r.jsx("span",{children:"All Countdowns"})]})]})]})},sr=({isEditMode:e,setIsEditMode:t,style:d={}})=>{const c={backgroundColor:e?"var(--purple)":"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",padding:"0.75rem",cursor:"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",color:e?"#fff":"var(--text-primary)",fontSize:"0.875rem",fontWeight:600,minWidth:"120px",...d},s=()=>{t(!e)};return r.jsxs("button",{style:c,onClick:s,title:e?"Exit Edit Mode":"Enter Edit Mode",onMouseEnter:a=>{e||(a.target.style.backgroundColor="var(--bg-tertiary)")},onMouseLeave:a=>{e||(a.target.style.backgroundColor="var(--bg-secondary)")},children:[r.jsx(Pe,{size:16}),e?"Exit Edit":"Edit Mode"]})},he=({position:e="top",children:t,onClick:d,className:c="",style:s={}})=>{const a=e==="top",x={background:"var(--bg-primary)",borderTop:a?"none":"1px solid var(--border)",borderBottom:a?"1px solid var(--border)":"none",padding:a?"0.25rem 0":"0.5rem",position:"sticky",[a?"top":"bottom"]:0,zIndex:a?10:100,order:a?1:3,flexShrink:0,touchAction:"manipulation",userSelect:"none",display:"flex",flexDirection:a?"column":"row",justifyContent:a?"stretch":"center",alignItems:a?"stretch":"center",height:a?"auto":"100%",...s};return r.jsx("div",{className:c,style:x,onClick:d,children:t})},xe=({side:e="left",children:t,className:d="",style:c={}})=>{const s=e==="left",a={flex:1,minWidth:0,background:"var(--bg-primary)",overflowY:"auto",overflowX:s?"auto":"hidden",display:s?"block":"flex",flexDirection:s?"initial":"column",height:"100%",padding:s?"1rem 0.5rem 1rem 1rem":"1rem 1rem 1rem 0.5rem",...c};return r.jsx("div",{className:d,style:a,children:t})},fe=({items:e,onDelete:t,onEdit:d,onToggleVisibility:c,onReorder:s,onItemSelect:a,selectedItem:x,selectedType:p,onApplyDamage:l,onApplyHealing:f,onApplyStressChange:h,onIncrement:o,onDecrement:u,isEditMode:y,elementType:i,adversaries:C=[]})=>{if(!e||e.length===0)return null;const w=E=>{const j={item:E,mode:"compact",onClick:()=>a(E,i),onDelete:t,dragAttributes:y?{draggable:!0}:null,dragListeners:y?{onDragStart:M=>{M.dataTransfer.setData("text/plain",E.id)}}:null,adversaries:C};switch(i){case"adversaries":return r.jsx(G,{...j,type:"adversary",onApplyDamage:l,onApplyHealing:f,onApplyStressChange:h},E.id);case"environments":return r.jsx(G,{...j,type:"environment",onEdit:d},E.id);case"countdowns":return r.jsx(G,{...j,type:"countdown",onIncrement:o,onDecrement:u},E.id);default:return null}};return r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:e.map(w)})},Z=({elementType:e,title:t,sectionKey:d,items:c=[],sectionVisibility:s,toggleSection:a,adversaries:x=[],onOpenDatabase:p,onDeleteItem:l,onEditItem:f,onToggleVisibility:h,onReorder:o,onItemSelect:u,selectedItem:y,selectedType:i,isEditMode:C,onApplyDamage:w,onApplyHealing:E,onApplyStressChange:j,onIncrement:M,onDecrement:R,showInlineCreator:W,onToggleInlineCreator:N,onCreateCountdown:D,fear:V,updateFear:z,handleRollOutcome:T,handleActionRoll:O,showLongTermCountdowns:H,setShowLongTermCountdowns:$,onRestTrigger:F,triggers:q})=>{const n=c&&c.length>0,g=!!(s!=null&&s[d]);return r.jsxs("div",{style:{marginBottom:"0.75rem"},children:[r.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.25rem",position:"relative"},children:r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",position:"relative",width:"100%"},children:[r.jsxs("button",{onClick:()=>a(d),title:n?g?"Collapse section":"Expand section":"No items to expand",disabled:!n,style:{display:"flex",alignItems:"center",gap:"0.75rem",background:"none",border:"none",color:n?"var(--text-primary)":"var(--text-secondary)",cursor:n?"pointer":"default",padding:"0.125rem 0.25rem",fontSize:"inherit",fontWeight:"inherit",transition:"opacity 0.2s ease",borderRadius:"var(--radius-sm)",opacity:n?1:.6},children:[n?r.jsx("div",{style:{width:"16px",height:"16px",transition:"transform 0.2s ease",transform:g?"rotate(0deg)":"rotate(-90deg)"},children:r.jsx(He,{size:16})}):r.jsx("div",{style:{width:"16px",height:"16px",flexShrink:0}}),r.jsx("h3",{style:{fontSize:"var(--text-base)",fontWeight:600,color:"var(--text-primary)",margin:0,padding:0,lineHeight:1.2,textTransform:"uppercase",letterSpacing:"0.05em",whiteSpace:"nowrap",width:"140px",flexShrink:0,textAlign:"left"},children:t})]}),r.jsx("button",{className:"btn-icon","data-color":"purple",onClick:()=>p(e),title:`Browse ${t}`,"aria-label":`Browse ${t}`,children:r.jsx(re,{size:16})})]})}),e==="countdowns"&&(W==null?void 0:W.campaign)&&r.jsxs("div",{className:"inline-countdown-creator",children:[r.jsx("p",{children:"Inline Countdown Creator - Coming Soon"}),r.jsx("button",{className:"btn-text",onClick:()=>N("campaign"),children:"Cancel"})]}),e==="countdowns"&&g&&c&&c.length>0&&r.jsx("div",{className:"countdown-trigger-controls",children:r.jsx("p",{children:"Countdown Trigger Controls - Coming Soon"})}),g&&r.jsx(fe,{items:c,onDelete:v=>l(v,e),onEdit:v=>f(v,e),onToggleVisibility:h,onReorder:o,onItemSelect:u,selectedItem:y,selectedType:i,onApplyDamage:w,onApplyHealing:E,onApplyStressChange:j,onIncrement:M,onDecrement:R,isEditMode:C,elementType:e,adversaries:x}),e==="countdowns"&&g&&H&&c&&c.filter(v=>v.type==="long-term").length>0&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"long-term-rest-controls",children:[r.jsxs("button",{className:"btn-text",onClick:v=>{v.stopPropagation(),F("short")},title:"Short Rest",children:[r.jsx(le,{size:16})," Short Rest"]}),r.jsxs("button",{className:"btn-text",onClick:v=>{v.stopPropagation(),F("long")},title:"Long Rest",children:[r.jsx(le,{size:16})," Long Rest"]})]}),r.jsx(fe,{items:c.filter(v=>v.type==="long-term"),onDelete:v=>l(v,e),onEdit:v=>f(v,e),onReorder:o,onItemSelect:u,selectedItem:y,selectedType:i,onIncrement:M,onDecrement:R,isEditMode:C,elementType:e})]})]})},ar=({onItemSelect:e,selectedItem:t,selectedType:d,onOpenDatabase:c,isEditMode:s,showLongTermCountdowns:a,fear:x,updateFear:p,handleRollOutcome:l,handleActionRoll:f,setShowLongTermCountdowns:h,lastAddedItemType:o})=>{const{adversaries:u,environments:y,updateAdversary:i,deleteAdversary:C,reorderAdversaries:w,updateEnvironment:E,deleteEnvironment:j,reorderEnvironments:M,countdowns:R,createCountdown:W,deleteCountdown:N,reorderCountdowns:D,incrementCountdown:V,decrementCountdown:z}=Ee(),[T,O]=b.useState({adversary:!1,environment:!1,campaign:!1}),[H,$]=rr("sectionVisibility",{countdowns:!1,environments:!1,adversaries:!1});b.useEffect(()=>{o&&(o==="environment"?$(k=>({...k,environments:!0})):o==="adversary"?$(k=>({...k,adversaries:!0})):o==="countdown"&&$(k=>({...k,countdowns:!0})))},[o,$]);const F=k=>{const S=k==="adversaries"?u:k==="environments"?y:k==="countdowns"?R:[];S&&S.length>0&&$(I=>({...I,[k]:!I[k]}))},q=(k,S)=>{},n=k=>{O(S=>({...S,[k]:!S[k]}))},g=k=>{W(k),O(S=>({...S,[k.source]:!1})),$(S=>({...S,countdowns:!0}))},v=k=>{c(k)},m=(k,S)=>{S==="environment"?j(k):S==="adversary"?C(k):S==="countdown"&&N(k),t&&t.id===k&&e(null,null)},P=k=>{};return r.jsxs("div",{style:{flex:1,overflowY:"auto"},children:[r.jsx(Z,{elementType:"countdowns",title:"Countdowns",sectionKey:"countdowns",items:R,sectionVisibility:H,toggleSection:F,adversaries:u,showInlineCreator:T,onToggleInlineCreator:n,onCreateCountdown:g,fear:x,updateFear:p,handleRollOutcome:l,handleActionRoll:f,showLongTermCountdowns:a,setShowLongTermCountdowns:h,onDeleteItem:m,onEditItem:q,onReorder:D,onItemSelect:e,selectedItem:t,selectedType:d,onIncrement:V,onDecrement:z,isEditMode:s,onRestTrigger:P}),r.jsx(Z,{elementType:"environments",title:"Environments",sectionKey:"environments",items:y,sectionVisibility:H,toggleSection:F,adversaries:u,onOpenDatabase:v,onDeleteItem:m,onEditItem:q,onToggleVisibility:k=>{const S=y.find(I=>I.id===k);S&&E(k,{isVisible:!S.isVisible})},onReorder:M,onItemSelect:e,selectedItem:t,selectedType:d,isEditMode:s}),r.jsx(Z,{elementType:"adversaries",title:"Adversaries",sectionKey:"adversaries",items:u,sectionVisibility:H,toggleSection:F,adversaries:u,onOpenDatabase:v,onDeleteItem:m,onEditItem:q,onToggleVisibility:k=>{const S=u.find(I=>I.id===k);S&&i(k,{isVisible:!S.isVisible})},onReorder:w,onItemSelect:e,selectedItem:t,selectedType:d,onApplyDamage:(k,S,I,_)=>{const A=Math.min(_,I+S);i(k,{hp:A})},onApplyHealing:(k,S,I)=>{if(u.find(A=>A.id===k)){const A=Math.max(0,I-S);i(k,{hp:A})}},onApplyStressChange:(k,S)=>{const I=u.find(_=>_.id===k);if(I){let _=I.stress+S,A=I.hp||0;if(_>I.stressMax){const X=_-I.stressMax;_=I.stressMax,A=Math.min(I.hpMax,A+X)}else _<0&&(_=0);i(k,{stress:_,hp:A})}},isEditMode:s})]})};function ir({headerSelector:e=".drawer-header",closeThreshold:t=100,snapThreshold:d=30,onClose:c}={}){const[s,a]=b.useState(null),[x,p]=b.useState(null),[l,f]=b.useState(0),[h,o]=b.useState(!1),u=b.useCallback(w=>{var R,W;const E=w.target;if(!(e?E.closest(e):!1))return;const M=((W=(R=w.targetTouches)==null?void 0:R[0])==null?void 0:W.clientY)??0;a(M),p(M),f(0),o(!1)},[e]),y=b.useCallback(w=>{var R,W;if(s==null)return;const E=((W=(R=w.targetTouches)==null?void 0:R[0])==null?void 0:W.clientY)??0,j=E-s,M=6;!h&&Math.abs(j)>M&&o(!0),h&&(w.preventDefault(),w.stopPropagation(),p(E),f(Math.max(0,j)))},[s,h]),i=b.useCallback(w=>{if(s==null||x==null)return;const E=x-s;h?(w.preventDefault(),w.stopPropagation(),E>t?(f(window.innerHeight),typeof c=="function"&&setTimeout(()=>c(),300)):E>d?(f(0),setTimeout(()=>{a(null),p(null),o(!1)},50)):(f(0),a(null),p(null),o(!1))):(f(0),a(null),p(null),o(!1))},[s,x,h,t,d,c]),C=b.useCallback(()=>{f(0),a(null),p(null)},[]);return{drawerOffset:l,setDrawerOffset:f,touchHandlers:{onTouchStart:u,onTouchMove:y,onTouchEnd:i},resetSwipeState:C}}const lr=({isOpen:e,onClose:t,children:d})=>{const{drawerOffset:c,setDrawerOffset:s,touchHandlers:a,resetSwipeState:x}=ir({headerSelector:".drawer-header",closeThreshold:100,snapThreshold:30,onClose:t});return b.useEffect(()=>{e||x()},[e,x]),r.jsxs("div",{className:`mobile-drawer ${e?"open":""}`,children:[r.jsx("div",{className:"drawer-backdrop",onClick:t}),r.jsxs("div",{className:"drawer-content",style:{transform:e?`translateY(${c}px)`:"translateY(100%)",transition:c?"none":"transform 0.25s cubic-bezier(0.4, 0.0, 0.2, 1)"},onTouchStart:p=>{a.onTouchStart(p)},onTouchMove:p=>{a.onTouchMove(p)},onTouchEnd:p=>{a.onTouchEnd(p)},onClick:p=>{p.stopPropagation()},children:[r.jsx("div",{className:"drawer-header",onClick:()=>{s(window.innerHeight),setTimeout(()=>{t()},300)},children:r.jsx("div",{className:"drawer-handle"})}),r.jsx("div",{className:"drawer-body",children:d})]})]})},dr=()=>r.jsx("div",{className:"pwa-install-prompt",style:{}}),cr="modulepreload",pr=function(e){return"/Daggerheart/"+e},ge={},me=function(t,d,c){if(!d||d.length===0)return t();const s=document.getElementsByTagName("link");return Promise.all(d.map(a=>{if(a=pr(a),a in ge)return;ge[a]=!0;const x=a.endsWith(".css"),p=x?'[rel="stylesheet"]':"";if(!!c)for(let h=s.length-1;h>=0;h--){const o=s[h];if(o.href===a&&(!x||o.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${p}`))return;const f=document.createElement("link");if(f.rel=x?"stylesheet":cr,x||(f.as="script",f.crossOrigin=""),f.href=a,document.head.appendChild(f),x)return new Promise((h,o)=>{f.addEventListener("load",h),f.addEventListener("error",()=>o(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>t()).catch(a=>{const x=new Event("vite:preloadError",{cancelable:!0});if(x.payload=a,window.dispatchEvent(x),!x.defaultPrevented)throw a})};let Ie={adversaries:[]},Me={environments:[]};const ur=async()=>{try{const e=await me(()=>import("./adversaries-e62ea4d8.js"),[]);Ie=(e==null?void 0:e.default)||e}catch(e){console.warn("Failed to load adversaries.json:",e)}try{const e=await me(()=>import("./environments-f019e73d.js"),[]);Me=(e==null?void 0:e.default)||e}catch(e){console.warn("Failed to load environments.json:",e)}},hr=e=>{const[t,d]=b.useState(""),[c,s]=b.useState([{field:"name",direction:"asc"}]),[a,x]=b.useState(null),[p,l]=b.useState([]),[f,h]=b.useState(!0),[o,u]=b.useState([]),[y,i]=b.useState([]),[C,w]=b.useState(!1),[E,j]=b.useState(!1),M=b.useRef(null),R=b.useRef(null);b.useEffect(()=>{(async()=>{await ur(),h(!1);let g=[];e==="adversary"?g=Ie.adversaries||[]:e==="environment"&&(g=Me.environments||[]),l(g)})()},[e]);const W=n=>{const g=p.map(v=>v[n]).filter(Boolean);return[...new Set(g)].sort((v,m)=>typeof v=="number"&&typeof m=="number"?v-m:String(v).localeCompare(String(m)))},N=W("tier"),D=W("type"),V=b.useMemo(()=>{let n=p.filter(g=>{var k,S;const v=g.name.toLowerCase().includes(t.toLowerCase())||((k=g.type)==null?void 0:k.toLowerCase().includes(t.toLowerCase()))||((S=g.description)==null?void 0:S.toLowerCase().includes(t.toLowerCase())),m=o.length===0||o.includes(g.tier.toString()),P=y.length===0||y.includes(g.type);return v&&m&&P});return n.sort((g,v)=>{for(const m of c){const{field:P,direction:k}=m;let S=g[P],I=v[P];if(P==="tier")S=parseInt(S)||0,I=parseInt(I)||0;else if(P==="difficulty"){const _=parseInt(S),A=parseInt(I);!isNaN(_)&&!isNaN(A)?(S=_,I=A):!isNaN(_)&&isNaN(A)?(S=_,I=999):isNaN(_)&&!isNaN(A)?(S=999,I=A):(S=String(S||"").toLowerCase(),I=String(I||"").toLowerCase())}else typeof S=="string"&&typeof I=="string"?(S=S.toLowerCase(),I=I.toLowerCase()):(S=String(S||"").toLowerCase(),I=String(I||"").toLowerCase());if(k==="asc"){if(S>I)return 1;if(S<I)return-1}else{if(S<I)return 1;if(S>I)return-1}}return 0}),n},[p,t,c,o,y]),z=n=>{s(g=>{const v=g.findIndex(m=>m.field===n);if(v>=0)if(v===0){const m=[...g];return m[0]={...m[0],direction:m[0].direction==="asc"?"desc":"asc"},m}else{const m=[...g];return m.splice(v,1)[0],[{field:n,direction:"asc"},...m]}else return[{field:n,direction:"asc"},...g]})},T=n=>{x(a===n?null:n)},O=n=>{u(n==="clear"?[]:g=>g.includes(n)?g.filter(v=>v!==n):[...g,n])},H=n=>{i(n==="clear"?[]:g=>g.includes(n)?g.filter(v=>v!==n):[...g,n])},$=o.length>0,F=y.length>0;return b.useEffect(()=>{const n=v=>{const m=v.target.closest(".filter-dropdown"),P=v.target.closest(".header-filter-icon");m||P||(w(!1),j(!1))},g=v=>{v.key==="Escape"&&(w(!1),j(!1))};return document.addEventListener("pointerdown",n,!0),document.addEventListener("mousedown",n,!0),document.addEventListener("touchstart",n,!0),document.addEventListener("click",n,!0),document.addEventListener("keydown",g,!0),()=>{document.removeEventListener("pointerdown",n,!0),document.removeEventListener("mousedown",n,!0),document.removeEventListener("touchstart",n,!0),document.removeEventListener("click",n,!0),document.removeEventListener("keydown",g,!0)}},[w,j]),{searchTerm:t,setSearchTerm:d,sortFields:c,handleSort:z,expandedCard:a,toggleExpanded:T,filteredAndSortedData:V,loading:f,selectedTiers:o,selectedTypes:y,showTierDropdown:C,setShowTierDropdown:w,showTypeDropdown:E,setShowTypeDropdown:j,tierFilterRef:M,typeFilterRef:R,uniqueTiers:N,uniqueTypes:D,handleTierSelect:O,handleTypeSelect:H,isTierFiltered:$,isTypeFiltered:F,getDropdownStyle:n=>{if(!n.current)return{};const g=n.current.getBoundingClientRect();return{position:"fixed",top:g.bottom+4,left:g.left,zIndex:99999}}}},xr=({searchTerm:e,onSearchChange:t,type:d})=>r.jsx("div",{style:L.browserHeader,children:r.jsx("input",{type:"text",placeholder:"Search",value:e,onChange:c=>t(c.target.value),style:L.searchInput})}),fr=({sortFields:e,onSort:t,type:d,uniqueTiers:c,uniqueTypes:s,selectedTiers:a,selectedTypes:x,showTierDropdown:p,setShowTierDropdown:l,showTypeDropdown:f,setShowTypeDropdown:h,tierFilterRef:o,typeFilterRef:u,handleTierSelect:y,handleTypeSelect:i,isTierFiltered:C,isTypeFiltered:w,getDropdownStyle:E})=>{const[j,M]=b.useState(null),W=(()=>d==="adversary"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:d==="environment"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:[])(),N=(D,V,z,T,O,H,$,F)=>{if(!O)return null;const q=()=>{(D==="tier"||D==="type")&&T("clear")};return ve.createPortal(r.jsxs("div",{className:"filter-dropdown",style:{...L.filterDropdown,...E($),maxHeight:"60vh",overflow:"auto"},onMouseDown:n=>n.stopPropagation(),onClick:n=>n.stopPropagation(),children:[r.jsxs("div",{style:{...L.filterOption,...z.length===0?L.filterOptionSelected:{}},onClick:q,children:[r.jsx("span",{style:L.checkIcon,children:z.length===0?r.jsx(de,{size:16}):r.jsx(ce,{size:16})}),r.jsx("span",{style:L.filterLabel,children:"All"})]}),V.map(n=>{const g=z.includes(n.toString());return r.jsxs("div",{style:{...L.filterOption,...g?L.filterOptionSelected:{}},onClick:()=>T(n.toString()),children:[r.jsx("span",{style:L.checkIcon,children:g?r.jsx(de,{size:16}):r.jsx(ce,{size:16})}),r.jsx("span",{style:L.filterLabel,children:n})]},n)})]}),document.body)};return r.jsx("tr",{style:L.tableHeader,children:W.map(D=>r.jsxs("th",{style:{...L.tableHeaderCell,...j===D.key?L.tableHeaderCellHover:{},position:"relative",...D.key==="name"?{width:"auto",minWidth:"0"}:{},...D.key==="tier"?{width:"80px",minWidth:"80px",maxWidth:"80px"}:{},...D.key==="type"?{width:"100px",minWidth:"100px",maxWidth:"100px"}:{},...D.key==="difficulty"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...D.key==="action"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{}},onClick:()=>t(D.key),onMouseEnter:()=>M(D.key),onMouseLeave:()=>M(null),children:[D.hasFilter?r.jsxs("div",{style:L.headerWithFilter,children:[r.jsx("span",{style:{cursor:"pointer"},onClick:V=>{V.stopPropagation(),t(D.key)},children:D.label}),r.jsxs("button",{ref:D.key==="tier"?o:u,style:{...L.headerFilterIcon,...D.key==="tier"&&C?L.headerFilterIconActive:{},...D.key==="type"&&w?L.headerFilterIconActive:{}},className:"header-filter-icon",onClick:V=>{V.stopPropagation(),D.key==="tier"?(l(!p),h(!1)):D.key==="type"&&(h(!f),l(!1))},children:[r.jsx(Fe,{size:14}),D.key==="tier"&&C||D.key==="type"&&w?r.jsx("span",{style:L.filterActiveDot}):null]})]}):D.label,D.key==="tier"&&N("tier",c,a,y,p,l,o),D.key==="type"&&N("type",s,x,i,f,h,u)]},D.key))})},gr=({item:e,isExpanded:t,onToggleExpanded:d,onAdd:c,type:s})=>{const[a,x]=b.useState(!1),p=()=>{c(e)},l=()=>s==="adversary"?r.jsxs(r.Fragment,{children:[r.jsx("td",{style:{...L.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:e.name}),r.jsx("td",{style:{...L.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:e.tier}),r.jsx("td",{style:{...L.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:e.type}),r.jsx("td",{style:{...L.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:e.difficulty})]}):s==="environment"?r.jsxs(r.Fragment,{children:[r.jsx("td",{style:{...L.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:e.name}),r.jsx("td",{style:{...L.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:e.tier}),r.jsx("td",{style:{...L.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:e.type}),r.jsx("td",{style:{...L.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:e.difficulty})]}):null;return r.jsxs(r.Fragment,{children:[r.jsxs("tr",{style:{...L.row,...a?L.rowHover:{}},onClick:()=>d(e.id),onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1),children:[l(),r.jsx("td",{style:{width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",boxSizing:"border-box",overflow:"visible",textOverflow:"unset",whiteSpace:"nowrap"},children:r.jsx("button",{style:L.addButton,onClick:f=>{f.stopPropagation(),p()},onMouseEnter:f=>{f.target.style.background="var(--gray-dark)"},onMouseLeave:f=>{f.target.style.background="var(--purple)"},children:"+"})})]}),t&&r.jsx("tr",{style:L.expandedRow,children:r.jsx("td",{colSpan:"5",style:L.expandedContent,children:r.jsx(G,{item:e,type:s,mode:"expanded",onClick:()=>{},onDelete:()=>{}})})})]})},ye=({type:e,onAddItem:t,onCancel:d})=>{const{searchTerm:c,setSearchTerm:s,sortFields:a,handleSort:x,expandedCard:p,toggleExpanded:l,filteredAndSortedData:f,loading:h,selectedTiers:o,selectedTypes:u,showTierDropdown:y,setShowTierDropdown:i,showTypeDropdown:C,setShowTypeDropdown:w,tierFilterRef:E,typeFilterRef:j,uniqueTiers:M,uniqueTypes:R,handleTierSelect:W,handleTypeSelect:N,isTierFiltered:D,isTypeFiltered:V,getDropdownStyle:z}=hr(e);return h?r.jsx("div",{style:L.browser,children:r.jsx("div",{style:L.loading,children:"Loading..."})}):r.jsxs("div",{style:L.browserWrapper,children:[r.jsx(xr,{searchTerm:c,onSearchChange:s,type:e}),r.jsx("div",{className:"browser-content",style:L.browserContent,children:r.jsxs("table",{style:L.browserTable,children:[r.jsx("thead",{children:r.jsx(fr,{sortFields:a,onSort:x,type:e,uniqueTiers:M,uniqueTypes:R,selectedTiers:o,selectedTypes:u,showTierDropdown:y,setShowTierDropdown:i,showTypeDropdown:C,setShowTypeDropdown:w,tierFilterRef:E,typeFilterRef:j,handleTierSelect:W,handleTypeSelect:N,isTierFiltered:D,isTypeFiltered:V,getDropdownStyle:z})}),r.jsx("tbody",{children:f.map(T=>r.jsx(gr,{item:T,isExpanded:p===T.id,onToggleExpanded:l,onAdd:t,type:e},T.id))})]})})]})},L={browserWrapper:{display:"flex",flexDirection:"column",background:"var(--bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border)",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserContent:{flex:1,overflowY:"auto",overflowX:"visible",padding:0,width:"100%"},tableHeaderContainer:{flexShrink:0,position:"sticky",top:0,zIndex:15,backgroundColor:"var(--gray-800)"},browserTable:{width:"100%",minWidth:"100%",borderCollapse:"collapse",tableLayout:"fixed",background:"var(--bg-primary)",margin:0},browserHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-secondary)",flexShrink:0,position:"sticky",top:0,zIndex:20},browserTitle:{margin:0,color:"var(--text-primary)",fontSize:"18px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"24px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"14px",marginRight:"12px",transition:"all 0.2s ease"},searchInputFocus:{outline:"none",borderColor:"#8b5cf6",boxShadow:"0 0 0 3px rgba(139, 92, 246, 0.1)"},tableHeader:{background:"var(--gray-800)",borderBottom:"1px solid var(--border)",boxShadow:"0 1px 0 var(--border)",position:"sticky",top:"0",zIndex:10},tableHeaderCell:{backgroundColor:"var(--gray-800)",fontWeight:"700",borderBottom:"1px solid var(--border)",cursor:"pointer",userSelect:"none",minWidth:"100px",whiteSpace:"nowrap",padding:"4px 4px",color:"var(--text-primary)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",boxShadow:"0 1px 0 var(--border)",transition:"background-color 0.2s",position:"sticky",top:"0",zIndex:10},tableHeaderCellHover:{backgroundColor:"var(--bg-hover)"},sortIndicator:{fontSize:"12px",color:"#4a90e2"},tableBody:{flex:1,overflowY:"auto",padding:"8px",backgroundColor:"var(--gray-800)"},row:{height:"35px",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s ease",cursor:"pointer"},rowHover:{backgroundColor:"var(--bg-hover)"},expandedRow:{backgroundColor:"var(--bg-secondary)"},rowCell:{padding:"4px 4px",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid var(--border)"},rowCellName:{fontWeight:"500",minWidth:"150px"},rowCellCenter:{textAlign:"center",justifyContent:"center",minWidth:"80px"},rowActions:{width:"80px",textAlign:"center",padding:"4px 8px",borderBottom:"1px solid var(--border)"},addButton:{width:"1.5rem",height:"1.5rem",border:"1px solid var(--purple)",borderRadius:"var(--radius-sm)",background:"var(--purple)",color:"white",cursor:"pointer",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"500"},expandedContent:{padding:"16px",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)"},columnName:{width:"auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",paddingLeft:"8px",textAlign:"left"},columnTier:{width:"80px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnType:{width:"100px",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},columnDifficulty:{width:"40px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnAction:{width:"24px",minWidth:"24px",maxWidth:"24px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"visible",textOverflow:"unset"},loading:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"#fff",fontSize:"16px"},mobileBrowser:{width:"95vw",height:"90vh",maxWidth:"none"},mobileSearchInput:{fontSize:"16px"},headerWithFilter:{display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",position:"relative"},headerFilterIcon:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"2px 4px",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",position:"relative"},headerFilterIconActive:{color:"var(--purple)"},filterIcon:{fontSize:"12px"},filterActiveDot:{position:"absolute",left:"50%",top:"2px",transform:"translateX(-50%)",width:"4px",height:"4px",borderRadius:"50%",background:"var(--purple)",pointerEvents:"none"},filterDropdown:{position:"absolute",top:"100%",left:"0",background:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",zIndex:99999,marginTop:"4px",overflow:"hidden",width:"max-content",minWidth:"120px",maxWidth:"200px"},filterOption:{padding:"8px 12px",cursor:"pointer",color:"var(--text-primary)",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background-color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},filterOptionSelected:{backgroundColor:"var(--bg-hover)"},checkIcon:{width:"16px",height:"16px",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"12px"},filterLabel:{flex:1}};function mr({selectedItem:e,selectedType:t,countdowns:d,adversaries:c,environments:s,setSelectedItem:a,handleCloseRightColumn:x}){b.useEffect(()=>{if(!e||!t)return;let p=!1;t==="adversaries"||t==="adversary"?p=c.some(l=>l.id===e.id):t==="environments"||t==="environment"?p=s.some(l=>l.id===e.id):(t==="countdowns"||t==="countdown")&&(p=d.some(l=>l.id===e.id)),p||x()},[e,t,d,c,s,a,x]),b.useEffect(()=>{if(!e||!t)return;let p=null;t==="adversaries"||t==="adversary"?p=c.find(l=>l.id===e.id):t==="environments"||t==="environment"?p=s.find(l=>l.id===e.id):(t==="countdowns"||t==="countdown")&&(p=d.find(l=>l.id===e.id)),p&&JSON.stringify(p)!==JSON.stringify(e)&&a(p)},[e,t,d,c,s,a])}class yr extends oe.Component{constructor(t){super(t),this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,d){console.error("ErrorBoundary caught an error:",t,d)}render(){var t;return this.state.hasError?r.jsxs("div",{className:"p-md text-red",children:[r.jsx("h3",{children:"Something went wrong:"}),r.jsx("pre",{children:(t=this.state.error)==null?void 0:t.toString()}),r.jsx("button",{className:"btn-base btn-text",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try again"})]}):this.props.children}}const vr=()=>{const{adversaries:e,environments:t,countdowns:d,fear:c,updateFear:s,createAdversary:a,updateAdversary:x,deleteAdversary:p,createEnvironment:l,updateEnvironment:f,deleteEnvironment:h,createCountdown:o,deleteCountdown:u,advanceCountdown:y}=Ee(),[i,C]=b.useState(null),[w,E]=b.useState(null),[j,M]=b.useState(null),[R,W]=b.useState("unified"),[N,D]=b.useState(!1),[V,z]=b.useState(!1),[T]=b.useState("left"),[O,H]=b.useState(!0);b.useState(!1);const[$,F]=b.useState(null),[q,n]=b.useState(!1),g=(A,X)=>{b.startTransition(()=>{i&&i.id===A.id&&w===X&&j==="item"?(C(null),E(null),M(null),N&&n(!1)):(C(A),E(X),M("item"),N&&n(!0))})},v=(A="unified")=>{let X=A;A==="adversaries"?X="adversary":A==="environments"&&(X="environment"),j==="database"&&R===X?b.startTransition(()=>{M(null),W("unified"),N&&n(!1)}):b.startTransition(()=>{W(X),M("database"),N&&n(!0)})},m=A=>{d.forEach(X=>{const Y=Ue(X,A);if(Y>0){const U=X.value||0;y(X.id,U+Y)}})},P=()=>{d.forEach(A=>{const X=Je(A);if(X>0){const Y=A.value||0;y(A.id,Y+X)}})},k=b.useCallback(()=>{M(null),C(null),E(null),N&&n(!1)},[N]);b.useEffect(()=>{const A=()=>{const U=N,Q=window.matchMedia("(max-width: 800px)").matches;D(Q),!U&&Q&&(j==="database"||j==="creator"||j==="item")&&n(!0),U&&!Q&&q&&n(!1)};A();const X=window.matchMedia("(max-width: 800px)"),Y=()=>A();return X.addEventListener("change",Y),()=>X.removeEventListener("change",Y)},[N,j,q]),b.useEffect(()=>(q||N&&i?(document.body.classList.add("mobile-drawer-open"),document.documentElement.classList.add("mobile-drawer-open")):(document.body.classList.remove("mobile-drawer-open"),document.documentElement.classList.remove("mobile-drawer-open")),()=>{document.body.classList.remove("mobile-drawer-open"),document.documentElement.classList.remove("mobile-drawer-open")}),[N,q,i]),mr({selectedItem:i,selectedType:w,countdowns:d,adversaries:e,environments:t,setSelectedItem:C,handleCloseRightColumn:k});const{handleAdversaryDamage:S,handleAdversaryHealing:I,handleAdversaryStressChange:_}=Qe({adversaries:e,updateAdversary:x,deleteAdversary:p,selectedItem:i,setSelectedItem:C});return r.jsxs("div",{className:"app",onClick:A=>{A.target===A.currentTarget&&k()},children:[r.jsx(he,{position:"top",style:{display:"flex",alignItems:"center",justifyContent:"center",height:"var(--topbar-height)",touchAction:"manipulation",userSelect:"none"},children:r.jsx(K,{type:"fear",value:(c==null?void 0:c.value)||0,maxValue:12,onChange:s,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0})}),r.jsx("div",{className:"bottom-bar-container",children:r.jsxs(he,{position:"bottom",children:[r.jsx(sr,{isEditMode:V,setIsEditMode:z}),r.jsx(or,{adversaries:e,environments:t,countdowns:d,deleteAdversary:p,deleteEnvironment:h,deleteCountdown:u}),r.jsx(nr,{})]})}),r.jsxs("div",{className:"main-content",children:[r.jsx(xe,{side:"left",className:`${N&&T==="right"?"mobile-hidden":""}`,children:r.jsx(ar,{onItemSelect:g,onOpenDatabase:v,isEditMode:V,onEditModeChange:z,showLongTermCountdowns:O,fear:c,updateFear:s,handleRollOutcome:m,handleActionRoll:P,setShowLongTermCountdowns:H,lastAddedItemType:$})}),r.jsxs(xe,{side:"right",className:`${N&&T==="left"?"mobile-hidden":""}`,style:j==="database"?{overflowY:"hidden"}:{},children:[j==="database"&&r.jsx("div",{className:"database-display",children:r.jsx(ye,{type:R,onAddItem:A=>{R==="adversary"?(a(A),F("adversary")):R==="environment"&&(l(A),F("environment"))},onCancel:k})}),j==="item"&&i&&r.jsx(G,{type:w,item:i,mode:V?"edit":"expanded",onApplyDamage:S,onApplyHealing:I,onApplyStressChange:_,onUpdate:w==="adversaries"?x:w==="environments"?f:updateCountdown,adversaries:e}),!j&&r.jsx("div",{})]})]},`mobile-${N}`),N&&r.jsxs(lr,{isOpen:q,onClose:k,children:[j==="database"&&r.jsx("div",{className:"browser-container",children:r.jsx(ye,{type:R,onAddItem:A=>{R==="adversary"?(a(A),F("adversary")):R==="environment"&&(l(A),F("environment"))},onCancel:k})}),j==="item"&&i&&r.jsx("div",{className:"expanded-content",children:r.jsx(G,{type:w,item:i,mode:V?"edit":"expanded",onApplyDamage:S,onApplyHealing:I,onApplyStressChange:_,onUpdate:w==="adversaries"?x:w==="environments"?f:updateCountdown,adversaries:e})})]}),r.jsx(dr,{})]})},br=()=>r.jsx(yr,{children:r.jsx(Se,{children:r.jsx(vr,{})})});te.createRoot(document.getElementById("root")).render(r.jsx(oe.StrictMode,{children:r.jsx(Se,{children:r.jsx(br,{})})}));
