import{r as y,a as ge,R as re}from"./dndkit-57209f9c.js";import{F as Ie,f as Me,a as De,b as We,c as oe}from"./fa-b4bcccb0.js";import{D as Q,A as me,S as se,X as Ae,C as Re,M as ze,P as Z,a as Te,T as Be,b as Le,c as Pe,d as ae,F as He,e as ie,f as le}from"./lucide-cb4aabd8.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))i(d);new MutationObserver(d=>{for(const c of d)if(c.type==="childList")for(const g of c.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&i(g)}).observe(document,{childList:!0,subtree:!0});function s(d){const c={};return d.integrity&&(c.integrity=d.integrity),d.referrerPolicy&&(c.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?c.credentials="include":d.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(d){if(d.ep)return;d.ep=!0;const c=s(d);fetch(d.href,c)}})();var ye={exports:{}},U={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ne=y,Fe=Symbol.for("react.element"),Oe=Symbol.for("react.fragment"),$e=Object.prototype.hasOwnProperty,Ve=Ne.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,_e={key:!0,ref:!0,__self:!0,__source:!0};function ve(e,r,s){var i,d={},c=null,g=null;s!==void 0&&(c=""+s),r.key!==void 0&&(c=""+r.key),r.ref!==void 0&&(g=r.ref);for(i in r)$e.call(r,i)&&!_e.hasOwnProperty(i)&&(d[i]=r[i]);if(e&&e.defaultProps)for(i in r=e.defaultProps,r)d[i]===void 0&&(d[i]=r[i]);return{$$typeof:Fe,type:e,key:c,ref:g,props:d,_owner:Ve.current}}U.Fragment=Oe;U.jsx=ve;U.jsxs=ve;ye.exports=U;var t=ye.exports,ee={},de=ge;ee.createRoot=de.createRoot,ee.hydrateRoot=de.hydrateRoot;const ce={fear:{icon:Me,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"0.125rem",maxWidth:"none"},pipStyle:{fontSize:"var(--text-lg)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0,imageRendering:"crisp-edges"},filledColor:"var(--purple)",emptyColor:"var(--gray-dark)",tooltipTitle:"Click anywhere in header to adjust fear:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease fear by 1"},{text:"Right of boundary:",description:"Click to increase fear by 1"}]},hp:{icon:De,maxValue:20,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stress:{icon:We,maxValue:12,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},countdown:{icon:oe,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust countdown:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease countdown by 1"},{text:"Right of boundary:",description:"Click to increase countdown by 1"}]},hpDots:{maxValue:20,containerStyle:{display:"flex",flexWrap:"wrap",gap:"2px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--red)",borderColor:"var(--red)",boxShadow:"0 0 4px rgba(239, 68, 68, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stressDots:{maxValue:12,containerStyle:{display:"flex",flexWrap:"wrap",gap:"2px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--purple)",borderColor:"var(--purple)",boxShadow:"0 0 4px rgba(139, 92, 246, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},adversaryHP:{icon:Q,maxValue:20,containerStyle:{display:"flex",gap:"0.125rem",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--red)",emptyColor:"#a3a3a3",tooltipTitle:"Click to adjust HP:",tooltipInstructions:[{text:"Filled pip:",description:"Click to heal (reduce damage)"},{text:"Empty pip:",description:"Click to take damage"}]},adversaryStress:{icon:me,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--gold)",emptyColor:"#a3a3a3",tooltipTitle:"Click to adjust stress:",tooltipInstructions:[{text:"Filled pip:",description:"Click to reduce stress"},{text:"Empty pip:",description:"Click to increase stress"}]},countdownDistributed:{icon:oe,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Countdown progress:",tooltipInstructions:[{text:"Progress:",description:"Current countdown value"}]}},G=({type:e="fear",value:r=0,maxValue:s,onChange:i,size:d="lg",showTooltip:c=!0,containerStyle:g={},pipStyle:f={},countdownType:l=null,distributedGroups:x=null,onPipClick:u=null,enableBoundaryClick:n=!1,clickContainerWidth:p="auto",centerPips:m=!0})=>{const[a,w]=y.useState(!1),b=ce[e]||ce.fear,I=s||b.maxValue,C=Math.max(0,Math.min(I,r));let S=b.filledColor;e==="countdown"&&l&&(["progress","dynamic-progress","simple-hope"].includes(l)?S="var(--gold)":["consequence","dynamic-consequence","simple-fear"].includes(l)?S="var(--purple)":["long-term","standard"].includes(l)&&(S="var(--text-secondary)"));const B=(A,R)=>{if(u)u(A,R);else if(i){const F=A+1;i(F)}},P=A=>{if(!n||!i||u)return;A.currentTarget.getBoundingClientRect();const R=A.currentTarget.querySelector(".pip-container");if(!R)return;const F=R.getBoundingClientRect(),O=A.clientX-F.left;if(O<0){C>0&&i(C-1);return}if(O>F.width){C<I&&i(C+1);return}const h=F.width,M=h*.05,D=h-2*M,o=O-M,v=C/I,j=D*v;o<j?C>0&&i(C-1):C<I&&i(C+1)},W=(()=>{if(!x||e!=="countdownDistributed")return[{start:0,end:I,groupIndex:0}];let A=0;return x.map((R,F)=>{const O={start:A,end:A+R,groupIndex:F};return A+=R,O})})(),V=()=>t.jsxs(t.Fragment,{children:[W.map(A=>t.jsx(re.Fragment,{children:[...Array(A.end-A.start)].map((R,F)=>{const O=A.start+F,h=O<C;if(b.isDots)return t.jsx("div",{style:{...b.pipStyle,...h?b.filledStyle:b.emptyStyle,...f,cursor:i||u?"pointer":"default"},onClick:n?void 0:()=>B(O,h),title:`${O+1} of ${I}`},O);{const M=b.icon,D=M&&typeof M=="object"&&M.iconName,o=h?S:b.emptyColor;return t.jsx("span",{className:`fear-pip ${h?"filled":"empty"}`,style:{...b.pipStyle,color:o,cursor:i||u?"pointer":"default",...f},onClick:n?void 0:()=>B(O,h),title:`${O+1} of ${I}`,children:D?t.jsx(Ie,{icon:M,size:d}):t.jsx(M,{size:16})},O)}})},A.groupIndex)),c&&t.jsx("div",{style:{position:"relative",cursor:"help",pointerEvents:"none"},children:t.jsxs("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:a?"translateX(-50%) translateY(-5px)":"translateX(-50%)",background:"rgba(15, 23, 42, 0.95)",border:"1px solid var(--gray)",borderRadius:"var(--radius-md)",padding:"var(--space-md)",minWidth:"250px",zIndex:1e3,opacity:a?1:0,visibility:a?"visible":"hidden",transition:"all 0.2s ease",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.5)"},children:[t.jsx("div",{style:{fontWeight:600,color:"#e2e8f0",marginBottom:"0.75rem",fontSize:"var(--text-sm)"},children:b.tooltipTitle}),b.tooltipInstructions.map((A,R)=>t.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.8rem",color:"#cbd5e1",lineHeight:1.4},children:[t.jsx("strong",{style:{color:"#e2e8f0"},children:A.text})," ",A.description]},R))]})})]});return t.jsx("div",{style:{width:p,height:"100%",cursor:i||u?"pointer":"default",touchAction:"manipulation",userSelect:"none",display:m?"flex":"block",alignItems:m?"center":"stretch",justifyContent:m?"center":"flex-start",...g},onClick:A=>{A.stopPropagation(),A.preventDefault(),n&&P(A)},onMouseEnter:()=>w(c),onMouseLeave:()=>w(!1),children:t.jsx("div",{className:"pip-container",style:{...b.containerStyle,width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},children:V()})})};function ne(e){const r=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return e?`${e}-${r}`:r}const qe=(e,r)=>({createAdversary:g=>{const f=ne("adv"),l=e().adversaries||[],x=g.name||"Unknown",u=l.filter(m=>m.baseName===x);let n=1;if(u.length===0)n=1;else{const m=u.map(w=>w.duplicateNumber||1);let a=1;for(;m.includes(a);)a++;n=a}const p={...g,id:f,baseName:x,duplicateNumber:n,name:`${x} (${n})`,hp:0,stress:0,isVisible:!0};r(m=>({...m,adversaries:[...m.adversaries,p]}))},updateAdversary:(g,f)=>{r(l=>({...l,adversaries:l.adversaries.map(x=>{if(x.id===g){const u={...x,...f};if(f.baseName!==void 0){const n=f.baseName,p=u.duplicateNumber||1;u.name=p===1?n:`${n} (${p})`}return u}return x})}))},deleteAdversary:g=>{r(f=>({...f,adversaries:f.adversaries.filter(l=>l.id!==g)}))},reorderAdversaries:g=>{r(f=>{const[l,x]=g,u=[...f.adversaries],[n]=u.splice(l,1);return u.splice(x,0,n),{...f,adversaries:u}})}}),Xe=e=>({createCountdown:l=>{const x={id:ne("countdown"),name:l.name||"Countdown",max:parseInt(l.max)||1,value:0,visible:!0,type:l.type||"standard",loop:l.loop||"none",source:l.source||"campaign"};e(u=>({...u,countdowns:[...u.countdowns,x]}))},updateCountdown:(l,x)=>{e(u=>({...u,countdowns:u.countdowns.map(n=>n.id===l?{...n,...x}:n)}))},deleteCountdown:l=>{e(x=>({...x,countdowns:x.countdowns.filter(u=>u.id!==l)}))},advanceCountdown:(l,x)=>{e(u=>({...u,countdowns:u.countdowns.map(n=>{if(n.id!==l)return n;let p=x;if(n.loop==="loop")p>n.max?p=(p-1)%n.max+1:p<0&&(p=n.max);else if(n.loop==="increasing"){if(p>n.max)return{...n,max:n.max+1,value:1};if(p<0)return{...n,max:Math.max(1,n.max-1),value:1};p=Math.max(0,p)}else if(n.loop==="decreasing"){if(p>n.max)return{...n,max:Math.max(1,n.max-1),value:1};if(p<0)return{...n,max:n.max+1,value:1};p=Math.min(n.max,p)}else p=Math.max(0,Math.min(p,n.max));return{...n,value:p}})}))},incrementCountdown:(l,x=1)=>{e(u=>({...u,countdowns:u.countdowns.map(n=>{if(n.id!==l)return n;let p=n.value+x;if(n.loop==="loop")p>n.max&&(p=(p-1)%n.max+1);else if(n.loop==="increasing"){if(p>n.max)return{...n,max:n.max+1,value:1}}else if(n.loop==="decreasing"){if(p>n.max)return{...n,max:Math.max(1,n.max-1),value:1}}else p=Math.min(p,n.max);return{...n,value:p}})}))},decrementCountdown:l=>{e(x=>({...x,countdowns:x.countdowns.map(u=>{if(u.id!==l)return u;let n=u.value-1;if(u.loop==="loop")n<0&&(n=u.max);else if(u.loop==="increasing"){if(n<0)return{...u,max:Math.max(1,u.max-1),value:u.max};n=Math.max(0,n)}else if(u.loop==="decreasing"){if(n<0)return{...u,max:u.max+1,value:1}}else n=Math.max(0,n);return{...u,value:n}})}))},reorderCountdowns:l=>{e(x=>{const[u,n]=l,p=[...x.countdowns],[m]=p.splice(u,1);return p.splice(n,0,m),{...x,countdowns:p}})}}),Ye=(e,r)=>({createEnvironment:g=>{const f=ne("env"),x=(e().environments||[]).filter(p=>p.name.replace(/\s+\(\d+\)$/,"")===g.name);let u=g.name||"Unknown";if(x.length===0)u=g.name;else if(x.length===1){const p=x[0],m=p.name.replace(/\s+\(\d+\)$/,""),a=e().environments.map(w=>w.id===p.id?{...w,name:`${m} (1)`}:w);r(w=>({...w,environments:a})),u=`${g.name} (2)`}else{const p=x.map(a=>{const w=a.name.match(/\((\d+)\)$/);return w?parseInt(w[1]):null}).filter(a=>a!==null);let m=1;for(;p.includes(m);)m++;u=`${g.name} (${m})`}const n={...g,id:f,name:u,isVisible:!0};r(p=>({...p,environments:[...p.environments,n]}))},updateEnvironment:(g,f)=>{r(l=>({...l,environments:l.environments.map(x=>x.id===g?{...x,...f}:x)}))},deleteEnvironment:g=>{r(f=>({...f,environments:f.environments.filter(l=>l.id!==g)}))},reorderEnvironments:g=>{r(f=>{const[l,x]=g,u=[...f.environments],[n]=u.splice(l,1);return u.splice(x,0,n),{...f,environments:u}})}});function Ge(e,r){const s=(e==null?void 0:e.type)||"standard";if(s==="standard")return 1;if(s==="progress"||s==="dynamic-progress")switch(r){case"success-hope":return 2;case"success-fear":return 1;case"critical-success":return 3;default:return 0}if(s==="consequence"||s==="dynamic-consequence")switch(r){case"success-fear":return 1;case"failure-hope":return 2;case"failure-fear":return 3;default:return 0}return s==="simple-fear"?r==="simple-fear"||r==="success-fear"||r==="failure-fear"?1:0:s==="simple-hope"&&(r==="simple-hope"||r==="success-hope"||r==="failure-hope"||r==="critical-success")?1:0}function Ke(e){return((e==null?void 0:e.type)||"standard")==="standard"?1:0}function Ue({adversaries:e,updateAdversary:r,deleteAdversary:s,selectedItem:i,setSelectedItem:d}){const c=y.useCallback((l,x,u,n)=>{var I,C;const p=e.find(S=>S.id===l);if(!p)return;const m=p.type==="Minion",a=(I=p.features)==null?void 0:I.find(S=>{var B;return(B=S.name)==null?void 0:B.startsWith("Minion (")}),w=a?parseInt(((C=a.name.match(/\((\d+)\)/))==null?void 0:C[1])||"1"):1;if(m){s(l);const S=Math.floor(x/w);if(S>0){const B=e.filter(P=>P.type==="Minion"&&P.id!==l&&P.name===p.name);for(let P=0;P<Math.min(S,B.length);P++)s(B[P].id)}return}const b=Math.min(u+x,n);i&&i.id===l&&d(S=>({...S,hp:b})),r(l,{hp:b})},[e,r,s,i,d]),g=y.useCallback((l,x,u)=>{const n=Math.max(0,u-x);i&&i.id===l&&d(p=>({...p,hp:n})),r(l,{hp:n})},[r,i,d]),f=y.useCallback((l,x,u,n)=>{const p=e.find(w=>w.id===l);if(!p)return;let m=u+x,a=p.hp||0;if(m>n){const w=m-n;m=n,a=Math.min(p.hpMax||0,a+w)}m=Math.max(0,m),i&&i.id===l&&d(w=>({...w,stress:m,hp:a})),r(l,{stress:m,hp:a})},[e,r,i,d]);return{handleAdversaryDamage:c,handleAdversaryHealing:g,handleAdversaryStressChange:f}}const H={card:{backgroundColor:"#1a1a1a",borderWidth:"1px",borderStyle:"solid",borderColor:"#333",borderRadius:"8px",padding:"12px",marginTop:"0.5rem",cursor:"pointer",transition:"all 0.2s ease",position:"relative"},cardHover:{borderColor:"#555",backgroundColor:"#222"},cardDead:{opacity:.6,backgroundColor:"#0f0f0f",borderColor:"#444"},cardAtMax:{backgroundColor:"#0d4f0d",borderColor:"#28a745"},rowMain:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},rowTitle:{fontSize:"16px",fontWeight:"600",color:"#fff",margin:0},rowMeta:{display:"flex",gap:"8px",alignItems:"center"},cardActions:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px"},controlButtons:{display:"flex",gap:"8px",alignItems:"center"},pipSymbols:{display:"flex",gap:"4px",alignItems:"center",cursor:"pointer",padding:"2px"},pipSymbol:{fontSize:"16px",transition:"color 0.2s ease"},pipGroup:{display:"flex",gap:"4px",marginBottom:"4px"},badge:{padding:"2px 6px",borderRadius:"3px",fontSize:"10px",fontWeight:"600",textTransform:"uppercase"},typeBadge:{backgroundColor:"#6f42c1",color:"#fff"},difficultyBadge:{backgroundColor:"#4a5568",color:"#fff",cursor:"pointer",transition:"background-color 0.2s ease"},tierBadge:{backgroundColor:"#17a2b8",color:"#fff"},inputBase:{padding:"8px",borderWidth:"1px",borderStyle:"solid",borderColor:"#6b7280",borderRadius:"4px",backgroundColor:"#1a1a1a",color:"#ffffff",fontSize:"14px",transition:"all 0.2s ease"},inputBaseFocus:{outline:"none",borderColor:"#4f46e5",boxShadow:"0 0 0 2px rgba(79, 70, 229, 0.1)"},inputBaseDisabled:{opacity:.6,cursor:"not-allowed"},button:{backgroundColor:"#dc3545",color:"#fff",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.2s ease"},incrementButton:{backgroundColor:"#28a745",color:"#fff",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.2s ease"},decrementButton:{backgroundColor:"#ffc107",color:"#000",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.2s ease"},damageInputPopup:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,borderRadius:"8px"},damageInputContent:{backgroundColor:"#2a2a2a",borderWidth:"1px",borderStyle:"solid",borderColor:"#555",borderRadius:"8px",padding:"16px",display:"flex",flexDirection:"column",gap:"12px",minWidth:"200px"},damageInput:{backgroundColor:"#1a1a1a",borderWidth:"1px",borderStyle:"solid",borderColor:"#555",borderRadius:"4px",padding:"8px",color:"#fff",fontSize:"14px"},damageIndicators:{display:"flex",gap:"8px",alignItems:"center",justifyContent:"center"},damageDrop:{fontSize:"16px",color:"#666",cursor:"pointer",transition:"color 0.2s ease"},applyButton:{backgroundColor:"#28a745",color:"#fff",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.2s ease"}},Je=(e,r,s,i)=>{const[d,c]=y.useState(!1),[g,f]=y.useState(""),l=m=>{m.stopPropagation(),m.preventDefault();const a=e.hp||0,w=e.hpMax||1,b=m.currentTarget.getBoundingClientRect(),I=m.clientX-b.left,C=b.width/w;Math.floor(I/C)<a?s&&s(e.id,1,e.hp):r&&r(e.id,1,e.hp,e.hpMax)},x=m=>{m.stopPropagation(),m.preventDefault();const a=e.stress||0,w=e.stressMax||1,b=m.currentTarget.getBoundingClientRect(),I=m.clientX-b.left,C=b.width/w;Math.floor(I/C)<a?i&&i(e.id,-1,e.stress,e.stressMax):i&&i(e.id,1,e.stress,e.stressMax)},u=m=>{m.stopPropagation(),(e.thresholds&&e.thresholds.major&&e.thresholds.severe||e.type==="Minion")&&(c(!0),f(e.type==="Minion"?"1":""))},n=()=>{const m=parseInt(g);if(m>0){if(e.type==="Minion")r&&r(e.id,m,e.hp,e.hpMax);else{let a=0;m>=e.thresholds.severe?a=3:m>=e.thresholds.major?a=2:m>=1&&(a=1),r&&r(e.id,a,e.hp,e.hpMax)}c(!1),f("")}};return{showDamageInput:d,damageValue:g,setDamageValue:f,setShowDamageInput:c,handleHpClick:l,handleStressClick:x,handleDifficultyClick:u,applyDamage:n,handleKeyDown:m=>{m.key==="Enter"?n():m.key==="Escape"&&(c(!1),f(""))}}},Qe=(e,r,s)=>({renderDistributedPips:()=>{const d=e.max,c=[];for(let g=0;g<d;g+=5){const f=Math.min(5,d-g);c.push(f)}return c.map((g,f)=>t.jsx("div",{style:H.pipGroup,children:Array.from({length:g},(l,x)=>{const u=f*5+x;return t.jsx("span",{style:{...H.pipSymbol,color:u<(e.value||0)?"#ff6b6b":"#666"},title:`${u+1} of ${e.max}`,children:u<(e.value||0)?"●":"○"},u)})},f))}}),K=({item:e,type:r,mode:s="compact",onClick:i,onDelete:d,onApplyDamage:c,onApplyHealing:g,onApplyStressChange:f,onUpdate:l,onIncrement:x,onDecrement:u,dragAttributes:n,dragListeners:p,adversaries:m=[]})=>{const a=r==="adversary"||r==="adversaries"?Je(e,c,g,f):null,w=r==="countdown"?Qe(e):null,b=(a==null?void 0:a.handleDifficultyClick)||(()=>{console.warn("adversaryLogic.handleDifficultyClick not available")}),[I,C]=y.useState(!1),S=()=>{let h={...H.card};return I&&(h={...h,...H.cardHover}),r==="adversary"&&(e.hp||0)>=(e.hpMax||1)&&(h={...h,...H.cardDead}),r==="countdown"&&(e.value||0)>=e.max&&(h={...h,...H.cardAtMax}),h},B=()=>{var h,M;if(r==="adversary"){const D=e.baseName||((h=e.name)==null?void 0:h.replace(/\s+\(\d+\)$/,""))||"",o=e.duplicateNumber||((M=e.name)!=null&&M.match(/\((\d+)\)$/)?parseInt(e.name.match(/\((\d+)\)$/)[1]):1);return m.filter($=>$.baseName===D).length>1?`${D} (${o})`:D}return e.name},P=()=>{const h=[];return e.type&&h.push(t.jsx("span",{style:{...H.badge,...H.typeBadge},children:e.type},"type")),r==="environment"&&e.tier&&h.push(t.jsxs("span",{style:{...H.badge,...H.tierBadge},children:["Tier ",e.tier]},"tier")),h},N=()=>t.jsxs("div",{style:H.cardActions,children:[t.jsxs("div",{style:H.controlButtons,children:[t.jsx("div",{style:{display:"flex",alignItems:"center"},children:t.jsx("div",{style:{display:"flex",gap:"0.25rem",alignItems:"center",cursor:"pointer",padding:"0.125rem",borderRadius:"0.25rem",transition:"all 0.2s ease"},onClick:a.handleHpClick,onMouseEnter:h=>h.target.style.background="#2a2a2a",onMouseLeave:h=>h.target.style.background="transparent",children:Array.from({length:e.hpMax||1},(h,M)=>t.jsx("span",{style:{fontSize:"1rem",transition:"color 0.2s ease",cursor:"pointer",color:M<(e.hp||0)?"#ff6b6b":"#666"},title:M<(e.hp||0)?"Click to heal (reduce damage)":"Click to take damage",children:t.jsx(Q,{size:16})},M))})}),e.stressMax>0&&t.jsx("div",{style:{display:"flex",alignItems:"center"},children:t.jsx("div",{style:{display:"flex",gap:"0.25rem",alignItems:"center",cursor:"pointer",padding:"0.125rem",borderRadius:"0.25rem",transition:"all 0.2s ease"},onClick:a.handleStressClick,onMouseEnter:h=>h.target.style.background="#2a2a2a",onMouseLeave:h=>h.target.style.background="transparent",children:Array.from({length:e.stressMax},(h,M)=>t.jsx("span",{style:{fontSize:"1rem",transition:"color 0.2s ease",cursor:"pointer",color:M<(e.stress||0)?"#ffd700":"#666"},title:M<(e.stress||0)?"Click to reduce stress":"Click to increase stress",children:t.jsx(me,{size:16})},M))})}),e.difficulty&&t.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:t.jsx("div",{onClick:a.handleDifficultyClick,style:{cursor:e.thresholds&&e.thresholds.major&&e.thresholds.severe||e.type==="Minion"?"pointer":"default"},title:e.thresholds&&e.thresholds.major&&e.thresholds.severe?`Click to enter damage (thresholds: ${e.thresholds.major}/${e.thresholds.severe})`:e.type==="Minion"?"Click to enter damage (minion mechanics)":"",children:t.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",background:"#1a1a1a",border:"1px solid #333",borderRadius:"0.25rem",padding:"0.25rem 0.5rem",transition:"all 0.2s ease"},onMouseEnter:h=>h.target.style.background="#2a2a2a",onMouseLeave:h=>h.target.style.background="#1a1a1a",children:t.jsx("span",{style:{fontSize:"0.875rem",fontWeight:600,color:"#fff"},children:e.difficulty})})})})]}),t.jsx("div",{style:{display:"flex",alignItems:"center"},children:n&&p&&t.jsx("button",{style:{background:"#2a2a2a",border:"1px solid #333",borderRadius:"0.25rem",padding:"0.25rem",minWidth:"1.5rem",height:"1.5rem",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.2s ease",color:"#fff",fontSize:"1rem"},onClick:h=>{h.stopPropagation(),h.preventDefault(),d&&d(e.id)},onMouseEnter:h=>h.target.style.background="#3a3a3a",onMouseLeave:h=>h.target.style.background="#2a2a2a",title:"Delete adversary",children:"×"})})]}),W=()=>null,V=()=>t.jsxs(t.Fragment,{children:[t.jsx("button",{style:H.decrementButton,onClick:h=>{h.stopPropagation(),h.preventDefault(),u&&u(e.id)},title:"Decrease progress",children:t.jsx(ze,{size:16})}),t.jsx("button",{style:H.incrementButton,onClick:h=>{h.stopPropagation(),h.preventDefault(),x&&x(e.id)},title:e.value>=e.max?e.loop&&e.loop!=="none"?"Loop countdown":"Countdown at max":"Increase progress",children:e.value>=e.max?e.loop&&e.loop!=="none"?"⟳":t.jsx(Z,{size:16}):t.jsx(Z,{size:16})})]}),A=()=>{switch(r){case"adversary":return N();case"environment":return W();case"countdown":return V();default:return null}},R=()=>r==="countdown"?t.jsx("div",{style:H.pipSymbols,children:w.renderDistributedPips()}):null,F=()=>r!=="adversary"||!a.showDamageInput||!(e.thresholds&&e.thresholds.major&&e.thresholds.severe||e.type==="Minion")?null:t.jsx("div",{style:H.damageInputPopup,onClick:h=>{h.stopPropagation(),h.target===h.currentTarget&&(a.setShowDamageInput(!1),a.setDamageValue(""))},children:t.jsxs("div",{style:H.damageInputContent,onClick:h=>h.stopPropagation(),children:[t.jsx("input",{type:"number",inputMode:"numeric",enterKeyHint:"done",placeholder:"Damage",min:e.type==="Minion"?"1":"0",value:a.damageValue,onChange:h=>a.setDamageValue(h.target.value),onKeyDown:a.handleKeyDown,style:H.damageInput,autoFocus:!0}),t.jsxs("div",{style:H.damageIndicators,children:[e.type==="Minion"?(()=>{var v,j;const h=parseInt(a.damageValue)||0,M=(v=e.features)==null?void 0:v.find($=>{var X;return(X=$.name)==null?void 0:X.startsWith("Minion (")}),D=M?parseInt(((j=M.name.match(/\((\d+)\)/))==null?void 0:j[1])||"1"):1,o=Math.floor(h/D);return h>=D&&o>0?t.jsxs("span",{style:{...H.damageDrop,color:"#28a745"},title:`${h} damage can defeat ${o+1} minion${o+1!==1?"s":""} (1 + ${o} additional)`,children:["+",o," additional minion(s)"]}):t.jsx("span",{style:H.damageDrop,title:`${h} damage defeats this minion only`,children:"+0 additional minion(s)"})})():[1,2,3].map(h=>{const M=parseInt(a.damageValue)||0;let D=!1;return h===1&&M>=1&&(D=!0),h===2&&M>=e.thresholds.major&&(D=!0),h===3&&M>=e.thresholds.severe&&(D=!0),t.jsx("span",{style:{...H.damageDrop,color:D?"#ff6b6b":"#666"},onClick:o=>{o.stopPropagation(),h===1?a.setDamageValue("1"):h===2?a.setDamageValue(e.thresholds.major.toString()):h===3&&a.setDamageValue(e.thresholds.severe.toString())},title:`Click to set damage to ${h===1?"1":h===2?e.thresholds.major:e.thresholds.severe}`,children:t.jsx(Q,{size:16})},h)}),t.jsx("button",{style:{...H.applyButton,backgroundColor:!a.damageValue||parseInt(a.damageValue)<1?"#666":"#28a745"},onClick:h=>{h.stopPropagation(),a.applyDamage()},title:"Apply damage",disabled:!a.damageValue||parseInt(a.damageValue)<1,children:t.jsx(Re,{size:16})})]})]})}),O=()=>{const h=!!(n&&p),M=(e.hp||0)>=(e.hpMax||1),D=s==="edit";return t.jsxs("div",{style:{...S(),padding:"1rem",minHeight:"400px",opacity:M?.6:1},...n,...p,onClick:i,onMouseEnter:()=>C(!0),onMouseLeave:()=>C(!1),children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"0.5rem",marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--border)"},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.25rem"},children:[t.jsx("h2",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:0},children:B()}),(e.tier||e.type)&&t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.tier&&t.jsxs("span",{style:{fontSize:"0.75rem",fontWeight:500,color:"var(--text-secondary)",letterSpacing:"0.5px"},children:["Tier ",e.tier]}),e.type&&t.jsx("span",{style:{fontSize:"0.75rem",fontWeight:500,color:"var(--text-secondary)",letterSpacing:"0.5px"},children:e.type})]})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.125rem",alignItems:"flex-end"},children:[t.jsx(G,{type:"adversaryHP",value:e.hp||0,maxValue:e.hpMax||1,onChange:o=>{const v=e.hp||0;o>v?c&&c(e.id,o-v,e.hp,e.hpMax):o<v&&g&&g(e.id,v-o,e.hp)},containerStyle:{cursor:"pointer",padding:"0.0625rem",borderRadius:"0.125rem",transition:"all 0.2s ease"},pipStyle:{fontSize:"0.75rem"},showTooltip:!1,enableBoundaryClick:!0}),e.stressMax>0&&t.jsx(G,{type:"adversaryStress",value:e.stress||0,maxValue:e.stressMax,onChange:o=>{const v=e.stress||0,j=o-v;f&&f(e.id,j,e.stress)},containerStyle:{cursor:"pointer",padding:"0.0625rem",borderRadius:"0.125rem",transition:"all 0.2s ease"},pipStyle:{fontSize:"0.75rem"},showTooltip:!1,enableBoundaryClick:!0})]}),e.difficulty&&t.jsxs("div",{onClick:b,style:{cursor:e.thresholds&&e.thresholds.major&&e.thresholds.severe||e.type==="Minion"?"pointer":"default",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},title:e.thresholds&&e.thresholds.major&&e.thresholds.severe?`Click to enter damage (thresholds: ${e.thresholds.major}/${e.thresholds.severe})`:e.type==="Minion"?"Click to enter damage (minion mechanics)":"",children:[t.jsx(se,{size:32,strokeWidth:.5,style:{color:"var(--text-primary)"}}),t.jsx("span",{style:{position:"absolute",fontSize:"0.75rem",fontWeight:600,color:"var(--text-primary)",pointerEvents:"none"},children:e.difficulty})]}),h&&t.jsx("button",{style:{background:"#2a2a2a",border:"1px solid #333",borderRadius:"0.25rem",padding:"0.25rem",minWidth:"1.5rem",height:"1.5rem",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.2s ease",color:"#fff",fontSize:"1rem"},onClick:o=>{o.stopPropagation(),o.preventDefault(),d&&d(e.id)},onMouseEnter:o=>o.target.style.background="#3a3a3a",onMouseLeave:o=>o.target.style.background="#2a2a2a",title:"Delete item",children:"×"})]})]}),e.description&&t.jsxs("div",{style:{marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--border)"},children:[t.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:"0 0 0.5rem 0"},children:"Description"}),D?t.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.25rem",backgroundColor:"var(--bg-secondary)",color:"var(--text-primary)",fontSize:"0.875rem",lineHeight:1.5,resize:"vertical",fontFamily:"inherit"},value:e.description,onChange:o=>{l&&l(e.id,{description:o.target.value})},placeholder:"Enter adversary description..."}):t.jsx("p",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",margin:0,whiteSpace:"pre-wrap"},children:e.description})]}),e.motives&&t.jsxs("div",{style:{marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--border)"},children:[t.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:"0 0 0.5rem 0"},children:"Motives"}),D?t.jsx("textarea",{style:{width:"100%",minHeight:"80px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.25rem",backgroundColor:"var(--bg-secondary)",color:"var(--text-primary)",fontSize:"0.875rem",lineHeight:1.5,resize:"vertical",fontFamily:"inherit"},value:e.motives,onChange:o=>{l&&l(e.id,{motives:o.target.value})},placeholder:"Enter adversary motives..."}):t.jsx("p",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",margin:0,whiteSpace:"pre-wrap"},children:e.motives})]}),t.jsx("div",{style:{marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--border)"},children:t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",fontSize:"0.875rem"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[t.jsxs("span",{children:[t.jsx("strong",{children:"Difficulty:"})," ",e.difficulty]}),e.thresholds&&t.jsxs("span",{children:[t.jsx("strong",{children:"Thresholds:"})," ",e.thresholds.major,"/",e.thresholds.severe]}),t.jsxs("span",{children:[t.jsx("strong",{children:"HP:"})," ",e.hpMax]}),e.stressMax>0&&t.jsxs("span",{children:[t.jsx("strong",{children:"Stress:"})," ",e.stressMax]})]}),(e.atk!==void 0||e.weapon||e.damage)&&t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[e.atk!==void 0&&t.jsxs("span",{children:[t.jsx("strong",{children:"ATK:"})," ",e.atk>=0?"+":"",e.atk]}),e.weapon&&t.jsxs("span",{children:[t.jsxs("strong",{children:[e.weapon,":"]})," ",e.range||"Melee"]}),e.damage&&t.jsxs("span",{children:[t.jsx("strong",{children:"Damage:"})," ",e.damage]})]}),e.experience&&e.experience.length>0&&t.jsxs("div",{children:[t.jsx("strong",{children:"Experience:"})," ",e.experience.map(o=>typeof o=="string"?o:`${o.name} ${o.modifier>=0?"+":""}${o.modifier}`).join(", ")]})]})}),e.features&&e.features.length>0&&t.jsxs("div",{style:{marginBottom:"1rem"},children:[e.features.filter(o=>o.type==="Passive").length>0&&t.jsxs("div",{style:{marginBottom:"1rem"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[t.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"var(--text-primary)",margin:0,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Passives"}),t.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:e.features.filter(o=>o.type==="Passive").map((o,v)=>t.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[t.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:o.name}),o.description&&t.jsxs(t.Fragment,{children:[t.jsx("span",{children:" - "}),t.jsx("span",{children:o.description})]})]},v))})]}),e.features.filter(o=>o.type==="Action").length>0&&t.jsxs("div",{style:{marginBottom:"1rem"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[t.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"var(--text-primary)",margin:0,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Actions"}),t.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:e.features.filter(o=>o.type==="Action").map((o,v)=>t.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[t.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:o.name}),o.description&&t.jsxs(t.Fragment,{children:[t.jsx("span",{children:" - "}),t.jsx("span",{children:o.description})]})]},v))})]}),e.features.filter(o=>o.type==="Reaction").length>0&&t.jsxs("div",{style:{marginBottom:"1rem"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[t.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"var(--text-primary)",margin:0,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Reactions"}),t.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:e.features.filter(o=>o.type==="Reaction").map((o,v)=>t.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[t.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:o.name}),o.description&&t.jsxs(t.Fragment,{children:[t.jsx("span",{children:" - "}),t.jsx("span",{children:o.description})]})]},v))})]})]}),F()]})};if((s==="expanded"||s==="edit")&&(r==="adversary"||r==="adversaries"))return O();if(s!=="compact")return t.jsxs("div",{style:S(),children:[t.jsxs("div",{style:H.rowMain,children:[t.jsx("h4",{style:H.rowTitle,children:B()}),t.jsx("div",{style:H.rowMeta,children:P()})]}),t.jsxs("p",{style:{color:"#666",fontSize:"12px",margin:0},children:["Expanded view coming soon for ",r]})]});if(r==="adversary"||r==="adversaries"){const h=!!(n&&p),M=(e.hp||0)>=(e.hpMax||1);return t.jsxs("div",{style:{...S(),opacity:M?.6:1,backgroundColor:M?"#2a1a1a":S().backgroundColor,borderColor:M?"#4a2a2a":S().borderColor,paddingLeft:h?"2.25rem":"0.75rem",position:"relative"},onClick:i,onMouseEnter:()=>C(!0),onMouseLeave:()=>C(!1),...n,...p,children:[h&&t.jsx("div",{style:{position:"absolute",left:"0.5rem",top:"50%",transform:"translateY(-50%)",color:"#666",cursor:"grab",fontSize:"0.875rem",lineHeight:1,padding:"0.25rem",borderRadius:"0.25rem",transition:"all 0.2s ease"},...n,...p,children:"⋮⋮"}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"0.5rem"},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.25rem"},children:[t.jsx("h4",{style:H.rowTitle,children:B()}),e.type&&t.jsx("span",{style:{fontSize:"0.75rem",fontWeight:500,color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px"},children:e.type})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.125rem",alignItems:"flex-end"},children:[t.jsx(G,{type:"adversaryHP",value:e.hp||0,maxValue:e.hpMax||1,onChange:D=>{const o=e.hp||0;D>o?c&&c(e.id,D-o,e.hp,e.hpMax):D<o&&g&&g(e.id,o-D,e.hp)},containerStyle:{cursor:"pointer",padding:"0.0625rem",borderRadius:"0.125rem",transition:"all 0.2s ease"},pipStyle:{fontSize:"0.75rem"},showTooltip:!1,enableBoundaryClick:!0}),e.stressMax>0&&t.jsx(G,{type:"adversaryStress",value:e.stress||0,maxValue:e.stressMax,onChange:D=>{const o=e.stress||0,v=D-o;f&&f(e.id,v,e.stress)},containerStyle:{cursor:"pointer",padding:"0.0625rem",borderRadius:"0.125rem",transition:"all 0.2s ease"},pipStyle:{fontSize:"0.75rem"},showTooltip:!1,enableBoundaryClick:!0})]}),e.difficulty&&t.jsxs("div",{onClick:b,style:{cursor:e.thresholds&&e.thresholds.major&&e.thresholds.severe||e.type==="Minion"?"pointer":"default",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},title:e.thresholds&&e.thresholds.major&&e.thresholds.severe?`Click to enter damage (thresholds: ${e.thresholds.major}/${e.thresholds.severe})`:e.type==="Minion"?"Click to enter damage (minion mechanics)":"",children:[t.jsx(se,{size:32,strokeWidth:.5,style:{color:"var(--text-primary)"}}),t.jsx("span",{style:{position:"absolute",fontSize:"0.75rem",fontWeight:600,color:"var(--text-primary)",pointerEvents:"none"},children:e.difficulty})]}),n&&p&&t.jsx("button",{style:{background:"#2a2a2a",border:"1px solid #333",borderRadius:"0.25rem",padding:"0.25rem",minWidth:"1.5rem",height:"1.5rem",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.2s ease",color:"#fff",fontSize:"1rem"},onClick:D=>{D.stopPropagation(),D.preventDefault(),d&&d(e.id)},onMouseEnter:D=>D.target.style.background="#3a3a3a",onMouseLeave:D=>D.target.style.background="#2a2a2a",title:"Delete item",children:"×"})]})]}),F()]})}return t.jsxs("div",{style:S(),onClick:i,onMouseEnter:()=>C(!0),onMouseLeave:()=>C(!1),...n,...p,children:[t.jsxs("div",{style:H.rowMain,children:[t.jsx("h4",{style:H.rowTitle,children:B()}),t.jsx("div",{style:H.rowMeta,children:P()})]}),R(),t.jsxs("div",{style:H.cardActions,children:[t.jsx("div",{style:H.controlButtons,children:A()}),t.jsx("div",{style:{display:"flex",alignItems:"center"},children:n&&p&&t.jsx("button",{style:H.button,onClick:h=>{h.stopPropagation(),h.preventDefault(),d&&d(e.id)},title:`Delete ${r}`,children:t.jsx(Ae,{size:16})})})]}),F()]})},be=y.createContext();function te(e){if(typeof localStorage>"u")return null;try{const r=localStorage.getItem(e);return r==null?null:JSON.parse(r)}catch{return null}}function we(e,r){if(!(typeof localStorage>"u"))try{localStorage.setItem(e,JSON.stringify(r))}catch{}}const Ce=({children:e})=>{const[r,s]=y.useState({fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[]});y.useEffect(()=>{var F,O,h;const R=te("daggerheart-game-state");if(R)try{(((F=R.adversaries)==null?void 0:F.length)>0||((O=R.environments)==null?void 0:O.length)>0||((h=R.countdowns)==null?void 0:h.length)>0)&&s(R)}catch(M){console.error("Failed to load saved state:",M)}},[]),y.useEffect(()=>{we("daggerheart-game-state",r)},[r]);const i=R=>{s(F=>({...F,fear:{...F.fear,value:R}}))},d=()=>{s(R=>({...R,fear:{...R.fear,visible:!R.fear.visible}}))},c=y.useRef(r);y.useEffect(()=>{c.current=r},[r]);const g=()=>c.current,f=Xe(s),l=qe(g,s),x=Ye(g,s),{createCountdown:u,updateCountdown:n,deleteCountdown:p,advanceCountdown:m,incrementCountdown:a,decrementCountdown:w,reorderCountdowns:b}=f,{createAdversary:I,updateAdversary:C,deleteAdversary:S,reorderAdversaries:B}=l,{createEnvironment:P,updateEnvironment:N,deleteEnvironment:W,reorderEnvironments:V}=x,A={gameState:r,updateFear:i,toggleFearVisibility:d,createCountdown:u,updateCountdown:n,deleteCountdown:p,advanceCountdown:m,incrementCountdown:a,decrementCountdown:w,reorderCountdowns:b,createAdversary:I,updateAdversary:C,deleteAdversary:S,reorderAdversaries:B,createEnvironment:P,updateEnvironment:N,deleteEnvironment:W,reorderEnvironments:V};return t.jsx(be.Provider,{value:A,children:e})},je=()=>{const e=y.useContext(be);if(!e)return console.warn("useGameState: Context not available yet, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],updateFear:()=>{},toggleFearVisibility:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{gameState:r,...s}=e;if(!r)return console.warn("useGameState: gameState not available, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],updateFear:()=>{},toggleFearVisibility:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{fear:i,countdowns:d,adversaries:c,environments:g}=r;return{gameState:r,fear:i,countdowns:d,adversaries:c,environments:g,...s,hasCountdowns:d.length>0,hasAdversaries:c.length>0,hasEnvironments:g.length>0,getCountdownById:f=>d.find(l=>l.id===f),getAdversaryById:f=>c.find(l=>l.id===f),getEnvironmentById:f=>g.find(l=>l.id===f)}},Ze=(e,r)=>{const[s,i]=y.useState(()=>{const d=te(e);return d??r});return y.useEffect(()=>{const d=te(e);i(d??r)},[e]),y.useEffect(()=>{we(e,s)},[e,s]),[s,i]},et="/Daggerheart/assets/daggerheart-logo-fe7815ad.svg",tt=()=>{const[e,r]=y.useState(!1);return y.useEffect(()=>{const s=i=>{i.target.closest(".help-button")||r(!1)};return document.addEventListener("click",s),()=>document.removeEventListener("click",s)},[]),t.jsxs("div",{className:"help-button",style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",padding:"0.5rem",color:"var(--text-primary)",borderRadius:"var(--radius-md)",cursor:"pointer",transition:"background-color 0.2s ease",minWidth:"44px",minHeight:"44px",backgroundColor:e?"var(--purple)":"transparent"},onMouseEnter:s=>{e||(s.target.style.backgroundColor="var(--gray-dark)")},onMouseLeave:s=>{e||(s.target.style.backgroundColor="transparent")},onClick:s=>{s.stopPropagation(),r(!e)},title:"Help & Info",children:[t.jsx("div",{style:{width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center",color:"inherit"},children:t.jsx(Te,{size:20})}),t.jsxs("div",{style:{position:"absolute",bottom:"100%",left:window.innerWidth<=800?"auto":"50%",right:window.innerWidth<=800?"0":"auto",transform:window.innerWidth<=800?"none":"translateX(-50%)",background:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,opacity:e?1:0,visibility:e?"visible":"hidden",transition:"opacity 0.2s ease, visibility 0.2s ease, transform 0.2s ease",pointerEvents:e?"auto":"none",minWidth:"280px",maxWidth:window.innerWidth<=800?"calc(100vw - 2rem)":"320px",marginBottom:window.innerWidth<=800?"0.5rem":"0"},children:[t.jsxs("div",{style:{padding:"0.75rem",borderTop:"1px solid rgba(255, 255, 255, 0.1)",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",background:"var(--bg-primary)",maxWidth:"280px"},children:[t.jsx("img",{src:et,alt:"Daggerheart Community Content Logo",style:{width:"100%",maxWidth:"200px",height:"auto",margin:"0 auto 0.75rem auto",display:"block"},onError:s=>{console.error("Failed to load Daggerheart logo:",s.target.src),s.target.style.display="none";const i=document.createElement("div");i.style.cssText="text-align: center; margin-bottom: 0.75rem; font-size: 1.5rem; font-weight: bold; color: var(--purple);",i.textContent="⚔️ DAGGERHEART ⚔️",s.target.parentNode.insertBefore(i,s.target)},onLoad:()=>{}}),t.jsxs("div",{style:{fontSize:"0.7rem",lineHeight:1.3,color:"var(--text-secondary)",textAlign:"left",wordWrap:"break-word",overflowWrap:"break-word"},children:[t.jsx("p",{children:"This product includes materials from the Daggerheart System Reference Document 1.0, © Critical Role, LLC, under the terms of the Darrington Press Community Gaming (DPCGL) License."}),t.jsxs("p",{children:["More information can be found at ",t.jsx("a",{href:"https://www.daggerheart.com",target:"_blank",rel:"noopener noreferrer",children:"daggerheart.com"})]}),t.jsx("p",{children:t.jsx("em",{children:"This project is unofficial and not endorsed by Darrington Press or Critical Role."})})]})]}),t.jsx("button",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"0.25rem 1rem",color:"var(--text-primary)",border:"none",background:"none",width:"100%",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"0.875rem",minHeight:"32px",borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},onMouseEnter:s=>{s.target.style.backgroundColor="var(--gray-dark)"},onMouseLeave:s=>{s.target.style.backgroundColor="transparent"},onClick:s=>{s.stopPropagation(),r(!1),window.open("https://github.com/Splinter714/Daggerheart","_blank")},children:t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.25rem"},children:t.jsx("span",{children:"GitHub"})})}),t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"0.25rem 1rem",color:"var(--text-secondary)",border:"none",background:"none",width:"100%",textAlign:"left",cursor:"default",fontSize:"0.875rem",minHeight:"32px"},children:t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.25rem"},children:t.jsxs("span",{children:["Version ","0.2.1 (d753888)"]})})})]})]})},rt=({adversaries:e,environments:r,countdowns:s,deleteAdversary:i,deleteEnvironment:d,deleteCountdown:c})=>{const[g,f]=y.useState(!1);y.useEffect(()=>{const a=w=>{w.target.closest(".delete-clear-container")||f(!1)};return document.addEventListener("click",a),()=>document.removeEventListener("click",a)},[]);const l=((e==null?void 0:e.length)||0)>0||((r==null?void 0:r.length)||0)>0||((s==null?void 0:s.length)||0)>0,x=(e||[]).some(a=>(a.hp||0)>=(a.hpMax||1)),u={position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",padding:"0.5rem",minWidth:"200px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,display:g?"block":"none"},n={background:"none",border:"none",color:l?"var(--text-primary)":"var(--text-secondary)",cursor:l?"pointer":"not-allowed",padding:"0.5rem",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s",opacity:l?1:.5},p={background:"none",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:"0.5rem",borderRadius:"var(--radius-sm)",width:"100%",textAlign:"left",display:"flex",alignItems:"center",gap:"0.5rem",transition:"background-color 0.2s"},m={backgroundColor:"var(--bg-hover)"};return t.jsxs("div",{className:"delete-clear-container",style:{position:"relative"},children:[t.jsx("button",{style:n,onClick:a=>{a.stopPropagation(),l&&f(!g)},title:l?"Clear Items":"Nothing to clear",children:t.jsx(Be,{size:20})}),t.jsxs("div",{style:u,children:[e&&e.length>0&&t.jsxs("button",{style:p,onMouseEnter:a=>Object.assign(a.target.style,m),onMouseLeave:a=>Object.assign(a.target.style,p),onClick:a=>{a.stopPropagation(),f(!1),e.forEach(w=>i(w.id))},children:[t.jsx("span",{children:"×"}),t.jsx("span",{children:"All Adversaries"})]}),e&&e.length>0&&x&&t.jsxs("button",{style:p,onMouseEnter:a=>Object.assign(a.target.style,m),onMouseLeave:a=>Object.assign(a.target.style,p),onClick:a=>{a.stopPropagation(),f(!1),e.filter(b=>(b.hp||0)>=(b.hpMax||1)).forEach(b=>i(b.id))},children:[t.jsx("span",{children:"×"}),t.jsx("span",{children:"Dead Adversaries"})]}),r&&r.length>0&&t.jsxs("button",{style:p,onMouseEnter:a=>Object.assign(a.target.style,m),onMouseLeave:a=>Object.assign(a.target.style,p),onClick:a=>{a.stopPropagation(),f(!1),r.forEach(w=>d(w.id))},children:[t.jsx("span",{children:"×"}),t.jsx("span",{children:"All Environments"})]}),s&&s.length>0&&t.jsxs("button",{style:p,onMouseEnter:a=>Object.assign(a.target.style,m),onMouseLeave:a=>Object.assign(a.target.style,p),onClick:a=>{a.stopPropagation(),f(!1),s.forEach(w=>c(w.id))},children:[t.jsx("span",{children:"×"}),t.jsx("span",{children:"All Countdowns"})]})]})]})},nt=({isEditMode:e,setIsEditMode:r,style:s={}})=>{const i={backgroundColor:e?"var(--purple)":"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",padding:"0.75rem",cursor:"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",color:e?"#fff":"var(--text-primary)",fontSize:"0.875rem",fontWeight:600,minWidth:"120px",...s},d=()=>{r(!e)};return t.jsxs("button",{style:i,onClick:d,title:e?"Exit Edit Mode":"Enter Edit Mode",onMouseEnter:c=>{e||(c.target.style.backgroundColor="var(--bg-tertiary)")},onMouseLeave:c=>{e||(c.target.style.backgroundColor="var(--bg-secondary)")},children:[t.jsx(Le,{size:16}),e?"Exit Edit":"Edit Mode"]})},pe=({position:e="top",children:r,onClick:s,className:i="",style:d={}})=>{const c=e==="top",g={background:"var(--bg-primary)",borderTop:c?"none":"1px solid var(--border)",borderBottom:c?"1px solid var(--border)":"none",padding:c?"0.25rem 0":"0.5rem",position:"sticky",[c?"top":"bottom"]:0,zIndex:c?10:100,order:c?1:3,flexShrink:0,touchAction:"manipulation",userSelect:"none",display:"flex",flexDirection:c?"column":"row",justifyContent:c?"stretch":"center",alignItems:c?"stretch":"center",height:c?"auto":"100%",...d};return t.jsx("div",{className:i,style:g,onClick:s,children:r})},ue=({side:e="left",children:r,className:s="",style:i={}})=>{const d=e==="left",c={flex:1,minWidth:0,background:"var(--bg-primary)",overflowY:"auto",overflowX:d?"auto":"hidden",display:d?"block":"flex",flexDirection:d?"initial":"column",height:"100%",padding:d?"1rem 0.5rem 1rem 1rem":"1rem 1rem 1rem 0.5rem",...i};return t.jsx("div",{className:s,style:c,children:r})},he=({items:e,onDelete:r,onEdit:s,onToggleVisibility:i,onReorder:d,onItemSelect:c,selectedItem:g,selectedType:f,onApplyDamage:l,onApplyHealing:x,onApplyStressChange:u,onIncrement:n,onDecrement:p,isEditMode:m,elementType:a,adversaries:w=[]})=>{if(!e||e.length===0)return null;const b=I=>{const C={item:I,mode:"compact",onClick:()=>c(I,a),onDelete:r,dragAttributes:m?{draggable:!0}:null,dragListeners:m?{onDragStart:S=>{S.dataTransfer.setData("text/plain",I.id)}}:null,adversaries:w};switch(a){case"adversaries":return t.jsx(K,{...C,type:"adversary",onApplyDamage:l,onApplyHealing:x,onApplyStressChange:u},I.id);case"environments":return t.jsx(K,{...C,type:"environment",onEdit:s},I.id);case"countdowns":return t.jsx(K,{...C,type:"countdown",onIncrement:n,onDecrement:p},I.id);default:return null}};return t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:e.map(b)})},J=({elementType:e,title:r,sectionKey:s,items:i=[],sectionVisibility:d,toggleSection:c,adversaries:g=[],onOpenDatabase:f,onDeleteItem:l,onEditItem:x,onToggleVisibility:u,onReorder:n,onItemSelect:p,selectedItem:m,selectedType:a,isEditMode:w,onApplyDamage:b,onApplyHealing:I,onApplyStressChange:C,onIncrement:S,onDecrement:B,showInlineCreator:P,onToggleInlineCreator:N,onCreateCountdown:W,fear:V,updateFear:A,handleRollOutcome:R,handleActionRoll:F,showLongTermCountdowns:O,setShowLongTermCountdowns:h,onRestTrigger:M,triggers:D})=>{const o=i&&i.length>0,v=!!(d!=null&&d[s]);return t.jsxs("div",{style:{marginBottom:"0.75rem"},children:[t.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.25rem",position:"relative"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",position:"relative",width:"100%"},children:[t.jsxs("button",{onClick:()=>c(s),title:o?v?"Collapse section":"Expand section":"No items to expand",disabled:!o,style:{display:"flex",alignItems:"center",gap:"0.75rem",background:"none",border:"none",color:o?"var(--text-primary)":"var(--text-secondary)",cursor:o?"pointer":"default",padding:"0.125rem 0.25rem",fontSize:"inherit",fontWeight:"inherit",transition:"opacity 0.2s ease",borderRadius:"var(--radius-sm)",opacity:o?1:.6},children:[o?t.jsx("div",{style:{width:"16px",height:"16px",transition:"transform 0.2s ease",transform:v?"rotate(0deg)":"rotate(-90deg)"},children:t.jsx(Pe,{size:16})}):t.jsx("div",{style:{width:"16px",height:"16px",flexShrink:0}}),t.jsx("h3",{style:{fontSize:"var(--text-base)",fontWeight:600,color:"var(--text-primary)",margin:0,padding:0,lineHeight:1.2,textTransform:"uppercase",letterSpacing:"0.05em",whiteSpace:"nowrap",width:"140px",flexShrink:0,textAlign:"left"},children:r})]}),t.jsx("button",{className:"btn-icon","data-color":"purple",onClick:()=>f(e),title:`Browse ${r}`,"aria-label":`Browse ${r}`,children:t.jsx(Z,{size:16})})]})}),e==="countdowns"&&(P==null?void 0:P.campaign)&&t.jsxs("div",{className:"inline-countdown-creator",children:[t.jsx("p",{children:"Inline Countdown Creator - Coming Soon"}),t.jsx("button",{className:"btn-text",onClick:()=>N("campaign"),children:"Cancel"})]}),e==="countdowns"&&v&&i&&i.length>0&&t.jsx("div",{className:"countdown-trigger-controls",children:t.jsx("p",{children:"Countdown Trigger Controls - Coming Soon"})}),v&&t.jsx(he,{items:i,onDelete:j=>l(j,e),onEdit:j=>x(j,e),onToggleVisibility:u,onReorder:n,onItemSelect:p,selectedItem:m,selectedType:a,onApplyDamage:b,onApplyHealing:I,onApplyStressChange:C,onIncrement:S,onDecrement:B,isEditMode:w,elementType:e,adversaries:g}),e==="countdowns"&&v&&O&&i&&i.filter(j=>j.type==="long-term").length>0&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"long-term-rest-controls",children:[t.jsxs("button",{className:"btn-text",onClick:j=>{j.stopPropagation(),M("short")},title:"Short Rest",children:[t.jsx(ae,{size:16})," Short Rest"]}),t.jsxs("button",{className:"btn-text",onClick:j=>{j.stopPropagation(),M("long")},title:"Long Rest",children:[t.jsx(ae,{size:16})," Long Rest"]})]}),t.jsx(he,{items:i.filter(j=>j.type==="long-term"),onDelete:j=>l(j,e),onEdit:j=>x(j,e),onReorder:n,onItemSelect:p,selectedItem:m,selectedType:a,onIncrement:S,onDecrement:B,isEditMode:w,elementType:e})]})]})},ot=({onItemSelect:e,selectedItem:r,selectedType:s,onOpenDatabase:i,isEditMode:d,showLongTermCountdowns:c,fear:g,updateFear:f,handleRollOutcome:l,handleActionRoll:x,setShowLongTermCountdowns:u,lastAddedItemType:n})=>{const{adversaries:p,environments:m,updateAdversary:a,deleteAdversary:w,reorderAdversaries:b,updateEnvironment:I,deleteEnvironment:C,reorderEnvironments:S,countdowns:B,createCountdown:P,deleteCountdown:N,reorderCountdowns:W,incrementCountdown:V,decrementCountdown:A}=je(),[R,F]=y.useState({adversary:!1,environment:!1,campaign:!1}),[O,h]=Ze("sectionVisibility",{countdowns:!1,environments:!1,adversaries:!1});y.useEffect(()=>{n&&(n==="environment"?h(k=>({...k,environments:!0})):n==="adversary"?h(k=>({...k,adversaries:!0})):n==="countdown"&&h(k=>({...k,countdowns:!0})))},[n,h]);const M=k=>{const E=k==="adversaries"?p:k==="environments"?m:k==="countdowns"?B:[];E&&E.length>0&&h(T=>({...T,[k]:!T[k]}))},D=(k,E)=>{},o=k=>{F(E=>({...E,[k]:!E[k]}))},v=k=>{P(k),F(E=>({...E,[k.source]:!1})),h(E=>({...E,countdowns:!0}))},j=k=>{i(k)},$=(k,E)=>{E==="environment"?C(k):E==="adversary"?w(k):E==="countdown"&&N(k),r&&r.id===k&&e(null,null)},X=k=>{};return t.jsxs("div",{style:{flex:1,overflowY:"auto"},children:[t.jsx(J,{elementType:"countdowns",title:"Countdowns",sectionKey:"countdowns",items:B,sectionVisibility:O,toggleSection:M,adversaries:p,showInlineCreator:R,onToggleInlineCreator:o,onCreateCountdown:v,fear:g,updateFear:f,handleRollOutcome:l,handleActionRoll:x,showLongTermCountdowns:c,setShowLongTermCountdowns:u,onDeleteItem:$,onEditItem:D,onReorder:W,onItemSelect:e,selectedItem:r,selectedType:s,onIncrement:V,onDecrement:A,isEditMode:d,onRestTrigger:X}),t.jsx(J,{elementType:"environments",title:"Environments",sectionKey:"environments",items:m,sectionVisibility:O,toggleSection:M,adversaries:p,onOpenDatabase:j,onDeleteItem:$,onEditItem:D,onToggleVisibility:k=>{const E=m.find(T=>T.id===k);E&&I(k,{isVisible:!E.isVisible})},onReorder:S,onItemSelect:e,selectedItem:r,selectedType:s,isEditMode:d}),t.jsx(J,{elementType:"adversaries",title:"Adversaries",sectionKey:"adversaries",items:p,sectionVisibility:O,toggleSection:M,adversaries:p,onOpenDatabase:j,onDeleteItem:$,onEditItem:D,onToggleVisibility:k=>{const E=p.find(T=>T.id===k);E&&a(k,{isVisible:!E.isVisible})},onReorder:b,onItemSelect:e,selectedItem:r,selectedType:s,onApplyDamage:(k,E,T,_)=>{const z=Math.min(_,T+E);a(k,{hp:z})},onApplyHealing:(k,E,T)=>{if(p.find(z=>z.id===k)){const z=Math.max(0,T-E);a(k,{hp:z})}},onApplyStressChange:(k,E)=>{const T=p.find(_=>_.id===k);if(T){let _=T.stress+E,z=T.hp||0;if(_>T.stressMax){const q=_-T.stressMax;_=T.stressMax,z=Math.min(T.hpMax,z+q)}else _<0&&(_=0);a(k,{stress:_,hp:z})}},isEditMode:d})]})};function st({headerSelector:e=".drawer-header",closeThreshold:r=100,snapThreshold:s=30,onClose:i}={}){const[d,c]=y.useState(null),[g,f]=y.useState(null),[l,x]=y.useState(0),[u,n]=y.useState(!1),p=y.useCallback(b=>{var B,P;const I=b.target;if(!(e?I.closest(e):!1))return;const S=((P=(B=b.targetTouches)==null?void 0:B[0])==null?void 0:P.clientY)??0;c(S),f(S),x(0),n(!1)},[e]),m=y.useCallback(b=>{var B,P;if(d==null)return;const I=((P=(B=b.targetTouches)==null?void 0:B[0])==null?void 0:P.clientY)??0,C=I-d,S=6;!u&&Math.abs(C)>S&&n(!0),u&&(b.preventDefault(),b.stopPropagation(),f(I),x(Math.max(0,C)))},[d,u]),a=y.useCallback(b=>{if(d==null||g==null)return;const I=g-d;u?(b.preventDefault(),b.stopPropagation(),I>r?(x(window.innerHeight),typeof i=="function"&&setTimeout(()=>i(),300)):I>s?(x(0),setTimeout(()=>{c(null),f(null),n(!1)},50)):(x(0),c(null),f(null),n(!1))):(x(0),c(null),f(null),n(!1))},[d,g,u,r,s,i]),w=y.useCallback(()=>{x(0),c(null),f(null)},[]);return{drawerOffset:l,setDrawerOffset:x,touchHandlers:{onTouchStart:p,onTouchMove:m,onTouchEnd:a},resetSwipeState:w}}const at=({isOpen:e,onClose:r,children:s})=>{const{drawerOffset:i,setDrawerOffset:d,touchHandlers:c,resetSwipeState:g}=st({headerSelector:".drawer-header",closeThreshold:100,snapThreshold:30,onClose:r});return t.jsx("div",{className:"mobile-drawer",children:t.jsxs("div",{className:"drawer-content",style:{transform:`translateY(${i}px)`,transition:i===0?"transform 0.3s ease-out":"none"},...c,children:[t.jsx("div",{className:"drawer-header",children:"Mobile Drawer - Coming Soon"}),s]})})},it=()=>t.jsx("div",{className:"pwa-install-prompt",style:{}}),lt="modulepreload",dt=function(e){return"/Daggerheart/"+e},fe={},xe=function(r,s,i){if(!s||s.length===0)return r();const d=document.getElementsByTagName("link");return Promise.all(s.map(c=>{if(c=dt(c),c in fe)return;fe[c]=!0;const g=c.endsWith(".css"),f=g?'[rel="stylesheet"]':"";if(!!i)for(let u=d.length-1;u>=0;u--){const n=d[u];if(n.href===c&&(!g||n.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${f}`))return;const x=document.createElement("link");if(x.rel=g?"stylesheet":lt,g||(x.as="script",x.crossOrigin=""),x.href=c,document.head.appendChild(x),g)return new Promise((u,n)=>{x.addEventListener("load",u),x.addEventListener("error",()=>n(new Error(`Unable to preload CSS for ${c}`)))})})).then(()=>r()).catch(c=>{const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=c,window.dispatchEvent(g),!g.defaultPrevented)throw c})};let ke={adversaries:[]},Se={environments:[]};const ct=async()=>{try{const e=await xe(()=>import("./adversaries-39098dcd.js"),[]);ke=(e==null?void 0:e.default)||e}catch(e){console.warn("Failed to load adversaries.json:",e)}try{const e=await xe(()=>import("./environments-f019e73d.js"),[]);Se=(e==null?void 0:e.default)||e}catch(e){console.warn("Failed to load environments.json:",e)}},pt=e=>{const[r,s]=y.useState(""),[i,d]=y.useState([{field:"name",direction:"asc"}]),[c,g]=y.useState(null),[f,l]=y.useState([]),[x,u]=y.useState(!0),[n,p]=y.useState([]),[m,a]=y.useState([]),[w,b]=y.useState(!1),[I,C]=y.useState(!1),S=y.useRef(null),B=y.useRef(null);y.useEffect(()=>{(async()=>{await ct(),u(!1);let v=[];e==="adversary"?v=ke.adversaries||[]:e==="environment"&&(v=Se.environments||[]),l(v)})()},[e]);const P=o=>{const v=f.map(j=>j[o]).filter(Boolean);return[...new Set(v)].sort((j,$)=>typeof j=="number"&&typeof $=="number"?j-$:String(j).localeCompare(String($)))},N=P("tier"),W=P("type"),V=y.useMemo(()=>{let o=f.filter(v=>{var k,E;const j=v.name.toLowerCase().includes(r.toLowerCase())||((k=v.type)==null?void 0:k.toLowerCase().includes(r.toLowerCase()))||((E=v.description)==null?void 0:E.toLowerCase().includes(r.toLowerCase())),$=n.length===0||n.includes(v.tier.toString()),X=m.length===0||m.includes(v.type);return j&&$&&X});return o.sort((v,j)=>{for(const $ of i){const{field:X,direction:k}=$;let E=v[X],T=j[X];if(X==="tier")E=parseInt(E)||0,T=parseInt(T)||0;else if(X==="difficulty"){const _=parseInt(E),z=parseInt(T);!isNaN(_)&&!isNaN(z)?(E=_,T=z):!isNaN(_)&&isNaN(z)?(E=_,T=999):isNaN(_)&&!isNaN(z)?(E=999,T=z):(E=String(E||"").toLowerCase(),T=String(T||"").toLowerCase())}else typeof E=="string"&&typeof T=="string"?(E=E.toLowerCase(),T=T.toLowerCase()):(E=String(E||"").toLowerCase(),T=String(T||"").toLowerCase());if(k==="asc"){if(E>T)return 1;if(E<T)return-1}else{if(E<T)return 1;if(E>T)return-1}}return 0}),o},[f,r,i,n,m]),A=o=>{d(v=>{const j=v.findIndex($=>$.field===o);if(j>=0)if(j===0){const $=[...v];return $[0]={...$[0],direction:$[0].direction==="asc"?"desc":"asc"},$}else{const $=[...v];return $.splice(j,1)[0],[{field:o,direction:"asc"},...$]}else return[{field:o,direction:"asc"},...v]})},R=o=>{g(c===o?null:o)},F=o=>{p(o==="clear"?[]:v=>v.includes(o)?v.filter(j=>j!==o):[...v,o])},O=o=>{a(o==="clear"?[]:v=>v.includes(o)?v.filter(j=>j!==o):[...v,o])},h=n.length>0,M=m.length>0;return y.useEffect(()=>{const o=j=>{const $=j.target.closest(".filter-dropdown"),X=j.target.closest(".header-filter-icon");$||X||(b(!1),C(!1))},v=j=>{j.key==="Escape"&&(b(!1),C(!1))};return document.addEventListener("pointerdown",o,!0),document.addEventListener("mousedown",o,!0),document.addEventListener("touchstart",o,!0),document.addEventListener("click",o,!0),document.addEventListener("keydown",v,!0),()=>{document.removeEventListener("pointerdown",o,!0),document.removeEventListener("mousedown",o,!0),document.removeEventListener("touchstart",o,!0),document.removeEventListener("click",o,!0),document.removeEventListener("keydown",v,!0)}},[b,C]),{searchTerm:r,setSearchTerm:s,sortFields:i,handleSort:A,expandedCard:c,toggleExpanded:R,filteredAndSortedData:V,loading:x,selectedTiers:n,selectedTypes:m,showTierDropdown:w,setShowTierDropdown:b,showTypeDropdown:I,setShowTypeDropdown:C,tierFilterRef:S,typeFilterRef:B,uniqueTiers:N,uniqueTypes:W,handleTierSelect:F,handleTypeSelect:O,isTierFiltered:h,isTypeFiltered:M,getDropdownStyle:o=>{if(!o.current)return{};const v=o.current.getBoundingClientRect();return{position:"fixed",top:v.bottom+4,left:v.left,zIndex:99999}}}},ut=({searchTerm:e,onSearchChange:r,type:s})=>t.jsx("div",{style:L.browserHeader,children:t.jsx("input",{type:"text",placeholder:"Search",value:e,onChange:i=>r(i.target.value),style:L.searchInput})}),ht=({sortFields:e,onSort:r,type:s,uniqueTiers:i,uniqueTypes:d,selectedTiers:c,selectedTypes:g,showTierDropdown:f,setShowTierDropdown:l,showTypeDropdown:x,setShowTypeDropdown:u,tierFilterRef:n,typeFilterRef:p,handleTierSelect:m,handleTypeSelect:a,isTierFiltered:w,isTypeFiltered:b,getDropdownStyle:I})=>{const[C,S]=y.useState(null),P=(()=>s==="adversary"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:s==="environment"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:[])(),N=(W,V,A,R,F,O,h,M)=>{if(!F)return null;const D=()=>{(W==="tier"||W==="type")&&R("clear")};return ge.createPortal(t.jsxs("div",{className:"filter-dropdown",style:{...L.filterDropdown,...I(h),maxHeight:"60vh",overflow:"auto"},onMouseDown:o=>o.stopPropagation(),onClick:o=>o.stopPropagation(),children:[t.jsxs("div",{style:{...L.filterOption,...A.length===0?L.filterOptionSelected:{}},onClick:D,children:[t.jsx("span",{style:L.checkIcon,children:A.length===0?t.jsx(ie,{size:16}):t.jsx(le,{size:16})}),t.jsx("span",{style:L.filterLabel,children:"All"})]}),V.map(o=>{const v=A.includes(o.toString());return t.jsxs("div",{style:{...L.filterOption,...v?L.filterOptionSelected:{}},onClick:()=>R(o.toString()),children:[t.jsx("span",{style:L.checkIcon,children:v?t.jsx(ie,{size:16}):t.jsx(le,{size:16})}),t.jsx("span",{style:L.filterLabel,children:o})]},o)})]}),document.body)};return t.jsx("tr",{style:L.tableHeader,children:P.map(W=>t.jsxs("th",{style:{...L.tableHeaderCell,...C===W.key?L.tableHeaderCellHover:{},position:"relative",...W.key==="name"?{width:"auto",minWidth:"0"}:{},...W.key==="tier"?{width:"80px",minWidth:"80px",maxWidth:"80px"}:{},...W.key==="type"?{width:"100px",minWidth:"100px",maxWidth:"100px"}:{},...W.key==="difficulty"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...W.key==="action"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{}},onClick:()=>r(W.key),onMouseEnter:()=>S(W.key),onMouseLeave:()=>S(null),children:[W.hasFilter?t.jsxs("div",{style:L.headerWithFilter,children:[t.jsx("span",{style:{cursor:"pointer"},onClick:V=>{V.stopPropagation(),r(W.key)},children:W.label}),t.jsxs("button",{ref:W.key==="tier"?n:p,style:{...L.headerFilterIcon,...W.key==="tier"&&w?L.headerFilterIconActive:{},...W.key==="type"&&b?L.headerFilterIconActive:{}},className:"header-filter-icon",onClick:V=>{V.stopPropagation(),W.key==="tier"?(l(!f),u(!1)):W.key==="type"&&(u(!x),l(!1))},children:[t.jsx(He,{size:14}),W.key==="tier"&&w||W.key==="type"&&b?t.jsx("span",{style:L.filterActiveDot}):null]})]}):W.label,W.key==="tier"&&N("tier",i,c,m,f,l,n),W.key==="type"&&N("type",d,g,a,x,u,p)]},W.key))})},ft=({item:e,isExpanded:r,onToggleExpanded:s,onAdd:i,type:d})=>{const[c,g]=y.useState(!1),f=()=>{i(e)},l=()=>d==="adversary"?t.jsxs(t.Fragment,{children:[t.jsx("td",{style:{...L.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:e.name}),t.jsx("td",{style:{...L.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:e.tier}),t.jsx("td",{style:{...L.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:e.type}),t.jsx("td",{style:{...L.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:e.difficulty})]}):d==="environment"?t.jsxs(t.Fragment,{children:[t.jsx("td",{style:{...L.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:e.name}),t.jsx("td",{style:{...L.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:e.tier}),t.jsx("td",{style:{...L.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:e.type}),t.jsx("td",{style:{...L.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:e.difficulty})]}):null;return t.jsxs(t.Fragment,{children:[t.jsxs("tr",{style:{...L.row,...c?L.rowHover:{}},onClick:()=>s(e.id),onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:[l(),t.jsx("td",{style:{width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",boxSizing:"border-box",overflow:"visible",textOverflow:"unset",whiteSpace:"nowrap"},children:t.jsx("button",{style:L.addButton,onClick:x=>{x.stopPropagation(),f()},onMouseEnter:x=>{x.target.style.background="var(--gray-dark)"},onMouseLeave:x=>{x.target.style.background="var(--purple)"},children:"+"})})]}),r&&t.jsx("tr",{style:L.expandedRow,children:t.jsx("td",{colSpan:"5",style:L.expandedContent,children:t.jsx(K,{item:e,type:d,mode:"expanded",onClick:()=>{},onDelete:()=>{}})})})]})},xt=({type:e,onAddItem:r,onCancel:s})=>{const{searchTerm:i,setSearchTerm:d,sortFields:c,handleSort:g,expandedCard:f,toggleExpanded:l,filteredAndSortedData:x,loading:u,selectedTiers:n,selectedTypes:p,showTierDropdown:m,setShowTierDropdown:a,showTypeDropdown:w,setShowTypeDropdown:b,tierFilterRef:I,typeFilterRef:C,uniqueTiers:S,uniqueTypes:B,handleTierSelect:P,handleTypeSelect:N,isTierFiltered:W,isTypeFiltered:V,getDropdownStyle:A}=pt(e);return u?t.jsx("div",{style:L.browser,children:t.jsx("div",{style:L.loading,children:"Loading..."})}):t.jsxs("div",{style:L.browserWrapper,children:[t.jsx(ut,{searchTerm:i,onSearchChange:d,type:e}),t.jsx("div",{className:"browser-content",style:L.browserContent,children:t.jsxs("table",{style:L.browserTable,children:[t.jsx("thead",{children:t.jsx(ht,{sortFields:c,onSort:g,type:e,uniqueTiers:S,uniqueTypes:B,selectedTiers:n,selectedTypes:p,showTierDropdown:m,setShowTierDropdown:a,showTypeDropdown:w,setShowTypeDropdown:b,tierFilterRef:I,typeFilterRef:C,handleTierSelect:P,handleTypeSelect:N,isTierFiltered:W,isTypeFiltered:V,getDropdownStyle:A})}),t.jsx("tbody",{children:x.map(R=>t.jsx(ft,{item:R,isExpanded:f===R.id,onToggleExpanded:l,onAdd:r,type:e},R.id))})]})})]})},L={browserWrapper:{display:"flex",flexDirection:"column",background:"var(--bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border)",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserContent:{flex:1,overflowY:"auto",overflowX:"visible",padding:0,width:"100%"},tableHeaderContainer:{flexShrink:0,position:"sticky",top:0,zIndex:15,backgroundColor:"#1a1a1a"},browserTable:{width:"100%",minWidth:"100%",borderCollapse:"collapse",tableLayout:"fixed",background:"var(--bg-primary)",margin:0},browserHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-secondary)",flexShrink:0,position:"sticky",top:0,zIndex:20},browserTitle:{margin:0,color:"var(--text-primary)",fontSize:"18px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"24px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"14px",marginRight:"12px",transition:"all 0.2s ease"},searchInputFocus:{outline:"none",borderColor:"#8b5cf6",boxShadow:"0 0 0 3px rgba(139, 92, 246, 0.1)"},tableHeader:{background:"#1a1a1a",borderBottom:"1px solid var(--border)",boxShadow:"0 1px 0 var(--border)",position:"sticky",top:"0",zIndex:10},tableHeaderCell:{backgroundColor:"#1a1a1a",fontWeight:"700",borderBottom:"1px solid var(--border)",cursor:"pointer",userSelect:"none",minWidth:"100px",whiteSpace:"nowrap",padding:"4px 4px",color:"var(--text-primary)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",boxShadow:"0 1px 0 var(--border)",transition:"background-color 0.2s",position:"sticky",top:"0",zIndex:10},tableHeaderCellHover:{backgroundColor:"var(--bg-hover)"},sortIndicator:{fontSize:"12px",color:"#4a90e2"},tableBody:{flex:1,overflowY:"auto",padding:"8px",backgroundColor:"#1a1a1a"},row:{height:"35px",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s ease",cursor:"pointer"},rowHover:{backgroundColor:"var(--bg-hover)"},expandedRow:{backgroundColor:"var(--bg-secondary)"},rowCell:{padding:"4px 4px",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid var(--border)"},rowCellName:{fontWeight:"500",minWidth:"150px"},rowCellCenter:{textAlign:"center",justifyContent:"center",minWidth:"80px"},rowActions:{width:"80px",textAlign:"center",padding:"4px 8px",borderBottom:"1px solid var(--border)"},addButton:{width:"1.5rem",height:"1.5rem",border:"1px solid var(--purple)",borderRadius:"var(--radius-sm)",background:"var(--purple)",color:"white",cursor:"pointer",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"500"},expandedContent:{padding:"16px",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)"},columnName:{width:"auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",paddingLeft:"8px",textAlign:"left"},columnTier:{width:"80px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnType:{width:"100px",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},columnDifficulty:{width:"40px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnAction:{width:"24px",minWidth:"24px",maxWidth:"24px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"visible",textOverflow:"unset"},loading:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"#fff",fontSize:"16px"},mobileBrowser:{width:"95vw",height:"90vh",maxWidth:"none"},mobileSearchInput:{fontSize:"16px"},headerWithFilter:{display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",position:"relative"},headerFilterIcon:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"2px 4px",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",position:"relative"},headerFilterIconActive:{color:"var(--purple)"},filterIcon:{fontSize:"12px"},filterActiveDot:{position:"absolute",left:"50%",top:"2px",transform:"translateX(-50%)",width:"4px",height:"4px",borderRadius:"50%",background:"var(--purple)",pointerEvents:"none"},filterDropdown:{position:"absolute",top:"100%",left:"0",background:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",zIndex:99999,marginTop:"4px",overflow:"hidden",width:"max-content",minWidth:"120px",maxWidth:"200px"},filterOption:{padding:"8px 12px",cursor:"pointer",color:"var(--text-primary)",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background-color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},filterOptionSelected:{backgroundColor:"var(--bg-hover)"},checkIcon:{width:"16px",height:"16px",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"12px"},filterLabel:{flex:1}};function gt({selectedItem:e,selectedType:r,countdowns:s,adversaries:i,environments:d,setSelectedItem:c,handleCloseRightColumn:g}){y.useEffect(()=>{if(!e||!r)return;let f=!1;r==="adversaries"||r==="adversary"?f=i.some(l=>l.id===e.id):r==="environments"||r==="environment"?f=d.some(l=>l.id===e.id):(r==="countdowns"||r==="countdown")&&(f=s.some(l=>l.id===e.id)),f||g()},[e,r,s,i,d,c,g]),y.useEffect(()=>{if(!e||!r)return;let f=null;r==="adversaries"||r==="adversary"?f=i.find(l=>l.id===e.id):r==="environments"||r==="environment"?f=d.find(l=>l.id===e.id):(r==="countdowns"||r==="countdown")&&(f=s.find(l=>l.id===e.id)),f&&JSON.stringify(f)!==JSON.stringify(e)&&c(f)},[e,r,s,i,d,c])}class mt extends re.Component{constructor(r){super(r),this.state={hasError:!1,error:null}}static getDerivedStateFromError(r){return{hasError:!0,error:r}}componentDidCatch(r,s){console.error("ErrorBoundary caught an error:",r,s)}render(){var r;return this.state.hasError?t.jsxs("div",{className:"p-md text-red",children:[t.jsx("h3",{children:"Something went wrong:"}),t.jsx("pre",{children:(r=this.state.error)==null?void 0:r.toString()}),t.jsx("button",{className:"btn-base btn-text",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try again"})]}):this.props.children}}const yt=()=>{const{adversaries:e,environments:r,countdowns:s,fear:i,updateFear:d,createAdversary:c,updateAdversary:g,deleteAdversary:f,createEnvironment:l,updateEnvironment:x,deleteEnvironment:u,createCountdown:n,deleteCountdown:p,advanceCountdown:m}=je(),[a,w]=y.useState(null),[b,I]=y.useState(null),[C,S]=y.useState(null),[B,P]=y.useState("unified"),[N,W]=y.useState(!1),[V,A]=y.useState(!1),[R]=y.useState("left"),[F,O]=y.useState(!0);y.useState(!1);const[h,M]=y.useState(null),[D,o]=y.useState(!1),v=(z,q)=>{y.startTransition(()=>{a&&a.id===z.id&&b===q&&C==="item"?(w(null),I(null),S(null),N&&o(!1)):(w(z),I(q),S("item"),N&&o(!0))})},j=(z="unified")=>{let q=z;z==="adversaries"?q="adversary":z==="environments"&&(q="environment"),C==="database"&&B===q?y.startTransition(()=>{S(null),P("unified"),N&&o(!1)}):y.startTransition(()=>{P(q),S("database"),N&&o(!0)})},$=z=>{s.forEach(q=>{const Y=Ge(q,z);if(Y>0){const Ee=q.value||0;m(q.id,Ee+Y)}})},X=()=>{s.forEach(z=>{const q=Ke(z);if(q>0){const Y=z.value||0;m(z.id,Y+q)}})},k=y.useCallback(()=>{S(null),w(null),I(null),N&&o(!1)},[N]);y.useEffect(()=>{const z=()=>{const q=N,Y=window.innerWidth<=800;W(Y),!q&&Y&&(C==="database"||C==="creator"||C==="item")&&o(!0),q&&!Y&&D&&o(!1)};return z(),window.addEventListener("resize",z),()=>window.removeEventListener("resize",z)},[N,C,D]),y.useEffect(()=>(D||N&&a?(document.body.classList.add("mobile-drawer-open"),document.documentElement.classList.add("mobile-drawer-open")):(document.body.classList.remove("mobile-drawer-open"),document.documentElement.classList.remove("mobile-drawer-open")),()=>{document.body.classList.remove("mobile-drawer-open"),document.documentElement.classList.remove("mobile-drawer-open")}),[N,D,a]),gt({selectedItem:a,selectedType:b,countdowns:s,adversaries:e,environments:r,setSelectedItem:w,handleCloseRightColumn:k});const{handleAdversaryDamage:E,handleAdversaryHealing:T,handleAdversaryStressChange:_}=Ue({adversaries:e,updateAdversary:g,deleteAdversary:f,selectedItem:a,setSelectedItem:w});return t.jsxs("div",{className:"app",onClick:z=>{z.target===z.currentTarget&&k()},children:[t.jsx(pe,{position:"top",style:{display:"flex",alignItems:"center",justifyContent:"center",height:"var(--topbar-height)",touchAction:"manipulation",userSelect:"none"},children:t.jsx(G,{type:"fear",value:(i==null?void 0:i.value)||0,maxValue:12,onChange:d,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0})}),t.jsx("div",{className:"bottom-bar-container",children:t.jsxs(pe,{position:"bottom",children:[t.jsx(nt,{isEditMode:V,setIsEditMode:A}),t.jsx(rt,{adversaries:e,environments:r,countdowns:s,deleteAdversary:f,deleteEnvironment:u,deleteCountdown:p}),t.jsx(tt,{})]})}),t.jsxs("div",{className:"main-content",children:[t.jsx(ue,{side:"left",className:`${N&&R==="right"?"mobile-hidden":""}`,children:t.jsx(ot,{onItemSelect:v,onOpenDatabase:j,isEditMode:V,onEditModeChange:A,showLongTermCountdowns:F,fear:i,updateFear:d,handleRollOutcome:$,handleActionRoll:X,setShowLongTermCountdowns:O,lastAddedItemType:h})}),t.jsxs(ue,{side:"right",className:`${N&&R==="left"?"mobile-hidden":""}`,style:C==="database"?{overflowY:"hidden"}:{},children:[C==="database"&&t.jsx("div",{className:"database-display",children:t.jsx(xt,{type:B,onAddItem:z=>{B==="adversary"?(c(z),M("adversary")):B==="environment"&&(l(z),M("environment"))},onCancel:k})}),C==="item"&&a&&t.jsx(K,{type:b,item:a,mode:V?"edit":"expanded",onApplyDamage:E,onApplyHealing:T,onApplyStressChange:_,onUpdate:b==="adversaries"?g:b==="environments"?x:updateCountdown,adversaries:e}),!C&&t.jsx("div",{})]})]},`mobile-${N}`),N&&t.jsx(at,{isOpen:D,onClose:k}),t.jsx(it,{})]})},vt=()=>t.jsx(mt,{children:t.jsx(Ce,{children:t.jsx(yt,{})})});ee.createRoot(document.getElementById("root")).render(t.jsx(re.StrictMode,{children:t.jsx(Ce,{children:t.jsx(vt,{})})}));
