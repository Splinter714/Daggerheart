import{r as A,a as et,R as ke}from"./dndkit-57209f9c.js";import{F as vt,f as bt,a as wt,b as jt,c as ot}from"./fa-b4bcccb0.js";import{D as xt,A as Ct,X as Ge,B as St,H as kt,L as It,C as Et,F as At,S as $e,a as Ve,M as at,P as it}from"./lucide-44bdca53.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))p(b);new MutationObserver(b=>{for(const l of b)if(l.type==="childList")for(const f of l.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&p(f)}).observe(document,{childList:!0,subtree:!0});function c(b){const l={};return b.integrity&&(l.integrity=b.integrity),b.referrerPolicy&&(l.referrerPolicy=b.referrerPolicy),b.crossOrigin==="use-credentials"?l.credentials="include":b.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function p(b){if(b.ep)return;b.ep=!0;const l=c(b);fetch(b.href,l)}})();var ht={exports:{}},Xe={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Mt=A,zt=Symbol.for("react.element"),Wt=Symbol.for("react.fragment"),Tt=Object.prototype.hasOwnProperty,Rt=Mt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Bt={key:!0,ref:!0,__self:!0,__source:!0};function ft(e,a,c){var p,b={},l=null,f=null;c!==void 0&&(l=""+c),a.key!==void 0&&(l=""+a.key),a.ref!==void 0&&(f=a.ref);for(p in a)Tt.call(a,p)&&!Bt.hasOwnProperty(p)&&(b[p]=a[p]);if(e&&e.defaultProps)for(p in a=e.defaultProps,a)b[p]===void 0&&(b[p]=a[p]);return{$$typeof:zt,type:e,key:l,ref:f,props:b,_owner:Rt.current}}Xe.Fragment=Wt;Xe.jsx=ft;Xe.jsxs=ft;ht.exports=Xe;var t=ht.exports,tt={},lt=et;tt.createRoot=lt.createRoot,tt.hydrateRoot=lt.hydrateRoot;function Ie(e){const a=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return e?`${e}-${a}`:a}const gt=A.createContext();function Ke(e){if(typeof localStorage>"u")return null;try{const a=localStorage.getItem(e);return a==null?null:JSON.parse(a)}catch{return null}}function Me(e,a){if(!(typeof localStorage>"u"))try{localStorage.setItem(e,JSON.stringify(a))}catch{}}const Nt=({children:e})=>{const[a,c]=A.useState({fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],currentEncounterName:"Encounter"}),[p,b]=A.useState(!1),[l,f]=A.useState({adversaries:[],environments:[]});A.useEffect(()=>{var o,g,Z,se;const n=Ke("daggerheart-game-state");if(n)try{(((o=n.adversaries)==null?void 0:o.length)>0||((g=n.environments)==null?void 0:g.length)>0||((Z=n.countdowns)==null?void 0:Z.length)>0||((se=n.savedEncounters)==null?void 0:se.length)>0)&&c(n)}catch(G){console.error("Failed to load saved state:",G)}const d=Ke("daggerheart-custom-adversaries")||[],r=Ke("daggerheart-custom-environments")||[];f({adversaries:d,environments:r}),b(!0)},[]),A.useEffect(()=>{Me("daggerheart-game-state",a)},[a]);const L=n=>{c(d=>({...d,fear:{...d.fear,value:n}}))},m=()=>{c(n=>({...n,fear:{...n.fear,visible:!n.fear.visible}}))},R=n=>{c(d=>({...d,partySize:Math.max(1,n)}))},H=n=>{c(d=>({...d,currentEncounterName:n||"Encounter"}))},k=n=>{if(n.id)return c(d=>({...d,savedEncounters:(d.savedEncounters||[]).map(r=>r.id===n.id?{...r,name:n.name||r.name,encounterItems:n.encounterItems||r.encounterItems,partySize:n.partySize||r.partySize,battlePointsAdjustments:n.battlePointsAdjustments||r.battlePointsAdjustments,updatedAt:new Date().toISOString()}:r)})),n.id;{const d={id:Ie("encounter"),name:n.name||"Encounter",createdAt:new Date().toISOString(),encounterItems:n.encounterItems||[],partySize:n.partySize||4,battlePointsAdjustments:n.battlePointsAdjustments||{}};return c(r=>({...r,savedEncounters:[...r.savedEncounters||[],d]})),d.id}},Q=n=>(a.savedEncounters||[]).find(r=>r.id===n),C=n=>{const d={id:Ie("encounter"),name:n.name||`Encounter ${Date.now()}`,createdAt:new Date().toISOString(),encounterItems:n.encounterItems||[],partySize:n.partySize||4,battlePointsAdjustments:n.battlePointsAdjustments||{}};return c(r=>({...r,savedEncounters:[...r.savedEncounters||[],d]})),d.id},$=n=>{c(d=>({...d,savedEncounters:(d.savedEncounters||[]).filter(r=>r.id!==n)}))},ee=A.useRef(a);A.useEffect(()=>{ee.current=a},[a]);const v={gameState:a,isLoaded:p,customContent:l,updateFear:L,toggleFearVisibility:m,updatePartySize:R,updateCurrentEncounterName:H,saveEncounter:k,saveEncounterAs:C,loadEncounter:Q,deleteEncounter:$,createCountdown:n=>{const d={id:Ie("countdown"),name:n.name||"Countdown",max:parseInt(n.max)||1,value:0,visible:!0,type:n.type||"standard",loop:n.loop||"none",source:n.source||"campaign"};c(r=>({...r,countdowns:[...r.countdowns,d]}))},updateCountdown:(n,d)=>{c(r=>({...r,countdowns:r.countdowns.map(o=>o.id===n?{...o,...d}:o)}))},deleteCountdown:n=>{c(d=>({...d,countdowns:d.countdowns.filter(r=>r.id!==n)}))},advanceCountdown:(n,d)=>{c(r=>({...r,countdowns:r.countdowns.map(o=>{if(o.id!==n)return o;let g=d;if(o.loop==="loop")g>o.max?g=(g-1)%o.max+1:g<0&&(g=o.max);else if(o.loop==="increasing"){if(g>o.max)return{...o,max:o.max+1,value:1};if(g<0)return{...o,max:Math.max(1,o.max-1),value:1};g=Math.max(0,g)}else if(o.loop==="decreasing"){if(g>o.max)return{...o,max:Math.max(1,o.max-1),value:1};if(g<0)return{...o,max:o.max+1,value:1};g=Math.min(o.max,g)}else g=Math.max(0,Math.min(g,o.max));return{...o,value:g}})}))},incrementCountdown:(n,d=1)=>{c(r=>({...r,countdowns:r.countdowns.map(o=>{if(o.id!==n)return o;let g=o.value+d;if(o.loop==="loop")g>o.max&&(g=(g-1)%o.max+1);else if(o.loop==="increasing"){if(g>o.max)return{...o,max:o.max+1,value:1}}else if(o.loop==="decreasing"){if(g>o.max)return{...o,max:Math.max(1,o.max-1),value:1}}else g=Math.min(g,o.max);return{...o,value:g}})}))},decrementCountdown:n=>{c(d=>({...d,countdowns:d.countdowns.map(r=>{if(r.id!==n)return r;let o=r.value-1;if(r.loop==="loop")o<0&&(o=r.max);else if(r.loop==="increasing"){if(o<0)return{...r,max:Math.max(1,r.max-1),value:r.max};o=Math.max(0,o)}else if(r.loop==="decreasing"){if(o<0)return{...r,max:r.max+1,value:1}}else o=Math.max(0,o);return{...r,value:o}})}))},reorderCountdowns:n=>{c(d=>{const[r,o]=n,g=[...d.countdowns],[Z]=g.splice(r,1);return g.splice(o,0,Z),{...d,countdowns:g}})},createAdversary:n=>{var G;const d=Ie("adv"),r=a.adversaries||[],o=n.baseName||((G=n.name)==null?void 0:G.replace(/\s+\(\d+\)$/,""))||n.name||"Unknown",g=r.filter(U=>U.baseName===o);let Z=1;if(g.length===0)Z=1;else{const U=g.map(we=>we.duplicateNumber||1);let le=1;for(;U.includes(le);)le++;Z=le}const se={...n,id:d,baseName:o,duplicateNumber:Z,name:`${o} (${Z})`,hp:0,stress:0,isVisible:!0};c(U=>({...U,adversaries:[...U.adversaries,se]}))},createAdversariesBulk:n=>{const d=[],r={};n.forEach(o=>{var Ce;const g=o.baseName||((Ce=o.name)==null?void 0:Ce.replace(/\s+\(\d+\)$/,""))||o.name||"Unknown",G=(a.adversaries||[]).filter(Se=>Se.baseName===g).length,U=r[g]||0,le=G+U+1;r[g]=U+1;const we={...o,id:Ie("adv"),baseName:g,duplicateNumber:le,name:`${g} (${le})`,hp:0,stress:0,isVisible:!0};d.push(we)}),c(o=>({...o,adversaries:[...o.adversaries,...d]}))},updateAdversary:(n,d)=>{c(r=>({...r,adversaries:r.adversaries.map(o=>{if(o.id===n){const g={...o,...d};if(d.baseName!==void 0){const Z=d.baseName,se=g.duplicateNumber||1;g.name=se===1?Z:`${Z} (${se})`}return g}return o})}))},deleteAdversary:n=>{c(d=>({...d,adversaries:d.adversaries.filter(r=>r.id!==n)}))},clearAllAdversaries:()=>{c(n=>({...n,adversaries:[]}))},reorderAdversaries:n=>{c(d=>{const[r,o]=n,g=[...d.adversaries],[Z]=g.splice(r,1);return g.splice(o,0,Z),{...d,adversaries:g}})},bulkReorderAdversaries:n=>{c(d=>({...d,adversaries:n}))},createEnvironment:n=>{const d=Ie("env"),o=(a.environments||[]).filter(se=>se.name.replace(/\s+\(\d+\)$/,"")===n.name);let g=n.name||"Unknown";if(o.length===0)g=n.name;else if(o.length===1){const se=o[0],G=se.name.replace(/\s+\(\d+\)$/,""),U=a.environments.map(le=>le.id===se.id?{...le,name:`${G} (1)`}:le);c(le=>({...le,environments:U})),g=`${n.name} (2)`}else{const se=o.map(U=>{const le=U.name.match(/\((\d+)\)$/);return le?parseInt(le[1]):null}).filter(U=>U!==null);let G=1;for(;se.includes(G);)G++;g=`${n.name} (${G})`}const Z={...n,id:d,name:g,isVisible:!0};c(se=>({...se,environments:[...se.environments,Z]}))},updateEnvironment:(n,d)=>{c(r=>({...r,environments:r.environments.map(o=>o.id===n?{...o,...d}:o)}))},deleteEnvironment:n=>{c(d=>({...d,environments:d.environments.filter(r=>r.id!==n)}))},reorderEnvironments:n=>{c(d=>{const[r,o]=n,g=[...d.environments],[Z]=g.splice(r,1);return g.splice(o,0,Z),{...d,environments:g}})},addCustomAdversary:n=>{const d={...n,id:Ie("custom-adv"),source:n.source||"Homebrew",isCustom:!0};return f(r=>({...r,adversaries:[...r.adversaries,d]})),Me("daggerheart-custom-adversaries",[...l.adversaries,d]),d.id},addCustomEnvironment:n=>{const d={...n,id:Ie("custom-env"),source:n.source||"Homebrew",isCustom:!0};return f(r=>({...r,environments:[...r.environments,d]})),Me("daggerheart-custom-environments",[...l.environments,d]),d.id},updateCustomAdversary:(n,d)=>{f(o=>({...o,adversaries:o.adversaries.map(g=>g.id===n?{...g,...d}:g)}));const r=l.adversaries.map(o=>o.id===n?{...o,...d}:o);Me("daggerheart-custom-adversaries",r)},updateCustomEnvironment:(n,d)=>{f(o=>({...o,environments:o.environments.map(g=>g.id===n?{...g,...d}:g)}));const r=l.environments.map(o=>o.id===n?{...o,...d}:o);Me("daggerheart-custom-environments",r)},deleteCustomAdversary:n=>{f(r=>({...r,adversaries:r.adversaries.filter(o=>o.id!==n)}));const d=l.adversaries.filter(r=>r.id!==n);Me("daggerheart-custom-adversaries",d)},deleteCustomEnvironment:n=>{f(r=>({...r,environments:r.environments.filter(o=>o.id!==n)}));const d=l.environments.filter(r=>r.id!==n);Me("daggerheart-custom-environments",d)}};return t.jsx(gt.Provider,{value:v,children:e})},nt=()=>{const e=A.useContext(gt);if(!e)return console.warn("useGameState: Context not available yet, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{gameState:a,customContent:c,...p}=e;if(!a)return console.warn("useGameState: gameState not available, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],customContent:{adversaries:[],environments:[]},updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},addCustomAdversary:()=>{},addCustomEnvironment:()=>{},updateCustomAdversary:()=>{},updateCustomEnvironment:()=>{},deleteCustomAdversary:()=>{},deleteCustomEnvironment:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{fear:b,countdowns:l,adversaries:f,environments:L,partySize:m,savedEncounters:R}=a;return{gameState:a,fear:b,countdowns:l,adversaries:f,environments:L,partySize:m,savedEncounters:R,customContent:c,...p,hasCountdowns:l.length>0,hasAdversaries:f.length>0,hasEnvironments:L.length>0,getCountdownById:H=>l.find(k=>k.id===H),getAdversaryById:H=>f.find(k=>k.id===H),getEnvironmentById:H=>L.find(k=>k.id===H)}},dt={fear:{icon:bt,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"0.125rem",maxWidth:"none"},pipStyle:{fontSize:"var(--text-lg)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0,imageRendering:"crisp-edges"},filledColor:"var(--purple)",emptyColor:"var(--gray-dark)",tooltipTitle:"Click anywhere in header to adjust fear:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease fear by 1"},{text:"Right of boundary:",description:"Click to increase fear by 1"}]},hp:{icon:wt,maxValue:20,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stress:{icon:jt,maxValue:12,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},countdown:{icon:ot,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust countdown:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease countdown by 1"},{text:"Right of boundary:",description:"Click to increase countdown by 1"}]},hpDots:{maxValue:20,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--red)",borderColor:"var(--red)",boxShadow:"0 0 4px rgba(239, 68, 68, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stressDots:{maxValue:12,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--purple)",borderColor:"var(--purple)",boxShadow:"0 0 4px rgba(139, 92, 246, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},adversaryHP:{icon:xt,maxValue:20,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust HP:",tooltipInstructions:[{text:"Filled pip:",description:"Click to heal (reduce damage)"},{text:"Empty pip:",description:"Click to take damage"}]},adversaryStress:{icon:Ct,maxValue:12,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust stress:",tooltipInstructions:[{text:"Filled pip:",description:"Click to reduce stress"},{text:"Empty pip:",description:"Click to increase stress"}]},countdownDistributed:{icon:ot,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Countdown progress:",tooltipInstructions:[{text:"Progress:",description:"Current countdown value"}]}},Le=({type:e="fear",value:a=0,maxValue:c,onChange:p,size:b="lg",showTooltip:l=!0,containerStyle:f={},pipStyle:L={},countdownType:m=null,distributedGroups:R=null,onPipClick:H=null,enableBoundaryClick:k=!1,clickContainerWidth:Q="auto",centerPips:C=!0})=>{const[$,ee]=A.useState(!1),F=dt[e]||dt.fear,V=c||F.maxValue,q=Math.max(0,Math.min(V,a));let oe=F.filledColor;e==="countdown"&&m&&(["progress","dynamic-progress","simple-hope"].includes(m)?oe="var(--gold)":["consequence","dynamic-consequence","simple-fear"].includes(m)?oe="var(--purple)":["long-term","standard"].includes(m)&&(oe="var(--text-secondary)"));const E=(X,ne)=>{if(H)H(X,ne);else if(p){const ce=X+1;p(ce)}},ie=X=>{if(!k||!p||H)return;X.currentTarget.getBoundingClientRect();const ne=X.currentTarget.querySelector(".pip-container");if(!ne)return;const ce=ne.getBoundingClientRect(),y=X.clientX-ce.left;if(y<0){q>0&&p(q-1);return}if(y>ce.width){q<V&&p(q+1);return}const S=ce.width,j=S*.05,z=S-2*j,_=y-j,ae=q/V,T=z*ae;_<T?q>0&&p(q-1):q<V&&p(q+1)},ge=(()=>{if(!R||e!=="countdownDistributed")return[{start:0,end:V,groupIndex:0}];let X=0;return R.map((ne,ce)=>{const y={start:X,end:X+ne,groupIndex:ce};return X+=ne,y})})(),J=()=>t.jsxs(t.Fragment,{children:[ge.map(X=>t.jsx(ke.Fragment,{children:[...Array(X.end-X.start)].map((ne,ce)=>{const y=X.start+ce,S=y<q;if(F.isDots)return t.jsx("div",{style:{...F.pipStyle,...S?F.filledStyle:F.emptyStyle,...L,cursor:p||H?"pointer":"default"},onClick:k?void 0:()=>E(y,S),title:`${y+1} of ${V}`},y);{const j=F.icon,z=j&&typeof j=="object"&&j.iconName,_=S?oe:F.emptyColor;return t.jsx("span",{className:`fear-pip ${S?"filled":"empty"}`,style:{...F.pipStyle,color:_,cursor:p||H?"pointer":"default",...L},onClick:k?void 0:()=>E(y,S),title:`${y+1} of ${V}`,children:z?t.jsx(vt,{icon:j,size:b}):t.jsx(j,{size:b==="lg"?18:16})},y)}})},X.groupIndex)),l&&t.jsx("div",{style:{position:"relative",cursor:"help",pointerEvents:"none"},children:t.jsxs("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:$?"translateX(-50%) translateY(-5px)":"translateX(-50%)",background:"rgba(15, 23, 42, 0.95)",border:"1px solid var(--gray)",borderRadius:"var(--radius-md)",padding:"var(--space-md)",minWidth:"250px",zIndex:1e3,opacity:$?1:0,visibility:$?"visible":"hidden",transition:"all 0.2s ease",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.5)"},children:[t.jsx("div",{style:{fontWeight:600,color:"var(--gray-200)",marginBottom:"0.75rem",fontSize:"var(--text-sm)"},children:F.tooltipTitle}),F.tooltipInstructions.map((X,ne)=>t.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.8rem",color:"var(--gray-300)",lineHeight:1.4},children:[t.jsx("strong",{style:{color:"var(--gray-200)"},children:X.text})," ",X.description]},ne))]})})]});return t.jsx("div",{style:{width:Q,height:"100%",cursor:p||H?"pointer":"default",touchAction:"manipulation",userSelect:"none",display:C?"flex":"block",alignItems:C?"center":"stretch",justifyContent:C?"center":"flex-start",...f},onClick:X=>{X.stopPropagation(),X.preventDefault(),k&&ie(X)},onMouseEnter:()=>ee(l),onMouseLeave:()=>ee(!1),children:t.jsx("div",{className:"pip-container",style:{...F.containerStyle,width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},children:J()})})},Dt=({onToggle:e,isOpen:a})=>{const p={position:"fixed",bottom:window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://")?"calc(60px + env(safe-area-inset-bottom) + 2rem)":"calc(60px + env(safe-area-inset-bottom) + 1rem)",right:"1rem",zIndex:1100,width:"56px",height:"56px",borderRadius:"50%",background:a?"var(--red)":"var(--bg-secondary)",border:"2px solid var(--border)",color:a?"white":"var(--text-primary)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"all 0.2s ease"};return t.jsx("button",{onClick:e,style:p,title:a?"Close Encounter Builder":"Open Encounter Builder",onMouseEnter:b=>{a||(b.currentTarget.style.background="var(--purple)",b.currentTarget.style.color="white")},onMouseLeave:b=>{a||(b.currentTarget.style.background="var(--bg-secondary)",b.currentTarget.style.color="var(--text-primary)")},children:a?t.jsx(Ge,{size:24}):t.jsx(St,{size:24})})},Lt=({position:e="top",children:a,onClick:c,className:p="",style:b={}})=>{const l=e==="top",f=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://"),L={background:"var(--bg-primary)",borderTop:l?"none":"1px solid var(--border)",borderBottom:l?"1px solid var(--border)":"none",padding:l?"0.25rem 0":"0.5rem",paddingBottom:l?"0.25rem":f?"calc(0.5rem + env(safe-area-inset-bottom) + 1rem)":"calc(0.5rem + env(safe-area-inset-bottom))",position:l?"relative":"sticky",[l?"top":"bottom"]:0,zIndex:l?10:100,order:l?1:3,flexShrink:0,touchAction:"manipulation",userSelect:"none",display:"flex",flexDirection:l?"column":"row",justifyContent:l?"stretch":"center",alignItems:l?"stretch":"center",gap:l?"0":"1rem",height:l?"auto":"60px",...b};return t.jsx("div",{className:p,style:L,onClick:c,children:a})},ct=({value:e})=>t.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"44px",height:"32px",zIndex:3},children:[t.jsx("svg",{width:"40",height:"32",viewBox:"0 0 40 32",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",style:{position:"absolute",zIndex:1},children:t.jsx("path",{d:"M2 2h28l6 14-6 14H2l6-14-6-14z"})}),t.jsx("span",{style:{position:"absolute",fontSize:"0.8rem",fontWeight:500,color:"var(--text-primary)",textAlign:"center",zIndex:2,left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:e})]}),Pt=({type:e,tier:a,isEditMode:c,onUpdate:p,itemId:b})=>{const f=(k=>{if(!k)return 0;const C=document.createElement("canvas").getContext("2d");C.font="600 11px system-ui, -apple-system, sans-serif";const $=C.measureText(k.toUpperCase()).width;return console.log("Text measurement:",{text:k,font:C.font,width:$}),$})(e),L=4,m=18,R=Math.max(50,f+L+m),H=R+15;return c?t.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",gap:"8px",height:"32px"},children:[t.jsxs("select",{value:e||"",onChange:k=>{p&&p(b,{type:k.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",outline:"none",borderRadius:"4px",padding:"4px 8px",width:"95px",height:"24px"},children:[t.jsx("option",{value:"Standard",children:"Standard"}),t.jsx("option",{value:"Solo",children:"Solo"}),t.jsx("option",{value:"Bruiser",children:"Bruiser"}),t.jsx("option",{value:"Horde",children:"Horde"}),t.jsx("option",{value:"Minion",children:"Minion"}),t.jsx("option",{value:"Ranged",children:"Ranged"}),t.jsx("option",{value:"Leader",children:"Leader"}),t.jsx("option",{value:"Skulk",children:"Skulk"}),t.jsx("option",{value:"Social",children:"Social"}),t.jsx("option",{value:"Support",children:"Support"})]}),t.jsxs("div",{style:{position:"relative",width:"24px",height:"24px"},children:[t.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",width:"20px",height:"20px",backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",borderRadius:"2px"}}),t.jsx("input",{type:"text",value:a||"",onChange:k=>{const Q=k.target.value.replace(/[^1-4]/g,"");Q.length<=1&&p&&p(b,{tier:Q===""?"":parseInt(Q)})},onKeyDown:k=>{if(k.key==="ArrowUp"){k.preventDefault();const Q=parseInt(a)||1;p&&p(b,{tier:Math.min(Q+1,4)})}else if(k.key==="ArrowDown"){k.preventDefault();const Q=parseInt(a)||1;p&&p(b,{tier:Math.max(Q-1,1)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"transparent",border:"none",color:"var(--text-primary)",fontSize:"0.8rem",fontWeight:600,width:"24px",height:"24px",textAlign:"center",outline:"none",zIndex:1},maxLength:"1"})]})]}):t.jsxs("div",{style:{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"center",height:"32px",width:`${H}px`},children:[t.jsxs("svg",{width:H,height:"32",viewBox:`0 0 ${H} 32`,style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1},children:[t.jsx("rect",{x:"1",y:"6",width:R-1,height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4",ry:"4"}),t.jsx("rect",{x:R-10,y:"6",width:"20",height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"2",ry:"2",transform:`rotate(45 ${R-1} 16)`})]}),t.jsx("span",{style:{position:"absolute",top:"50%",left:"4px",transform:"translateY(-50%)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",color:"var(--text-primary)",zIndex:2,pointerEvents:"none"},children:e}),t.jsx("span",{style:{position:"absolute",top:"50%",left:`${R-.5}px`,transform:"translate(-50%, -50%)",fontSize:"0.8rem",fontWeight:600,color:"white",zIndex:2,pointerEvents:"none",textAlign:"center",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",width:"20px",height:"20px"},children:a})]})},Qe=({feature:e,featureType:a,item:c,onUpdate:p,handleFeatureDeleteClick:b,deleteConfirmations:l,getFeatureKey:f})=>{var k,Q;const L=()=>{try{const $=[...(c==null?void 0:c.features)||[]],ee=$.filter(V=>V.type===a),F=ee.findIndex(V=>V===e);if(F>0&&F<ee.length){const V=ee[F],q=ee[F-1];if(V&&q){const oe=$.findIndex(ie=>ie===V),E=$.findIndex(ie=>ie===q);oe>=0&&E>=0&&($[oe]=q,$[E]=V,p&&p(c.id,{features:$}))}}}catch(C){console.error(`Error in ${a.toLowerCase()} up button:`,C)}},m=()=>{try{const $=[...(c==null?void 0:c.features)||[]],ee=$.filter(V=>V.type===a),F=ee.findIndex(V=>V===e);if(F<ee.length-1&&F>=0){const V=ee[F],q=ee[F+1];if(V&&q){const oe=$.findIndex(ie=>ie===V),E=$.findIndex(ie=>ie===q);oe>=0&&E>=0&&($[oe]=q,$[E]=V,p&&p(c.id,{features:$}))}}}catch(C){console.error(`Error in ${a.toLowerCase()} down button:`,C)}},R=C=>C.type===a,H=C=>C.type===a&&C.name.trim();return t.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",alignSelf:"stretch"},children:[t.jsx("button",{onClick:L,disabled:(c.features||[]).filter(R).findIndex(C=>C===e)===0,tabIndex:"-1",style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(c.features||[]).filter(H).length>=2&&(c.features||[]).filter(R).findIndex(C=>C===e)!==0&&e.name.trim()?"white":"var(--text-secondary)",cursor:(c.features||[]).filter(H).length>=2&&(c.features||[]).filter(R).findIndex(C=>C===e)!==0&&e.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↑"}),t.jsx("button",{onClick:()=>b(e),disabled:!e.name.trim()&&!e.description.trim(),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:l[f(e)]?"var(--danger)":"var(--gray-700)",color:!e.name.trim()&&!e.description.trim()?"var(--text-secondary)":"white",cursor:!e.name.trim()&&!e.description.trim()?"not-allowed":"pointer",opacity:!e.name.trim()&&!e.description.trim()?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"×"}),t.jsx("button",{onClick:m,disabled:(c.features||[]).filter(R).findIndex(C=>C===e)===(c.features||[]).filter(R).length-1,style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(c.features||[]).filter(H).length>=2&&(c.features||[]).filter(R).findIndex(C=>C===e)<(c.features||[]).filter(R).length-1&&((k=(c.features||[]).filter(R)[(c.features||[]).filter(R).findIndex(C=>C===e)+1])!=null&&k.name.trim())&&e.name.trim()?"white":"var(--text-secondary)",cursor:(c.features||[]).filter(H).length>=2&&(c.features||[]).filter(R).findIndex(C=>C===e)<(c.features||[]).filter(R).length-1&&((Q=(c.features||[]).filter(R)[(c.features||[]).filter(R).findIndex(C=>C===e)+1])!=null&&Q.name.trim())&&e.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↓"})]})},fe={transitions:{hoverIn:"all 0.1s ease",hoverOut:"all 0.3s ease"},card:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"8px",cursor:"pointer",transition:"all 0.1s ease",position:"relative"},cardHover:{backgroundColor:"var(--bg-card-hover)"},cardDead:{opacity:.6,backgroundColor:"var(--gray-800)",borderColor:"var(--border)"},cardAtMax:{backgroundColor:"var(--success)",borderColor:"var(--success)"},rowMain:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},rowTitle:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",margin:0},rowMeta:{display:"flex",gap:"8px",alignItems:"center"},badge:{padding:"2px 6px",borderRadius:"3px",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},typeBadge:{backgroundColor:"var(--purple)",color:"var(--text-primary)"},tierBadge:{backgroundColor:"var(--info)",color:"var(--text-primary)"},damageInputPopup:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,borderRadius:"8px"},damageInputContent:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"8px",padding:"8px",display:"flex",flexDirection:"row",gap:"8px",minWidth:"200px",alignItems:"center",position:"absolute",right:"1rem",top:"50%",transform:"translateY(-50%)"},damageInput:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"4px",padding:"4px 6px",color:"var(--text-primary)",fontSize:"16px",width:"80px",textAlign:"center"},damageIndicators:{display:"flex",gap:"8px",alignItems:"center",justifyContent:"center"},damageDrop:{fontSize:"16px",color:"var(--text-secondary)",cursor:"pointer",transition:"color 0.1s ease"},applyButton:{backgroundColor:"var(--gray-600)",color:"white",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"32px",minHeight:"32px"}},Ht=(e,a,c,p)=>{const[b,l]=A.useState(!1),[f,L]=A.useState("");A.useEffect(()=>{if(b){const C=$=>{$.target.closest(".damage-input-popup")||(l(!1),L(""))};return document.addEventListener("click",C),()=>document.removeEventListener("click",C)}},[b]);const m=C=>{C.stopPropagation(),C.preventDefault();const $=e.hp||0,ee=e.hpMax||1,F=C.currentTarget.getBoundingClientRect(),V=C.clientX-F.left,q=F.width/ee;Math.floor(V/q)<$?c&&c(e.id,1,e.hp):a&&a(e.id,1,e.hp,e.hpMax)},R=C=>{C.stopPropagation(),C.preventDefault();const $=e.stress||0,ee=e.stressMax||1,F=C.currentTarget.getBoundingClientRect(),V=C.clientX-F.left,q=F.width/ee;Math.floor(V/q)<$?p&&p(e.id,-1,e.stress,e.stressMax):p&&p(e.id,1,e.stress,e.stressMax)},H=C=>{C.stopPropagation(),(e.thresholds&&e.thresholds.major&&e.thresholds.severe||e.type==="Minion")&&(l(!0),L(e.type==="Minion"?"1":""))},k=()=>{const C=parseInt(f);if(C>0){if(e.type==="Minion")a&&a(e.id,C,e.hp,e.hpMax);else{let $=0;C>=e.thresholds.severe?$=3:C>=e.thresholds.major?$=2:C>=1&&($=1),a&&a(e.id,$,e.hp,e.hpMax)}l(!1),L("")}};return{showDamageInput:b,damageValue:f,setDamageValue:L,setShowDamageInput:l,handleHpClick:m,handleStressClick:R,handleDifficultyClick:H,applyDamage:k,handleKeyDown:C=>{C.key==="Enter"?k():C.key==="Escape"&&(l(!1),L(""))}}},Ye=({item:e,type:a,mode:c="expanded",onClick:p,onDelete:b,onApplyDamage:l,onApplyHealing:f,onApplyStressChange:L,onUpdate:m,adversaries:R=[],isSelected:H=!1,isEditMode:k=!1,instances:Q=[],isEmbedded:C=!1})=>{const[$,ee]=A.useState({}),F=y=>{const j=(e.features||[]).filter(z=>z.type===y.type).findIndex(z=>z===y);return`${y.type}-${j}-${y.name||"blank"}`},V=(y,S)=>`experience-${S}-${typeof y=="string"?y:y.name||"blank"}`,q=y=>{const S=F(y);if($[S]){const j=e.features.filter(z=>z!==y);m&&m(e.id,{features:j}),ee(z=>{const _={...z};return delete _[S],_})}else ee(j=>({...j,[S]:!0})),setTimeout(()=>{ee(j=>{const z={...j};return delete z[S],z})},3e3)},oe=(y,S)=>{const j=V(y,S);if($[j]){const z=[...e.experience||[]];z.splice(S,1),m&&m(e.id,{experience:z}),ee(_=>{const ae={..._};return delete ae[j],ae})}else ee(z=>({...z,[j]:!0})),setTimeout(()=>{ee(z=>{const _={...z};return delete _[j],_})},3e3)},E=Ht(e,l,f,L);(a==="adversary"||a==="adversaries")&&E.handleDifficultyClick;const ie=(y=!1)=>{let S={...fe.card};if(H?S.transition="none":S.transition=fe.transitions.hoverOut,y){const{marginTop:j,...z}=S;S=z}return H&&(S={...S,...fe.cardHover}),a==="adversary"&&(e.hp||0)>=(e.hpMax||1)&&(S={...S,...fe.cardDead}),S},xe=()=>{if(C)return"";let y="border rounded-lg";return H&&(y+=" border-hover"),y},ge=()=>{var y;if(a==="adversary"||a==="adversaries"){const S=e.baseName||((y=e.name)==null?void 0:y.replace(/\s+\(\d+\)$/,""))||"",j=e.duplicateNumber||1,z=[...R];return R.some(T=>T.id===e.id)||z.push(e),z.filter(T=>T.baseName===S).length>1?`${S} (${j})`:S}return e.name},J=()=>{const y=[];return e.type&&y.push(t.jsx("span",{style:{...fe.badge,...fe.typeBadge},children:e.type},"type")),y},X=()=>a!=="adversary"||!E.showDamageInput||!(e.thresholds&&e.thresholds.major&&e.thresholds.severe||e.type==="Minion")?null:t.jsx("div",{className:"damage-input-popup",style:fe.damageInputPopup,onClick:y=>{y.stopPropagation(),y.target===y.currentTarget&&(a==="adversary"||a==="adversaries")&&(E.setShowDamageInput(!1),E.setDamageValue(""))},children:t.jsxs("div",{className:"border rounded-lg",style:{...fe.damageInputContent,borderColor:"var(--border)"},onClick:y=>y.stopPropagation(),children:[t.jsx("input",{type:"number",inputMode:"numeric",enterKeyHint:"done",placeholder:"dmg",min:(e.type==="Minion","0"),value:a==="adversary"||a==="adversaries"?E.damageValue:"",onChange:y=>{(a==="adversary"||a==="adversaries")&&E.setDamageValue(y.target.value)},onKeyDown:a==="adversary"||a==="adversaries"?E.handleKeyDown:void 0,className:"border rounded-sm",style:{...fe.damageInput,borderColor:"var(--border)"},autoFocus:!0}),t.jsxs("div",{style:fe.damageIndicators,children:[e.type==="Minion"?(()=>{var _,ae;const y=parseInt(a==="adversary"||a==="adversaries"?E.damageValue:"0")||0,S=(_=e.features)==null?void 0:_.find(T=>{var i;return(i=T.name)==null?void 0:i.startsWith("Minion (")}),j=S?parseInt(((ae=S.name.match(/\((\d+)\)/))==null?void 0:ae[1])||"1"):1,z=Math.floor(y/j);return y>=j&&z>0?t.jsxs("span",{style:{...fe.damageDrop,color:"var(--red)"},title:`${y} damage can defeat ${z+1} minion${z+1!==1?"s":""} (1 + ${z} additional)`,children:["+",z," additional minion(s)"]}):t.jsx("span",{style:fe.damageDrop,title:`${y} damage defeats this minion only`,children:"+0 additional minion(s)"})})():[1,2,3].map(y=>{const S=parseInt(a==="adversary"||a==="adversaries"?E.damageValue:"0")||0;let j=!1;return y===1&&S>=1&&(j=!0),y===2&&S>=e.thresholds.major&&(j=!0),y===3&&S>=e.thresholds.severe&&(j=!0),t.jsx("span",{style:{...fe.damageDrop,color:j?"var(--red)":"var(--text-secondary)"},onClick:z=>{z.stopPropagation(),(a==="adversary"||a==="adversaries")&&(y===1?E.setDamageValue("1"):y===2?E.setDamageValue(e.thresholds.major.toString()):y===3&&E.setDamageValue(e.thresholds.severe.toString()))},title:`Click to set damage to ${y===1?"1":y===2?e.thresholds.major:e.thresholds.severe}`,children:t.jsx(xt,{size:16})},y)}),t.jsx("button",{style:{...fe.applyButton,backgroundColor:"var(--gray-600)"},onClick:y=>{y.stopPropagation(),(a==="adversary"||a==="adversaries")&&(!E.damageValue||parseInt(E.damageValue)<1?(E.setShowDamageInput(!1),E.setDamageValue("")):E.applyDamage())},title:!E.damageValue||parseInt(E.damageValue)<1?"Close damage input":"Apply damage",children:!E.damageValue||parseInt(E.damageValue)<1?t.jsx(Ge,{size:16}):t.jsx(Et,{size:16})})]})]})}),ne=()=>{var j,z,_,ae,T;const y=(e.hp||0)>=(e.hpMax||1),S=c==="edit";return console.log("=== EXPANDED ADVERSARY CARD DEBUG ==="),console.log("Item data:",e),console.log("Item ID:",e.id),console.log("Item name:",e.name),console.log("Item type:",e.type),console.log("Item tier:",e.tier),console.log("Item difficulty:",e.difficulty),console.log("Item atk:",e.atk,"Type:",typeof e.atk),console.log("Item hpMax:",e.hpMax),console.log("Item stressMax:",e.stressMax),console.log("Item thresholds:",e.thresholds),console.log("Item experience:",e.experience),console.log("Item features:",e.features),console.log("Item motives:",e.motives),console.log("Item description:",e.description),console.log("Is custom?",e.isCustom||e.source==="Homebrew"),console.log("====================================="),t.jsxs("div",{className:xe(),style:{...ie(!0),padding:0,minHeight:"400px",opacity:y?.7:1,backgroundColor:y?"var(--gray-900)":ie(!0).backgroundColor,borderColor:y?"color-mix(in srgb, var(--gray-600) 40%, transparent)":H?"var(--purple)":"var(--border)",borderWidth:"2px",display:"flex",flexDirection:"column",position:"relative"},onClick:p,children:[y&&t.jsx(t.Fragment,{children:t.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                45deg,
                transparent,
                transparent 8px,
                var(--gray-600) 1px,
                var(--gray-600) 9px
              )`,pointerEvents:"none",zIndex:9999}})}),t.jsx("div",{className:"border-b",style:{padding:"8px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative",zIndex:y?1:"auto",borderBottomColor:H?"var(--purple)":"var(--border)"},children:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",position:"relative",zIndex:y?1:"auto",padding:"2px",minHeight:"40px"},children:[S?t.jsx("input",{type:"text",value:e.name||"",onChange:i=>{m&&m(e.id,{name:i.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"4px",color:"var(--text-primary)",fontSize:"1.1rem",fontWeight:"600",padding:"0.5rem",width:"100%",maxWidth:"300px",paddingRight:"0.625rem"},placeholder:"Name"}):t.jsx("h4",{style:{...fe.rowTitle,color:y?"color-mix(in srgb, var(--gray-400) 80%, transparent)":fe.rowTitle.color,textAlign:"left",margin:0,fontSize:"1.1rem",paddingRight:"6px"},children:((j=e.name)==null?void 0:j.replace(/\s+\(\d+\)$/,""))||e.name}),(e.type||e.tier||S)&&t.jsx(Pt,{type:e.type,tier:e.tier,isEditMode:S,onUpdate:m,itemId:e.id})]})}),t.jsxs("div",{style:{borderRadius:"0 0 8px 8px"},children:[(e.motives||S)&&t.jsx("div",{style:{padding:"0.5rem 8px",textAlign:"center"},children:S?t.jsx("input",{type:"text",value:e.motives||"",onChange:i=>m&&m(e.id,{motives:i.target.value}),placeholder:"Motives...",style:{width:"100%",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}):t.jsxs("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,textAlign:"center"},children:[e.motives,e.motives&&!e.motives.endsWith(".")?".":""]})}),(e.difficulty||e.atk!==void 0||e.thresholds&&e.type!=="Minion"||e.experience&&e.experience.length>0||S)&&t.jsxs("div",{style:{padding:"0.5rem 8px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[(e.difficulty||S)&&t.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[t.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[t.jsx(kt,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(0deg)"}}),S?t.jsx("input",{type:"text",value:e.difficulty||"",onChange:i=>{const u=i.target.value.replace(/[^0-9]/g,"");u.length<=2&&m&&m(e.id,{difficulty:parseInt(u)||0})},onKeyDown:i=>{if(i.key==="ArrowUp"){i.preventDefault();const u=parseInt(e.difficulty)||0;m&&m(e.id,{difficulty:Math.min(u+1,99)})}else if(i.key==="ArrowDown"){i.preventDefault();const u=parseInt(e.difficulty)||0;m&&m(e.id,{difficulty:Math.max(u-1,0)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"2"}):t.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:e.difficulty})]}),t.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Difficulty"})]}),(e.atk!==void 0||S)&&t.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[t.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[t.jsx(It,{size:38,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(45deg)"}}),S?t.jsx("input",{type:"text",value:(()=>{const i=typeof e.atk=="string"?parseInt(e.atk.replace(/[^0-9\-]/g,"")):e.atk||0;return i>=0?`+${i}`:i.toString()})(),onChange:i=>{const u=i.target.value.replace(/[^0-9+\-]/g,"");if(u.length<=4){const s=parseInt(u.replace(/[^0-9\-]/g,""))||0;m&&m(e.id,{atk:s})}},onKeyDown:i=>{if(i.key==="ArrowUp"){i.preventDefault();const s=(typeof e.atk=="string"?parseInt(e.atk.replace(/[^0-9\-]/g,"")):e.atk||0)+1;m&&m(e.id,{atk:s})}else if(i.key==="ArrowDown"){i.preventDefault();const s=(typeof e.atk=="string"?parseInt(e.atk.replace(/[^0-9\-]/g,"")):e.atk||0)-1;m&&m(e.id,{atk:s})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"3"}):t.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:(()=>{const i=typeof e.atk=="string"?parseInt(e.atk.replace(/[^0-9\-]/g,"")):e.atk;return i>=0?`+${i}`:i})()})]}),t.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Attack"})]})]}),t.jsx("div",{style:{paddingTop:"0"},children:S?t.jsx("div",{style:{display:"flex",flexDirection:"column",marginTop:"-0.25rem"},children:(()=>{const i=e.experience||[],u=i.length===0?[{name:"",modifier:1}]:i;return u.map((s,w)=>{var D,v,n,d,r,o,g,Z,se,G,U,le,we,Ce,Se,Ee,Ae,ze,We,Te,Re,Be,x,M,P;return t.jsxs("div",{style:{position:"relative",marginBottom:"0.5rem"},children:[t.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:t.jsx("input",{type:"text",value:typeof s=="object"&&s.modifier>=1?`+${s.modifier}`:"+1",onChange:B=>{const W=[...e.experience||[]],h=parseInt(B.target.value.replace(/[^0-9+-]/g,""))||1,I=Math.max(1,h);W[w]={name:typeof s=="string"?s:s.name||"",modifier:I},m&&m(e.id,{experience:W})},onKeyDown:B=>{if(B.key==="ArrowUp"){B.preventDefault();const W=[...e.experience||[]],h=typeof s=="object"?Math.max(1,s.modifier):1;W[w]={name:typeof s=="string"?s:s.name||"",modifier:h+1},m&&m(e.id,{experience:W})}else if(B.key==="ArrowDown"){B.preventDefault();const W=[...e.experience||[]],h=typeof s=="object"?Math.max(1,s.modifier):1;W[w]={name:typeof s=="string"?s:s.name||"",modifier:Math.max(1,h-1)},m&&m(e.id,{experience:W})}},style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)",textAlign:"center",outline:"none"}})}),t.jsxs("div",{style:{marginLeft:"32px",display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("input",{type:"text",value:typeof s=="string"?s:s.name||"",onChange:B=>{const W=[...e.experience||[]],h=typeof s=="object"?s.modifier:1;W[w]={name:B.target.value,modifier:h};const I=W[W.length-1];I&&I.name.trim()&&W.push({name:"",modifier:1}),m&&m(e.id,{experience:W})},placeholder:"Experience name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),t.jsxs("div",{style:{display:"flex",gap:"0.125rem"},children:[t.jsx("button",{onClick:()=>{var N,O;const B=[...e.experience||[]],W=typeof s=="string"?s.trim():(N=s.name)==null?void 0:N.trim(),h=B[w-1],I=typeof h=="string"?h.trim():(O=h.name)==null?void 0:O.trim();w>0&&w<B.length&&W&&I&&(B[w]=h,B[w-1]=s,m&&m(e.id,{experience:B}))},disabled:w===0||!(typeof s=="string"?s.trim():(D=s.name)!=null&&D.trim())||!(typeof u[w-1]=="string"?u[w-1].trim():(v=u[w-1].name)!=null&&v.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:w===0||!(typeof s=="string"?s.trim():(n=s.name)!=null&&n.trim())||!(typeof u[w-1]=="string"?u[w-1].trim():(d=u[w-1].name)!=null&&d.trim())?"var(--gray-800)":"var(--gray-700)",color:w===0||!(typeof s=="string"?s.trim():(r=s.name)!=null&&r.trim())||!(typeof u[w-1]=="string"?u[w-1].trim():(o=u[w-1].name)!=null&&o.trim())?"var(--text-secondary)":"white",cursor:w===0||!(typeof s=="string"?s.trim():(g=s.name)!=null&&g.trim())||!(typeof u[w-1]=="string"?u[w-1].trim():(Z=u[w-1].name)!=null&&Z.trim())?"not-allowed":"pointer",opacity:w===0||!(typeof s=="string"?s.trim():(se=s.name)!=null&&se.trim())||!(typeof u[w-1]=="string"?u[w-1].trim():(G=u[w-1].name)!=null&&G.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move up",children:"↑"}),t.jsx("button",{onClick:()=>{var N,O;const B=[...e.experience||[]],W=typeof s=="string"?s.trim():(N=s.name)==null?void 0:N.trim(),h=B[w+1],I=typeof h=="string"?h.trim():(O=h.name)==null?void 0:O.trim();w<B.length-1&&w>=0&&W&&I&&(B[w]=h,B[w+1]=s,m&&m(e.id,{experience:B}))},disabled:w===u.length-1||!(typeof s=="string"?s.trim():(U=s.name)!=null&&U.trim())||!(typeof u[w+1]=="string"?u[w+1].trim():(le=u[w+1].name)!=null&&le.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:w===u.length-1||!(typeof s=="string"?s.trim():(we=s.name)!=null&&we.trim())||!(typeof u[w+1]=="string"?u[w+1].trim():(Ce=u[w+1].name)!=null&&Ce.trim())?"var(--gray-800)":"var(--gray-700)",color:w===u.length-1||!(typeof s=="string"?s.trim():(Se=s.name)!=null&&Se.trim())||!(typeof u[w+1]=="string"?u[w+1].trim():(Ee=u[w+1].name)!=null&&Ee.trim())?"var(--text-secondary)":"white",cursor:w===u.length-1||!(typeof s=="string"?s.trim():(Ae=s.name)!=null&&Ae.trim())||!(typeof u[w+1]=="string"?u[w+1].trim():(ze=u[w+1].name)!=null&&ze.trim())?"not-allowed":"pointer",opacity:w===u.length-1||!(typeof s=="string"?s.trim():(We=s.name)!=null&&We.trim())||!(typeof u[w+1]=="string"?u[w+1].trim():(Te=u[w+1].name)!=null&&Te.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move down",children:"↓"}),t.jsx("button",{onClick:()=>oe(s,w),disabled:!(typeof s=="string"?s.trim():(Re=s.name)!=null&&Re.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:$[V(s,w)]?"var(--danger)":(typeof s=="string"?s.trim():(Be=s.name)!=null&&Be.trim())?"var(--gray-700)":"var(--gray-800)",color:(typeof s=="string"?s.trim():(x=s.name)!=null&&x.trim())?"white":"var(--text-secondary)",cursor:(typeof s=="string"?s.trim():(M=s.name)!=null&&M.trim())?"pointer":"not-allowed",opacity:(typeof s=="string"?s.trim():(P=s.name)!=null&&P.trim())?1:.5,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:$[V(s,w)]?"Click again to confirm delete":"Delete experience",children:"×"})]})]})]},w)})})()}):t.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:e.experience&&e.experience.length>0?e.experience.map((i,u)=>{if(typeof i=="string"){const s=i.match(/^(.+?)\s*([+-]?\d+)$/);if(s){const[,w,D]=s;return t.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[t.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:t.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:t.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:D})})}),t.jsx("span",{style:{marginLeft:"32px"},children:w})]},u)}else return t.jsx("div",{style:{marginBottom:"0.25rem"},children:i},u)}else return t.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[t.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:t.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:t.jsxs("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:[i.modifier>=0?"+":"",i.modifier]})})}),t.jsx("span",{style:{marginLeft:"32px"},children:i.name})]},u)}):null})})]}),(e.features&&e.features.length>0||S)&&t.jsxs("div",{style:{padding:"0 8px 8px 8px"},children:[(e.atk!==void 0&&e.weapon||S)&&t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[t.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),t.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Standard Attack"})]}),t.jsx("div",{style:{display:"flex",flexDirection:"column"},children:S?t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",marginTop:"0.75rem",marginBottom:"0.75rem"},children:t.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[t.jsx("input",{type:"text",value:e.weapon||"",onChange:i=>m&&m(e.id,{weapon:i.target.value}),placeholder:"Standard attack name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}}),t.jsxs("select",{value:e.range||"",onChange:i=>m&&m(e.id,{range:i.target.value}),style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",appearance:"none",backgroundImage:`url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",backgroundSize:"1rem",paddingRight:"2rem"},children:[t.jsx("option",{value:""}),t.jsx("option",{value:"Melee",children:"Melee"}),t.jsx("option",{value:"Very Close",children:"Very Close"}),t.jsx("option",{value:"Close",children:"Close"}),t.jsx("option",{value:"Far",children:"Far"}),t.jsx("option",{value:"Very Far",children:"Very Far"})]}),t.jsx("input",{type:"text",value:e.damage||"",onChange:i=>m&&m(e.id,{damage:i.target.value}),placeholder:"Damage (e.g., 1d6+2)",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}})]})}):e.atk!==void 0&&e.weapon&&t.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[t.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:e.weapon}),t.jsxs("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:["Make an attack against a target within ",e.range||"Melee"," range. On a success, deal ",e.damage||"damage varies","."]})]})})]}),(e.features.filter(i=>i.type==="Action").length>0||S)&&t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[t.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),t.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Actions"})]}),t.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const i=e.features.filter(s=>s.type==="Action");return(S&&i.length===0?[{type:"Action",name:"",description:""}]:i).map((s,w)=>S?t.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[t.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[t.jsx("input",{type:"text",value:s.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false","data-lpignore":"true","data-form-type":"other",name:`feature-name-${s.type.toLowerCase()}`,onChange:D=>{const v=[...e.features||[]],n=v.findIndex(o=>o.type==="Action"&&o===s);n>=0?v[n]={...v[n],name:D.target.value}:v.push({type:"Action",name:D.target.value,description:s.description||""});const d=v.filter(o=>o.type==="Action"),r=d[d.length-1];r&&r.name.trim()&&v.push({type:"Action",name:"",description:""}),m&&m(e.id,{features:v})},placeholder:"Action name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),t.jsx("textarea",{value:s.description||"",onChange:D=>{const v=[...e.features||[]],n=v.findIndex(o=>o.type==="Action"&&o===s);n>=0?v[n]={...v[n],description:D.target.value}:v.push({type:"Action",name:s.name||"",description:D.target.value});const d=v.filter(o=>o.type==="Action"),r=d[d.length-1];r&&r.name.trim()&&v.push({type:"Action",name:"",description:""}),m&&m(e.id,{features:v})},onInput:D=>{const v=D.target.offsetHeight;D.target.style.height="auto";const n=D.target.scrollHeight,d=n>v?n:v;D.target.style.height=d+"px"},placeholder:"Action description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),t.jsx(Qe,{feature:s,featureType:"Action",item:e,onUpdate:m,handleFeatureDeleteClick:q,deleteConfirmations:$,getFeatureKey:F})]},w):t.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[t.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:s.name}),s.description&&t.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:s.description})]},w))})()})]}),(e.features.filter(i=>i.type==="Passive").length>0||S)&&t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[t.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),t.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Passives"})]}),t.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const i=e.features.filter(s=>s.type==="Passive");return(S&&i.length===0?[{type:"Passive",name:"",description:""}]:i).map((s,w)=>S?t.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[t.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[t.jsx("input",{type:"text",value:s.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:D=>{const v=[...e.features||[]],n=v.findIndex(o=>o.type==="Passive"&&o===s);n>=0?v[n]={...v[n],name:D.target.value}:v.push({type:"Passive",name:D.target.value,description:s.description||""});const d=v.filter(o=>o.type==="Passive"),r=d[d.length-1];r&&r.name.trim()&&v.push({type:"Passive",name:"",description:""}),m&&m(e.id,{features:v})},placeholder:"Passive name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),t.jsx("textarea",{value:s.description||"",onChange:D=>{const v=[...e.features||[]],n=v.findIndex(o=>o.type==="Passive"&&o===s);n>=0?v[n]={...v[n],description:D.target.value}:v.push({type:"Passive",name:s.name||"",description:D.target.value});const d=v.filter(o=>o.type==="Passive"),r=d[d.length-1];r&&r.name.trim()&&v.push({type:"Passive",name:"",description:""}),m&&m(e.id,{features:v})},onInput:D=>{const v=D.target.offsetHeight;D.target.style.height="auto";const n=D.target.scrollHeight,d=n>v?n:v;D.target.style.height=d+"px"},placeholder:"Passive description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),t.jsx(Qe,{feature:s,featureType:"Passive",item:e,onUpdate:m,handleFeatureDeleteClick:q,deleteConfirmations:$,getFeatureKey:F})]},w):t.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[t.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:s.name}),s.description&&t.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:s.description})]},w))})()})]}),(e.features.filter(i=>i.type==="Reaction").length>0||S)&&t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[t.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),t.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Reactions"})]}),t.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const i=e.features.filter(s=>s.type==="Reaction");return(S&&i.length===0?[{type:"Reaction",name:"",description:""}]:i).map((s,w)=>S?t.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[t.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[t.jsx("input",{type:"text",value:s.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:D=>{const v=[...e.features||[]],n=v.findIndex(o=>o.type==="Reaction"&&o===s);n>=0?v[n]={...v[n],name:D.target.value}:v.push({type:"Reaction",name:D.target.value,description:s.description||""});const d=v.filter(o=>o.type==="Reaction"),r=d[d.length-1];r&&r.name.trim()&&v.push({type:"Reaction",name:"",description:""}),m&&m(e.id,{features:v})},placeholder:"Reaction name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),t.jsx("textarea",{value:s.description||"",onChange:D=>{const v=[...e.features||[]],n=v.findIndex(o=>o.type==="Reaction"&&o===s);n>=0?v[n]={...v[n],description:D.target.value}:v.push({type:"Reaction",name:s.name||"",description:D.target.value});const d=v.filter(o=>o.type==="Reaction"),r=d[d.length-1];r&&r.name.trim()&&v.push({type:"Reaction",name:"",description:""}),m&&m(e.id,{features:v})},onInput:D=>{const v=D.target.offsetHeight;D.target.style.height="auto";const n=D.target.scrollHeight,d=n>v?n:v;D.target.style.height=d+"px"},placeholder:"Reaction description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),t.jsx(Qe,{feature:s,featureType:"Reaction",item:e,onUpdate:m,handleFeatureDeleteClick:q,deleteConfirmations:$,getFeatureKey:F})]},w):t.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[t.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:s.name}),s.description&&t.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:s.description})]},w))})()})]})]})]}),(Q&&Q.length>0||e.type!=="Minion"&&(e.thresholds||S))&&t.jsxs("div",{style:{padding:"0 8px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"0.25rem"},children:[t.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),t.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Status"})]}),S?t.jsx("div",{style:{marginBottom:"0.5rem"},children:t.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border)"},children:t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("input",{type:"number",value:e.hpMax||"",onChange:i=>{const u=parseInt(i.target.value)||1;m&&m(e.id,{hpMax:u})},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),t.jsx(Le,{type:"adversaryHP",value:0,maxValue:e.hpMax||1,showTooltip:!1}),t.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:"HP"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("input",{type:"number",value:e.stressMax||"",onChange:i=>{const u=parseInt(i.target.value)||1;m&&m(e.id,{stressMax:u})},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),t.jsx(Le,{type:"adversaryStress",value:0,maxValue:e.stressMax||1,showTooltip:!1}),t.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:"Stress"})]})]})})}):Q&&Q.length>0&&Q.map((i,u)=>{const s=(i.hp||0)>=(i.hpMax||1);return t.jsx("div",{style:{marginBottom:"0.5rem"},children:t.jsxs("div",{style:{backgroundColor:s?"var(--gray-900)":"var(--bg-primary)",borderRadius:"6px",padding:"0.25rem 0.5rem",border:"1px solid",borderColor:s?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",display:"flex",justifyContent:"flex-start",alignItems:"center",gap:"0.5rem",opacity:s?.7:1,position:"relative",transition:"all 0.2s ease",minHeight:"40px"},children:[s&&t.jsx(t.Fragment,{children:t.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                          45deg,
                          transparent 0px,
                          transparent 8px,
                          var(--gray-600) 9px,
                          var(--gray-600) 9px
                        )`,pointerEvents:"none",zIndex:1,borderRadius:"4px"}})}),t.jsx("div",{style:{backgroundColor:s?"var(--gray-900)":"var(--bg-card)",border:"1px solid",borderColor:s?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",borderRadius:"50%",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",flexShrink:0,opacity:s?.5:1},children:t.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:s?"var(--gray-400)":"var(--text-primary)"},children:i.duplicateNumber||1})}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.125rem"},children:[t.jsx("div",{style:{opacity:s?.3:1},children:t.jsx(Le,{type:"adversaryHP",value:i.hp||0,maxValue:i.hpMax||1,onPipClick:(w,D)=>{if(l&&a==="adversary"){const v=i.hp||0,n=i.hpMax||1;D?f&&f(i.id,1,v):v<n&&l(i.id,1,v,n)}},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})}),i.stressMax>0&&t.jsx("div",{style:{opacity:s?.3:1},children:t.jsx(Le,{type:"adversaryStress",value:i.stress||0,maxValue:i.stressMax,onPipClick:(w,D)=>{L&&a==="adversary"&&(D?L(i.id,-1):L(i.id,1))},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})})]})]},i.id)},i.id)}),e.type!=="Minion"&&(e.thresholds||S)&&t.jsx("div",{style:{display:"flex",justifyContent:"center",paddingTop:"1px",marginTop:"0.5rem",marginBottom:"0.5rem"},children:t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",position:"relative"},children:t.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",height:"36px"},children:[t.jsx("svg",{width:"300",height:"36",viewBox:"0 0 300 36",style:{position:"absolute",zIndex:1},children:t.jsx("rect",{x:"20",y:"6",width:"260",height:"24",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4"})}),t.jsx("div",{style:{position:"relative",zIndex:2,display:"flex",alignItems:"center",gap:"0.5rem"},children:S?t.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",fontSize:"0.8rem"},children:[t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),t.jsx("input",{type:"number",min:"1",max:"99",value:((z=e.thresholds)==null?void 0:z.major)||"",onChange:i=>{const u=i.target.value;(u===""||parseInt(u)>=1&&parseInt(u)<=99)&&m&&m(e.id,{thresholds:{...e.thresholds,major:u===""?null:parseInt(u)}})},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}}),t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),t.jsx("input",{type:"number",min:"1",max:"99",value:((_=e.thresholds)==null?void 0:_.severe)||"",onChange:i=>{const u=i.target.value;(u===""||parseInt(u)>=1&&parseInt(u)<=99)&&m&&m(e.id,{thresholds:{...e.thresholds,severe:u===""?null:parseInt(u)}})},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}}),t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]}):t.jsxs(t.Fragment,{children:[t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),t.jsx(ct,{value:((ae=e.thresholds)==null?void 0:ae.major)||7}),t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),t.jsx(ct,{value:((T=e.thresholds)==null?void 0:T.severe)||14}),t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]})})]})})})]}),(S||c==="expanded"&&e.description&&e.description.trim())&&t.jsxs("div",{style:{padding:"0 8px",textAlign:"center"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[t.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),t.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Description"})]}),S?t.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-primary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"none",overflow:"hidden",fontFamily:"inherit",marginTop:"0.75rem",marginBottom:"0.75rem"},value:e.description,onChange:i=>{i.target.style.height="auto",i.target.style.height=i.target.scrollHeight+"px",m&&m(e.id,{description:i.target.value})},placeholder:"Description..."}):t.jsx("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,whiteSpace:"pre-wrap",padding:"0.5rem 0"},children:e.description})]}),X()]})};return(c==="expanded"||c==="edit")&&(a==="adversary"||a==="adversaries")?ne():a==="adversary"||a==="adversaries"?null:t.jsxs("div",{className:xe(),style:ie(!0),children:[t.jsxs("div",{style:fe.rowMain,children:[t.jsx("h4",{style:fe.rowTitle,children:ge()}),t.jsx("div",{style:fe.rowMeta,children:J()})]}),t.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"12px",margin:0},children:["Expanded view coming soon for ",a]})]})},Ft="modulepreload",Ot=function(e){return"/Daggerheart/"+e},pt={},qe=function(a,c,p){if(!c||c.length===0)return a();const b=document.getElementsByTagName("link");return Promise.all(c.map(l=>{if(l=Ot(l),l in pt)return;pt[l]=!0;const f=l.endsWith(".css"),L=f?'[rel="stylesheet"]':"";if(!!p)for(let H=b.length-1;H>=0;H--){const k=b[H];if(k.href===l&&(!f||k.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${L}`))return;const R=document.createElement("link");if(R.rel=f?"stylesheet":Ft,f||(R.as="script",R.crossOrigin=""),R.href=l,document.head.appendChild(R),f)return new Promise((H,k)=>{R.addEventListener("load",H),R.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${l}`)))})})).then(()=>a()).catch(l=>{const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=l,window.dispatchEvent(f),!f.defaultPrevented)throw l})},$t="/Daggerheart/assets/daggerheart-logo-fe7815ad.svg",ut={Minion:{difficulty:e=>[9,12,15,18][e-1],thresholds:e=>({major:0,severe:0}),hpMax:e=>1,stressMax:e=>1,atk:e=>[-1,0,1,2][e-1],damage:e=>["2","5","8","11"][e-1],range:"Melee"},Standard:{difficulty:e=>[11,14,17,20][e-1],thresholds:e=>({major:[7,10,20,25][e-1],severe:[12,20,32,45][e-1]}),hpMax:e=>[4,5,6,7][e-1],stressMax:e=>[3,3,4,4][e-1],atk:e=>[1,2,3,4][e-1],damage:e=>["1d8+1","2d8+2","3d8+3","4d8+4"][e-1],range:"Melee"},Bruiser:{difficulty:e=>[11,14,17,20][e-1],thresholds:e=>({major:[8,14,22,38][e-1],severe:[15,28,40,70][e-1]}),hpMax:e=>[6,7,8,9][e-1],stressMax:e=>[4,4,5,5][e-1],atk:e=>[-1,0,1,2][e-1],damage:e=>["1d12+2","2d12+4","3d12+6","4d12+8"][e-1],range:"Melee"},Horde:{difficulty:e=>[10,13,16,19][e-1],thresholds:e=>({major:[7,10,20,25][e-1],severe:[12,20,32,45][e-1]}),hpMax:e=>[5,6,7,8][e-1],stressMax:e=>[3,3,4,4][e-1],atk:e=>[-1,0,1,2][e-1],damage:e=>["1d8+2","2d8+4","3d8+6","4d8+8"][e-1],range:"Melee"},Leader:{difficulty:e=>[11,14,17,20][e-1],thresholds:e=>({major:[7,13,21,35][e-1],severe:[14,26,38,65][e-1]}),hpMax:e=>[5,6,7,8][e-1],stressMax:e=>[5,5,6,6][e-1],atk:e=>[2,4,6,8][e-1],damage:e=>["1d10+2","2d10+4","3d10+6","4d10+8"][e-1],range:"Melee"},Ranged:{difficulty:e=>[10,13,16,19][e-1],thresholds:e=>({major:[4,8,18,22][e-1],severe:[7,16,30,42][e-1]}),hpMax:e=>[3,4,5,6][e-1],stressMax:e=>[3,3,4,4][e-1],atk:e=>[2,3,4,5][e-1],damage:e=>["1d8+2","2d8+4","3d8+6","4d8+8"][e-1],range:"Close"},Skulk:{difficulty:e=>[12,15,18,21][e-1],thresholds:e=>({major:[5,9,19,23][e-1],severe:[10,18,31,43][e-1]}),hpMax:e=>[4,5,6,7][e-1],stressMax:e=>[3,3,4,4][e-1],atk:e=>[2,3,4,5][e-1],damage:e=>["1d6+2","2d6+4","3d6+6","4d6+8"][e-1],range:"Melee"},Solo:{difficulty:e=>[12,15,18,21][e-1],thresholds:e=>({major:[7,13,21,35][e-1],severe:[14,26,38,65][e-1]}),hpMax:e=>[8,9,10,11][e-1],stressMax:e=>[5,5,6,6][e-1],atk:e=>[3,5,7,9][e-1],damage:e=>["1d10+3","2d10+6","3d10+9","4d10+12"][e-1],range:"Melee"},Support:{difficulty:e=>[11,14,17,20][e-1],thresholds:e=>({major:[5,9,19,23][e-1],severe:[10,18,31,43][e-1]}),hpMax:e=>[4,4,5,5][e-1],stressMax:e=>[4,4,5,5][e-1],atk:e=>[2,3,4,5][e-1],damage:e=>["1d4+2","2d4+4","3d4+6","4d4+8"][e-1],range:"Melee"},Social:{difficulty:e=>[11,14,17,20][e-1],thresholds:e=>({major:[5,9,19,23][e-1],severe:[10,18,31,43][e-1]}),hpMax:e=>[4,4,5,5][e-1],stressMax:e=>[4,4,5,5][e-1],atk:e=>[2,3,4,5][e-1],damage:e=>["1d4+2","2d4+4","3d4+6","4d4+8"][e-1],range:"Melee"}},Ze=(e,a)=>{const c=ut[a]||ut.Standard;return{difficulty:c.difficulty(e),thresholds:c.thresholds(e),hpMax:c.hpMax(e),stressMax:c.stressMax(e),atk:c.atk(e),damage:c.damage(e),range:c.range}},Vt=({onSave:e,onRefresh:a,onAddItem:c,editingAdversary:p,onCancelEdit:b})=>{const[l,f]=A.useState(()=>{const k=Ze(1,"Standard");return{name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:k.difficulty,thresholds:k.thresholds,hpMax:k.hpMax,stressMax:k.stressMax,atk:k.atk,weapon:"",range:k.range,damage:k.damage,experience:[],features:[]}}),[L,m]=A.useState(!1);ke.useEffect(()=>{f(p?{name:p.name||"",tier:p.tier||1,type:p.type||"Standard",description:p.description||"",motives:p.motives||"",difficulty:p.difficulty||11,thresholds:p.thresholds||{major:7,severe:12},hpMax:p.hpMax||3,stressMax:p.stressMax||1,atk:p.atk||1,weapon:p.weapon||"",range:p.range||"Melee",damage:p.damage||"",experience:p.experience||[],features:p.features||[]}:{name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:11,thresholds:{major:7,severe:12},hpMax:3,stressMax:1,atk:1,weapon:"",range:"Melee",damage:"",experience:[],features:[]})},[p]),ke.useEffect(()=>{if(!p){const k=Ze(l.tier,l.type);f(Q=>({...Q,difficulty:k.difficulty,thresholds:k.thresholds,hpMax:k.hpMax,stressMax:k.stressMax,atk:k.atk,range:k.range,damage:k.damage}))}},[l.tier,l.type,p]);const R=async()=>{if(!l.name.trim()){alert("Please enter a name for the adversary");return}m(!0);try{const k={...l,hp:p?p.hp:0,stress:p?p.stress:0,source:"Homebrew"};if(p)k.id=p.id,await e(k,p.id),alert("Adversary updated successfully!"),b&&b();else{const Q=await e(k);a&&await a();const C=Ze(1,"Standard");f({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:C.difficulty,thresholds:C.thresholds,hpMax:C.hpMax,stressMax:C.stressMax,atk:C.atk,weapon:"",range:C.range,damage:C.damage,experience:[],features:[]}),alert("Custom adversary created successfully!")}}catch(k){console.error("Error saving adversary:",k),alert("Error saving adversary. Please try again.")}finally{m(!1)}},H={...l,id:"new-adversary",hp:0,stress:0,source:"Homebrew"};return t.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem",display:"flex",justifyContent:"center",alignItems:"flex-start"},children:t.jsxs("div",{style:{maxWidth:"600px",width:"100%"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[t.jsx("h2",{style:{color:"var(--text-primary)",fontSize:"1.5rem",fontWeight:"600",margin:0},children:p?"Edit Custom Adversary":"Create Custom Adversary"}),t.jsx("button",{onClick:R,disabled:L||!l.name.trim(),style:{padding:"0.75rem 1.5rem",backgroundColor:L||!l.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"8px",cursor:L||!l.name.trim()?"not-allowed":"pointer",fontSize:"1rem",fontWeight:"600",opacity:L||!l.name.trim()?.6:1},children:L?p?"Saving...":"Creating...":p?"Save":"Create"})]}),t.jsx(Ye,{item:H,type:"adversary",mode:"edit",onUpdate:(k,Q)=>{f(C=>({...C,...Q}))}})]})})},qt=(e,a)=>{const[c,p]=A.useState("max-content"),b=A.useCallback(()=>{if(!a.current||e<=3)return"max-content";const l=a.current.offsetWidth,L=Math.floor(l/120);return L<=1?"max-content":e===4?"max-content max-content":e===5||e===6?L>=2?"max-content max-content":"max-content":e===7?L>=3?"max-content max-content max-content":L>=2?"max-content max-content":"max-content":"repeat(auto-fit, minmax(80px, max-content))"},[e,a]);return A.useEffect(()=>{const l=b();p(l);const f=new ResizeObserver(()=>{const L=b();p(L)});return a.current&&f.observe(a.current),()=>{f.disconnect()}},[b]),c},_t=({encounter:e})=>{var b,l;const a=A.useRef(null),c=((b=e.encounterItems)==null?void 0:b.length)||0,p=qt(c,a);return t.jsx("div",{ref:a,className:"saved-encounter-adversary-list",style:{flex:1,fontSize:"0.8rem",color:"var(--text-secondary)",lineHeight:"1.3",display:"grid",gridTemplateColumns:p,gap:"0.25rem 1rem",gridAutoRows:"min-content"},children:((l=e.encounterItems)==null?void 0:l.length)>0?e.encounterItems.map((f,L)=>{var R;const m=f.item.baseName||((R=f.item.name)==null?void 0:R.replace(/\s+\(\d+\)$/,""))||f.item.name;return t.jsxs("div",{style:{marginBottom:"0.125rem"},children:[f.quantity,"x ",m]},L)}):t.jsx("div",{children:"No adversaries"})})},He={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},_e={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1,lowerTierAdversary:1};let Pe={adversaries:[]},Je={environments:[]},rt=!1;const Gt=()=>{const e=JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]"),a=JSON.parse(localStorage.getItem("daggerheart-custom-environments")||"[]");return{customAdversaries:e,customEnvironments:a}},mt=async()=>{if(rt)return;let e={adversaries:[]},a={environments:[]},c={adversaries:[]},p={environments:[]};try{const f=await qe(()=>import("./adversaries-9c8932de.js"),[]);e=(f==null?void 0:f.default)||f}catch(f){console.warn("Failed to load adversaries.json:",f)}try{const f=await qe(()=>import("./environments-c340637c.js"),[]);a=(f==null?void 0:f.default)||f}catch(f){console.warn("Failed to load environments.json:",f)}try{const f=await qe(()=>import("./playtest-adversaries-4a099c10.js"),[]);c=(f==null?void 0:f.default)||f}catch(f){console.warn("Failed to load playtest-adversaries.json:",f)}try{const f=await qe(()=>import("./playtest-environments-d9cdffb6.js"),[]);p=(f==null?void 0:f.default)||f}catch(f){console.warn("Failed to load playtest-environments.json:",f)}const{customAdversaries:b,customEnvironments:l}=Gt();Pe={...e,adversaries:[...e.adversaries||[],...c.adversaries||[],...b]},Je={...a,environments:[...a.environments||[],...p.environments||[],...l]},rt=!0,console.log(`Loaded ${Pe.adversaries.length} adversaries and ${Je.environments.length} environments`)},Yt=(e,a=[],c=4,p=1,b=!1)=>{const[l,f]=A.useState(""),[L,m]=A.useState([{field:"tier",direction:"asc"},{field:"name",direction:"asc"}]),[R,H]=A.useState([]),[k,Q]=A.useState(!0),[C,$]=A.useState([]),[ee,F]=A.useState([]),[V,q]=A.useState(!1),[oe,E]=A.useState(!1),ie=A.useRef(null),xe=A.useRef(null);A.useEffect(()=>{(async()=>{await mt(),Q(!1);let i=[];e==="adversary"?i=Pe.adversaries||[]:e==="environment"&&(i=Je.environments||[]),H(i)})()},[e]);const ge=T=>{const i=R.map(u=>u[T]).filter(Boolean);return[...new Set(i)].sort((u,s)=>typeof u=="number"&&typeof s=="number"?u-s:String(u).localeCompare(String(s)))},J=A.useCallback(async()=>{rt=!1,await mt();let T=[];e==="adversary"?b?T=(Pe.adversaries||[]).filter(i=>{var u;return i.source==="Homebrew"||((u=i.id)==null?void 0:u.startsWith("custom-"))}):T=Pe.adversaries||[]:e==="environment"&&(T=Je.environments||[]),H(T)},[e,b]);A.useEffect(()=>{J()},[b,J]);const X=ge("tier"),ne=ge("type"),ce=A.useMemo(()=>{let T=R.filter(i=>{var D,v;const u=i.name.toLowerCase().includes(l.toLowerCase())||((D=i.type)==null?void 0:D.toLowerCase().includes(l.toLowerCase()))||((v=i.description)==null?void 0:v.toLowerCase().includes(l.toLowerCase())),s=C.length===0||(C.includes("party-tier")?i.tier===p:C.includes(i.tier.toString())),w=ee.length===0||ee.includes(i.type);return u&&s&&w});return T.sort((i,u)=>{for(const s of L){const{field:w,direction:D}=s;let v=i[w],n=u[w];if(w==="tier")v=parseInt(v)||0,n=parseInt(n)||0;else if(w==="cost"){const d=r=>{if(e!=="adversary")return 0;const o=He[r.type]||2;let g=0;const Z=a.filter(G=>G.type==="adversary"&&G.item.type==="Solo"&&G.quantity>0).reduce((G,U)=>G+U.quantity,0),se=a.filter(G=>G.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(G.item.type)&&G.quantity>0).reduce((G,U)=>G+U.quantity,0);return r.type==="Solo"&&Z===1&&(g+=2),["Bruiser","Horde","Leader","Solo"].includes(r.type)&&se===0&&(g+=1),o+g};v=d(i),n=d(u)}else if(w==="difficulty"){const d=parseInt(v),r=parseInt(n);!isNaN(d)&&!isNaN(r)?(v=d,n=r):!isNaN(d)&&isNaN(r)?(v=d,n=999):isNaN(d)&&!isNaN(r)?(v=999,n=r):(v=String(v||"").toLowerCase(),n=String(n||"").toLowerCase())}else typeof v=="string"&&typeof n=="string"?(v=v.toLowerCase(),n=n.toLowerCase()):(v=String(v||"").toLowerCase(),n=String(n||"").toLowerCase());if(D==="asc"){if(v>n)return 1;if(v<n)return-1}else{if(v<n)return 1;if(v>n)return-1}}return 0}),T},[R,l,L,C,ee,a,c,p]),y=T=>{m(i=>{const u=i.findIndex(s=>s.field===T);if(u>=0)if(u===0){const s=[...i];return s[0]={...s[0],direction:s[0].direction==="asc"?"desc":"asc"},s}else{const s=[...i];return s.splice(u,1)[0],[{field:T,direction:"asc"},...s]}else return[{field:T,direction:"asc"},...i]})},S=T=>{$(T==="clear"?[]:T==="party-tier"?["party-tier"]:i=>i.includes(T)?i.filter(u=>u!==T):[...i,T])},j=T=>{F(T==="clear"?[]:i=>i.includes(T)?i.filter(u=>u!==T):[...i,T])},z=C.length>0,_=ee.length>0;return A.useEffect(()=>{const T=u=>{const s=u.target.closest(".filter-dropdown"),w=u.target.closest(".header-filter-icon");s||w||(q(!1),E(!1))},i=u=>{u.key==="Escape"&&(q(!1),E(!1))};return document.addEventListener("pointerdown",T,!0),document.addEventListener("mousedown",T,!0),document.addEventListener("touchstart",T,!0),document.addEventListener("click",T,!0),document.addEventListener("keydown",i,!0),()=>{document.removeEventListener("pointerdown",T,!0),document.removeEventListener("mousedown",T,!0),document.removeEventListener("touchstart",T,!0),document.removeEventListener("click",T,!0),document.removeEventListener("keydown",i,!0)}},[q,E]),{searchTerm:l,setSearchTerm:f,sortFields:L,handleSort:y,filteredAndSortedData:ce,loading:k,refreshData:J,selectedTiers:C,selectedTypes:ee,showTierDropdown:V,setShowTierDropdown:q,showTypeDropdown:oe,setShowTypeDropdown:E,tierFilterRef:ie,typeFilterRef:xe,uniqueTiers:X,uniqueTypes:ne,handleTierSelect:S,handleTypeSelect:j,isTierFiltered:z,isTypeFiltered:_,getDropdownStyle:T=>{if(!T.current)return{};const i=T.current.getBoundingClientRect();return{position:"fixed",top:i.bottom+4,left:i.left-100,zIndex:99999}}}},Jt=({searchTerm:e,onSearchChange:a,type:c,partyControls:p,showCustomToggle:b=!1,onToggleCustom:l,filterCustom:f=!1,onExportCustomAdversaries:L,onImportCustomAdversaries:m})=>t.jsxs("div",{style:Y.browserHeader,children:[t.jsx("input",{type:"text",placeholder:"Search",value:e,onChange:R=>a(R.target.value),style:Y.searchInput}),p&&t.jsx("div",{style:Y.partyControls,children:p})]}),Xt=({showCustomToggle:e=!1,onToggleCustom:a,filterCustom:c=!1,onExportCustomAdversaries:p,onImportCustomAdversaries:b})=>t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e&&t.jsxs("button",{onClick:()=>a&&a(!c),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:c?"var(--purple)":"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:c?"white":"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:l=>{c||(l.target.style.backgroundColor="var(--bg-hover)",l.target.style.borderColor="var(--purple)")},onMouseLeave:l=>{c||(l.target.style.backgroundColor="var(--bg-primary)",l.target.style.borderColor="var(--border)")},children:[t.jsx("span",{children:c?"✓":"○"}),"Custom Only"]}),t.jsxs("button",{onClick:p,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:l=>{l.target.style.backgroundColor="var(--bg-hover)",l.target.style.borderColor="var(--purple)"},onMouseLeave:l=>{l.target.style.backgroundColor="var(--bg-primary)",l.target.style.borderColor="var(--border)"},children:[t.jsx("span",{children:"↓"}),"Export"]}),t.jsxs("button",{onClick:()=>document.getElementById("import-file-input").click(),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:l=>{l.target.style.backgroundColor="var(--bg-hover)",l.target.style.borderColor="var(--purple)"},onMouseLeave:l=>{l.target.style.backgroundColor="var(--bg-primary)",l.target.style.borderColor="var(--border)"},children:[t.jsx("span",{children:"↑"}),"Import"]}),t.jsx("input",{id:"import-file-input",type:"file",accept:".csv,.json",onChange:b,style:{display:"none"}})]}),Kt=({sortFields:e,onSort:a,type:c,uniqueTiers:p,uniqueTypes:b,selectedTiers:l,selectedTypes:f,showTierDropdown:L,setShowTierDropdown:m,showTypeDropdown:R,setShowTypeDropdown:H,tierFilterRef:k,typeFilterRef:Q,handleTierSelect:C,handleTypeSelect:$,isTierFiltered:ee,isTypeFiltered:F,getDropdownStyle:V,costFilter:q,showCostDropdown:oe,setShowCostDropdown:E,costFilterRef:ie,handleCostFilterSelect:xe,isCostFiltered:ge})=>{const[J,X]=A.useState(null),ce=(()=>c==="adversary"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"cost",label:"Cost",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:c==="environment"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:[])(),y=()=>{if(!oe)return null;const j=[{value:"all",label:"All"},{value:"auto-grey",label:"Auto Grey"},{value:"auto-hide",label:"Auto Hide"}];return et.createPortal(t.jsx("div",{className:"filter-dropdown",style:{...Y.filterDropdown,...V(ie),maxHeight:"60vh",overflow:"auto"},onMouseDown:z=>z.stopPropagation(),onClick:z=>z.stopPropagation(),children:j.map(z=>{const _=q===z.value;return t.jsxs("div",{style:{...Y.filterOption,..._?Y.filterOptionSelected:{}},onClick:()=>xe(z.value),children:[t.jsx("span",{style:Y.checkIcon,children:_?t.jsx($e,{size:16}):t.jsx(Ve,{size:16})}),t.jsx("span",{style:Y.filterLabel,children:z.label})]},z.value)})}),document.body)},S=(j,z,_,ae,T,i,u,s)=>{if(!T)return null;const w=()=>{(j==="tier"||j==="type")&&ae("clear")};return et.createPortal(t.jsxs("div",{className:"filter-dropdown",style:{...Y.filterDropdown,...V(u),maxHeight:"60vh",overflow:"auto"},onMouseDown:D=>D.stopPropagation(),onClick:D=>D.stopPropagation(),children:[t.jsxs("div",{style:{...Y.filterOption,..._.length===0?Y.filterOptionSelected:{}},onClick:w,children:[t.jsx("span",{style:Y.checkIcon,children:_.length===0?t.jsx($e,{size:16}):t.jsx(Ve,{size:16})}),t.jsx("span",{style:Y.filterLabel,children:"All"})]}),j==="tier"&&t.jsxs("div",{style:{...Y.filterOption,..._.includes("party-tier")?Y.filterOptionSelected:{}},onClick:()=>ae("party-tier"),children:[t.jsx("span",{style:Y.checkIcon,children:_.includes("party-tier")?t.jsx($e,{size:16}):t.jsx(Ve,{size:16})}),t.jsx("span",{style:Y.filterLabel,children:"Party Tier"})]}),z.map(D=>{const v=_.includes(D.toString());return t.jsxs("div",{style:{...Y.filterOption,...v?Y.filterOptionSelected:{}},onClick:()=>ae(D.toString()),children:[t.jsx("span",{style:Y.checkIcon,children:v?t.jsx($e,{size:16}):t.jsx(Ve,{size:16})}),t.jsx("span",{style:Y.filterLabel,children:D})]},D)})]}),document.body)};return t.jsx("tr",{style:Y.tableHeader,children:ce.map(j=>t.jsxs("th",{style:{...Y.tableHeaderCell,...J===j.key?Y.tableHeaderCellHover:{},position:"relative",...j.key==="name"?{width:"auto",minWidth:"0"}:{},...j.key==="tier"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...j.key==="type"?{width:"80px",minWidth:"80px",maxWidth:"80px"}:{},...j.key==="difficulty"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...j.key==="cost"?{width:"50px",minWidth:"50px",maxWidth:"50px"}:{},...j.key==="action"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{}},onClick:()=>a(j.key),onMouseEnter:()=>X(j.key),onMouseLeave:()=>X(null),children:[j.hasFilter?t.jsxs("div",{style:Y.headerWithFilter,children:[t.jsx("span",{style:{cursor:"pointer"},onClick:z=>{z.stopPropagation(),a(j.key)},children:j.label}),t.jsxs("button",{ref:j.key==="tier"?k:j.key==="type"?Q:ie,style:{...Y.headerFilterIcon,...j.key==="tier"&&ee?Y.headerFilterIconActive:{},...j.key==="type"&&F?Y.headerFilterIconActive:{},...j.key==="cost"&&ge?Y.headerFilterIconActive:{}},className:"header-filter-icon",onClick:z=>{z.stopPropagation(),j.key==="tier"?(m(!L),H(!1),E(!1)):j.key==="type"?(H(!R),m(!1),E(!1)):j.key==="cost"&&(E(!oe),m(!1),H(!1))},children:[t.jsx(At,{size:14}),j.key==="tier"&&ee||j.key==="type"&&F||j.key==="cost"&&ge?t.jsx("span",{style:Y.filterActiveDot}):null]})]}):j.label,j.key==="tier"&&S("tier",p,l,C,L,m,k),j.key==="type"&&S("type",b,f,$,R,H,Q),j.key==="cost"&&y()]},j.key))})},Qt=({item:e,onAdd:a,type:c,onRowClick:p,encounterItems:b=[],pcCount:l=4,playerTier:f=1,remainingBudget:L=0,costFilter:m="auto-grey",onAdversaryClick:R})=>{const[H,k]=A.useState(!1),Q=()=>{a(e)},C=()=>{if(c!=="adversary")return null;const F=He[e.type]||2;let V=0;const q=b.filter(E=>E.type==="adversary"&&E.item.type==="Solo"&&E.quantity>0).reduce((E,ie)=>E+ie.quantity,0),oe=b.filter(E=>E.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(E.item.type)&&E.quantity>0).reduce((E,ie)=>E+ie.quantity,0);return e.type==="Solo"&&q===1&&(V+=2),["Bruiser","Horde","Leader","Solo"].includes(e.type)&&oe===0&&(V+=1),F+V},ee=(()=>{if(c==="adversary"){const F=C();He[e.type];const V=F>L||L<=0;if(m==="auto-hide"&&V)return null;const q=m==="auto-grey"&&V?{opacity:.5,color:"var(--text-secondary)"}:{};return t.jsxs(t.Fragment,{children:[t.jsx("td",{style:{...Y.rowCell,width:"auto",minWidth:"0",textAlign:"left",...q},children:t.jsxs("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:[t.jsx("div",{style:{fontWeight:"600"},children:e.name}),e.description&&t.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"0.125rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.description})]})}),t.jsx("td",{style:{...Y.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...q},children:e.tier}),t.jsx("td",{style:{...Y.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center",...q},children:e.type}),t.jsx("td",{style:{...Y.rowCell,width:"50px",minWidth:"50px",maxWidth:"50px",textAlign:"center",...q},children:F}),t.jsx("td",{style:{...Y.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...q},children:e.difficulty})]})}else if(c==="environment")return t.jsxs(t.Fragment,{children:[t.jsx("td",{style:{...Y.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:e.name}),t.jsx("td",{style:{...Y.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:e.tier}),t.jsx("td",{style:{...Y.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:e.type}),t.jsx("td",{style:{...Y.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:e.difficulty})]});return null})();return ee===null?null:t.jsx(t.Fragment,{children:t.jsxs("tr",{style:{...Y.row,...H?Y.rowHover:{}},onClick:()=>{c==="adversary"&&R?R(e):p&&p(e,c)},onMouseEnter:()=>k(!0),onMouseLeave:()=>k(!1),children:[ee,t.jsx("td",{style:{width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",boxSizing:"border-box",overflow:"visible",textOverflow:"unset",whiteSpace:"nowrap"},children:t.jsx("button",{style:Y.addButton,onClick:F=>{F.stopPropagation(),Q()},onMouseEnter:F=>{F.target.style.background="var(--bg-secondary)"},onMouseLeave:F=>{F.target.style.background="var(--purple)"},children:"+"})})]})})},Zt=({type:e,onAddItem:a,onCancel:c=null,onRowClick:p,encounterItems:b=[],pcCount:l=4,playerTier:f=1,partyControls:L=null,showContainer:m=!0,savedEncounters:R=[],onLoadEncounter:H,onDeleteEncounter:k,activeTab:Q="adversaries",selectedCustomAdversaryId:C,onSelectCustomAdversary:$,onTabChange:ee,selectedAdversary:F,onSelectAdversary:V,filterCustom:q=!1,showCustomToggle:oe=!1,onToggleCustom:E,onExportCustomAdversaries:ie,onImportCustomAdversaries:xe})=>{const{addCustomAdversary:ge,updateCustomAdversary:J,customContent:X}=nt(),[ne,ce]=A.useState(null),[y,S]=A.useState("all"),[j,z]=A.useState(!1),[_,ae]=A.useState({}),T=A.useRef({}),i=A.useRef(null),u=()=>{try{const h=X.adversaries||[];if(h.length===0){alert("No custom adversaries to export.");return}const I=["name","tier","type","difficulty","threshold_major","threshold_severe","hp_max","stress_max","atk","weapon","range","damage","description","motives"],N=h.map(de=>{var K,he;return[de.name||"",de.tier||"",de.type||"",de.difficulty||"",((K=de.thresholds)==null?void 0:K.major)||"",((he=de.thresholds)==null?void 0:he.severe)||"",de.hpMax||"",de.stressMax||"",de.atk||"",de.weapon||"",de.range||"",de.damage||"",de.description||"",de.motives||""]}),O=de=>{const K=String(de);return K.includes(",")||K.includes('"')||K.includes(`
`)?`"${K.replace(/"/g,'""')}"`:K},te=[I.join(","),...N.map(de=>de.map(O).join(","))].join(`
`),ye=new Blob([te],{type:"text/csv;charset=utf-8;"}),me=URL.createObjectURL(ye),pe=document.createElement("a");pe.href=me,pe.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(pe),pe.click(),document.body.removeChild(pe),URL.revokeObjectURL(me),console.log(`Exported ${h.length} custom adversaries to CSV`)}catch(h){console.error("Failed to export custom adversaries:",h),alert("Failed to export custom adversaries. Please try again.")}},s=h=>{const I=h.target.files[0];if(!I)return;const N=I.name.endsWith(".csv"),O=I.name.endsWith(".json");if(!N&&!O){alert("Please upload a CSV or JSON file."),h.target.value="";return}const te=new FileReader;te.onload=ye=>{try{let me=[];if(N){const re=ye.target.result.split(`
`).filter(je=>je.trim());if(re.length<2)throw new Error("CSV file is empty or invalid.");const ue=re[0].split(",").map(je=>je.trim().replace(/^"|"$/g,""));for(let je=1;je<re.length;je++){const be=[];let Ne="",Fe=!1;for(let De=0;De<re[je].length;De++){const Oe=re[je][De],yt=re[je][De+1];Oe==='"'&&Fe&&yt==='"'?(Ne+='"',De++):Oe==='"'?Fe=!Fe:Oe===","&&!Fe?(be.push(Ne.trim()),Ne=""):Ne+=Oe}be.push(Ne.trim());const st={name:be[ue.indexOf("name")]||"",tier:parseInt(be[ue.indexOf("tier")])||1,type:be[ue.indexOf("type")]||"Standard",difficulty:parseInt(be[ue.indexOf("difficulty")])||11,thresholds:{major:parseInt(be[ue.indexOf("threshold_major")])||7,severe:parseInt(be[ue.indexOf("threshold_severe")])||12},hpMax:parseInt(be[ue.indexOf("hp_max")])||3,stressMax:parseInt(be[ue.indexOf("stress_max")])||1,atk:parseInt(be[ue.indexOf("atk")])||1,weapon:be[ue.indexOf("weapon")]||"",range:be[ue.indexOf("range")]||"Melee",damage:be[ue.indexOf("damage")]||"",description:be[ue.indexOf("description")]||"",motives:be[ue.indexOf("motives")]||"",source:"Homebrew"};st.name&&me.push(st)}}else if(O){const ve=JSON.parse(ye.target.result);if(!ve.customAdversaries||!Array.isArray(ve.customAdversaries))throw new Error("Invalid JSON format. Expected customAdversaries array.");me=ve.customAdversaries}const pe=X.adversaries||[],de=[...pe];let K=0,he=0;me.forEach(ve=>{if(pe.some(ue=>ue.name===ve.name&&ue.source===ve.source))he++;else{const ue={...ve,id:`custom-adv-${Date.now()}-${Math.random().toString(36).slice(2,10)}`,hp:0,stress:0};de.push(ue),K++}}),K>0?(localStorage.setItem("daggerheart-custom-adversaries",JSON.stringify(de)),window.location.reload(),alert(`Import successful! Added ${K} new adversaries${he>0?`, skipped ${he} duplicates`:""}.`)):alert("No new adversaries were added. All imported adversaries already exist.")}catch(me){console.error("Failed to import custom adversaries:",me),alert(`Failed to import custom adversaries: ${me.message}`)}},te.readAsText(I),h.target.value=""},w=()=>{ce(null)},D=async(h,I)=>{I?J(I,h):ge(h)},v=h=>{_[h]?(k&&k(h),ae(I=>{const N={...I};return delete N[h],N}),T.current[h]&&(clearTimeout(T.current[h]),delete T.current[h])):(ae(I=>({...I,[h]:!0})),T.current[h]&&clearTimeout(T.current[h]),T.current[h]=setTimeout(()=>{ae(I=>{const N={...I};return delete N[h],N}),delete T.current[h]},3e3))};A.useEffect(()=>()=>{Object.values(T.current).forEach(h=>{clearTimeout(h)})},[]);const{searchTerm:n,setSearchTerm:d,sortFields:r,handleSort:o,filteredAndSortedData:g,loading:Z,selectedTiers:se,selectedTypes:G,showTierDropdown:U,setShowTierDropdown:le,showTypeDropdown:we,setShowTypeDropdown:Ce,tierFilterRef:Se,typeFilterRef:Ee,uniqueTiers:Ae,uniqueTypes:ze,handleTierSelect:We,handleTypeSelect:Te,isTierFiltered:Re,isTypeFiltered:Be,getDropdownStyle:x}=Yt(e,b,l,f,q),P=(()=>{const h=3*l+2,I=b.reduce((K,he)=>{if(he.type==="adversary"){const ve=He[he.item.type]||2;if(he.item.type==="Minion"){const re=Math.ceil(he.quantity/l);return K+re*ve}else return K+he.quantity*ve}return K},0);let N=0;b.filter(K=>K.type==="adversary"&&K.item.type==="Solo"&&K.quantity>0).reduce((K,he)=>K+he.quantity,0)>=2&&(N+=_e.twoOrMoreSolos);const te=b.some(K=>K.type==="adversary"&&K.item.type==="Bruiser"&&K.quantity>0),ye=b.some(K=>K.type==="adversary"&&K.item.type==="Horde"&&K.quantity>0),me=b.some(K=>K.type==="adversary"&&K.item.type==="Leader"&&K.quantity>0),pe=b.some(K=>K.type==="adversary"&&K.item.type==="Solo"&&K.quantity>0);return!te&&!ye&&!me&&!pe&&(N+=_e.noBruisersHordesLeadersSolos),h+N-I})(),B=h=>{S(h),z(!1)},W=y!=="all";return Z?t.jsx("div",{style:Y.browser,children:t.jsx("div",{style:Y.loading,children:"Loading..."})}):t.jsx(t.Fragment,{children:t.jsxs("div",{style:m?Y.browserWrapper:Y.browserWrapperNoContainer,children:[Q==="adversaries"&&t.jsxs(t.Fragment,{children:[t.jsx(Jt,{searchTerm:n,onSearchChange:d,type:e,partyControls:L}),t.jsx(Xt,{showCustomToggle:oe,onToggleCustom:E,filterCustom:q,onExportCustomAdversaries:u,onImportCustomAdversaries:s}),t.jsx("div",{className:"browser-content invisible-scrollbar",style:Y.browserContent,children:t.jsxs("table",{style:Y.browserTable,children:[t.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,backgroundColor:"var(--bg-primary)"},children:t.jsx(Kt,{sortFields:r,onSort:o,type:e,uniqueTiers:Ae,uniqueTypes:ze,selectedTiers:se,selectedTypes:G,showTierDropdown:U,setShowTierDropdown:le,showTypeDropdown:we,setShowTypeDropdown:Ce,tierFilterRef:Se,typeFilterRef:Ee,handleTierSelect:We,handleTypeSelect:Te,isTierFiltered:Re,isTypeFiltered:Be,getDropdownStyle:x,costFilter:y,showCostDropdown:j,setShowCostDropdown:z,costFilterRef:i,handleCostFilterSelect:B,isCostFiltered:W})}),t.jsx("tbody",{children:g.map(h=>t.jsx(Qt,{item:h,onAdd:a,type:e,onRowClick:p,encounterItems:b,pcCount:l,playerTier:f,remainingBudget:P,costFilter:y,onAdversaryClick:I=>{e==="adversary"&&(F&&F.id===I.id?V&&V(null):V&&V(I))}},h.id))})]})})]}),Q==="encounters"&&t.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:R.length===0?t.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",textAlign:"center",padding:"2rem 1rem"},children:"No saved encounters yet"}):t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:R.map(h=>t.jsxs("div",{onClick:()=>H&&H(h.id),className:"saved-encounter-card",style:{border:"1px solid var(--border)",borderRadius:"8px",padding:"8px",backgroundColor:"var(--bg-card)",transition:"background-color 0.2s ease",display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[t.jsxs("div",{style:{minWidth:"100px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",flexDirection:"column",justifyContent:"center",minHeight:"60px"},children:[t.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Tier: ",(()=>{var O,te,ye,me;const I=((me=(ye=(te=(O=h.encounterItems)==null?void 0:O.filter(pe=>pe.type==="adversary"))==null?void 0:te.map(pe=>pe.item.tier))==null?void 0:ye.filter(pe=>pe!=null))==null?void 0:me.sort((pe,de)=>pe-de))||[];if(I.length===0)return"N/A";if(I.length===1)return I[0];const N=[...new Set(I)];return N.length===1?N[0]:`${Math.min(...N)}-${Math.max(...N)}`})()]}),t.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Party Size: ",h.partySize||4]}),t.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)"},children:["Balance: ",(()=>{const I=h.partySize||4,N=3*I+2;let O=0;const te=h.encounterItems||[];te.filter(re=>re.type==="adversary"&&re.item.type==="Solo"&&re.quantity>0).reduce((re,ue)=>re+ue.quantity,0)>=2&&(O+=_e.twoOrMoreSolos);const me=te.some(re=>re.type==="adversary"&&re.item.type==="Bruiser"&&re.quantity>0),pe=te.some(re=>re.type==="adversary"&&re.item.type==="Horde"&&re.quantity>0),de=te.some(re=>re.type==="adversary"&&re.item.type==="Leader"&&re.quantity>0),K=te.some(re=>re.type==="adversary"&&re.item.type==="Solo"&&re.quantity>0);!me&&!pe&&!de&&!K&&(O+=_e.noBruisersHordesLeadersSolos);const he=N+O,ve=te.reduce((re,ue)=>{if(ue.type==="adversary"){const je=He[ue.item.type]||2;if(ue.item.type==="Minion"){const be=Math.ceil(ue.quantity/I);return re+be*je}else return re+ue.quantity*je}return re},0);return ve>he?`+${ve-he}`:ve===he?"0":`-${he-ve}`})()]})]}),t.jsx("div",{style:{minWidth:"120px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",alignItems:"center",minHeight:"60px"},children:t.jsx("div",{style:{fontWeight:"500",color:"var(--text-primary)",fontSize:"0.9rem",wordWrap:"break-word",wordBreak:"break-word",width:"150px",maxWidth:"150px"},children:h.name})}),t.jsx(_t,{encounter:h}),t.jsx("button",{onClick:I=>{I.stopPropagation(),v(h.id)},style:{background:_[h.id]?"var(--danger)":"var(--gray-600)",border:"none",color:"white",padding:"0.4rem 0.8rem",borderRadius:"4px",fontSize:"0.75rem",cursor:"pointer",minWidth:"60px",transition:"background-color 0.2s"},children:"Delete"})]},h.id))})}),Q==="create"&&t.jsx(Vt,{onSave:D,onRefresh:()=>{},onAddItem:a,editingAdversary:ne,onCancelEdit:w}),Q==="info"&&t.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"2rem"},children:[t.jsxs("div",{style:{marginBottom:"2rem",textAlign:"center"},children:[t.jsx("img",{src:$t,alt:"Daggerheart Community Content Logo",style:{width:"100%",maxWidth:"300px",height:"auto",margin:"0 auto 1.5rem auto",display:"block"},onError:h=>{console.error("Failed to load Daggerheart logo:",h.target.src),h.target.style.display="none"}}),t.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",textAlign:"left",maxWidth:"600px",margin:"0 auto"},children:[t.jsx("p",{style:{marginTop:0},children:"This product includes materials from the Daggerheart System Reference Document 1.0, © Critical Role, LLC, under the terms of the Darrington Press Community Gaming (DPCGL) License."}),t.jsxs("p",{children:["More information can be found at ",t.jsx("a",{href:"https://www.daggerheart.com",target:"_blank",rel:"noopener noreferrer",style:{color:"var(--purple)",textDecoration:"underline"},children:"daggerheart.com"})]}),t.jsx("p",{style:{marginBottom:0},children:t.jsx("em",{children:"This project is unofficial and not endorsed by Darrington Press or Critical Role."})})]})]}),t.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto",border:"1px solid var(--border)",borderRadius:"8px",overflow:"hidden"},children:[t.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"1rem 1.5rem",color:"var(--text-primary)",border:"none",background:"var(--bg-secondary)",width:"100%",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"0.875rem",borderBottom:"1px solid var(--border)"},onMouseEnter:h=>{h.target.style.backgroundColor="var(--bg-hover)"},onMouseLeave:h=>{h.target.style.backgroundColor="var(--bg-secondary)"},onClick:h=>{h.stopPropagation(),window.open("https://github.com/Splinter714/Daggerheart","_blank")},children:[t.jsx("span",{children:"View on GitHub"}),t.jsx("span",{children:"→"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem 1.5rem",color:"var(--text-secondary)",background:"var(--bg-secondary)",fontSize:"0.875rem"},children:["Version ","0.4.2 (3155005)"]})]})]})]})})},Y={browserWrapper:{display:"flex",flexDirection:"column",background:"var(--bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border)",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserWrapperNoContainer:{display:"flex",flexDirection:"column",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserContent:{flex:1,overflowY:"auto",overflowX:"visible",padding:0,width:"100%",scrollbarWidth:"none",msOverflowStyle:"none"},tableHeaderContainer:{flexShrink:0,position:"sticky",top:0,zIndex:15,backgroundColor:"var(--bg-secondary)"},browserTable:{width:"100%",minWidth:"100%",borderCollapse:"collapse",tableLayout:"fixed",background:"var(--bg-primary)",margin:0},browserHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--gray-900)",flexShrink:0,position:"sticky",top:0,zIndex:20},browserTitle:{margin:0,color:"var(--text-primary)",fontSize:"18px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"24px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",marginRight:"12px",transition:"all 0.2s ease"},partyControls:{display:"flex",alignItems:"center",gap:"12px",flexShrink:0},searchInputFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 3px rgba(139, 92, 246, 0.1)"},tableHeader:{background:"var(--gray-900)",borderBottom:"1px solid var(--border)",boxShadow:"0 1px 0 var(--border)",position:"sticky",top:"0",zIndex:10},tableHeaderCell:{backgroundColor:"var(--gray-900)",fontWeight:"700",borderBottom:"1px solid var(--border)",cursor:"pointer",userSelect:"none",minWidth:"100px",whiteSpace:"nowrap",padding:"4px 4px",color:"var(--text-primary)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",boxShadow:"0 1px 0 var(--border)",transition:"background-color 0.2s",position:"sticky",top:"0",zIndex:10},tableHeaderCellHover:{backgroundColor:"var(--bg-hover)"},sortIndicator:{fontSize:"12px",color:"var(--text-secondary)"},tableBody:{flex:1,overflowY:"auto",padding:"8px",backgroundColor:"var(--bg-primary)"},row:{height:"35px",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s ease",cursor:"pointer",backgroundColor:"var(--gray-900)"},rowHover:{backgroundColor:"var(--bg-secondary)"},expandedRow:{backgroundColor:"var(--bg-secondary)"},rowCell:{padding:"4px 4px",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid var(--border)"},rowCellName:{fontWeight:"500",minWidth:"150px"},rowCellCenter:{textAlign:"center",justifyContent:"center",minWidth:"80px"},rowActions:{width:"80px",textAlign:"center",padding:"4px 8px",borderBottom:"1px solid var(--border)"},addButton:{width:"2rem",height:"2rem",border:"1px solid var(--purple)",borderRadius:"var(--radius-sm)",background:"var(--purple)",color:"white",cursor:"pointer",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"500"},expandedContent:{padding:"0",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)"},columnName:{width:"auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",paddingLeft:"8px",textAlign:"left"},columnTier:{width:"80px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnType:{width:"100px",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},columnDifficulty:{width:"40px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnAction:{width:"32px",minWidth:"24px",maxWidth:"24px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"visible",textOverflow:"unset"},loading:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"var(--text-primary)",fontSize:"16px"},mobileBrowser:{width:"95vw",height:"90vh",maxWidth:"none"},mobileSearchInput:{fontSize:"16px"},headerWithFilter:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0px",position:"relative"},headerFilterIcon:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"2px 4px",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",position:"relative",marginLeft:"-2px"},headerFilterIconActive:{color:"var(--purple)"},filterIcon:{fontSize:"12px"},filterActiveDot:{position:"absolute",left:"50%",top:"2px",transform:"translateX(-50%)",width:"4px",height:"4px",borderRadius:"50%",background:"var(--purple)",pointerEvents:"none"},filterDropdown:{position:"fixed",background:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",zIndex:99999,marginTop:"4px",overflow:"hidden",width:"max-content",minWidth:"120px",maxWidth:"200px"},filterOption:{padding:"8px 12px",cursor:"pointer",color:"var(--text-primary)",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background-color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},filterOptionSelected:{backgroundColor:"var(--bg-hover)"},checkIcon:{width:"16px",height:"16px",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"12px"},filterLabel:{flex:1}},Ut=()=>t.jsx("div",{className:"pwa-install-prompt",style:{}}),er=({side:e="left",children:a,className:c="",style:p={}})=>{const b=e==="left",l={flex:1,minWidth:0,background:"var(--bg-primary)",overflowY:"auto",overflowX:b?"auto":"hidden",display:b?"block":"flex",flexDirection:b?"initial":"column",height:"100%",padding:b?"8px 0 8px 0":"0 8px 0 0",...p};return t.jsx("div",{className:c,style:l,children:a})},tr=e=>3*e+2,rr={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},Ue={lessDifficult:-1,twoOrMoreSolos:-2,increasedDamage:-2,lowerTierAdversary:1,noBruisersHordesLeadersSolos:1,moreDangerous:2},nr=({isOpen:e,onClose:a,onAddAdversary:c,onAddAdversariesBulk:p,onAddEnvironment:b,onDeleteAdversary:l,onDeleteEnvironment:f,onDeleteCountdown:L,adversaries:m=[],environments:R=[],countdowns:H=[],savedEncounters:k=[],onSaveEncounter:Q,onLoadEncounter:C,onDeleteEncounter:$})=>{const{partySize:ee,updatePartySize:F,currentEncounterName:V,updateCurrentEncounterName:q,customContent:oe}=nt(),E=ee,ie=F,[xe,ge]=A.useState({lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),[J,X]=A.useState([]),[ne,ce]=A.useState(V||"Encounter"),[y,S]=A.useState("adversaries"),[j,z]=A.useState(null),[_,ae]=A.useState(null),[T,i]=A.useState(null),[u,s]=A.useState(null),[w,D]=A.useState(!1);A.useEffect(()=>{e&&!j&&ce(V||"Encounter")},[e,j,V]);const v=()=>_?ne!==_.name||JSON.stringify(J)!==JSON.stringify(_.encounterItems)||E!==_.partySize||JSON.stringify(xe)!==JSON.stringify(_.battlePointsAdjustments):!1,n=()=>{var x;if(J.length>0||(ne||"").trim()!=="Encounter")return!0;if(j&&v()){if(_){const M=J.length,P=((x=_.encounterItems)==null?void 0:x.length)||0;if(M!==P||(ne||"").trim()!==(_.name||""))return!0;const B=JSON.stringify(xe),W=JSON.stringify(_.battlePointsAdjustments||{});return B!==W}return!0}return!1},d=({onClick:x,children:M,variant:P="secondary",isConfirmation:B=!1})=>{const W=P==="danger"||P==="secondary"&&B,h=P==="purple";return t.jsx("button",{onClick:x,style:{background:W?"var(--danger)":h?"var(--purple)":"var(--bg-secondary)",border:h?"none":"1px solid var(--border)",color:W||h?"white":"var(--text-primary)",padding:"0.375rem 0.75rem",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s",width:"70px",fontSize:"0.875rem"},children:M})},r=ke.useRef(E),o=A.useCallback(x=>!x||x.length===0?null:k.find(P=>{var I,N;if(((I=P.encounterItems)==null?void 0:I.length)!==x.length)return!1;const B=O=>{var te;return{type:O.type,quantity:O.quantity,item:{name:O.item.baseName||((te=O.item.name)==null?void 0:te.replace(/\s+\(\d+\)$/,""))||O.item.name,type:O.item.type,tier:O.item.tier}}},W=(N=P.encounterItems)==null?void 0:N.map(B).sort((O,te)=>O.item.name.localeCompare(te.item.name)||O.item.type.localeCompare(te.item.type)),h=x.map(B).sort((O,te)=>O.item.name.localeCompare(te.item.name)||O.item.type.localeCompare(te.item.type));return JSON.stringify(W)===JSON.stringify(h)})||null,[k]);ke.useEffect(()=>{if(e&&m.length>0&&J.length===0){const x={};m.forEach(B=>{var h;const W=B.baseName||((h=B.name)==null?void 0:h.replace(/\s+\(\d+\)$/,""))||B.name;x[W]||(x[W]={type:"adversary",item:B,quantity:0}),x[W].quantity+=1});const M=Object.values(x);X(M);const P=o(M);P&&!j&&(z(P.id),ae({name:P.name||"",encounterItems:P.encounterItems||[],partySize:P.partySize||4,battlePointsAdjustments:P.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),ce(P.name||"Encounter"),q(P.name||"Encounter"))}else e&&m.length===0&&J.length===0&&X([])},[e,o,j,q]);const g=ke.useMemo(()=>{let x=0;J.filter(I=>I.type==="adversary"&&I.item.type==="Solo"&&I.quantity>0).reduce((I,N)=>I+N.quantity,0)>=2&&(x+=Ue.twoOrMoreSolos);const P=J.some(I=>I.type==="adversary"&&I.item.type==="Bruiser"&&I.quantity>0),B=J.some(I=>I.type==="adversary"&&I.item.type==="Horde"&&I.quantity>0),W=J.some(I=>I.type==="adversary"&&I.item.type==="Leader"&&I.quantity>0),h=J.some(I=>I.type==="adversary"&&I.item.type==="Solo"&&I.quantity>0);return!P&&!B&&!W&&!h&&(x+=Ue.noBruisersHordesLeadersSolos),x},[J]),Z=tr(E),se=Object.entries(xe).filter(([x,M])=>M).reduce((x,[M,P])=>x+Ue[M],0),G=Z+se+g,U=J.reduce((x,M)=>{if(M.type==="adversary"){const P=rr[M.item.type]||2;return M.item.type==="Minion"?x+Math.ceil(M.quantity/E)*P:x+P*M.quantity}return x},0);ke.useEffect(()=>{const x=r.current;x!==E&&(X(M=>M.map(P=>{if(P.type==="adversary"&&P.item.type==="Minion"){const W=Math.ceil(P.quantity/x)*E;return{...P,quantity:W}}return P})),r.current=E)},[E]);const le=(x,M)=>{const P=J.findIndex(h=>h.item.id===x.id&&h.type===M),B=x.type==="Minion"?E:1;let W;P>=0?W=J.map((h,I)=>I===P?{...h,quantity:h.quantity+B}:h):W=[...J,{item:x,type:M,quantity:B}],X(W),we(W)},we=x=>{const M=m||[],P=[];x.forEach(N=>{for(let O=0;O<N.quantity;O++)N.type==="adversary"&&P.push(N.item)});const B={};M.forEach(N=>{var te;const O=N.baseName||((te=N.name)==null?void 0:te.replace(/\s+\(\d+\)$/,""))||N.name;B[O]||(B[O]=[]),B[O].push(N)});const W={};P.forEach(N=>{var te;const O=N.baseName||((te=N.name)==null?void 0:te.replace(/\s+\(\d+\)$/,""))||N.name;W[O]||(W[O]=[]),W[O].push(N)});const h=[],I=[];Object.keys(W).forEach(N=>{var ye;const O=((ye=B[N])==null?void 0:ye.length)||0,te=W[N].length;if(te>O){const me=te-O;for(let pe=0;pe<me;pe++)h.push(W[N][0])}else if(te<O){const me=O-te,de=[...B[N]].sort((K,he)=>{const ve=K.duplicateNumber||1;return(he.duplicateNumber||1)-ve});for(let K=0;K<me;K++)I.push(de[K].id)}}),Object.keys(B).forEach(N=>{W[N]||[...B[N]].sort((ye,me)=>{const pe=ye.duplicateNumber||1;return(me.duplicateNumber||1)-pe}).forEach(ye=>{I.push(ye.id)})}),I.forEach(N=>{l(N)}),h.length>0&&p(h)},Ce=(x,M)=>{const P=(()=>{const B=J.findIndex(W=>W.item.id===x&&W.type===M);if(B>=0){const W=J[B];if(W.quantity===0)return J.filter((N,O)=>O!==B);const h=W.item.type==="Minion"?E:1,I=Math.max(0,W.quantity-h);return J.map((N,O)=>O===B?{...N,quantity:I}:N)}return J})();X(P),we(P)},Se=A.useCallback(()=>{if(J.length===0)return null;const x=(ne||"").trim()||"Encounter",M=k.find(P=>{var h,I;if(P.name!==x||((h=P.encounterItems)==null?void 0:h.length)!==J.length)return!1;const B=JSON.stringify((I=P.encounterItems)==null?void 0:I.sort()),W=JSON.stringify([...J].sort());return B===W});return(M==null?void 0:M.id)||null},[k,ne,J]),Ee=A.useCallback(()=>{let x=(ne||"").trim(),M=j;if(M||(M=Se()),J.length===0&&(!x||x==="Encounter")&&M){$(M),z(null),ae(null);return}const P={name:x,encounterItems:J,partySize:E,battlePointsAdjustments:xe};if(M){P.id=M;const B=Q(P);z(B)}else{const B=Q(P);z(B)}ae({name:x,encounterItems:J,partySize:E,battlePointsAdjustments:xe})},[J,ne,E,xe,j,Q,Se,$]);A.useEffect(()=>{if(j&&v()){const x=setTimeout(()=>{Ee()},2e3);return()=>clearTimeout(x)}else if(!j&&J.length>0&&ne&&ne.trim()!==""){const x=setTimeout(()=>{Ee()},2e3);return()=>clearTimeout(x)}},[J,j,ne,xe,E]);const Ae=()=>{n()&&(X([]),ce("Encounter"),q("Encounter"),z(null),ae(null),m.forEach(x=>{l(x.id)}),R.forEach(x=>{f(x.id)}),H.forEach(x=>{L(x.id)}))},ze=x=>{const M=C(x);if(M){const P=M.encounterItems||[];X(P),ie(M.partySize||4),ge(M.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),ce(M.name||""),q(M.name||""),z(x),ae({name:M.name||"",encounterItems:M.encounterItems||[],partySize:M.partySize||4,battlePointsAdjustments:M.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),we(P)}},We=x=>{$(x),j===x&&(X([]),ce("Encounter"),q("Encounter"),z(null),ae(null),m.forEach(M=>{l(M.id)}),R.forEach(M=>{f(M.id)}),H.forEach(M=>{L(M.id)}))},Te=()=>{try{const x={version:"1.0",exportDate:new Date().toISOString(),customAdversaries:oe.adversaries||[]},M=JSON.stringify(x,null,2),P=new Blob([M],{type:"application/json"}),B=URL.createObjectURL(P),W=document.createElement("a");W.href=B,W.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(W),W.click(),document.body.removeChild(W),URL.revokeObjectURL(B),console.log("Custom adversaries exported successfully")}catch(x){console.error("Failed to export custom adversaries:",x),alert("Failed to export custom adversaries. Please try again.")}},Re=x=>{const M=x.target.files[0];if(!M)return;const P=new FileReader;P.onload=B=>{try{const W=JSON.parse(B.target.result);if(!W.customAdversaries||!Array.isArray(W.customAdversaries))throw new Error("Invalid file format. Expected customAdversaries array.");const h=oe.adversaries||[],I=W.customAdversaries,N=[...h];let O=0;I.forEach(te=>{h.some(me=>me.name===te.name&&me.type===te.type)||(N.push({...te,id:`custom-${Date.now()}-${Math.random().toString(36).slice(2,10)}`}),O++)}),updateCustomContent("adversary",null,N),O>0?alert(`Successfully imported ${O} custom adversaries.`):alert("No new adversaries were added. All imported adversaries already exist.")}catch(W){console.error("Failed to import custom adversaries:",W),alert("Failed to import custom adversaries. Please check the file format and try again.")}},P.readAsText(M),x.target.value=""};if(!e)return null;const Be=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://");return t.jsx("div",{onClick:a,className:"encounter-builder-modal",style:{position:"fixed",top:0,left:0,right:0,bottom:Be?"calc(60px + env(safe-area-inset-bottom) + 1rem)":"calc(60px + env(safe-area-inset-bottom))",backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:1e3,display:"flex",alignItems:"flex-start",justifyContent:"center",padding:"12px"},children:t.jsxs("div",{onClick:x=>x.stopPropagation(),style:{backgroundColor:"var(--bg-primary)",border:"2px solid var(--border)",borderRadius:"12px",width:"100%",maxWidth:"1200px",height:"100%",maxHeight:"100%",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"},children:[t.jsxs("div",{className:"encounter-top-bar",style:{flex:"0 0 auto",display:"flex",alignItems:"center",height:"39px",backgroundColor:"var(--bg-primary)",borderBottom:"1px solid var(--border)"},children:[t.jsx("button",{onClick:()=>S("adversaries"),style:{flex:1,background:y==="adversaries"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:y==="adversaries"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Builder"}),t.jsx("button",{onClick:()=>S("encounters"),style:{flex:1,background:y==="encounters"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:y==="encounters"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Saved Encounters"}),t.jsx("button",{onClick:()=>S("create"),style:{flex:1,background:y==="create"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:y==="create"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Create Adversary"}),t.jsx("button",{onClick:()=>S("info"),style:{flex:1,background:y==="info"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:y==="info"?"500":"400",transition:"all 0.2s ease",position:"relative"},children:"Info"})]}),t.jsxs("div",{className:"encounter-builder-content",style:{flex:1,display:"flex",overflow:"hidden"},children:[t.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",borderTop:"1px solid var(--border)"},children:t.jsx(Zt,{type:"adversary",onAddItem:x=>le(x,"adversary"),encounterItems:J,pcCount:E,showContainer:!1,savedEncounters:k,onLoadEncounter:ze,onDeleteEncounter:We,activeTab:y,selectedCustomAdversaryId:T,onSelectCustomAdversary:i,onTabChange:S,selectedAdversary:u,onSelectAdversary:s,filterCustom:w,showCustomToggle:!0,onToggleCustom:D,onExportCustomAdversaries:Te,onImportCustomAdversaries:Re})}),y!=="info"&&t.jsxs("div",{className:"encounter-right-panel",style:{flex:1,borderLeft:"1px solid var(--border)",display:"flex",flexDirection:"column",overflow:"hidden",position:"relative"},children:[u&&t.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"var(--bg-primary)",zIndex:10,display:"flex",flexDirection:"column"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)",flexShrink:0},children:[t.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:0},children:"Adversary Preview"}),t.jsx("button",{onClick:()=>s(null),style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease"},onMouseEnter:x=>x.target.style.color="var(--text-primary)",onMouseLeave:x=>x.target.style.color="var(--text-secondary)",title:"Close preview",children:t.jsx(Ge,{size:16})})]}),t.jsx("div",{style:{flex:1,overflowY:"auto",padding:"0.75rem"},children:t.jsx(Ye,{item:{...u,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...u,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}})})]}),(y==="adversaries"||y==="encounters")&&t.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-primary)",flexShrink:0},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[t.jsx("input",{type:"text",value:ne,onChange:x=>{ce(x.target.value),q(x.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),t.jsx(d,{onClick:Ae,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:n()?1:.5,cursor:n()?"pointer":"not-allowed"},children:"New"})]})}),(y==="adversaries"||y==="encounters")&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"encounter-receipt-buttons-vertical",style:{display:"none",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[t.jsx("input",{type:"text",value:ne,onChange:x=>{ce(x.target.value),q(x.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),t.jsx(d,{onClick:Ae,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:n()?1:.5,cursor:n()?"pointer":"not-allowed"},children:"New"})]})}),t.jsx("div",{className:"receipt-content",style:{padding:"1rem",display:"flex",flexDirection:"column",height:"100%"},children:t.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"flex-start",overflowY:"auto",marginBottom:"0.75rem"},children:[t.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[t.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[t.jsx("button",{onClick:()=>ie(Math.max(1,E-1)),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:t.jsx(at,{size:10})}),t.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:E}),t.jsx("button",{onClick:()=>ie(E+1),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:t.jsx(it,{size:10})})]}),t.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Party Size"})}),t.jsx("div",{style:{width:"120px",textAlign:"right"}})]}),J.map(x=>{var M;return x.type!=="adversary"?null:t.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[t.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[t.jsx("button",{onClick:()=>Ce(x.item.id,x.type),style:{background:x.quantity===0?"var(--danger)":"var(--bg-secondary)",border:x.quantity===0?"none":"1px solid var(--border)",color:x.quantity===0?"white":"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:x.quantity===0?t.jsx(Ge,{size:10}):t.jsx(at,{size:10})}),t.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:x.quantity}),t.jsx("button",{onClick:()=>le(x.item,x.type),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:t.jsx(it,{size:10})})]}),t.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:x.item.baseName||((M=x.item.name)==null?void 0:M.replace(/\s+\(\d+\)$/,""))||x.item.name})}),t.jsx("div",{style:{width:"80px",textAlign:"right"},children:t.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.8rem"},children:x.item.type})})]},`${x.item.id}-${x.type}`)}),t.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[t.jsx("div",{style:{flex:1,display:"flex",alignItems:"center"},children:t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Balance"})}),t.jsx("div",{style:{width:"120px",textAlign:"right",display:"flex",alignItems:"center",justifyContent:"flex-end"},children:t.jsx("span",{style:{color:U>G?"var(--danger)":U===G?"var(--purple)":"var(--success)",fontWeight:600},children:U>G?`+${U-G}`:G-U===0?"0":`-${G-U}`})})]})]})})]}),y==="create"&&t.jsxs("div",{style:{padding:"1.5rem",overflowY:"auto",height:"100%"},children:[t.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Creating Adversaries"}),t.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",display:"flex",flexDirection:"column",gap:"1rem"},children:[t.jsx("p",{children:"Use the form to create custom adversaries for your encounters."}),t.jsxs("div",{children:[t.jsx("strong",{style:{color:"var(--text-primary)"},children:"Adversary Types:"}),t.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Minion (1 BP):"})," Weak enemies in groups"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Standard (2 BP):"})," Average threat level"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Leader (3 BP):"})," Commands others"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Bruiser (4 BP):"})," High HP tank"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Solo (5 BP):"})," Boss-level threat"]})]})]}),t.jsxs("div",{children:[t.jsx("strong",{style:{color:"var(--text-primary)"},children:"Tips:"}),t.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[t.jsx("li",{children:"Match adversary tier to party level"}),t.jsx("li",{children:"Balance encounter difficulty with Battle Points"}),t.jsx("li",{children:"Mix adversary types for variety"}),t.jsx("li",{children:"Add features that create interesting choices"})]})]})]})]}),y==="myAdversaries"&&t.jsx("div",{style:{padding:"0.75rem",overflowY:"auto",height:"100%"},children:T?(()=>{var M;const x=(M=oe==null?void 0:oe.adversaries)==null?void 0:M.find(P=>P.id===T);return x?t.jsx(Ye,{item:{...x,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...x,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}}):t.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Adversary not found"})})():t.jsxs("div",{children:[t.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Adversary Preview"}),t.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Select an adversary to view details"})]})})]})]})]})})};class sr extends ke.Component{constructor(a){super(a),this.state={hasError:!1,error:null}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,c){console.error("ErrorBoundary caught an error:",a,c)}render(){var a;return this.state.hasError?t.jsxs("div",{className:"p-md text-red",children:[t.jsx("h3",{children:"Something went wrong:"}),t.jsx("pre",{children:(a=this.state.error)==null?void 0:a.toString()}),t.jsx("button",{className:"btn-base btn-text",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try again"})]}):this.props.children}}const or=()=>{const{adversaries:e,environments:a,countdowns:c,fear:p,savedEncounters:b,updateFear:l,createAdversary:f,createAdversariesBulk:L,updateAdversary:m,deleteAdversary:R,createEnvironment:H,updateEnvironment:k,deleteEnvironment:Q,createCountdown:C,updateCountdown:$,deleteCountdown:ee,advanceCountdown:F,saveEncounter:V,loadEncounter:q,deleteEncounter:oe}=nt(),[E,ie]=A.useState(!1),[xe,ge]=A.useState(!1);A.useState(!1),A.useState(!1),A.useState(!0);const[J,X]=A.useState(null),[ne,ce]=A.useState(0),[y,S]=A.useState(0),[j,z]=A.useState(!1);A.useEffect(()=>{const r=()=>{const g=window.matchMedia("(max-width: 800px)");ie(g.matches)};r();const o=window.matchMedia("(max-width: 800px)");return o.addEventListener("change",r),()=>o.removeEventListener("change",r)},[]);const _=12,ae=r=>r===1?200:350,T=r=>{if(r<=0)return{visibleColumns:1,columnWidth:ae(1)};const o=_*2,g=r-o;let Z={visibleColumns:1,columnWidth:g};for(let G=1;G<=5;G++){const U=(G-1)*_,le=(g-U)/G;le>=ae(G)&&G*le+U<=g&&(Z={visibleColumns:G,columnWidth:le})}return Z.visibleColumns*Z.columnWidth+(Z.visibleColumns-1)*_>g&&(Z={visibleColumns:1,columnWidth:g}),Z},{visibleColumns:i,columnWidth:u}=T(ne);A.useEffect(()=>{const r=()=>{ce(window.innerWidth)};return r(),window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]);const s=()=>{ge(!0)},w=()=>{ge(!xe)},D=A.useCallback(()=>{ge(!1)},[]),v=A.useCallback(r=>{S(r.target.scrollLeft)},[]);A.useCallback(()=>{z(!0)},[]),A.useCallback(()=>{setTimeout(()=>z(!1),100)},[]);const d=(()=>{const r={};return e.forEach(o=>{var Z;const g=o.baseName||((Z=o.name)==null?void 0:Z.replace(/\s+\(\d+\)$/,""))||o.name;r[g]||(r[g]={type:"adversary",baseName:g,instances:[]}),r[g].instances.push(o)}),c.forEach(o=>{r[`countdown-${o.id}`]={type:"countdown",baseName:o.name,instances:[o]}}),Object.values(r)})();return d.length,t.jsxs("div",{className:"app",onClick:r=>{r.target,r.currentTarget},children:[t.jsx(Dt,{onToggle:w,isOpen:xe}),t.jsx("div",{className:"main-content",style:{position:"relative",width:"100%"},children:t.jsx("div",{className:"dashboard-scroll-container",style:{display:"flex",flexDirection:"row",overflowX:"auto",overflowY:"hidden",padding:`0 ${_}px`,scrollSnapType:"x mandatory",height:"100%",width:"100%"},onScroll:v,children:d.length===0?t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",width:"100%",padding:"2rem"},children:t.jsx("button",{onClick:s,style:{backgroundColor:"transparent",color:"var(--text-secondary)",border:"2px dashed var(--border)",borderRadius:"var(--radius-md)",padding:"1rem 2rem",fontSize:"1rem",fontWeight:"500",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:r=>{r.target.style.borderColor="var(--purple)",r.target.style.color="var(--purple)"},onMouseLeave:r=>{r.target.style.borderColor="var(--border)",r.target.style.color="var(--text-secondary)"},children:"Create Encounter"})}):d.map((r,o)=>t.jsx(er,{className:"invisible-scrollbar",style:{width:`${u+_}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:`${_}px`,paddingRight:"0",paddingTop:`${_}px`,paddingBottom:`${_}px`,scrollSnapAlign:"start",overflowY:"auto",overflowX:"hidden"},children:t.jsx(Ye,{type:r.type,item:{...r.instances[0],name:r.baseName,hp:0,stress:0,isDead:!1},mode:"expanded",instances:r.instances,onApplyDamage:r.type==="adversary"?(g,Z,se,G)=>{const U=r.instances.find(le=>le.id===g);U&&m(g,{hp:Math.min(U.hpMax||1,(U.hp||0)+Z)})}:void 0,onApplyHealing:r.type==="adversary"?(g,Z,se)=>{const G=r.instances.find(U=>U.id===g);G&&m(g,{hp:Math.max(0,(G.hp||0)-Z)})}:void 0,onApplyStressChange:r.type==="adversary"?(g,Z)=>{var se,G;return m(g,{stress:Math.max(0,Math.min(((se=r.instances.find(U=>U.id===g))==null?void 0:se.stressMax)||6,(((G=r.instances.find(U=>U.id===g))==null?void 0:G.stress)||0)+Z))})}:void 0,onUpdate:r.type==="adversary"?m:r.type==="environment"?k:$,adversaries:e})},`${r.type}-${r.baseName}`))})}),t.jsx(Lt,{position:"bottom",children:t.jsx(Le,{type:"fear",value:(p==null?void 0:p.value)||0,maxValue:12,onChange:l,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0})}),t.jsx(nr,{isOpen:xe,onClose:D,onAddAdversary:r=>{f(r),X("adversary")},onAddAdversariesBulk:r=>{L(r),X("adversary")},onAddEnvironment:r=>{H(r),X("environment")},onDeleteAdversary:R,onDeleteEnvironment:Q,onDeleteCountdown:ee,adversaries:e,environments:a,countdowns:c,savedEncounters:b,onSaveEncounter:V,onLoadEncounter:q,onDeleteEncounter:oe}),t.jsx(Ut,{})]})},ar=()=>t.jsx(sr,{children:t.jsx(or,{})});tt.createRoot(document.getElementById("root")).render(t.jsx(ke.StrictMode,{children:t.jsx(Nt,{children:t.jsx(ar,{})})}));
