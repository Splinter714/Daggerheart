import{r as m,a as at,R as Fe}from"./dndkit-57209f9c.js";import{F as Tt,f as zt,a as Rt,b as Wt,c as ut}from"./fa-b4bcccb0.js";import{D as wt,A as Lt,C as Nt,X as Ve,M as it,P as Ge,a as Bt,H as Pt,L as Ht,b as Dt,F as Ot,S as Xe,c as Ke}from"./lucide-9f8be461.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const j of document.querySelectorAll('link[rel="modulepreload"]'))c(j);new MutationObserver(j=>{for(const u of j)if(u.type==="childList")for(const v of u.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&c(v)}).observe(document,{childList:!0,subtree:!0});function p(j){const u={};return j.integrity&&(u.integrity=j.integrity),j.referrerPolicy&&(u.referrerPolicy=j.referrerPolicy),j.crossOrigin==="use-credentials"?u.credentials="include":j.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function c(j){if(j.ep)return;j.ep=!0;const u=p(j);fetch(j.href,u)}})();var Ct={exports:{}},tt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ft=m,$t=Symbol.for("react.element"),_t=Symbol.for("react.fragment"),qt=Object.prototype.hasOwnProperty,Vt=Ft.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Gt={key:!0,ref:!0,__self:!0,__source:!0};function St(t,o,p){var c,j={},u=null,v=null;p!==void 0&&(u=""+p),o.key!==void 0&&(u=""+o.key),o.ref!==void 0&&(v=o.ref);for(c in o)qt.call(o,c)&&!Gt.hasOwnProperty(c)&&(j[c]=o[c]);if(t&&t.defaultProps)for(c in o=t.defaultProps,o)j[c]===void 0&&(j[c]=o[c]);return{$$typeof:$t,type:t,key:u,ref:v,props:j,_owner:Vt.current}}tt.Fragment=_t;tt.jsx=St;tt.jsxs=St;Ct.exports=tt;var e=Ct.exports,lt={},mt=at;lt.createRoot=mt.createRoot,lt.hydrateRoot=mt.hydrateRoot;function De(t){const o=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return t?`${t}-${o}`:o}const jt=m.createContext();function rt(t){if(typeof localStorage>"u")return null;try{const o=localStorage.getItem(t);return o==null?null:JSON.parse(o)}catch{return null}}function Oe(t,o){if(!(typeof localStorage>"u"))try{localStorage.setItem(t,JSON.stringify(o))}catch{}}const Yt=({children:t})=>{const[o,p]=m.useState({fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],currentEncounterName:"Encounter"}),[c,j]=m.useState(!1),[u,v]=m.useState({adversaries:[],environments:[]});m.useEffect(()=>{var d,r,b,X;const l=rt("daggerheart-game-state");if(l)try{(((d=l.adversaries)==null?void 0:d.length)>0||((r=l.environments)==null?void 0:r.length)>0||((b=l.countdowns)==null?void 0:b.length)>0||((X=l.savedEncounters)==null?void 0:X.length)>0)&&p(l)}catch(z){console.error("Failed to load saved state:",z)}const g=rt("daggerheart-custom-adversaries")||[],h=rt("daggerheart-custom-environments")||[];v({adversaries:g,environments:h}),j(!0)},[]),m.useEffect(()=>{Oe("daggerheart-game-state",o)},[o]);const N=l=>{p(g=>({...g,fear:{...g.fear,value:l}}))},x=()=>{p(l=>({...l,fear:{...l.fear,visible:!l.fear.visible}}))},E=l=>{p(g=>({...g,partySize:Math.max(1,l)}))},F=l=>{p(g=>({...g,currentEncounterName:l||"Encounter"}))},P=l=>{if(l.id)return p(g=>({...g,savedEncounters:(g.savedEncounters||[]).map(h=>h.id===l.id?{...h,name:l.name||h.name,encounterItems:l.encounterItems||h.encounterItems,partySize:l.partySize||h.partySize,battlePointsAdjustments:l.battlePointsAdjustments||h.battlePointsAdjustments,updatedAt:new Date().toISOString()}:h)})),l.id;{const g={id:De("encounter"),name:l.name||"Encounter",createdAt:new Date().toISOString(),encounterItems:l.encounterItems||[],partySize:l.partySize||4,battlePointsAdjustments:l.battlePointsAdjustments||{}};return p(h=>({...h,savedEncounters:[...h.savedEncounters||[],g]})),g.id}},T=l=>(o.savedEncounters||[]).find(h=>h.id===l),C=l=>{const g={id:De("encounter"),name:l.name||`Encounter ${Date.now()}`,createdAt:new Date().toISOString(),encounterItems:l.encounterItems||[],partySize:l.partySize||4,battlePointsAdjustments:l.battlePointsAdjustments||{}};return p(h=>({...h,savedEncounters:[...h.savedEncounters||[],g]})),g.id},J=l=>{p(g=>({...g,savedEncounters:(g.savedEncounters||[]).filter(h=>h.id!==l)}))},xe=m.useRef(o);m.useEffect(()=>{xe.current=o},[o]);const Ce={gameState:o,isLoaded:c,customContent:u,updateFear:N,toggleFearVisibility:x,updatePartySize:E,updateCurrentEncounterName:F,saveEncounter:P,saveEncounterAs:C,loadEncounter:T,deleteEncounter:J,createCountdown:l=>{const g={id:De("countdown"),name:l.name||"Countdown",max:parseInt(l.max)||1,value:0,visible:!0,type:l.type||"standard",loop:l.loop||"none",source:l.source||"campaign"};p(h=>({...h,countdowns:[...h.countdowns,g]}))},updateCountdown:(l,g)=>{p(h=>({...h,countdowns:h.countdowns.map(d=>d.id===l?{...d,...g}:d)}))},deleteCountdown:l=>{p(g=>({...g,countdowns:g.countdowns.filter(h=>h.id!==l)}))},advanceCountdown:(l,g)=>{p(h=>({...h,countdowns:h.countdowns.map(d=>{if(d.id!==l)return d;let r=g;if(d.loop==="loop")r>d.max?r=(r-1)%d.max+1:r<0&&(r=d.max);else if(d.loop==="increasing"){if(r>d.max)return{...d,max:d.max+1,value:1};if(r<0)return{...d,max:Math.max(1,d.max-1),value:1};r=Math.max(0,r)}else if(d.loop==="decreasing"){if(r>d.max)return{...d,max:Math.max(1,d.max-1),value:1};if(r<0)return{...d,max:d.max+1,value:1};r=Math.min(d.max,r)}else r=Math.max(0,Math.min(r,d.max));return{...d,value:r}})}))},incrementCountdown:(l,g=1)=>{p(h=>({...h,countdowns:h.countdowns.map(d=>{if(d.id!==l)return d;let r=d.value+g;if(d.loop==="loop")r>d.max&&(r=(r-1)%d.max+1);else if(d.loop==="increasing"){if(r>d.max)return{...d,max:d.max+1,value:1}}else if(d.loop==="decreasing"){if(r>d.max)return{...d,max:Math.max(1,d.max-1),value:1}}else r=Math.min(r,d.max);return{...d,value:r}})}))},decrementCountdown:l=>{p(g=>({...g,countdowns:g.countdowns.map(h=>{if(h.id!==l)return h;let d=h.value-1;if(h.loop==="loop")d<0&&(d=h.max);else if(h.loop==="increasing"){if(d<0)return{...h,max:Math.max(1,h.max-1),value:h.max};d=Math.max(0,d)}else if(h.loop==="decreasing"){if(d<0)return{...h,max:h.max+1,value:1}}else d=Math.max(0,d);return{...h,value:d}})}))},reorderCountdowns:l=>{p(g=>{const[h,d]=l,r=[...g.countdowns],[b]=r.splice(h,1);return r.splice(d,0,b),{...g,countdowns:r}})},createAdversary:l=>{var z;const g=De("adv"),h=o.adversaries||[],d=l.baseName||((z=l.name)==null?void 0:z.replace(/\s+\(\d+\)$/,""))||l.name||"Unknown",r=h.filter(R=>R.baseName===d);let b=1;if(r.length===0)b=1;else{const R=r.map(Te=>Te.duplicateNumber||1);let we=1;for(;R.includes(we);)we++;b=we}const X={...l,id:g,baseName:d,duplicateNumber:b,name:`${d} (${b})`,hp:0,stress:0,isVisible:!0};p(R=>({...R,adversaries:[...R.adversaries,X]}))},createAdversariesBulk:l=>{const g=[],h={};l.forEach(d=>{var We;const r=d.baseName||((We=d.name)==null?void 0:We.replace(/\s+\(\d+\)$/,""))||d.name||"Unknown",z=(o.adversaries||[]).filter(Be=>Be.baseName===r).length,R=h[r]||0,we=z+R+1;h[r]=R+1;const Te={...d,id:De("adv"),baseName:r,duplicateNumber:we,name:`${r} (${we})`,hp:0,stress:0,isVisible:!0};g.push(Te)}),p(d=>({...d,adversaries:[...d.adversaries,...g]}))},updateAdversary:(l,g)=>{p(h=>({...h,adversaries:h.adversaries.map(d=>{if(d.id===l){const r={...d,...g};if(g.baseName!==void 0){const b=g.baseName,X=r.duplicateNumber||1;r.name=X===1?b:`${b} (${X})`}return r}return d})}))},deleteAdversary:l=>{p(g=>({...g,adversaries:g.adversaries.filter(h=>h.id!==l)}))},clearAllAdversaries:()=>{p(l=>({...l,adversaries:[]}))},reorderAdversaries:l=>{p(g=>{const[h,d]=l,r=[...g.adversaries],[b]=r.splice(h,1);return r.splice(d,0,b),{...g,adversaries:r}})},bulkReorderAdversaries:l=>{p(g=>({...g,adversaries:l}))},createEnvironment:l=>{const g=De("env"),d=(o.environments||[]).filter(X=>X.name.replace(/\s+\(\d+\)$/,"")===l.name);let r=l.name||"Unknown";if(d.length===0)r=l.name;else if(d.length===1){const X=d[0],z=X.name.replace(/\s+\(\d+\)$/,""),R=o.environments.map(we=>we.id===X.id?{...we,name:`${z} (1)`}:we);p(we=>({...we,environments:R})),r=`${l.name} (2)`}else{const X=d.map(R=>{const we=R.name.match(/\((\d+)\)$/);return we?parseInt(we[1]):null}).filter(R=>R!==null);let z=1;for(;X.includes(z);)z++;r=`${l.name} (${z})`}const b={...l,id:g,name:r,isVisible:!0};p(X=>({...X,environments:[...X.environments,b]}))},updateEnvironment:(l,g)=>{p(h=>({...h,environments:h.environments.map(d=>d.id===l?{...d,...g}:d)}))},deleteEnvironment:l=>{p(g=>({...g,environments:g.environments.filter(h=>h.id!==l)}))},reorderEnvironments:l=>{p(g=>{const[h,d]=l,r=[...g.environments],[b]=r.splice(h,1);return r.splice(d,0,b),{...g,environments:r}})},addCustomAdversary:l=>{const g={...l,id:De("custom-adv"),source:l.source||"Homebrew",isCustom:!0};return v(h=>({...h,adversaries:[...h.adversaries,g]})),Oe("daggerheart-custom-adversaries",[...u.adversaries,g]),g.id},addCustomEnvironment:l=>{const g={...l,id:De("custom-env"),source:l.source||"Homebrew",isCustom:!0};return v(h=>({...h,environments:[...h.environments,g]})),Oe("daggerheart-custom-environments",[...u.environments,g]),g.id},updateCustomAdversary:(l,g)=>{v(d=>({...d,adversaries:d.adversaries.map(r=>r.id===l?{...r,...g}:r)}));const h=u.adversaries.map(d=>d.id===l?{...d,...g}:d);Oe("daggerheart-custom-adversaries",h)},updateCustomEnvironment:(l,g)=>{v(d=>({...d,environments:d.environments.map(r=>r.id===l?{...r,...g}:r)}));const h=u.environments.map(d=>d.id===l?{...d,...g}:d);Oe("daggerheart-custom-environments",h)},deleteCustomAdversary:l=>{v(h=>({...h,adversaries:h.adversaries.filter(d=>d.id!==l)}));const g=u.adversaries.filter(h=>h.id!==l);Oe("daggerheart-custom-adversaries",g)},deleteCustomEnvironment:l=>{v(h=>({...h,environments:h.environments.filter(d=>d.id!==l)}));const g=u.environments.filter(h=>h.id!==l);Oe("daggerheart-custom-environments",g)}};return e.jsx(jt.Provider,{value:Ce,children:t})},pt=()=>{const t=m.useContext(jt);if(!t)return console.warn("useGameState: Context not available yet, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{gameState:o,customContent:p,...c}=t;if(!o)return console.warn("useGameState: gameState not available, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],customContent:{adversaries:[],environments:[]},updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},addCustomAdversary:()=>{},addCustomEnvironment:()=>{},updateCustomAdversary:()=>{},updateCustomEnvironment:()=>{},deleteCustomAdversary:()=>{},deleteCustomEnvironment:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{fear:j,countdowns:u,adversaries:v,environments:N,partySize:x,savedEncounters:E}=o;return{gameState:o,fear:j,countdowns:u,adversaries:v,environments:N,partySize:x,savedEncounters:E,customContent:p,...c,hasCountdowns:u.length>0,hasAdversaries:v.length>0,hasEnvironments:N.length>0,getCountdownById:F=>u.find(P=>P.id===F),getAdversaryById:F=>v.find(P=>P.id===F),getEnvironmentById:F=>N.find(P=>P.id===F)}},ft={fear:{icon:zt,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"0.125rem",maxWidth:"none"},pipStyle:{fontSize:"var(--text-lg)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0,imageRendering:"crisp-edges"},filledColor:"var(--purple)",emptyColor:"var(--gray-dark)",tooltipTitle:"Click anywhere in header to adjust fear:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease fear by 1"},{text:"Right of boundary:",description:"Click to increase fear by 1"}]},hp:{icon:Rt,maxValue:20,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stress:{icon:Wt,maxValue:12,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},countdown:{icon:ut,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust countdown:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease countdown by 1"},{text:"Right of boundary:",description:"Click to increase countdown by 1"}]},hpDots:{maxValue:20,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--red)",borderColor:"var(--red)",boxShadow:"0 0 4px rgba(239, 68, 68, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stressDots:{maxValue:12,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--purple)",borderColor:"var(--purple)",boxShadow:"0 0 4px rgba(139, 92, 246, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},adversaryHP:{icon:wt,maxValue:20,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust HP:",tooltipInstructions:[{text:"Filled pip:",description:"Click to heal (reduce damage)"},{text:"Empty pip:",description:"Click to take damage"}]},adversaryStress:{icon:Lt,maxValue:12,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust stress:",tooltipInstructions:[{text:"Filled pip:",description:"Click to reduce stress"},{text:"Empty pip:",description:"Click to increase stress"}]},countdownDistributed:{icon:ut,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Countdown progress:",tooltipInstructions:[{text:"Progress:",description:"Current countdown value"}]}},qe=({type:t="fear",value:o=0,maxValue:p,onChange:c,size:j="lg",showTooltip:u=!0,containerStyle:v={},pipStyle:N={},countdownType:x=null,distributedGroups:E=null,onPipClick:F=null,enableBoundaryClick:P=!1,clickContainerWidth:T="auto",centerPips:C=!0})=>{const[J,xe]=m.useState(!1),O=ft[t]||ft.fear,V=p||O.maxValue,_=Math.max(0,Math.min(V,o));let ve=O.filledColor;t==="countdown"&&x&&(["progress","dynamic-progress","simple-hope"].includes(x)?ve="var(--gold)":["consequence","dynamic-consequence","simple-fear"].includes(x)?ve="var(--purple)":["long-term","standard"].includes(x)&&(ve="var(--text-secondary)"));const G=(oe,fe)=>{if(F)F(oe,fe);else if(c){const je=oe+1;c(je)}},Ie=oe=>{if(!P||!c||F)return;oe.currentTarget.getBoundingClientRect();const fe=oe.currentTarget.querySelector(".pip-container");if(!fe)return;const je=fe.getBoundingClientRect(),f=oe.clientX-je.left;if(f<0){_>0&&c(_-1);return}if(f>je.width){_<V&&c(_+1);return}const te=je.width,S=te*.05,de=te-2*S,Q=f-S,Me=_/V,ee=de*Me;Q<ee?_>0&&c(_-1):_<V&&c(_+1)},Re=(()=>{if(!E||t!=="countdownDistributed")return[{start:0,end:V,groupIndex:0}];let oe=0;return E.map((fe,je)=>{const f={start:oe,end:oe+fe,groupIndex:je};return oe+=fe,f})})(),se=()=>e.jsxs(e.Fragment,{children:[Re.map(oe=>e.jsx(Fe.Fragment,{children:[...Array(oe.end-oe.start)].map((fe,je)=>{const f=oe.start+je,te=f<_;if(O.isDots)return e.jsx("div",{style:{...O.pipStyle,...te?O.filledStyle:O.emptyStyle,...N,cursor:c||F?"pointer":"default"},onClick:P?void 0:()=>G(f,te),title:`${f+1} of ${V}`},f);{const S=O.icon,de=S&&typeof S=="object"&&S.iconName,Q=te?ve:O.emptyColor;return e.jsx("span",{className:`fear-pip ${te?"filled":"empty"}`,style:{...O.pipStyle,color:Q,cursor:c||F?"pointer":"default",...N},onClick:P?void 0:()=>G(f,te),title:`${f+1} of ${V}`,children:de?e.jsx(Tt,{icon:S,size:j}):e.jsx(S,{size:j==="lg"?18:16})},f)}})},oe.groupIndex)),u&&e.jsx("div",{style:{position:"relative",cursor:"help",pointerEvents:"none"},children:e.jsxs("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:J?"translateX(-50%) translateY(-5px)":"translateX(-50%)",background:"rgba(15, 23, 42, 0.95)",border:"1px solid var(--gray)",borderRadius:"var(--radius-md)",padding:"var(--space-md)",minWidth:"250px",zIndex:1e3,opacity:J?1:0,visibility:J?"visible":"hidden",transition:"all 0.2s ease",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.5)"},children:[e.jsx("div",{style:{fontWeight:600,color:"var(--gray-200)",marginBottom:"0.75rem",fontSize:"var(--text-sm)"},children:O.tooltipTitle}),O.tooltipInstructions.map((oe,fe)=>e.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.8rem",color:"var(--gray-300)",lineHeight:1.4},children:[e.jsx("strong",{style:{color:"var(--gray-200)"},children:oe.text})," ",oe.description]},fe))]})})]});return e.jsx("div",{style:{width:T,height:"100%",cursor:c||F?"pointer":"default",touchAction:"manipulation",userSelect:"none",display:C?"flex":"block",alignItems:C?"center":"stretch",justifyContent:C?"center":"flex-start",...v},onClick:oe=>{oe.stopPropagation(),oe.preventDefault(),P&&Ie(oe)},onMouseEnter:()=>xe(u),onMouseLeave:()=>xe(!1),children:e.jsx("div",{className:"pip-container",style:{...O.containerStyle,width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},children:se()})})},Jt=({position:t="top",children:o,onClick:p,className:c="",style:j={}})=>{const u=t==="top",v=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://"),N={background:"var(--bg-primary)",borderTop:u?"none":"1px solid var(--border)",borderBottom:u?"1px solid var(--border)":"none",padding:u?"0.25rem 0":"0.5rem",paddingBottom:u?"0.25rem":v?"calc(0.5rem + env(safe-area-inset-bottom) + 1rem)":"calc(0.5rem + env(safe-area-inset-bottom))",position:u?"relative":"sticky",[u?"top":"bottom"]:0,zIndex:u?10:100,order:u?1:3,flexShrink:0,touchAction:"manipulation",userSelect:"none",display:"flex",flexDirection:u?"column":"row",justifyContent:u?"stretch":"center",alignItems:u?"stretch":"center",gap:u?"0":"1rem",height:u?"auto":"60px",...j};return e.jsx("div",{className:c,style:N,onClick:p,children:o})},nt=52,kt=({tabContent:t,children:o,containerStyle:p={},tabStyle:c={},showTab:j=!0,tabBackgroundColor:u="var(--bg-primary)",tabBorderColor:v="var(--border)",tabJustifyContent:N="center",containerBackgroundColor:x,containerBorderColor:E,containerBorderRadius:F="8px",containerBoxShadow:P,containerOverflow:T="hidden",reserveTabSpace:C=!1,style:J={},...xe})=>{const O={display:"flex",flexDirection:"column",position:"relative",height:"100%",width:"100%",borderRadius:F,overflow:T};x&&(O.backgroundColor=x),E&&(O.border=`2px solid ${E}`),P&&(O.boxShadow=P);const V={position:"relative",overflow:"visible",height:"100%",width:"100%",display:"flex",flexDirection:"column",boxSizing:"border-box"},_=C?"0":`-${nt}px`,ve=C&&j&&t?`${nt}px`:"0";return e.jsxs("div",{style:{...V,...J},...xe,children:[j&&t&&e.jsx("div",{style:{position:"absolute",top:_,left:"7px",right:"7px",width:"calc(100% - 14px)",display:"flex",alignItems:"center",gap:"0.5rem",justifyContent:N,flexShrink:0,zIndex:0,padding:"0.5rem 0.75rem",paddingBottom:"calc(0.5rem + 4px)",minHeight:`${nt}px`,backgroundColor:u,border:`1.5px solid ${v}`,borderBottom:"none",borderRadius:"8px 8px 0 0",boxSizing:"border-box",marginBottom:"-4px",...c},children:t}),e.jsx("div",{style:{...O,...p,zIndex:1,marginTop:ve},children:o})]})},ht=({value:t})=>e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"44px",height:"32px",zIndex:3},children:[e.jsx("svg",{width:"40",height:"32",viewBox:"0 0 40 32",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",style:{position:"absolute",zIndex:1},children:e.jsx("path",{d:"M2 2h28l6 14-6 14H2l6-14-6-14z"})}),e.jsx("span",{style:{position:"absolute",fontSize:"0.8rem",fontWeight:500,color:"var(--text-primary)",textAlign:"center",zIndex:2,left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:t})]}),Xt=({type:t,tier:o,isEditMode:p,onUpdate:c,itemId:j})=>{const v=(P=>{if(!P)return 0;const C=document.createElement("canvas").getContext("2d");return C.font="600 11px system-ui, -apple-system, sans-serif",C.measureText(P.toUpperCase()).width})(t),N=4,x=18,E=Math.max(50,v+N+x),F=E+15;return p?e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",gap:"8px",height:"32px"},children:[e.jsxs("select",{value:t||"",onChange:P=>{c&&c(j,{type:P.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",outline:"none",borderRadius:"4px",padding:"4px 8px",width:"95px",height:"24px"},children:[e.jsx("option",{value:"Standard",children:"Standard"}),e.jsx("option",{value:"Solo",children:"Solo"}),e.jsx("option",{value:"Bruiser",children:"Bruiser"}),e.jsx("option",{value:"Horde",children:"Horde"}),e.jsx("option",{value:"Minion",children:"Minion"}),e.jsx("option",{value:"Ranged",children:"Ranged"}),e.jsx("option",{value:"Leader",children:"Leader"}),e.jsx("option",{value:"Skulk",children:"Skulk"}),e.jsx("option",{value:"Social",children:"Social"}),e.jsx("option",{value:"Support",children:"Support"})]}),e.jsxs("div",{style:{position:"relative",width:"24px",height:"24px"},children:[e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",width:"20px",height:"20px",backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",borderRadius:"2px"}}),e.jsx("input",{type:"text",value:o||"",onChange:P=>{const T=P.target.value.replace(/[^1-4]/g,"");T.length<=1&&c&&c(j,{tier:T===""?"":parseInt(T)})},onKeyDown:P=>{if(P.key==="ArrowUp"){P.preventDefault();const T=parseInt(o)||1;c&&c(j,{tier:Math.min(T+1,4)})}else if(P.key==="ArrowDown"){P.preventDefault();const T=parseInt(o)||1;c&&c(j,{tier:Math.max(T-1,1)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"transparent",border:"none",color:"var(--text-primary)",fontSize:"0.8rem",fontWeight:600,width:"24px",height:"24px",textAlign:"center",outline:"none",zIndex:1},maxLength:"1"})]})]}):e.jsxs("div",{style:{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"center",height:"32px",width:`${F}px`},children:[e.jsxs("svg",{width:F,height:"32",viewBox:`0 0 ${F} 32`,style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1},children:[e.jsx("rect",{x:"1",y:"6",width:E-1,height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4",ry:"4"}),e.jsx("rect",{x:E-10,y:"6",width:"20",height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"2",ry:"2",transform:`rotate(45 ${E-1} 16)`})]}),e.jsx("span",{style:{position:"absolute",top:"50%",left:"4px",transform:"translateY(-50%)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",color:"var(--text-primary)",zIndex:2,pointerEvents:"none"},children:t}),e.jsx("span",{style:{position:"absolute",top:"50%",left:`${E-.5}px`,transform:"translate(-50%, -50%)",fontSize:"0.8rem",fontWeight:600,color:"white",zIndex:2,pointerEvents:"none",textAlign:"center",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",width:"20px",height:"20px"},children:o})]})},st=({feature:t,featureType:o,item:p,onUpdate:c,handleFeatureDeleteClick:j,deleteConfirmations:u,getFeatureKey:v})=>{var P,T;const N=()=>{try{const J=[...(p==null?void 0:p.features)||[]],xe=J.filter(V=>V.type===o),O=xe.findIndex(V=>V===t);if(O>0&&O<xe.length){const V=xe[O],_=xe[O-1];if(V&&_){const ve=J.findIndex(Ie=>Ie===V),G=J.findIndex(Ie=>Ie===_);ve>=0&&G>=0&&(J[ve]=_,J[G]=V,c&&c(p.id,{features:J}))}}}catch(C){console.error(`Error in ${o.toLowerCase()} up button:`,C)}},x=()=>{try{const J=[...(p==null?void 0:p.features)||[]],xe=J.filter(V=>V.type===o),O=xe.findIndex(V=>V===t);if(O<xe.length-1&&O>=0){const V=xe[O],_=xe[O+1];if(V&&_){const ve=J.findIndex(Ie=>Ie===V),G=J.findIndex(Ie=>Ie===_);ve>=0&&G>=0&&(J[ve]=_,J[G]=V,c&&c(p.id,{features:J}))}}}catch(C){console.error(`Error in ${o.toLowerCase()} down button:`,C)}},E=C=>C.type===o,F=C=>C.type===o&&C.name.trim();return e.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",alignSelf:"stretch"},children:[e.jsx("button",{onClick:N,disabled:(p.features||[]).filter(E).findIndex(C=>C===t)===0,tabIndex:"-1",style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(p.features||[]).filter(F).length>=2&&(p.features||[]).filter(E).findIndex(C=>C===t)!==0&&t.name.trim()?"white":"var(--text-secondary)",cursor:(p.features||[]).filter(F).length>=2&&(p.features||[]).filter(E).findIndex(C=>C===t)!==0&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↑"}),e.jsx("button",{onClick:()=>j(t),disabled:!t.name.trim()&&!t.description.trim(),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:u[v(t)]?"var(--danger)":"var(--gray-700)",color:!t.name.trim()&&!t.description.trim()?"var(--text-secondary)":"white",cursor:!t.name.trim()&&!t.description.trim()?"not-allowed":"pointer",opacity:!t.name.trim()&&!t.description.trim()?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"×"}),e.jsx("button",{onClick:x,disabled:(p.features||[]).filter(E).findIndex(C=>C===t)===(p.features||[]).filter(E).length-1,style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(p.features||[]).filter(F).length>=2&&(p.features||[]).filter(E).findIndex(C=>C===t)<(p.features||[]).filter(E).length-1&&((P=(p.features||[]).filter(E)[(p.features||[]).filter(E).findIndex(C=>C===t)+1])!=null&&P.name.trim())&&t.name.trim()?"white":"var(--text-secondary)",cursor:(p.features||[]).filter(F).length>=2&&(p.features||[]).filter(E).findIndex(C=>C===t)<(p.features||[]).filter(E).length-1&&((T=(p.features||[]).filter(E)[(p.features||[]).filter(E).findIndex(C=>C===t)+1])!=null&&T.name.trim())&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↓"})]})},Ne={transitions:{hoverIn:"all 0.1s ease",hoverOut:"all 0.3s ease"},card:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"8px",cursor:"pointer",transition:"all 0.1s ease",position:"relative",border:"none"},cardHover:{backgroundColor:"var(--bg-card-hover)"},cardDead:{opacity:.6,backgroundColor:"var(--gray-800)",borderColor:"var(--border)"},cardAtMax:{backgroundColor:"var(--success)",borderColor:"var(--success)"},rowMain:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},rowTitle:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",margin:0},rowMeta:{display:"flex",gap:"8px",alignItems:"center"},badge:{padding:"2px 6px",borderRadius:"3px",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},typeBadge:{backgroundColor:"var(--purple)",color:"var(--text-primary)"},tierBadge:{backgroundColor:"var(--info)",color:"var(--text-primary)"},damageInputPopup:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,borderRadius:"8px"},damageInputContent:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"8px",padding:"8px",display:"flex",flexDirection:"row",gap:"8px",minWidth:"200px",alignItems:"center",position:"absolute",right:"1rem",top:"50%",transform:"translateY(-50%)"},damageInput:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"4px",padding:"4px 6px",color:"var(--text-primary)",fontSize:"16px",width:"80px",textAlign:"center"},damageIndicators:{display:"flex",gap:"8px",alignItems:"center",justifyContent:"center"},damageDrop:{fontSize:"16px",color:"var(--text-secondary)",cursor:"pointer",transition:"color 0.1s ease"},applyButton:{backgroundColor:"var(--gray-600)",color:"white",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"32px",minHeight:"32px"}},Kt=(t,o,p,c)=>{const[j,u]=m.useState(!1),[v,N]=m.useState("");m.useEffect(()=>{if(j){const C=J=>{J.target.closest(".damage-input-popup")||(u(!1),N(""))};return document.addEventListener("click",C),()=>document.removeEventListener("click",C)}},[j]);const x=C=>{C.stopPropagation(),C.preventDefault();const J=t.hp||0,xe=t.hpMax||1,O=C.currentTarget.getBoundingClientRect(),V=C.clientX-O.left,_=O.width/xe;Math.floor(V/_)<J?p&&p(t.id,1,t.hp):o&&o(t.id,1,t.hp,t.hpMax)},E=C=>{C.stopPropagation(),C.preventDefault();const J=t.stress||0,xe=t.stressMax||1,O=C.currentTarget.getBoundingClientRect(),V=C.clientX-O.left,_=O.width/xe;Math.floor(V/_)<J?c&&c(t.id,-1,t.stress,t.stressMax):c&&c(t.id,1,t.stress,t.stressMax)},F=C=>{C.stopPropagation(),(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")&&(u(!0),N(t.type==="Minion"?"1":""))},P=()=>{const C=parseInt(v);if(C>0){if(t.type==="Minion")o&&o(t.id,C,t.hp,t.hpMax);else{let J=0;C>=t.thresholds.severe?J=3:C>=t.thresholds.major?J=2:C>=1&&(J=1),o&&o(t.id,J,t.hp,t.hpMax)}u(!1),N("")}};return{showDamageInput:j,damageValue:v,setDamageValue:N,setShowDamageInput:u,handleHpClick:x,handleStressClick:E,handleDifficultyClick:F,applyDamage:P,handleKeyDown:C=>{C.key==="Enter"?P():C.key==="Escape"&&(u(!1),N(""))}}},et=({item:t,type:o,mode:p="expanded",onClick:c,onDelete:j,onApplyDamage:u,onApplyHealing:v,onApplyStressChange:N,onUpdate:x,adversaries:E=[],isSelected:F=!1,isEditMode:P=!1,instances:T=[],isEmbedded:C=!1,showAddRemoveButtons:J=!1,onAddInstance:xe=null,onRemoveInstance:O=null,onEdit:V=null,showCustomCreator:_=!1,onSaveCustomAdversary:ve=null,onCancelEdit:G=null,isStockAdversary:Ie=!1})=>{const Ee=m.useRef(null),Re=m.useRef(T.length),se=m.useRef(null),oe=m.useRef(null),fe=m.useRef(null),je=m.useRef(null),[f,te]=m.useState(0);m.useEffect(()=>{const r=Ee.current;if(!r)return;const b=()=>{se.current=r.scrollHeight,oe.current=r.scrollTop};r.addEventListener("scroll",b,{passive:!0});const X=setInterval(b,100);return()=>{r.removeEventListener("scroll",b),clearInterval(X)}},[]),m.useEffect(()=>()=>{Ee.current&&(se.current=Ee.current.scrollHeight,oe.current=Ee.current.scrollTop)},[T.length,T]);const[S,de]=m.useState({});m.useLayoutEffect(()=>{const r=T.length,b=Re.current;if(r!==b&&Ee.current){const X=se.current,z=oe.current;if(!X||z===null){Re.current=r;return}const R=Ee.current,we=R.scrollHeight,Te=R.clientHeight;if(r<b){const We=X-Te;if(z>=We-10&&we>Te){fe.current&&(cancelAnimationFrame(fe.current),fe.current=null);const a=f,s=X-a-we;te(a+s),requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!R)return;R.scrollTop=z,R.offsetHeight;const A=we-Te,ne=R.scrollTop,M=A-ne;if(Math.abs(M)>.5){const i=performance.now(),w=ne,y=ae=>{if(!R){fe.current=null;return}const Z=ae-i,be=Math.min(Z/400,1),ie=1-be,le=1-ie*ie*ie,re=A,k=re-w,he=w+k*le;R.scrollTop=he,be<1?fe.current=requestAnimationFrame(y):(R.scrollTop=re,fe.current=null,te(0))};fe.current=requestAnimationFrame(y)}else te(0)})})}}else if(r>b){const We=we-Te,Be=R.scrollTop,a=We-Be;if(Math.abs(a)>.5){fe.current&&(cancelAnimationFrame(fe.current),fe.current=null);const I=400,s=performance.now(),A=ne=>{if(!R){fe.current=null;return}const M=ne-s,pe=Math.min(M/I,1),i=1-pe,w=1-i*i*i,y=Be+a*w;R.scrollTop=y,pe<1?fe.current=requestAnimationFrame(A):(R.scrollTop=We,fe.current=null)};fe.current=requestAnimationFrame(A)}}Re.current=r}else Re.current=r},[T.length,T]);const Q=r=>{const X=(t.features||[]).filter(z=>z.type===r.type).findIndex(z=>z===r);return`${r.type}-${X}-${r.name||"blank"}`},Me=(r,b)=>`experience-${b}-${typeof r=="string"?r:r.name||"blank"}`,ee=r=>{const b=Q(r);if(S[b]){const X=t.features.filter(z=>z!==r);x&&x(t.id,{features:X}),de(z=>{const R={...z};return delete R[b],R})}else de(X=>({...X,[b]:!0})),setTimeout(()=>{de(X=>{const z={...X};return delete z[b],z})},3e3)},ce=(r,b)=>{const X=Me(r,b);if(S[X]){const z=[...t.experience||[]];z.splice(b,1),x&&x(t.id,{experience:z}),de(R=>{const we={...R};return delete we[X],we})}else de(z=>({...z,[X]:!0})),setTimeout(()=>{de(z=>{const R={...z};return delete R[X],R})},3e3)},Y=Kt(t,u,v,N);(o==="adversary"||o==="adversaries")&&Y.handleDifficultyClick;const ke=(r=!1)=>{let b={...Ne.card};if(F?b.transition="none":b.transition=Ne.transitions.hoverOut,r){const{marginTop:X,...z}=b;b=z}return F&&(b={...b,...Ne.cardHover}),o==="adversary"&&(t.hp||0)>=(t.hpMax||1)&&(b={...b,...Ne.cardDead}),b},Ae=()=>{if(C)return"";let r="border rounded-lg";return F&&(r+=" border-hover"),r},ze=()=>{var r;if(o==="adversary"||o==="adversaries"){const b=t.baseName||((r=t.name)==null?void 0:r.replace(/\s+\(\d+\)$/,""))||"",X=t.duplicateNumber||1,z=[...E];return E.some(Te=>Te.id===t.id)||z.push(t),z.filter(Te=>Te.baseName===b).length>1?`${b} (${X})`:b}return t.name},Ce=()=>{const r=[];return t.type&&r.push(e.jsx("span",{style:{...Ne.badge,...Ne.typeBadge},children:t.type},"type")),r},l=()=>o!=="adversary"||!Y.showDamageInput||!(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")?null:e.jsx("div",{className:"damage-input-popup",style:Ne.damageInputPopup,onClick:r=>{r.stopPropagation(),r.target===r.currentTarget&&(o==="adversary"||o==="adversaries")&&(Y.setShowDamageInput(!1),Y.setDamageValue(""))},children:e.jsxs("div",{className:"border rounded-lg",style:{...Ne.damageInputContent,borderColor:"var(--border)"},onClick:r=>r.stopPropagation(),children:[e.jsx("input",{type:"number",inputMode:"numeric",enterKeyHint:"done",placeholder:"dmg",min:(t.type==="Minion","0"),value:o==="adversary"||o==="adversaries"?Y.damageValue:"",onChange:r=>{(o==="adversary"||o==="adversaries")&&Y.setDamageValue(r.target.value)},onKeyDown:o==="adversary"||o==="adversaries"?Y.handleKeyDown:void 0,className:"border rounded-sm",style:{...Ne.damageInput,borderColor:"var(--border)"},autoFocus:!0}),e.jsxs("div",{style:Ne.damageIndicators,children:[t.type==="Minion"?(()=>{var R,we;const r=parseInt(o==="adversary"||o==="adversaries"?Y.damageValue:"0")||0,b=(R=t.features)==null?void 0:R.find(Te=>{var We;return(We=Te.name)==null?void 0:We.startsWith("Minion (")}),X=b?parseInt(((we=b.name.match(/\((\d+)\)/))==null?void 0:we[1])||"1"):1,z=Math.floor(r/X);return r>=X&&z>0?e.jsxs("span",{style:{...Ne.damageDrop,color:"var(--red)"},title:`${r} damage can defeat ${z+1} minion${z+1!==1?"s":""} (1 + ${z} additional)`,children:["+",z," additional minion(s)"]}):e.jsx("span",{style:Ne.damageDrop,title:`${r} damage defeats this minion only`,children:"+0 additional minion(s)"})})():[1,2,3].map(r=>{const b=parseInt(o==="adversary"||o==="adversaries"?Y.damageValue:"0")||0;let X=!1;return r===1&&b>=1&&(X=!0),r===2&&b>=t.thresholds.major&&(X=!0),r===3&&b>=t.thresholds.severe&&(X=!0),e.jsx("span",{style:{...Ne.damageDrop,color:X?"var(--red)":"var(--text-secondary)"},onClick:z=>{z.stopPropagation(),(o==="adversary"||o==="adversaries")&&(r===1?Y.setDamageValue("1"):r===2?Y.setDamageValue(t.thresholds.major.toString()):r===3&&Y.setDamageValue(t.thresholds.severe.toString()))},title:`Click to set damage to ${r===1?"1":r===2?t.thresholds.major:t.thresholds.severe}`,children:e.jsx(wt,{size:16})},r)}),e.jsx("button",{style:{...Ne.applyButton,backgroundColor:"var(--gray-600)"},onClick:r=>{r.stopPropagation(),(o==="adversary"||o==="adversaries")&&(!Y.damageValue||parseInt(Y.damageValue)<1?(Y.setShowDamageInput(!1),Y.setDamageValue("")):Y.applyDamage())},title:!Y.damageValue||parseInt(Y.damageValue)<1?"Close damage input":"Apply damage",children:!Y.damageValue||parseInt(Y.damageValue)<1?e.jsx(Ve,{size:16}):e.jsx(Dt,{size:16})})]})]})}),g=()=>{var R,we,Te,We,Be;const r=(t.hp||0)>=(t.hpMax||1),b=h==="edit"||_,X=J&&o==="adversary"||_&&o==="adversary",z=X?_?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:a=>{a.stopPropagation(),ve&&(ve(t,t.id),G&&G())},style:{background:"var(--purple)",border:"1px solid var(--purple)",color:"white",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:a=>{a.target.style.opacity="0.9"},onMouseLeave:a=>{a.target.style.opacity="1"},title:"Save",children:[e.jsx(Nt,{size:16}),e.jsx("span",{children:"Save"})]}),G&&e.jsxs("button",{onClick:a=>{a.stopPropagation(),G()},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:a=>{a.target.style.backgroundColor="var(--bg-hover)",a.target.style.borderColor="var(--purple)"},onMouseLeave:a=>{a.target.style.backgroundColor="var(--bg-secondary)",a.target.style.borderColor="var(--border)"},title:"Cancel",children:[e.jsx(Ve,{size:16}),e.jsx("span",{children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),O&&O(t.id)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease"},onMouseEnter:a=>{a.target.style.backgroundColor="var(--bg-hover)",a.target.style.borderColor="var(--purple)"},onMouseLeave:a=>{a.target.style.backgroundColor="var(--bg-secondary)",a.target.style.borderColor="var(--border)"},title:"Remove one",children:e.jsx(it,{size:16})}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"1rem",fontWeight:"500",minWidth:"24px",textAlign:"center"},children:T.length}),e.jsx("button",{onClick:a=>{a.stopPropagation(),xe&&xe(t)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease"},onMouseEnter:a=>{a.target.style.backgroundColor="var(--purple)",a.target.style.borderColor="var(--purple)",a.target.style.color="white"},onMouseLeave:a=>{a.target.style.backgroundColor="var(--bg-secondary)",a.target.style.borderColor="var(--border)",a.target.style.color="var(--text-primary)"},title:"Add another",children:e.jsx(Ge,{size:16})}),V&&e.jsx("button",{onClick:a=>{a.stopPropagation(),V(t.id)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease",marginLeft:"0.25rem"},onMouseEnter:a=>{a.target.style.backgroundColor="var(--purple)",a.target.style.borderColor="var(--purple)",a.target.style.color="white"},onMouseLeave:a=>{a.target.style.backgroundColor="var(--bg-secondary)",a.target.style.borderColor="var(--border)",a.target.style.color="var(--text-primary)"},title:"Edit",children:e.jsx(Bt,{size:16})})]}):null;return e.jsx(kt,{tabContent:z,showTab:X,tabBorderColor:F?"var(--purple)":"var(--border)",containerBackgroundColor:r?"var(--gray-900)":ke(!0).backgroundColor,containerBorderColor:r?"color-mix(in srgb, var(--gray-600) 40%, transparent)":F?"var(--purple)":"var(--border)",containerBorderRadius:"8px",containerOverflow:"hidden",containerStyle:{padding:0,opacity:r?.7:1,height:"auto",maxHeight:"calc(100vh - 120px)",minHeight:0},children:e.jsxs("div",{className:Ae(),style:{...ke(!0),padding:0,display:"flex",flexDirection:"column",position:"relative",height:"100%",minHeight:0,border:"none",borderRadius:0},onClick:c,children:[r&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                  45deg,
                  transparent,
                  transparent 8px,
                  var(--gray-600) 1px,
                  var(--gray-600) 9px
                )`,pointerEvents:"none",zIndex:9999}})}),e.jsx("div",{className:"border-b",style:{padding:"8px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative",zIndex:r?1:"auto",borderBottomColor:F?"var(--purple)":"var(--border)"},children:e.jsx("div",{style:{display:"flex",flexDirection:"column",position:"relative",zIndex:r?1:"auto",padding:"2px",gap:0},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",minHeight:"40px"},children:[b?e.jsx("input",{type:"text",value:t.name||"",onChange:a=>{x&&x(t.id,{name:a.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"4px",color:"var(--text-primary)",fontSize:"1.1rem",fontWeight:"600",padding:"0.5rem",width:"100%",maxWidth:"300px",paddingRight:"0.625rem"},placeholder:"Name"}):e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flex:1},children:e.jsx("h4",{style:{...Ne.rowTitle,color:r?"color-mix(in srgb, var(--gray-400) 80%, transparent)":Ne.rowTitle.color,textAlign:"left",margin:0,fontSize:"1.1rem",paddingRight:"6px",flex:1},children:((R=t.name)==null?void 0:R.replace(/\s+\(\d+\)$/,""))||t.name})}),(t.type||t.tier||b)&&e.jsx(Xt,{type:t.type,tier:t.tier,isEditMode:b,onUpdate:x,itemId:t.id})]})})}),e.jsxs("div",{ref:Ee,style:{borderRadius:"0 0 8px 8px",flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0},className:"invisible-scrollbar",children:[(t.motives||b)&&e.jsx("div",{style:{padding:"0.5rem 8px",textAlign:"center"},children:b?e.jsx("input",{type:"text",value:t.motives||"",onChange:a=>x&&x(t.id,{motives:a.target.value}),placeholder:"Motives...",style:{width:"100%",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}):e.jsxs("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,textAlign:"center"},children:[t.motives,t.motives&&!t.motives.endsWith(".")?".":""]})}),(t.difficulty||t.atk!==void 0||t.thresholds&&t.type!=="Minion"||t.experience&&t.experience.length>0||b)&&e.jsxs("div",{style:{padding:"0.5rem 8px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[(t.difficulty||b)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[e.jsx(Pt,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(0deg)"}}),b?e.jsx("input",{type:"text",value:t.difficulty||"",onChange:a=>{const I=a.target.value.replace(/[^0-9]/g,"");I.length<=2&&x&&x(t.id,{difficulty:parseInt(I)||0})},onKeyDown:a=>{if(a.key==="ArrowUp"){a.preventDefault();const I=parseInt(t.difficulty)||0;x&&x(t.id,{difficulty:Math.min(I+1,99)})}else if(a.key==="ArrowDown"){a.preventDefault();const I=parseInt(t.difficulty)||0;x&&x(t.id,{difficulty:Math.max(I-1,0)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"2"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:t.difficulty})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Difficulty"})]}),(t.atk!==void 0||b)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[e.jsx(Ht,{size:38,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(45deg)"}}),b?e.jsx("input",{type:"text",value:(()=>{const a=typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0;return a>=0?`+${a}`:a.toString()})(),onChange:a=>{const I=a.target.value.replace(/[^0-9+\-]/g,"");if(I.length<=4){const s=parseInt(I.replace(/[^0-9\-]/g,""))||0;x&&x(t.id,{atk:s})}},onKeyDown:a=>{if(a.key==="ArrowUp"){a.preventDefault();const s=(typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0)+1;x&&x(t.id,{atk:s})}else if(a.key==="ArrowDown"){a.preventDefault();const s=(typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0)-1;x&&x(t.id,{atk:s})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"3"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:(()=>{const a=typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk;return a>=0?`+${a}`:a})()})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Attack"})]})]}),e.jsx("div",{style:{paddingTop:"0"},children:b?e.jsx("div",{style:{display:"flex",flexDirection:"column",marginTop:"-0.25rem"},children:(()=>{const a=t.experience||[],I=a.length===0?[{name:"",modifier:1}]:a;return I.map((s,A)=>{var ne,M,pe,i,w,y,ae,Z,be,ie,le,re,k,he,n,W,D,B,q,H,U,L,ue,Se,K;return e.jsxs("div",{style:{position:"relative",marginBottom:"0.5rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("input",{type:"text",value:typeof s=="object"&&s.modifier>=1?`+${s.modifier}`:"+1",onChange:$=>{const ye=[...t.experience||[]],ge=parseInt($.target.value.replace(/[^0-9+-]/g,""))||1,Le=Math.max(1,ge);ye[A]={name:typeof s=="string"?s:s.name||"",modifier:Le},x&&x(t.id,{experience:ye})},onKeyDown:$=>{if($.key==="ArrowUp"){$.preventDefault();const ye=[...t.experience||[]],ge=typeof s=="object"?Math.max(1,s.modifier):1;ye[A]={name:typeof s=="string"?s:s.name||"",modifier:ge+1},x&&x(t.id,{experience:ye})}else if($.key==="ArrowDown"){$.preventDefault();const ye=[...t.experience||[]],ge=typeof s=="object"?Math.max(1,s.modifier):1;ye[A]={name:typeof s=="string"?s:s.name||"",modifier:Math.max(1,ge-1)},x&&x(t.id,{experience:ye})}},style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)",textAlign:"center",outline:"none"}})}),e.jsxs("div",{style:{marginLeft:"32px",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:typeof s=="string"?s:s.name||"",onChange:$=>{const ye=[...t.experience||[]],ge=typeof s=="object"?s.modifier:1;ye[A]={name:$.target.value,modifier:ge};const Le=ye[ye.length-1];Le&&Le.name.trim()&&ye.push({name:"",modifier:1}),x&&x(t.id,{experience:ye})},placeholder:"Experience name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsxs("div",{style:{display:"flex",gap:"0.125rem"},children:[e.jsx("button",{onClick:()=>{var Pe,He;const $=[...t.experience||[]],ye=typeof s=="string"?s.trim():(Pe=s.name)==null?void 0:Pe.trim(),ge=$[A-1],Le=typeof ge=="string"?ge.trim():(He=ge.name)==null?void 0:He.trim();A>0&&A<$.length&&ye&&Le&&($[A]=ge,$[A-1]=s,x&&x(t.id,{experience:$}))},disabled:A===0||!(typeof s=="string"?s.trim():(ne=s.name)!=null&&ne.trim())||!(typeof I[A-1]=="string"?I[A-1].trim():(M=I[A-1].name)!=null&&M.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:A===0||!(typeof s=="string"?s.trim():(pe=s.name)!=null&&pe.trim())||!(typeof I[A-1]=="string"?I[A-1].trim():(i=I[A-1].name)!=null&&i.trim())?"var(--gray-800)":"var(--gray-700)",color:A===0||!(typeof s=="string"?s.trim():(w=s.name)!=null&&w.trim())||!(typeof I[A-1]=="string"?I[A-1].trim():(y=I[A-1].name)!=null&&y.trim())?"var(--text-secondary)":"white",cursor:A===0||!(typeof s=="string"?s.trim():(ae=s.name)!=null&&ae.trim())||!(typeof I[A-1]=="string"?I[A-1].trim():(Z=I[A-1].name)!=null&&Z.trim())?"not-allowed":"pointer",opacity:A===0||!(typeof s=="string"?s.trim():(be=s.name)!=null&&be.trim())||!(typeof I[A-1]=="string"?I[A-1].trim():(ie=I[A-1].name)!=null&&ie.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move up",children:"↑"}),e.jsx("button",{onClick:()=>{var Pe,He;const $=[...t.experience||[]],ye=typeof s=="string"?s.trim():(Pe=s.name)==null?void 0:Pe.trim(),ge=$[A+1],Le=typeof ge=="string"?ge.trim():(He=ge.name)==null?void 0:He.trim();A<$.length-1&&A>=0&&ye&&Le&&($[A]=ge,$[A+1]=s,x&&x(t.id,{experience:$}))},disabled:A===I.length-1||!(typeof s=="string"?s.trim():(le=s.name)!=null&&le.trim())||!(typeof I[A+1]=="string"?I[A+1].trim():(re=I[A+1].name)!=null&&re.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:A===I.length-1||!(typeof s=="string"?s.trim():(k=s.name)!=null&&k.trim())||!(typeof I[A+1]=="string"?I[A+1].trim():(he=I[A+1].name)!=null&&he.trim())?"var(--gray-800)":"var(--gray-700)",color:A===I.length-1||!(typeof s=="string"?s.trim():(n=s.name)!=null&&n.trim())||!(typeof I[A+1]=="string"?I[A+1].trim():(W=I[A+1].name)!=null&&W.trim())?"var(--text-secondary)":"white",cursor:A===I.length-1||!(typeof s=="string"?s.trim():(D=s.name)!=null&&D.trim())||!(typeof I[A+1]=="string"?I[A+1].trim():(B=I[A+1].name)!=null&&B.trim())?"not-allowed":"pointer",opacity:A===I.length-1||!(typeof s=="string"?s.trim():(q=s.name)!=null&&q.trim())||!(typeof I[A+1]=="string"?I[A+1].trim():(H=I[A+1].name)!=null&&H.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move down",children:"↓"}),e.jsx("button",{onClick:()=>ce(s,A),disabled:!(typeof s=="string"?s.trim():(U=s.name)!=null&&U.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:S[Me(s,A)]?"var(--danger)":(typeof s=="string"?s.trim():(L=s.name)!=null&&L.trim())?"var(--gray-700)":"var(--gray-800)",color:(typeof s=="string"?s.trim():(ue=s.name)!=null&&ue.trim())?"white":"var(--text-secondary)",cursor:(typeof s=="string"?s.trim():(Se=s.name)!=null&&Se.trim())?"pointer":"not-allowed",opacity:(typeof s=="string"?s.trim():(K=s.name)!=null&&K.trim())?1:.5,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:S[Me(s,A)]?"Click again to confirm delete":"Delete experience",children:"×"})]})]})]},A)})})()}):e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:t.experience&&t.experience.length>0?t.experience.map((a,I)=>{if(typeof a=="string"){const s=a.match(/^(.+?)\s*([+-]?\d+)$/);if(s){const[,A,ne]=s;return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:ne})})}),e.jsx("span",{style:{marginLeft:"32px"},children:A})]},I)}else return e.jsx("div",{style:{marginBottom:"0.25rem"},children:a},I)}else return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:e.jsxs("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:[a.modifier>=0?"+":"",a.modifier]})})}),e.jsx("span",{style:{marginLeft:"32px"},children:a.name})]},I)}):null})})]}),(t.features&&t.features.length>0||b)&&e.jsxs("div",{style:{padding:"0 8px 8px 8px"},children:[(t.atk!==void 0&&t.weapon||b)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Standard Attack"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:b?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",marginTop:"0.75rem",marginBottom:"0.75rem"},children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[e.jsx("input",{type:"text",value:t.weapon||"",onChange:a=>x&&x(t.id,{weapon:a.target.value}),placeholder:"Standard attack name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}}),e.jsxs("select",{value:t.range||"",onChange:a=>x&&x(t.id,{range:a.target.value}),style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",appearance:"none",backgroundImage:`url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",backgroundSize:"1rem",paddingRight:"2rem"},children:[e.jsx("option",{value:""}),e.jsx("option",{value:"Melee",children:"Melee"}),e.jsx("option",{value:"Very Close",children:"Very Close"}),e.jsx("option",{value:"Close",children:"Close"}),e.jsx("option",{value:"Far",children:"Far"}),e.jsx("option",{value:"Very Far",children:"Very Far"})]}),e.jsx("input",{type:"text",value:t.damage||"",onChange:a=>x&&x(t.id,{damage:a.target.value}),placeholder:"Damage (e.g., 1d6+2)",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}})]})}):t.atk!==void 0&&t.weapon&&e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:t.weapon}),e.jsxs("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:["Make an attack against a target within ",t.range||"Melee"," range. On a success, deal ",t.damage||"damage varies","."]})]})})]}),(t.features.filter(a=>a.type==="Action").length>0||b)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Actions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const a=t.features.filter(s=>s.type==="Action");return(b&&a.length===0?[{type:"Action",name:"",description:""}]:a).map((s,A)=>b?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:s.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false","data-lpignore":"true","data-form-type":"other",name:`feature-name-${s.type.toLowerCase()}`,onChange:ne=>{const M=[...t.features||[]],pe=M.findIndex(y=>y.type==="Action"&&y===s);pe>=0?M[pe]={...M[pe],name:ne.target.value}:M.push({type:"Action",name:ne.target.value,description:s.description||""});const i=M.filter(y=>y.type==="Action"),w=i[i.length-1];w&&w.name.trim()&&M.push({type:"Action",name:"",description:""}),x&&x(t.id,{features:M})},placeholder:"Action name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:s.description||"",onChange:ne=>{const M=[...t.features||[]],pe=M.findIndex(y=>y.type==="Action"&&y===s);pe>=0?M[pe]={...M[pe],description:ne.target.value}:M.push({type:"Action",name:s.name||"",description:ne.target.value});const i=M.filter(y=>y.type==="Action"),w=i[i.length-1];w&&w.name.trim()&&M.push({type:"Action",name:"",description:""}),x&&x(t.id,{features:M})},onInput:ne=>{const M=ne.target.offsetHeight;ne.target.style.height="auto";const pe=ne.target.scrollHeight,i=pe>M?pe:M;ne.target.style.height=i+"px"},placeholder:"Action description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(st,{feature:s,featureType:"Action",item:t,onUpdate:x,handleFeatureDeleteClick:ee,deleteConfirmations:S,getFeatureKey:Q})]},A):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:s.name}),s.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:s.description})]},A))})()})]}),(t.features.filter(a=>a.type==="Passive").length>0||b)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Passives"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const a=t.features.filter(s=>s.type==="Passive");return(b&&a.length===0?[{type:"Passive",name:"",description:""}]:a).map((s,A)=>b?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:s.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:ne=>{const M=[...t.features||[]],pe=M.findIndex(y=>y.type==="Passive"&&y===s);pe>=0?M[pe]={...M[pe],name:ne.target.value}:M.push({type:"Passive",name:ne.target.value,description:s.description||""});const i=M.filter(y=>y.type==="Passive"),w=i[i.length-1];w&&w.name.trim()&&M.push({type:"Passive",name:"",description:""}),x&&x(t.id,{features:M})},placeholder:"Passive name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:s.description||"",onChange:ne=>{const M=[...t.features||[]],pe=M.findIndex(y=>y.type==="Passive"&&y===s);pe>=0?M[pe]={...M[pe],description:ne.target.value}:M.push({type:"Passive",name:s.name||"",description:ne.target.value});const i=M.filter(y=>y.type==="Passive"),w=i[i.length-1];w&&w.name.trim()&&M.push({type:"Passive",name:"",description:""}),x&&x(t.id,{features:M})},onInput:ne=>{const M=ne.target.offsetHeight;ne.target.style.height="auto";const pe=ne.target.scrollHeight,i=pe>M?pe:M;ne.target.style.height=i+"px"},placeholder:"Passive description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(st,{feature:s,featureType:"Passive",item:t,onUpdate:x,handleFeatureDeleteClick:ee,deleteConfirmations:S,getFeatureKey:Q})]},A):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:s.name}),s.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:s.description})]},A))})()})]}),(t.features.filter(a=>a.type==="Reaction").length>0||b)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Reactions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const a=t.features.filter(s=>s.type==="Reaction");return(b&&a.length===0?[{type:"Reaction",name:"",description:""}]:a).map((s,A)=>b?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:s.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:ne=>{const M=[...t.features||[]],pe=M.findIndex(y=>y.type==="Reaction"&&y===s);pe>=0?M[pe]={...M[pe],name:ne.target.value}:M.push({type:"Reaction",name:ne.target.value,description:s.description||""});const i=M.filter(y=>y.type==="Reaction"),w=i[i.length-1];w&&w.name.trim()&&M.push({type:"Reaction",name:"",description:""}),x&&x(t.id,{features:M})},placeholder:"Reaction name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:s.description||"",onChange:ne=>{const M=[...t.features||[]],pe=M.findIndex(y=>y.type==="Reaction"&&y===s);pe>=0?M[pe]={...M[pe],description:ne.target.value}:M.push({type:"Reaction",name:s.name||"",description:ne.target.value});const i=M.filter(y=>y.type==="Reaction"),w=i[i.length-1];w&&w.name.trim()&&M.push({type:"Reaction",name:"",description:""}),x&&x(t.id,{features:M})},onInput:ne=>{const M=ne.target.offsetHeight;ne.target.style.height="auto";const pe=ne.target.scrollHeight,i=pe>M?pe:M;ne.target.style.height=i+"px"},placeholder:"Reaction description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(st,{feature:s,featureType:"Reaction",item:t,onUpdate:x,handleFeatureDeleteClick:ee,deleteConfirmations:S,getFeatureKey:Q})]},A):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:s.name}),s.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:s.description})]},A))})()})]})]}),(T&&T.length>0||t.type!=="Minion"&&(t.thresholds||b))&&e.jsxs("div",{style:{padding:"0 8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Status"})]}),b?e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border)"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"number",value:t.hpMax||"",onChange:a=>{const I=parseInt(a.target.value)||1;x&&x(t.id,{hpMax:I})},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),e.jsx(qe,{type:"adversaryHP",value:0,maxValue:t.hpMax||1,showTooltip:!1}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:"HP"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"number",value:t.stressMax||"",onChange:a=>{const I=parseInt(a.target.value)||1;x&&x(t.id,{stressMax:I})},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),e.jsx(qe,{type:"adversaryStress",value:0,maxValue:t.stressMax||1,showTooltip:!1}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:"Stress"})]})]})})}):T&&T.length>0&&T.map((a,I)=>{const s=(a.hp||0)>=(a.hpMax||1);return e.jsx("div",{"data-instance-id":a.id,style:{marginBottom:"0.5rem"},children:e.jsxs("div",{style:{backgroundColor:s?"var(--gray-900)":"var(--bg-primary)",borderRadius:"6px",padding:"0.25rem 0.5rem",border:"1px solid",borderColor:s?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",display:"flex",justifyContent:"flex-start",alignItems:"center",gap:"0.5rem",opacity:s?.7:1,position:"relative",transition:"all 0.2s ease",minHeight:"40px"},children:[s&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                          45deg,
                          transparent 0px,
                          transparent 8px,
                          var(--gray-600) 9px,
                          var(--gray-600) 9px
                        )`,pointerEvents:"none",zIndex:1,borderRadius:"4px"}})}),e.jsx("div",{style:{backgroundColor:s?"var(--gray-900)":"var(--bg-card)",border:"1px solid",borderColor:s?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",borderRadius:"50%",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",flexShrink:0,opacity:s?.5:1},children:e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:s?"var(--gray-400)":"var(--text-primary)"},children:a.duplicateNumber||1})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.125rem"},children:[e.jsx("div",{style:{opacity:s?.3:1},children:e.jsx(qe,{type:"adversaryHP",value:a.hp||0,maxValue:a.hpMax||1,onPipClick:(A,ne)=>{if(u&&o==="adversary"){const M=a.hp||0,pe=a.hpMax||1;ne?v&&v(a.id,1,M):M<pe&&u(a.id,1,M,pe)}},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})}),a.stressMax>0&&e.jsx("div",{style:{opacity:s?.3:1},children:e.jsx(qe,{type:"adversaryStress",value:a.stress||0,maxValue:a.stressMax,onPipClick:(A,ne)=>{N&&o==="adversary"&&(ne?N(a.id,-1):N(a.id,1))},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})})]})]},a.id)},a.id)}),t.type!=="Minion"&&(t.thresholds||b)&&e.jsx("div",{style:{display:"flex",justifyContent:"center",paddingTop:"1px",marginTop:"0.5rem",marginBottom:"0.5rem"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",position:"relative"},children:e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",height:"36px"},children:[e.jsx("svg",{width:"300",height:"36",viewBox:"0 0 300 36",style:{position:"absolute",zIndex:1},children:e.jsx("rect",{x:"20",y:"6",width:"260",height:"24",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4"})}),e.jsx("div",{style:{position:"relative",zIndex:2,display:"flex",alignItems:"center",gap:"0.5rem"},children:b?e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",fontSize:"0.8rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),e.jsx("input",{type:"number",min:"1",max:"99",value:((we=t.thresholds)==null?void 0:we.major)||"",onChange:a=>{const I=a.target.value;(I===""||parseInt(I)>=1&&parseInt(I)<=99)&&x&&x(t.id,{thresholds:{...t.thresholds,major:I===""?null:parseInt(I)}})},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),e.jsx("input",{type:"number",min:"1",max:"99",value:((Te=t.thresholds)==null?void 0:Te.severe)||"",onChange:a=>{const I=a.target.value;(I===""||parseInt(I)>=1&&parseInt(I)<=99)&&x&&x(t.id,{thresholds:{...t.thresholds,severe:I===""?null:parseInt(I)}})},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),e.jsx(ht,{value:((We=t.thresholds)==null?void 0:We.major)||7}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),e.jsx(ht,{value:((Be=t.thresholds)==null?void 0:Be.severe)||14}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]})})]})})})]}),(b||p==="expanded"&&t.description&&t.description.trim())&&e.jsxs("div",{style:{padding:"0 8px",textAlign:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Description"})]}),b?e.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-primary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"none",overflow:"hidden",fontFamily:"inherit",marginTop:"0.75rem",marginBottom:"0.75rem"},value:t.description,onChange:a=>{a.target.style.height="auto",a.target.style.height=a.target.scrollHeight+"px",x&&x(t.id,{description:a.target.value})},placeholder:"Description..."}):e.jsx("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,whiteSpace:"pre-wrap",padding:"0.5rem 0"},children:t.description})]}),f>0&&e.jsx("div",{ref:je,style:{height:f,width:"100%",flexShrink:0}})]}),l()]})})},h=_?"edit":p;return(h==="expanded"||h==="edit")&&(o==="adversary"||o==="adversaries")?g():o==="adversary"||o==="adversaries"?null:e.jsxs("div",{className:Ae(),style:ke(!0),children:[e.jsxs("div",{style:Ne.rowMain,children:[e.jsx("h4",{style:Ne.rowTitle,children:ze()}),e.jsx("div",{style:Ne.rowMeta,children:Ce()})]}),e.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"12px",margin:0},children:["Expanded view coming soon for ",o]})]})},Zt="modulepreload",Qt=function(t){return"/Daggerheart/"+t},xt={},$e=function(o,p,c){if(!p||p.length===0)return o();const j=document.getElementsByTagName("link");return Promise.all(p.map(u=>{if(u=Qt(u),u in xt)return;xt[u]=!0;const v=u.endsWith(".css"),N=v?'[rel="stylesheet"]':"";if(!!c)for(let F=j.length-1;F>=0;F--){const P=j[F];if(P.href===u&&(!v||P.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${N}`))return;const E=document.createElement("link");if(E.rel=v?"stylesheet":Zt,v||(E.as="script",E.crossOrigin=""),E.href=u,document.head.appendChild(E),v)return new Promise((F,P)=>{E.addEventListener("load",F),E.addEventListener("error",()=>P(new Error(`Unable to preload CSS for ${u}`)))})})).then(()=>o()).catch(u=>{const v=new Event("vite:preloadError",{cancelable:!0});if(v.payload=u,window.dispatchEvent(v),!v.defaultPrevented)throw u})},Ut="/Daggerheart/assets/daggerheart-logo-fe7815ad.svg",gt={Minion:{difficulty:t=>[9,12,15,18][t-1],thresholds:t=>({major:0,severe:0}),hpMax:t=>1,stressMax:t=>1,atk:t=>[-1,0,1,2][t-1],damage:t=>["2","5","8","11"][t-1],range:"Melee"},Standard:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[7,10,20,25][t-1],severe:[12,20,32,45][t-1]}),hpMax:t=>[4,5,6,7][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[1,2,3,4][t-1],damage:t=>["1d8+1","2d8+2","3d8+3","4d8+4"][t-1],range:"Melee"},Bruiser:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[8,14,22,38][t-1],severe:[15,28,40,70][t-1]}),hpMax:t=>[6,7,8,9][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[-1,0,1,2][t-1],damage:t=>["1d12+2","2d12+4","3d12+6","4d12+8"][t-1],range:"Melee"},Horde:{difficulty:t=>[10,13,16,19][t-1],thresholds:t=>({major:[7,10,20,25][t-1],severe:[12,20,32,45][t-1]}),hpMax:t=>[5,6,7,8][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[-1,0,1,2][t-1],damage:t=>["1d8+2","2d8+4","3d8+6","4d8+8"][t-1],range:"Melee"},Leader:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[7,13,21,35][t-1],severe:[14,26,38,65][t-1]}),hpMax:t=>[5,6,7,8][t-1],stressMax:t=>[5,5,6,6][t-1],atk:t=>[2,4,6,8][t-1],damage:t=>["1d10+2","2d10+4","3d10+6","4d10+8"][t-1],range:"Melee"},Ranged:{difficulty:t=>[10,13,16,19][t-1],thresholds:t=>({major:[4,8,18,22][t-1],severe:[7,16,30,42][t-1]}),hpMax:t=>[3,4,5,6][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d8+2","2d8+4","3d8+6","4d8+8"][t-1],range:"Close"},Skulk:{difficulty:t=>[12,15,18,21][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,5,6,7][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d6+2","2d6+4","3d6+6","4d6+8"][t-1],range:"Melee"},Solo:{difficulty:t=>[12,15,18,21][t-1],thresholds:t=>({major:[7,13,21,35][t-1],severe:[14,26,38,65][t-1]}),hpMax:t=>[8,9,10,11][t-1],stressMax:t=>[5,5,6,6][t-1],atk:t=>[3,5,7,9][t-1],damage:t=>["1d10+3","2d10+6","3d10+9","4d10+12"][t-1],range:"Melee"},Support:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,4,5,5][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d4+2","2d4+4","3d4+6","4d4+8"][t-1],range:"Melee"},Social:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,4,5,5][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d4+2","2d4+4","3d4+6","4d4+8"][t-1],range:"Melee"}},Ze=(t,o)=>{const p=gt[o]||gt.Standard;return{difficulty:p.difficulty(t),thresholds:p.thresholds(t),hpMax:p.hpMax(t),stressMax:p.stressMax(t),atk:p.atk(t),damage:p.damage(t),range:p.range}};let It={adversaries:[]},yt=!1;const er=()=>({customAdversaries:JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]")}),tr=async()=>{if(yt)return;let t={adversaries:[]},o={adversaries:[]};try{const c=await $e(()=>import("./adversaries-9c8932de.js"),[]);t=(c==null?void 0:c.default)||c}catch(c){console.warn("Failed to load adversaries.json:",c)}try{const c=await $e(()=>import("./playtest-adversaries-4a099c10.js"),[]);o=(c==null?void 0:c.default)||c}catch(c){console.warn("Failed to load playtest-adversaries.json:",c)}const{customAdversaries:p}=er();It={...t,adversaries:[...t.adversaries||[],...o.adversaries||[],...p]},yt=!0},At=m.forwardRef(({onSave:t,onRefresh:o,onAddItem:p,editingAdversary:c,onCancelEdit:j,isStockAdversary:u=!1,autoFocus:v=!1,allAdversaries:N=[],embedded:x=!1,hideEmbeddedButtons:E=!1},F)=>{const P=m.useRef(null),[T,C]=m.useState(()=>{const f=Ze(1,"Standard");return{name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:f.difficulty,thresholds:f.thresholds,hpMax:f.hpMax,stressMax:f.stressMax,atk:f.atk,weapon:"",range:f.range,damage:f.damage,experience:[],features:[]}}),[J,xe]=m.useState(!1),[O,V]=m.useState(!1),[_,ve]=m.useState([]),[G,Ie]=m.useState(!1),[Ee,Re]=m.useState([]);m.useEffect(()=>{(async()=>{await tr(),N.length>0?Re(N):Re(It.adversaries||[])})()},[N]),m.useEffect(()=>{v&&P.current&&setTimeout(()=>{var f;(f=P.current)==null||f.focus()},100)},[v]),m.useEffect(()=>{if(c)C({name:c.name||"",tier:c.tier||1,type:c.type||"Standard",description:c.description||"",motives:c.motives||"",difficulty:c.difficulty||11,thresholds:c.thresholds||{major:7,severe:12},hpMax:c.hpMax||3,stressMax:c.stressMax||1,atk:c.atk||1,weapon:c.weapon||"",range:c.range||"Melee",damage:c.damage||"",experience:c.experience||[],features:c.features||[]}),V(!1);else{const f=Ze(1,"Standard");C({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:f.difficulty,thresholds:f.thresholds,hpMax:f.hpMax,stressMax:f.stressMax,atk:f.atk,weapon:"",range:f.range,damage:f.damage,experience:[],features:[]}),V(!1)}},[c]),m.useEffect(()=>{if(!c&&!O){const f=Ze(T.tier,T.type);C(te=>({...te,difficulty:f.difficulty,thresholds:f.thresholds,hpMax:f.hpMax,stressMax:f.stressMax,atk:f.atk,range:f.range,damage:f.damage}))}},[T.tier,T.type,c,O]);const se=f=>{if(C(te=>({...te,name:f})),f.trim().length>0){const te=Ee.filter(S=>{var Q;return(((Q=S.name)==null?void 0:Q.replace(/\s+\(\d+\)$/,""))||S.name||"").toLowerCase().includes(f.toLowerCase())}).slice(0,5);ve(te),Ie(te.length>0)}else ve([]),Ie(!1)},oe=async()=>{if(!T.name.trim()){alert("Please enter a name for the adversary");return}xe(!0);try{const f={...T,hp:c?c.hp:0,stress:c?c.stress:0,source:"Homebrew"};if(c)u?(await t(f),alert("Custom adversary created successfully!")):(f.id=c.id,await t(f,c.id),alert("Adversary updated successfully!")),j&&j();else{await t(f),o&&await o();const te=Ze(1,"Standard");C({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:te.difficulty,thresholds:te.thresholds,hpMax:te.hpMax,stressMax:te.stressMax,atk:te.atk,weapon:"",range:te.range,damage:te.damage,experience:[],features:[]}),V(!1),alert("Custom adversary created successfully!")}}catch(f){console.error("Error saving adversary:",f),alert("Error saving adversary. Please try again.")}finally{xe(!1)}};m.useImperativeHandle(F,()=>({handleSave:oe,isSaving:J,canSave:T.name.trim().length>0}));const fe={...T,id:"new-adversary",hp:0,stress:0,source:"Homebrew"},je=()=>J?c?u?"Creating...":"Saving...":"Creating...":c?u?"Save As Custom":"Save":"Create";return e.jsxs(e.Fragment,{children:[!x&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h2",{style:{color:"var(--text-primary)",fontSize:"1.5rem",fontWeight:"600",margin:0},children:c?u?"Edit Adversary (Save As Custom)":"Edit Custom Adversary":"Create Custom Adversary"}),e.jsx("button",{onClick:oe,disabled:J||!T.name.trim(),style:{padding:"0.75rem 1.5rem",backgroundColor:J||!T.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"8px",cursor:J||!T.name.trim()?"not-allowed":"pointer",fontSize:"1rem",fontWeight:"600",opacity:J||!T.name.trim()?.6:1},children:je()})]}),x&&!E&&e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",marginBottom:"0.5rem",padding:"0.5rem",borderBottom:"1px solid var(--border)"},children:[e.jsx("button",{onClick:oe,disabled:J||!T.name.trim(),style:{padding:"0.5rem 1rem",backgroundColor:J||!T.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"6px",cursor:J||!T.name.trim()?"not-allowed":"pointer",fontSize:"0.875rem",fontWeight:"600",opacity:J||!T.name.trim()?.6:1,marginRight:"0.5rem"},children:je()}),j&&e.jsx("button",{onClick:j,style:{padding:"0.5rem 1rem",backgroundColor:"transparent",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"6px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600"},children:"Cancel"})]}),!c&&e.jsxs("div",{style:{marginBottom:"1rem",position:"relative"},children:[e.jsx("input",{ref:P,type:"text",value:T.name,onChange:f=>{const te=f.target.value;C(S=>({...S,name:te})),se(te)},placeholder:"Adversary name",style:{width:"100%",padding:"0.75rem",border:"1px solid var(--border)",borderRadius:"8px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"1rem",outline:"none"}}),G&&_.length>0&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"0 0 8px 8px",borderTop:"none",maxHeight:"200px",overflowY:"auto",zIndex:1e3,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)"},children:_.map((f,te)=>{var de;const S=f.baseName||((de=f.name)==null?void 0:de.replace(/\s+\(\d+\)$/,""))||f.name;return e.jsxs("div",{onClick:()=>{C(Q=>({...Q,name:S,tier:f.tier||Q.tier,type:f.type||Q.type,difficulty:f.difficulty||Q.difficulty,thresholds:f.thresholds||Q.thresholds,hpMax:f.hpMax||Q.hpMax,stressMax:f.stressMax||Q.stressMax,atk:f.atk||Q.atk,range:f.range||Q.range,damage:f.damage||Q.damage})),Ie(!1),V(!0),P.current&&P.current.blur()},style:{padding:"0.75rem",cursor:"pointer",borderBottom:te<_.length-1?"1px solid var(--border)":"none",transition:"background-color 0.2s"},onMouseEnter:Q=>{Q.target.style.backgroundColor="var(--bg-secondary)"},onMouseLeave:Q=>{Q.target.style.backgroundColor="transparent"},onMouseDown:Q=>Q.preventDefault(),children:[e.jsx("div",{style:{fontWeight:"600"},children:S}),e.jsxs("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",marginTop:"2px"},children:[f.type," • Tier ",f.tier]})]},te)})})]}),e.jsx(et,{item:fe,type:"adversary",mode:"edit",onUpdate:(f,te)=>{C(S=>({...S,...te}))}})]})});At.displayName="CustomAdversaryCreator";const rr=(t,o)=>{const[p,c]=m.useState("max-content"),j=m.useCallback(()=>{if(!o.current||t<=3)return"max-content";const u=o.current.offsetWidth,N=Math.floor(u/120);return N<=1?"max-content":t===4?"max-content max-content":t===5||t===6?N>=2?"max-content max-content":"max-content":t===7?N>=3?"max-content max-content max-content":N>=2?"max-content max-content":"max-content":"repeat(auto-fit, minmax(80px, max-content))"},[t,o]);return m.useEffect(()=>{const u=j();c(u);const v=new ResizeObserver(()=>{const N=j();c(N)});return o.current&&v.observe(o.current),()=>{v.disconnect()}},[j]),p},nr=({encounter:t})=>{var j,u;const o=m.useRef(null),p=((j=t.encounterItems)==null?void 0:j.length)||0,c=rr(p,o);return e.jsx("div",{ref:o,className:"saved-encounter-adversary-list",style:{flex:1,fontSize:"0.8rem",color:"var(--text-secondary)",lineHeight:"1.3",display:"grid",gridTemplateColumns:c,gap:"0.25rem 1rem",gridAutoRows:"min-content"},children:((u=t.encounterItems)==null?void 0:u.length)>0?t.encounterItems.map((v,N)=>{var E;const x=v.item.baseName||((E=v.item.name)==null?void 0:E.replace(/\s+\(\d+\)$/,""))||v.item.name;return e.jsxs("div",{style:{marginBottom:"0.125rem"},children:[v.quantity,"x ",x]},N)}):e.jsx("div",{children:"No adversaries"})})},Ye={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},Qe={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1,lowerTierAdversary:1};let Ue={adversaries:[]},dt={environments:[]},ct=!1;const sr=()=>{const t=JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]"),o=JSON.parse(localStorage.getItem("daggerheart-custom-environments")||"[]");return{customAdversaries:t,customEnvironments:o}},vt=async()=>{if(ct)return;let t={adversaries:[]},o={environments:[]},p={adversaries:[]},c={environments:[]};try{const v=await $e(()=>import("./adversaries-9c8932de.js"),[]);t=(v==null?void 0:v.default)||v}catch(v){console.warn("Failed to load adversaries.json:",v)}try{const v=await $e(()=>import("./environments-c340637c.js"),[]);o=(v==null?void 0:v.default)||v}catch(v){console.warn("Failed to load environments.json:",v)}try{const v=await $e(()=>import("./playtest-adversaries-4a099c10.js"),[]);p=(v==null?void 0:v.default)||v}catch(v){console.warn("Failed to load playtest-adversaries.json:",v)}try{const v=await $e(()=>import("./playtest-environments-d9cdffb6.js"),[]);c=(v==null?void 0:v.default)||v}catch(v){console.warn("Failed to load playtest-environments.json:",v)}const{customAdversaries:j,customEnvironments:u}=sr();Ue={...t,adversaries:[...t.adversaries||[],...p.adversaries||[],...j]},dt={...o,environments:[...o.environments||[],...c.environments||[],...u]},ct=!0},or=(t,o=[],p=4,c=1,j=!1)=>{const[u,v]=m.useState(""),[N,x]=m.useState([{field:"tier",direction:"asc"},{field:"name",direction:"asc"}]),[E,F]=m.useState([]),[P,T]=m.useState(!0),[C,J]=m.useState([]),[xe,O]=m.useState([]),[V,_]=m.useState(!1),[ve,G]=m.useState(!1),Ie=m.useRef(null),Ee=m.useRef(null);m.useEffect(()=>{(async()=>{await vt(),T(!1);let ce=[];t==="adversary"?ce=Ue.adversaries||[]:t==="environment"&&(ce=dt.environments||[]),F(ce)})()},[t]);const Re=ee=>{const ce=E.map(Y=>Y[ee]).filter(Boolean);return[...new Set(ce)].sort((Y,ke)=>typeof Y=="number"&&typeof ke=="number"?Y-ke:String(Y).localeCompare(String(ke)))},se=m.useCallback(async()=>{ct=!1,await vt();let ee=[];t==="adversary"?j?ee=(Ue.adversaries||[]).filter(ce=>{var Y;return ce.source==="Homebrew"||((Y=ce.id)==null?void 0:Y.startsWith("custom-"))}):ee=Ue.adversaries||[]:t==="environment"&&(ee=dt.environments||[]),F(ee)},[t,j]);m.useEffect(()=>{se()},[j,se]);const oe=Re("tier"),fe=Re("type"),je=m.useMemo(()=>{let ee=E.filter(ce=>{var ze,Ce;const Y=ce.name.toLowerCase().includes(u.toLowerCase())||((ze=ce.type)==null?void 0:ze.toLowerCase().includes(u.toLowerCase()))||((Ce=ce.description)==null?void 0:Ce.toLowerCase().includes(u.toLowerCase())),ke=C.length===0||(C.includes("party-tier")?ce.tier===c:C.includes(ce.tier.toString())),Ae=xe.length===0||xe.includes(ce.type);return Y&&ke&&Ae});return ee.sort((ce,Y)=>{for(const ke of N){const{field:Ae,direction:ze}=ke;let Ce=ce[Ae],l=Y[Ae];if(Ae==="tier")Ce=parseInt(Ce)||0,l=parseInt(l)||0;else if(Ae==="cost"){const g=h=>{if(t!=="adversary")return 0;const d=Ye[h.type]||2;let r=0;const b=o.filter(z=>z.type==="adversary"&&z.item.type==="Solo"&&z.quantity>0).reduce((z,R)=>z+R.quantity,0),X=o.filter(z=>z.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(z.item.type)&&z.quantity>0).reduce((z,R)=>z+R.quantity,0);return h.type==="Solo"&&b===1&&(r+=2),["Bruiser","Horde","Leader","Solo"].includes(h.type)&&X===0&&(r+=1),d+r};Ce=g(ce),l=g(Y)}else if(Ae==="difficulty"){const g=parseInt(Ce),h=parseInt(l);!isNaN(g)&&!isNaN(h)?(Ce=g,l=h):!isNaN(g)&&isNaN(h)?(Ce=g,l=999):isNaN(g)&&!isNaN(h)?(Ce=999,l=h):(Ce=String(Ce||"").toLowerCase(),l=String(l||"").toLowerCase())}else typeof Ce=="string"&&typeof l=="string"?(Ce=Ce.toLowerCase(),l=l.toLowerCase()):(Ce=String(Ce||"").toLowerCase(),l=String(l||"").toLowerCase());if(ze==="asc"){if(Ce>l)return 1;if(Ce<l)return-1}else{if(Ce<l)return 1;if(Ce>l)return-1}}return 0}),ee},[E,u,N,C,xe,o,p,c]),f=ee=>{x(ce=>{const Y=ce.findIndex(ke=>ke.field===ee);if(Y>=0)if(Y===0){const ke=[...ce];return ke[0]={...ke[0],direction:ke[0].direction==="asc"?"desc":"asc"},ke}else{const ke=[...ce];return ke.splice(Y,1)[0],[{field:ee,direction:"asc"},...ke]}else return[{field:ee,direction:"asc"},...ce]})},te=ee=>{J(ee==="clear"?[]:ee==="party-tier"?["party-tier"]:ce=>ce.includes(ee)?ce.filter(Y=>Y!==ee):[...ce,ee])},S=ee=>{O(ee==="clear"?[]:ce=>ce.includes(ee)?ce.filter(Y=>Y!==ee):[...ce,ee])},de=C.length>0,Q=xe.length>0;return m.useEffect(()=>{const ee=Y=>{const ke=Y.target.closest(".filter-dropdown"),Ae=Y.target.closest(".header-filter-icon");ke||Ae||(_(!1),G(!1))},ce=Y=>{Y.key==="Escape"&&(_(!1),G(!1))};return document.addEventListener("pointerdown",ee,!0),document.addEventListener("mousedown",ee,!0),document.addEventListener("touchstart",ee,!0),document.addEventListener("click",ee,!0),document.addEventListener("keydown",ce,!0),()=>{document.removeEventListener("pointerdown",ee,!0),document.removeEventListener("mousedown",ee,!0),document.removeEventListener("touchstart",ee,!0),document.removeEventListener("click",ee,!0),document.removeEventListener("keydown",ce,!0)}},[_,G]),{searchTerm:u,setSearchTerm:v,sortFields:N,handleSort:f,filteredAndSortedData:je,loading:P,refreshData:se,selectedTiers:C,selectedTypes:xe,showTierDropdown:V,setShowTierDropdown:_,showTypeDropdown:ve,setShowTypeDropdown:G,tierFilterRef:Ie,typeFilterRef:Ee,uniqueTiers:oe,uniqueTypes:fe,handleTierSelect:te,handleTypeSelect:S,isTierFiltered:de,isTypeFiltered:Q,getDropdownStyle:ee=>{if(!ee.current)return{};const ce=ee.current.getBoundingClientRect();return{position:"fixed",top:ce.bottom+4,left:ce.left-100,zIndex:99999}}}},ar=({searchTerm:t,onSearchChange:o,type:p,partyControls:c,showCustomToggle:j=!1,onToggleCustom:u,filterCustom:v=!1,onExportCustomAdversaries:N,onImportCustomAdversaries:x,autoFocus:E=!1,onClose:F=null,placeholder:P="Search"})=>{const T=m.useRef(null);return m.useEffect(()=>{E&&T.current&&setTimeout(()=>{var C;(C=T.current)==null||C.focus()},100)},[E]),e.jsxs("div",{style:me.browserHeader,children:[e.jsx("div",{style:{display:"flex",alignItems:"center",flex:1,gap:"0.5rem"},children:e.jsx("input",{ref:T,type:"text",placeholder:P,value:t,onChange:C=>o(C.target.value),style:{...me.searchInput,flex:1,marginRight:0}})}),c&&e.jsx("div",{style:me.partyControls,children:c})]})},ir=({showCustomToggle:t=!1,onToggleCustom:o,filterCustom:p=!1,onExportCustomAdversaries:c,onImportCustomAdversaries:j})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)",flexShrink:0},children:[t&&e.jsxs("button",{onClick:()=>o&&o(!p),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:p?"var(--purple)":"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:p?"white":"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:u=>{p||(u.target.style.backgroundColor="var(--bg-hover)",u.target.style.borderColor="var(--purple)")},onMouseLeave:u=>{p||(u.target.style.backgroundColor="var(--bg-primary)",u.target.style.borderColor="var(--border)")},children:[e.jsx("span",{children:p?"✓":"○"}),"Custom Only"]}),e.jsxs("button",{onClick:c,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:u=>{u.target.style.backgroundColor="var(--bg-hover)",u.target.style.borderColor="var(--purple)"},onMouseLeave:u=>{u.target.style.backgroundColor="var(--bg-primary)",u.target.style.borderColor="var(--border)"},children:[e.jsx("span",{children:"↓"}),"Export"]}),e.jsxs("button",{onClick:()=>document.getElementById("import-file-input").click(),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:u=>{u.target.style.backgroundColor="var(--bg-hover)",u.target.style.borderColor="var(--purple)"},onMouseLeave:u=>{u.target.style.backgroundColor="var(--bg-primary)",u.target.style.borderColor="var(--border)"},children:[e.jsx("span",{children:"↑"}),"Import"]}),e.jsx("input",{id:"import-file-input",type:"file",accept:".csv,.json",onChange:j,style:{display:"none"}})]}),lr=({sortFields:t,onSort:o,type:p,uniqueTiers:c,uniqueTypes:j,selectedTiers:u,selectedTypes:v,showTierDropdown:N,setShowTierDropdown:x,showTypeDropdown:E,setShowTypeDropdown:F,tierFilterRef:P,typeFilterRef:T,handleTierSelect:C,handleTypeSelect:J,isTierFiltered:xe,isTypeFiltered:O,getDropdownStyle:V,costFilter:_,showCostDropdown:ve,setShowCostDropdown:G,costFilterRef:Ie,handleCostFilterSelect:Ee,isCostFiltered:Re})=>{const[se,oe]=m.useState(null),je=(()=>p==="adversary"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"cost",label:"Cost",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:p==="environment"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:[])(),f=()=>{if(!ve)return null;const S=[{value:"all",label:"All"},{value:"auto-grey",label:"Auto Grey"},{value:"auto-hide",label:"Auto Hide"}];return at.createPortal(e.jsx("div",{className:"filter-dropdown",style:{...me.filterDropdown,...V(Ie),maxHeight:"60vh",overflow:"auto"},onMouseDown:de=>de.stopPropagation(),onClick:de=>de.stopPropagation(),children:S.map(de=>{const Q=_===de.value;return e.jsxs("div",{style:{...me.filterOption,...Q?me.filterOptionSelected:{}},onClick:()=>Ee(de.value),children:[e.jsx("span",{style:me.checkIcon,children:Q?e.jsx(Xe,{size:16}):e.jsx(Ke,{size:16})}),e.jsx("span",{style:me.filterLabel,children:de.label})]},de.value)})}),document.body)},te=(S,de,Q,Me,ee,ce,Y,ke)=>{if(!ee)return null;const Ae=()=>{(S==="tier"||S==="type")&&Me("clear")};return at.createPortal(e.jsxs("div",{className:"filter-dropdown",style:{...me.filterDropdown,...V(Y),maxHeight:"60vh",overflow:"auto"},onMouseDown:ze=>ze.stopPropagation(),onClick:ze=>ze.stopPropagation(),children:[e.jsxs("div",{style:{...me.filterOption,...Q.length===0?me.filterOptionSelected:{}},onClick:Ae,children:[e.jsx("span",{style:me.checkIcon,children:Q.length===0?e.jsx(Xe,{size:16}):e.jsx(Ke,{size:16})}),e.jsx("span",{style:me.filterLabel,children:"All"})]}),S==="tier"&&e.jsxs("div",{style:{...me.filterOption,...Q.includes("party-tier")?me.filterOptionSelected:{}},onClick:()=>Me("party-tier"),children:[e.jsx("span",{style:me.checkIcon,children:Q.includes("party-tier")?e.jsx(Xe,{size:16}):e.jsx(Ke,{size:16})}),e.jsx("span",{style:me.filterLabel,children:"Party Tier"})]}),de.map(ze=>{const Ce=Q.includes(ze.toString());return e.jsxs("div",{style:{...me.filterOption,...Ce?me.filterOptionSelected:{}},onClick:()=>Me(ze.toString()),children:[e.jsx("span",{style:me.checkIcon,children:Ce?e.jsx(Xe,{size:16}):e.jsx(Ke,{size:16})}),e.jsx("span",{style:me.filterLabel,children:ze})]},ze)})]}),document.body)};return e.jsx("tr",{style:me.tableHeader,children:je.map(S=>e.jsxs("th",{style:{...me.tableHeaderCell,...se===S.key?me.tableHeaderCellHover:{},position:"relative",...S.key==="name"?{width:"auto",minWidth:"0"}:{},...S.key==="tier"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...S.key==="type"?{width:"80px",minWidth:"80px",maxWidth:"80px"}:{},...S.key==="difficulty"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...S.key==="cost"?{width:"50px",minWidth:"50px",maxWidth:"50px"}:{},...S.key==="action"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{}},onClick:()=>o(S.key),onMouseEnter:()=>oe(S.key),onMouseLeave:()=>oe(null),children:[S.hasFilter?e.jsxs("div",{style:me.headerWithFilter,children:[e.jsx("span",{style:{cursor:"pointer"},onClick:de=>{de.stopPropagation(),o(S.key)},children:S.label}),e.jsxs("button",{ref:S.key==="tier"?P:S.key==="type"?T:Ie,style:{...me.headerFilterIcon,...S.key==="tier"&&xe?me.headerFilterIconActive:{},...S.key==="type"&&O?me.headerFilterIconActive:{},...S.key==="cost"&&Re?me.headerFilterIconActive:{}},className:"header-filter-icon",onClick:de=>{de.stopPropagation(),S.key==="tier"?(x(!N),F(!1),G(!1)):S.key==="type"?(F(!E),x(!1),G(!1)):S.key==="cost"&&(G(!ve),x(!1),F(!1))},children:[e.jsx(Ot,{size:14}),S.key==="tier"&&xe||S.key==="type"&&O||S.key==="cost"&&Re?e.jsx("span",{style:me.filterActiveDot}):null]})]}):S.label,S.key==="tier"&&te("tier",c,u,C,N,x,P),S.key==="type"&&te("type",j,v,J,E,F,T),S.key==="cost"&&f()]},S.key))})},dr=({item:t,onAdd:o,type:p,onRowClick:c,encounterItems:j=[],pcCount:u=4,playerTier:v=1,remainingBudget:N=0,costFilter:x="auto-grey",onAdversaryClick:E})=>{const[F,P]=m.useState(!1),T=()=>{o(t)},C=()=>{if(p!=="adversary")return null;const O=Ye[t.type]||2;let V=0;const _=j.filter(G=>G.type==="adversary"&&G.item.type==="Solo"&&G.quantity>0).reduce((G,Ie)=>G+Ie.quantity,0),ve=j.filter(G=>G.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(G.item.type)&&G.quantity>0).reduce((G,Ie)=>G+Ie.quantity,0);return t.type==="Solo"&&_===1&&(V+=2),["Bruiser","Horde","Leader","Solo"].includes(t.type)&&ve===0&&(V+=1),O+V},xe=(()=>{if(p==="adversary"){const O=C();Ye[t.type];const V=O>N||N<=0;if(x==="auto-hide"&&V)return null;const _=x==="auto-grey"&&V?{opacity:.5,color:"var(--text-secondary)"}:{};return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...me.rowCell,width:"auto",minWidth:"0",textAlign:"left",..._},children:e.jsxs("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:[e.jsx("div",{style:{fontWeight:"600"},children:t.name}),t.description&&e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"0.125rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.description})]})}),e.jsx("td",{style:{...me.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",..._},children:t.tier}),e.jsx("td",{style:{...me.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center",..._},children:t.type}),e.jsx("td",{style:{...me.rowCell,width:"50px",minWidth:"50px",maxWidth:"50px",textAlign:"center",..._},children:O}),e.jsx("td",{style:{...me.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",..._},children:t.difficulty})]})}else if(p==="environment")return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...me.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:t.name}),e.jsx("td",{style:{...me.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:t.tier}),e.jsx("td",{style:{...me.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:t.type}),e.jsx("td",{style:{...me.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:t.difficulty})]});return null})();return xe===null?null:e.jsx(e.Fragment,{children:e.jsxs("tr",{style:{...me.row,...F?me.rowHover:{}},onClick:()=>{p==="adversary"&&E?E(t):c&&c(t,p)},onMouseEnter:()=>P(!0),onMouseLeave:()=>P(!1),children:[xe,e.jsx("td",{style:{width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",boxSizing:"border-box",overflow:"visible",textOverflow:"unset",whiteSpace:"nowrap"},children:e.jsx("button",{style:me.addButton,onClick:O=>{O.stopPropagation(),T()},onMouseEnter:O=>{O.target.style.background="var(--bg-secondary)"},onMouseLeave:O=>{O.target.style.background="var(--purple)"},children:"+"})})]})})},Et=({type:t,onAddItem:o,onCancel:p=null,onRowClick:c,encounterItems:j=[],pcCount:u=4,playerTier:v=1,partyControls:N=null,showContainer:x=!0,savedEncounters:E=[],onLoadEncounter:F,onDeleteEncounter:P,activeTab:T="adversaries",selectedCustomAdversaryId:C,onSelectCustomAdversary:J,onTabChange:xe,selectedAdversary:O,onSelectAdversary:V,filterCustom:_=!1,showCustomToggle:ve=!1,onToggleCustom:G,onExportCustomAdversaries:Ie,onImportCustomAdversaries:Ee,autoFocus:Re=!1,hideImportExport:se=!1,onClose:oe=null,searchPlaceholder:fe="Search"})=>{const{addCustomAdversary:je,updateCustomAdversary:f,customContent:te}=pt(),[S,de]=m.useState(null),[Q,Me]=m.useState("all"),[ee,ce]=m.useState(!1),[Y,ke]=m.useState({}),Ae=m.useRef({}),ze=m.useRef(null),Ce=()=>{try{const k=te.adversaries||[];if(k.length===0){alert("No custom adversaries to export.");return}const he=["name","tier","type","difficulty","threshold_major","threshold_severe","hp_max","stress_max","atk","weapon","range","damage","description","motives"],n=k.map(U=>{var L,ue;return[U.name||"",U.tier||"",U.type||"",U.difficulty||"",((L=U.thresholds)==null?void 0:L.major)||"",((ue=U.thresholds)==null?void 0:ue.severe)||"",U.hpMax||"",U.stressMax||"",U.atk||"",U.weapon||"",U.range||"",U.damage||"",U.description||"",U.motives||""]}),W=U=>{const L=String(U);return L.includes(",")||L.includes('"')||L.includes(`
`)?`"${L.replace(/"/g,'""')}"`:L},D=[he.join(","),...n.map(U=>U.map(W).join(","))].join(`
`),B=new Blob([D],{type:"text/csv;charset=utf-8;"}),q=URL.createObjectURL(B),H=document.createElement("a");H.href=q,H.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(H),H.click(),document.body.removeChild(H),URL.revokeObjectURL(q),console.log(`Exported ${k.length} custom adversaries to CSV`)}catch(k){console.error("Failed to export custom adversaries:",k),alert("Failed to export custom adversaries. Please try again.")}},l=k=>{const he=k.target.files[0];if(!he)return;const n=he.name.endsWith(".csv"),W=he.name.endsWith(".json");if(!n&&!W){alert("Please upload a CSV or JSON file."),k.target.value="";return}const D=new FileReader;D.onload=B=>{try{let q=[];if(n){const K=B.target.result.split(`
`).filter(ye=>ye.trim());if(K.length<2)throw new Error("CSV file is empty or invalid.");const $=K[0].split(",").map(ye=>ye.trim().replace(/^"|"$/g,""));for(let ye=1;ye<K.length;ye++){const ge=[];let Le="",Pe=!1;for(let _e=0;_e<K[ye].length;_e++){const Je=K[ye][_e],Mt=K[ye][_e+1];Je==='"'&&Pe&&Mt==='"'?(Le+='"',_e++):Je==='"'?Pe=!Pe:Je===","&&!Pe?(ge.push(Le.trim()),Le=""):Le+=Je}ge.push(Le.trim());const He={name:ge[$.indexOf("name")]||"",tier:parseInt(ge[$.indexOf("tier")])||1,type:ge[$.indexOf("type")]||"Standard",difficulty:parseInt(ge[$.indexOf("difficulty")])||11,thresholds:{major:parseInt(ge[$.indexOf("threshold_major")])||7,severe:parseInt(ge[$.indexOf("threshold_severe")])||12},hpMax:parseInt(ge[$.indexOf("hp_max")])||3,stressMax:parseInt(ge[$.indexOf("stress_max")])||1,atk:parseInt(ge[$.indexOf("atk")])||1,weapon:ge[$.indexOf("weapon")]||"",range:ge[$.indexOf("range")]||"Melee",damage:ge[$.indexOf("damage")]||"",description:ge[$.indexOf("description")]||"",motives:ge[$.indexOf("motives")]||"",source:"Homebrew"};He.name&&q.push(He)}}else if(W){const Se=JSON.parse(B.target.result);if(!Se.customAdversaries||!Array.isArray(Se.customAdversaries))throw new Error("Invalid JSON format. Expected customAdversaries array.");q=Se.customAdversaries}const H=te.adversaries||[],U=[...H];let L=0,ue=0;q.forEach(Se=>{if(H.some($=>$.name===Se.name&&$.source===Se.source))ue++;else{const $={...Se,id:`custom-adv-${Date.now()}-${Math.random().toString(36).slice(2,10)}`,hp:0,stress:0};U.push($),L++}}),L>0?(localStorage.setItem("daggerheart-custom-adversaries",JSON.stringify(U)),window.location.reload(),alert(`Import successful! Added ${L} new adversaries${ue>0?`, skipped ${ue} duplicates`:""}.`)):alert("No new adversaries were added. All imported adversaries already exist.")}catch(q){console.error("Failed to import custom adversaries:",q),alert(`Failed to import custom adversaries: ${q.message}`)}},D.readAsText(he),k.target.value=""},g=()=>{de(null)},h=async(k,he)=>{he?f(he,k):je(k)},d=k=>{Y[k]?(P&&P(k),ke(he=>{const n={...he};return delete n[k],n}),Ae.current[k]&&(clearTimeout(Ae.current[k]),delete Ae.current[k])):(ke(he=>({...he,[k]:!0})),Ae.current[k]&&clearTimeout(Ae.current[k]),Ae.current[k]=setTimeout(()=>{ke(he=>{const n={...he};return delete n[k],n}),delete Ae.current[k]},3e3))};m.useEffect(()=>()=>{Object.values(Ae.current).forEach(k=>{clearTimeout(k)})},[]);const{searchTerm:r,setSearchTerm:b,sortFields:X,handleSort:z,filteredAndSortedData:R,loading:we,selectedTiers:Te,selectedTypes:We,showTierDropdown:Be,setShowTierDropdown:a,showTypeDropdown:I,setShowTypeDropdown:s,tierFilterRef:A,typeFilterRef:ne,uniqueTiers:M,uniqueTypes:pe,handleTierSelect:i,handleTypeSelect:w,isTierFiltered:y,isTypeFiltered:ae,getDropdownStyle:Z}=or(t,j,u,v,_),ie=(()=>{const k=3*u+2,he=j.reduce((L,ue)=>{if(ue.type==="adversary"){const Se=Ye[ue.item.type]||2;if(ue.item.type==="Minion"){const K=Math.ceil(ue.quantity/u);return L+K*Se}else return L+ue.quantity*Se}return L},0);let n=0;j.filter(L=>L.type==="adversary"&&L.item.type==="Solo"&&L.quantity>0).reduce((L,ue)=>L+ue.quantity,0)>=2&&(n+=Qe.twoOrMoreSolos);const D=j.some(L=>L.type==="adversary"&&L.item.type==="Bruiser"&&L.quantity>0),B=j.some(L=>L.type==="adversary"&&L.item.type==="Horde"&&L.quantity>0),q=j.some(L=>L.type==="adversary"&&L.item.type==="Leader"&&L.quantity>0),H=j.some(L=>L.type==="adversary"&&L.item.type==="Solo"&&L.quantity>0);return!D&&!B&&!q&&!H&&(n+=Qe.noBruisersHordesLeadersSolos),k+n-he})(),le=k=>{Me(k),ce(!1)},re=Q!=="all";return we?e.jsx("div",{style:me.browser,children:e.jsx("div",{style:me.loading,children:"Loading..."})}):e.jsx(e.Fragment,{children:e.jsxs("div",{style:x?me.browserWrapper:me.browserWrapperNoContainer,children:[T==="adversaries"&&e.jsxs(e.Fragment,{children:[e.jsx(ar,{searchTerm:r,onSearchChange:b,type:t,partyControls:N,autoFocus:Re,onClose:oe,placeholder:fe}),!se&&e.jsx(ir,{showCustomToggle:ve,onToggleCustom:G,filterCustom:_,onExportCustomAdversaries:Ce,onImportCustomAdversaries:l}),e.jsx("div",{className:"browser-content invisible-scrollbar",style:me.browserContent,children:e.jsxs("table",{style:me.browserTable,children:[e.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,backgroundColor:"var(--bg-primary)"},children:e.jsx(lr,{sortFields:X,onSort:z,type:t,uniqueTiers:M,uniqueTypes:pe,selectedTiers:Te,selectedTypes:We,showTierDropdown:Be,setShowTierDropdown:a,showTypeDropdown:I,setShowTypeDropdown:s,tierFilterRef:A,typeFilterRef:ne,handleTierSelect:i,handleTypeSelect:w,isTierFiltered:y,isTypeFiltered:ae,getDropdownStyle:Z,costFilter:Q,showCostDropdown:ee,setShowCostDropdown:ce,costFilterRef:ze,handleCostFilterSelect:le,isCostFiltered:re})}),e.jsx("tbody",{children:R.map(k=>e.jsx(dr,{item:k,onAdd:o,type:t,onRowClick:c,encounterItems:j,pcCount:u,playerTier:v,remainingBudget:ie,costFilter:Q,onAdversaryClick:he=>{t==="adversary"&&(O&&O.id===he.id?V&&V(null):V&&V(he))}},k.id))})]})})]}),T==="encounters"&&e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:E.length===0?e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",textAlign:"center",padding:"2rem 1rem"},children:"No saved encounters yet"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:E.map(k=>e.jsxs("div",{onClick:()=>F&&F(k.id),className:"saved-encounter-card",style:{border:"1px solid var(--border)",borderRadius:"8px",padding:"8px",backgroundColor:"var(--bg-card)",transition:"background-color 0.2s ease",display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsxs("div",{style:{minWidth:"100px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",flexDirection:"column",justifyContent:"center",minHeight:"60px"},children:[e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Tier: ",(()=>{var W,D,B,q;const he=((q=(B=(D=(W=k.encounterItems)==null?void 0:W.filter(H=>H.type==="adversary"))==null?void 0:D.map(H=>H.item.tier))==null?void 0:B.filter(H=>H!=null))==null?void 0:q.sort((H,U)=>H-U))||[];if(he.length===0)return"N/A";if(he.length===1)return he[0];const n=[...new Set(he)];return n.length===1?n[0]:`${Math.min(...n)}-${Math.max(...n)}`})()]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Party Size: ",k.partySize||4]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)"},children:["Balance: ",(()=>{const he=k.partySize||4,n=3*he+2;let W=0;const D=k.encounterItems||[];D.filter(K=>K.type==="adversary"&&K.item.type==="Solo"&&K.quantity>0).reduce((K,$)=>K+$.quantity,0)>=2&&(W+=Qe.twoOrMoreSolos);const q=D.some(K=>K.type==="adversary"&&K.item.type==="Bruiser"&&K.quantity>0),H=D.some(K=>K.type==="adversary"&&K.item.type==="Horde"&&K.quantity>0),U=D.some(K=>K.type==="adversary"&&K.item.type==="Leader"&&K.quantity>0),L=D.some(K=>K.type==="adversary"&&K.item.type==="Solo"&&K.quantity>0);!q&&!H&&!U&&!L&&(W+=Qe.noBruisersHordesLeadersSolos);const ue=n+W,Se=D.reduce((K,$)=>{if($.type==="adversary"){const ye=Ye[$.item.type]||2;if($.item.type==="Minion"){const ge=Math.ceil($.quantity/he);return K+ge*ye}else return K+$.quantity*ye}return K},0);return Se>ue?`+${Se-ue}`:Se===ue?"0":`-${ue-Se}`})()]})]}),e.jsx("div",{style:{minWidth:"120px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",alignItems:"center",minHeight:"60px"},children:e.jsx("div",{style:{fontWeight:"500",color:"var(--text-primary)",fontSize:"0.9rem",wordWrap:"break-word",wordBreak:"break-word",width:"150px",maxWidth:"150px"},children:k.name})}),e.jsx(nr,{encounter:k}),e.jsx("button",{onClick:he=>{he.stopPropagation(),d(k.id)},style:{background:Y[k.id]?"var(--danger)":"var(--gray-600)",border:"none",color:"white",padding:"0.4rem 0.8rem",borderRadius:"4px",fontSize:"0.75rem",cursor:"pointer",minWidth:"60px",transition:"background-color 0.2s"},children:"Delete"})]},k.id))})}),T==="create"&&e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"1rem",display:"flex",justifyContent:"center",alignItems:"flex-start",height:"100%",minHeight:0},children:e.jsx("div",{style:{maxWidth:"600px",width:"100%",height:"auto",display:"flex",flexDirection:"column",padding:"0",overflowY:"visible",overflowX:"hidden",minHeight:0},children:e.jsx(At,{onSave:h,onRefresh:()=>{},onAddItem:o,editingAdversary:S,onCancelEdit:g,embedded:!1})})}),T==="info"&&e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"2rem"},children:[e.jsxs("div",{style:{marginBottom:"2rem",textAlign:"center"},children:[e.jsx("img",{src:Ut,alt:"Daggerheart Community Content Logo",style:{width:"100%",maxWidth:"300px",height:"auto",margin:"0 auto 1.5rem auto",display:"block"},onError:k=>{console.error("Failed to load Daggerheart logo:",k.target.src),k.target.style.display="none"}}),e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",textAlign:"left",maxWidth:"600px",margin:"0 auto"},children:[e.jsx("p",{style:{marginTop:0},children:"This product includes materials from the Daggerheart System Reference Document 1.0, © Critical Role, LLC, under the terms of the Darrington Press Community Gaming (DPCGL) License."}),e.jsxs("p",{children:["More information can be found at ",e.jsx("a",{href:"https://www.daggerheart.com",target:"_blank",rel:"noopener noreferrer",style:{color:"var(--purple)",textDecoration:"underline"},children:"daggerheart.com"})]}),e.jsx("p",{style:{marginBottom:0},children:e.jsx("em",{children:"This project is unofficial and not endorsed by Darrington Press or Critical Role."})})]})]}),e.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto",border:"1px solid var(--border)",borderRadius:"8px",overflow:"hidden"},children:[e.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"1rem 1.5rem",color:"var(--text-primary)",border:"none",background:"var(--bg-secondary)",width:"100%",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"0.875rem",borderBottom:"1px solid var(--border)"},onMouseEnter:k=>{k.target.style.backgroundColor="var(--bg-hover)"},onMouseLeave:k=>{k.target.style.backgroundColor="var(--bg-secondary)"},onClick:k=>{k.stopPropagation(),window.open("https://github.com/Splinter714/Daggerheart","_blank")},children:[e.jsx("span",{children:"View on GitHub"}),e.jsx("span",{children:"→"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem 1.5rem",color:"var(--text-secondary)",background:"var(--bg-secondary)",fontSize:"0.875rem"},children:["Version ","0.4.3 (67c9fdc)"]})]})]})]})})},me={browserWrapper:{display:"flex",flexDirection:"column",background:"var(--bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border)",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserWrapperNoContainer:{display:"flex",flexDirection:"column",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserContent:{flex:1,overflowY:"auto",overflowX:"visible",padding:0,width:"100%",scrollbarWidth:"none",msOverflowStyle:"none",borderRadius:"0 0 8px 8px"},tableHeaderContainer:{flexShrink:0,position:"sticky",top:0,zIndex:15,backgroundColor:"var(--bg-secondary)"},browserTable:{width:"100%",minWidth:"100%",borderCollapse:"collapse",tableLayout:"fixed",background:"var(--bg-primary)",margin:0},browserHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--gray-900)",flexShrink:0,position:"sticky",top:0,zIndex:20},browserTitle:{margin:0,color:"var(--text-primary)",fontSize:"18px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"24px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",marginRight:"12px",transition:"all 0.2s ease"},partyControls:{display:"flex",alignItems:"center",gap:"12px",flexShrink:0},searchInputFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 3px rgba(139, 92, 246, 0.1)"},tableHeader:{background:"var(--gray-900)",borderBottom:"1px solid var(--border)",boxShadow:"0 1px 0 var(--border)",position:"sticky",top:"0",zIndex:10},tableHeaderCell:{backgroundColor:"var(--gray-900)",fontWeight:"700",borderBottom:"1px solid var(--border)",cursor:"pointer",userSelect:"none",minWidth:"100px",whiteSpace:"nowrap",padding:"4px 4px",color:"var(--text-primary)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",boxShadow:"0 1px 0 var(--border)",transition:"background-color 0.2s",position:"sticky",top:"0",zIndex:10},tableHeaderCellHover:{backgroundColor:"var(--bg-hover)"},sortIndicator:{fontSize:"12px",color:"var(--text-secondary)"},tableBody:{flex:1,overflowY:"auto",padding:"8px",backgroundColor:"var(--bg-primary)"},row:{height:"35px",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s ease",cursor:"pointer",backgroundColor:"var(--gray-900)"},rowHover:{backgroundColor:"var(--bg-secondary)"},expandedRow:{backgroundColor:"var(--bg-secondary)"},rowCell:{padding:"4px 4px",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid var(--border)"},rowCellName:{fontWeight:"500",minWidth:"150px"},rowCellCenter:{textAlign:"center",justifyContent:"center",minWidth:"80px"},rowActions:{width:"80px",textAlign:"center",padding:"4px 8px",borderBottom:"1px solid var(--border)"},addButton:{width:"2rem",height:"2rem",border:"1px solid var(--purple)",borderRadius:"var(--radius-sm)",background:"var(--purple)",color:"white",cursor:"pointer",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"500"},expandedContent:{padding:"0",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)"},columnName:{width:"auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",paddingLeft:"8px",textAlign:"left"},columnTier:{width:"80px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnType:{width:"100px",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},columnDifficulty:{width:"40px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnAction:{width:"32px",minWidth:"24px",maxWidth:"24px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"visible",textOverflow:"unset"},loading:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"var(--text-primary)",fontSize:"16px"},mobileBrowser:{width:"95vw",height:"90vh",maxWidth:"none"},mobileSearchInput:{fontSize:"16px"},headerWithFilter:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0px",position:"relative"},headerFilterIcon:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"2px 4px",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",position:"relative",marginLeft:"-2px"},headerFilterIconActive:{color:"var(--purple)"},filterIcon:{fontSize:"12px"},filterActiveDot:{position:"absolute",left:"50%",top:"2px",transform:"translateX(-50%)",width:"4px",height:"4px",borderRadius:"50%",background:"var(--purple)",pointerEvents:"none"},filterDropdown:{position:"fixed",background:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",zIndex:99999,marginTop:"4px",overflow:"hidden",width:"max-content",minWidth:"120px",maxWidth:"200px"},filterOption:{padding:"8px 12px",cursor:"pointer",color:"var(--text-primary)",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background-color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},filterOptionSelected:{backgroundColor:"var(--bg-hover)"},checkIcon:{width:"16px",height:"16px",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"12px"},filterLabel:{flex:1}},cr=()=>e.jsx("div",{className:"pwa-install-prompt",style:{}}),pr=({side:t="left",children:o,className:p="",style:c={}})=>{const j=t==="left",u={flex:1,minWidth:0,background:"var(--bg-primary)",overflowY:"auto",overflowX:j?"auto":"hidden",display:j?"block":"flex",flexDirection:j?"initial":"column",height:"100%",padding:j?"8px 0 8px 0":"0 8px 0 0",...c};return e.jsx("div",{className:p,style:u,children:o})},ur=t=>3*t+2,mr={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},ot={lessDifficult:-1,twoOrMoreSolos:-2,increasedDamage:-2,lowerTierAdversary:1,noBruisersHordesLeadersSolos:1,moreDangerous:2},fr=({isOpen:t,onClose:o,onAddAdversary:p,onAddAdversariesBulk:c,onAddEnvironment:j,onDeleteAdversary:u,onDeleteEnvironment:v,onDeleteCountdown:N,adversaries:x=[],environments:E=[],countdowns:F=[],savedEncounters:P=[],onSaveEncounter:T,onLoadEncounter:C,onDeleteEncounter:J})=>{const{partySize:xe,updatePartySize:O,currentEncounterName:V,updateCurrentEncounterName:_,customContent:ve}=pt(),G=xe,Ie=O,[Ee,Re]=m.useState({lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),[se,oe]=m.useState([]),[fe,je]=m.useState(V||"Encounter"),[f,te]=m.useState("adversaries"),[S,de]=m.useState(null),[Q,Me]=m.useState(null),[ee,ce]=m.useState(null),[Y,ke]=m.useState(null),[Ae,ze]=m.useState(!1);m.useEffect(()=>{t&&!S&&je(V||"Encounter")},[t,S,V]);const Ce=()=>Q?fe!==Q.name||JSON.stringify(se)!==JSON.stringify(Q.encounterItems)||G!==Q.partySize||JSON.stringify(Ee)!==JSON.stringify(Q.battlePointsAdjustments):!1,l=()=>{var i;if(se.length>0||(fe||"").trim()!=="Encounter")return!0;if(S&&Ce()){if(Q){const w=se.length,y=((i=Q.encounterItems)==null?void 0:i.length)||0;if(w!==y||(fe||"").trim()!==(Q.name||""))return!0;const ae=JSON.stringify(Ee),Z=JSON.stringify(Q.battlePointsAdjustments||{});return ae!==Z}return!0}return!1},g=({onClick:i,children:w,variant:y="secondary",isConfirmation:ae=!1})=>{const Z=y==="danger"||y==="secondary"&&ae,be=y==="purple";return e.jsx("button",{onClick:i,style:{background:Z?"var(--danger)":be?"var(--purple)":"var(--bg-secondary)",border:be?"none":"1px solid var(--border)",color:Z||be?"white":"var(--text-primary)",padding:"0.375rem 0.75rem",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s",width:"70px",fontSize:"0.875rem"},children:w})},h=Fe.useRef(G),d=m.useCallback(i=>!i||i.length===0?null:P.find(y=>{var ie,le;if(((ie=y.encounterItems)==null?void 0:ie.length)!==i.length)return!1;const ae=re=>{var k;return{type:re.type,quantity:re.quantity,item:{name:re.item.baseName||((k=re.item.name)==null?void 0:k.replace(/\s+\(\d+\)$/,""))||re.item.name,type:re.item.type,tier:re.item.tier}}},Z=(le=y.encounterItems)==null?void 0:le.map(ae).sort((re,k)=>re.item.name.localeCompare(k.item.name)||re.item.type.localeCompare(k.item.type)),be=i.map(ae).sort((re,k)=>re.item.name.localeCompare(k.item.name)||re.item.type.localeCompare(k.item.type));return JSON.stringify(Z)===JSON.stringify(be)})||null,[P]);Fe.useEffect(()=>{if(t&&x.length>0&&se.length===0){const i={};x.forEach(ae=>{var be;const Z=ae.baseName||((be=ae.name)==null?void 0:be.replace(/\s+\(\d+\)$/,""))||ae.name;i[Z]||(i[Z]={type:"adversary",item:ae,quantity:0}),i[Z].quantity+=1});const w=Object.values(i);oe(w);const y=d(w);y&&!S&&(de(y.id),Me({name:y.name||"",encounterItems:y.encounterItems||[],partySize:y.partySize||4,battlePointsAdjustments:y.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),je(y.name||"Encounter"),_(y.name||"Encounter"))}else t&&x.length===0&&se.length===0&&oe([])},[t,d,S,_]);const r=Fe.useMemo(()=>{let i=0;se.filter(ie=>ie.type==="adversary"&&ie.item.type==="Solo"&&ie.quantity>0).reduce((ie,le)=>ie+le.quantity,0)>=2&&(i+=ot.twoOrMoreSolos);const y=se.some(ie=>ie.type==="adversary"&&ie.item.type==="Bruiser"&&ie.quantity>0),ae=se.some(ie=>ie.type==="adversary"&&ie.item.type==="Horde"&&ie.quantity>0),Z=se.some(ie=>ie.type==="adversary"&&ie.item.type==="Leader"&&ie.quantity>0),be=se.some(ie=>ie.type==="adversary"&&ie.item.type==="Solo"&&ie.quantity>0);return!y&&!ae&&!Z&&!be&&(i+=ot.noBruisersHordesLeadersSolos),i},[se]),b=ur(G),X=Object.entries(Ee).filter(([i,w])=>w).reduce((i,[w,y])=>i+ot[w],0),z=b+X+r,R=se.reduce((i,w)=>{if(w.type==="adversary"){const y=mr[w.item.type]||2;return w.item.type==="Minion"?i+Math.ceil(w.quantity/G)*y:i+y*w.quantity}return i},0);Fe.useEffect(()=>{const i=h.current;i!==G&&(oe(w=>w.map(y=>{if(y.type==="adversary"&&y.item.type==="Minion"){const Z=Math.ceil(y.quantity/i)*G;return{...y,quantity:Z}}return y})),h.current=G)},[G]);const we=(i,w)=>{const y=se.findIndex(be=>be.item.id===i.id&&be.type===w),ae=i.type==="Minion"?G:1;let Z;y>=0?Z=se.map((be,ie)=>ie===y?{...be,quantity:be.quantity+ae}:be):Z=[...se,{item:i,type:w,quantity:ae}],oe(Z),Te(Z)},Te=i=>{const w=x||[],y=[];i.forEach(le=>{for(let re=0;re<le.quantity;re++)le.type==="adversary"&&y.push(le.item)});const ae={};w.forEach(le=>{var k;const re=le.baseName||((k=le.name)==null?void 0:k.replace(/\s+\(\d+\)$/,""))||le.name;ae[re]||(ae[re]=[]),ae[re].push(le)});const Z={};y.forEach(le=>{var k;const re=le.baseName||((k=le.name)==null?void 0:k.replace(/\s+\(\d+\)$/,""))||le.name;Z[re]||(Z[re]=[]),Z[re].push(le)});const be=[],ie=[];Object.keys(Z).forEach(le=>{var he;const re=((he=ae[le])==null?void 0:he.length)||0,k=Z[le].length;if(k>re){const n=k-re;for(let W=0;W<n;W++)be.push(Z[le][0])}else if(k<re){const n=re-k,D=[...ae[le]].sort((B,q)=>{const H=B.duplicateNumber||1;return(q.duplicateNumber||1)-H});for(let B=0;B<n;B++)ie.push(D[B].id)}}),Object.keys(ae).forEach(le=>{Z[le]||[...ae[le]].sort((he,n)=>{const W=he.duplicateNumber||1;return(n.duplicateNumber||1)-W}).forEach(he=>{ie.push(he.id)})}),ie.forEach(le=>{u(le)}),be.length>0&&c(be)},We=(i,w)=>{const y=(()=>{const ae=se.findIndex(Z=>Z.item.id===i&&Z.type===w);if(ae>=0){const Z=se[ae];if(Z.quantity===0)return se.filter((le,re)=>re!==ae);const be=Z.item.type==="Minion"?G:1,ie=Math.max(0,Z.quantity-be);return se.map((le,re)=>re===ae?{...le,quantity:ie}:le)}return se})();oe(y),Te(y)},Be=m.useCallback(()=>{if(se.length===0)return null;const i=(fe||"").trim()||"Encounter",w=P.find(y=>{var be,ie;if(y.name!==i||((be=y.encounterItems)==null?void 0:be.length)!==se.length)return!1;const ae=JSON.stringify((ie=y.encounterItems)==null?void 0:ie.sort()),Z=JSON.stringify([...se].sort());return ae===Z});return(w==null?void 0:w.id)||null},[P,fe,se]),a=m.useCallback(()=>{let i=(fe||"").trim(),w=S;if(w||(w=Be()),se.length===0&&(!i||i==="Encounter")&&w){J(w),de(null),Me(null);return}const y={name:i,encounterItems:se,partySize:G,battlePointsAdjustments:Ee};if(w){y.id=w;const ae=T(y);de(ae)}else{const ae=T(y);de(ae)}Me({name:i,encounterItems:se,partySize:G,battlePointsAdjustments:Ee})},[se,fe,G,Ee,S,T,Be,J]);m.useEffect(()=>{if(S&&Ce()){const i=setTimeout(()=>{a()},2e3);return()=>clearTimeout(i)}else if(!S&&se.length>0&&fe&&fe.trim()!==""){const i=setTimeout(()=>{a()},2e3);return()=>clearTimeout(i)}},[se,S,fe,Ee,G]);const I=()=>{l()&&(oe([]),je("Encounter"),_("Encounter"),de(null),Me(null),x.forEach(i=>{u(i.id)}),E.forEach(i=>{v(i.id)}),F.forEach(i=>{N(i.id)}))},s=i=>{const w=C(i);if(w){const y=w.encounterItems||[];oe(y),Ie(w.partySize||4),Re(w.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),je(w.name||""),_(w.name||""),de(i),Me({name:w.name||"",encounterItems:w.encounterItems||[],partySize:w.partySize||4,battlePointsAdjustments:w.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),Te(y)}},A=i=>{J(i),S===i&&(oe([]),je("Encounter"),_("Encounter"),de(null),Me(null),x.forEach(w=>{u(w.id)}),E.forEach(w=>{v(w.id)}),F.forEach(w=>{N(w.id)}))},ne=()=>{try{const i={version:"1.0",exportDate:new Date().toISOString(),customAdversaries:ve.adversaries||[]},w=JSON.stringify(i,null,2),y=new Blob([w],{type:"application/json"}),ae=URL.createObjectURL(y),Z=document.createElement("a");Z.href=ae,Z.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(Z),Z.click(),document.body.removeChild(Z),URL.revokeObjectURL(ae),console.log("Custom adversaries exported successfully")}catch(i){console.error("Failed to export custom adversaries:",i),alert("Failed to export custom adversaries. Please try again.")}},M=i=>{const w=i.target.files[0];if(!w)return;const y=new FileReader;y.onload=ae=>{try{const Z=JSON.parse(ae.target.result);if(!Z.customAdversaries||!Array.isArray(Z.customAdversaries))throw new Error("Invalid file format. Expected customAdversaries array.");const be=ve.adversaries||[],ie=Z.customAdversaries,le=[...be];let re=0;ie.forEach(k=>{be.some(n=>n.name===k.name&&n.type===k.type)||(le.push({...k,id:`custom-${Date.now()}-${Math.random().toString(36).slice(2,10)}`}),re++)}),updateCustomContent("adversary",null,le),re>0?alert(`Successfully imported ${re} custom adversaries.`):alert("No new adversaries were added. All imported adversaries already exist.")}catch(Z){console.error("Failed to import custom adversaries:",Z),alert("Failed to import custom adversaries. Please check the file format and try again.")}},y.readAsText(w),i.target.value=""};if(!t)return null;const pe=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://");return e.jsx("div",{onClick:o,className:"encounter-builder-modal",style:{position:"fixed",top:0,left:0,right:0,bottom:pe?"calc(60px + env(safe-area-inset-bottom) + 1rem)":"calc(60px + env(safe-area-inset-bottom))",backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:1e3,display:"flex",alignItems:"flex-start",justifyContent:"center",padding:"12px"},children:e.jsxs("div",{onClick:i=>i.stopPropagation(),style:{backgroundColor:"var(--bg-primary)",border:"2px solid var(--border)",borderRadius:"12px",width:"100%",maxWidth:"1200px",height:"100%",maxHeight:"100%",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"},children:[e.jsxs("div",{className:"encounter-top-bar",style:{flex:"0 0 auto",display:"flex",alignItems:"center",height:"39px",backgroundColor:"var(--bg-primary)",borderBottom:"1px solid var(--border)"},children:[e.jsx("button",{onClick:()=>te("adversaries"),style:{flex:1,background:f==="adversaries"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:f==="adversaries"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Builder"}),e.jsx("button",{onClick:()=>te("encounters"),style:{flex:1,background:f==="encounters"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:f==="encounters"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Saved Encounters"}),e.jsx("button",{onClick:()=>te("create"),style:{flex:1,background:f==="create"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:f==="create"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Create Adversary"}),e.jsx("button",{onClick:()=>te("info"),style:{flex:1,background:f==="info"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:f==="info"?"500":"400",transition:"all 0.2s ease",position:"relative"},children:"Info"})]}),e.jsxs("div",{className:"encounter-builder-content",style:{flex:1,display:"flex",overflow:"hidden"},children:[e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",borderTop:"1px solid var(--border)"},children:e.jsx(Et,{type:"adversary",onAddItem:i=>we(i,"adversary"),encounterItems:se,pcCount:G,showContainer:!1,savedEncounters:P,onLoadEncounter:s,onDeleteEncounter:A,activeTab:f,selectedCustomAdversaryId:ee,onSelectCustomAdversary:ce,onTabChange:te,selectedAdversary:Y,onSelectAdversary:ke,filterCustom:Ae,showCustomToggle:!0,onToggleCustom:ze,onExportCustomAdversaries:ne,onImportCustomAdversaries:M})}),f!=="info"&&e.jsxs("div",{className:"encounter-right-panel",style:{flex:1,borderLeft:"1px solid var(--border)",display:"flex",flexDirection:"column",overflow:"hidden",position:"relative"},children:[Y&&e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"var(--bg-primary)",zIndex:10,display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)",flexShrink:0},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:0},children:"Adversary Preview"}),e.jsx("button",{onClick:()=>ke(null),style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease"},onMouseEnter:i=>i.target.style.color="var(--text-primary)",onMouseLeave:i=>i.target.style.color="var(--text-secondary)",title:"Close preview",children:e.jsx(Ve,{size:16})})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"0.75rem"},children:e.jsx(et,{item:{...Y,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...Y,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}})})]}),(f==="adversaries"||f==="encounters")&&e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-primary)",flexShrink:0},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:fe,onChange:i=>{je(i.target.value),_(i.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(g,{onClick:I,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:l()?1:.5,cursor:l()?"pointer":"not-allowed"},children:"New"})]})}),(f==="adversaries"||f==="encounters")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"encounter-receipt-buttons-vertical",style:{display:"none",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:fe,onChange:i=>{je(i.target.value),_(i.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(g,{onClick:I,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:l()?1:.5,cursor:l()?"pointer":"not-allowed"},children:"New"})]})}),e.jsx("div",{className:"receipt-content",style:{padding:"1rem",display:"flex",flexDirection:"column",height:"100%"},children:e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"flex-start",overflowY:"auto",marginBottom:"0.75rem"},children:[e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>Ie(Math.max(1,G-1)),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(it,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:G}),e.jsx("button",{onClick:()=>Ie(G+1),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(Ge,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Party Size"})}),e.jsx("div",{style:{width:"120px",textAlign:"right"}})]}),se.map(i=>{var w;return i.type!=="adversary"?null:e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>We(i.item.id,i.type),style:{background:i.quantity===0?"var(--danger)":"var(--bg-secondary)",border:i.quantity===0?"none":"1px solid var(--border)",color:i.quantity===0?"white":"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:i.quantity===0?e.jsx(Ve,{size:10}):e.jsx(it,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:i.quantity}),e.jsx("button",{onClick:()=>we(i.item,i.type),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(Ge,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:i.item.baseName||((w=i.item.name)==null?void 0:w.replace(/\s+\(\d+\)$/,""))||i.item.name})}),e.jsx("div",{style:{width:"80px",textAlign:"right"},children:e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.8rem"},children:i.item.type})})]},`${i.item.id}-${i.type}`)}),e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Balance"})}),e.jsx("div",{style:{width:"120px",textAlign:"right",display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsx("span",{style:{color:R>z?"var(--danger)":R===z?"var(--purple)":"var(--success)",fontWeight:600},children:R>z?`+${R-z}`:z-R===0?"0":`-${z-R}`})})]})]})})]}),f==="create"&&e.jsxs("div",{style:{padding:"1.5rem",overflowY:"auto",height:"100%"},children:[e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Creating Adversaries"}),e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsx("p",{children:"Use the form to create custom adversaries for your encounters."}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Adversary Types:"}),e.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Minion (1 BP):"})," Weak enemies in groups"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Standard (2 BP):"})," Average threat level"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Leader (3 BP):"})," Commands others"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Bruiser (4 BP):"})," High HP tank"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Solo (5 BP):"})," Boss-level threat"]})]})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Tips:"}),e.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[e.jsx("li",{children:"Match adversary tier to party level"}),e.jsx("li",{children:"Balance encounter difficulty with Battle Points"}),e.jsx("li",{children:"Mix adversary types for variety"}),e.jsx("li",{children:"Add features that create interesting choices"})]})]})]})]}),f==="myAdversaries"&&e.jsx("div",{style:{padding:"0.75rem",overflowY:"auto",height:"100%"},children:ee?(()=>{var w;const i=(w=ve==null?void 0:ve.adversaries)==null?void 0:w.find(y=>y.id===ee);return i?e.jsx(et,{item:{...i,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...i,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}}):e.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Adversary not found"})})():e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Adversary Preview"}),e.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Select an adversary to view details"})]})})]})]})]})})},hr=t=>3*t+2,xr={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},bt={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1};class gr extends Fe.Component{constructor(o){super(o),this.state={hasError:!1,error:null}}static getDerivedStateFromError(o){return{hasError:!0,error:o}}componentDidCatch(o,p){console.error("ErrorBoundary caught an error:",o,p)}render(){var o;return this.state.hasError?e.jsxs("div",{className:"p-md text-red",children:[e.jsx("h3",{children:"Something went wrong:"}),e.jsx("pre",{children:(o=this.state.error)==null?void 0:o.toString()}),e.jsx("button",{className:"btn-base btn-text",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try again"})]}):this.props.children}}const yr=()=>{const{adversaries:t,environments:o,countdowns:p,fear:c,savedEncounters:j,partySize:u,updateFear:v,createAdversary:N,createAdversariesBulk:x,updateAdversary:E,deleteAdversary:F,createEnvironment:P,updateEnvironment:T,deleteEnvironment:C,createCountdown:J,updateCountdown:xe,deleteCountdown:O,advanceCountdown:V,saveEncounter:_,loadEncounter:ve,deleteEncounter:G}=pt(),Ie=u||4,[Ee,Re]=m.useState(!1),[se,oe]=m.useState(!1);m.useState(!1),m.useState(!1),m.useState(!0);const[fe,je]=m.useState(null),[f,te]=m.useState(null),[S,de]=m.useState(null),[Q,Me]=m.useState(!1),[ee,ce]=m.useState(0),[Y,ke]=m.useState(0),[Ae,ze]=m.useState(!1),[Ce,l]=m.useState(new Set),[g,h]=m.useState(new Set),d=m.useRef(null);m.useEffect(()=>{const n=()=>{const D=window.matchMedia("(max-width: 800px)");Re(D.matches)};n();const W=window.matchMedia("(max-width: 800px)");return W.addEventListener("change",n),()=>W.removeEventListener("change",n)},[]);const r=12,b=n=>n===1?200:350,X=n=>{if(n<=0)return{visibleColumns:1,columnWidth:b(1)};const W=r*2,D=n-W;let B={visibleColumns:1,columnWidth:D};for(let H=1;H<=5;H++){const U=(H-1)*r,L=(D-U)/H;L>=b(H)&&H*L+U<=D&&(B={visibleColumns:H,columnWidth:L})}return B.visibleColumns*B.columnWidth+(B.visibleColumns-1)*r>D&&(B={visibleColumns:1,columnWidth:D}),B},{visibleColumns:z,columnWidth:R}=X(ee);m.useEffect(()=>{const n=()=>{ce(window.innerWidth)};return n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]);const we=()=>{oe(!0)},Te=m.useCallback(()=>{oe(!1)},[]),We=m.useCallback(n=>{let W=!1;if(d.current){const D=d.current,B=D.scrollLeft,q=D.scrollWidth-D.clientWidth;W=Math.abs(B-q)<1,W&&(D._wasAtMaxScrollOnBrowserOpen=!0)}te(n)},[]);m.useEffect(()=>{f!==null&&d.current&&d.current._wasAtMaxScrollOnBrowserOpen&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(d.current){const D=d.current,B=D.scrollWidth-D.clientWidth;D.scrollLeft=B,D._wasAtMaxScrollOnBrowserOpen=!1}})})},[f,R,r]);const Be=m.useCallback(()=>{te(null)},[]),a=m.useCallback((n,W=600,D="unknown")=>{if(console.log("[HORIZONTAL_SCROLL] smoothScrollTo called:",{targetScrollLeft:n,duration:W,reason:D,timestamp:performance.now()}),!d.current){console.log("[HORIZONTAL_SCROLL] No container ref, aborting");return}const B=d.current,q=B.scrollLeft,H=n-q;if(console.log("[HORIZONTAL_SCROLL] Scroll params:",{startScrollLeft:q,targetScrollLeft:n,distance:H,containerWidth:B.clientWidth,scrollWidth:B.scrollWidth}),Math.abs(H)<1){console.log("[HORIZONTAL_SCROLL] Distance too small, skipping animation");return}B._horizontalScrollAnimationId&&(console.log("[HORIZONTAL_SCROLL] Canceling existing animation"),cancelAnimationFrame(B._horizontalScrollAnimationId),B._horizontalScrollAnimationId=null);const L=window.getComputedStyle(B).scrollSnapType!=="none",ue=L?"x mandatory":null;console.log("[HORIZONTAL_SCROLL] Scroll-snap state:",{hasScrollSnap:L,originalScrollSnapType:ue}),L&&(B.style.scrollSnapType="none");const Se=performance.now();console.log("[HORIZONTAL_SCROLL] Starting animation at:",Se);const K=$=>{const ye=$-Se,ge=Math.min(ye/W,1),Le=1-ge,Pe=1-Le*Le*Le;if(B){const He=q+H*Pe;B.scrollLeft=He}ge<1?B._horizontalScrollAnimationId=requestAnimationFrame(K):(console.log("[HORIZONTAL_SCROLL] Animation complete, final scrollLeft:",B.scrollLeft),B&&(B.scrollLeft=n,B._horizontalScrollAnimationId=null),ue&&setTimeout(()=>{B&&(B.style.scrollSnapType=ue,B.offsetHeight,console.log("[HORIZONTAL_SCROLL] Scroll-snap re-enabled"))},50))};return B._horizontalScrollAnimationId=requestAnimationFrame(K),()=>{animationId&&cancelAnimationFrame(animationId),L&&B&&(B.style.scrollSnapType=ue||"")}},[]),I=m.useCallback(()=>{const n={};return t.forEach(W=>{var B;const D=W.baseName||((B=W.name)==null?void 0:B.replace(/\s+\(\d+\)$/,""))||W.name;n[D]||(n[D]={type:"adversary",baseName:D,instances:[]}),n[D].instances.push(W)}),p.forEach(W=>{n[`countdown-${W.id}`]={type:"countdown",baseName:W.name,instances:[W]}}),Object.values(n)},[t,p]),s=I(),A=m.useCallback(n=>{var q;const W=n.baseName||((q=n.name)==null?void 0:q.replace(/\s+\(\d+\)$/,""))||n.name,B=!s.find(H=>H.baseName===W&&H.type==="adversary");if(N(n),je("adversary"),B){const H=`adversary-${W}`;h(U=>new Set(U).add(H)),setTimeout(()=>{h(U=>{const L=new Set(U);return L.delete(H),L})},10)}setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!d.current)return;const H=d.current;if(!(H.scrollWidth<=H.clientWidth))if(B){const U=H.scrollWidth-H.clientWidth;console.log("[HORIZONTAL_SCROLL] New adversary added, calculating maxScroll:",{maxScroll:U,scrollWidth:H.scrollWidth,clientWidth:H.clientWidth}),setTimeout(()=>{console.log("[HORIZONTAL_SCROLL] Calling smoothScrollTo for new adversary, maxScroll:",U),a(U,600,"new-adversary")},10)}else{const L=I().findIndex(ue=>ue.baseName===W&&ue.type==="adversary");if(L>=0){const ue=d.current,Se=ue.scrollLeft,K=ue.clientWidth,$=L*(R+r),ye=$+R+r,ge=10;$>=Se-ge&&ye<=Se+K+ge||a($,600)}}})})},50)},[N,s,R,r,a,I,f]),ne=m.useCallback(()=>{N({name:"",baseName:"",tier:1,type:"Standard",description:"",motives:"",difficulty:11,thresholds:{major:7,severe:12},hpMax:3,stressMax:1,atk:1,weapon:"",range:"Melee",damage:"",experience:[],features:[],source:"Homebrew",hp:0,stress:0,isVisible:!0}),setTimeout(()=>{const W=I();for(const D of W)if(D.type==="adversary"){const B=D.instances.find(q=>q.source==="Homebrew"&&(!q.baseName||q.baseName.trim()===""||q.baseName==="Unknown"));if(B&&!S){de(B.id),requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(d.current){d.current;const q=W.findIndex(H=>H.instances.some(U=>U.id===B.id));if(q>=0){const H=q*(R+r);a(H,600,"new-custom-adversary")}}})});break}}},100)},[N,I,R,r,a,S]),M=m.useCallback(n=>{de(n),Me(!1)},[]),pe=m.useCallback(()=>{de(null),Me(!1)},[]),i=m.useCallback(async(n,W)=>{if(W)E(W,n),de(null);else if(S){const D=N({...n,id:void 0});return de(null),D}else{const D=N({...n,id:void 0});return Me(!1),D}},[S,N,E]),y=m.useCallback(()=>{const n={};return t.forEach(W=>{var B;const D=W.baseName||((B=W.name)==null?void 0:B.replace(/\s+\(\d+\)$/,""))||W.name;n[D]||(n[D]={type:"adversary",item:W,quantity:0}),n[D].quantity+=1}),Object.values(n)},[t])(),ae=hr(Ie),Z=y.filter(n=>n.item.type==="Solo"&&n.quantity>0).reduce((n,W)=>n+W.quantity,0),be=y.some(n=>n.item.type&&["Bruiser","Horde","Leader","Solo"].includes(n.item.type)&&n.quantity>0);let ie=0;Z>=2&&(ie+=bt.twoOrMoreSolos),be||(ie+=bt.noBruisersHordesLeadersSolos);const le=ae+ie,re=y.reduce((n,W)=>{if(W.type==="adversary"){const D=xr[W.item.type]||2;return W.item.type==="Minion"?n+Math.ceil(W.quantity/Ie)*D:n+D*W.quantity}return n},0),k=m.useRef(null),he=m.useCallback(n=>{ke(n.target.scrollLeft),k.current&&clearTimeout(k.current),k.current=setTimeout(()=>{const W=n.target;W&&W.style.scrollSnapType==="none"&&(W.style.scrollSnapType="x mandatory")},150)},[]);return m.useCallback(()=>{ze(!0)},[]),m.useCallback(()=>{setTimeout(()=>ze(!1),100)},[]),s.length,e.jsxs("div",{className:"app",onClick:n=>{n.target,n.currentTarget},children:[e.jsx(Jt,{position:"top",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",width:"100%",justifyContent:"space-between",padding:"0 1rem"},children:[e.jsx(qe,{type:"fear",value:(c==null?void 0:c.value)||0,maxValue:12,onChange:v,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0}),e.jsx("button",{onClick:()=>{f!==null?Be():We(s.length)},title:f!==null?"Close Browser":"Add Adversaries",style:{width:"36px",height:"36px",padding:0,backgroundColor:f!==null?"var(--purple)":"transparent",border:"1px solid var(--border)",borderRadius:"50%",color:f!==null?"white":"var(--text-primary)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",flexShrink:0},onMouseEnter:n=>{f===null&&(n.target.style.borderColor="var(--purple)",n.target.style.backgroundColor="var(--bg-secondary)")},onMouseLeave:n=>{f===null&&(n.target.style.borderColor="var(--border)",n.target.style.backgroundColor="transparent")},children:e.jsx(Ge,{size:18})})]})}),e.jsxs("div",{className:"main-content",style:{position:"relative",width:"100%"},children:[f!==null&&e.jsx("div",{style:{position:"absolute",top:`${r}px`,right:`${r}px`,bottom:`${r}px`,width:`${R}px`,zIndex:100,overflow:"visible"},children:e.jsx(kt,{tabContent:e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:ne,style:{padding:"0.375rem 0.75rem",backgroundColor:"var(--purple)",border:"none",color:"white",borderRadius:"4px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",transition:"opacity 0.2s ease"},onMouseEnter:n=>{n.target.style.opacity="0.9"},onMouseLeave:n=>{n.target.style.opacity="1"},children:[e.jsx(Ge,{size:16}),e.jsx("span",{children:"Add Custom"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:"500"},children:"Balance:"}),e.jsx("span",{style:{color:re>le?"var(--danger)":re===le?"var(--purple)":"var(--success)",fontWeight:600,fontSize:"0.875rem"},children:re>le?`+${re-le}`:le-re===0?"0":`-${le-re}`})]}),Be&&e.jsx("button",{onClick:Be,style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease",flexShrink:0},onMouseEnter:n=>n.target.style.color="var(--text-primary)",onMouseLeave:n=>n.target.style.color="var(--text-secondary)",title:"Close browser",children:e.jsx(Ve,{size:16})})]}),showTab:!0,tabBackgroundColor:"var(--bg-primary)",tabBorderColor:"var(--border)",tabJustifyContent:"space-between",containerBackgroundColor:"var(--bg-primary)",containerBorderColor:"var(--border)",containerBorderRadius:"8px",containerBoxShadow:"-4px 0 12px rgba(0, 0, 0, 0.3)",containerOverflow:"hidden",reserveTabSpace:!0,containerStyle:{height:"100%"},children:e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,display:"flex",flexDirection:"column",width:"100%",minWidth:0},children:e.jsx(Et,{type:"adversary",onAddItem:A,showContainer:!1,activeTab:"adversaries",autoFocus:!0,hideImportExport:!0,onClose:Be,searchPlaceholder:"Search adversaries"})})})}),e.jsxs("div",{ref:d,className:"dashboard-scroll-container",style:{display:"flex",flexDirection:"row",overflowX:"auto",overflowY:"hidden",padding:`0 ${r}px 0 0`,scrollSnapType:"x mandatory",height:"100%",width:"100%"},onScroll:he,children:[s.length===0?e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",width:"100%",padding:"2rem"},children:e.jsx("button",{onClick:we,style:{backgroundColor:"transparent",color:"var(--text-secondary)",border:"2px dashed var(--border)",borderRadius:"var(--radius-md)",padding:"1rem 2rem",fontSize:"1rem",fontWeight:"500",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:n=>{n.target.style.borderColor="var(--purple)",n.target.style.color="var(--purple)"},onMouseLeave:n=>{n.target.style.borderColor="var(--border)",n.target.style.color="var(--text-secondary)"},children:"Create Encounter"})}):s.map((n,W)=>{var D,B;return e.jsx(pr,{style:{width:`${R+r}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:`${r}px`,paddingRight:"0",paddingTop:`${f!==null&&n.type==="adversary"?r+52:r}px`,paddingBottom:`${r}px`,scrollSnapAlign:"start",overflow:f!==null&&n.type==="adversary"?"visible":"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"auto",opacity:Ce.has(`${n.type}-${n.baseName}`)||g.has(`${n.type}-${n.baseName}`)?0:1,transition:(Ce.has(`${n.type}-${n.baseName}`)||g.has(`${n.type}-${n.baseName}`),"opacity 0.4s ease")},children:e.jsx(et,{type:n.type,item:{...n.instances[0],name:n.baseName,hp:0,stress:0,isDead:!1},mode:"expanded",instances:n.instances,showCustomCreator:n.type==="adversary"&&S&&n.instances.some(q=>q.id===S),onSaveCustomAdversary:n.type==="adversary"&&S&&n.instances.some(q=>q.id===S)?i:void 0,onCancelEdit:n.type==="adversary"&&S&&n.instances.some(q=>q.id===S)?pe:void 0,isStockAdversary:n.type==="adversary"&&S&&n.instances.some(q=>q.id===S)?!((D=n.instances[0])!=null&&D.source)||((B=n.instances[0])==null?void 0:B.source)!=="Homebrew":!1,onApplyDamage:n.type==="adversary"?(q,H,U,L)=>{const ue=n.instances.find(Se=>Se.id===q);ue&&E(q,{hp:Math.min(ue.hpMax||1,(ue.hp||0)+H)})}:void 0,onApplyHealing:n.type==="adversary"?(q,H,U)=>{const L=n.instances.find(ue=>ue.id===q);L&&E(q,{hp:Math.max(0,(L.hp||0)-H)})}:void 0,onApplyStressChange:n.type==="adversary"?(q,H)=>{var U,L;return E(q,{stress:Math.max(0,Math.min(((U=n.instances.find(ue=>ue.id===q))==null?void 0:U.stressMax)||6,(((L=n.instances.find(ue=>ue.id===q))==null?void 0:L.stress)||0)+H))})}:void 0,onUpdate:n.type==="adversary"?E:n.type==="environment"?T:xe,adversaries:t,showAddRemoveButtons:f!==null&&n.type==="adversary",onEdit:n.type==="adversary"?q=>M(q):void 0,onAddInstance:n.type==="adversary"?q=>{N(q),setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(d.current){const H=d.current,U=H.scrollLeft,L=H.clientWidth,Se=I().findIndex(K=>K.baseName===n.baseName&&K.type==="adversary");if(Se>=0){const K=Se*(R+r),$=K+R+r,ye=10;K>=U-ye&&$<=U+L+ye||a(K,600)}}})})},50)}:void 0,onRemoveInstance:n.type==="adversary"?q=>{const H=n.instances.length===1,U=s.length>0&&s[s.length-1].baseName===n.baseName,L=`${n.type}-${n.baseName}`,ue=n.instances.sort((Se,K)=>{const $=Se.duplicateNumber||1;return(K.duplicateNumber||1)-$});if(ue.length>0){const Se=ue[0];H?(l(K=>new Set(K).add(L)),U&&s.length>1&&setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(d.current){const K=d.current.scrollLeft,$=Math.max(0,K-(R+r));a($,500,"remove-rightmost-card")}})})},100),setTimeout(()=>{F(Se.id),l(K=>{const $=new Set(K);return $.delete(L),$})},400)):F(Se.id)}}:void 0})},`${n.type}-${n.baseName}`)}),f!==null&&e.jsx("div",{style:{width:`${R+r}px`,flexShrink:0,flexGrow:0,flex:"none",height:"100%"}})]})]}),e.jsx(fr,{isOpen:se,onClose:Te,onAddAdversary:n=>{N(n),je("adversary")},onAddAdversariesBulk:n=>{x(n),je("adversary")},onAddEnvironment:n=>{P(n),je("environment")},onDeleteAdversary:F,onDeleteEnvironment:C,onDeleteCountdown:O,adversaries:t,environments:o,countdowns:p,savedEncounters:j,onSaveEncounter:_,onLoadEncounter:ve,onDeleteEncounter:G}),e.jsx(cr,{})]})},vr=()=>e.jsx(gr,{children:e.jsx(yr,{})});lt.createRoot(document.getElementById("root")).render(e.jsx(Fe.StrictMode,{children:e.jsx(Yt,{children:e.jsx(vr,{})})}));
