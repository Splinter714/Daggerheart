import{r as f,a as vt,R as Ue}from"./dndkit-57209f9c.js";import{F as $t,f as _t,a as qt,b as Vt,c as kt}from"./fa-b4bcccb0.js";import{D as Lt,A as Gt,C as Yt,X as st,M as pt,P as tt,a as Jt,H as Xt,L as Kt,b as Zt,F as Qt,S as it,c as lt}from"./lucide-9f8be461.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const S of document.querySelectorAll('link[rel="modulepreload"]'))c(S);new MutationObserver(S=>{for(const u of S)if(u.type==="childList")for(const w of u.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&c(w)}).observe(document,{childList:!0,subtree:!0});function p(S){const u={};return S.integrity&&(u.integrity=S.integrity),S.referrerPolicy&&(u.referrerPolicy=S.referrerPolicy),S.crossOrigin==="use-credentials"?u.credentials="include":S.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function c(S){if(S.ep)return;S.ep=!0;const u=p(S);fetch(S.href,u)}})();var Nt={exports:{}},mt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ut=f,er=Symbol.for("react.element"),tr=Symbol.for("react.fragment"),rr=Object.prototype.hasOwnProperty,nr=Ut.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,sr={key:!0,ref:!0,__self:!0,__source:!0};function Bt(t,o,p){var c,S={},u=null,w=null;p!==void 0&&(u=""+p),o.key!==void 0&&(u=""+o.key),o.ref!==void 0&&(w=o.ref);for(c in o)rr.call(o,c)&&!sr.hasOwnProperty(c)&&(S[c]=o[c]);if(t&&t.defaultProps)for(c in o=t.defaultProps,o)S[c]===void 0&&(S[c]=o[c]);return{$$typeof:er,type:t,key:u,ref:w,props:S,_owner:nr.current}}mt.Fragment=tr;mt.jsx=Bt;mt.jsxs=Bt;Nt.exports=mt;var e=Nt.exports,bt={},It=vt;bt.createRoot=It.createRoot,bt.hydrateRoot=It.hydrateRoot;function Ze(t){const o=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return t?`${t}-${o}`:o}const Dt=f.createContext();function ft(t){if(typeof localStorage>"u")return null;try{const o=localStorage.getItem(t);return o==null?null:JSON.parse(o)}catch{return null}}function Qe(t,o){if(!(typeof localStorage>"u"))try{localStorage.setItem(t,JSON.stringify(o))}catch{}}const or=({children:t})=>{const[o,p]=f.useState({fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],currentEncounterName:"Encounter"}),[c,S]=f.useState(!1),[u,w]=f.useState({adversaries:[],environments:[]});f.useEffect(()=>{var r,s,O,L;const d=ft("daggerheart-game-state");if(d)try{(((r=d.adversaries)==null?void 0:r.length)>0||((s=d.environments)==null?void 0:s.length)>0||((O=d.countdowns)==null?void 0:O.length)>0||((L=d.savedEncounters)==null?void 0:L.length)>0)&&p(d)}catch(Y){console.error("Failed to load saved state:",Y)}const b=ft("daggerheart-custom-adversaries")||[],y=ft("daggerheart-custom-environments")||[];w({adversaries:b,environments:y}),S(!0)},[]),f.useEffect(()=>{Qe("daggerheart-game-state",o)},[o]);const _=d=>{p(b=>({...b,fear:{...b.fear,value:d}}))},h=()=>{p(d=>({...d,fear:{...d.fear,visible:!d.fear.visible}}))},W=d=>{p(b=>({...b,partySize:Math.max(1,d)}))},H=d=>{p(b=>({...b,currentEncounterName:d||"Encounter"}))},B=d=>{if(d.id)return p(b=>({...b,savedEncounters:(b.savedEncounters||[]).map(y=>y.id===d.id?{...y,name:d.name||y.name,encounterItems:d.encounterItems||y.encounterItems,partySize:d.partySize||y.partySize,battlePointsAdjustments:d.battlePointsAdjustments||y.battlePointsAdjustments,updatedAt:new Date().toISOString()}:y)})),d.id;{const b={id:Ze("encounter"),name:d.name||"Encounter",createdAt:new Date().toISOString(),encounterItems:d.encounterItems||[],partySize:d.partySize||4,battlePointsAdjustments:d.battlePointsAdjustments||{}};return p(y=>({...y,savedEncounters:[...y.savedEncounters||[],b]})),b.id}},T=d=>(o.savedEncounters||[]).find(y=>y.id===d),C=d=>{const b={id:Ze("encounter"),name:d.name||`Encounter ${Date.now()}`,createdAt:new Date().toISOString(),encounterItems:d.encounterItems||[],partySize:d.partySize||4,battlePointsAdjustments:d.battlePointsAdjustments||{}};return p(y=>({...y,savedEncounters:[...y.savedEncounters||[],b]})),b.id},q=d=>{p(b=>({...b,savedEncounters:(b.savedEncounters||[]).filter(y=>y.id!==d)}))},de=f.useRef(o);f.useEffect(()=>{de.current=o},[o]);const be={gameState:o,isLoaded:c,customContent:u,updateFear:_,toggleFearVisibility:h,updatePartySize:W,updateCurrentEncounterName:H,saveEncounter:B,saveEncounterAs:C,loadEncounter:T,deleteEncounter:q,createCountdown:d=>{const b={id:Ze("countdown"),name:d.name||"Countdown",max:parseInt(d.max)||1,value:0,visible:!0,type:d.type||"standard",loop:d.loop||"none",source:d.source||"campaign"};p(y=>({...y,countdowns:[...y.countdowns,b]}))},updateCountdown:(d,b)=>{p(y=>({...y,countdowns:y.countdowns.map(r=>r.id===d?{...r,...b}:r)}))},deleteCountdown:d=>{p(b=>({...b,countdowns:b.countdowns.filter(y=>y.id!==d)}))},advanceCountdown:(d,b)=>{p(y=>({...y,countdowns:y.countdowns.map(r=>{if(r.id!==d)return r;let s=b;if(r.loop==="loop")s>r.max?s=(s-1)%r.max+1:s<0&&(s=r.max);else if(r.loop==="increasing"){if(s>r.max)return{...r,max:r.max+1,value:1};if(s<0)return{...r,max:Math.max(1,r.max-1),value:1};s=Math.max(0,s)}else if(r.loop==="decreasing"){if(s>r.max)return{...r,max:Math.max(1,r.max-1),value:1};if(s<0)return{...r,max:r.max+1,value:1};s=Math.min(r.max,s)}else s=Math.max(0,Math.min(s,r.max));return{...r,value:s}})}))},incrementCountdown:(d,b=1)=>{p(y=>({...y,countdowns:y.countdowns.map(r=>{if(r.id!==d)return r;let s=r.value+b;if(r.loop==="loop")s>r.max&&(s=(s-1)%r.max+1);else if(r.loop==="increasing"){if(s>r.max)return{...r,max:r.max+1,value:1}}else if(r.loop==="decreasing"){if(s>r.max)return{...r,max:Math.max(1,r.max-1),value:1}}else s=Math.min(s,r.max);return{...r,value:s}})}))},decrementCountdown:d=>{p(b=>({...b,countdowns:b.countdowns.map(y=>{if(y.id!==d)return y;let r=y.value-1;if(y.loop==="loop")r<0&&(r=y.max);else if(y.loop==="increasing"){if(r<0)return{...y,max:Math.max(1,y.max-1),value:y.max};r=Math.max(0,r)}else if(y.loop==="decreasing"){if(r<0)return{...y,max:y.max+1,value:1}}else r=Math.max(0,r);return{...y,value:r}})}))},reorderCountdowns:d=>{p(b=>{const[y,r]=d,s=[...b.countdowns],[O]=s.splice(y,1);return s.splice(r,0,O),{...b,countdowns:s}})},createAdversary:d=>{var Y;const b=Ze("adv"),y=o.adversaries||[],r=d.baseName||((Y=d.name)==null?void 0:Y.replace(/\s+\(\d+\)$/,""))||d.name||"Unknown",s=y.filter(se=>se.baseName===r);let O=1;if(s.length===0)O=1;else{const se=s.map(me=>me.duplicateNumber||1);let ve=1;for(;se.includes(ve);)ve++;O=ve}const L={...d,id:b,baseName:r,duplicateNumber:O,name:`${r} (${O})`,hp:0,stress:0,isVisible:!0};p(se=>({...se,adversaries:[...se.adversaries,L]}))},createAdversariesBulk:d=>{const b=[],y={};d.forEach(r=>{var $e;const s=r.baseName||(($e=r.name)==null?void 0:$e.replace(/\s+\(\d+\)$/,""))||r.name||"Unknown",Y=(o.adversaries||[]).filter(n=>n.baseName===s).length,se=y[s]||0,ve=Y+se+1;y[s]=se+1;const me={...r,id:Ze("adv"),baseName:s,duplicateNumber:ve,name:`${s} (${ve})`,hp:0,stress:0,isVisible:!0};b.push(me)}),p(r=>({...r,adversaries:[...r.adversaries,...b]}))},updateAdversary:(d,b)=>{p(y=>({...y,adversaries:y.adversaries.map(r=>{if(r.id===d){const s={...r,...b};if(b.baseName!==void 0){const O=b.baseName,L=s.duplicateNumber||1;s.name=L===1?O:`${O} (${L})`}return s}return r})}))},deleteAdversary:d=>{p(b=>({...b,adversaries:b.adversaries.filter(y=>y.id!==d)}))},clearAllAdversaries:()=>{p(d=>({...d,adversaries:[]}))},reorderAdversaries:d=>{p(b=>{const[y,r]=d,s=[...b.adversaries],[O]=s.splice(y,1);return s.splice(r,0,O),{...b,adversaries:s}})},bulkReorderAdversaries:d=>{p(b=>({...b,adversaries:d}))},createEnvironment:d=>{const b=Ze("env"),r=(o.environments||[]).filter(L=>L.name.replace(/\s+\(\d+\)$/,"")===d.name);let s=d.name||"Unknown";if(r.length===0)s=d.name;else if(r.length===1){const L=r[0],Y=L.name.replace(/\s+\(\d+\)$/,""),se=o.environments.map(ve=>ve.id===L.id?{...ve,name:`${Y} (1)`}:ve);p(ve=>({...ve,environments:se})),s=`${d.name} (2)`}else{const L=r.map(se=>{const ve=se.name.match(/\((\d+)\)$/);return ve?parseInt(ve[1]):null}).filter(se=>se!==null);let Y=1;for(;L.includes(Y);)Y++;s=`${d.name} (${Y})`}const O={...d,id:b,name:s,isVisible:!0};p(L=>({...L,environments:[...L.environments,O]}))},updateEnvironment:(d,b)=>{p(y=>({...y,environments:y.environments.map(r=>r.id===d?{...r,...b}:r)}))},deleteEnvironment:d=>{p(b=>({...b,environments:b.environments.filter(y=>y.id!==d)}))},reorderEnvironments:d=>{p(b=>{const[y,r]=d,s=[...b.environments],[O]=s.splice(y,1);return s.splice(r,0,O),{...b,environments:s}})},addCustomAdversary:d=>{const b={...d,id:Ze("custom-adv"),source:d.source||"Homebrew",isCustom:!0};return w(y=>({...y,adversaries:[...y.adversaries,b]})),Qe("daggerheart-custom-adversaries",[...u.adversaries,b]),b.id},addCustomEnvironment:d=>{const b={...d,id:Ze("custom-env"),source:d.source||"Homebrew",isCustom:!0};return w(y=>({...y,environments:[...y.environments,b]})),Qe("daggerheart-custom-environments",[...u.environments,b]),b.id},updateCustomAdversary:(d,b)=>{w(r=>({...r,adversaries:r.adversaries.map(s=>s.id===d?{...s,...b}:s)}));const y=u.adversaries.map(r=>r.id===d?{...r,...b}:r);Qe("daggerheart-custom-adversaries",y)},updateCustomEnvironment:(d,b)=>{w(r=>({...r,environments:r.environments.map(s=>s.id===d?{...s,...b}:s)}));const y=u.environments.map(r=>r.id===d?{...r,...b}:r);Qe("daggerheart-custom-environments",y)},deleteCustomAdversary:d=>{w(y=>({...y,adversaries:y.adversaries.filter(r=>r.id!==d)}));const b=u.adversaries.filter(y=>y.id!==d);Qe("daggerheart-custom-adversaries",b)},deleteCustomEnvironment:d=>{w(y=>({...y,environments:y.environments.filter(r=>r.id!==d)}));const b=u.environments.filter(y=>y.id!==d);Qe("daggerheart-custom-environments",b)}};return e.jsx(Dt.Provider,{value:be,children:t})},St=()=>{const t=f.useContext(Dt);if(!t)return console.warn("useGameState: Context not available yet, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{gameState:o,customContent:p,...c}=t;if(!o)return console.warn("useGameState: gameState not available, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],customContent:{adversaries:[],environments:[]},updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},addCustomAdversary:()=>{},addCustomEnvironment:()=>{},updateCustomAdversary:()=>{},updateCustomEnvironment:()=>{},deleteCustomAdversary:()=>{},deleteCustomEnvironment:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{fear:S,countdowns:u,adversaries:w,environments:_,partySize:h,savedEncounters:W}=o;return{gameState:o,fear:S,countdowns:u,adversaries:w,environments:_,partySize:h,savedEncounters:W,customContent:p,...c,hasCountdowns:u.length>0,hasAdversaries:w.length>0,hasEnvironments:_.length>0,getCountdownById:H=>u.find(B=>B.id===H),getAdversaryById:H=>w.find(B=>B.id===H),getEnvironmentById:H=>_.find(B=>B.id===H)}},At={fear:{icon:_t,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"0.125rem",maxWidth:"none"},pipStyle:{fontSize:"var(--text-lg)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0,imageRendering:"crisp-edges"},filledColor:"var(--purple)",emptyColor:"var(--gray-dark)",tooltipTitle:"Click anywhere in header to adjust fear:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease fear by 1"},{text:"Right of boundary:",description:"Click to increase fear by 1"}]},hp:{icon:qt,maxValue:20,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stress:{icon:Vt,maxValue:12,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},countdown:{icon:kt,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust countdown:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease countdown by 1"},{text:"Right of boundary:",description:"Click to increase countdown by 1"}]},hpDots:{maxValue:20,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--red)",borderColor:"var(--red)",boxShadow:"0 0 4px rgba(239, 68, 68, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stressDots:{maxValue:12,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--purple)",borderColor:"var(--purple)",boxShadow:"0 0 4px rgba(139, 92, 246, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},adversaryHP:{icon:Lt,maxValue:20,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust HP:",tooltipInstructions:[{text:"Filled pip:",description:"Click to heal (reduce damage)"},{text:"Empty pip:",description:"Click to take damage"}]},adversaryStress:{icon:Gt,maxValue:12,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust stress:",tooltipInstructions:[{text:"Filled pip:",description:"Click to reduce stress"},{text:"Empty pip:",description:"Click to increase stress"}]},countdownDistributed:{icon:kt,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Countdown progress:",tooltipInstructions:[{text:"Progress:",description:"Current countdown value"}]}},rt=({type:t="fear",value:o=0,maxValue:p,onChange:c,size:S="lg",showTooltip:u=!0,containerStyle:w={},pipStyle:_={},countdownType:h=null,distributedGroups:W=null,onPipClick:H=null,enableBoundaryClick:B=!1,clickContainerWidth:T="auto",centerPips:C=!0})=>{const[q,de]=f.useState(!1),V=At[t]||At.fear,G=p||V.maxValue,J=Math.max(0,Math.min(G,o));let ne=V.filledColor;t==="countdown"&&h&&(["progress","dynamic-progress","simple-hope"].includes(h)?ne="var(--gold)":["consequence","dynamic-consequence","simple-fear"].includes(h)?ne="var(--purple)":["long-term","standard"].includes(h)&&(ne="var(--text-secondary)"));const Q=(re,he)=>{if(H)H(re,he);else if(c){const je=re+1;c(je)}},ze=re=>{if(!B||!c||H)return;re.currentTarget.getBoundingClientRect();const he=re.currentTarget.querySelector(".pip-container");if(!he)return;const je=he.getBoundingClientRect(),g=re.clientX-je.left;if(g<0){J>0&&c(J-1);return}if(g>je.width){J<G&&c(J+1);return}const D=je.width,A=D*.05,U=D-2*A,F=g-A,De=J/G,K=U*De;F<K?J>0&&c(J-1):J<G&&c(J+1)},Oe=(()=>{if(!W||t!=="countdownDistributed")return[{start:0,end:G,groupIndex:0}];let re=0;return W.map((he,je)=>{const g={start:re,end:re+he,groupIndex:je};return re+=he,g})})(),ee=()=>e.jsxs(e.Fragment,{children:[Oe.map(re=>e.jsx(Ue.Fragment,{children:[...Array(re.end-re.start)].map((he,je)=>{const g=re.start+je,D=g<J;if(V.isDots)return e.jsx("div",{style:{...V.pipStyle,...D?V.filledStyle:V.emptyStyle,..._,cursor:c||H?"pointer":"default"},onClick:B?void 0:()=>Q(g,D),title:`${g+1} of ${G}`},g);{const A=V.icon,U=A&&typeof A=="object"&&A.iconName,F=D?ne:V.emptyColor;return e.jsx("span",{className:`fear-pip ${D?"filled":"empty"}`,style:{...V.pipStyle,color:F,cursor:c||H?"pointer":"default",..._},onClick:B?void 0:()=>Q(g,D),title:`${g+1} of ${G}`,children:U?e.jsx($t,{icon:A,size:S}):e.jsx(A,{size:S==="lg"?18:16})},g)}})},re.groupIndex)),u&&e.jsx("div",{style:{position:"relative",cursor:"help",pointerEvents:"none"},children:e.jsxs("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:q?"translateX(-50%) translateY(-5px)":"translateX(-50%)",background:"rgba(15, 23, 42, 0.95)",border:"1px solid var(--gray)",borderRadius:"var(--radius-md)",padding:"var(--space-md)",minWidth:"250px",zIndex:1e3,opacity:q?1:0,visibility:q?"visible":"hidden",transition:"all 0.2s ease",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.5)"},children:[e.jsx("div",{style:{fontWeight:600,color:"var(--gray-200)",marginBottom:"0.75rem",fontSize:"var(--text-sm)"},children:V.tooltipTitle}),V.tooltipInstructions.map((re,he)=>e.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.8rem",color:"var(--gray-300)",lineHeight:1.4},children:[e.jsx("strong",{style:{color:"var(--gray-200)"},children:re.text})," ",re.description]},he))]})})]});return e.jsx("div",{style:{width:T,height:"100%",cursor:c||H?"pointer":"default",touchAction:"manipulation",userSelect:"none",display:C?"flex":"block",alignItems:C?"center":"stretch",justifyContent:C?"center":"flex-start",...w},onClick:re=>{re.stopPropagation(),re.preventDefault(),B&&ze(re)},onMouseEnter:()=>de(u),onMouseLeave:()=>de(!1),children:e.jsx("div",{className:"pip-container",style:{...V.containerStyle,width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},children:ee()})})},ar=({position:t="top",children:o,onClick:p,className:c="",style:S={}})=>{const u=t==="top",w=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://"),_={background:"var(--bg-primary)",borderTop:u?"none":"1px solid var(--border)",borderBottom:u?"1px solid var(--border)":"none",padding:u?"0.25rem 0":"0.5rem",paddingBottom:u?"0.25rem":w?"calc(0.5rem + env(safe-area-inset-bottom) + 1rem)":"calc(0.5rem + env(safe-area-inset-bottom))",position:u?"relative":"sticky",[u?"top":"bottom"]:0,zIndex:u?10:100,order:u?1:3,flexShrink:0,touchAction:"manipulation",userSelect:"none",display:"flex",flexDirection:u?"column":"row",justifyContent:u?"stretch":"center",alignItems:u?"stretch":"center",gap:u?"0":"1rem",height:u?"auto":"60px",...S};return e.jsx("div",{className:c,style:_,onClick:p,children:o})},ht=52,Pt=({tabContent:t,children:o,containerStyle:p={},tabStyle:c={},showTab:S=!0,tabBackgroundColor:u="var(--bg-primary)",tabBorderColor:w="var(--border)",tabJustifyContent:_="center",containerBackgroundColor:h,containerBorderColor:W,containerBorderRadius:H="8px",containerBoxShadow:B,containerOverflow:T="hidden",reserveTabSpace:C=!1,style:q={},...de})=>{const V={display:"flex",flexDirection:"column",position:"relative",height:"100%",width:"100%",borderRadius:H,overflow:T};h&&(V.backgroundColor=h),W&&(V.border=`2px solid ${W}`),B&&(V.boxShadow=B);const G={position:"relative",overflow:"visible",height:"100%",width:"100%",display:"flex",flexDirection:"column",boxSizing:"border-box"},J=C?"0":`-${ht}px`,ne=C&&S&&t?`${ht}px`:"0";return e.jsxs("div",{style:{...G,...q},...de,children:[S&&t&&e.jsx("div",{style:{position:"absolute",top:J,left:"7px",right:"7px",width:"calc(100% - 14px)",display:"flex",alignItems:"center",gap:"0.5rem",justifyContent:_,flexShrink:0,zIndex:0,padding:"0.5rem 0.75rem",paddingBottom:"calc(0.5rem + 4px)",minHeight:`${ht}px`,backgroundColor:u,border:`1.5px solid ${w}`,borderBottom:"none",borderRadius:"8px 8px 0 0",boxSizing:"border-box",marginBottom:"-4px",...c},children:t}),e.jsx("div",{style:{...V,...p,zIndex:1,marginTop:ne},children:o})]})},Et=({value:t})=>e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"44px",height:"32px",zIndex:3},children:[e.jsx("svg",{width:"40",height:"32",viewBox:"0 0 40 32",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",style:{position:"absolute",zIndex:1},children:e.jsx("path",{d:"M2 2h28l6 14-6 14H2l6-14-6-14z"})}),e.jsx("span",{style:{position:"absolute",fontSize:"0.8rem",fontWeight:500,color:"var(--text-primary)",textAlign:"center",zIndex:2,left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:t})]}),ir=({type:t,tier:o,isEditMode:p,onUpdate:c,itemId:S})=>{const w=(B=>{if(!B)return 0;const C=document.createElement("canvas").getContext("2d");return C.font="600 11px system-ui, -apple-system, sans-serif",C.measureText(B.toUpperCase()).width})(t),_=4,h=18,W=Math.max(50,w+_+h),H=W+15;return p?e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",gap:"8px",height:"32px"},children:[e.jsxs("select",{value:t||"",onChange:B=>{c&&c(S,{type:B.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",outline:"none",borderRadius:"4px",padding:"4px 8px",width:"95px",height:"24px"},children:[e.jsx("option",{value:"Standard",children:"Standard"}),e.jsx("option",{value:"Solo",children:"Solo"}),e.jsx("option",{value:"Bruiser",children:"Bruiser"}),e.jsx("option",{value:"Horde",children:"Horde"}),e.jsx("option",{value:"Minion",children:"Minion"}),e.jsx("option",{value:"Ranged",children:"Ranged"}),e.jsx("option",{value:"Leader",children:"Leader"}),e.jsx("option",{value:"Skulk",children:"Skulk"}),e.jsx("option",{value:"Social",children:"Social"}),e.jsx("option",{value:"Support",children:"Support"})]}),e.jsxs("div",{style:{position:"relative",width:"24px",height:"24px"},children:[e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",width:"20px",height:"20px",backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",borderRadius:"2px"}}),e.jsx("input",{type:"text",value:o||"",onChange:B=>{const T=B.target.value.replace(/[^1-4]/g,"");T.length<=1&&c&&c(S,{tier:T===""?"":parseInt(T)})},onKeyDown:B=>{if(B.key==="ArrowUp"){B.preventDefault();const T=parseInt(o)||1;c&&c(S,{tier:Math.min(T+1,4)})}else if(B.key==="ArrowDown"){B.preventDefault();const T=parseInt(o)||1;c&&c(S,{tier:Math.max(T-1,1)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"transparent",border:"none",color:"var(--text-primary)",fontSize:"0.8rem",fontWeight:600,width:"24px",height:"24px",textAlign:"center",outline:"none",zIndex:1},maxLength:"1"})]})]}):e.jsxs("div",{style:{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"center",height:"32px",width:`${H}px`},children:[e.jsxs("svg",{width:H,height:"32",viewBox:`0 0 ${H} 32`,style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1},children:[e.jsx("rect",{x:"1",y:"6",width:W-1,height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4",ry:"4"}),e.jsx("rect",{x:W-10,y:"6",width:"20",height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"2",ry:"2",transform:`rotate(45 ${W-1} 16)`})]}),e.jsx("span",{style:{position:"absolute",top:"50%",left:"4px",transform:"translateY(-50%)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",color:"var(--text-primary)",zIndex:2,pointerEvents:"none"},children:t}),e.jsx("span",{style:{position:"absolute",top:"50%",left:`${W-.5}px`,transform:"translate(-50%, -50%)",fontSize:"0.8rem",fontWeight:600,color:"white",zIndex:2,pointerEvents:"none",textAlign:"center",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",width:"20px",height:"20px"},children:o})]})},xt=({feature:t,featureType:o,item:p,onUpdate:c,handleFeatureDeleteClick:S,deleteConfirmations:u,getFeatureKey:w})=>{var B,T;const _=()=>{try{const q=[...(p==null?void 0:p.features)||[]],de=q.filter(G=>G.type===o),V=de.findIndex(G=>G===t);if(V>0&&V<de.length){const G=de[V],J=de[V-1];if(G&&J){const ne=q.findIndex(ze=>ze===G),Q=q.findIndex(ze=>ze===J);ne>=0&&Q>=0&&(q[ne]=J,q[Q]=G,c&&c(p.id,{features:q}))}}}catch(C){console.error(`Error in ${o.toLowerCase()} up button:`,C)}},h=()=>{try{const q=[...(p==null?void 0:p.features)||[]],de=q.filter(G=>G.type===o),V=de.findIndex(G=>G===t);if(V<de.length-1&&V>=0){const G=de[V],J=de[V+1];if(G&&J){const ne=q.findIndex(ze=>ze===G),Q=q.findIndex(ze=>ze===J);ne>=0&&Q>=0&&(q[ne]=J,q[Q]=G,c&&c(p.id,{features:q}))}}}catch(C){console.error(`Error in ${o.toLowerCase()} down button:`,C)}},W=C=>C.type===o,H=C=>C.type===o&&C.name.trim();return e.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",alignSelf:"stretch"},children:[e.jsx("button",{onClick:_,disabled:(p.features||[]).filter(W).findIndex(C=>C===t)===0,tabIndex:"-1",style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(p.features||[]).filter(H).length>=2&&(p.features||[]).filter(W).findIndex(C=>C===t)!==0&&t.name.trim()?"white":"var(--text-secondary)",cursor:(p.features||[]).filter(H).length>=2&&(p.features||[]).filter(W).findIndex(C=>C===t)!==0&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↑"}),e.jsx("button",{onClick:()=>S(t),disabled:!t.name.trim()&&!t.description.trim(),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:u[w(t)]?"var(--danger)":"var(--gray-700)",color:!t.name.trim()&&!t.description.trim()?"var(--text-secondary)":"white",cursor:!t.name.trim()&&!t.description.trim()?"not-allowed":"pointer",opacity:!t.name.trim()&&!t.description.trim()?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"×"}),e.jsx("button",{onClick:h,disabled:(p.features||[]).filter(W).findIndex(C=>C===t)===(p.features||[]).filter(W).length-1,style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(p.features||[]).filter(H).length>=2&&(p.features||[]).filter(W).findIndex(C=>C===t)<(p.features||[]).filter(W).length-1&&((B=(p.features||[]).filter(W)[(p.features||[]).filter(W).findIndex(C=>C===t)+1])!=null&&B.name.trim())&&t.name.trim()?"white":"var(--text-secondary)",cursor:(p.features||[]).filter(H).length>=2&&(p.features||[]).filter(W).findIndex(C=>C===t)<(p.features||[]).filter(W).length-1&&((T=(p.features||[]).filter(W)[(p.features||[]).filter(W).findIndex(C=>C===t)+1])!=null&&T.name.trim())&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↓"})]})},Fe={transitions:{hoverIn:"all 0.1s ease",hoverOut:"all 0.3s ease"},card:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"8px",cursor:"pointer",transition:"all 0.1s ease",position:"relative",border:"none"},cardHover:{backgroundColor:"var(--bg-card-hover)"},cardDead:{opacity:.6,backgroundColor:"var(--gray-800)",borderColor:"var(--border)"},cardAtMax:{backgroundColor:"var(--success)",borderColor:"var(--success)"},rowMain:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},rowTitle:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",margin:0},rowMeta:{display:"flex",gap:"8px",alignItems:"center"},badge:{padding:"2px 6px",borderRadius:"3px",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},typeBadge:{backgroundColor:"var(--purple)",color:"var(--text-primary)"},tierBadge:{backgroundColor:"var(--info)",color:"var(--text-primary)"},damageInputPopup:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,borderRadius:"8px"},damageInputContent:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"8px",padding:"8px",display:"flex",flexDirection:"row",gap:"8px",minWidth:"200px",alignItems:"center",position:"absolute",right:"1rem",top:"50%",transform:"translateY(-50%)"},damageInput:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"4px",padding:"4px 6px",color:"var(--text-primary)",fontSize:"16px",width:"80px",textAlign:"center"},damageIndicators:{display:"flex",gap:"8px",alignItems:"center",justifyContent:"center"},damageDrop:{fontSize:"16px",color:"var(--text-secondary)",cursor:"pointer",transition:"color 0.1s ease"},applyButton:{backgroundColor:"var(--gray-600)",color:"white",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"32px",minHeight:"32px"}},lr=(t,o,p,c)=>{const[S,u]=f.useState(!1),[w,_]=f.useState("");f.useEffect(()=>{if(S){const C=q=>{q.target.closest(".damage-input-popup")||(u(!1),_(""))};return document.addEventListener("click",C),()=>document.removeEventListener("click",C)}},[S]);const h=C=>{C.stopPropagation(),C.preventDefault();const q=t.hp||0,de=t.hpMax||1,V=C.currentTarget.getBoundingClientRect(),G=C.clientX-V.left,J=V.width/de;Math.floor(G/J)<q?p&&p(t.id,1,t.hp):o&&o(t.id,1,t.hp,t.hpMax)},W=C=>{C.stopPropagation(),C.preventDefault();const q=t.stress||0,de=t.stressMax||1,V=C.currentTarget.getBoundingClientRect(),G=C.clientX-V.left,J=V.width/de;Math.floor(G/J)<q?c&&c(t.id,-1,t.stress,t.stressMax):c&&c(t.id,1,t.stress,t.stressMax)},H=C=>{C.stopPropagation(),(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")&&(u(!0),_(t.type==="Minion"?"1":""))},B=()=>{const C=parseInt(w);if(C>0){if(t.type==="Minion")o&&o(t.id,C,t.hp,t.hpMax);else{let q=0;C>=t.thresholds.severe?q=3:C>=t.thresholds.major?q=2:C>=1&&(q=1),o&&o(t.id,q,t.hp,t.hpMax)}u(!1),_("")}};return{showDamageInput:S,damageValue:w,setDamageValue:_,setShowDamageInput:u,handleHpClick:h,handleStressClick:W,handleDifficultyClick:H,applyDamage:B,handleKeyDown:C=>{C.key==="Enter"?B():C.key==="Escape"&&(u(!1),_(""))}}},ut=({item:t,type:o,mode:p="expanded",onClick:c,onDelete:S,onApplyDamage:u,onApplyHealing:w,onApplyStressChange:_,onUpdate:h,adversaries:W=[],isSelected:H=!1,isEditMode:B=!1,instances:T=[],isEmbedded:C=!1,showAddRemoveButtons:q=!1,onAddInstance:de=null,onRemoveInstance:V=null,onEdit:G=null,showCustomCreator:J=!1,onSaveCustomAdversary:ne=null,onCancelEdit:Q=null,isStockAdversary:ze=!1})=>{const xe=f.useRef(null),Oe=f.useRef(T.length),ee=f.useRef(null),re=f.useRef(null),he=f.useRef(null),je=f.useRef(null);f.useEffect(()=>{const r=xe.current;if(!r)return;const s=()=>{ee.current=r.scrollHeight,re.current=r.scrollTop};r.addEventListener("scroll",s,{passive:!0});const O=setInterval(s,100);return()=>{r.removeEventListener("scroll",s),clearInterval(O)}},[]),f.useEffect(()=>()=>{xe.current&&(ee.current=xe.current.scrollHeight,re.current=xe.current.scrollTop)},[T.length,T]);const[g,D]=f.useState({});f.useEffect(()=>{if(J&&je.current){const r=setTimeout(()=>{var s,O;(s=je.current)==null||s.focus(),(O=je.current)==null||O.select()},650);return()=>clearTimeout(r)}},[J]),f.useLayoutEffect(()=>{const r=T.length,s=Oe.current;if(r!==s&&xe.current){const O=ee.current,L=re.current;if(!O||L===null){Oe.current=r;return}const Y=xe.current,se=Y.scrollHeight,ve=Y.clientHeight;if(!(r<s)){if(r>s){const me=se-ve,$e=Y.scrollTop,n=me-$e;if(Math.abs(n)>.5){he.current&&(cancelAnimationFrame(he.current),he.current=null);const k=400,i=performance.now(),I=$=>{if(!Y){he.current=null;return}const z=$-i,ae=Math.min(z/k,1),ye=1-ae,l=1-ye*ye*ye,x=$e+n*l;Y.scrollTop=x,ae<1?he.current=requestAnimationFrame(I):(Y.scrollTop=me,he.current=null)};he.current=requestAnimationFrame(I)}}}Oe.current=r}else Oe.current=r},[T.length,T]);const A=r=>{const O=(t.features||[]).filter(L=>L.type===r.type).findIndex(L=>L===r);return`${r.type}-${O}-${r.name||"blank"}`},U=(r,s)=>`experience-${s}-${typeof r=="string"?r:r.name||"blank"}`,F=r=>!r||!Array.isArray(r)?[]:r.filter(s=>{if(typeof s=="string")return s.trim().length>0;const O=s.name||"",L=s.modifier||0;return O.trim().length>0||L>0}),De=r=>{const s=A(r);if(g[s]){const O=t.features.filter(L=>L!==r);h&&h(t.id,{features:O}),D(L=>{const Y={...L};return delete Y[s],Y})}else D(O=>({...O,[s]:!0})),setTimeout(()=>{D(O=>{const L={...O};return delete L[s],L})},3e3)},K=(r,s)=>{const O=U(r,s);if(g[O]){const L=[...t.experience||[]];L.splice(s,1);const Y=F(L);h&&h(t.id,{experience:Y}),D(se=>{const ve={...se};return delete ve[O],ve})}else D(L=>({...L,[O]:!0})),setTimeout(()=>{D(L=>{const Y={...L};return delete Y[O],Y})},3e3)},P=lr(t,u,w,_);(o==="adversary"||o==="adversaries")&&P.handleDifficultyClick;const ce=(r=!1)=>{let s={...Fe.card};if(H?s.transition="none":s.transition=Fe.transitions.hoverOut,r){const{marginTop:O,...L}=s;s=L}return H&&(s={...s,...Fe.cardHover}),o==="adversary"&&(t.hp||0)>=(t.hpMax||1)&&(s={...s,...Fe.cardDead}),s},ke=()=>{if(C)return"";let r="border rounded-lg";return H&&(r+=" border-hover"),r},We=()=>{var r;if(o==="adversary"||o==="adversaries"){const s=t.baseName||((r=t.name)==null?void 0:r.replace(/\s+\(\d+\)$/,""))||"",O=t.duplicateNumber||1,L=[...W];return W.some(ve=>ve.id===t.id)||L.push(t),L.filter(ve=>ve.baseName===s).length>1?`${s} (${O})`:s}return t.name},Pe=()=>{const r=[];return t.type&&r.push(e.jsx("span",{style:{...Fe.badge,...Fe.typeBadge},children:t.type},"type")),r},be=()=>o!=="adversary"||!P.showDamageInput||!(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")?null:e.jsx("div",{className:"damage-input-popup",style:Fe.damageInputPopup,onClick:r=>{r.stopPropagation(),r.target===r.currentTarget&&(o==="adversary"||o==="adversaries")&&(P.setShowDamageInput(!1),P.setDamageValue(""))},children:e.jsxs("div",{className:"border rounded-lg",style:{...Fe.damageInputContent,borderColor:"var(--border)"},onClick:r=>r.stopPropagation(),children:[e.jsx("input",{type:"number",inputMode:"numeric",enterKeyHint:"done",placeholder:"dmg",min:(t.type==="Minion","0"),value:o==="adversary"||o==="adversaries"?P.damageValue:"",onChange:r=>{(o==="adversary"||o==="adversaries")&&P.setDamageValue(r.target.value)},onKeyDown:o==="adversary"||o==="adversaries"?P.handleKeyDown:void 0,className:"border rounded-sm",style:{...Fe.damageInput,borderColor:"var(--border)"},autoFocus:!0}),e.jsxs("div",{style:Fe.damageIndicators,children:[t.type==="Minion"?(()=>{var Y,se;const r=parseInt(o==="adversary"||o==="adversaries"?P.damageValue:"0")||0,s=(Y=t.features)==null?void 0:Y.find(ve=>{var me;return(me=ve.name)==null?void 0:me.startsWith("Minion (")}),O=s?parseInt(((se=s.name.match(/\((\d+)\)/))==null?void 0:se[1])||"1"):1,L=Math.floor(r/O);return r>=O&&L>0?e.jsxs("span",{style:{...Fe.damageDrop,color:"var(--red)"},title:`${r} damage can defeat ${L+1} minion${L+1!==1?"s":""} (1 + ${L} additional)`,children:["+",L," additional minion(s)"]}):e.jsx("span",{style:Fe.damageDrop,title:`${r} damage defeats this minion only`,children:"+0 additional minion(s)"})})():[1,2,3].map(r=>{const s=parseInt(o==="adversary"||o==="adversaries"?P.damageValue:"0")||0;let O=!1;return r===1&&s>=1&&(O=!0),r===2&&s>=t.thresholds.major&&(O=!0),r===3&&s>=t.thresholds.severe&&(O=!0),e.jsx("span",{style:{...Fe.damageDrop,color:O?"var(--red)":"var(--text-secondary)"},onClick:L=>{L.stopPropagation(),(o==="adversary"||o==="adversaries")&&(r===1?P.setDamageValue("1"):r===2?P.setDamageValue(t.thresholds.major.toString()):r===3&&P.setDamageValue(t.thresholds.severe.toString()))},title:`Click to set damage to ${r===1?"1":r===2?t.thresholds.major:t.thresholds.severe}`,children:e.jsx(Lt,{size:16})},r)}),e.jsx("button",{style:{...Fe.applyButton,backgroundColor:"var(--gray-600)"},onClick:r=>{r.stopPropagation(),(o==="adversary"||o==="adversaries")&&(!P.damageValue||parseInt(P.damageValue)<1?(P.setShowDamageInput(!1),P.setDamageValue("")):P.applyDamage())},title:!P.damageValue||parseInt(P.damageValue)<1?"Close damage input":"Apply damage",children:!P.damageValue||parseInt(P.damageValue)<1?e.jsx(st,{size:16}):e.jsx(Zt,{size:16})})]})]})}),d=()=>{var Y,se,ve,me,$e;const r=(t.hp||0)>=(t.hpMax||1),s=b==="edit"||J,O=o==="adversary",L=O?J?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:n=>{n.stopPropagation(),ne&&(ne(t,t.id),Q&&Q())},style:{background:"var(--purple)",border:"1px solid var(--purple)",color:"white",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:n=>{n.target.style.opacity="0.9"},onMouseLeave:n=>{n.target.style.opacity="1"},title:"Save",children:[e.jsx(Yt,{size:16}),e.jsx("span",{children:"Save"})]}),Q&&e.jsxs("button",{onClick:n=>{n.stopPropagation(),Q()},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:n=>{n.target.style.backgroundColor="var(--bg-hover)",n.target.style.borderColor="var(--purple)"},onMouseLeave:n=>{n.target.style.backgroundColor="var(--bg-secondary)",n.target.style.borderColor="var(--border)"},title:"Cancel",children:[e.jsx(st,{size:16}),e.jsx("span",{children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:n=>{n.stopPropagation(),V&&V(t.id)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease"},onMouseEnter:n=>{n.currentTarget.style.backgroundColor="var(--bg-hover)",n.currentTarget.style.borderColor="var(--purple)"},onMouseLeave:n=>{n.currentTarget.style.backgroundColor="var(--bg-secondary)",n.currentTarget.style.borderColor="var(--border)"},title:"Remove one",children:e.jsx(pt,{size:16})}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"1rem",fontWeight:"500",minWidth:"24px",textAlign:"center"},children:T.length}),e.jsx("button",{onClick:n=>{n.stopPropagation(),de&&de(t)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease"},onMouseEnter:n=>{n.currentTarget.style.backgroundColor="var(--purple)",n.currentTarget.style.borderColor="var(--purple)",n.currentTarget.style.color="white"},onMouseLeave:n=>{n.currentTarget.style.backgroundColor="var(--bg-secondary)",n.currentTarget.style.borderColor="var(--border)",n.currentTarget.style.color="var(--text-primary)"},title:"Add another",children:e.jsx(tt,{size:16})}),G&&e.jsx("button",{onClick:n=>{n.stopPropagation(),G(t.id)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease",marginLeft:"0.25rem"},onMouseEnter:n=>{n.currentTarget.style.backgroundColor="var(--purple)",n.currentTarget.style.borderColor="var(--purple)",n.currentTarget.style.color="white"},onMouseLeave:n=>{n.currentTarget.style.backgroundColor="var(--bg-secondary)",n.currentTarget.style.borderColor="var(--border)",n.currentTarget.style.color="var(--text-primary)"},title:"Edit",children:e.jsx(Jt,{size:16})})]}):null;return e.jsx(Pt,{tabContent:L,showTab:O,tabBorderColor:H?"var(--purple)":"var(--border)",containerBackgroundColor:r?"var(--gray-900)":ce(!0).backgroundColor,containerBorderColor:r?"color-mix(in srgb, var(--gray-600) 40%, transparent)":H?"var(--purple)":"var(--border)",containerBorderRadius:"8px",containerOverflow:"hidden",containerStyle:{padding:0,opacity:r?.7:1,height:"auto",maxHeight:O?"calc(100vh - 120px)":"calc(100vh - 68px)",minHeight:0},children:e.jsxs("div",{className:ke(),style:{...ce(!0),padding:0,display:"flex",flexDirection:"column",position:"relative",height:"100%",minHeight:0,border:"none",borderRadius:0},onClick:c,children:[r&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                  45deg,
                  transparent,
                  transparent 8px,
                  var(--gray-600) 1px,
                  var(--gray-600) 9px
                )`,pointerEvents:"none",zIndex:9999}})}),e.jsx("div",{className:"border-b",style:{padding:"8px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative",zIndex:r?1:"auto",borderBottomColor:H?"var(--purple)":"var(--border)"},children:e.jsx("div",{style:{display:"flex",flexDirection:"column",position:"relative",zIndex:r?1:"auto",padding:"2px",gap:0},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",minHeight:"40px"},children:[s?e.jsx("input",{ref:je,type:"text",value:t.name||"",onChange:n=>{h&&t.id&&h(t.id,{name:n.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"4px",color:"var(--text-primary)",fontSize:"1.1rem",fontWeight:"600",padding:"0.5rem",width:"100%",maxWidth:"300px",paddingRight:"0.625rem"},placeholder:"Name"}):e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flex:1},children:e.jsx("h4",{style:{...Fe.rowTitle,color:r?"color-mix(in srgb, var(--gray-400) 80%, transparent)":Fe.rowTitle.color,textAlign:"left",margin:0,fontSize:"1.1rem",paddingRight:"6px",flex:1},children:((Y=t.name)==null?void 0:Y.replace(/\s+\(\d+\)$/,""))||t.name})}),(t.type||t.tier||s)&&e.jsx(ir,{type:t.type,tier:t.tier,isEditMode:s,onUpdate:h,itemId:t.id})]})})}),e.jsxs("div",{ref:xe,style:{borderRadius:"0 0 8px 8px",flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0},className:"invisible-scrollbar",children:[(t.motives||s)&&e.jsx("div",{style:{padding:"0.5rem 8px",textAlign:"center"},children:s?e.jsx("input",{type:"text",value:t.motives||"",onChange:n=>h&&h(t.id,{motives:n.target.value}),placeholder:"Motives...",style:{width:"100%",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}):e.jsxs("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,textAlign:"center"},children:[t.motives,t.motives&&!t.motives.endsWith(".")?".":""]})}),(t.difficulty||t.atk!==void 0||t.thresholds&&t.type!=="Minion"||t.experience&&t.experience.length>0||s)&&e.jsxs("div",{style:{padding:"0.5rem 8px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[(t.difficulty||s)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[e.jsx(Xt,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(0deg)"}}),s?e.jsx("input",{type:"text",value:t.difficulty||"",onChange:n=>{const k=n.target.value.replace(/[^0-9]/g,"");k.length<=2&&h&&h(t.id,{difficulty:parseInt(k)||0})},onKeyDown:n=>{if(n.key==="ArrowUp"){n.preventDefault();const k=parseInt(t.difficulty)||0;h&&h(t.id,{difficulty:Math.min(k+1,99)})}else if(n.key==="ArrowDown"){n.preventDefault();const k=parseInt(t.difficulty)||0;h&&h(t.id,{difficulty:Math.max(k-1,0)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"2"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:t.difficulty})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Difficulty"})]}),(t.atk!==void 0||s)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[e.jsx(Kt,{size:38,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(45deg)"}}),s?e.jsx("input",{type:"text",value:(()=>{const n=typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0;return n>=0?`+${n}`:n.toString()})(),onChange:n=>{const k=n.target.value.replace(/[^0-9+\-]/g,"");if(k.length<=4){const i=parseInt(k.replace(/[^0-9\-]/g,""))||0;h&&h(t.id,{atk:i})}},onKeyDown:n=>{if(n.key==="ArrowUp"){n.preventDefault();const i=(typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0)+1;h&&h(t.id,{atk:i})}else if(n.key==="ArrowDown"){n.preventDefault();const i=(typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0)-1;h&&h(t.id,{atk:i})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"3"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:(()=>{const n=typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk;return n>=0?`+${n}`:n})()})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Attack"})]})]}),e.jsx("div",{style:{paddingTop:"0"},children:s?e.jsx("div",{style:{display:"flex",flexDirection:"column",marginTop:"-0.25rem"},children:(()=>{const n=t.experience||[],k=n.length===0?[{name:"",modifier:0}]:n;return k.map((i,I)=>{var $,z,ae,ye,l,x,N,oe,X,we,pe,fe,ue,j,ge,Ce,Be,Le,Ne,Re,Ae,Ie,a,m,M;return e.jsxs("div",{style:{position:"relative",marginBottom:"0.5rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("input",{type:"text",value:typeof i=="object"&&i.modifier>0?`+${i.modifier}`:"",onChange:v=>{const R=[...t.experience||[]],te=v.target.value.replace(/[^0-9+-]/g,""),Z=te===""||te==="+"?0:parseInt(te)||0,E=Math.max(0,Z);R[I]={name:typeof i=="string"?i:i.name||"",modifier:E};const ie=F(R);h&&h(t.id,{experience:ie})},onKeyDown:v=>{if(v.key==="ArrowUp"){v.preventDefault();const R=[...t.experience||[]],te=typeof i=="object"&&i.modifier||0;R[I]={name:typeof i=="string"?i:i.name||"",modifier:te+1};const Z=F(R);h&&h(t.id,{experience:Z})}else if(v.key==="ArrowDown"){v.preventDefault();const R=[...t.experience||[]],te=typeof i=="object"&&i.modifier||0;R[I]={name:typeof i=="string"?i:i.name||"",modifier:Math.max(0,te-1)};const Z=F(R);h&&h(t.id,{experience:Z})}},style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)",textAlign:"center",outline:"none"}})}),e.jsxs("div",{style:{marginLeft:"32px",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:typeof i=="string"?i:i.name||"",onChange:v=>{var ie;const R=[...t.experience||[]],te=typeof i=="object"&&i.modifier||0;R[I]={name:v.target.value,modifier:te};let Z=F(R);const E=Z[Z.length-1];E&&(typeof E=="string"?E.trim():(ie=E.name)!=null&&ie.trim())&&Z.push({name:"",modifier:0}),h&&h(t.id,{experience:Z})},placeholder:"Experience name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsxs("div",{style:{display:"flex",gap:"0.125rem"},children:[e.jsx("button",{onClick:()=>{var E,ie;const v=[...t.experience||[]],R=typeof i=="string"?i.trim():(E=i.name)==null?void 0:E.trim(),te=v[I-1],Z=typeof te=="string"?te.trim():(ie=te.name)==null?void 0:ie.trim();if(I>0&&I<v.length&&R&&Z){v[I]=te,v[I-1]=i;const Ee=F(v);h&&h(t.id,{experience:Ee})}},disabled:I===0||!(typeof i=="string"?i.trim():($=i.name)!=null&&$.trim())||!(typeof k[I-1]=="string"?k[I-1].trim():(z=k[I-1].name)!=null&&z.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:I===0||!(typeof i=="string"?i.trim():(ae=i.name)!=null&&ae.trim())||!(typeof k[I-1]=="string"?k[I-1].trim():(ye=k[I-1].name)!=null&&ye.trim())?"var(--gray-800)":"var(--gray-700)",color:I===0||!(typeof i=="string"?i.trim():(l=i.name)!=null&&l.trim())||!(typeof k[I-1]=="string"?k[I-1].trim():(x=k[I-1].name)!=null&&x.trim())?"var(--text-secondary)":"white",cursor:I===0||!(typeof i=="string"?i.trim():(N=i.name)!=null&&N.trim())||!(typeof k[I-1]=="string"?k[I-1].trim():(oe=k[I-1].name)!=null&&oe.trim())?"not-allowed":"pointer",opacity:I===0||!(typeof i=="string"?i.trim():(X=i.name)!=null&&X.trim())||!(typeof k[I-1]=="string"?k[I-1].trim():(we=k[I-1].name)!=null&&we.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move up",children:"↑"}),e.jsx("button",{onClick:()=>{var E,ie;const v=[...t.experience||[]],R=typeof i=="string"?i.trim():(E=i.name)==null?void 0:E.trim(),te=v[I+1],Z=typeof te=="string"?te.trim():(ie=te.name)==null?void 0:ie.trim();if(I<v.length-1&&I>=0&&R&&Z){v[I]=te,v[I+1]=i;const Ee=F(v);h&&h(t.id,{experience:Ee})}},disabled:I===k.length-1||!(typeof i=="string"?i.trim():(pe=i.name)!=null&&pe.trim())||!(typeof k[I+1]=="string"?k[I+1].trim():(fe=k[I+1].name)!=null&&fe.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:I===k.length-1||!(typeof i=="string"?i.trim():(ue=i.name)!=null&&ue.trim())||!(typeof k[I+1]=="string"?k[I+1].trim():(j=k[I+1].name)!=null&&j.trim())?"var(--gray-800)":"var(--gray-700)",color:I===k.length-1||!(typeof i=="string"?i.trim():(ge=i.name)!=null&&ge.trim())||!(typeof k[I+1]=="string"?k[I+1].trim():(Ce=k[I+1].name)!=null&&Ce.trim())?"var(--text-secondary)":"white",cursor:I===k.length-1||!(typeof i=="string"?i.trim():(Be=i.name)!=null&&Be.trim())||!(typeof k[I+1]=="string"?k[I+1].trim():(Le=k[I+1].name)!=null&&Le.trim())?"not-allowed":"pointer",opacity:I===k.length-1||!(typeof i=="string"?i.trim():(Ne=i.name)!=null&&Ne.trim())||!(typeof k[I+1]=="string"?k[I+1].trim():(Re=k[I+1].name)!=null&&Re.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move down",children:"↓"}),e.jsx("button",{onClick:()=>K(i,I),disabled:!(typeof i=="string"?i.trim():(Ae=i.name)!=null&&Ae.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:g[U(i,I)]?"var(--danger)":(typeof i=="string"?i.trim():(Ie=i.name)!=null&&Ie.trim())?"var(--gray-700)":"var(--gray-800)",color:(typeof i=="string"?i.trim():(a=i.name)!=null&&a.trim())?"white":"var(--text-secondary)",cursor:(typeof i=="string"?i.trim():(m=i.name)!=null&&m.trim())?"pointer":"not-allowed",opacity:(typeof i=="string"?i.trim():(M=i.name)!=null&&M.trim())?1:.5,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:g[U(i,I)]?"Click again to confirm delete":"Delete experience",children:"×"})]})]})]},I)})})()}):e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:t.experience&&t.experience.length>0?t.experience.map((n,k)=>{if(typeof n=="string"){const i=n.match(/^(.+?)\s*([+-]?\d+)$/);if(i){const[,I,$]=i;return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:$})})}),e.jsx("span",{style:{marginLeft:"32px"},children:I})]},k)}else return e.jsx("div",{style:{marginBottom:"0.25rem"},children:n},k)}else return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:e.jsxs("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:[n.modifier>=0?"+":"",n.modifier]})})}),e.jsx("span",{style:{marginLeft:"32px"},children:n.name})]},k)}):null})})]}),(t.features&&t.features.length>0||s)&&e.jsxs("div",{style:{padding:"0 8px 8px 8px"},children:[(t.atk!==void 0&&t.weapon||s)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Standard Attack"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:s?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",marginTop:"0.75rem",marginBottom:"0.75rem"},children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[e.jsx("input",{type:"text",value:t.weapon||"",onChange:n=>h&&h(t.id,{weapon:n.target.value}),placeholder:"Standard attack name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}}),e.jsxs("select",{value:t.range||"",onChange:n=>h&&h(t.id,{range:n.target.value}),style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",appearance:"none",backgroundImage:`url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",backgroundSize:"1rem",paddingRight:"2rem"},children:[e.jsx("option",{value:""}),e.jsx("option",{value:"Melee",children:"Melee"}),e.jsx("option",{value:"Very Close",children:"Very Close"}),e.jsx("option",{value:"Close",children:"Close"}),e.jsx("option",{value:"Far",children:"Far"}),e.jsx("option",{value:"Very Far",children:"Very Far"})]}),e.jsx("input",{type:"text",value:t.damage||"",onChange:n=>h&&h(t.id,{damage:n.target.value}),placeholder:"Damage (e.g., 1d6+2)",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}})]})}):t.atk!==void 0&&t.weapon&&e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:t.weapon}),e.jsxs("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:["Make an attack against a target within ",t.range||"Melee"," range. On a success, deal ",t.damage||"damage varies","."]})]})})]}),(t.features.filter(n=>n.type==="Action").length>0||s)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Actions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const n=t.features.filter(i=>i.type==="Action");return(s&&n.length===0?[{type:"Action",name:"",description:""}]:n).map((i,I)=>s?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:i.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false","data-lpignore":"true","data-form-type":"other",name:`feature-name-${i.type.toLowerCase()}`,onChange:$=>{const z=[...t.features||[]],ae=z.findIndex(x=>x.type==="Action"&&x===i);ae>=0?z[ae]={...z[ae],name:$.target.value}:z.push({type:"Action",name:$.target.value,description:i.description||""});const ye=z.filter(x=>x.type==="Action"),l=ye[ye.length-1];l&&l.name.trim()&&z.push({type:"Action",name:"",description:""}),h&&h(t.id,{features:z})},placeholder:"Action name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:i.description||"",onChange:$=>{const z=[...t.features||[]],ae=z.findIndex(x=>x.type==="Action"&&x===i);ae>=0?z[ae]={...z[ae],description:$.target.value}:z.push({type:"Action",name:i.name||"",description:$.target.value});const ye=z.filter(x=>x.type==="Action"),l=ye[ye.length-1];l&&l.name.trim()&&z.push({type:"Action",name:"",description:""}),h&&h(t.id,{features:z})},onInput:$=>{const z=$.target.offsetHeight;$.target.style.height="auto";const ae=$.target.scrollHeight,ye=ae>z?ae:z;$.target.style.height=ye+"px"},placeholder:"Action description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(xt,{feature:i,featureType:"Action",item:t,onUpdate:h,handleFeatureDeleteClick:De,deleteConfirmations:g,getFeatureKey:A})]},I):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:i.name}),i.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:i.description})]},I))})()})]}),(t.features.filter(n=>n.type==="Passive").length>0||s)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Passives"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const n=t.features.filter(i=>i.type==="Passive");return(s&&n.length===0?[{type:"Passive",name:"",description:""}]:n).map((i,I)=>s?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:i.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:$=>{const z=[...t.features||[]],ae=z.findIndex(x=>x.type==="Passive"&&x===i);ae>=0?z[ae]={...z[ae],name:$.target.value}:z.push({type:"Passive",name:$.target.value,description:i.description||""});const ye=z.filter(x=>x.type==="Passive"),l=ye[ye.length-1];l&&l.name.trim()&&z.push({type:"Passive",name:"",description:""}),h&&h(t.id,{features:z})},placeholder:"Passive name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:i.description||"",onChange:$=>{const z=[...t.features||[]],ae=z.findIndex(x=>x.type==="Passive"&&x===i);ae>=0?z[ae]={...z[ae],description:$.target.value}:z.push({type:"Passive",name:i.name||"",description:$.target.value});const ye=z.filter(x=>x.type==="Passive"),l=ye[ye.length-1];l&&l.name.trim()&&z.push({type:"Passive",name:"",description:""}),h&&h(t.id,{features:z})},onInput:$=>{const z=$.target.offsetHeight;$.target.style.height="auto";const ae=$.target.scrollHeight,ye=ae>z?ae:z;$.target.style.height=ye+"px"},placeholder:"Passive description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(xt,{feature:i,featureType:"Passive",item:t,onUpdate:h,handleFeatureDeleteClick:De,deleteConfirmations:g,getFeatureKey:A})]},I):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:i.name}),i.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:i.description})]},I))})()})]}),(t.features.filter(n=>n.type==="Reaction").length>0||s)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Reactions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const n=t.features.filter(i=>i.type==="Reaction");return(s&&n.length===0?[{type:"Reaction",name:"",description:""}]:n).map((i,I)=>s?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:i.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:$=>{const z=[...t.features||[]],ae=z.findIndex(x=>x.type==="Reaction"&&x===i);ae>=0?z[ae]={...z[ae],name:$.target.value}:z.push({type:"Reaction",name:$.target.value,description:i.description||""});const ye=z.filter(x=>x.type==="Reaction"),l=ye[ye.length-1];l&&l.name.trim()&&z.push({type:"Reaction",name:"",description:""}),h&&h(t.id,{features:z})},placeholder:"Reaction name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:i.description||"",onChange:$=>{const z=[...t.features||[]],ae=z.findIndex(x=>x.type==="Reaction"&&x===i);ae>=0?z[ae]={...z[ae],description:$.target.value}:z.push({type:"Reaction",name:i.name||"",description:$.target.value});const ye=z.filter(x=>x.type==="Reaction"),l=ye[ye.length-1];l&&l.name.trim()&&z.push({type:"Reaction",name:"",description:""}),h&&h(t.id,{features:z})},onInput:$=>{const z=$.target.offsetHeight;$.target.style.height="auto";const ae=$.target.scrollHeight,ye=ae>z?ae:z;$.target.style.height=ye+"px"},placeholder:"Reaction description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(xt,{feature:i,featureType:"Reaction",item:t,onUpdate:h,handleFeatureDeleteClick:De,deleteConfirmations:g,getFeatureKey:A})]},I):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:i.name}),i.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:i.description})]},I))})()})]})]}),(T&&T.length>0||t.type!=="Minion"&&(t.thresholds||s))&&e.jsxs("div",{style:{padding:"0 8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Status"})]}),s?e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border)"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"number",value:t.hpMax||"",onChange:n=>{const k=parseInt(n.target.value)||1;h&&h(t.id,{hpMax:k})},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),e.jsx(rt,{type:"adversaryHP",value:0,maxValue:t.hpMax||1,showTooltip:!1}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:"HP"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"number",value:t.stressMax||"",onChange:n=>{const k=parseInt(n.target.value)||1;h&&h(t.id,{stressMax:k})},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),e.jsx(rt,{type:"adversaryStress",value:0,maxValue:t.stressMax||1,showTooltip:!1}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:"Stress"})]})]})})}):T&&T.length>0&&T.map((n,k)=>{const i=(n.hp||0)>=(n.hpMax||1);return e.jsx("div",{"data-instance-id":n.id,style:{marginBottom:"0.5rem"},children:e.jsxs("div",{style:{backgroundColor:i?"var(--gray-900)":"var(--bg-primary)",borderRadius:"6px",padding:"0.25rem 0.5rem",border:"1px solid",borderColor:i?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",display:"flex",justifyContent:"flex-start",alignItems:"center",gap:"0.5rem",opacity:i?.7:1,position:"relative",transition:"all 0.2s ease",minHeight:"40px"},children:[i&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                          45deg,
                          transparent 0px,
                          transparent 8px,
                          var(--gray-600) 9px,
                          var(--gray-600) 9px
                        )`,pointerEvents:"none",zIndex:1,borderRadius:"4px"}})}),e.jsx("div",{style:{backgroundColor:i?"var(--gray-900)":"var(--bg-card)",border:"1px solid",borderColor:i?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",borderRadius:"50%",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",flexShrink:0,opacity:i?.5:1},children:e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:i?"var(--gray-400)":"var(--text-primary)"},children:n.duplicateNumber||1})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.125rem"},children:[e.jsx("div",{style:{opacity:i?.3:1},children:e.jsx(rt,{type:"adversaryHP",value:n.hp||0,maxValue:n.hpMax||1,onPipClick:(I,$)=>{if(u&&o==="adversary"){const z=n.hp||0,ae=n.hpMax||1;$?w&&w(n.id,1,z):z<ae&&u(n.id,1,z,ae)}},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})}),n.stressMax>0&&e.jsx("div",{style:{opacity:i?.3:1},children:e.jsx(rt,{type:"adversaryStress",value:n.stress||0,maxValue:n.stressMax,onPipClick:(I,$)=>{_&&o==="adversary"&&($?_(n.id,-1):_(n.id,1))},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})})]})]},n.id)},n.id)}),t.type!=="Minion"&&(t.thresholds||s)&&e.jsx("div",{style:{display:"flex",justifyContent:"center",paddingTop:"1px",marginTop:"0.5rem",marginBottom:"0.5rem"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",position:"relative"},children:e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",height:"36px"},children:[e.jsx("svg",{width:"300",height:"36",viewBox:"0 0 300 36",style:{position:"absolute",zIndex:1},children:e.jsx("rect",{x:"20",y:"6",width:"260",height:"24",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4"})}),e.jsx("div",{style:{position:"relative",zIndex:2,display:"flex",alignItems:"center",gap:"0.5rem"},children:s?e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",fontSize:"0.8rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),e.jsx("input",{type:"number",min:"1",max:"99",value:((se=t.thresholds)==null?void 0:se.major)||"",onChange:n=>{const k=n.target.value;(k===""||parseInt(k)>=1&&parseInt(k)<=99)&&h&&h(t.id,{thresholds:{...t.thresholds,major:k===""?null:parseInt(k)}})},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),e.jsx("input",{type:"number",min:"1",max:"99",value:((ve=t.thresholds)==null?void 0:ve.severe)||"",onChange:n=>{const k=n.target.value;(k===""||parseInt(k)>=1&&parseInt(k)<=99)&&h&&h(t.id,{thresholds:{...t.thresholds,severe:k===""?null:parseInt(k)}})},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),e.jsx(Et,{value:((me=t.thresholds)==null?void 0:me.major)||7}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),e.jsx(Et,{value:(($e=t.thresholds)==null?void 0:$e.severe)||14}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]})})]})})})]}),(s||p==="expanded"&&t.description&&t.description.trim())&&e.jsxs("div",{style:{padding:"0 8px",textAlign:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Description"})]}),s?e.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-primary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"none",overflow:"hidden",fontFamily:"inherit",marginTop:"0.75rem",marginBottom:"0.75rem"},value:t.description,onChange:n=>{n.target.style.height="auto",n.target.style.height=n.target.scrollHeight+"px",h&&h(t.id,{description:n.target.value})},placeholder:"Description..."}):e.jsx("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,whiteSpace:"pre-wrap",padding:"0.5rem 0"},children:t.description})]})]}),be()]})})},b=J?"edit":p;return(b==="expanded"||b==="edit")&&(o==="adversary"||o==="adversaries")?d():o==="adversary"||o==="adversaries"?null:e.jsxs("div",{className:ke(),style:ce(!0),children:[e.jsxs("div",{style:Fe.rowMain,children:[e.jsx("h4",{style:Fe.rowTitle,children:We()}),e.jsx("div",{style:Fe.rowMeta,children:Pe()})]}),e.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"12px",margin:0},children:["Expanded view coming soon for ",o]})]})},dr="modulepreload",cr=function(t){return"/Daggerheart/"+t},Mt={},et=function(o,p,c){if(!p||p.length===0)return o();const S=document.getElementsByTagName("link");return Promise.all(p.map(u=>{if(u=cr(u),u in Mt)return;Mt[u]=!0;const w=u.endsWith(".css"),_=w?'[rel="stylesheet"]':"";if(!!c)for(let H=S.length-1;H>=0;H--){const B=S[H];if(B.href===u&&(!w||B.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${_}`))return;const W=document.createElement("link");if(W.rel=w?"stylesheet":dr,w||(W.as="script",W.crossOrigin=""),W.href=u,document.head.appendChild(W),w)return new Promise((H,B)=>{W.addEventListener("load",H),W.addEventListener("error",()=>B(new Error(`Unable to preload CSS for ${u}`)))})})).then(()=>o()).catch(u=>{const w=new Event("vite:preloadError",{cancelable:!0});if(w.payload=u,window.dispatchEvent(w),!w.defaultPrevented)throw u})},pr="/Daggerheart/assets/daggerheart-logo-fe7815ad.svg",Tt={Minion:{difficulty:t=>[9,12,15,18][t-1],thresholds:t=>({major:0,severe:0}),hpMax:t=>1,stressMax:t=>1,atk:t=>[-1,0,1,2][t-1],damage:t=>["2","5","8","11"][t-1],range:"Melee"},Standard:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[7,10,20,25][t-1],severe:[12,20,32,45][t-1]}),hpMax:t=>[4,5,6,7][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[1,2,3,4][t-1],damage:t=>["1d8+1","2d8+2","3d8+3","4d8+4"][t-1],range:"Melee"},Bruiser:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[8,14,22,38][t-1],severe:[15,28,40,70][t-1]}),hpMax:t=>[6,7,8,9][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[-1,0,1,2][t-1],damage:t=>["1d12+2","2d12+4","3d12+6","4d12+8"][t-1],range:"Melee"},Horde:{difficulty:t=>[10,13,16,19][t-1],thresholds:t=>({major:[7,10,20,25][t-1],severe:[12,20,32,45][t-1]}),hpMax:t=>[5,6,7,8][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[-1,0,1,2][t-1],damage:t=>["1d8+2","2d8+4","3d8+6","4d8+8"][t-1],range:"Melee"},Leader:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[7,13,21,35][t-1],severe:[14,26,38,65][t-1]}),hpMax:t=>[5,6,7,8][t-1],stressMax:t=>[5,5,6,6][t-1],atk:t=>[2,4,6,8][t-1],damage:t=>["1d10+2","2d10+4","3d10+6","4d10+8"][t-1],range:"Melee"},Ranged:{difficulty:t=>[10,13,16,19][t-1],thresholds:t=>({major:[4,8,18,22][t-1],severe:[7,16,30,42][t-1]}),hpMax:t=>[3,4,5,6][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d8+2","2d8+4","3d8+6","4d8+8"][t-1],range:"Close"},Skulk:{difficulty:t=>[12,15,18,21][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,5,6,7][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d6+2","2d6+4","3d6+6","4d6+8"][t-1],range:"Melee"},Solo:{difficulty:t=>[12,15,18,21][t-1],thresholds:t=>({major:[7,13,21,35][t-1],severe:[14,26,38,65][t-1]}),hpMax:t=>[8,9,10,11][t-1],stressMax:t=>[5,5,6,6][t-1],atk:t=>[3,5,7,9][t-1],damage:t=>["1d10+3","2d10+6","3d10+9","4d10+12"][t-1],range:"Melee"},Support:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,4,5,5][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d4+2","2d4+4","3d4+6","4d4+8"][t-1],range:"Melee"},Social:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,4,5,5][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d4+2","2d4+4","3d4+6","4d4+8"][t-1],range:"Melee"}},nt=(t,o)=>{const p=Tt[o]||Tt.Standard;return{difficulty:p.difficulty(t),thresholds:p.thresholds(t),hpMax:p.hpMax(t),stressMax:p.stressMax(t),atk:p.atk(t),damage:p.damage(t),range:p.range}};let Ht={adversaries:[]},zt=!1;const ur=()=>({customAdversaries:JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]")}),mr=async()=>{if(zt)return;let t={adversaries:[]},o={adversaries:[]};try{const c=await et(()=>import("./adversaries-9c8932de.js"),[]);t=(c==null?void 0:c.default)||c}catch(c){console.warn("Failed to load adversaries.json:",c)}try{const c=await et(()=>import("./playtest-adversaries-4a099c10.js"),[]);o=(c==null?void 0:c.default)||c}catch(c){console.warn("Failed to load playtest-adversaries.json:",c)}const{customAdversaries:p}=ur();Ht={...t,adversaries:[...t.adversaries||[],...o.adversaries||[],...p]},zt=!0},Ot=f.forwardRef(({onSave:t,onRefresh:o,onAddItem:p,editingAdversary:c,onCancelEdit:S,isStockAdversary:u=!1,autoFocus:w=!1,allAdversaries:_=[],embedded:h=!1,hideEmbeddedButtons:W=!1},H)=>{const B=f.useRef(null),[T,C]=f.useState(()=>{const g=nt(1,"Standard");return{name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:g.difficulty,thresholds:g.thresholds,hpMax:g.hpMax,stressMax:g.stressMax,atk:g.atk,weapon:"",range:g.range,damage:g.damage,experience:[],features:[]}}),[q,de]=f.useState(!1),[V,G]=f.useState(!1),[J,ne]=f.useState([]),[Q,ze]=f.useState(!1),[xe,Oe]=f.useState([]);f.useEffect(()=>{(async()=>{await mr(),_.length>0?Oe(_):Oe(Ht.adversaries||[])})()},[_]),f.useEffect(()=>{w&&B.current&&setTimeout(()=>{var g;(g=B.current)==null||g.focus()},100)},[w]),f.useEffect(()=>{if(c)C({name:c.name||"",tier:c.tier||1,type:c.type||"Standard",description:c.description||"",motives:c.motives||"",difficulty:c.difficulty||11,thresholds:c.thresholds||{major:7,severe:12},hpMax:c.hpMax||3,stressMax:c.stressMax||1,atk:c.atk||1,weapon:c.weapon||"",range:c.range||"Melee",damage:c.damage||"",experience:c.experience||[],features:c.features||[]}),G(!1);else{const g=nt(1,"Standard");C({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:g.difficulty,thresholds:g.thresholds,hpMax:g.hpMax,stressMax:g.stressMax,atk:g.atk,weapon:"",range:g.range,damage:g.damage,experience:[],features:[]}),G(!1)}},[c]),f.useEffect(()=>{if(!c&&!V){const g=nt(T.tier,T.type);C(D=>({...D,difficulty:g.difficulty,thresholds:g.thresholds,hpMax:g.hpMax,stressMax:g.stressMax,atk:g.atk,range:g.range,damage:g.damage}))}},[T.tier,T.type,c,V]);const ee=g=>{if(C(D=>({...D,name:g})),g.trim().length>0){const D=xe.filter(A=>{var F;return(((F=A.name)==null?void 0:F.replace(/\s+\(\d+\)$/,""))||A.name||"").toLowerCase().includes(g.toLowerCase())}).slice(0,5);ne(D),ze(D.length>0)}else ne([]),ze(!1)},re=async()=>{if(!T.name.trim()){alert("Please enter a name for the adversary");return}de(!0);try{const g={...T,hp:c?c.hp:0,stress:c?c.stress:0,source:"Homebrew"};if(c)u?(await t(g),alert("Custom adversary created successfully!")):(g.id=c.id,await t(g,c.id),alert("Adversary updated successfully!")),S&&S();else{await t(g),o&&await o();const D=nt(1,"Standard");C({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:D.difficulty,thresholds:D.thresholds,hpMax:D.hpMax,stressMax:D.stressMax,atk:D.atk,weapon:"",range:D.range,damage:D.damage,experience:[],features:[]}),G(!1),alert("Custom adversary created successfully!")}}catch(g){console.error("Error saving adversary:",g),alert("Error saving adversary. Please try again.")}finally{de(!1)}};f.useImperativeHandle(H,()=>({handleSave:re,isSaving:q,canSave:T.name.trim().length>0}));const he={...T,id:"new-adversary",hp:0,stress:0,source:"Homebrew"},je=()=>q?c?u?"Creating...":"Saving...":"Creating...":c?u?"Save As Custom":"Save":"Create";return e.jsxs(e.Fragment,{children:[!h&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h2",{style:{color:"var(--text-primary)",fontSize:"1.5rem",fontWeight:"600",margin:0},children:c?u?"Edit Adversary (Save As Custom)":"Edit Custom Adversary":"Create Custom Adversary"}),e.jsx("button",{onClick:re,disabled:q||!T.name.trim(),style:{padding:"0.75rem 1.5rem",backgroundColor:q||!T.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"8px",cursor:q||!T.name.trim()?"not-allowed":"pointer",fontSize:"1rem",fontWeight:"600",opacity:q||!T.name.trim()?.6:1},children:je()})]}),h&&!W&&e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",marginBottom:"0.5rem",padding:"0.5rem",borderBottom:"1px solid var(--border)"},children:[e.jsx("button",{onClick:re,disabled:q||!T.name.trim(),style:{padding:"0.5rem 1rem",backgroundColor:q||!T.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"6px",cursor:q||!T.name.trim()?"not-allowed":"pointer",fontSize:"0.875rem",fontWeight:"600",opacity:q||!T.name.trim()?.6:1,marginRight:"0.5rem"},children:je()}),S&&e.jsx("button",{onClick:S,style:{padding:"0.5rem 1rem",backgroundColor:"transparent",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"6px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600"},children:"Cancel"})]}),!c&&e.jsxs("div",{style:{marginBottom:"1rem",position:"relative"},children:[e.jsx("input",{ref:B,type:"text",value:T.name,onChange:g=>{const D=g.target.value;C(A=>({...A,name:D})),ee(D)},placeholder:"Adversary name",style:{width:"100%",padding:"0.75rem",border:"1px solid var(--border)",borderRadius:"8px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"1rem",outline:"none"}}),Q&&J.length>0&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"0 0 8px 8px",borderTop:"none",maxHeight:"200px",overflowY:"auto",zIndex:1e3,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)"},children:J.map((g,D)=>{var U;const A=g.baseName||((U=g.name)==null?void 0:U.replace(/\s+\(\d+\)$/,""))||g.name;return e.jsxs("div",{onClick:()=>{C(F=>({...F,name:A,tier:g.tier||F.tier,type:g.type||F.type,difficulty:g.difficulty||F.difficulty,thresholds:g.thresholds||F.thresholds,hpMax:g.hpMax||F.hpMax,stressMax:g.stressMax||F.stressMax,atk:g.atk||F.atk,range:g.range||F.range,damage:g.damage||F.damage})),ze(!1),G(!0),B.current&&B.current.blur()},style:{padding:"0.75rem",cursor:"pointer",borderBottom:D<J.length-1?"1px solid var(--border)":"none",transition:"background-color 0.2s"},onMouseEnter:F=>{F.target.style.backgroundColor="var(--bg-secondary)"},onMouseLeave:F=>{F.target.style.backgroundColor="transparent"},onMouseDown:F=>F.preventDefault(),children:[e.jsx("div",{style:{fontWeight:"600"},children:A}),e.jsxs("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",marginTop:"2px"},children:[g.type," • Tier ",g.tier]})]},D)})})]}),e.jsx(ut,{item:he,type:"adversary",mode:"edit",onUpdate:(g,D)=>{C(A=>({...A,...D}))}})]})});Ot.displayName="CustomAdversaryCreator";const fr=(t,o)=>{const[p,c]=f.useState("max-content"),S=f.useCallback(()=>{if(!o.current||t<=3)return"max-content";const u=o.current.offsetWidth,_=Math.floor(u/120);return _<=1?"max-content":t===4?"max-content max-content":t===5||t===6?_>=2?"max-content max-content":"max-content":t===7?_>=3?"max-content max-content max-content":_>=2?"max-content max-content":"max-content":"repeat(auto-fit, minmax(80px, max-content))"},[t,o]);return f.useEffect(()=>{const u=S();c(u);const w=new ResizeObserver(()=>{const _=S();c(_)});return o.current&&w.observe(o.current),()=>{w.disconnect()}},[S]),p},hr=({encounter:t})=>{var S,u;const o=f.useRef(null),p=((S=t.encounterItems)==null?void 0:S.length)||0,c=fr(p,o);return e.jsx("div",{ref:o,className:"saved-encounter-adversary-list",style:{flex:1,fontSize:"0.8rem",color:"var(--text-secondary)",lineHeight:"1.3",display:"grid",gridTemplateColumns:c,gap:"0.25rem 1rem",gridAutoRows:"min-content"},children:((u=t.encounterItems)==null?void 0:u.length)>0?t.encounterItems.map((w,_)=>{var W;const h=w.item.baseName||((W=w.item.name)==null?void 0:W.replace(/\s+\(\d+\)$/,""))||w.item.name;return e.jsxs("div",{style:{marginBottom:"0.125rem"},children:[w.quantity,"x ",h]},_)}):e.jsx("div",{children:"No adversaries"})})},ot={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},dt={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1,lowerTierAdversary:1};let ct={adversaries:[]},wt={environments:[]},Ct=!1;const xr=()=>{const t=JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]"),o=JSON.parse(localStorage.getItem("daggerheart-custom-environments")||"[]");return{customAdversaries:t,customEnvironments:o}},Rt=async()=>{if(Ct)return;let t={adversaries:[]},o={environments:[]},p={adversaries:[]},c={environments:[]};try{const w=await et(()=>import("./adversaries-9c8932de.js"),[]);t=(w==null?void 0:w.default)||w}catch(w){console.warn("Failed to load adversaries.json:",w)}try{const w=await et(()=>import("./environments-c340637c.js"),[]);o=(w==null?void 0:w.default)||w}catch(w){console.warn("Failed to load environments.json:",w)}try{const w=await et(()=>import("./playtest-adversaries-4a099c10.js"),[]);p=(w==null?void 0:w.default)||w}catch(w){console.warn("Failed to load playtest-adversaries.json:",w)}try{const w=await et(()=>import("./playtest-environments-d9cdffb6.js"),[]);c=(w==null?void 0:w.default)||w}catch(w){console.warn("Failed to load playtest-environments.json:",w)}const{customAdversaries:S,customEnvironments:u}=xr();ct={...t,adversaries:[...t.adversaries||[],...p.adversaries||[],...S]},wt={...o,environments:[...o.environments||[],...c.environments||[],...u]},Ct=!0},gr=(t,o=[],p=4,c=1,S=!1)=>{const[u,w]=f.useState(""),[_,h]=f.useState([{field:"tier",direction:"asc"},{field:"name",direction:"asc"}]),[W,H]=f.useState([]),[B,T]=f.useState(!0),[C,q]=f.useState([]),[de,V]=f.useState([]),[G,J]=f.useState(!1),[ne,Q]=f.useState(!1),ze=f.useRef(null),xe=f.useRef(null);f.useEffect(()=>{(async()=>{await Rt(),T(!1);let P=[];t==="adversary"?P=ct.adversaries||[]:t==="environment"&&(P=wt.environments||[]),H(P)})()},[t]);const Oe=K=>{const P=W.map(ce=>ce[K]).filter(Boolean);return[...new Set(P)].sort((ce,ke)=>typeof ce=="number"&&typeof ke=="number"?ce-ke:String(ce).localeCompare(String(ke)))},ee=f.useCallback(async()=>{Ct=!1,await Rt();let K=[];t==="adversary"?S?K=(ct.adversaries||[]).filter(P=>{var ce;return P.source==="Homebrew"||((ce=P.id)==null?void 0:ce.startsWith("custom-"))}):K=ct.adversaries||[]:t==="environment"&&(K=wt.environments||[]),H(K)},[t,S]);f.useEffect(()=>{ee()},[S,ee]);const re=Oe("tier"),he=Oe("type"),je=f.useMemo(()=>{let K=W.filter(P=>{var Pe,be;const ce=P.name.toLowerCase().includes(u.toLowerCase())||((Pe=P.type)==null?void 0:Pe.toLowerCase().includes(u.toLowerCase()))||((be=P.description)==null?void 0:be.toLowerCase().includes(u.toLowerCase())),ke=C.length===0||(C.includes("party-tier")?P.tier===c:C.includes(P.tier.toString())),We=de.length===0||de.includes(P.type);return ce&&ke&&We});return K.sort((P,ce)=>{for(const ke of _){const{field:We,direction:Pe}=ke;let be=P[We],d=ce[We];if(We==="tier")be=parseInt(be)||0,d=parseInt(d)||0;else if(We==="cost"){const b=y=>{if(t!=="adversary")return 0;const r=ot[y.type]||2;let s=0;const O=o.filter(Y=>Y.type==="adversary"&&Y.item.type==="Solo"&&Y.quantity>0).reduce((Y,se)=>Y+se.quantity,0),L=o.filter(Y=>Y.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(Y.item.type)&&Y.quantity>0).reduce((Y,se)=>Y+se.quantity,0);return y.type==="Solo"&&O===1&&(s+=2),["Bruiser","Horde","Leader","Solo"].includes(y.type)&&L===0&&(s+=1),r+s};be=b(P),d=b(ce)}else if(We==="difficulty"){const b=parseInt(be),y=parseInt(d);!isNaN(b)&&!isNaN(y)?(be=b,d=y):!isNaN(b)&&isNaN(y)?(be=b,d=999):isNaN(b)&&!isNaN(y)?(be=999,d=y):(be=String(be||"").toLowerCase(),d=String(d||"").toLowerCase())}else typeof be=="string"&&typeof d=="string"?(be=be.toLowerCase(),d=d.toLowerCase()):(be=String(be||"").toLowerCase(),d=String(d||"").toLowerCase());if(Pe==="asc"){if(be>d)return 1;if(be<d)return-1}else{if(be<d)return 1;if(be>d)return-1}}return 0}),K},[W,u,_,C,de,o,p,c]),g=K=>{h(P=>{const ce=P.findIndex(ke=>ke.field===K);if(ce>=0)if(ce===0){const ke=[...P];return ke[0]={...ke[0],direction:ke[0].direction==="asc"?"desc":"asc"},ke}else{const ke=[...P];return ke.splice(ce,1)[0],[{field:K,direction:"asc"},...ke]}else return[{field:K,direction:"asc"},...P]})},D=K=>{q(K==="clear"?[]:K==="party-tier"?["party-tier"]:P=>P.includes(K)?P.filter(ce=>ce!==K):[...P,K])},A=K=>{V(K==="clear"?[]:P=>P.includes(K)?P.filter(ce=>ce!==K):[...P,K])},U=C.length>0,F=de.length>0;return f.useEffect(()=>{const K=ce=>{const ke=ce.target.closest(".filter-dropdown"),We=ce.target.closest(".header-filter-icon");ke||We||(J(!1),Q(!1))},P=ce=>{ce.key==="Escape"&&(J(!1),Q(!1))};return document.addEventListener("pointerdown",K,!0),document.addEventListener("mousedown",K,!0),document.addEventListener("touchstart",K,!0),document.addEventListener("click",K,!0),document.addEventListener("keydown",P,!0),()=>{document.removeEventListener("pointerdown",K,!0),document.removeEventListener("mousedown",K,!0),document.removeEventListener("touchstart",K,!0),document.removeEventListener("click",K,!0),document.removeEventListener("keydown",P,!0)}},[J,Q]),{searchTerm:u,setSearchTerm:w,sortFields:_,handleSort:g,filteredAndSortedData:je,loading:B,refreshData:ee,selectedTiers:C,selectedTypes:de,showTierDropdown:G,setShowTierDropdown:J,showTypeDropdown:ne,setShowTypeDropdown:Q,tierFilterRef:ze,typeFilterRef:xe,uniqueTiers:re,uniqueTypes:he,handleTierSelect:D,handleTypeSelect:A,isTierFiltered:U,isTypeFiltered:F,getDropdownStyle:K=>{if(!K.current)return{};const P=K.current.getBoundingClientRect();return{position:"fixed",top:P.bottom+4,left:P.left-100,zIndex:99999}}}},yr=({searchTerm:t,onSearchChange:o,type:p,partyControls:c,showCustomToggle:S=!1,onToggleCustom:u,filterCustom:w=!1,onExportCustomAdversaries:_,onImportCustomAdversaries:h,autoFocus:W=!1,onClose:H=null,placeholder:B="Search"})=>{const T=f.useRef(null);return f.useEffect(()=>{W&&T.current&&setTimeout(()=>{var C;(C=T.current)==null||C.focus()},100)},[W]),e.jsxs("div",{style:le.browserHeader,children:[e.jsx("div",{style:{display:"flex",alignItems:"center",flex:1,gap:"0.5rem"},children:e.jsx("input",{ref:T,type:"text",placeholder:B,value:t,onChange:C=>o(C.target.value),style:{...le.searchInput,flex:1,marginRight:0}})}),c&&e.jsx("div",{style:le.partyControls,children:c})]})},vr=({showCustomToggle:t=!1,onToggleCustom:o,filterCustom:p=!1,onExportCustomAdversaries:c,onImportCustomAdversaries:S})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)",flexShrink:0},children:[t&&e.jsxs("button",{onClick:()=>o&&o(!p),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:p?"var(--purple)":"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:p?"white":"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:u=>{p||(u.target.style.backgroundColor="var(--bg-hover)",u.target.style.borderColor="var(--purple)")},onMouseLeave:u=>{p||(u.target.style.backgroundColor="var(--bg-primary)",u.target.style.borderColor="var(--border)")},children:[e.jsx("span",{children:p?"✓":"○"}),"Custom Only"]}),e.jsxs("button",{onClick:c,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:u=>{u.target.style.backgroundColor="var(--bg-hover)",u.target.style.borderColor="var(--purple)"},onMouseLeave:u=>{u.target.style.backgroundColor="var(--bg-primary)",u.target.style.borderColor="var(--border)"},children:[e.jsx("span",{children:"↓"}),"Export"]}),e.jsxs("button",{onClick:()=>document.getElementById("import-file-input").click(),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:u=>{u.target.style.backgroundColor="var(--bg-hover)",u.target.style.borderColor="var(--purple)"},onMouseLeave:u=>{u.target.style.backgroundColor="var(--bg-primary)",u.target.style.borderColor="var(--border)"},children:[e.jsx("span",{children:"↑"}),"Import"]}),e.jsx("input",{id:"import-file-input",type:"file",accept:".csv,.json",onChange:S,style:{display:"none"}})]}),br=({sortFields:t,onSort:o,type:p,uniqueTiers:c,uniqueTypes:S,selectedTiers:u,selectedTypes:w,showTierDropdown:_,setShowTierDropdown:h,showTypeDropdown:W,setShowTypeDropdown:H,tierFilterRef:B,typeFilterRef:T,handleTierSelect:C,handleTypeSelect:q,isTierFiltered:de,isTypeFiltered:V,getDropdownStyle:G,costFilter:J,showCostDropdown:ne,setShowCostDropdown:Q,costFilterRef:ze,handleCostFilterSelect:xe,isCostFiltered:Oe})=>{const[ee,re]=f.useState(null),je=(()=>p==="adversary"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"cost",label:"Cost",hasFilter:!0},{key:"difficulty",label:"Diff"}]:p==="environment"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"}]:[])(),g=()=>{if(!ne)return null;const A=[{value:"all",label:"All"},{value:"auto-grey",label:"Auto Grey"},{value:"auto-hide",label:"Auto Hide"}];return vt.createPortal(e.jsx("div",{className:"filter-dropdown",style:{...le.filterDropdown,...G(ze),maxHeight:"60vh",overflow:"auto"},onMouseDown:U=>U.stopPropagation(),onClick:U=>U.stopPropagation(),children:A.map(U=>{const F=J===U.value;return e.jsxs("div",{style:{...le.filterOption,...F?le.filterOptionSelected:{}},onClick:()=>xe(U.value),children:[e.jsx("span",{style:le.checkIcon,children:F?e.jsx(it,{size:16}):e.jsx(lt,{size:16})}),e.jsx("span",{style:le.filterLabel,children:U.label})]},U.value)})}),document.body)},D=(A,U,F,De,K,P,ce,ke)=>{if(!K)return null;const We=()=>{(A==="tier"||A==="type")&&De("clear")};return vt.createPortal(e.jsxs("div",{className:"filter-dropdown",style:{...le.filterDropdown,...G(ce),maxHeight:"60vh",overflow:"auto"},onMouseDown:Pe=>Pe.stopPropagation(),onClick:Pe=>Pe.stopPropagation(),children:[e.jsxs("div",{style:{...le.filterOption,...F.length===0?le.filterOptionSelected:{}},onClick:We,children:[e.jsx("span",{style:le.checkIcon,children:F.length===0?e.jsx(it,{size:16}):e.jsx(lt,{size:16})}),e.jsx("span",{style:le.filterLabel,children:"All"})]}),A==="tier"&&e.jsxs("div",{style:{...le.filterOption,...F.includes("party-tier")?le.filterOptionSelected:{}},onClick:()=>De("party-tier"),children:[e.jsx("span",{style:le.checkIcon,children:F.includes("party-tier")?e.jsx(it,{size:16}):e.jsx(lt,{size:16})}),e.jsx("span",{style:le.filterLabel,children:"Party Tier"})]}),U.map(Pe=>{const be=F.includes(Pe.toString());return e.jsxs("div",{style:{...le.filterOption,...be?le.filterOptionSelected:{}},onClick:()=>De(Pe.toString()),children:[e.jsx("span",{style:le.checkIcon,children:be?e.jsx(it,{size:16}):e.jsx(lt,{size:16})}),e.jsx("span",{style:le.filterLabel,children:Pe})]},Pe)})]}),document.body)};return e.jsx("tr",{style:le.tableHeader,children:je.map(A=>e.jsxs("th",{style:{...le.tableHeaderCell,...ee===A.key?le.tableHeaderCellHover:{},position:"relative",...A.key==="name"?{width:"auto",minWidth:"0"}:{},...A.key==="tier"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...A.key==="type"?{width:"80px",minWidth:"80px",maxWidth:"80px"}:{},...A.key==="difficulty"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...A.key==="cost"?{width:"50px",minWidth:"50px",maxWidth:"50px"}:{}},onClick:()=>o(A.key),onMouseEnter:()=>re(A.key),onMouseLeave:()=>re(null),children:[A.hasFilter?e.jsxs("div",{style:le.headerWithFilter,children:[e.jsx("span",{style:{cursor:"pointer"},onClick:U=>{U.stopPropagation(),o(A.key)},children:A.label}),e.jsxs("button",{ref:A.key==="tier"?B:A.key==="type"?T:ze,style:{...le.headerFilterIcon,...A.key==="tier"&&de?le.headerFilterIconActive:{},...A.key==="type"&&V?le.headerFilterIconActive:{},...A.key==="cost"&&Oe?le.headerFilterIconActive:{}},className:"header-filter-icon",onClick:U=>{U.stopPropagation(),A.key==="tier"?(h(!_),H(!1),Q(!1)):A.key==="type"?(H(!W),h(!1),Q(!1)):A.key==="cost"&&(Q(!ne),h(!1),H(!1))},children:[e.jsx(Qt,{size:14}),A.key==="tier"&&de||A.key==="type"&&V||A.key==="cost"&&Oe?e.jsx("span",{style:le.filterActiveDot}):null]})]}):A.label,A.key==="tier"&&D("tier",c,u,C,_,h,B),A.key==="type"&&D("type",S,w,q,W,H,T),A.key==="cost"&&g()]},A.key))})},wr=({item:t,onAdd:o,type:p,onRowClick:c,encounterItems:S=[],pcCount:u=4,playerTier:w=1,remainingBudget:_=0,costFilter:h="auto-grey"})=>{const[W,H]=f.useState(!1),B=()=>{o(t)},T=()=>{if(p!=="adversary")return null;const de=ot[t.type]||2;let V=0;const G=S.filter(ne=>ne.type==="adversary"&&ne.item.type==="Solo"&&ne.quantity>0).reduce((ne,Q)=>ne+Q.quantity,0),J=S.filter(ne=>ne.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(ne.item.type)&&ne.quantity>0).reduce((ne,Q)=>ne+Q.quantity,0);return t.type==="Solo"&&G===1&&(V+=2),["Bruiser","Horde","Leader","Solo"].includes(t.type)&&J===0&&(V+=1),de+V},q=(()=>{if(p==="adversary"){const de=T();ot[t.type];const V=de>_||_<=0;if(h==="auto-hide"&&V)return null;const G=h==="auto-grey"&&V?{opacity:.5,color:"var(--text-secondary)"}:{};return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...le.rowCell,width:"auto",minWidth:"0",textAlign:"left",...G},children:e.jsxs("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:[e.jsx("div",{style:{fontWeight:"600"},children:t.name}),t.description&&e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"0.125rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.description})]})}),e.jsx("td",{style:{...le.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...G},children:t.tier}),e.jsx("td",{style:{...le.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center",...G},children:t.type}),e.jsx("td",{style:{...le.rowCell,width:"50px",minWidth:"50px",maxWidth:"50px",textAlign:"center",...G},children:de}),e.jsx("td",{style:{...le.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...G},children:t.difficulty})]})}else if(p==="environment")return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...le.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:t.name}),e.jsx("td",{style:{...le.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:t.tier}),e.jsx("td",{style:{...le.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:t.type}),e.jsx("td",{style:{...le.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:t.difficulty})]});return null})();return q===null?null:e.jsx(e.Fragment,{children:e.jsx("tr",{style:{...le.row,...W?le.rowHover:{}},onClick:()=>{p==="adversary"?B():c&&c(t,p)},onMouseEnter:()=>H(!0),onMouseLeave:()=>H(!1),children:q})})},Ft=({type:t,onAddItem:o,onCancel:p=null,onRowClick:c,encounterItems:S=[],pcCount:u=4,playerTier:w=1,partyControls:_=null,showContainer:h=!0,savedEncounters:W=[],onLoadEncounter:H,onDeleteEncounter:B,activeTab:T="adversaries",selectedCustomAdversaryId:C,onSelectCustomAdversary:q,onTabChange:de,selectedAdversary:V,onSelectAdversary:G,filterCustom:J=!1,showCustomToggle:ne=!1,onToggleCustom:Q,onExportCustomAdversaries:ze,onImportCustomAdversaries:xe,autoFocus:Oe=!1,hideImportExport:ee=!1,onClose:re=null,searchPlaceholder:he="Search"})=>{const{addCustomAdversary:je,updateCustomAdversary:g,customContent:D}=St(),[A,U]=f.useState(null),[F,De]=f.useState("all"),[K,P]=f.useState(!1),[ce,ke]=f.useState({}),We=f.useRef({}),Pe=f.useRef(null),be=()=>{try{const j=D.adversaries||[];if(j.length===0){alert("No custom adversaries to export.");return}const ge=["name","tier","type","difficulty","threshold_major","threshold_severe","hp_max","stress_max","atk","weapon","range","damage","description","motives"],Ce=j.map(Ie=>{var a,m;return[Ie.name||"",Ie.tier||"",Ie.type||"",Ie.difficulty||"",((a=Ie.thresholds)==null?void 0:a.major)||"",((m=Ie.thresholds)==null?void 0:m.severe)||"",Ie.hpMax||"",Ie.stressMax||"",Ie.atk||"",Ie.weapon||"",Ie.range||"",Ie.damage||"",Ie.description||"",Ie.motives||""]}),Be=Ie=>{const a=String(Ie);return a.includes(",")||a.includes('"')||a.includes(`
`)?`"${a.replace(/"/g,'""')}"`:a},Le=[ge.join(","),...Ce.map(Ie=>Ie.map(Be).join(","))].join(`
`),Ne=new Blob([Le],{type:"text/csv;charset=utf-8;"}),Re=URL.createObjectURL(Ne),Ae=document.createElement("a");Ae.href=Re,Ae.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(Ae),Ae.click(),document.body.removeChild(Ae),URL.revokeObjectURL(Re),console.log(`Exported ${j.length} custom adversaries to CSV`)}catch(j){console.error("Failed to export custom adversaries:",j),alert("Failed to export custom adversaries. Please try again.")}},d=j=>{const ge=j.target.files[0];if(!ge)return;const Ce=ge.name.endsWith(".csv"),Be=ge.name.endsWith(".json");if(!Ce&&!Be){alert("Please upload a CSV or JSON file."),j.target.value="";return}const Le=new FileReader;Le.onload=Ne=>{try{let Re=[];if(Ce){const v=Ne.target.result.split(`
`).filter(te=>te.trim());if(v.length<2)throw new Error("CSV file is empty or invalid.");const R=v[0].split(",").map(te=>te.trim().replace(/^"|"$/g,""));for(let te=1;te<v.length;te++){const Z=[];let E="",ie=!1;for(let Se=0;Se<v[te].length;Se++){const Me=v[te][Se],Ve=v[te][Se+1];Me==='"'&&ie&&Ve==='"'?(E+='"',Se++):Me==='"'?ie=!ie:Me===","&&!ie?(Z.push(E.trim()),E=""):E+=Me}Z.push(E.trim());const Ee={name:Z[R.indexOf("name")]||"",tier:parseInt(Z[R.indexOf("tier")])||1,type:Z[R.indexOf("type")]||"Standard",difficulty:parseInt(Z[R.indexOf("difficulty")])||11,thresholds:{major:parseInt(Z[R.indexOf("threshold_major")])||7,severe:parseInt(Z[R.indexOf("threshold_severe")])||12},hpMax:parseInt(Z[R.indexOf("hp_max")])||3,stressMax:parseInt(Z[R.indexOf("stress_max")])||1,atk:parseInt(Z[R.indexOf("atk")])||1,weapon:Z[R.indexOf("weapon")]||"",range:Z[R.indexOf("range")]||"Melee",damage:Z[R.indexOf("damage")]||"",description:Z[R.indexOf("description")]||"",motives:Z[R.indexOf("motives")]||"",source:"Homebrew"};Ee.name&&Re.push(Ee)}}else if(Be){const M=JSON.parse(Ne.target.result);if(!M.customAdversaries||!Array.isArray(M.customAdversaries))throw new Error("Invalid JSON format. Expected customAdversaries array.");Re=M.customAdversaries}const Ae=D.adversaries||[],Ie=[...Ae];let a=0,m=0;Re.forEach(M=>{if(Ae.some(R=>R.name===M.name&&R.source===M.source))m++;else{const R={...M,id:`custom-adv-${Date.now()}-${Math.random().toString(36).slice(2,10)}`,hp:0,stress:0};Ie.push(R),a++}}),a>0?(localStorage.setItem("daggerheart-custom-adversaries",JSON.stringify(Ie)),window.location.reload(),alert(`Import successful! Added ${a} new adversaries${m>0?`, skipped ${m} duplicates`:""}.`)):alert("No new adversaries were added. All imported adversaries already exist.")}catch(Re){console.error("Failed to import custom adversaries:",Re),alert(`Failed to import custom adversaries: ${Re.message}`)}},Le.readAsText(ge),j.target.value=""},b=()=>{U(null)},y=async(j,ge)=>{ge?g(ge,j):je(j)},r=j=>{ce[j]?(B&&B(j),ke(ge=>{const Ce={...ge};return delete Ce[j],Ce}),We.current[j]&&(clearTimeout(We.current[j]),delete We.current[j])):(ke(ge=>({...ge,[j]:!0})),We.current[j]&&clearTimeout(We.current[j]),We.current[j]=setTimeout(()=>{ke(ge=>{const Ce={...ge};return delete Ce[j],Ce}),delete We.current[j]},3e3))};f.useEffect(()=>()=>{Object.values(We.current).forEach(j=>{clearTimeout(j)})},[]);const{searchTerm:s,setSearchTerm:O,sortFields:L,handleSort:Y,filteredAndSortedData:se,loading:ve,selectedTiers:me,selectedTypes:$e,showTierDropdown:n,setShowTierDropdown:k,showTypeDropdown:i,setShowTypeDropdown:I,tierFilterRef:$,typeFilterRef:z,uniqueTiers:ae,uniqueTypes:ye,handleTierSelect:l,handleTypeSelect:x,isTierFiltered:N,isTypeFiltered:oe,getDropdownStyle:X}=gr(t,S,u,w,J),pe=(()=>{const j=3*u+2,ge=S.reduce((a,m)=>{if(m.type==="adversary"){const M=ot[m.item.type]||2;if(m.item.type==="Minion"){const v=Math.ceil(m.quantity/u);return a+v*M}else return a+m.quantity*M}return a},0);let Ce=0;S.filter(a=>a.type==="adversary"&&a.item.type==="Solo"&&a.quantity>0).reduce((a,m)=>a+m.quantity,0)>=2&&(Ce+=dt.twoOrMoreSolos);const Le=S.some(a=>a.type==="adversary"&&a.item.type==="Bruiser"&&a.quantity>0),Ne=S.some(a=>a.type==="adversary"&&a.item.type==="Horde"&&a.quantity>0),Re=S.some(a=>a.type==="adversary"&&a.item.type==="Leader"&&a.quantity>0),Ae=S.some(a=>a.type==="adversary"&&a.item.type==="Solo"&&a.quantity>0);return!Le&&!Ne&&!Re&&!Ae&&(Ce+=dt.noBruisersHordesLeadersSolos),j+Ce-ge})(),fe=j=>{De(j),P(!1)},ue=F!=="all";return ve?e.jsx("div",{style:le.browser,children:e.jsx("div",{style:le.loading,children:"Loading..."})}):e.jsx(e.Fragment,{children:e.jsxs("div",{style:h?le.browserWrapper:le.browserWrapperNoContainer,children:[T==="adversaries"&&e.jsxs(e.Fragment,{children:[e.jsx(yr,{searchTerm:s,onSearchChange:O,type:t,partyControls:_,autoFocus:Oe,onClose:re,placeholder:he}),!ee&&e.jsx(vr,{showCustomToggle:ne,onToggleCustom:Q,filterCustom:J,onExportCustomAdversaries:be,onImportCustomAdversaries:d}),e.jsx("div",{className:"browser-content invisible-scrollbar",style:le.browserContent,children:e.jsxs("table",{style:le.browserTable,children:[e.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,backgroundColor:"var(--bg-primary)"},children:e.jsx(br,{sortFields:L,onSort:Y,type:t,uniqueTiers:ae,uniqueTypes:ye,selectedTiers:me,selectedTypes:$e,showTierDropdown:n,setShowTierDropdown:k,showTypeDropdown:i,setShowTypeDropdown:I,tierFilterRef:$,typeFilterRef:z,handleTierSelect:l,handleTypeSelect:x,isTierFiltered:N,isTypeFiltered:oe,getDropdownStyle:X,costFilter:F,showCostDropdown:K,setShowCostDropdown:P,costFilterRef:Pe,handleCostFilterSelect:fe,isCostFiltered:ue})}),e.jsx("tbody",{children:se.map(j=>e.jsx(wr,{item:j,onAdd:o,type:t,onRowClick:c,encounterItems:S,pcCount:u,playerTier:w,remainingBudget:pe,costFilter:F},j.id))})]})})]}),T==="encounters"&&e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:W.length===0?e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",textAlign:"center",padding:"2rem 1rem"},children:"No saved encounters yet"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:W.map(j=>e.jsxs("div",{onClick:()=>H&&H(j.id),className:"saved-encounter-card",style:{border:"1px solid var(--border)",borderRadius:"8px",padding:"8px",backgroundColor:"var(--bg-card)",transition:"background-color 0.2s ease",display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsxs("div",{style:{minWidth:"100px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",flexDirection:"column",justifyContent:"center",minHeight:"60px"},children:[e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Tier: ",(()=>{var Be,Le,Ne,Re;const ge=((Re=(Ne=(Le=(Be=j.encounterItems)==null?void 0:Be.filter(Ae=>Ae.type==="adversary"))==null?void 0:Le.map(Ae=>Ae.item.tier))==null?void 0:Ne.filter(Ae=>Ae!=null))==null?void 0:Re.sort((Ae,Ie)=>Ae-Ie))||[];if(ge.length===0)return"N/A";if(ge.length===1)return ge[0];const Ce=[...new Set(ge)];return Ce.length===1?Ce[0]:`${Math.min(...Ce)}-${Math.max(...Ce)}`})()]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Party Size: ",j.partySize||4]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)"},children:["Balance: ",(()=>{const ge=j.partySize||4,Ce=3*ge+2;let Be=0;const Le=j.encounterItems||[];Le.filter(v=>v.type==="adversary"&&v.item.type==="Solo"&&v.quantity>0).reduce((v,R)=>v+R.quantity,0)>=2&&(Be+=dt.twoOrMoreSolos);const Re=Le.some(v=>v.type==="adversary"&&v.item.type==="Bruiser"&&v.quantity>0),Ae=Le.some(v=>v.type==="adversary"&&v.item.type==="Horde"&&v.quantity>0),Ie=Le.some(v=>v.type==="adversary"&&v.item.type==="Leader"&&v.quantity>0),a=Le.some(v=>v.type==="adversary"&&v.item.type==="Solo"&&v.quantity>0);!Re&&!Ae&&!Ie&&!a&&(Be+=dt.noBruisersHordesLeadersSolos);const m=Ce+Be,M=Le.reduce((v,R)=>{if(R.type==="adversary"){const te=ot[R.item.type]||2;if(R.item.type==="Minion"){const Z=Math.ceil(R.quantity/ge);return v+Z*te}else return v+R.quantity*te}return v},0);return M>m?`+${M-m}`:M===m?"0":`-${m-M}`})()]})]}),e.jsx("div",{style:{minWidth:"120px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",alignItems:"center",minHeight:"60px"},children:e.jsx("div",{style:{fontWeight:"500",color:"var(--text-primary)",fontSize:"0.9rem",wordWrap:"break-word",wordBreak:"break-word",width:"150px",maxWidth:"150px"},children:j.name})}),e.jsx(hr,{encounter:j}),e.jsx("button",{onClick:ge=>{ge.stopPropagation(),r(j.id)},style:{background:ce[j.id]?"var(--danger)":"var(--gray-600)",border:"none",color:"white",padding:"0.4rem 0.8rem",borderRadius:"4px",fontSize:"0.75rem",cursor:"pointer",minWidth:"60px",transition:"background-color 0.2s"},children:"Delete"})]},j.id))})}),T==="create"&&e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"1rem",display:"flex",justifyContent:"center",alignItems:"flex-start",height:"100%",minHeight:0},children:e.jsx("div",{style:{maxWidth:"600px",width:"100%",height:"auto",display:"flex",flexDirection:"column",padding:"0",overflowY:"visible",overflowX:"hidden",minHeight:0},children:e.jsx(Ot,{onSave:y,onRefresh:()=>{},onAddItem:o,editingAdversary:A,onCancelEdit:b,embedded:!1})})}),T==="info"&&e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"2rem"},children:[e.jsxs("div",{style:{marginBottom:"2rem",textAlign:"center"},children:[e.jsx("img",{src:pr,alt:"Daggerheart Community Content Logo",style:{width:"100%",maxWidth:"300px",height:"auto",margin:"0 auto 1.5rem auto",display:"block"},onError:j=>{console.error("Failed to load Daggerheart logo:",j.target.src),j.target.style.display="none"}}),e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",textAlign:"left",maxWidth:"600px",margin:"0 auto"},children:[e.jsx("p",{style:{marginTop:0},children:"This product includes materials from the Daggerheart System Reference Document 1.0, © Critical Role, LLC, under the terms of the Darrington Press Community Gaming (DPCGL) License."}),e.jsxs("p",{children:["More information can be found at ",e.jsx("a",{href:"https://www.daggerheart.com",target:"_blank",rel:"noopener noreferrer",style:{color:"var(--purple)",textDecoration:"underline"},children:"daggerheart.com"})]}),e.jsx("p",{style:{marginBottom:0},children:e.jsx("em",{children:"This project is unofficial and not endorsed by Darrington Press or Critical Role."})})]})]}),e.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto",border:"1px solid var(--border)",borderRadius:"8px",overflow:"hidden"},children:[e.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"1rem 1.5rem",color:"var(--text-primary)",border:"none",background:"var(--bg-secondary)",width:"100%",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"0.875rem",borderBottom:"1px solid var(--border)"},onMouseEnter:j=>{j.target.style.backgroundColor="var(--bg-hover)"},onMouseLeave:j=>{j.target.style.backgroundColor="var(--bg-secondary)"},onClick:j=>{j.stopPropagation(),window.open("https://github.com/Splinter714/Daggerheart","_blank")},children:[e.jsx("span",{children:"View on GitHub"}),e.jsx("span",{children:"→"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem 1.5rem",color:"var(--text-secondary)",background:"var(--bg-secondary)",fontSize:"0.875rem"},children:["Version ","0.4.7 (e6db5e0)"]})]})]})]})})},le={browserWrapper:{display:"flex",flexDirection:"column",background:"var(--bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border)",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserWrapperNoContainer:{display:"flex",flexDirection:"column",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserContent:{flex:1,overflowY:"auto",overflowX:"visible",padding:0,width:"100%",scrollbarWidth:"none",msOverflowStyle:"none",borderRadius:"0 0 8px 8px"},tableHeaderContainer:{flexShrink:0,position:"sticky",top:0,zIndex:15,backgroundColor:"var(--bg-secondary)"},browserTable:{width:"100%",minWidth:"100%",borderCollapse:"collapse",tableLayout:"fixed",background:"var(--bg-primary)",margin:0},browserHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--gray-900)",flexShrink:0,position:"sticky",top:0,zIndex:20},browserTitle:{margin:0,color:"var(--text-primary)",fontSize:"18px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"24px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",marginRight:"12px",transition:"all 0.2s ease"},partyControls:{display:"flex",alignItems:"center",gap:"12px",flexShrink:0},searchInputFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 3px rgba(139, 92, 246, 0.1)"},tableHeader:{background:"var(--gray-900)",borderBottom:"1px solid var(--border)",boxShadow:"0 1px 0 var(--border)",position:"sticky",top:"0",zIndex:10},tableHeaderCell:{backgroundColor:"var(--gray-900)",fontWeight:"700",borderBottom:"1px solid var(--border)",cursor:"pointer",userSelect:"none",minWidth:"100px",whiteSpace:"nowrap",padding:"4px 4px",color:"var(--text-primary)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",boxShadow:"0 1px 0 var(--border)",transition:"background-color 0.2s",position:"sticky",top:"0",zIndex:10},tableHeaderCellHover:{backgroundColor:"var(--bg-hover)"},sortIndicator:{fontSize:"12px",color:"var(--text-secondary)"},tableBody:{flex:1,overflowY:"auto",padding:"8px",backgroundColor:"var(--bg-primary)"},row:{height:"35px",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s ease",cursor:"pointer",backgroundColor:"var(--gray-900)"},rowHover:{backgroundColor:"var(--bg-secondary)"},expandedRow:{backgroundColor:"var(--bg-secondary)"},rowCell:{padding:"4px 4px",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid var(--border)"},rowCellName:{fontWeight:"500",minWidth:"150px"},rowCellCenter:{textAlign:"center",justifyContent:"center",minWidth:"80px"},rowActions:{width:"80px",textAlign:"center",padding:"4px 8px",borderBottom:"1px solid var(--border)"},addButton:{width:"2rem",height:"2rem",border:"1px solid var(--purple)",borderRadius:"var(--radius-sm)",background:"var(--purple)",color:"white",cursor:"pointer",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"500"},expandedContent:{padding:"0",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)"},columnName:{width:"auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",paddingLeft:"8px",textAlign:"left"},columnTier:{width:"80px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnType:{width:"100px",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},columnDifficulty:{width:"40px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnAction:{width:"32px",minWidth:"24px",maxWidth:"24px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"visible",textOverflow:"unset"},loading:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"var(--text-primary)",fontSize:"16px"},mobileBrowser:{width:"95vw",height:"90vh",maxWidth:"none"},mobileSearchInput:{fontSize:"16px"},headerWithFilter:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0px",position:"relative"},headerFilterIcon:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"2px 4px",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",position:"relative",marginLeft:"-2px"},headerFilterIconActive:{color:"var(--purple)"},filterIcon:{fontSize:"12px"},filterActiveDot:{position:"absolute",left:"50%",top:"2px",transform:"translateX(-50%)",width:"4px",height:"4px",borderRadius:"50%",background:"var(--purple)",pointerEvents:"none"},filterDropdown:{position:"fixed",background:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",zIndex:99999,marginTop:"4px",overflow:"hidden",width:"max-content",minWidth:"120px",maxWidth:"200px"},filterOption:{padding:"8px 12px",cursor:"pointer",color:"var(--text-primary)",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background-color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},filterOptionSelected:{backgroundColor:"var(--bg-hover)"},checkIcon:{width:"16px",height:"16px",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"12px"},filterLabel:{flex:1}},Cr=()=>e.jsx("div",{className:"pwa-install-prompt",style:{}}),gt=({side:t="left",children:o,className:p="",style:c={}})=>{const S=t==="left",u={flex:1,minWidth:0,background:"var(--bg-primary)",overflowY:"auto",overflowX:S?"auto":"hidden",display:S?"block":"flex",flexDirection:S?"initial":"column",height:"100%",padding:S?"8px 0 8px 0":"0 8px 0 0",...c};return e.jsx("div",{className:p,style:u,children:o})},Sr=t=>3*t+2,jr={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},yt={lessDifficult:-1,twoOrMoreSolos:-2,increasedDamage:-2,lowerTierAdversary:1,noBruisersHordesLeadersSolos:1,moreDangerous:2},kr=({isOpen:t,onClose:o,onAddAdversary:p,onAddAdversariesBulk:c,onAddEnvironment:S,onDeleteAdversary:u,onDeleteEnvironment:w,onDeleteCountdown:_,adversaries:h=[],environments:W=[],countdowns:H=[],savedEncounters:B=[],onSaveEncounter:T,onLoadEncounter:C,onDeleteEncounter:q})=>{const{partySize:de,updatePartySize:V,currentEncounterName:G,updateCurrentEncounterName:J,customContent:ne}=St(),Q=de,ze=V,[xe,Oe]=f.useState({lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),[ee,re]=f.useState([]),[he,je]=f.useState(G||"Encounter"),[g,D]=f.useState("adversaries"),[A,U]=f.useState(null),[F,De]=f.useState(null),[K,P]=f.useState(null),[ce,ke]=f.useState(null),[We,Pe]=f.useState(!1);f.useEffect(()=>{t&&!A&&je(G||"Encounter")},[t,A,G]);const be=()=>F?he!==F.name||JSON.stringify(ee)!==JSON.stringify(F.encounterItems)||Q!==F.partySize||JSON.stringify(xe)!==JSON.stringify(F.battlePointsAdjustments):!1,d=()=>{var l;if(ee.length>0||(he||"").trim()!=="Encounter")return!0;if(A&&be()){if(F){const x=ee.length,N=((l=F.encounterItems)==null?void 0:l.length)||0;if(x!==N||(he||"").trim()!==(F.name||""))return!0;const oe=JSON.stringify(xe),X=JSON.stringify(F.battlePointsAdjustments||{});return oe!==X}return!0}return!1},b=({onClick:l,children:x,variant:N="secondary",isConfirmation:oe=!1})=>{const X=N==="danger"||N==="secondary"&&oe,we=N==="purple";return e.jsx("button",{onClick:l,style:{background:X?"var(--danger)":we?"var(--purple)":"var(--bg-secondary)",border:we?"none":"1px solid var(--border)",color:X||we?"white":"var(--text-primary)",padding:"0.375rem 0.75rem",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s",width:"70px",fontSize:"0.875rem"},children:x})},y=Ue.useRef(Q),r=f.useCallback(l=>!l||l.length===0?null:B.find(N=>{var pe,fe;if(((pe=N.encounterItems)==null?void 0:pe.length)!==l.length)return!1;const oe=ue=>{var j;return{type:ue.type,quantity:ue.quantity,item:{name:ue.item.baseName||((j=ue.item.name)==null?void 0:j.replace(/\s+\(\d+\)$/,""))||ue.item.name,type:ue.item.type,tier:ue.item.tier}}},X=(fe=N.encounterItems)==null?void 0:fe.map(oe).sort((ue,j)=>ue.item.name.localeCompare(j.item.name)||ue.item.type.localeCompare(j.item.type)),we=l.map(oe).sort((ue,j)=>ue.item.name.localeCompare(j.item.name)||ue.item.type.localeCompare(j.item.type));return JSON.stringify(X)===JSON.stringify(we)})||null,[B]);Ue.useEffect(()=>{if(t&&h.length>0&&ee.length===0){const l={};h.forEach(oe=>{var we;const X=oe.baseName||((we=oe.name)==null?void 0:we.replace(/\s+\(\d+\)$/,""))||oe.name;l[X]||(l[X]={type:"adversary",item:oe,quantity:0}),l[X].quantity+=1});const x=Object.values(l);re(x);const N=r(x);N&&!A&&(U(N.id),De({name:N.name||"",encounterItems:N.encounterItems||[],partySize:N.partySize||4,battlePointsAdjustments:N.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),je(N.name||"Encounter"),J(N.name||"Encounter"))}else t&&h.length===0&&ee.length===0&&re([])},[t,r,A,J]);const s=Ue.useMemo(()=>{let l=0;ee.filter(pe=>pe.type==="adversary"&&pe.item.type==="Solo"&&pe.quantity>0).reduce((pe,fe)=>pe+fe.quantity,0)>=2&&(l+=yt.twoOrMoreSolos);const N=ee.some(pe=>pe.type==="adversary"&&pe.item.type==="Bruiser"&&pe.quantity>0),oe=ee.some(pe=>pe.type==="adversary"&&pe.item.type==="Horde"&&pe.quantity>0),X=ee.some(pe=>pe.type==="adversary"&&pe.item.type==="Leader"&&pe.quantity>0),we=ee.some(pe=>pe.type==="adversary"&&pe.item.type==="Solo"&&pe.quantity>0);return!N&&!oe&&!X&&!we&&(l+=yt.noBruisersHordesLeadersSolos),l},[ee]),O=Sr(Q),L=Object.entries(xe).filter(([l,x])=>x).reduce((l,[x,N])=>l+yt[x],0),Y=O+L+s,se=ee.reduce((l,x)=>{if(x.type==="adversary"){const N=jr[x.item.type]||2;return x.item.type==="Minion"?l+Math.ceil(x.quantity/Q)*N:l+N*x.quantity}return l},0);Ue.useEffect(()=>{const l=y.current;l!==Q&&(re(x=>x.map(N=>{if(N.type==="adversary"&&N.item.type==="Minion"){const X=Math.ceil(N.quantity/l)*Q;return{...N,quantity:X}}return N})),y.current=Q)},[Q]);const ve=(l,x)=>{const N=ee.findIndex(we=>we.item.id===l.id&&we.type===x),oe=l.type==="Minion"?Q:1;let X;N>=0?X=ee.map((we,pe)=>pe===N?{...we,quantity:we.quantity+oe}:we):X=[...ee,{item:l,type:x,quantity:oe}],re(X),me(X)},me=l=>{const x=h||[],N=[];l.forEach(fe=>{for(let ue=0;ue<fe.quantity;ue++)fe.type==="adversary"&&N.push(fe.item)});const oe={};x.forEach(fe=>{var j;const ue=fe.baseName||((j=fe.name)==null?void 0:j.replace(/\s+\(\d+\)$/,""))||fe.name;oe[ue]||(oe[ue]=[]),oe[ue].push(fe)});const X={};N.forEach(fe=>{var j;const ue=fe.baseName||((j=fe.name)==null?void 0:j.replace(/\s+\(\d+\)$/,""))||fe.name;X[ue]||(X[ue]=[]),X[ue].push(fe)});const we=[],pe=[];Object.keys(X).forEach(fe=>{var ge;const ue=((ge=oe[fe])==null?void 0:ge.length)||0,j=X[fe].length;if(j>ue){const Ce=j-ue;for(let Be=0;Be<Ce;Be++)we.push(X[fe][0])}else if(j<ue){const Ce=ue-j,Le=[...oe[fe]].sort((Ne,Re)=>{const Ae=Ne.duplicateNumber||1;return(Re.duplicateNumber||1)-Ae});for(let Ne=0;Ne<Ce;Ne++)pe.push(Le[Ne].id)}}),Object.keys(oe).forEach(fe=>{X[fe]||[...oe[fe]].sort((ge,Ce)=>{const Be=ge.duplicateNumber||1;return(Ce.duplicateNumber||1)-Be}).forEach(ge=>{pe.push(ge.id)})}),pe.forEach(fe=>{u(fe)}),we.length>0&&c(we)},$e=(l,x)=>{const N=(()=>{const oe=ee.findIndex(X=>X.item.id===l&&X.type===x);if(oe>=0){const X=ee[oe];if(X.quantity===0)return ee.filter((fe,ue)=>ue!==oe);const we=X.item.type==="Minion"?Q:1,pe=Math.max(0,X.quantity-we);return ee.map((fe,ue)=>ue===oe?{...fe,quantity:pe}:fe)}return ee})();re(N),me(N)},n=f.useCallback(()=>{if(ee.length===0)return null;const l=(he||"").trim()||"Encounter",x=B.find(N=>{var we,pe;if(N.name!==l||((we=N.encounterItems)==null?void 0:we.length)!==ee.length)return!1;const oe=JSON.stringify((pe=N.encounterItems)==null?void 0:pe.sort()),X=JSON.stringify([...ee].sort());return oe===X});return(x==null?void 0:x.id)||null},[B,he,ee]),k=f.useCallback(()=>{let l=(he||"").trim(),x=A;if(x||(x=n()),ee.length===0&&(!l||l==="Encounter")&&x){q(x),U(null),De(null);return}const N={name:l,encounterItems:ee,partySize:Q,battlePointsAdjustments:xe};if(x){N.id=x;const oe=T(N);U(oe)}else{const oe=T(N);U(oe)}De({name:l,encounterItems:ee,partySize:Q,battlePointsAdjustments:xe})},[ee,he,Q,xe,A,T,n,q]);f.useEffect(()=>{if(A&&be()){const l=setTimeout(()=>{k()},2e3);return()=>clearTimeout(l)}else if(!A&&ee.length>0&&he&&he.trim()!==""){const l=setTimeout(()=>{k()},2e3);return()=>clearTimeout(l)}},[ee,A,he,xe,Q]);const i=()=>{d()&&(re([]),je("Encounter"),J("Encounter"),U(null),De(null),h.forEach(l=>{u(l.id)}),W.forEach(l=>{w(l.id)}),H.forEach(l=>{_(l.id)}))},I=l=>{const x=C(l);if(x){const N=x.encounterItems||[];re(N),ze(x.partySize||4),Oe(x.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),je(x.name||""),J(x.name||""),U(l),De({name:x.name||"",encounterItems:x.encounterItems||[],partySize:x.partySize||4,battlePointsAdjustments:x.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),me(N)}},$=l=>{q(l),A===l&&(re([]),je("Encounter"),J("Encounter"),U(null),De(null),h.forEach(x=>{u(x.id)}),W.forEach(x=>{w(x.id)}),H.forEach(x=>{_(x.id)}))},z=()=>{try{const l={version:"1.0",exportDate:new Date().toISOString(),customAdversaries:ne.adversaries||[]},x=JSON.stringify(l,null,2),N=new Blob([x],{type:"application/json"}),oe=URL.createObjectURL(N),X=document.createElement("a");X.href=oe,X.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(X),X.click(),document.body.removeChild(X),URL.revokeObjectURL(oe),console.log("Custom adversaries exported successfully")}catch(l){console.error("Failed to export custom adversaries:",l),alert("Failed to export custom adversaries. Please try again.")}},ae=l=>{const x=l.target.files[0];if(!x)return;const N=new FileReader;N.onload=oe=>{try{const X=JSON.parse(oe.target.result);if(!X.customAdversaries||!Array.isArray(X.customAdversaries))throw new Error("Invalid file format. Expected customAdversaries array.");const we=ne.adversaries||[],pe=X.customAdversaries,fe=[...we];let ue=0;pe.forEach(j=>{we.some(Ce=>Ce.name===j.name&&Ce.type===j.type)||(fe.push({...j,id:`custom-${Date.now()}-${Math.random().toString(36).slice(2,10)}`}),ue++)}),updateCustomContent("adversary",null,fe),ue>0?alert(`Successfully imported ${ue} custom adversaries.`):alert("No new adversaries were added. All imported adversaries already exist.")}catch(X){console.error("Failed to import custom adversaries:",X),alert("Failed to import custom adversaries. Please check the file format and try again.")}},N.readAsText(x),l.target.value=""};if(!t)return null;const ye=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://");return e.jsx("div",{onClick:o,className:"encounter-builder-modal",style:{position:"fixed",top:0,left:0,right:0,bottom:ye?"calc(60px + env(safe-area-inset-bottom) + 1rem)":"calc(60px + env(safe-area-inset-bottom))",backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:1e3,display:"flex",alignItems:"flex-start",justifyContent:"center",padding:"12px"},children:e.jsxs("div",{onClick:l=>l.stopPropagation(),style:{backgroundColor:"var(--bg-primary)",border:"2px solid var(--border)",borderRadius:"12px",width:"100%",maxWidth:"1200px",height:"100%",maxHeight:"100%",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"},children:[e.jsxs("div",{className:"encounter-top-bar",style:{flex:"0 0 auto",display:"flex",alignItems:"center",height:"39px",backgroundColor:"var(--bg-primary)",borderBottom:"1px solid var(--border)"},children:[e.jsx("button",{onClick:()=>D("adversaries"),style:{flex:1,background:g==="adversaries"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:g==="adversaries"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Builder"}),e.jsx("button",{onClick:()=>D("encounters"),style:{flex:1,background:g==="encounters"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:g==="encounters"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Saved Encounters"}),e.jsx("button",{onClick:()=>D("create"),style:{flex:1,background:g==="create"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:g==="create"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Create Adversary"}),e.jsx("button",{onClick:()=>D("info"),style:{flex:1,background:g==="info"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:g==="info"?"500":"400",transition:"all 0.2s ease",position:"relative"},children:"Info"})]}),e.jsxs("div",{className:"encounter-builder-content",style:{flex:1,display:"flex",overflow:"hidden"},children:[e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",borderTop:"1px solid var(--border)"},children:e.jsx(Ft,{type:"adversary",onAddItem:l=>ve(l,"adversary"),encounterItems:ee,pcCount:Q,showContainer:!1,savedEncounters:B,onLoadEncounter:I,onDeleteEncounter:$,activeTab:g,selectedCustomAdversaryId:K,onSelectCustomAdversary:P,onTabChange:D,selectedAdversary:ce,onSelectAdversary:ke,filterCustom:We,showCustomToggle:!0,onToggleCustom:Pe,onExportCustomAdversaries:z,onImportCustomAdversaries:ae})}),g!=="info"&&e.jsxs("div",{className:"encounter-right-panel",style:{flex:1,borderLeft:"1px solid var(--border)",display:"flex",flexDirection:"column",overflow:"hidden",position:"relative"},children:[ce&&e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"var(--bg-primary)",zIndex:10,display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)",flexShrink:0},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:0},children:"Adversary Preview"}),e.jsx("button",{onClick:()=>ke(null),style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease"},onMouseEnter:l=>l.target.style.color="var(--text-primary)",onMouseLeave:l=>l.target.style.color="var(--text-secondary)",title:"Close preview",children:e.jsx(st,{size:16})})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"0.75rem"},children:e.jsx(ut,{item:{...ce,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...ce,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}})})]}),(g==="adversaries"||g==="encounters")&&e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-primary)",flexShrink:0},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:he,onChange:l=>{je(l.target.value),J(l.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(b,{onClick:i,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:d()?1:.5,cursor:d()?"pointer":"not-allowed"},children:"New"})]})}),(g==="adversaries"||g==="encounters")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"encounter-receipt-buttons-vertical",style:{display:"none",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:he,onChange:l=>{je(l.target.value),J(l.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(b,{onClick:i,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:d()?1:.5,cursor:d()?"pointer":"not-allowed"},children:"New"})]})}),e.jsx("div",{className:"receipt-content",style:{padding:"1rem",display:"flex",flexDirection:"column",height:"100%"},children:e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"flex-start",overflowY:"auto",marginBottom:"0.75rem"},children:[e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>ze(Math.max(1,Q-1)),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(pt,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:Q}),e.jsx("button",{onClick:()=>ze(Q+1),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(tt,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Party Size"})}),e.jsx("div",{style:{width:"120px",textAlign:"right"}})]}),ee.map(l=>{var x;return l.type!=="adversary"?null:e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>$e(l.item.id,l.type),style:{background:l.quantity===0?"var(--danger)":"var(--bg-secondary)",border:l.quantity===0?"none":"1px solid var(--border)",color:l.quantity===0?"white":"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:l.quantity===0?e.jsx(st,{size:10}):e.jsx(pt,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:l.quantity}),e.jsx("button",{onClick:()=>ve(l.item,l.type),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(tt,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:l.item.baseName||((x=l.item.name)==null?void 0:x.replace(/\s+\(\d+\)$/,""))||l.item.name})}),e.jsx("div",{style:{width:"80px",textAlign:"right"},children:e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.8rem"},children:l.item.type})})]},`${l.item.id}-${l.type}`)}),e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Balance"})}),e.jsx("div",{style:{width:"120px",textAlign:"right",display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsx("span",{style:{color:se>Y?"var(--danger)":se===Y?"var(--purple)":"var(--success)",fontWeight:600},children:se>Y?`+${se-Y}`:Y-se===0?"0":`-${Y-se}`})})]})]})})]}),g==="create"&&e.jsxs("div",{style:{padding:"1.5rem",overflowY:"auto",height:"100%"},children:[e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Creating Adversaries"}),e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsx("p",{children:"Use the form to create custom adversaries for your encounters."}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Adversary Types:"}),e.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Minion (1 BP):"})," Weak enemies in groups"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Standard (2 BP):"})," Average threat level"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Leader (3 BP):"})," Commands others"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Bruiser (4 BP):"})," High HP tank"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Solo (5 BP):"})," Boss-level threat"]})]})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Tips:"}),e.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[e.jsx("li",{children:"Match adversary tier to party level"}),e.jsx("li",{children:"Balance encounter difficulty with Battle Points"}),e.jsx("li",{children:"Mix adversary types for variety"}),e.jsx("li",{children:"Add features that create interesting choices"})]})]})]})]}),g==="myAdversaries"&&e.jsx("div",{style:{padding:"0.75rem",overflowY:"auto",height:"100%"},children:K?(()=>{var x;const l=(x=ne==null?void 0:ne.adversaries)==null?void 0:x.find(N=>N.id===K);return l?e.jsx(ut,{item:{...l,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...l,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}}):e.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Adversary not found"})})():e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Adversary Preview"}),e.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Select an adversary to view details"})]})})]})]})]})})},Ir=t=>3*t+2,Ar={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},Wt={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1};class Er extends Ue.Component{constructor(o){super(o),this.state={hasError:!1,error:null}}static getDerivedStateFromError(o){return{hasError:!0,error:o}}componentDidCatch(o,p){console.error("ErrorBoundary caught an error:",o,p)}render(){var o;return this.state.hasError?e.jsxs("div",{className:"p-md text-red",children:[e.jsx("h3",{children:"Something went wrong:"}),e.jsx("pre",{children:(o=this.state.error)==null?void 0:o.toString()}),e.jsx("button",{className:"btn-base btn-text",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try again"})]}):this.props.children}}const Mr=()=>{const{adversaries:t,environments:o,countdowns:p,fear:c,savedEncounters:S,partySize:u,updatePartySize:w,updateFear:_,createAdversary:h,createAdversariesBulk:W,updateAdversary:H,deleteAdversary:B,createEnvironment:T,updateEnvironment:C,deleteEnvironment:q,createCountdown:de,updateCountdown:V,deleteCountdown:G,advanceCountdown:J,saveEncounter:ne,loadEncounter:Q,deleteEncounter:ze}=St(),xe=u||4,[Oe,ee]=f.useState(!1),[re,he]=f.useState(!1);f.useState(!1),f.useState(!1),f.useState(!0);const[je,g]=f.useState(null),[D,A]=f.useState(null),[U,F]=f.useState(null),[De,K]=f.useState(!1),[P,ce]=f.useState("adversaries"),[ke,We]=f.useState(null),[Pe,be]=f.useState(0),[d,b]=f.useState(0),[y,r]=f.useState(!1);f.useState(new Set);const[s,O]=f.useState(new Set),[L,Y]=f.useState(null),[se,ve]=f.useState(!1),me=f.useRef(null),$e=f.useRef(xe);f.useEffect(()=>{const a=$e.current;if(a!==xe&&a>0){const m={};t.forEach(M=>{var R;const v=M.baseName||((R=M.name)==null?void 0:R.replace(/\s+\(\d+\)$/,""))||M.name;m[v]||(m[v]={type:"adversary",baseName:v,instances:[]}),m[v].instances.push(M)}),Object.values(m).forEach(M=>{if(M.type==="adversary"&&M.instances.length>0){const v=M.instances[0];if(v.type==="Minion"){const R=M.instances.length,Z=Math.ceil(R/a)*xe;if(Z!==R)if(Z>R){const E=Z-R,ie=Array(E).fill(null).map(()=>({...v}));W(ie)}else{const E=R-Z;M.instances.slice(-E).forEach(Ee=>{B(Ee.id)})}}}}),$e.current=xe}else(a===0||$e.current===0)&&($e.current=xe)},[xe]),f.useEffect(()=>{const a=()=>{const M=window.matchMedia("(max-width: 800px)");ee(M.matches)};a();const m=window.matchMedia("(max-width: 800px)");return m.addEventListener("change",a),()=>m.removeEventListener("change",a)},[]);const n=12,k=a=>a===1?200:350,i=a=>{if(a<=0)return{visibleColumns:1,columnWidth:k(1)};const m=n*2;let M=a-m,v=0,R={visibleColumns:1,columnWidth:M};for(let te=0;te<5;te++){const Z=M-v;let E={visibleColumns:1,columnWidth:Z};for(let Se=1;Se<=5;Se++){const Me=(Se-1)*n,Ve=(Z-Me)/Se;Ve>=k(Se)&&Se*Ve+Me<=Z&&(E={visibleColumns:Se,columnWidth:Ve})}E.visibleColumns*E.columnWidth+(E.visibleColumns-1)*n>Z&&(E={visibleColumns:1,columnWidth:Z});const Ee=E.columnWidth+n;if(Math.abs(Ee-v)<.1)return E;v=Ee,R=E}return R},{visibleColumns:I,columnWidth:$}=i(Pe);f.useEffect(()=>{const a=()=>{be(window.innerWidth)};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]);const z=f.useCallback(()=>{he(!1)},[]),ae=f.useCallback(a=>{let m=!1;if(me.current){const M=me.current,v=M.scrollLeft,R=M.scrollWidth-M.clientWidth;m=Math.abs(v-R)<1,m&&(M._wasAtMaxScrollOnBrowserOpen=!0)}A(a)},[]);f.useEffect(()=>{D!==null&&me.current&&me.current._wasAtMaxScrollOnBrowserOpen&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(me.current){const M=me.current,v=M.scrollWidth-M.clientWidth;M.scrollLeft=v,M._wasAtMaxScrollOnBrowserOpen=!1}})})},[D,$,n]);const ye=f.useCallback(()=>{A(null),ce("adversaries")},[]),l=f.useCallback((a,m=500,M="unknown")=>{if(console.log("[HORIZONTAL_SCROLL] smoothScrollTo called:",{targetScrollLeft:a,duration:m,reason:M,timestamp:performance.now()}),!me.current){console.log("[HORIZONTAL_SCROLL] No container ref, aborting");return}const v=me.current,R=v.scrollLeft,te=a-R;if(console.log("[HORIZONTAL_SCROLL] Scroll params:",{startScrollLeft:R,targetScrollLeft:a,distance:te,containerWidth:v.clientWidth,scrollWidth:v.scrollWidth}),Math.abs(te)<1){console.log("[HORIZONTAL_SCROLL] Distance too small, skipping animation");return}v._horizontalScrollAnimationId&&(console.log("[HORIZONTAL_SCROLL] Canceling existing animation"),cancelAnimationFrame(v._horizontalScrollAnimationId),v._horizontalScrollAnimationId=null);const E=window.getComputedStyle(v).scrollSnapType!=="none",ie=E?"x mandatory":null;console.log("[HORIZONTAL_SCROLL] Scroll-snap state:",{hasScrollSnap:E,originalScrollSnapType:ie}),E&&(v.style.scrollSnapType="none");const Ee=performance.now();console.log("[HORIZONTAL_SCROLL] Starting animation at:",Ee);const Se=Me=>{const Ve=Me-Ee,Ye=Math.min(Ve/m,1),He=1-Ye,_e=1-He*He*He;if(v){const Te=R+te*_e;v.scrollLeft=Te}Ye<1?v._horizontalScrollAnimationId=requestAnimationFrame(Se):(console.log("[HORIZONTAL_SCROLL] Animation complete, final scrollLeft:",v.scrollLeft),v&&(v.scrollLeft=a,v._horizontalScrollAnimationId=null))};return v._horizontalScrollAnimationId=requestAnimationFrame(Se),()=>{animationId&&cancelAnimationFrame(animationId),E&&v&&(v.style.scrollSnapType=ie||"")}},[]),x=f.useCallback(()=>{const a={};return t.forEach(m=>{var v;const M=m.baseName||((v=m.name)==null?void 0:v.replace(/\s+\(\d+\)$/,""))||m.name;a[M]||(a[M]={type:"adversary",baseName:M,instances:[]}),a[M].instances.push(m)}),p.forEach(m=>{a[`countdown-${m.id}`]={type:"countdown",baseName:m.name,instances:[m]}}),Object.values(a)},[t,p]),N=x(),oe=f.useCallback(a=>{var Me,Ve,Ye;const m=a.baseName||((Me=a.name)==null?void 0:Me.replace(/\s+\(\d+\)$/,""))||a.name,v=!N.find(He=>He.baseName===m&&He.type==="adversary"),R=a.type==="Minion",te=R?xe:1,Z=performance.now(),E=((Ve=me.current)==null?void 0:Ve.scrollWidth)??0,ie=((Ye=me.current)==null?void 0:Ye.scrollLeft)??0,Ee=me.current;let Se=!1;if(Ee&&v&&window.getComputedStyle(Ee).scrollSnapType!=="none"&&(Ee.style.scrollSnapType="none",Se=!0,console.log("[ADVERSARY_ADD] Disabled scroll-snap before adding adversary to prevent auto-scroll")),console.log("[ADVERSARY_ADD] handleAddAdversaryFromBrowser called:",{baseName:m,isNewAdversary:v,isMinion:R,instancesToAdd:te,timestamp:Z,currentScroll:ie,scrollWidth:E,scrollSnapDisabled:Se}),R&&te>1){const He=Array(te).fill(null).map(()=>({...a}));W(He)}else h(a);if(g("adversary"),v){const He=`adversary-${m}`;O(_e=>new Set(_e).add(He)),setTimeout(()=>{O(_e=>{const Te=new Set(_e);return Te.delete(He),Te})},10)}setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!me.current)return;const He=me.current;if(!(He.scrollWidth<=He.clientWidth))if(v){const _e=He.scrollWidth;setTimeout(()=>{if(!me.current)return;const Te=me.current;if(Te.scrollWidth!==_e)requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!me.current)return;const qe=me.current,Ge=qe.scrollWidth-qe.clientWidth,Ke=qe.scrollLeft,Je=Ge-ie,at=qe.scrollWidth>E;console.log("[HORIZONTAL_SCROLL] New adversary added, scrollWidth stabilized:",{maxScroll:Ge,scrollWidth:qe.scrollWidth,clientWidth:qe.clientWidth,scrollWidthBeforeAdd:E,scrollLeftBeforeAdd:ie,currentScroll:Ke,scrollChanged:Ke!==ie,scrollWidthIncreased:at,distance:Je}),at&&Math.abs(Je)<1?l(Ge+10,500,"new-adversary"):Math.abs(Je)>1&&l(Ge,500,"new-adversary")})});else{const qe=Te.scrollWidth-Te.clientWidth,Ge=Te.scrollLeft,Ke=qe-ie,Je=Te.scrollWidth>E;console.log("[HORIZONTAL_SCROLL] New adversary added, scrollWidth stable:",{maxScroll:qe,scrollWidth:Te.scrollWidth,clientWidth:Te.clientWidth,scrollWidthBeforeAdd:E,scrollLeftBeforeAdd:ie,currentScroll:Ge,scrollChanged:Ge!==ie,scrollWidthIncreased:Je,distance:Ke}),Je&&Math.abs(Ke)<1?l(qe+10,500,"new-adversary"):Math.abs(Ke)>1&&l(qe,500,"new-adversary")}},10)}else{const Te=x().findIndex(Xe=>Xe.baseName===m&&Xe.type==="adversary");if(Te>=0){const Xe=me.current,qe=Xe.scrollLeft,Ge=Xe.clientWidth,Ke=D!==null?Ge-($+n):Ge,Je=Te*($+n),at=Je+$+n,jt=10;Je>=qe-jt&&at<=qe+Ke+jt||l(Je,500)}}})})},50)},[h,N,$,n,l,x,D]),X=f.useCallback(()=>{const m="Standard",M=nt(1,m),v={name:"",baseName:"",tier:1,type:m,description:"",motives:"",difficulty:M.difficulty,thresholds:M.thresholds,hpMax:M.hpMax,stressMax:M.stressMax,atk:M.atk,weapon:"",range:M.range,damage:M.damage,experience:[],features:[],source:"Homebrew",hp:0,stress:0,isVisible:!0};h(v),setTimeout(()=>{const R=x();for(const te of R)if(te.type==="adversary"){const Z=te.instances.find(E=>E.source==="Homebrew"&&(!E.baseName||E.baseName.trim()===""||E.baseName==="Unknown"));if(Z&&!U){F(Z.id),requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(me.current){me.current;const E=R.findIndex(ie=>ie.instances.some(Ee=>Ee.id===Z.id));if(E>=0){const ie=E*($+n);l(ie,600,"new-custom-adversary")}}})});break}}},100)},[h,x,$,n,l,U]),we=f.useCallback(a=>{F(a),K(!1)},[]),pe=f.useCallback(()=>{F(null),K(!1)},[]),fe=f.useCallback(async(a,m)=>{if(m)H(m,a),F(null);else if(U){const M=h({...a,id:void 0});return F(null),M}else{const M=h({...a,id:void 0});return K(!1),M}},[U,h,H]),j=f.useCallback(()=>{const a={};return t.forEach(m=>{var v;const M=m.baseName||((v=m.name)==null?void 0:v.replace(/\s+\(\d+\)$/,""))||m.name;a[M]||(a[M]={type:"adversary",item:m,quantity:0}),a[M].quantity+=1}),Object.values(a)},[t])(),ge=Ir(xe),Ce=j.filter(a=>a.item.type==="Solo"&&a.quantity>0).reduce((a,m)=>a+m.quantity,0),Be=j.some(a=>a.item.type&&["Bruiser","Horde","Leader","Solo"].includes(a.item.type)&&a.quantity>0);let Le=0;Ce>=2&&(Le+=Wt.twoOrMoreSolos),Be||(Le+=Wt.noBruisersHordesLeadersSolos);const Ne=ge+Le,Re=j.reduce((a,m)=>{if(m.type==="adversary"){const M=Ar[m.item.type]||2;return m.item.type==="Minion"?a+Math.ceil(m.quantity/xe)*M:a+M*m.quantity}return a},0),Ae=f.useRef(null),Ie=f.useCallback(a=>{b(a.target.scrollLeft),Ae.current&&clearTimeout(Ae.current),Ae.current=setTimeout(()=>{const m=a.target;m&&m.style.scrollSnapType==="none"&&(m.style.scrollSnapType="x mandatory")},150)},[]);return f.useCallback(()=>{r(!0)},[]),f.useCallback(()=>{setTimeout(()=>r(!1),100)},[]),N.length,e.jsxs("div",{className:"app",onClick:a=>{a.target,a.currentTarget},children:[e.jsx(ar,{position:"top",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",width:"100%",justifyContent:"space-between",padding:"0 1rem"},children:[e.jsx(rt,{type:"fear",value:(c==null?void 0:c.value)||0,maxValue:12,onChange:_,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0}),e.jsx("button",{onClick:()=>{D!==null?ye():ae(N.length)},title:D!==null?"Close Browser":"Add Adversaries",style:{width:"36px",height:"36px",padding:0,backgroundColor:D!==null?"var(--purple)":"transparent",border:"1px solid var(--border)",borderRadius:"50%",color:D!==null?"white":"var(--text-primary)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",flexShrink:0},onMouseEnter:a=>{D===null&&(a.target.style.borderColor="var(--purple)",a.target.style.backgroundColor="var(--bg-secondary)")},onMouseLeave:a=>{D===null&&(a.target.style.borderColor="var(--border)",a.target.style.backgroundColor="transparent")},children:e.jsx(tt,{size:18})})]})}),e.jsxs("div",{className:"main-content",style:{position:"relative",width:"100%"},children:[D!==null&&e.jsx("div",{style:{position:"absolute",top:`${n}px`,right:`${n}px`,bottom:`${n}px`,width:`${$}px`,zIndex:100,overflow:"visible"},children:e.jsx(Pt,{tabContent:e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:X,style:{padding:"0.375rem 0.75rem",backgroundColor:"var(--purple)",border:"none",color:"white",borderRadius:"4px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",transition:"opacity 0.2s ease"},onMouseEnter:a=>{a.target.style.opacity="0.9"},onMouseLeave:a=>{a.target.style.opacity="1"},children:[e.jsx(tt,{size:16}),e.jsx("span",{children:"Add Custom"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:"500"},children:"Party Size:"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",border:"1px solid var(--border)",borderRadius:"4px",padding:"0.125rem 0.25rem",backgroundColor:"var(--bg-secondary)"},children:[e.jsx("button",{onClick:()=>w(Math.max(1,xe-1)),style:{background:"transparent",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:"0",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem"},onMouseEnter:a=>{a.target.style.color="var(--purple)"},onMouseLeave:a=>{a.target.style.color="var(--text-primary)"},children:e.jsx(pt,{size:12})}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:"500",minWidth:"1.5rem",textAlign:"center"},children:xe}),e.jsx("button",{onClick:()=>w(xe+1),style:{background:"transparent",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:"0",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem"},onMouseEnter:a=>{a.target.style.color="var(--purple)"},onMouseLeave:a=>{a.target.style.color="var(--text-primary)"},children:e.jsx(tt,{size:12})})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:"500"},children:"Balance:"}),e.jsx("span",{style:{color:Re>Ne?"var(--danger)":Re===Ne?"var(--purple)":"var(--success)",fontWeight:600,fontSize:"0.875rem"},children:Re>Ne?`+${Re-Ne}`:Ne-Re===0?"0":`-${Ne-Re}`})]}),ye&&e.jsx("button",{onClick:ye,style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease",flexShrink:0},onMouseEnter:a=>a.target.style.color="var(--text-primary)",onMouseLeave:a=>a.target.style.color="var(--text-secondary)",title:"Close browser",children:e.jsx(st,{size:16})})]}),showTab:!0,tabBackgroundColor:"var(--bg-primary)",tabBorderColor:"var(--border)",tabJustifyContent:"space-between",containerBackgroundColor:"var(--bg-primary)",containerBorderColor:"var(--border)",containerBorderRadius:"8px",containerBoxShadow:"-4px 0 12px rgba(0, 0, 0, 0.3)",containerOverflow:"hidden",reserveTabSpace:!0,containerStyle:{height:"100%"},children:e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,display:"flex",flexDirection:"column",width:"100%",minWidth:0},children:e.jsx(Ft,{type:"adversary",onAddItem:oe,showContainer:!1,activeTab:P,onTabChange:ce,pcCount:xe,savedEncounters:S,onLoadEncounter:Q,onDeleteEncounter:ze,selectedCustomAdversaryId:ke,onSelectCustomAdversary:We,autoFocus:!0,hideImportExport:!0,onClose:ye,searchPlaceholder:"Search adversaries"})})})}),e.jsxs("div",{ref:me,className:"dashboard-scroll-container",style:{display:"flex",flexDirection:"row",overflowX:"auto",overflowY:"hidden",padding:`0 ${n}px 0 0`,scrollSnapType:"x mandatory",height:"100%",width:"100%"},onScroll:Ie,children:[N.length===0?null:(()=>{const a=[];if(N.forEach((m,M)=>{var R,te,Z;if(L&&L.baseName===m.baseName&&m.type==="adversary"){a.push(e.jsx(gt,{style:{width:se?"0px":`${$+n}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:se?"0px":`${n}px`,paddingRight:"0",paddingTop:se?"0px":`${n}px`,paddingBottom:se?"0px":`${n}px`,scrollSnapAlign:"none",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"100%",opacity:0,transition:"width 0.3s ease, padding-left 0.3s ease, padding-top 0.3s ease, padding-bottom 0.3s ease"}},`spacer-${L.baseName}`));return}a.push(e.jsx(gt,{style:{width:`${$+n}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:`${n}px`,paddingRight:"0",paddingTop:`${m.type==="adversary"?n+52:n}px`,paddingBottom:`${n}px`,scrollSnapAlign:"start",overflow:m.type==="adversary"?"visible":"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"auto",opacity:s.has(`${m.type}-${m.baseName}`)?0:1,transition:(s.has(`${m.type}-${m.baseName}`),"opacity 0.2s ease")},children:e.jsx(ut,{type:m.type,item:{...m.instances[0],name:((R=m.instances[0])==null?void 0:R.name)||m.baseName,hp:0,stress:0,isDead:!1},mode:"expanded",instances:m.instances,showCustomCreator:m.type==="adversary"&&U&&m.instances.some(E=>E.id===U),onSaveCustomAdversary:m.type==="adversary"&&U&&m.instances.some(E=>E.id===U)?fe:void 0,onCancelEdit:m.type==="adversary"&&U&&m.instances.some(E=>E.id===U)?pe:void 0,isStockAdversary:m.type==="adversary"&&U&&m.instances.some(E=>E.id===U)?!((te=m.instances[0])!=null&&te.source)||((Z=m.instances[0])==null?void 0:Z.source)!=="Homebrew":!1,onApplyDamage:m.type==="adversary"?(E,ie,Ee,Se)=>{const Me=m.instances.find(Ve=>Ve.id===E);Me&&H(E,{hp:Math.min(Me.hpMax||1,(Me.hp||0)+ie)})}:void 0,onApplyHealing:m.type==="adversary"?(E,ie,Ee)=>{const Se=m.instances.find(Me=>Me.id===E);Se&&H(E,{hp:Math.max(0,(Se.hp||0)-ie)})}:void 0,onApplyStressChange:m.type==="adversary"?(E,ie)=>{var Ee,Se;return H(E,{stress:Math.max(0,Math.min(((Ee=m.instances.find(Me=>Me.id===E))==null?void 0:Ee.stressMax)||6,(((Se=m.instances.find(Me=>Me.id===E))==null?void 0:Se.stress)||0)+ie))})}:void 0,onUpdate:m.type==="adversary"?H:m.type==="environment"?C:V,adversaries:t,showAddRemoveButtons:D!==null&&m.type==="adversary",onEdit:m.type==="adversary"?E=>we(E):void 0,onAddInstance:m.type==="adversary"?E=>{const ie=E.type==="Minion",Ee=ie?xe:1;if(ie&&Ee>1){const Se=Array(Ee).fill(null).map(()=>({...E}));W(Se)}else h(E);setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(me.current){const Se=me.current,Me=Se.scrollLeft,Ve=Se.clientWidth,Ye=D!==null?Ve-($+n):Ve,_e=x().findIndex(Te=>Te.baseName===m.baseName&&Te.type==="adversary");if(_e>=0){const Te=_e*($+n),Xe=Te+$+n,qe=10;Te>=Me-qe&&Xe<=Me+Ye+qe||l(Te,500)}}})})},50)}:void 0,onRemoveInstance:m.type==="adversary"?E=>{const ie=m.instances[0],Se=(ie==null?void 0:ie.type)==="Minion"?xe:1,Me=m.instances.sort((He,_e)=>{const Te=He.duplicateNumber||1;return(_e.duplicateNumber||1)-Te}),Ye=Math.max(0,Me.length-Se)===0;if(Me.length>0){const He=Me.slice(0,Se);if(Ye){const _e=N.findIndex(Te=>Te.baseName===m.baseName&&Te.type==="adversary");Y({baseName:m.baseName,groupIndex:_e}),ve(!1),requestAnimationFrame(()=>{requestAnimationFrame(()=>{He.forEach(Te=>{B(Te.id)}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{ve(!0),setTimeout(()=>{Y(null),ve(!1)},300)})})})})}else He.forEach(_e=>{B(_e.id)})}}:void 0})},`${m.type}-${m.baseName}`))}),L&&!a.some(m=>(m==null?void 0:m.key)===`spacer-${L.baseName}`)){const m=Math.min(L.groupIndex,a.length);a.splice(m,0,e.jsx(gt,{style:{width:se?"0px":`${$+n}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:se?"0px":`${n}px`,paddingRight:"0",paddingTop:se?"0px":`${n}px`,paddingBottom:se?"0px":`${n}px`,scrollSnapAlign:"none",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"100%",opacity:0,transition:"width 0.3s ease, padding-left 0.3s ease, padding-top 0.3s ease, padding-bottom 0.3s ease"}},`spacer-${L.baseName}`))}return a})(),D!==null&&e.jsx("div",{style:{width:`${$+n}px`,flexShrink:0,flexGrow:0,flex:"none",height:"100%"}})]})]}),e.jsx(kr,{isOpen:re,onClose:z,onAddAdversary:a=>{h(a),g("adversary")},onAddAdversariesBulk:a=>{W(a),g("adversary")},onAddEnvironment:a=>{T(a),g("environment")},onDeleteAdversary:B,onDeleteEnvironment:q,onDeleteCountdown:G,adversaries:t,environments:o,countdowns:p,savedEncounters:S,onSaveEncounter:ne,onLoadEncounter:Q,onDeleteEncounter:ze}),e.jsx(Cr,{})]})},Tr=()=>e.jsx(Er,{children:e.jsx(Mr,{})});bt.createRoot(document.getElementById("root")).render(e.jsx(Ue.StrictMode,{children:e.jsx(or,{children:e.jsx(Tr,{})})}));
