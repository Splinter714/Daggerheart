import{r as w,a as fe,R as se}from"./dndkit-57209f9c.js";import{F as Ie,f as Ee,a as Me,b as De,c as ae}from"./fa-b4bcccb0.js";import{D as ee,A as me,H as J,C as We,M as ze,P as re,a as Ae,T as Te,b as Be,F as Le,S as ie,c as le}from"./lucide-c794c621.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))p(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&p(c)}).observe(document,{childList:!0,subtree:!0});function a(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function p(n){if(n.ep)return;n.ep=!0;const o=a(n);fetch(n.href,o)}})();var ye={exports:{}},Q={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Re=w,He=Symbol.for("react.element"),Ne=Symbol.for("react.fragment"),Pe=Object.prototype.hasOwnProperty,Fe=Re.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Oe={key:!0,ref:!0,__self:!0,__source:!0};function ve(r,t,a){var p,n={},o=null,c=null;a!==void 0&&(o=""+a),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(c=t.ref);for(p in t)Pe.call(t,p)&&!Oe.hasOwnProperty(p)&&(n[p]=t[p]);if(r&&r.defaultProps)for(p in t=r.defaultProps,t)n[p]===void 0&&(n[p]=t[p]);return{$$typeof:He,type:r,key:o,ref:c,props:n,_owner:Fe.current}}Q.Fragment=Ne;Q.jsx=ve;Q.jsxs=ve;ye.exports=Q;var e=ye.exports,te={},de=fe;te.createRoot=de.createRoot,te.hydrateRoot=de.hydrateRoot;const ce={fear:{icon:Ee,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"0.125rem",maxWidth:"none"},pipStyle:{fontSize:"var(--text-lg)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0,imageRendering:"crisp-edges"},filledColor:"var(--purple)",emptyColor:"var(--gray-dark)",tooltipTitle:"Click anywhere in header to adjust fear:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease fear by 1"},{text:"Right of boundary:",description:"Click to increase fear by 1"}]},hp:{icon:Me,maxValue:20,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stress:{icon:De,maxValue:12,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},countdown:{icon:ae,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust countdown:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease countdown by 1"},{text:"Right of boundary:",description:"Click to increase countdown by 1"}]},hpDots:{maxValue:20,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--red)",borderColor:"var(--red)",boxShadow:"0 0 4px rgba(239, 68, 68, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stressDots:{maxValue:12,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--purple)",borderColor:"var(--purple)",boxShadow:"0 0 4px rgba(139, 92, 246, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},adversaryHP:{icon:ee,maxValue:20,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust HP:",tooltipInstructions:[{text:"Filled pip:",description:"Click to heal (reduce damage)"},{text:"Empty pip:",description:"Click to take damage"}]},adversaryStress:{icon:me,maxValue:12,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust stress:",tooltipInstructions:[{text:"Filled pip:",description:"Click to reduce stress"},{text:"Empty pip:",description:"Click to increase stress"}]},countdownDistributed:{icon:ae,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Countdown progress:",tooltipInstructions:[{text:"Progress:",description:"Current countdown value"}]}},K=({type:r="fear",value:t=0,maxValue:a,onChange:p,size:n="lg",showTooltip:o=!0,containerStyle:c={},pipStyle:l={},countdownType:i=null,distributedGroups:g=null,onPipClick:u=null,enableBoundaryClick:s=!1,clickContainerWidth:x="auto",centerPips:v=!0})=>{const[d,C]=w.useState(!1),f=ce[r]||ce.fear,M=a||f.maxValue,S=Math.max(0,Math.min(M,t));let D=f.filledColor;r==="countdown"&&i&&(["progress","dynamic-progress","simple-hope"].includes(i)?D="var(--gold)":["consequence","dynamic-consequence","simple-fear"].includes(i)?D="var(--purple)":["long-term","standard"].includes(i)&&(D="var(--text-secondary)"));const R=(z,A)=>{if(u)u(z,A);else if(p){const O=z+1;p(O)}},P=z=>{if(!s||!p||u)return;z.currentTarget.getBoundingClientRect();const A=z.currentTarget.querySelector(".pip-container");if(!A)return;const O=A.getBoundingClientRect(),V=z.clientX-O.left;if(V<0){S>0&&p(S-1);return}if(V>O.width){S<M&&p(S+1);return}const _=O.width,E=_*.05,F=_-2*E,j=V-E,I=S/M,h=F*I;j<h?S>0&&p(S-1):S<M&&p(S+1)},W=(()=>{if(!g||r!=="countdownDistributed")return[{start:0,end:M,groupIndex:0}];let z=0;return g.map((A,O)=>{const V={start:z,end:z+A,groupIndex:O};return z+=A,V})})(),$=()=>e.jsxs(e.Fragment,{children:[W.map(z=>e.jsx(se.Fragment,{children:[...Array(z.end-z.start)].map((A,O)=>{const V=z.start+O,_=V<S;if(f.isDots)return e.jsx("div",{style:{...f.pipStyle,..._?f.filledStyle:f.emptyStyle,...l,cursor:p||u?"pointer":"default"},onClick:s?void 0:()=>R(V,_),title:`${V+1} of ${M}`},V);{const E=f.icon,F=E&&typeof E=="object"&&E.iconName,j=_?D:f.emptyColor;return e.jsx("span",{className:`fear-pip ${_?"filled":"empty"}`,style:{...f.pipStyle,color:j,cursor:p||u?"pointer":"default",...l},onClick:s?void 0:()=>R(V,_),title:`${V+1} of ${M}`,children:F?e.jsx(Ie,{icon:E,size:n}):e.jsx(E,{size:16})},V)}})},z.groupIndex)),o&&e.jsx("div",{style:{position:"relative",cursor:"help",pointerEvents:"none"},children:e.jsxs("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:d?"translateX(-50%) translateY(-5px)":"translateX(-50%)",background:"rgba(15, 23, 42, 0.95)",border:"1px solid var(--gray)",borderRadius:"var(--radius-md)",padding:"var(--space-md)",minWidth:"250px",zIndex:1e3,opacity:d?1:0,visibility:d?"visible":"hidden",transition:"all 0.2s ease",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.5)"},children:[e.jsx("div",{style:{fontWeight:600,color:"var(--gray-200)",marginBottom:"0.75rem",fontSize:"var(--text-sm)"},children:f.tooltipTitle}),f.tooltipInstructions.map((z,A)=>e.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.8rem",color:"var(--gray-300)",lineHeight:1.4},children:[e.jsx("strong",{style:{color:"var(--gray-200)"},children:z.text})," ",z.description]},A))]})})]});return e.jsx("div",{style:{width:x,height:"100%",cursor:p||u?"pointer":"default",touchAction:"manipulation",userSelect:"none",display:v?"flex":"block",alignItems:v?"center":"stretch",justifyContent:v?"center":"flex-start",...c},onClick:z=>{z.stopPropagation(),z.preventDefault(),s&&P(z)},onMouseEnter:()=>C(o),onMouseLeave:()=>C(!1),children:e.jsx("div",{className:"pip-container",style:{...f.containerStyle,width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},children:$()})})};function oe(r){const t=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return r?`${r}-${t}`:t}const $e=(r,t)=>({createAdversary:c=>{const l=oe("adv"),i=r().adversaries||[],g=c.name||"Unknown",u=i.filter(v=>v.baseName===g);let s=1;if(u.length===0)s=1;else{const v=u.map(C=>C.duplicateNumber||1);let d=1;for(;v.includes(d);)d++;s=d}const x={...c,id:l,baseName:g,duplicateNumber:s,name:`${g} (${s})`,hp:0,stress:0,isVisible:!0};t(v=>({...v,adversaries:[...v.adversaries,x]}))},updateAdversary:(c,l)=>{t(i=>({...i,adversaries:i.adversaries.map(g=>{if(g.id===c){const u={...g,...l};if(l.baseName!==void 0){const s=l.baseName,x=u.duplicateNumber||1;u.name=x===1?s:`${s} (${x})`}return u}return g})}))},deleteAdversary:c=>{t(l=>({...l,adversaries:l.adversaries.filter(i=>i.id!==c)}))},reorderAdversaries:c=>{t(l=>{const[i,g]=c,u=[...l.adversaries],[s]=u.splice(i,1);return u.splice(g,0,s),{...l,adversaries:u}})}}),Ve=r=>({createCountdown:i=>{const g={id:oe("countdown"),name:i.name||"Countdown",max:parseInt(i.max)||1,value:0,visible:!0,type:i.type||"standard",loop:i.loop||"none",source:i.source||"campaign"};r(u=>({...u,countdowns:[...u.countdowns,g]}))},updateCountdown:(i,g)=>{r(u=>({...u,countdowns:u.countdowns.map(s=>s.id===i?{...s,...g}:s)}))},deleteCountdown:i=>{r(g=>({...g,countdowns:g.countdowns.filter(u=>u.id!==i)}))},advanceCountdown:(i,g)=>{r(u=>({...u,countdowns:u.countdowns.map(s=>{if(s.id!==i)return s;let x=g;if(s.loop==="loop")x>s.max?x=(x-1)%s.max+1:x<0&&(x=s.max);else if(s.loop==="increasing"){if(x>s.max)return{...s,max:s.max+1,value:1};if(x<0)return{...s,max:Math.max(1,s.max-1),value:1};x=Math.max(0,x)}else if(s.loop==="decreasing"){if(x>s.max)return{...s,max:Math.max(1,s.max-1),value:1};if(x<0)return{...s,max:s.max+1,value:1};x=Math.min(s.max,x)}else x=Math.max(0,Math.min(x,s.max));return{...s,value:x}})}))},incrementCountdown:(i,g=1)=>{r(u=>({...u,countdowns:u.countdowns.map(s=>{if(s.id!==i)return s;let x=s.value+g;if(s.loop==="loop")x>s.max&&(x=(x-1)%s.max+1);else if(s.loop==="increasing"){if(x>s.max)return{...s,max:s.max+1,value:1}}else if(s.loop==="decreasing"){if(x>s.max)return{...s,max:Math.max(1,s.max-1),value:1}}else x=Math.min(x,s.max);return{...s,value:x}})}))},decrementCountdown:i=>{r(g=>({...g,countdowns:g.countdowns.map(u=>{if(u.id!==i)return u;let s=u.value-1;if(u.loop==="loop")s<0&&(s=u.max);else if(u.loop==="increasing"){if(s<0)return{...u,max:Math.max(1,u.max-1),value:u.max};s=Math.max(0,s)}else if(u.loop==="decreasing"){if(s<0)return{...u,max:u.max+1,value:1}}else s=Math.max(0,s);return{...u,value:s}})}))},reorderCountdowns:i=>{r(g=>{const[u,s]=i,x=[...g.countdowns],[v]=x.splice(u,1);return x.splice(s,0,v),{...g,countdowns:x}})}}),_e=(r,t)=>({createEnvironment:c=>{const l=oe("env"),g=(r().environments||[]).filter(x=>x.name.replace(/\s+\(\d+\)$/,"")===c.name);let u=c.name||"Unknown";if(g.length===0)u=c.name;else if(g.length===1){const x=g[0],v=x.name.replace(/\s+\(\d+\)$/,""),d=r().environments.map(C=>C.id===x.id?{...C,name:`${v} (1)`}:C);t(C=>({...C,environments:d})),u=`${c.name} (2)`}else{const x=g.map(d=>{const C=d.name.match(/\((\d+)\)$/);return C?parseInt(C[1]):null}).filter(d=>d!==null);let v=1;for(;x.includes(v);)v++;u=`${c.name} (${v})`}const s={...c,id:l,name:u,isVisible:!0};t(x=>({...x,environments:[...x.environments,s]}))},updateEnvironment:(c,l)=>{t(i=>({...i,environments:i.environments.map(g=>g.id===c?{...g,...l}:g)}))},deleteEnvironment:c=>{t(l=>({...l,environments:l.environments.filter(i=>i.id!==c)}))},reorderEnvironments:c=>{t(l=>{const[i,g]=c,u=[...l.environments],[s]=u.splice(i,1);return u.splice(g,0,s),{...l,environments:u}})}});function qe(r,t){const a=(r==null?void 0:r.type)||"standard";if(a==="standard")return 1;if(a==="progress"||a==="dynamic-progress")switch(t){case"success-hope":return 2;case"success-fear":return 1;case"critical-success":return 3;default:return 0}if(a==="consequence"||a==="dynamic-consequence")switch(t){case"success-fear":return 1;case"failure-hope":return 2;case"failure-fear":return 3;default:return 0}return a==="simple-fear"?t==="simple-fear"||t==="success-fear"||t==="failure-fear"?1:0:a==="simple-hope"&&(t==="simple-hope"||t==="success-hope"||t==="failure-hope"||t==="critical-success")?1:0}function Xe(r){return((r==null?void 0:r.type)||"standard")==="standard"?1:0}function Ye({adversaries:r,updateAdversary:t,deleteAdversary:a,selectedItem:p,setSelectedItem:n}){const o=w.useCallback((i,g,u,s)=>{var M,S;const x=r.find(D=>D.id===i);if(!x)return;const v=x.type==="Minion",d=(M=x.features)==null?void 0:M.find(D=>{var R;return(R=D.name)==null?void 0:R.startsWith("Minion (")}),C=d?parseInt(((S=d.name.match(/\((\d+)\)/))==null?void 0:S[1])||"1"):1;if(v){a(i);const D=Math.floor(g/C);if(D>0){const R=r.filter(P=>P.type==="Minion"&&P.id!==i&&P.name===x.name);for(let P=0;P<Math.min(D,R.length);P++)a(R[P].id)}return}const f=Math.min(u+g,s);p&&p.id===i&&n(D=>({...D,hp:f})),t(i,{hp:f})},[r,t,a,p,n]),c=w.useCallback((i,g,u)=>{const s=Math.max(0,u-g);p&&p.id===i&&n(x=>({...x,hp:s})),t(i,{hp:s})},[t,p,n]),l=w.useCallback((i,g,u,s)=>{const x=r.find(C=>C.id===i);if(!x)return;let v=u+g,d=x.hp||0;if(v>s){const C=v-s;v=s,d=Math.min(x.hpMax||0,d+C)}v=Math.max(0,v),p&&p.id===i&&n(C=>({...C,stress:v,hp:d})),t(i,{stress:v,hp:d})},[r,t,p,n]);return{handleAdversaryDamage:o,handleAdversaryHealing:c,handleAdversaryStressChange:l}}const L={transitions:{hoverIn:"all 0.1s ease",hoverOut:"all 0.3s ease",colorIn:"color 0.1s ease",colorOut:"color 0.3s ease",backgroundIn:"background-color 0.1s ease",backgroundOut:"background-color 0.3s ease"},card:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"12px",cursor:"pointer",transition:"all 0.1s ease",position:"relative"},cardHover:{backgroundColor:"var(--bg-card-hover)"},cardDead:{opacity:.6,backgroundColor:"var(--gray-800)",borderColor:"var(--border)"},cardAtMax:{backgroundColor:"var(--success)",borderColor:"var(--success)"},rowMain:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},rowTitle:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",margin:0},rowMeta:{display:"flex",gap:"8px",alignItems:"center"},cardActions:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px"},controlButtons:{display:"flex",gap:"8px",alignItems:"center"},pipSymbols:{display:"flex",gap:"4px",alignItems:"center",cursor:"pointer",padding:"2px"},pipSymbol:{fontSize:"16px",transition:"color 0.1s ease"},pipGroup:{display:"flex",gap:"4px",marginBottom:"4px"},badge:{padding:"2px 6px",borderRadius:"3px",fontSize:"10px",fontWeight:"600",textTransform:"uppercase"},typeBadge:{backgroundColor:"var(--purple)",color:"var(--text-primary)"},difficultyBadge:{backgroundColor:"var(--gray-500)",color:"var(--text-primary)",cursor:"pointer",transition:"background-color 0.1s ease"},tierBadge:{backgroundColor:"var(--info)",color:"var(--text-primary)"},inputBase:{padding:"8px",borderColor:"var(--gray-500)",backgroundColor:"var(--gray-900)",color:"var(--text-primary)",fontSize:"14px",transition:"all 0.2s ease"},inputBaseFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 2px rgba(79, 70, 229, 0.1)"},inputBaseDisabled:{opacity:.6,cursor:"not-allowed"},button:{backgroundColor:"var(--danger)",color:"var(--text-primary)",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease"},incrementButton:{backgroundColor:"var(--success)",color:"var(--text-primary)",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease"},decrementButton:{backgroundColor:"var(--warning)",color:"var(--text-primary)",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease"},damageInputPopup:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,borderRadius:"8px"},damageInputContent:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"8px",padding:"16px",display:"flex",flexDirection:"column",gap:"12px",minWidth:"200px"},damageInput:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"4px",padding:"8px",color:"var(--text-primary)",fontSize:"14px"},damageIndicators:{display:"flex",gap:"8px",alignItems:"center",justifyContent:"center"},damageDrop:{fontSize:"16px",color:"var(--text-secondary)",cursor:"pointer",transition:"color 0.1s ease"},applyButton:{backgroundColor:"var(--success)",color:"var(--text-primary)",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease"}},Ge=(r,t,a,p)=>{const[n,o]=w.useState(!1),[c,l]=w.useState(""),i=v=>{v.stopPropagation(),v.preventDefault();const d=r.hp||0,C=r.hpMax||1,f=v.currentTarget.getBoundingClientRect(),M=v.clientX-f.left,S=f.width/C;Math.floor(M/S)<d?a&&a(r.id,1,r.hp):t&&t(r.id,1,r.hp,r.hpMax)},g=v=>{v.stopPropagation(),v.preventDefault();const d=r.stress||0,C=r.stressMax||1,f=v.currentTarget.getBoundingClientRect(),M=v.clientX-f.left,S=f.width/C;Math.floor(M/S)<d?p&&p(r.id,-1,r.stress,r.stressMax):p&&p(r.id,1,r.stress,r.stressMax)},u=v=>{v.stopPropagation(),(r.thresholds&&r.thresholds.major&&r.thresholds.severe||r.type==="Minion")&&(o(!0),l(r.type==="Minion"?"1":""))},s=()=>{const v=parseInt(c);if(v>0){if(r.type==="Minion")t&&t(r.id,v,r.hp,r.hpMax);else{let d=0;v>=r.thresholds.severe?d=3:v>=r.thresholds.major?d=2:v>=1&&(d=1),t&&t(r.id,d,r.hp,r.hpMax)}o(!1),l("")}};return{showDamageInput:n,damageValue:c,setDamageValue:l,setShowDamageInput:o,handleHpClick:i,handleStressClick:g,handleDifficultyClick:u,applyDamage:s,handleKeyDown:v=>{v.key==="Enter"?s():v.key==="Escape"&&(o(!1),l(""))}}},Ke=(r,t,a)=>({renderDistributedPips:()=>{const n=r.max,o=[];for(let c=0;c<n;c+=5){const l=Math.min(5,n-c);o.push(l)}return o.map((c,l)=>e.jsx("div",{style:L.pipGroup,children:Array.from({length:c},(i,g)=>{const u=l*5+g;return e.jsx("span",{style:{...L.pipSymbol,color:u<(r.value||0)?"var(--red)":"var(--text-secondary)"},title:`${u+1} of ${r.max}`,children:u<(r.value||0)?"●":"○"},u)})},l))}}),G=({item:r,type:t,mode:a="compact",onClick:p,onDelete:n,onApplyDamage:o,onApplyHealing:c,onApplyStressChange:l,onUpdate:i,onIncrement:g,onDecrement:u,dragAttributes:s,dragListeners:x,adversaries:v=[],isSelected:d=!1,isEditMode:C=!1})=>{const f=Ge(r,o,c,l),M=Ke(r);(t==="adversary"||t==="adversaries")&&f.handleDifficultyClick;const[S,D]=w.useState(!1),R=()=>{D(!0)},P=()=>{D(!1)},N=(h=!1)=>{let y={...L.card};if(d?y.transition="none":y.transition=S?L.transitions.hoverIn:L.transitions.hoverOut,h){const{marginTop:m,...b}=y;y=b}return(S&&a!=="expanded"||d)&&(y={...y,...L.cardHover}),t==="adversary"&&(r.hp||0)>=(r.hpMax||1)&&(y={...y,...L.cardDead}),t==="countdown"&&(r.value||0)>=r.max&&(y={...y,...L.cardAtMax}),y},W=()=>{let h="border rounded-lg";return(S&&a!=="expanded"||d)&&(h+=" border-hover"),h},$=()=>{var h,y;if(t==="adversary"||t==="adversaries"){const m=r.baseName||((h=r.name)==null?void 0:h.replace(/\s+\(\d+\)$/,""))||"",b=r.duplicateNumber||((y=r.name)!=null&&y.match(/\((\d+)\)$/)?parseInt(r.name.match(/\((\d+)\)$/)[1]):1),k=[...v];return v.some(B=>B.id===r.id)||k.push(r),k.filter(B=>B.baseName===m).length>1?`${m} (${b})`:m}return r.name},z=()=>{const h=[];return r.type&&h.push(e.jsx("span",{style:{...L.badge,...L.typeBadge},children:r.type},"type")),t==="environment"&&r.tier&&h.push(e.jsxs("span",{style:{...L.badge,...L.tierBadge},children:["Tier ",r.tier]},"tier")),h},A=()=>e.jsxs("div",{style:L.cardActions,children:[e.jsxs("div",{style:L.controlButtons,children:[e.jsx("div",{style:{display:"flex",alignItems:"center"},children:e.jsx("div",{style:{display:"flex",gap:"0.25rem",alignItems:"center",cursor:"pointer",padding:"0.125rem",borderRadius:"0.5rem",transition:"all 0.2s ease"},onClick:t==="adversary"||t==="adversaries"?f.handleHpClick:void 0,onMouseEnter:h=>h.target.style.background="var(--gray-800)",onMouseLeave:h=>h.target.style.background="transparent",children:Array.from({length:r.hpMax||1},(h,y)=>e.jsx("span",{style:{fontSize:"1rem",transition:"color 0.1s ease",cursor:"pointer",color:y<(r.hp||0)?"var(--red)":"var(--text-secondary)"},title:y<(r.hp||0)?"Click to heal (reduce damage)":"Click to take damage",children:e.jsx(ee,{size:16})},y))})}),r.stressMax>0&&e.jsx("div",{style:{display:"flex",alignItems:"center"},children:e.jsx("div",{style:{display:"flex",gap:"0.25rem",alignItems:"center",cursor:"pointer",padding:"0.125rem",borderRadius:"0.5rem",transition:"all 0.2s ease"},onClick:t==="adversary"||t==="adversaries"?f.handleStressClick:void 0,onMouseEnter:h=>h.target.style.background="var(--gray-800)",onMouseLeave:h=>h.target.style.background="transparent",children:Array.from({length:r.stressMax},(h,y)=>e.jsx("span",{style:{fontSize:"1rem",transition:"color 0.1s ease",cursor:"pointer",color:y<(r.stress||0)?"var(--gold)":"var(--text-secondary)"},title:y<(r.stress||0)?"Click to reduce stress":"Click to increase stress",children:e.jsx(me,{size:16})},y))})}),r.difficulty&&e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:e.jsx("div",{onClick:t==="adversary"||t==="adversaries"?f.handleDifficultyClick:void 0,style:{cursor:r.thresholds&&r.thresholds.major&&r.thresholds.severe||r.type==="Minion"?"pointer":"default"},title:r.thresholds&&r.thresholds.major&&r.thresholds.severe?`Click to enter damage (thresholds: ${r.thresholds.major}/${r.thresholds.severe})`:r.type==="Minion"?"Click to enter damage (minion mechanics)":"",children:e.jsx("div",{className:"border rounded-md",style:{display:"flex",alignItems:"center",gap:"0.25rem",background:"var(--gray-900)",borderColor:"var(--border)",padding:"0.25rem 0.5rem",transition:"all 0.2s ease"},onMouseEnter:h=>h.target.style.background="var(--gray-800)",onMouseLeave:h=>h.target.style.background="var(--gray-900)",children:e.jsx("span",{style:{fontSize:"0.875rem",fontWeight:600,color:"var(--text-primary)"},children:r.difficulty})})})})]}),e.jsx("div",{style:{display:"flex",alignItems:"center"},children:!1})]}),O=()=>null,V=()=>e.jsxs(e.Fragment,{children:[e.jsx("button",{style:L.decrementButton,onClick:h=>{h.stopPropagation(),h.preventDefault(),u&&u(r.id)},title:"Decrease progress",children:e.jsx(ze,{size:16})}),e.jsx("button",{style:L.incrementButton,onClick:h=>{h.stopPropagation(),h.preventDefault(),g&&g(r.id)},title:r.value>=r.max?r.loop&&r.loop!=="none"?"Loop countdown":"Countdown at max":"Increase progress",children:r.value>=r.max?r.loop&&r.loop!=="none"?"⟳":e.jsx(re,{size:16}):e.jsx(re,{size:16})})]}),_=()=>{switch(t){case"adversary":return A();case"environment":return O();case"countdown":return V();default:return null}},E=()=>t==="countdown"?e.jsx("div",{style:L.pipSymbols,children:t==="countdown"?M.renderDistributedPips():null}):null,F=()=>t!=="adversary"||!f.showDamageInput||!(r.thresholds&&r.thresholds.major&&r.thresholds.severe||r.type==="Minion")?null:e.jsx("div",{style:L.damageInputPopup,onClick:h=>{h.stopPropagation(),h.target===h.currentTarget&&(t==="adversary"||t==="adversaries")&&(f.setShowDamageInput(!1),f.setDamageValue(""))},children:e.jsxs("div",{className:"border rounded-lg",style:{...L.damageInputContent,borderColor:"var(--border)"},onClick:h=>h.stopPropagation(),children:[e.jsx("input",{type:"number",inputMode:"numeric",enterKeyHint:"done",placeholder:"Damage",min:r.type==="Minion"?"1":"0",value:t==="adversary"||t==="adversaries"?f.damageValue:"",onChange:h=>{(t==="adversary"||t==="adversaries")&&f.setDamageValue(h.target.value)},onKeyDown:t==="adversary"||t==="adversaries"?f.handleKeyDown:void 0,className:"border rounded-sm",style:{...L.damageInput,borderColor:"var(--border)"},autoFocus:!0}),e.jsxs("div",{style:L.damageIndicators,children:[r.type==="Minion"?(()=>{var k,T;const h=parseInt(t==="adversary"||t==="adversaries"?f.damageValue:"0")||0,y=(k=r.features)==null?void 0:k.find(X=>{var B;return(B=X.name)==null?void 0:B.startsWith("Minion (")}),m=y?parseInt(((T=y.name.match(/\((\d+)\)/))==null?void 0:T[1])||"1"):1,b=Math.floor(h/m);return h>=m&&b>0?e.jsxs("span",{style:{...L.damageDrop,color:"var(--success)"},title:`${h} damage can defeat ${b+1} minion${b+1!==1?"s":""} (1 + ${b} additional)`,children:["+",b," additional minion(s)"]}):e.jsx("span",{style:L.damageDrop,title:`${h} damage defeats this minion only`,children:"+0 additional minion(s)"})})():[1,2,3].map(h=>{const y=parseInt(t==="adversary"||t==="adversaries"?f.damageValue:"0")||0;let m=!1;return h===1&&y>=1&&(m=!0),h===2&&y>=r.thresholds.major&&(m=!0),h===3&&y>=r.thresholds.severe&&(m=!0),e.jsx("span",{style:{...L.damageDrop,color:m?"var(--red)":"var(--text-secondary)"},onClick:b=>{b.stopPropagation(),(t==="adversary"||t==="adversaries")&&(h===1?f.setDamageValue("1"):h===2?f.setDamageValue(r.thresholds.major.toString()):h===3&&f.setDamageValue(r.thresholds.severe.toString()))},title:`Click to set damage to ${h===1?"1":h===2?r.thresholds.major:r.thresholds.severe}`,children:e.jsx(ee,{size:16})},h)}),e.jsx("button",{style:{...L.applyButton,backgroundColor:!f.damageValue||parseInt(f.damageValue)<1?"var(--gray-600)":"var(--success)"},onClick:h=>{h.stopPropagation(),(t==="adversary"||t==="adversaries")&&f.applyDamage()},title:"Apply damage",disabled:!f.damageValue||parseInt(f.damageValue)<1,children:e.jsx(We,{size:16})})]})]})}),j=()=>{const y=(r.hp||0)>=(r.hpMax||1),m=a==="edit";return e.jsxs("div",{className:W(),style:{...N(!0),padding:0,minHeight:"400px",opacity:y?.7:1,backgroundColor:y?"var(--gray-900)":N(!0).backgroundColor,borderColor:y?"color-mix(in srgb, var(--gray-600) 40%, transparent)":d?"var(--purple)":S&&a!=="expanded"?"var(--border-hover)":"var(--border)",borderWidth:"2px",display:"flex",flexDirection:"column",position:"relative"},...s,...x,onClick:p,...a!=="expanded"&&{onMouseEnter:R,onMouseLeave:P},children:[y&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                45deg,
                transparent,
                transparent 8px,
                var(--gray-600) 1px,
                var(--gray-600) 9px
              )`,pointerEvents:"none",zIndex:9999}}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"var(--text-secondary)",fontSize:"1rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em",zIndex:1e4,pointerEvents:"none",textShadow:"1px 1px 2px rgba(0, 0, 0, 0.5)",backgroundColor:"var(--gray-900)",padding:"0.25rem 0.5rem",borderRadius:"0.5rem",border:"0.5px solid var(--gray-600)"},children:"DEFEATED"})]}),e.jsx("div",{className:"border-b",style:{padding:"12px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative",zIndex:y?1:"auto",borderBottomColor:d?"var(--purple)":"var(--border)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",position:"relative",zIndex:y?1:"auto"},children:[e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.25rem",flex:"1 1 0%",minWidth:0},children:e.jsx("h4",{style:{...L.rowTitle,color:y?"color-mix(in srgb, var(--gray-400) 80%, transparent)":L.rowTitle.color},children:$()})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flex:"0 0 auto",minWidth:"fit-content"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.125rem",alignItems:"flex-end"},children:[e.jsx(K,{type:"adversaryHP",value:r.hp||0,maxValue:r.hpMax||1,onChange:b=>{const k=r.hp||0;b>k?o&&o(r.id,b-k,r.hp,r.hpMax):b<k&&c&&c(r.id,k-b,r.hp)},containerStyle:{cursor:"pointer",padding:"0.0625rem",borderRadius:"0.125rem",transition:"all 0.2s ease"},pipStyle:{fontSize:"0.75rem"},showTooltip:!1,enableBoundaryClick:!0}),r.stressMax>0&&e.jsx(K,{type:"adversaryStress",value:r.stress||0,maxValue:r.stressMax,onChange:b=>{const k=r.stress||0,T=b-k;l&&l(r.id,T,r.stress)},containerStyle:{cursor:"pointer",padding:"0.0625rem",borderRadius:"0.125rem",transition:"all 0.2s ease"},pipStyle:{fontSize:"0.75rem"},showTooltip:!1,enableBoundaryClick:!0})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem"},children:[r.type&&e.jsx("span",{style:{fontSize:"0.625rem",fontWeight:500,color:y?"color-mix(in srgb, var(--gray-400) 80%, transparent)":"var(--text-secondary)",letterSpacing:"0.5px",textAlign:"center",lineHeight:1},children:r.type}),r.difficulty&&e.jsxs("div",{onClick:f.handleDifficultyClick,style:{cursor:r.thresholds&&r.thresholds.major&&r.thresholds.severe||r.type==="Minion"?"pointer":"default",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},title:r.thresholds&&r.thresholds.major&&r.thresholds.severe?`Click to enter damage (thresholds: ${r.thresholds.major}/${r.thresholds.severe})`:r.type==="Minion"?"Click to enter damage (minion mechanics)":"",children:[e.jsx(J,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(30deg)"}}),e.jsx("span",{style:{position:"absolute",fontSize:"0.75rem",fontWeight:600,color:"white",pointerEvents:"none"},children:r.difficulty})]})]}),!1]})]})}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"12px",borderRadius:"0 0 8px 8px",position:"relative",zIndex:y?1:"auto"},children:[(r.tier||r.type)&&e.jsx("div",{style:{marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--border)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[r.tier&&e.jsxs("span",{style:{fontSize:"0.875rem",fontWeight:500,color:y?"color-mix(in srgb, var(--gray-400) 80%, transparent)":"var(--text-secondary)",letterSpacing:"0.5px",padding:"0.25rem 0.5rem",backgroundColor:"var(--gray-800)",borderRadius:"0.25rem",border:"1px solid var(--border)"},children:["Tier ",r.tier]}),r.type&&e.jsx("span",{style:{fontSize:"0.875rem",fontWeight:500,color:y?"color-mix(in srgb, var(--gray-400) 80%, transparent)":"var(--text-secondary)",letterSpacing:"0.5px",padding:"0.25rem 0.5rem",backgroundColor:"var(--gray-800)",borderRadius:"0.25rem",border:"1px solid var(--border)"},children:r.type})]})}),r.description&&e.jsxs("div",{style:{marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--border)"},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:"0 0 0.5rem 0"},children:"Description"}),m?e.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-secondary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"vertical",fontFamily:"inherit"},value:r.description,onChange:b=>{i&&i(r.id,{description:b.target.value})},placeholder:"Enter adversary description..."}):e.jsx("p",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",margin:0,whiteSpace:"pre-wrap"},children:r.description})]}),r.motives&&e.jsxs("div",{style:{marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--border)"},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:"0 0 0.5rem 0"},children:"Motives"}),m?e.jsx("textarea",{style:{width:"100%",minHeight:"80px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-secondary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"vertical",fontFamily:"inherit"},value:r.motives,onChange:b=>{i&&i(r.id,{motives:b.target.value})},placeholder:"Enter adversary motives..."}):e.jsx("p",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",margin:0,whiteSpace:"pre-wrap"},children:r.motives})]}),e.jsx("div",{style:{marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--border)"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",fontSize:"0.875rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[e.jsxs("span",{children:[e.jsx("strong",{children:"Difficulty:"})," ",r.difficulty]}),r.thresholds&&e.jsxs("span",{children:[e.jsx("strong",{children:"Thresholds:"})," ",r.thresholds.major,"/",r.thresholds.severe]}),e.jsxs("span",{children:[e.jsx("strong",{children:"HP:"})," ",r.hpMax]}),r.stressMax>0&&e.jsxs("span",{children:[e.jsx("strong",{children:"Stress:"})," ",r.stressMax]})]}),(r.atk!==void 0||r.weapon||r.damage)&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[r.atk!==void 0&&e.jsxs("span",{children:[e.jsx("strong",{children:"ATK:"})," ",r.atk>=0?"+":"",r.atk]}),r.weapon&&e.jsxs("span",{children:[e.jsxs("strong",{children:[r.weapon,":"]})," ",r.range||"Melee"]}),r.damage&&e.jsxs("span",{children:[e.jsx("strong",{children:"Damage:"})," ",r.damage]})]}),r.experience&&r.experience.length>0&&e.jsxs("div",{children:[e.jsx("strong",{children:"Experience:"})," ",r.experience.map(b=>typeof b=="string"?b:`${b.name} ${b.modifier>=0?"+":""}${b.modifier}`).join(", ")]})]})}),r.features&&r.features.length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[r.features.filter(b=>b.type==="Passive").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Passives"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:r.features.filter(b=>b.type==="Passive").map((b,k)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:b.name}),b.description&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:" - "}),e.jsx("span",{children:b.description})]})]},k))})]}),r.features.filter(b=>b.type==="Action").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Actions"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:r.features.filter(b=>b.type==="Action").map((b,k)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:b.name}),b.description&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:" - "}),e.jsx("span",{children:b.description})]})]},k))})]}),r.features.filter(b=>b.type==="Reaction").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Reactions"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:r.features.filter(b=>b.type==="Reaction").map((b,k)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:b.name}),b.description&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:" - "}),e.jsx("span",{children:b.description})]})]},k))})]})]})]}),F()]})},I=()=>{const y=a==="edit";return e.jsxs("div",{className:W(),style:{...N(!0),padding:0,minHeight:"400px",display:"flex",flexDirection:"column",position:"relative"},...s,...x,onClick:p,...a!=="expanded"&&{onMouseEnter:R,onMouseLeave:P},children:[e.jsx("div",{className:"border-b",style:{padding:"12px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.25rem"},children:[e.jsx("h2",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:0},children:r.name}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[r.tier&&e.jsxs("span",{style:{fontSize:"0.75rem",fontWeight:500,color:"var(--text-secondary)",letterSpacing:"0.5px"},children:["Tier ",r.tier]}),r.type&&e.jsx("span",{style:{fontSize:"0.75rem",fontWeight:500,color:"var(--text-secondary)",letterSpacing:"0.5px"},children:r.type})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[r.difficulty&&e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[e.jsx(J,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)"}}),e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",fontWeight:700,color:"white",pointerEvents:"none"},children:r.difficulty})]}),!1]})]})}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"12px",borderRadius:"0 0 8px 8px"},children:[r.description&&e.jsxs("div",{style:{marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--border)"},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:"0 0 0.5rem 0"},children:"Description"}),y?e.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-secondary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"vertical",fontFamily:"inherit"},value:r.description,onChange:m=>{i&&i(r.id,{description:m.target.value})},placeholder:"Enter environment description..."}):e.jsx("p",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",margin:0,whiteSpace:"pre-wrap"},children:r.description})]}),r.impulses&&e.jsxs("div",{style:{marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--border)"},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:"0 0 0.5rem 0"},children:"Impulses"}),e.jsx("p",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",margin:0,whiteSpace:"pre-wrap"},children:r.impulses})]}),e.jsxs("div",{style:{marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--border)"},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:"0 0 0.5rem 0"},children:"Core Stats"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",fontSize:"0.875rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[e.jsxs("span",{children:[e.jsx("strong",{children:"Difficulty:"})," ",r.difficulty||"~"]}),e.jsxs("span",{children:[e.jsx("strong",{children:"Type:"})," ",r.type]}),e.jsxs("span",{children:[e.jsx("strong",{children:"Tier:"})," ",r.tier]})]}),r.potentialAdversaries&&r.potentialAdversaries.length>0&&e.jsxs("div",{children:[e.jsx("strong",{children:"Potential Adversaries:"}),e.jsx("div",{style:{marginTop:"0.25rem",display:"flex",flexDirection:"column",gap:"0.125rem"},children:r.potentialAdversaries.map((m,b)=>e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",marginLeft:"0.5rem"},children:["• ",m]},b))})]})]})]}),r.features&&r.features.length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[r.features.filter(m=>m.type==="Passive").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Passives"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:r.features.filter(m=>m.type==="Passive").map((m,b)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("div",{style:{fontWeight:600,color:"white",marginBottom:"0.25rem"},children:m.name}),e.jsx("div",{style:{marginBottom:"0.25rem"},children:m.description}),m.details&&m.details.length>0&&e.jsxs("div",{style:{marginLeft:"0.5rem"},children:[e.jsx("strong",{children:"Details:"}),e.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:m.details.map((k,T)=>e.jsx("li",{children:k},T))})]}),m.prompts&&m.prompts.length>0&&e.jsxs("div",{style:{marginLeft:"0.5rem"},children:[e.jsx("strong",{children:"Prompts:"}),e.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:m.prompts.map((k,T)=>e.jsxs("li",{style:{fontStyle:"italic"},children:['"',k,'"']},T))})]})]},b))})]}),r.features.filter(m=>m.type==="Action").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Actions"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:r.features.filter(m=>m.type==="Action").map((m,b)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("div",{style:{fontWeight:600,color:"white",marginBottom:"0.25rem"},children:m.name}),e.jsx("div",{style:{marginBottom:"0.25rem"},children:m.description}),m.details&&m.details.length>0&&e.jsxs("div",{style:{marginLeft:"0.5rem"},children:[e.jsx("strong",{children:"Details:"}),e.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:m.details.map((k,T)=>e.jsx("li",{children:k},T))})]}),m.prompts&&m.prompts.length>0&&e.jsxs("div",{style:{marginLeft:"0.5rem"},children:[e.jsx("strong",{children:"Prompts:"}),e.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:m.prompts.map((k,T)=>e.jsxs("li",{style:{fontStyle:"italic"},children:['"',k,'"']},T))})]})]},b))})]}),r.features.filter(m=>m.type==="Reaction").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Reactions"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:r.features.filter(m=>m.type==="Reaction").map((m,b)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("div",{style:{fontWeight:600,color:"white",marginBottom:"0.25rem"},children:m.name}),e.jsx("div",{style:{marginBottom:"0.25rem"},children:m.description}),m.details&&m.details.length>0&&e.jsxs("div",{style:{marginLeft:"0.5rem"},children:[e.jsx("strong",{children:"Details:"}),e.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:m.details.map((k,T)=>e.jsx("li",{children:k},T))})]}),m.prompts&&m.prompts.length>0&&e.jsxs("div",{style:{marginLeft:"0.5rem"},children:[e.jsx("strong",{children:"Prompts:"}),e.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:m.prompts.map((k,T)=>e.jsxs("li",{style:{fontStyle:"italic"},children:['"',k,'"']},T))})]})]},b))})]})]})]})]})};if((a==="expanded"||a==="edit")&&(t==="adversary"||t==="adversaries"))return j();if((a==="expanded"||a==="edit")&&(t==="environment"||t==="environments"))return I();if(a!=="compact"&&!(t==="adversary"||t==="adversaries"||t==="environment"||t==="environments"))return e.jsxs("div",{className:W(),style:N(!0),children:[e.jsxs("div",{style:L.rowMain,children:[e.jsx("h4",{style:L.rowTitle,children:$()}),e.jsx("div",{style:L.rowMeta,children:z()})]}),e.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"12px",margin:0},children:["Expanded view coming soon for ",t]})]});if(t==="adversary"||t==="adversaries"){const y=(r.hp||0)>=(r.hpMax||1);return e.jsxs("div",{className:W(),style:{...N(),opacity:y?.7:1,backgroundColor:y?"var(--gray-900)":N().backgroundColor,borderColor:y?"color-mix(in srgb, var(--gray-600) 40%, transparent)":d?"var(--purple)":S&&a!=="expanded"?"var(--border-hover)":"var(--border)",paddingLeft:"0.75rem",position:"relative"},onClick:p,...a!=="expanded"&&{onMouseEnter:R,onMouseLeave:P},...s,...x,children:[y&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                45deg,
                transparent,
                transparent 8px,
                var(--gray-600) 1px,
                var(--gray-600) 9px
              )`,pointerEvents:"none",zIndex:9999}}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"var(--text-secondary)",fontSize:"1rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em",zIndex:1e4,pointerEvents:"none",textShadow:"1px 1px 2px rgba(0, 0, 0, 0.5)",backgroundColor:"var(--gray-900)",padding:"0.25rem 0.5rem",borderRadius:"0.5rem",border:"0.5px solid var(--gray-600)"},children:"DEFEATED"})]}),!1,e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",position:"relative",zIndex:y?1:"auto"},children:[e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.25rem",flex:"1 1 0%",minWidth:0},children:e.jsx("h4",{style:{...L.rowTitle,color:y?"color-mix(in srgb, var(--gray-400) 80%, transparent)":L.rowTitle.color},children:$()})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flex:"0 0 auto",minWidth:"fit-content"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.125rem",alignItems:"flex-end"},children:[e.jsx(K,{type:"adversaryHP",value:r.hp||0,maxValue:r.hpMax||1,onChange:m=>{const b=r.hp||0;m>b?o&&o(r.id,m-b,r.hp,r.hpMax):m<b&&c&&c(r.id,b-m,r.hp)},containerStyle:{cursor:"pointer",padding:"0.0625rem",borderRadius:"0.125rem",transition:"all 0.2s ease"},pipStyle:{fontSize:"0.75rem"},showTooltip:!1,enableBoundaryClick:!0}),r.stressMax>0&&e.jsx(K,{type:"adversaryStress",value:r.stress||0,maxValue:r.stressMax,onChange:m=>{const b=r.stress||0,k=m-b;l&&l(r.id,k,r.stress)},containerStyle:{cursor:"pointer",padding:"0.0625rem",borderRadius:"0.125rem",transition:"all 0.2s ease"},pipStyle:{fontSize:"0.75rem"},showTooltip:!1,enableBoundaryClick:!0})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem"},children:[r.type&&e.jsx("span",{style:{fontSize:"0.625rem",fontWeight:500,color:y?"color-mix(in srgb, var(--gray-400) 80%, transparent)":"var(--text-secondary)",letterSpacing:"0.5px",textAlign:"center",lineHeight:1},children:r.type}),r.difficulty&&e.jsxs("div",{onClick:f.handleDifficultyClick,style:{cursor:r.thresholds&&r.thresholds.major&&r.thresholds.severe||r.type==="Minion"?"pointer":"default",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},title:r.thresholds&&r.thresholds.major&&r.thresholds.severe?`Click to enter damage (thresholds: ${r.thresholds.major}/${r.thresholds.severe})`:r.type==="Minion"?"Click to enter damage (minion mechanics)":"",children:[e.jsx(J,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(30deg)"}}),e.jsx("span",{style:{position:"absolute",fontSize:"0.75rem",fontWeight:600,color:"white",pointerEvents:"none"},children:r.difficulty})]})]}),console.log("Delete button check:",{onDelete:!!n,isEditMode:C,shouldShow:n&&C}),n&&C&&e.jsx("button",{className:"border rounded-md",style:{background:"var(--red)",borderColor:"var(--red)",padding:"0.25rem",minWidth:"1.5rem",height:"1.5rem",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.1s ease",color:"white",fontSize:"1rem"},onClick:m=>{m.stopPropagation(),m.preventDefault(),n&&n(r.id)},onMouseEnter:m=>m.target.style.background="var(--red-dark)",onMouseLeave:m=>m.target.style.background="var(--red)",title:"Delete item",children:"×"})]})]}),F()]})}return t==="environment"||t==="environments"?e.jsxs("div",{className:W(),style:{...N(),paddingLeft:"0.75rem",position:"relative"},onClick:p,...a!=="expanded"&&{onMouseEnter:R,onMouseLeave:P},...s,...x,children:[!1,e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"0.5rem",position:"relative"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.25rem"},children:[e.jsx("h4",{style:L.rowTitle,children:$()}),r.type&&e.jsx("span",{style:{fontSize:"0.75rem",fontWeight:500,color:"var(--text-secondary)",letterSpacing:"0.5px"},children:r.type})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[r.difficulty&&e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[e.jsx(J,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)"}}),e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",fontWeight:700,color:"white",pointerEvents:"none"},children:r.difficulty})]}),r.type&&e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.125rem"},children:e.jsx("span",{style:{fontSize:"0.625rem",fontWeight:500,color:isDead?"color-mix(in srgb, var(--gray-400) 80%, transparent)":"var(--text-secondary)",letterSpacing:"0.5px",textAlign:"center",lineHeight:1},children:r.type})}),console.log("Delete button check:",{onDelete:!!n,isEditMode:C,shouldShow:n&&C}),n&&C&&e.jsx("button",{className:"border rounded-md",style:{background:"var(--red)",borderColor:"var(--red)",padding:"0.25rem",minWidth:"1.5rem",height:"1.5rem",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.1s ease",color:"white",fontSize:"1rem"},onClick:y=>{y.stopPropagation(),y.preventDefault(),n&&n(r.id)},onMouseEnter:y=>y.target.style.background="var(--red-dark)",onMouseLeave:y=>y.target.style.background="var(--red)",title:"Delete environment",children:"×"})]})]})]}):e.jsxs("div",{className:W(),style:N(),onClick:p,onMouseEnter:()=>D(!0),onMouseLeave:()=>D(!1),...s,...x,children:[e.jsxs("div",{style:L.rowMain,children:[e.jsx("h4",{style:L.rowTitle,children:$()}),e.jsx("div",{style:L.rowMeta,children:z()})]}),E(),e.jsxs("div",{style:L.cardActions,children:[e.jsx("div",{style:L.controlButtons,children:_()}),e.jsx("div",{style:{display:"flex",alignItems:"center"},children:!1})]}),F()]})},be=w.createContext();function ne(r){if(typeof localStorage>"u")return null;try{const t=localStorage.getItem(r);return t==null?null:JSON.parse(t)}catch{return null}}function je(r,t){if(!(typeof localStorage>"u"))try{localStorage.setItem(r,JSON.stringify(t))}catch{}}const we=({children:r})=>{const[t,a]=w.useState({fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[]});w.useEffect(()=>{var O,V,_;const A=ne("daggerheart-game-state");if(A)try{(((O=A.adversaries)==null?void 0:O.length)>0||((V=A.environments)==null?void 0:V.length)>0||((_=A.countdowns)==null?void 0:_.length)>0)&&a(A)}catch(E){console.error("Failed to load saved state:",E)}},[]),w.useEffect(()=>{je("daggerheart-game-state",t)},[t]);const p=A=>{a(O=>({...O,fear:{...O.fear,value:A}}))},n=()=>{a(A=>({...A,fear:{...A.fear,visible:!A.fear.visible}}))},o=w.useRef(t);w.useEffect(()=>{o.current=t},[t]);const c=()=>o.current,l=Ve(a),i=$e(c,a),g=_e(c,a),{createCountdown:u,updateCountdown:s,deleteCountdown:x,advanceCountdown:v,incrementCountdown:d,decrementCountdown:C,reorderCountdowns:f}=l,{createAdversary:M,updateAdversary:S,deleteAdversary:D,reorderAdversaries:R}=i,{createEnvironment:P,updateEnvironment:N,deleteEnvironment:W,reorderEnvironments:$}=g,z={gameState:t,updateFear:p,toggleFearVisibility:n,createCountdown:u,updateCountdown:s,deleteCountdown:x,advanceCountdown:v,incrementCountdown:d,decrementCountdown:C,reorderCountdowns:f,createAdversary:M,updateAdversary:S,deleteAdversary:D,reorderAdversaries:R,createEnvironment:P,updateEnvironment:N,deleteEnvironment:W,reorderEnvironments:$};return e.jsx(be.Provider,{value:z,children:r})},Ce=()=>{const r=w.useContext(be);if(!r)return console.warn("useGameState: Context not available yet, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],updateFear:()=>{},toggleFearVisibility:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{gameState:t,...a}=r;if(!t)return console.warn("useGameState: gameState not available, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],updateFear:()=>{},toggleFearVisibility:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{fear:p,countdowns:n,adversaries:o,environments:c}=t;return{gameState:t,fear:p,countdowns:n,adversaries:o,environments:c,...a,hasCountdowns:n.length>0,hasAdversaries:o.length>0,hasEnvironments:c.length>0,getCountdownById:l=>n.find(i=>i.id===l),getAdversaryById:l=>o.find(i=>i.id===l),getEnvironmentById:l=>c.find(i=>i.id===l)}},Ue=(r,t)=>{const[a,p]=w.useState(()=>{const n=ne(r);return n??t});return w.useEffect(()=>{const n=ne(r);p(n??t)},[r]),w.useEffect(()=>{je(r,a)},[r,a]),[a,p]},Je="/Daggerheart/assets/daggerheart-logo-fe7815ad.svg",Qe=()=>{const[r,t]=w.useState(!1),[a,p]=w.useState(!1);return w.useEffect(()=>{const n=o=>{o.target.closest(".help-button")||t(!1)};return document.addEventListener("click",n),()=>document.removeEventListener("click",n)},[]),w.useEffect(()=>{const n=window.matchMedia("(max-width: 800px)"),o=c=>p(c.matches);return p(n.matches),n.addEventListener("change",o),()=>n.removeEventListener("change",o)},[]),e.jsxs("div",{className:"help-button",style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",padding:"0.5rem",color:"var(--text-primary)",borderRadius:"var(--radius-md)",cursor:"pointer",transition:"background-color 0.2s ease",minWidth:"44px",minHeight:"44px",backgroundColor:r?"var(--purple)":"transparent"},onMouseEnter:n=>{r||(n.target.style.backgroundColor="var(--gray-dark)")},onMouseLeave:n=>{r||(n.target.style.backgroundColor="transparent")},onClick:n=>{n.stopPropagation(),t(!r)},title:"Help & Info",children:[e.jsx("div",{style:{width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center",color:"inherit"},children:e.jsx(Ae,{size:20})}),e.jsxs("div",{style:{position:"absolute",bottom:"100%",left:a?"auto":"50%",right:a?"0":"auto",transform:a?"none":"translateX(-50%)",background:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,opacity:r?1:0,visibility:r?"visible":"hidden",transition:"opacity 0.2s ease, visibility 0.2s ease, transform 0.2s ease",pointerEvents:r?"auto":"none",minWidth:"280px",maxWidth:a?"calc(100vw - 2rem)":"320px",marginBottom:a?"0.5rem":"0"},children:[e.jsxs("div",{style:{padding:"0.75rem",borderTop:"1px solid rgba(255, 255, 255, 0.1)",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",background:"var(--bg-primary)",maxWidth:"280px"},children:[e.jsx("img",{src:Je,alt:"Daggerheart Community Content Logo",style:{width:"100%",maxWidth:"200px",height:"auto",margin:"0 auto 0.75rem auto",display:"block"},onError:n=>{console.error("Failed to load Daggerheart logo:",n.target.src),n.target.style.display="none";const o=document.createElement("div");o.style.cssText="text-align: center; margin-bottom: 0.75rem; font-size: 1.5rem; font-weight: bold; color: var(--purple);",o.textContent="⚔️ DAGGERHEART ⚔️",n.target.parentNode.insertBefore(o,n.target)},onLoad:()=>{}}),e.jsxs("div",{style:{fontSize:"0.7rem",lineHeight:1.3,color:"var(--text-secondary)",textAlign:"left",wordWrap:"break-word",overflowWrap:"break-word"},children:[e.jsx("p",{children:"This product includes materials from the Daggerheart System Reference Document 1.0, © Critical Role, LLC, under the terms of the Darrington Press Community Gaming (DPCGL) License."}),e.jsxs("p",{children:["More information can be found at ",e.jsx("a",{href:"https://www.daggerheart.com",target:"_blank",rel:"noopener noreferrer",children:"daggerheart.com"})]}),e.jsx("p",{children:e.jsx("em",{children:"This project is unofficial and not endorsed by Darrington Press or Critical Role."})})]})]}),e.jsx("button",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"0.25rem 1rem",color:"var(--text-primary)",border:"none",background:"none",width:"100%",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"0.875rem",minHeight:"32px",borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},onMouseEnter:n=>{n.target.style.backgroundColor="var(--gray-dark)"},onMouseLeave:n=>{n.target.style.backgroundColor="transparent"},onClick:n=>{n.stopPropagation(),t(!1),window.open("https://github.com/Splinter714/Daggerheart","_blank")},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.25rem"},children:e.jsx("span",{children:"GitHub"})})}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"0.25rem 1rem",color:"var(--text-secondary)",border:"none",background:"none",width:"100%",textAlign:"left",cursor:"default",fontSize:"0.875rem",minHeight:"32px"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.25rem"},children:e.jsxs("span",{children:["Version ","0.2.4 (d153f3d)"]})})})]})]})},Ze=({adversaries:r,environments:t,countdowns:a,deleteAdversary:p,deleteEnvironment:n,deleteCountdown:o})=>{const[c,l]=w.useState(!1);w.useEffect(()=>{const d=C=>{C.target.closest(".delete-clear-container")||l(!1)};return document.addEventListener("click",d),()=>document.removeEventListener("click",d)},[]);const i=((r==null?void 0:r.length)||0)>0||((t==null?void 0:t.length)||0)>0||((a==null?void 0:a.length)||0)>0,g=(r||[]).some(d=>(d.hp||0)>=(d.hpMax||1)),u={position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",padding:"0.5rem",minWidth:"200px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,display:c?"block":"none"},s={background:"none",border:"none",color:i?"var(--text-primary)":"var(--text-secondary)",cursor:i?"pointer":"not-allowed",padding:"0.5rem",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s",opacity:i?1:.5},x={background:"none",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:"0.5rem",borderRadius:"var(--radius-sm)",width:"100%",textAlign:"left",display:"flex",alignItems:"center",gap:"0.5rem",transition:"background-color 0.2s"},v={backgroundColor:"var(--bg-hover)"};return e.jsxs("div",{className:"delete-clear-container",style:{position:"relative"},children:[e.jsx("button",{style:s,onClick:d=>{d.stopPropagation(),i&&l(!c)},title:i?"Clear Items":"Nothing to clear",children:e.jsx(Te,{size:20})}),e.jsxs("div",{style:u,children:[r&&r.length>0&&e.jsxs("button",{style:x,onMouseEnter:d=>Object.assign(d.target.style,v),onMouseLeave:d=>Object.assign(d.target.style,x),onClick:d=>{d.stopPropagation(),l(!1),r.forEach(C=>p(C.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Adversaries"})]}),r&&r.length>0&&g&&e.jsxs("button",{style:x,onMouseEnter:d=>Object.assign(d.target.style,v),onMouseLeave:d=>Object.assign(d.target.style,x),onClick:d=>{d.stopPropagation(),l(!1),r.filter(f=>(f.hp||0)>=(f.hpMax||1)).forEach(f=>p(f.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"Dead Adversaries"})]}),t&&t.length>0&&e.jsxs("button",{style:x,onMouseEnter:d=>Object.assign(d.target.style,v),onMouseLeave:d=>Object.assign(d.target.style,x),onClick:d=>{d.stopPropagation(),l(!1),t.forEach(C=>n(C.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Environments"})]}),a&&a.length>0&&e.jsxs("button",{style:x,onMouseEnter:d=>Object.assign(d.target.style,v),onMouseLeave:d=>Object.assign(d.target.style,x),onClick:d=>{d.stopPropagation(),l(!1),a.forEach(C=>o(C.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Countdowns"})]})]})]})},er=({isEditMode:r,setIsEditMode:t,style:a={}})=>{const p={backgroundColor:r?"var(--purple)":"transparent",border:r?"1px solid var(--purple)":"1px solid transparent",borderRadius:"var(--radius-md)",padding:"0.75rem",cursor:"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",color:r?"#fff":"var(--text-primary)",fontSize:"0.875rem",fontWeight:600,minWidth:"40px",...a},n=()=>{t(!r)};return e.jsx("button",{style:p,onClick:n,title:r?"Exit Edit Mode":"Enter Edit Mode",onMouseEnter:o=>{r||(o.target.style.backgroundColor="var(--bg-secondary)",o.target.style.borderColor="var(--border)")},onMouseLeave:o=>{r||(o.target.style.backgroundColor="transparent",o.target.style.borderColor="transparent")},children:e.jsx(Be,{size:16})})},pe=({position:r="top",children:t,onClick:a,className:p="",style:n={}})=>{const o=r==="top",c={background:"var(--bg-primary)",borderTop:o?"none":"1px solid var(--border)",borderBottom:o?"1px solid var(--border)":"none",padding:o?"0.25rem 0":"0.5rem",position:"sticky",[o?"top":"bottom"]:0,zIndex:o?10:100,order:o?1:3,flexShrink:0,touchAction:"manipulation",userSelect:"none",display:"flex",flexDirection:o?"column":"row",justifyContent:o?"stretch":"center",alignItems:o?"stretch":"center",height:o?"auto":"100%",...n};return e.jsx("div",{className:p,style:c,onClick:a,children:t})},ue=({side:r="left",children:t,className:a="",style:p={}})=>{const n=r==="left",o={flex:1,minWidth:0,background:"var(--bg-primary)",overflowY:"auto",overflowX:n?"auto":"hidden",display:n?"block":"flex",flexDirection:n?"initial":"column",height:"100%",padding:n?"1rem 0.5rem 1rem 1rem":"1rem 1rem 1rem 0.5rem",...p};return e.jsx("div",{className:a,style:o,children:t})},rr=({items:r,onDelete:t,onEdit:a,onToggleVisibility:p,onReorder:n,onItemSelect:o,selectedItem:c,selectedType:l,onApplyDamage:i,onApplyHealing:g,onApplyStressChange:u,onIncrement:s,onDecrement:x,isEditMode:v,elementType:d,adversaries:C=[]})=>{if(!r||r.length===0)return null;const f=M=>{const S=c&&c.id===M.id&&l===d;console.log("Card selection check:",{itemId:M.id,selectedItemId:c==null?void 0:c.id,selectedType:l,elementType:d,isSelected:S});const D={item:M,mode:"compact",onClick:()=>o(M,d),onDelete:t,dragAttributes:v?{draggable:!0}:null,dragListeners:v?{onDragStart:R=>{R.dataTransfer.setData("text/plain",M.id)}}:null,adversaries:C,isSelected:S,isEditMode:v};switch(d){case"adversaries":return e.jsx(G,{...D,type:"adversary",onApplyDamage:i,onApplyHealing:g,onApplyStressChange:u},M.id);case"environments":return e.jsx(G,{...D,type:"environment",onEdit:a},M.id);case"countdowns":return e.jsx(G,{...D,type:"countdown",onIncrement:s,onDecrement:x},M.id);default:return null}};return e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:r.map(f)})},tr=({onItemSelect:r,selectedItem:t,selectedType:a,onOpenDatabase:p,isEditMode:n,showLongTermCountdowns:o,fear:c,updateFear:l,handleRollOutcome:i,handleActionRoll:g,setShowLongTermCountdowns:u,lastAddedItemType:s})=>{console.log("GameBoard received props:",{selectedItem:t,selectedType:a});const{adversaries:x,environments:v,updateAdversary:d,deleteAdversary:C,reorderAdversaries:f,updateEnvironment:M,deleteEnvironment:S,reorderEnvironments:D,countdowns:R,createCountdown:P,deleteCountdown:N,reorderCountdowns:W,incrementCountdown:$,decrementCountdown:z}=Ce();w.useState({adversary:!1,environment:!1,campaign:!1});const[A,O]=Ue("sectionVisibility",{countdowns:!1,environments:!1,adversaries:!1});w.useEffect(()=>{s&&(s==="environment"?O(E=>({...E,environments:!0})):s==="adversary"?O(E=>({...E,adversaries:!0})):s==="countdown"&&O(E=>({...E,countdowns:!0})))},[s,O]);const V=(E,F)=>{},_=(E,F)=>{F==="environment"?S(E):F==="adversary"?C(E):F==="countdown"&&N(E),t&&t.id===E&&r(null,null)};return e.jsx("div",{style:{flex:1,overflowY:"auto"},children:e.jsxs("div",{style:{marginBottom:"0.75rem"},children:[e.jsx(rr,{items:x,onDelete:E=>_(E,"adversary"),onEdit:E=>V(),onToggleVisibility:E=>{const F=x.find(j=>j.id===E);F&&d(E,{isVisible:!F.isVisible})},onReorder:f,onItemSelect:r,selectedItem:t,selectedType:a,onApplyDamage:(E,F,j,I)=>{const h=Math.min(I,j+F);d(E,{hp:h})},onApplyHealing:(E,F,j)=>{if(x.find(h=>h.id===E)){const h=Math.max(0,j-F);d(E,{hp:h})}},onApplyStressChange:(E,F)=>{const j=x.find(I=>I.id===E);if(j){let I=j.stress+F,h=j.hp||0;if(I>j.stressMax){const y=I-j.stressMax;I=j.stressMax,h=Math.min(j.hpMax,h+y)}else I<0&&(I=0);d(E,{stress:I,hp:h})}},isEditMode:n,elementType:"adversaries",adversaries:x}),e.jsx("div",{className:"border rounded-lg",style:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"12px",marginTop:"0.5rem",cursor:"pointer",transition:"all 0.1s ease",position:"relative",border:"2px dashed var(--border)",opacity:.8,background:"var(--bg-card)"},onClick:()=>p("adversaries"),onMouseEnter:E=>{E.target.style.opacity="1",E.target.style.borderColor="var(--border-hover)"},onMouseLeave:E=>{E.target.style.opacity="0.8",E.target.style.borderColor="var(--border)"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"0.5rem",position:"relative"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.25rem"},children:[e.jsx("h4",{style:{fontSize:"16px",fontWeight:"600",color:"var(--text-secondary)",margin:0},children:"Add Adversary"}),e.jsx("span",{style:{fontSize:"0.75rem",fontWeight:500,color:"var(--text-secondary)",letterSpacing:"0.5px"},children:"Click to browse"})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",borderRadius:"50%",border:"1px dashed var(--text-secondary)",color:"var(--text-secondary)"},children:e.jsx(re,{size:16})})]})})]})})};function nr({headerSelector:r=".drawer-header",closeThreshold:t=100,snapThreshold:a=30,onClose:p}={}){const[n,o]=w.useState(null),[c,l]=w.useState(null),[i,g]=w.useState(0),[u,s]=w.useState(!1),x=w.useCallback(f=>{var R,P;const M=f.target;if(!(r?M.closest(r):!1))return;const D=((P=(R=f.targetTouches)==null?void 0:R[0])==null?void 0:P.clientY)??0;o(D),l(D),g(0),s(!1)},[r]),v=w.useCallback(f=>{var R,P;if(n==null)return;const M=((P=(R=f.targetTouches)==null?void 0:R[0])==null?void 0:P.clientY)??0,S=M-n,D=6;!u&&Math.abs(S)>D&&s(!0),u&&(f.preventDefault(),f.stopPropagation(),l(M),g(Math.max(0,S)))},[n,u]),d=w.useCallback(f=>{if(n==null||c==null)return;const M=c-n;u?(f.preventDefault(),f.stopPropagation(),M>t?(g(window.innerHeight),typeof p=="function"&&setTimeout(()=>p(),300)):M>a?(g(0),setTimeout(()=>{o(null),l(null),s(!1)},50)):(g(0),o(null),l(null),s(!1))):(g(0),o(null),l(null),s(!1))},[n,c,u,t,a,p]),C=w.useCallback(()=>{g(0),o(null),l(null)},[]);return{drawerOffset:i,setDrawerOffset:g,touchHandlers:{onTouchStart:x,onTouchMove:v,onTouchEnd:d},resetSwipeState:C}}const sr=({isOpen:r,onClose:t,children:a})=>{const{drawerOffset:p,setDrawerOffset:n,touchHandlers:o,resetSwipeState:c}=nr({headerSelector:".drawer-header",closeThreshold:100,snapThreshold:30,onClose:t});return w.useEffect(()=>{r||c()},[r,c]),e.jsxs("div",{className:`mobile-drawer ${r?"open":""}`,children:[e.jsx("div",{className:"drawer-backdrop",onClick:t}),e.jsxs("div",{className:"drawer-content",style:{transform:r?`translateY(${p}px)`:"translateY(100%)",transition:p?"none":"transform 0.25s cubic-bezier(0.4, 0.0, 0.2, 1)"},onTouchStart:l=>{o.onTouchStart(l)},onTouchMove:l=>{o.onTouchMove(l)},onTouchEnd:l=>{o.onTouchEnd(l)},onClick:l=>{l.stopPropagation()},children:[e.jsx("div",{className:"drawer-header",onClick:()=>{n(window.innerHeight),setTimeout(()=>{t()},300)},children:e.jsx("div",{className:"drawer-handle"})}),e.jsx("div",{className:"drawer-body",children:a})]})]})},or=()=>e.jsx("div",{className:"pwa-install-prompt",style:{}}),ar="modulepreload",ir=function(r){return"/Daggerheart/"+r},he={},xe=function(t,a,p){if(!a||a.length===0)return t();const n=document.getElementsByTagName("link");return Promise.all(a.map(o=>{if(o=ir(o),o in he)return;he[o]=!0;const c=o.endsWith(".css"),l=c?'[rel="stylesheet"]':"";if(!!p)for(let u=n.length-1;u>=0;u--){const s=n[u];if(s.href===o&&(!c||s.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${l}`))return;const g=document.createElement("link");if(g.rel=c?"stylesheet":ar,c||(g.as="script",g.crossOrigin=""),g.href=o,document.head.appendChild(g),c)return new Promise((u,s)=>{g.addEventListener("load",u),g.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>t()).catch(o=>{const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=o,window.dispatchEvent(c),!c.defaultPrevented)throw o})};let Se={adversaries:[]},ke={environments:[]};const lr=async()=>{try{const r=await xe(()=>import("./adversaries-e62ea4d8.js"),[]);Se=(r==null?void 0:r.default)||r}catch(r){console.warn("Failed to load adversaries.json:",r)}try{const r=await xe(()=>import("./environments-5ca1c1e1.js"),[]);ke=(r==null?void 0:r.default)||r}catch(r){console.warn("Failed to load environments.json:",r)}},dr=r=>{const[t,a]=w.useState(""),[p,n]=w.useState([{field:"name",direction:"asc"}]),[o,c]=w.useState(null),[l,i]=w.useState([]),[g,u]=w.useState(!0),[s,x]=w.useState([]),[v,d]=w.useState([]),[C,f]=w.useState(!1),[M,S]=w.useState(!1),D=w.useRef(null),R=w.useRef(null);w.useEffect(()=>{(async()=>{await lr(),u(!1);let I=[];r==="adversary"?I=Se.adversaries||[]:r==="environment"&&(I=ke.environments||[]),i(I)})()},[r]);const P=j=>{const I=l.map(h=>h[j]).filter(Boolean);return[...new Set(I)].sort((h,y)=>typeof h=="number"&&typeof y=="number"?h-y:String(h).localeCompare(String(y)))},N=P("tier"),W=P("type"),$=w.useMemo(()=>{let j=l.filter(I=>{var b,k;const h=I.name.toLowerCase().includes(t.toLowerCase())||((b=I.type)==null?void 0:b.toLowerCase().includes(t.toLowerCase()))||((k=I.description)==null?void 0:k.toLowerCase().includes(t.toLowerCase())),y=s.length===0||s.includes(I.tier.toString()),m=v.length===0||v.includes(I.type);return h&&y&&m});return j.sort((I,h)=>{for(const y of p){const{field:m,direction:b}=y;let k=I[m],T=h[m];if(m==="tier")k=parseInt(k)||0,T=parseInt(T)||0;else if(m==="difficulty"){const X=parseInt(k),B=parseInt(T);!isNaN(X)&&!isNaN(B)?(k=X,T=B):!isNaN(X)&&isNaN(B)?(k=X,T=999):isNaN(X)&&!isNaN(B)?(k=999,T=B):(k=String(k||"").toLowerCase(),T=String(T||"").toLowerCase())}else typeof k=="string"&&typeof T=="string"?(k=k.toLowerCase(),T=T.toLowerCase()):(k=String(k||"").toLowerCase(),T=String(T||"").toLowerCase());if(b==="asc"){if(k>T)return 1;if(k<T)return-1}else{if(k<T)return 1;if(k>T)return-1}}return 0}),j},[l,t,p,s,v]),z=j=>{n(I=>{const h=I.findIndex(y=>y.field===j);if(h>=0)if(h===0){const y=[...I];return y[0]={...y[0],direction:y[0].direction==="asc"?"desc":"asc"},y}else{const y=[...I];return y.splice(h,1)[0],[{field:j,direction:"asc"},...y]}else return[{field:j,direction:"asc"},...I]})},A=j=>{c(o===j?null:j)},O=j=>{x(j==="clear"?[]:I=>I.includes(j)?I.filter(h=>h!==j):[...I,j])},V=j=>{d(j==="clear"?[]:I=>I.includes(j)?I.filter(h=>h!==j):[...I,j])},_=s.length>0,E=v.length>0;return w.useEffect(()=>{const j=h=>{const y=h.target.closest(".filter-dropdown"),m=h.target.closest(".header-filter-icon");y||m||(f(!1),S(!1))},I=h=>{h.key==="Escape"&&(f(!1),S(!1))};return document.addEventListener("pointerdown",j,!0),document.addEventListener("mousedown",j,!0),document.addEventListener("touchstart",j,!0),document.addEventListener("click",j,!0),document.addEventListener("keydown",I,!0),()=>{document.removeEventListener("pointerdown",j,!0),document.removeEventListener("mousedown",j,!0),document.removeEventListener("touchstart",j,!0),document.removeEventListener("click",j,!0),document.removeEventListener("keydown",I,!0)}},[f,S]),{searchTerm:t,setSearchTerm:a,sortFields:p,handleSort:z,expandedCard:o,toggleExpanded:A,filteredAndSortedData:$,loading:g,selectedTiers:s,selectedTypes:v,showTierDropdown:C,setShowTierDropdown:f,showTypeDropdown:M,setShowTypeDropdown:S,tierFilterRef:D,typeFilterRef:R,uniqueTiers:N,uniqueTypes:W,handleTierSelect:O,handleTypeSelect:V,isTierFiltered:_,isTypeFiltered:E,getDropdownStyle:j=>{if(!j.current)return{};const I=j.current.getBoundingClientRect();return{position:"fixed",top:I.bottom+4,left:I.left,zIndex:99999}}}},cr=({searchTerm:r,onSearchChange:t,type:a})=>e.jsx("div",{style:H.browserHeader,children:e.jsx("input",{type:"text",placeholder:"Search",value:r,onChange:p=>t(p.target.value),style:H.searchInput})}),pr=({sortFields:r,onSort:t,type:a,uniqueTiers:p,uniqueTypes:n,selectedTiers:o,selectedTypes:c,showTierDropdown:l,setShowTierDropdown:i,showTypeDropdown:g,setShowTypeDropdown:u,tierFilterRef:s,typeFilterRef:x,handleTierSelect:v,handleTypeSelect:d,isTierFiltered:C,isTypeFiltered:f,getDropdownStyle:M})=>{const[S,D]=w.useState(null),P=(()=>a==="adversary"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:a==="environment"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:[])(),N=(W,$,z,A,O,V,_,E)=>{if(!O)return null;const F=()=>{(W==="tier"||W==="type")&&A("clear")};return fe.createPortal(e.jsxs("div",{className:"filter-dropdown",style:{...H.filterDropdown,...M(_),maxHeight:"60vh",overflow:"auto"},onMouseDown:j=>j.stopPropagation(),onClick:j=>j.stopPropagation(),children:[e.jsxs("div",{style:{...H.filterOption,...z.length===0?H.filterOptionSelected:{}},onClick:F,children:[e.jsx("span",{style:H.checkIcon,children:z.length===0?e.jsx(ie,{size:16}):e.jsx(le,{size:16})}),e.jsx("span",{style:H.filterLabel,children:"All"})]}),$.map(j=>{const I=z.includes(j.toString());return e.jsxs("div",{style:{...H.filterOption,...I?H.filterOptionSelected:{}},onClick:()=>A(j.toString()),children:[e.jsx("span",{style:H.checkIcon,children:I?e.jsx(ie,{size:16}):e.jsx(le,{size:16})}),e.jsx("span",{style:H.filterLabel,children:j})]},j)})]}),document.body)};return e.jsx("tr",{style:H.tableHeader,children:P.map(W=>e.jsxs("th",{style:{...H.tableHeaderCell,...S===W.key?H.tableHeaderCellHover:{},position:"relative",...W.key==="name"?{width:"auto",minWidth:"0"}:{},...W.key==="tier"?{width:"80px",minWidth:"80px",maxWidth:"80px"}:{},...W.key==="type"?{width:"100px",minWidth:"100px",maxWidth:"100px"}:{},...W.key==="difficulty"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...W.key==="action"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{}},onClick:()=>t(W.key),onMouseEnter:()=>D(W.key),onMouseLeave:()=>D(null),children:[W.hasFilter?e.jsxs("div",{style:H.headerWithFilter,children:[e.jsx("span",{style:{cursor:"pointer"},onClick:$=>{$.stopPropagation(),t(W.key)},children:W.label}),e.jsxs("button",{ref:W.key==="tier"?s:x,style:{...H.headerFilterIcon,...W.key==="tier"&&C?H.headerFilterIconActive:{},...W.key==="type"&&f?H.headerFilterIconActive:{}},className:"header-filter-icon",onClick:$=>{$.stopPropagation(),W.key==="tier"?(i(!l),u(!1)):W.key==="type"&&(u(!g),i(!1))},children:[e.jsx(Le,{size:14}),W.key==="tier"&&C||W.key==="type"&&f?e.jsx("span",{style:H.filterActiveDot}):null]})]}):W.label,W.key==="tier"&&N("tier",p,o,v,l,i,s),W.key==="type"&&N("type",n,c,d,g,u,x)]},W.key))})},ur=({item:r,isExpanded:t,onToggleExpanded:a,onAdd:p,type:n})=>{const[o,c]=w.useState(!1),l=()=>{p(r)},i=()=>n==="adversary"?e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...H.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:r.name}),e.jsx("td",{style:{...H.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:r.tier}),e.jsx("td",{style:{...H.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:r.type}),e.jsx("td",{style:{...H.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:r.difficulty})]}):n==="environment"?e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...H.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:r.name}),e.jsx("td",{style:{...H.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:r.tier}),e.jsx("td",{style:{...H.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:r.type}),e.jsx("td",{style:{...H.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:r.difficulty})]}):null;return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{style:{...H.row,...o?H.rowHover:{}},onClick:()=>a(r.id),onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:[i(),e.jsx("td",{style:{width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",boxSizing:"border-box",overflow:"visible",textOverflow:"unset",whiteSpace:"nowrap"},children:e.jsx("button",{style:H.addButton,onClick:g=>{g.stopPropagation(),l()},onMouseEnter:g=>{g.target.style.background="var(--gray-700)"},onMouseLeave:g=>{g.target.style.background="var(--purple)"},children:"+"})})]}),t&&e.jsx("tr",{style:H.expandedRow,children:e.jsx("td",{colSpan:"5",style:H.expandedContent,children:e.jsx(G,{item:r,type:n,mode:"expanded",onClick:()=>{},onDelete:()=>{}})})})]})},ge=({type:r,onAddItem:t,onCancel:a})=>{const{searchTerm:p,setSearchTerm:n,sortFields:o,handleSort:c,expandedCard:l,toggleExpanded:i,filteredAndSortedData:g,loading:u,selectedTiers:s,selectedTypes:x,showTierDropdown:v,setShowTierDropdown:d,showTypeDropdown:C,setShowTypeDropdown:f,tierFilterRef:M,typeFilterRef:S,uniqueTiers:D,uniqueTypes:R,handleTierSelect:P,handleTypeSelect:N,isTierFiltered:W,isTypeFiltered:$,getDropdownStyle:z}=dr(r);return u?e.jsx("div",{style:H.browser,children:e.jsx("div",{style:H.loading,children:"Loading..."})}):e.jsxs("div",{style:H.browserWrapper,children:[e.jsx(cr,{searchTerm:p,onSearchChange:n,type:r}),e.jsx("div",{className:"browser-content",style:H.browserContent,children:e.jsxs("table",{style:H.browserTable,children:[e.jsx("thead",{children:e.jsx(pr,{sortFields:o,onSort:c,type:r,uniqueTiers:D,uniqueTypes:R,selectedTiers:s,selectedTypes:x,showTierDropdown:v,setShowTierDropdown:d,showTypeDropdown:C,setShowTypeDropdown:f,tierFilterRef:M,typeFilterRef:S,handleTierSelect:P,handleTypeSelect:N,isTierFiltered:W,isTypeFiltered:$,getDropdownStyle:z})}),e.jsx("tbody",{children:g.map(A=>e.jsx(ur,{item:A,isExpanded:l===A.id,onToggleExpanded:i,onAdd:t,type:r},A.id))})]})})]})},H={browserWrapper:{display:"flex",flexDirection:"column",background:"var(--bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border)",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserContent:{flex:1,overflowY:"auto",overflowX:"visible",padding:0,width:"100%"},tableHeaderContainer:{flexShrink:0,position:"sticky",top:0,zIndex:15,backgroundColor:"var(--gray-800)"},browserTable:{width:"100%",minWidth:"100%",borderCollapse:"collapse",tableLayout:"fixed",background:"var(--bg-primary)",margin:0},browserHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-secondary)",flexShrink:0,position:"sticky",top:0,zIndex:20},browserTitle:{margin:0,color:"var(--text-primary)",fontSize:"18px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"24px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"14px",marginRight:"12px",transition:"all 0.2s ease"},searchInputFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 3px rgba(139, 92, 246, 0.1)"},tableHeader:{background:"var(--gray-800)",borderBottom:"1px solid var(--border)",boxShadow:"0 1px 0 var(--border)",position:"sticky",top:"0",zIndex:10},tableHeaderCell:{backgroundColor:"var(--gray-800)",fontWeight:"700",borderBottom:"1px solid var(--border)",cursor:"pointer",userSelect:"none",minWidth:"100px",whiteSpace:"nowrap",padding:"4px 4px",color:"var(--text-primary)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",boxShadow:"0 1px 0 var(--border)",transition:"background-color 0.2s",position:"sticky",top:"0",zIndex:10},tableHeaderCellHover:{backgroundColor:"var(--bg-hover)"},sortIndicator:{fontSize:"12px",color:"var(--text-secondary)"},tableBody:{flex:1,overflowY:"auto",padding:"8px",backgroundColor:"var(--gray-800)"},row:{height:"35px",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s ease",cursor:"pointer"},rowHover:{backgroundColor:"var(--bg-hover)"},expandedRow:{backgroundColor:"var(--bg-secondary)"},rowCell:{padding:"4px 4px",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid var(--border)"},rowCellName:{fontWeight:"500",minWidth:"150px"},rowCellCenter:{textAlign:"center",justifyContent:"center",minWidth:"80px"},rowActions:{width:"80px",textAlign:"center",padding:"4px 8px",borderBottom:"1px solid var(--border)"},addButton:{width:"1.5rem",height:"1.5rem",border:"1px solid var(--purple)",borderRadius:"var(--radius-sm)",background:"var(--purple)",color:"white",cursor:"pointer",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"500"},expandedContent:{padding:"16px",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)"},columnName:{width:"auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",paddingLeft:"8px",textAlign:"left"},columnTier:{width:"80px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnType:{width:"100px",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},columnDifficulty:{width:"40px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnAction:{width:"24px",minWidth:"24px",maxWidth:"24px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"visible",textOverflow:"unset"},loading:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"var(--text-primary)",fontSize:"16px"},mobileBrowser:{width:"95vw",height:"90vh",maxWidth:"none"},mobileSearchInput:{fontSize:"16px"},headerWithFilter:{display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",position:"relative"},headerFilterIcon:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"2px 4px",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",position:"relative"},headerFilterIconActive:{color:"var(--purple)"},filterIcon:{fontSize:"12px"},filterActiveDot:{position:"absolute",left:"50%",top:"2px",transform:"translateX(-50%)",width:"4px",height:"4px",borderRadius:"50%",background:"var(--purple)",pointerEvents:"none"},filterDropdown:{position:"absolute",top:"100%",left:"0",background:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",zIndex:99999,marginTop:"4px",overflow:"hidden",width:"max-content",minWidth:"120px",maxWidth:"200px"},filterOption:{padding:"8px 12px",cursor:"pointer",color:"var(--text-primary)",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background-color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},filterOptionSelected:{backgroundColor:"var(--bg-hover)"},checkIcon:{width:"16px",height:"16px",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"12px"},filterLabel:{flex:1}};function hr({selectedItem:r,selectedType:t,countdowns:a,adversaries:p,environments:n,setSelectedItem:o,handleCloseRightColumn:c}){w.useEffect(()=>{if(!r||!t)return;let l=!1;t==="adversaries"||t==="adversary"?l=p.some(i=>i.id===r.id):t==="environments"||t==="environment"?l=n.some(i=>i.id===r.id):(t==="countdowns"||t==="countdown")&&(l=a.some(i=>i.id===r.id)),l||c()},[r,t,a,p,n,o,c]),w.useEffect(()=>{if(!r||!t)return;let l=null;t==="adversaries"||t==="adversary"?l=p.find(i=>i.id===r.id):t==="environments"||t==="environment"?l=n.find(i=>i.id===r.id):(t==="countdowns"||t==="countdown")&&(l=a.find(i=>i.id===r.id)),l&&JSON.stringify(l)!==JSON.stringify(r)&&o(l)},[r,t,a,p,n,o])}class xr extends se.Component{constructor(t){super(t),this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,a){console.error("ErrorBoundary caught an error:",t,a)}render(){var t;return this.state.hasError?e.jsxs("div",{className:"p-md text-red",children:[e.jsx("h3",{children:"Something went wrong:"}),e.jsx("pre",{children:(t=this.state.error)==null?void 0:t.toString()}),e.jsx("button",{className:"btn-base btn-text",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try again"})]}):this.props.children}}const gr=()=>{const{adversaries:r,environments:t,countdowns:a,fear:p,updateFear:n,createAdversary:o,updateAdversary:c,deleteAdversary:l,createEnvironment:i,updateEnvironment:g,deleteEnvironment:u,createCountdown:s,deleteCountdown:x,advanceCountdown:v}=Ce(),[d,C]=w.useState(null),[f,M]=w.useState(null),[S,D]=w.useState(null),[R,P]=w.useState("unified"),[N,W]=w.useState(!1),[$,z]=w.useState(!1),[A]=w.useState("left"),[O,V]=w.useState(!0);w.useState(!1);const[_,E]=w.useState(null),[F,j]=w.useState(!1),I=(B,q)=>{w.startTransition(()=>{d&&d.id===B.id&&f===q&&S==="item"?(C(null),M(null),D(null),N&&j(!1)):(C(B),M(q),D("item"),N&&j(!0))})},h=(B="unified")=>{let q=B;B==="adversaries"?q="adversary":B==="environments"&&(q="environment"),S==="database"&&R===q?w.startTransition(()=>{D(null),P("unified"),N&&j(!1)}):w.startTransition(()=>{P(q),D("database"),N&&j(!0)})},y=B=>{a.forEach(q=>{const Y=qe(q,B);if(Y>0){const U=q.value||0;v(q.id,U+Y)}})},m=()=>{a.forEach(B=>{const q=Xe(B);if(q>0){const Y=B.value||0;v(B.id,Y+q)}})},b=w.useCallback(()=>{D(null),C(null),M(null),N&&j(!1)},[N]);w.useEffect(()=>{const B=()=>{const U=N,Z=window.matchMedia("(max-width: 800px)").matches;W(Z),!U&&Z&&(S==="database"||S==="creator"||S==="item")&&j(!0),U&&!Z&&F&&j(!1)};B();const q=window.matchMedia("(max-width: 800px)"),Y=()=>B();return q.addEventListener("change",Y),()=>q.removeEventListener("change",Y)},[N,S,F]),w.useEffect(()=>(F||N&&d?(document.body.classList.add("mobile-drawer-open"),document.documentElement.classList.add("mobile-drawer-open")):(document.body.classList.remove("mobile-drawer-open"),document.documentElement.classList.remove("mobile-drawer-open")),()=>{document.body.classList.remove("mobile-drawer-open"),document.documentElement.classList.remove("mobile-drawer-open")}),[N,F,d]),hr({selectedItem:d,selectedType:f,countdowns:a,adversaries:r,environments:t,setSelectedItem:C,handleCloseRightColumn:b});const{handleAdversaryDamage:k,handleAdversaryHealing:T,handleAdversaryStressChange:X}=Ye({adversaries:r,updateAdversary:c,deleteAdversary:l,selectedItem:d,setSelectedItem:C});return e.jsxs("div",{className:"app",onClick:B=>{B.target===B.currentTarget&&b()},children:[e.jsx(pe,{position:"top",style:{display:"flex",alignItems:"center",justifyContent:"center",height:"var(--topbar-height)",touchAction:"manipulation",userSelect:"none"},children:e.jsx(K,{type:"fear",value:(p==null?void 0:p.value)||0,maxValue:12,onChange:n,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0})}),e.jsx("div",{className:"bottom-bar-container",children:e.jsxs(pe,{position:"bottom",children:[e.jsx(er,{isEditMode:$,setIsEditMode:z}),e.jsx(Ze,{adversaries:r,environments:t,countdowns:a,deleteAdversary:l,deleteEnvironment:u,deleteCountdown:x}),e.jsx(Qe,{})]})}),e.jsxs("div",{className:"main-content",children:[e.jsx(ue,{side:"left",className:`${N&&A==="right"?"mobile-hidden":""}`,children:e.jsx(tr,{onItemSelect:I,selectedItem:d,selectedType:f,onOpenDatabase:h,isEditMode:$,onEditModeChange:z,showLongTermCountdowns:O,fear:p,updateFear:n,handleRollOutcome:y,handleActionRoll:m,setShowLongTermCountdowns:V,lastAddedItemType:_})}),e.jsxs(ue,{side:"right",className:`${N&&A==="left"?"mobile-hidden":""}`,style:S==="database"?{overflowY:"hidden"}:{},children:[S==="database"&&e.jsx("div",{className:"database-display",children:e.jsx(ge,{type:R,onAddItem:B=>{R==="adversary"?(o(B),E("adversary")):R==="environment"&&(i(B),E("environment"))},onCancel:b})}),S==="item"&&d&&e.jsx(G,{type:f,item:d,mode:$?"edit":"expanded",onApplyDamage:k,onApplyHealing:T,onApplyStressChange:X,onUpdate:f==="adversaries"?c:f==="environments"?g:updateCountdown,adversaries:r}),!S&&e.jsx("div",{})]})]},`mobile-${N}`),N&&e.jsxs(sr,{isOpen:F,onClose:b,children:[S==="database"&&e.jsx("div",{className:"browser-container",children:e.jsx(ge,{type:R,onAddItem:B=>{R==="adversary"?(o(B),E("adversary")):R==="environment"&&(i(B),E("environment"))},onCancel:b})}),S==="item"&&d&&e.jsx("div",{className:"expanded-content",children:e.jsx(G,{type:f,item:d,mode:$?"edit":"expanded",onApplyDamage:k,onApplyHealing:T,onApplyStressChange:X,onUpdate:f==="adversaries"?c:f==="environments"?g:updateCountdown,adversaries:r})})]}),e.jsx(or,{})]})},fr=()=>e.jsx(xr,{children:e.jsx(we,{children:e.jsx(gr,{})})});te.createRoot(document.getElementById("root")).render(e.jsx(se.StrictMode,{children:e.jsx(we,{children:e.jsx(fr,{})})}));
