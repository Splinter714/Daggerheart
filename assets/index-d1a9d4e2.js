import{r as j,a as Ne,R as ge}from"./dndkit-57209f9c.js";import{F as Ze,f as Ue,a as et,b as tt,c as De}from"./fa-b4bcccb0.js";import{D as Be,A as _e,C as rt,T as nt,S as ot,M as st,X as Me,E as at,a as it,H as lt,L as dt,b as ct,F as pt,c as be,d as je,e as He,P as Fe}from"./lucide-fbfda5ab.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const y of document.querySelectorAll('link[rel="modulepreload"]'))g(y);new MutationObserver(y=>{for(const x of y)if(x.type==="childList")for(const l of x.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&g(l)}).observe(document,{childList:!0,subtree:!0});function i(y){const x={};return y.integrity&&(x.integrity=y.integrity),y.referrerPolicy&&(x.referrerPolicy=y.referrerPolicy),y.crossOrigin==="use-credentials"?x.credentials="include":y.crossOrigin==="anonymous"?x.credentials="omit":x.credentials="same-origin",x}function g(y){if(y.ep)return;y.ep=!0;const x=i(y);fetch(y.href,x)}})();var Ve={exports:{}},Ae={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ut=j,xt=Symbol.for("react.element"),mt=Symbol.for("react.fragment"),ht=Object.prototype.hasOwnProperty,ft=ut.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,gt={key:!0,ref:!0,__self:!0,__source:!0};function Ge(t,s,i){var g,y={},x=null,l=null;i!==void 0&&(x=""+i),s.key!==void 0&&(x=""+s.key),s.ref!==void 0&&(l=s.ref);for(g in s)ht.call(s,g)&&!gt.hasOwnProperty(g)&&(y[g]=s[g]);if(t&&t.defaultProps)for(g in s=t.defaultProps,s)y[g]===void 0&&(y[g]=s[g]);return{$$typeof:xt,type:t,key:x,ref:l,props:y,_owner:ft.current}}Ae.Fragment=mt;Ae.jsx=Ge;Ae.jsxs=Ge;Ve.exports=Ae;var e=Ve.exports,Le={},Oe=Ne;Le.createRoot=Oe.createRoot,Le.hydrateRoot=Oe.hydrateRoot;function me(t){const s=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return t?`${t}-${s}`:s}const Xe=j.createContext();function ze(t){if(typeof localStorage>"u")return null;try{const s=localStorage.getItem(t);return s==null?null:JSON.parse(s)}catch{return null}}function fe(t,s){if(!(typeof localStorage>"u"))try{localStorage.setItem(t,JSON.stringify(s))}catch{}}const yt=({children:t})=>{const[s,i]=j.useState({fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],currentEncounterName:"Encounter"}),[g,y]=j.useState(!1),[x,l]=j.useState({adversaries:[],environments:[]});j.useEffect(()=>{var r,d,b,P;const n=ze("daggerheart-game-state");if(n)try{(((r=n.adversaries)==null?void 0:r.length)>0||((d=n.environments)==null?void 0:d.length)>0||((b=n.countdowns)==null?void 0:b.length)>0||((P=n.savedEncounters)==null?void 0:P.length)>0)&&i(n)}catch(le){console.error("Failed to load saved state:",le)}const o=ze("daggerheart-custom-adversaries")||[],a=ze("daggerheart-custom-environments")||[];l({adversaries:o,environments:a}),y(!0)},[]),j.useEffect(()=>{fe("daggerheart-game-state",s)},[s]);const I=n=>{i(o=>({...o,fear:{...o.fear,value:n}}))},p=()=>{i(n=>({...n,fear:{...n.fear,visible:!n.fear.visible}}))},k=n=>{i(o=>({...o,partySize:Math.max(1,n)}))},A=n=>{i(o=>({...o,currentEncounterName:n||"Encounter"}))},D=n=>{if(n.id)return i(o=>({...o,savedEncounters:(o.savedEncounters||[]).map(a=>a.id===n.id?{...a,name:n.name||a.name,encounterItems:n.encounterItems||a.encounterItems,partySize:n.partySize||a.partySize,battlePointsAdjustments:n.battlePointsAdjustments||a.battlePointsAdjustments,updatedAt:new Date().toISOString()}:a)})),n.id;{const o={id:me("encounter"),name:n.name||"Encounter",createdAt:new Date().toISOString(),encounterItems:n.encounterItems||[],partySize:n.partySize||4,battlePointsAdjustments:n.battlePointsAdjustments||{}};return i(a=>({...a,savedEncounters:[...a.savedEncounters||[],o]})),o.id}},Y=n=>(s.savedEncounters||[]).find(a=>a.id===n),v=n=>{const o={id:me("encounter"),name:n.name||`Encounter ${Date.now()}`,createdAt:new Date().toISOString(),encounterItems:n.encounterItems||[],partySize:n.partySize||4,battlePointsAdjustments:n.battlePointsAdjustments||{}};return i(a=>({...a,savedEncounters:[...a.savedEncounters||[],o]})),o.id},R=n=>{i(o=>({...o,savedEncounters:(o.savedEncounters||[]).filter(a=>a.id!==n)}))},X=j.useRef(s);j.useEffect(()=>{X.current=s},[s]);const O={gameState:s,isLoaded:g,customContent:x,updateFear:I,toggleFearVisibility:p,updatePartySize:k,updateCurrentEncounterName:A,saveEncounter:D,saveEncounterAs:v,loadEncounter:Y,deleteEncounter:R,createCountdown:n=>{const o={id:me("countdown"),name:n.name||"Countdown",max:parseInt(n.max)||1,value:0,visible:!0,type:n.type||"standard",loop:n.loop||"none",source:n.source||"campaign"};i(a=>({...a,countdowns:[...a.countdowns,o]}))},updateCountdown:(n,o)=>{i(a=>({...a,countdowns:a.countdowns.map(r=>r.id===n?{...r,...o}:r)}))},deleteCountdown:n=>{i(o=>({...o,countdowns:o.countdowns.filter(a=>a.id!==n)}))},advanceCountdown:(n,o)=>{i(a=>({...a,countdowns:a.countdowns.map(r=>{if(r.id!==n)return r;let d=o;if(r.loop==="loop")d>r.max?d=(d-1)%r.max+1:d<0&&(d=r.max);else if(r.loop==="increasing"){if(d>r.max)return{...r,max:r.max+1,value:1};if(d<0)return{...r,max:Math.max(1,r.max-1),value:1};d=Math.max(0,d)}else if(r.loop==="decreasing"){if(d>r.max)return{...r,max:Math.max(1,r.max-1),value:1};if(d<0)return{...r,max:r.max+1,value:1};d=Math.min(r.max,d)}else d=Math.max(0,Math.min(d,r.max));return{...r,value:d}})}))},incrementCountdown:(n,o=1)=>{i(a=>({...a,countdowns:a.countdowns.map(r=>{if(r.id!==n)return r;let d=r.value+o;if(r.loop==="loop")d>r.max&&(d=(d-1)%r.max+1);else if(r.loop==="increasing"){if(d>r.max)return{...r,max:r.max+1,value:1}}else if(r.loop==="decreasing"){if(d>r.max)return{...r,max:Math.max(1,r.max-1),value:1}}else d=Math.min(d,r.max);return{...r,value:d}})}))},decrementCountdown:n=>{i(o=>({...o,countdowns:o.countdowns.map(a=>{if(a.id!==n)return a;let r=a.value-1;if(a.loop==="loop")r<0&&(r=a.max);else if(a.loop==="increasing"){if(r<0)return{...a,max:Math.max(1,a.max-1),value:a.max};r=Math.max(0,r)}else if(a.loop==="decreasing"){if(r<0)return{...a,max:a.max+1,value:1}}else r=Math.max(0,r);return{...a,value:r}})}))},reorderCountdowns:n=>{i(o=>{const[a,r]=n,d=[...o.countdowns],[b]=d.splice(a,1);return d.splice(r,0,b),{...o,countdowns:d}})},createAdversary:n=>{var le;const o=me("adv"),a=s.adversaries||[],r=n.baseName||((le=n.name)==null?void 0:le.replace(/\s+\(\d+\)$/,""))||n.name||"Unknown",d=a.filter(Z=>Z.baseName===r);let b=1;if(d.length===0)b=1;else{const Z=d.map(c=>c.duplicateNumber||1);let z=1;for(;Z.includes(z);)z++;b=z}const P={...n,id:o,baseName:r,duplicateNumber:b,name:`${r} (${b})`,hp:0,stress:0,isVisible:!0};i(Z=>({...Z,adversaries:[...Z.adversaries,P]}))},createAdversariesBulk:n=>{const o=[],a={};n.forEach(r=>{var S;const d=r.baseName||((S=r.name)==null?void 0:S.replace(/\s+\(\d+\)$/,""))||r.name||"Unknown",le=(s.adversaries||[]).filter(M=>M.baseName===d).length,Z=a[d]||0,z=le+Z+1;a[d]=Z+1;const c={...r,id:me("adv"),baseName:d,duplicateNumber:z,name:`${d} (${z})`,hp:0,stress:0,isVisible:!0};o.push(c)}),i(r=>({...r,adversaries:[...r.adversaries,...o]}))},updateAdversary:(n,o)=>{i(a=>({...a,adversaries:a.adversaries.map(r=>{if(r.id===n){const d={...r,...o};if(o.baseName!==void 0){const b=o.baseName,P=d.duplicateNumber||1;d.name=P===1?b:`${b} (${P})`}return d}return r})}))},deleteAdversary:n=>{i(o=>({...o,adversaries:o.adversaries.filter(a=>a.id!==n)}))},clearAllAdversaries:()=>{i(n=>({...n,adversaries:[]}))},reorderAdversaries:n=>{i(o=>{const[a,r]=n,d=[...o.adversaries],[b]=d.splice(a,1);return d.splice(r,0,b),{...o,adversaries:d}})},bulkReorderAdversaries:n=>{i(o=>({...o,adversaries:n}))},createEnvironment:n=>{const o=me("env"),r=(s.environments||[]).filter(P=>P.name.replace(/\s+\(\d+\)$/,"")===n.name);let d=n.name||"Unknown";if(r.length===0)d=n.name;else if(r.length===1){const P=r[0],le=P.name.replace(/\s+\(\d+\)$/,""),Z=s.environments.map(z=>z.id===P.id?{...z,name:`${le} (1)`}:z);i(z=>({...z,environments:Z})),d=`${n.name} (2)`}else{const P=r.map(Z=>{const z=Z.name.match(/\((\d+)\)$/);return z?parseInt(z[1]):null}).filter(Z=>Z!==null);let le=1;for(;P.includes(le);)le++;d=`${n.name} (${le})`}const b={...n,id:o,name:d,isVisible:!0};i(P=>({...P,environments:[...P.environments,b]}))},updateEnvironment:(n,o)=>{i(a=>({...a,environments:a.environments.map(r=>r.id===n?{...r,...o}:r)}))},deleteEnvironment:n=>{i(o=>({...o,environments:o.environments.filter(a=>a.id!==n)}))},reorderEnvironments:n=>{i(o=>{const[a,r]=n,d=[...o.environments],[b]=d.splice(a,1);return d.splice(r,0,b),{...o,environments:d}})},addCustomAdversary:n=>{const o={...n,id:me("custom-adv"),source:n.source||"Homebrew",isCustom:!0};return l(a=>({...a,adversaries:[...a.adversaries,o]})),fe("daggerheart-custom-adversaries",[...x.adversaries,o]),o.id},addCustomEnvironment:n=>{const o={...n,id:me("custom-env"),source:n.source||"Homebrew",isCustom:!0};return l(a=>({...a,environments:[...a.environments,o]})),fe("daggerheart-custom-environments",[...x.environments,o]),o.id},updateCustomAdversary:(n,o)=>{l(r=>({...r,adversaries:r.adversaries.map(d=>d.id===n?{...d,...o}:d)}));const a=x.adversaries.map(r=>r.id===n?{...r,...o}:r);fe("daggerheart-custom-adversaries",a)},updateCustomEnvironment:(n,o)=>{l(r=>({...r,environments:r.environments.map(d=>d.id===n?{...d,...o}:d)}));const a=x.environments.map(r=>r.id===n?{...r,...o}:r);fe("daggerheart-custom-environments",a)},deleteCustomAdversary:n=>{l(a=>({...a,adversaries:a.adversaries.filter(r=>r.id!==n)}));const o=x.adversaries.filter(a=>a.id!==n);fe("daggerheart-custom-adversaries",o)},deleteCustomEnvironment:n=>{l(a=>({...a,environments:a.environments.filter(r=>r.id!==n)}));const o=x.environments.filter(a=>a.id!==n);fe("daggerheart-custom-environments",o)}};return e.jsx(Xe.Provider,{value:O,children:t})},Ye=()=>{const t=j.useContext(Xe);if(!t)return console.warn("useGameState: Context not available yet, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{gameState:s,customContent:i,...g}=t;if(!s)return console.warn("useGameState: gameState not available, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],customContent:{adversaries:[],environments:[]},updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},addCustomAdversary:()=>{},addCustomEnvironment:()=>{},updateCustomAdversary:()=>{},updateCustomEnvironment:()=>{},deleteCustomAdversary:()=>{},deleteCustomEnvironment:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{fear:y,countdowns:x,adversaries:l,environments:I,partySize:p,savedEncounters:k}=s;return{gameState:s,fear:y,countdowns:x,adversaries:l,environments:I,partySize:p,savedEncounters:k,customContent:i,...g,hasCountdowns:x.length>0,hasAdversaries:l.length>0,hasEnvironments:I.length>0,getCountdownById:A=>x.find(D=>D.id===A),getAdversaryById:A=>l.find(D=>D.id===A),getEnvironmentById:A=>I.find(D=>D.id===A)}},$e={fear:{icon:Ue,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"0.125rem",maxWidth:"none"},pipStyle:{fontSize:"var(--text-lg)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0,imageRendering:"crisp-edges"},filledColor:"var(--purple)",emptyColor:"var(--gray-dark)",tooltipTitle:"Click anywhere in header to adjust fear:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease fear by 1"},{text:"Right of boundary:",description:"Click to increase fear by 1"}]},hp:{icon:et,maxValue:20,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stress:{icon:tt,maxValue:12,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},countdown:{icon:De,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust countdown:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease countdown by 1"},{text:"Right of boundary:",description:"Click to increase countdown by 1"}]},hpDots:{maxValue:20,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--red)",borderColor:"var(--red)",boxShadow:"0 0 4px rgba(239, 68, 68, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stressDots:{maxValue:12,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--purple)",borderColor:"var(--purple)",boxShadow:"0 0 4px rgba(139, 92, 246, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},adversaryHP:{icon:Be,maxValue:20,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust HP:",tooltipInstructions:[{text:"Filled pip:",description:"Click to heal (reduce damage)"},{text:"Empty pip:",description:"Click to take damage"}]},adversaryStress:{icon:_e,maxValue:12,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust stress:",tooltipInstructions:[{text:"Filled pip:",description:"Click to reduce stress"},{text:"Empty pip:",description:"Click to increase stress"}]},countdownDistributed:{icon:De,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Countdown progress:",tooltipInstructions:[{text:"Progress:",description:"Current countdown value"}]}},vt=({type:t="fear",value:s=0,maxValue:i,onChange:g,size:y="lg",showTooltip:x=!0,containerStyle:l={},pipStyle:I={},countdownType:p=null,distributedGroups:k=null,onPipClick:A=null,enableBoundaryClick:D=!1,clickContainerWidth:Y="auto",centerPips:v=!0})=>{const[R,X]=j.useState(!1),B=$e[t]||$e.fear,L=i||B.maxValue,C=Math.max(0,Math.min(L,s));let T=B.filledColor;t==="countdown"&&p&&(["progress","dynamic-progress","simple-hope"].includes(p)?T="var(--gold)":["consequence","dynamic-consequence","simple-fear"].includes(p)?T="var(--purple)":["long-term","standard"].includes(p)&&(T="var(--text-secondary)"));const E=($,de)=>{if(A)A($,de);else if(g){const ae=$+1;g(ae)}},H=$=>{if(!D||!g||A)return;$.currentTarget.getBoundingClientRect();const de=$.currentTarget.querySelector(".pip-container");if(!de)return;const ae=de.getBoundingClientRect(),ie=$.clientX-ae.left;if(ie<0){C>0&&g(C-1);return}if(ie>ae.width){C<L&&g(C+1);return}const re=ae.width,u=re*.05,h=re-2*u,G=ie-u,w=C/L,W=h*w;G<W?C>0&&g(C-1):C<L&&g(C+1)},F=(()=>{if(!k||t!=="countdownDistributed")return[{start:0,end:L,groupIndex:0}];let $=0;return k.map((de,ae)=>{const ie={start:$,end:$+de,groupIndex:ae};return $+=de,ie})})(),ce=()=>e.jsxs(e.Fragment,{children:[F.map($=>e.jsx(ge.Fragment,{children:[...Array($.end-$.start)].map((de,ae)=>{const ie=$.start+ae,re=ie<C;if(B.isDots)return e.jsx("div",{style:{...B.pipStyle,...re?B.filledStyle:B.emptyStyle,...I,cursor:g||A?"pointer":"default"},onClick:D?void 0:()=>E(ie,re),title:`${ie+1} of ${L}`},ie);{const u=B.icon,h=u&&typeof u=="object"&&u.iconName,G=re?T:B.emptyColor;return e.jsx("span",{className:`fear-pip ${re?"filled":"empty"}`,style:{...B.pipStyle,color:G,cursor:g||A?"pointer":"default",...I},onClick:D?void 0:()=>E(ie,re),title:`${ie+1} of ${L}`,children:h?e.jsx(Ze,{icon:u,size:y}):e.jsx(u,{size:16})},ie)}})},$.groupIndex)),x&&e.jsx("div",{style:{position:"relative",cursor:"help",pointerEvents:"none"},children:e.jsxs("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:R?"translateX(-50%) translateY(-5px)":"translateX(-50%)",background:"rgba(15, 23, 42, 0.95)",border:"1px solid var(--gray)",borderRadius:"var(--radius-md)",padding:"var(--space-md)",minWidth:"250px",zIndex:1e3,opacity:R?1:0,visibility:R?"visible":"hidden",transition:"all 0.2s ease",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.5)"},children:[e.jsx("div",{style:{fontWeight:600,color:"var(--gray-200)",marginBottom:"0.75rem",fontSize:"var(--text-sm)"},children:B.tooltipTitle}),B.tooltipInstructions.map(($,de)=>e.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.8rem",color:"var(--gray-300)",lineHeight:1.4},children:[e.jsx("strong",{style:{color:"var(--gray-200)"},children:$.text})," ",$.description]},de))]})})]});return e.jsx("div",{style:{width:Y,height:"100%",cursor:g||A?"pointer":"default",touchAction:"manipulation",userSelect:"none",display:v?"flex":"block",alignItems:v?"center":"stretch",justifyContent:v?"center":"flex-start",...l},onClick:$=>{$.stopPropagation(),$.preventDefault(),D&&H($)},onMouseEnter:()=>X(x),onMouseLeave:()=>X(!1),children:e.jsx("div",{className:"pip-container",style:{...B.containerStyle,width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},children:ce()})})},bt="/Daggerheart/assets/daggerheart-logo-fe7815ad.svg",jt=({showFlyout:t,onFlyoutChange:s})=>{const[i,g]=j.useState(!1),[y,x]=j.useState(!1),l=t!==void 0?t:i,I=s||g;return j.useEffect(()=>{const p=k=>{k.target.closest(".help-button")||I(!1)};return document.addEventListener("click",p),()=>document.removeEventListener("click",p)},[I]),j.useEffect(()=>{const p=window.matchMedia("(max-width: 800px)"),k=A=>x(A.matches);return x(p.matches),p.addEventListener("change",k),()=>p.removeEventListener("change",k)},[]),e.jsxs("div",{className:"help-button",style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",padding:"0.5rem",color:l?"white":"var(--text-primary)",borderRadius:"50%",cursor:"pointer",transition:"all 0.2s ease",minWidth:"44px",minHeight:"44px",backgroundColor:l?"var(--purple)":"transparent"},onMouseEnter:p=>{l||(p.currentTarget.style.backgroundColor="var(--bg-secondary)")},onMouseLeave:p=>{l||(p.currentTarget.style.backgroundColor="transparent")},onClick:p=>{p.stopPropagation(),I(!l)},title:"Help & Info",children:[e.jsx("div",{style:{width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center",color:"inherit",backgroundColor:"transparent",border:"none",outline:"none"},children:e.jsx(rt,{size:20})}),e.jsxs("div",{style:{position:"absolute",top:"50%",right:"100%",left:"auto",transform:"translateY(-50%)",background:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,opacity:l?1:0,visibility:l?"visible":"hidden",transition:"opacity 0.2s ease, visibility 0.2s ease, transform 0.2s ease",pointerEvents:l?"auto":"none",minWidth:"280px",maxWidth:y?"calc(100vw - 2rem)":"320px",marginRight:"0.5rem"},children:[e.jsxs("div",{style:{padding:"0.75rem",borderTop:"1px solid rgba(255, 255, 255, 0.1)",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",background:"var(--bg-primary)",maxWidth:"280px"},children:[e.jsx("img",{src:bt,alt:"Daggerheart Community Content Logo",style:{width:"100%",maxWidth:"200px",height:"auto",margin:"0 auto 0.75rem auto",display:"block"},onError:p=>{console.error("Failed to load Daggerheart logo:",p.target.src),p.target.style.display="none";const k=document.createElement("div");k.style.cssText="text-align: center; margin-bottom: 0.75rem; font-size: 1.5rem; font-weight: bold; color: var(--purple);",k.textContent="⚔️ DAGGERHEART ⚔️",p.target.parentNode.insertBefore(k,p.target)},onLoad:()=>{}}),e.jsxs("div",{style:{fontSize:"0.7rem",lineHeight:1.3,color:"var(--text-secondary)",textAlign:"left",wordWrap:"break-word",overflowWrap:"break-word"},children:[e.jsx("p",{children:"This product includes materials from the Daggerheart System Reference Document 1.0, © Critical Role, LLC, under the terms of the Darrington Press Community Gaming (DPCGL) License."}),e.jsxs("p",{children:["More information can be found at ",e.jsx("a",{href:"https://www.daggerheart.com",target:"_blank",rel:"noopener noreferrer",children:"daggerheart.com"})]}),e.jsx("p",{children:e.jsx("em",{children:"This project is unofficial and not endorsed by Darrington Press or Critical Role."})})]})]}),e.jsx("button",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"0.25rem 1rem",color:"var(--text-primary)",border:"none",background:"none",width:"100%",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"0.875rem",minHeight:"32px",borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},onMouseEnter:p=>{p.target.style.backgroundColor="var(--gray-dark)"},onMouseLeave:p=>{p.target.style.backgroundColor="transparent"},onClick:p=>{p.stopPropagation(),I(!1),window.open("https://github.com/Splinter714/Daggerheart","_blank")},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.25rem"},children:e.jsx("span",{children:"GitHub"})})}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"0.25rem 1rem",color:"var(--text-secondary)",border:"none",background:"none",width:"100%",textAlign:"left",cursor:"default",fontSize:"0.875rem",minHeight:"32px"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.25rem"},children:e.jsxs("span",{children:["Version ","0.3.11 (5c23187)"]})})})]})]})},Ct=({adversaries:t,environments:s,countdowns:i,deleteAdversary:g,deleteEnvironment:y,deleteCountdown:x,isClearMode:l,setIsClearMode:I,showFlyout:p,onFlyoutChange:k})=>{const[A,D]=j.useState(!1),Y=p!==void 0?p:A,v=k||D,R=((t==null?void 0:t.length)||0)>0||((s==null?void 0:s.length)||0)>0||((i==null?void 0:i.length)||0)>0,X=(t||[]).some(E=>(E.hp||0)>=(E.hpMax||1));j.useEffect(()=>{const E=H=>{H.target.closest(".delete-clear-container")||(v(!1),l&&I(!1))};return document.addEventListener("click",E),()=>document.removeEventListener("click",E)},[l,v]),j.useEffect(()=>{l&&!R&&(I(!1),v(!1))},[l,R,I,v]);const B={position:"absolute",top:"50%",right:"100%",left:"auto",transform:"translateY(-50%)",backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",padding:"0.5rem",minWidth:"200px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,display:Y?"block":"none",marginRight:"0.5rem"},L={background:l||Y?"var(--red)":"none",border:"none",color:l||Y?"white":R?"var(--text-primary)":"var(--text-secondary)",cursor:R?"pointer":"not-allowed",padding:"0.5rem",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s",opacity:R?1:.5,minWidth:"44px",minHeight:"44px"},C={background:"none",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:"0.5rem",borderRadius:"var(--radius-sm)",width:"100%",textAlign:"left",display:"flex",alignItems:"center",gap:"0.5rem",transition:"background-color 0.2s"},T={backgroundColor:"var(--bg-hover)"};return e.jsxs("div",{className:"delete-clear-container",style:{position:"relative"},children:[e.jsx("button",{style:L,onClick:E=>{E.stopPropagation(),R&&(l?(I(!1),v(!1)):(I(!0),v(!0)))},title:R?l?"Clear Items":"Enter Clear Mode":"Nothing to clear",children:e.jsx(nt,{size:20})}),e.jsxs("div",{style:B,children:[t&&t.length>0&&e.jsxs("button",{style:C,onMouseEnter:E=>Object.assign(E.target.style,T),onMouseLeave:E=>Object.assign(E.target.style,C),onClick:E=>{E.stopPropagation(),D(!1),t.forEach(H=>g(H.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Adversaries"})]}),t&&t.length>0&&X&&e.jsxs("button",{style:C,onMouseEnter:E=>Object.assign(E.target.style,T),onMouseLeave:E=>Object.assign(E.target.style,C),onClick:E=>{E.stopPropagation(),D(!1),t.filter(te=>(te.hp||0)>=(te.hpMax||1)).forEach(te=>g(te.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"Dead Adversaries"})]}),s&&s.length>0&&e.jsxs("button",{style:C,onMouseEnter:E=>Object.assign(E.target.style,T),onMouseLeave:E=>Object.assign(E.target.style,C),onClick:E=>{E.stopPropagation(),D(!1),s.forEach(H=>y(H.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Environments"})]}),i&&i.length>0&&e.jsxs("button",{style:C,onMouseEnter:E=>Object.assign(E.target.style,T),onMouseLeave:E=>Object.assign(E.target.style,C),onClick:E=>{E.stopPropagation(),D(!1),i.forEach(H=>x(H.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Countdowns"})]})]})]})},wt=({adversaries:t,environments:s,countdowns:i,deleteAdversary:g,deleteEnvironment:y,deleteCountdown:x,isClearMode:l,setIsClearMode:I,sortAdversaries:p,onOpenDatabase:k})=>{const[A,D]=j.useState(!1),[Y,v]=j.useState(!1),[R,X]=j.useState(!1);j.useEffect(()=>{const te=F=>{F.target.closest(".floating-menu-container")||(D(!1),v(!1),X(!1),l&&I(!1))};return document.addEventListener("click",te),()=>document.removeEventListener("click",te)},[l,I]),j.useEffect(()=>{A||(v(!1),X(!1),l&&I(!1))},[A,l,I]);const B=te=>{v(te),te&&(X(!1),l&&I(!1))},L=te=>{X(te),te&&v(!1)},T={position:"fixed",bottom:window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://")?"calc(60px + env(safe-area-inset-bottom) + 2rem)":"calc(60px + env(safe-area-inset-bottom) + 1rem)",right:"1rem",zIndex:1100,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",pointerEvents:"none",width:"56px",height:"56px"},E={width:"56px",height:"56px",borderRadius:"50%",background:A?"var(--red)":"var(--bg-secondary)",border:"2px solid var(--border)",color:A?"white":"var(--text-primary)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"all 0.3s ease",pointerEvents:"auto"},H=(te,F)=>{const ae=135+te*135/(F-1),ie=70,re=ae*Math.PI/180,u=Math.cos(re)*ie,h=Math.sin(re)*ie;return{width:"48px",height:"48px",borderRadius:"50%",background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.2)",transition:"all 0.3s ease",position:"absolute",pointerEvents:"auto",transform:A?`translate(${u}px, ${h}px)`:"translate(0px, 0px)",opacity:A?1:0,visibility:A?"visible":"hidden"}};return e.jsxs("div",{className:"floating-menu-container",style:T,children:[e.jsxs("div",{style:{position:"absolute",top:"0",left:"0",width:"56px",height:"56px",pointerEvents:"none"},children:[e.jsx("div",{style:H(0,4),children:e.jsx("button",{onClick:te=>{te.stopPropagation(),k("adversaries"),D(!1)},style:{width:"100%",height:"100%",background:"none",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Browse Adversaries",children:e.jsx(ot,{size:20})})}),e.jsx("div",{style:H(1,4),children:e.jsx("button",{onClick:te=>{te.stopPropagation(),k("environments"),D(!1)},style:{width:"100%",height:"100%",background:"none",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Browse Environments",children:e.jsx(st,{size:20})})}),e.jsx("div",{style:H(2,4),children:e.jsx(Ct,{adversaries:t,environments:s,countdowns:i,deleteAdversary:g,deleteEnvironment:y,deleteCountdown:x,isClearMode:l,setIsClearMode:I,showFlyout:R,onFlyoutChange:L})}),e.jsx("div",{style:H(3,4),children:e.jsx(jt,{showFlyout:Y,onFlyoutChange:B})})]}),e.jsx("button",{style:E,onClick:te=>{te.stopPropagation(),D(!A)},title:A?"Close Menu":"Open Menu",children:A?e.jsx(Me,{size:24}):e.jsx(at,{size:24})})]})},St=({position:t="top",children:s,onClick:i,className:g="",style:y={}})=>{const x=t==="top",l=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://"),I={background:"var(--bg-primary)",borderTop:x?"none":"1px solid var(--border)",borderBottom:x?"1px solid var(--border)":"none",padding:x?"0.25rem 0":"0.5rem",paddingBottom:x?"0.25rem":l?"calc(0.5rem + env(safe-area-inset-bottom) + 1rem)":"calc(0.5rem + env(safe-area-inset-bottom))",position:x?"relative":"sticky",[x?"top":"bottom"]:0,zIndex:x?10:100,order:x?1:3,flexShrink:0,touchAction:"manipulation",userSelect:"none",display:"flex",flexDirection:x?"column":"row",justifyContent:x?"stretch":"center",alignItems:x?"stretch":"center",gap:x?"0":"1rem",height:x?"auto":"60px",...y};return e.jsx("div",{className:g,style:I,onClick:i,children:s})},Ce=({value:t})=>e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"44px",height:"32px",zIndex:3},children:[e.jsx("svg",{width:"40",height:"32",viewBox:"0 0 40 32",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",style:{position:"absolute",zIndex:1},children:e.jsx("path",{d:"M2 2h28l6 14-6 14H2l6-14-6-14z"})}),e.jsx("span",{style:{position:"absolute",fontSize:"0.7rem",fontWeight:500,color:"var(--text-primary)",textAlign:"center",zIndex:2,left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:t})]}),We=({feature:t,featureType:s,item:i,onUpdate:g,handleFeatureDeleteClick:y,deleteConfirmations:x,getFeatureKey:l})=>{var D,Y;const I=()=>{try{const R=[...(i==null?void 0:i.features)||[]],X=R.filter(L=>L.type===s),B=X.findIndex(L=>L===t);if(B>0&&B<X.length){const L=X[B],C=X[B-1];if(L&&C){const T=R.findIndex(H=>H===L),E=R.findIndex(H=>H===C);T>=0&&E>=0&&(R[T]=C,R[E]=L,g&&g(i.id,{features:R}))}}}catch(v){console.error(`Error in ${s.toLowerCase()} up button:`,v)}},p=()=>{try{const R=[...(i==null?void 0:i.features)||[]],X=R.filter(L=>L.type===s),B=X.findIndex(L=>L===t);if(B<X.length-1&&B>=0){const L=X[B],C=X[B+1];if(L&&C){const T=R.findIndex(H=>H===L),E=R.findIndex(H=>H===C);T>=0&&E>=0&&(R[T]=C,R[E]=L,g&&g(i.id,{features:R}))}}}catch(v){console.error(`Error in ${s.toLowerCase()} down button:`,v)}},k=v=>v.type===s,A=v=>v.type===s&&v.name.trim();return e.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",alignSelf:"stretch"},children:[e.jsx("button",{onClick:I,disabled:(i.features||[]).filter(k).findIndex(v=>v===t)===0,tabIndex:"-1",style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(i.features||[]).filter(A).length>=2&&(i.features||[]).filter(k).findIndex(v=>v===t)!==0&&t.name.trim()?"white":"var(--text-secondary)",cursor:(i.features||[]).filter(A).length>=2&&(i.features||[]).filter(k).findIndex(v=>v===t)!==0&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↑"}),e.jsx("button",{onClick:()=>y(t),disabled:!t.name.trim()&&!t.description.trim(),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:x[l(t)]?"var(--danger)":"var(--gray-700)",color:!t.name.trim()&&!t.description.trim()?"var(--text-secondary)":"white",cursor:!t.name.trim()&&!t.description.trim()?"not-allowed":"pointer",opacity:!t.name.trim()&&!t.description.trim()?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"×"}),e.jsx("button",{onClick:p,disabled:(i.features||[]).filter(k).findIndex(v=>v===t)===(i.features||[]).filter(k).length-1,style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(i.features||[]).filter(A).length>=2&&(i.features||[]).filter(k).findIndex(v=>v===t)<(i.features||[]).filter(k).length-1&&((D=(i.features||[]).filter(k)[(i.features||[]).filter(k).findIndex(v=>v===t)+1])!=null&&D.name.trim())&&t.name.trim()?"white":"var(--text-secondary)",cursor:(i.features||[]).filter(A).length>=2&&(i.features||[]).filter(k).findIndex(v=>v===t)<(i.features||[]).filter(k).length-1&&((Y=(i.features||[]).filter(k)[(i.features||[]).filter(k).findIndex(v=>v===t)+1])!=null&&Y.name.trim())&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↓"})]})},pe={transitions:{hoverIn:"all 0.1s ease",hoverOut:"all 0.3s ease"},card:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"8px",cursor:"pointer",transition:"all 0.1s ease",position:"relative"},cardHover:{backgroundColor:"var(--bg-card-hover)"},cardDead:{opacity:.6,backgroundColor:"var(--gray-800)",borderColor:"var(--border)"},cardAtMax:{backgroundColor:"var(--success)",borderColor:"var(--success)"},rowMain:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},rowTitle:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",margin:0},rowMeta:{display:"flex",gap:"8px",alignItems:"center"},badge:{padding:"2px 6px",borderRadius:"3px",fontSize:"10px",fontWeight:"600",textTransform:"uppercase"},typeBadge:{backgroundColor:"var(--purple)",color:"var(--text-primary)"},tierBadge:{backgroundColor:"var(--info)",color:"var(--text-primary)"},damageInputPopup:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,borderRadius:"8px"},damageInputContent:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"8px",padding:"8px",display:"flex",flexDirection:"row",gap:"8px",minWidth:"200px",alignItems:"center",position:"absolute",right:"1rem",top:"50%",transform:"translateY(-50%)"},damageInput:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"4px",padding:"4px 6px",color:"var(--text-primary)",fontSize:"16px",width:"80px",textAlign:"center"},damageIndicators:{display:"flex",gap:"8px",alignItems:"center",justifyContent:"center"},damageDrop:{fontSize:"16px",color:"var(--text-secondary)",cursor:"pointer",transition:"color 0.1s ease"},applyButton:{backgroundColor:"var(--gray-600)",color:"white",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"32px",minHeight:"32px"}},kt=(t,s,i,g)=>{const[y,x]=j.useState(!1),[l,I]=j.useState("");j.useEffect(()=>{if(y){const v=R=>{R.target.closest(".damage-input-popup")||(x(!1),I(""))};return document.addEventListener("click",v),()=>document.removeEventListener("click",v)}},[y]);const p=v=>{v.stopPropagation(),v.preventDefault();const R=t.hp||0,X=t.hpMax||1,B=v.currentTarget.getBoundingClientRect(),L=v.clientX-B.left,C=B.width/X;Math.floor(L/C)<R?i&&i(t.id,1,t.hp):s&&s(t.id,1,t.hp,t.hpMax)},k=v=>{v.stopPropagation(),v.preventDefault();const R=t.stress||0,X=t.stressMax||1,B=v.currentTarget.getBoundingClientRect(),L=v.clientX-B.left,C=B.width/X;Math.floor(L/C)<R?g&&g(t.id,-1,t.stress,t.stressMax):g&&g(t.id,1,t.stress,t.stressMax)},A=v=>{v.stopPropagation(),(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")&&(x(!0),I(t.type==="Minion"?"1":""))},D=()=>{const v=parseInt(l);if(v>0){if(t.type==="Minion")s&&s(t.id,v,t.hp,t.hpMax);else{let R=0;v>=t.thresholds.severe?R=3:v>=t.thresholds.major?R=2:v>=1&&(R=1),s&&s(t.id,R,t.hp,t.hpMax)}x(!1),I("")}};return{showDamageInput:y,damageValue:l,setDamageValue:I,setShowDamageInput:x,handleHpClick:p,handleStressClick:k,handleDifficultyClick:A,applyDamage:D,handleKeyDown:v=>{v.key==="Enter"?D():v.key==="Escape"&&(x(!1),I(""))}}},Pe=({item:t,type:s,mode:i="expanded",onClick:g,onDelete:y,onApplyDamage:x,onApplyHealing:l,onApplyStressChange:I,onUpdate:p,adversaries:k=[],isSelected:A=!1,isEditMode:D=!1,instances:Y=[],isEmbedded:v=!1})=>{const[R,X]=j.useState({}),B=u=>{const G=(t.features||[]).filter(w=>w.type===u.type).findIndex(w=>w===u);return`${u.type}-${G}-${u.name||"blank"}`},L=u=>{const h=B(u);if(R[h]){const G=t.features.filter(w=>w!==u);p&&p(t.id,{features:G}),X(w=>{const W={...w};return delete W[h],W})}else X(G=>({...G,[h]:!0})),setTimeout(()=>{X(G=>{const w={...G};return delete w[h],w})},3e3)},C=kt(t,x,l,I);(s==="adversary"||s==="adversaries")&&C.handleDifficultyClick;const[T,E]=j.useState(!1),H=()=>{E(!0)},te=()=>{E(!1)},F=(u=!1)=>{let h={...pe.card};if(A?h.transition="none":h.transition=T?pe.transitions.hoverIn:pe.transitions.hoverOut,u){const{marginTop:G,...w}=h;h=w}return(T&&i!=="expanded"||A)&&(h={...h,...pe.cardHover}),s==="adversary"&&(t.hp||0)>=(t.hpMax||1)&&(h={...h,...pe.cardDead}),h},ce=()=>{if(v)return"";let u="border rounded-lg";return(T&&i!=="expanded"||A)&&(u+=" border-hover"),u},$=()=>{var u;if(s==="adversary"||s==="adversaries"){const h=t.baseName||((u=t.name)==null?void 0:u.replace(/\s+\(\d+\)$/,""))||"",G=t.duplicateNumber||1,w=[...k];return k.some(Q=>Q.id===t.id)||w.push(t),w.filter(Q=>Q.baseName===h).length>1?`${h} (${G})`:h}return t.name},de=()=>{const u=[];return t.type&&u.push(e.jsx("span",{style:{...pe.badge,...pe.typeBadge},children:t.type},"type")),u},ae=()=>s!=="adversary"||!C.showDamageInput||!(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")?null:e.jsx("div",{className:"damage-input-popup",style:pe.damageInputPopup,onClick:u=>{u.stopPropagation(),u.target===u.currentTarget&&(s==="adversary"||s==="adversaries")&&(C.setShowDamageInput(!1),C.setDamageValue(""))},children:e.jsxs("div",{className:"border rounded-lg",style:{...pe.damageInputContent,borderColor:"var(--border)"},onClick:u=>u.stopPropagation(),children:[e.jsx("input",{type:"number",inputMode:"numeric",enterKeyHint:"done",placeholder:"dmg",min:(t.type==="Minion","0"),value:s==="adversary"||s==="adversaries"?C.damageValue:"",onChange:u=>{(s==="adversary"||s==="adversaries")&&C.setDamageValue(u.target.value)},onKeyDown:s==="adversary"||s==="adversaries"?C.handleKeyDown:void 0,className:"border rounded-sm",style:{...pe.damageInput,borderColor:"var(--border)"},autoFocus:!0}),e.jsxs("div",{style:pe.damageIndicators,children:[t.type==="Minion"?(()=>{var W,K;const u=parseInt(s==="adversary"||s==="adversaries"?C.damageValue:"0")||0,h=(W=t.features)==null?void 0:W.find(Q=>{var m;return(m=Q.name)==null?void 0:m.startsWith("Minion (")}),G=h?parseInt(((K=h.name.match(/\((\d+)\)/))==null?void 0:K[1])||"1"):1,w=Math.floor(u/G);return u>=G&&w>0?e.jsxs("span",{style:{...pe.damageDrop,color:"var(--red)"},title:`${u} damage can defeat ${w+1} minion${w+1!==1?"s":""} (1 + ${w} additional)`,children:["+",w," additional minion(s)"]}):e.jsx("span",{style:pe.damageDrop,title:`${u} damage defeats this minion only`,children:"+0 additional minion(s)"})})():[1,2,3].map(u=>{const h=parseInt(s==="adversary"||s==="adversaries"?C.damageValue:"0")||0;let G=!1;return u===1&&h>=1&&(G=!0),u===2&&h>=t.thresholds.major&&(G=!0),u===3&&h>=t.thresholds.severe&&(G=!0),e.jsx("span",{style:{...pe.damageDrop,color:G?"var(--red)":"var(--text-secondary)"},onClick:w=>{w.stopPropagation(),(s==="adversary"||s==="adversaries")&&(u===1?C.setDamageValue("1"):u===2?C.setDamageValue(t.thresholds.major.toString()):u===3&&C.setDamageValue(t.thresholds.severe.toString()))},title:`Click to set damage to ${u===1?"1":u===2?t.thresholds.major:t.thresholds.severe}`,children:e.jsx(Be,{size:16})},u)}),e.jsx("button",{style:{...pe.applyButton,backgroundColor:"var(--gray-600)"},onClick:u=>{u.stopPropagation(),(s==="adversary"||s==="adversaries")&&(!C.damageValue||parseInt(C.damageValue)<1?(C.setShowDamageInput(!1),C.setDamageValue("")):C.applyDamage())},title:!C.damageValue||parseInt(C.damageValue)<1?"Close damage input":"Apply damage",children:!C.damageValue||parseInt(C.damageValue)<1?e.jsx(Me,{size:16}):e.jsx(ct,{size:16})})]})]})}),ie=()=>{var G,w,W,K,Q;const u=(t.hp||0)>=(t.hpMax||1),h=i==="edit";return e.jsxs("div",{className:ce(),style:{...F(!0),padding:0,minHeight:"400px",opacity:u?.7:1,backgroundColor:u?"var(--gray-900)":F(!0).backgroundColor,borderColor:u?"color-mix(in srgb, var(--gray-600) 40%, transparent)":A?"var(--purple)":T&&i!=="expanded"?"var(--border-hover)":"var(--border)",borderWidth:"2px",display:"flex",flexDirection:"column",position:"relative"},onClick:g,...i!=="expanded"&&{onMouseEnter:H,onMouseLeave:te},children:[u&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                45deg,
                transparent,
                transparent 8px,
                var(--gray-600) 1px,
                var(--gray-600) 9px
              )`,pointerEvents:"none",zIndex:9999}}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"var(--text-secondary)",fontSize:"1rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em",zIndex:1e4,pointerEvents:"none",textShadow:"1px 1px 2px rgba(0, 0, 0, 0.5)",backgroundColor:"var(--gray-900)",padding:"0.25rem 0.5rem",borderRadius:"0.5rem",border:"0.5px solid var(--gray-600)"},children:"DEFEATED"})]}),e.jsx("div",{className:"border-b",style:{padding:"8px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative",zIndex:u?1:"auto",borderBottomColor:A?"var(--purple)":"var(--border)"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",position:"relative",zIndex:u?1:"auto"},children:[h?e.jsx("input",{type:"text",value:t.name||"",onChange:m=>{p&&p(t.id,{name:m.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"4px",color:"var(--text-primary)",fontSize:"1.1rem",fontWeight:"600",padding:"0.5rem",width:"100%",maxWidth:"300px"},placeholder:"Adversary name"}):e.jsx("h4",{style:{...pe.rowTitle,color:u?"color-mix(in srgb, var(--gray-400) 80%, transparent)":pe.rowTitle.color,textAlign:"left",margin:0,fontSize:"1.1rem"},children:((G=t.name)==null?void 0:G.replace(/\s+\(\d+\)$/,""))||t.name}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[(t.type||h)&&e.jsx("div",{children:h?e.jsxs("select",{value:t.type||"",onChange:m=>{p&&p(t.id,{type:m.target.value})},style:{backgroundColor:"var(--purple)",border:"1px solid var(--border)",borderRadius:"3px",color:"var(--text-primary)",fontSize:"14px",fontWeight:"600",textTransform:"uppercase",padding:"2px 6px",outline:"none"},children:[e.jsx("option",{value:"Standard",children:"Standard"}),e.jsx("option",{value:"Solo",children:"Solo"}),e.jsx("option",{value:"Bruiser",children:"Bruiser"}),e.jsx("option",{value:"Horde",children:"Horde"}),e.jsx("option",{value:"Minion",children:"Minion"}),e.jsx("option",{value:"Ranged",children:"Ranged"}),e.jsx("option",{value:"Leader",children:"Leader"}),e.jsx("option",{value:"Skulk",children:"Skulk"}),e.jsx("option",{value:"Social",children:"Social"}),e.jsx("option",{value:"Support",children:"Support"})]}):e.jsx("span",{style:{...pe.badge,...pe.typeBadge},children:t.type})}),(t.tier||h)&&e.jsx("div",{children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[e.jsx(it,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)"}}),h?e.jsx("input",{type:"text",value:t.tier||"",onChange:m=>{const U=m.target.value.replace(/[^1-4]/g,"");U.length<=1&&p&&p(t.id,{tier:U===""?"":parseInt(U)})},onKeyDown:m=>{if(m.key==="ArrowUp"){m.preventDefault();const U=parseInt(t.tier)||1;p&&p(t.id,{tier:Math.min(U+1,4)})}else if(m.key==="ArrowDown"){m.preventDefault();const U=parseInt(t.tier)||1;p&&p(t.id,{tier:Math.max(U-1,1)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.75rem",fontWeight:600,width:"20px",textAlign:"center",outline:"none"},maxLength:"1"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",fontWeight:600,color:"white",pointerEvents:"none"},children:t.tier})]})})]})]})}),e.jsxs("div",{style:{borderRadius:"0 0 8px 8px"},children:[(t.motives||h)&&e.jsx("div",{style:{padding:"0.5rem 8px",textAlign:"center"},children:h?e.jsx("input",{type:"text",value:t.motives||"",onChange:m=>p&&p(t.id,{motives:m.target.value}),placeholder:"Enter motives (e.g., Hunt, defend, patrol)",style:{width:"100%",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}):e.jsxs("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4},children:[t.motives,t.motives&&!t.motives.endsWith(".")?".":""]})}),(t.difficulty||t.atk!==void 0||t.thresholds&&t.type!=="Minion"||t.experience&&t.experience.length>0||h)&&e.jsxs("div",{style:{padding:"0.5rem 8px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[(t.difficulty||h)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",width:"36px"},children:[e.jsx(lt,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(0deg)"}}),h?e.jsx("input",{type:"text",value:t.difficulty||"",onChange:m=>{const U=m.target.value.replace(/[^0-9]/g,"");U.length<=2&&p&&p(t.id,{difficulty:parseInt(U)||0})},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.75rem",fontWeight:600,width:"20px",textAlign:"center",outline:"none"},maxLength:"2"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",fontWeight:600,color:"white",pointerEvents:"none"},children:t.difficulty})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Difficulty"})]}),(t.atk!==void 0||h)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",width:"36px"},children:[e.jsx(dt,{size:36,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(45deg)"}}),h?e.jsx("input",{type:"text",value:t.atk||"",onChange:m=>{const U=m.target.value.replace(/[^0-9+\-d]/g,"");U.length<=3&&p&&p(t.id,{atk:U})},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.75rem",fontWeight:600,width:"20px",textAlign:"center",outline:"none"},maxLength:"3"}):e.jsxs("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",fontWeight:600,color:"white",pointerEvents:"none"},children:[t.atk>=0?"+":"",t.atk]})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Attack"})]})]}),e.jsx("div",{children:h?e.jsx("textarea",{value:(t.experience||[]).join(", ")||"",onChange:m=>{const U=m.target.value.split(",").map(f=>f.trim()).filter(f=>f.length>0);p&&p(t.id,{experience:U})},placeholder:"Enter experience tags (e.g., Battle Hardened +3, Keen Senses +2)",rows:3,style:{width:"100%",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"vertical"}}):e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:t.experience&&t.experience.length>0?t.experience.map((m,U)=>{if(typeof m=="string"){const f=m.match(/^(.+?)\s*([+-]?\d+)$/);if(f){const[,O,n]=f;return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("span",{style:{fontSize:"0.75rem",fontWeight:600,color:"var(--text-primary)"},children:n})})}),e.jsx("span",{style:{marginLeft:"32px"},children:O})]},U)}else return e.jsx("div",{style:{marginBottom:"0.25rem"},children:m},U)}else return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("span",{style:{fontSize:"0.75rem",fontWeight:600,color:"var(--text-primary)"},children:[m.modifier>=0?"+":"",m.modifier]})})}),e.jsx("span",{style:{marginLeft:"32px"},children:m.name})]},U)}):null})})]}),(t.features&&t.features.length>0||h)&&e.jsxs("div",{style:{padding:"0 8px 8px 8px"},children:[t.atk!==void 0&&t.weapon&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Standard Attack"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:h?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)"},children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[e.jsx("input",{type:"text",value:t.weapon||"",onChange:m=>p&&p(t.id,{weapon:m.target.value}),placeholder:"Standard attack name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}}),e.jsxs("select",{value:t.range||"",onChange:m=>p&&p(t.id,{range:m.target.value}),style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",appearance:"none",backgroundImage:`url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",backgroundSize:"1rem",paddingRight:"2rem"},children:[e.jsx("option",{value:"",children:"Range"}),e.jsx("option",{value:"Melee",children:"Melee"}),e.jsx("option",{value:"Very Close",children:"Very Close"}),e.jsx("option",{value:"Close",children:"Close"}),e.jsx("option",{value:"Far",children:"Far"}),e.jsx("option",{value:"Very Far",children:"Very Far"})]}),e.jsx("input",{type:"text",value:t.damage||"",onChange:m=>p&&p(t.id,{damage:m.target.value}),placeholder:"Damage (e.g., 1d6+2)",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}})]})}):t.atk!==void 0&&t.weapon&&e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:t.weapon}),e.jsxs("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:["Make an attack against a target within ",t.range||"Melee"," range. On a success, deal ",t.damage||"damage varies","."]})]})})]}),(t.features.filter(m=>m.type==="Action").length>0||h)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Actions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const m=t.features.filter(f=>f.type==="Action");return(h&&m.length===0?[{type:"Action",name:"",description:""}]:m).map((f,O)=>h?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:f.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false","data-lpignore":"true","data-form-type":"other",name:`feature-name-${f.type.toLowerCase()}`,onChange:n=>{const o=[...t.features||[]],a=o.findIndex(b=>b.type==="Action"&&b===f);a>=0?o[a]={...o[a],name:n.target.value}:o.push({type:"Action",name:n.target.value,description:f.description||""});const r=o.filter(b=>b.type==="Action"),d=r[r.length-1];d&&d.name.trim()&&o.push({type:"Action",name:"",description:""}),p&&p(t.id,{features:o})},placeholder:"Action name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:f.description||"",onChange:n=>{const o=[...t.features||[]],a=o.findIndex(b=>b.type==="Action"&&b===f);a>=0?o[a]={...o[a],description:n.target.value}:o.push({type:"Action",name:f.name||"",description:n.target.value});const r=o.filter(b=>b.type==="Action"),d=r[r.length-1];d&&d.name.trim()&&o.push({type:"Action",name:"",description:""}),p&&p(t.id,{features:o})},onInput:n=>{const o=n.target.offsetHeight;n.target.style.height="auto";const a=n.target.scrollHeight,r=a>o?a:o;n.target.style.height=r+"px"},placeholder:"Action description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(We,{feature:f,featureType:"Action",item:t,onUpdate:p,handleFeatureDeleteClick:L,deleteConfirmations:R,getFeatureKey:B})]},O):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:f.name}),f.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:f.description})]},O))})()})]}),(t.features.filter(m=>m.type==="Passive").length>0||h)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Passives"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const m=t.features.filter(f=>f.type==="Passive");return(h&&m.length===0?[{type:"Passive",name:"",description:""}]:m).map((f,O)=>h?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:f.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:n=>{const o=[...t.features||[]],a=o.findIndex(b=>b.type==="Passive"&&b===f);a>=0?o[a]={...o[a],name:n.target.value}:o.push({type:"Passive",name:n.target.value,description:f.description||""});const r=o.filter(b=>b.type==="Passive"),d=r[r.length-1];d&&d.name.trim()&&o.push({type:"Passive",name:"",description:""}),p&&p(t.id,{features:o})},placeholder:"Passive name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:f.description||"",onChange:n=>{const o=[...t.features||[]],a=o.findIndex(b=>b.type==="Passive"&&b===f);a>=0?o[a]={...o[a],description:n.target.value}:o.push({type:"Passive",name:f.name||"",description:n.target.value});const r=o.filter(b=>b.type==="Passive"),d=r[r.length-1];d&&d.name.trim()&&o.push({type:"Passive",name:"",description:""}),p&&p(t.id,{features:o})},onInput:n=>{const o=n.target.offsetHeight;n.target.style.height="auto";const a=n.target.scrollHeight,r=a>o?a:o;n.target.style.height=r+"px"},placeholder:"Passive description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(We,{feature:f,featureType:"Passive",item:t,onUpdate:p,handleFeatureDeleteClick:L,deleteConfirmations:R,getFeatureKey:B})]},O):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:f.name}),f.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:f.description})]},O))})()})]}),(t.features.filter(m=>m.type==="Reaction").length>0||h)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Reactions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const m=t.features.filter(f=>f.type==="Reaction");return(h&&m.length===0?[{type:"Reaction",name:"",description:""}]:m).map((f,O)=>h?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:f.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:n=>{const o=[...t.features||[]],a=o.findIndex(b=>b.type==="Reaction"&&b===f);a>=0?o[a]={...o[a],name:n.target.value}:o.push({type:"Reaction",name:n.target.value,description:f.description||""});const r=o.filter(b=>b.type==="Reaction"),d=r[r.length-1];d&&d.name.trim()&&o.push({type:"Reaction",name:"",description:""}),p&&p(t.id,{features:o})},placeholder:"Reaction name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:f.description||"",onChange:n=>{const o=[...t.features||[]],a=o.findIndex(b=>b.type==="Reaction"&&b===f);a>=0?o[a]={...o[a],description:n.target.value}:o.push({type:"Reaction",name:f.name||"",description:n.target.value});const r=o.filter(b=>b.type==="Reaction"),d=r[r.length-1];d&&d.name.trim()&&o.push({type:"Reaction",name:"",description:""}),p&&p(t.id,{features:o})},onInput:n=>{const o=n.target.offsetHeight;n.target.style.height="auto";const a=n.target.scrollHeight,r=a>o?a:o;n.target.style.height=r+"px"},placeholder:"Reaction description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(We,{feature:f,featureType:"Reaction",item:t,onUpdate:p,handleFeatureDeleteClick:L,deleteConfirmations:R,getFeatureKey:B})]},O):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:f.name}),f.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:f.description})]},O))})()})]})]})]}),(Y&&Y.length>0||t.type!=="Minion"&&(t.thresholds||h))&&e.jsxs("div",{style:{padding:"0 8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Status"})]}),Y&&Y.length>0&&Y.map((m,U)=>{const f=(m.hp||0)>=(m.hpMax||1);return e.jsx("div",{children:e.jsxs("div",{style:{backgroundColor:"var(--bg-primary)",borderRadius:"4px",padding:"4px",border:"1px solid var(--border)",marginBottom:"4px",display:"flex",justifyContent:"flex-start",alignItems:"center",gap:"8px",opacity:f?.7:1,backgroundColor:f?"var(--gray-900)":"var(--bg-secondary)",borderColor:f?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--border)",position:"relative"},children:[f&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                          45deg,
                          transparent 0px,
                          transparent 8px,
                          var(--gray-600) 9px,
                          var(--gray-600) 9px
                        )`,pointerEvents:"none",zIndex:1,borderRadius:"4px"}}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"var(--text-secondary)",fontSize:"0.75rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em",zIndex:2,backgroundColor:"var(--gray-900)",padding:"0.125rem 0.25rem",borderRadius:"0.25rem",border:"0.5px solid var(--gray-600)"},children:"DEFEATED"})]}),e.jsx("div",{style:{backgroundColor:"var(--bg-primary)",borderRadius:"6px",border:"1px solid var(--border-hover)",width:"32px",textAlign:"center",flexShrink:0,padding:"2px"},children:e.jsx("span",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)"},children:m.duplicateNumber||1})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"2px"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:O=>{if(O.stopPropagation(),!x||s!=="adversary")return;O.currentTarget.getBoundingClientRect();const n=O.currentTarget.querySelector(".pip-container");if(!n)return;const o=n.getBoundingClientRect(),a=O.clientX-o.left,r=m.hp||0,d=m.hpMax||1;if(a<0){r>0&&l&&l(m.id,1,r);return}if(a>o.width){r<d&&x(m.id,1,r,d);return}const b=o.width,P=b*.05,le=b-2*P,Z=a-P,z=r/d,c=le*z;Z<c?r>0&&l&&l(m.id,1,r):r<d&&x(m.id,1,r,d)},children:e.jsx("div",{className:"pip-container",style:{display:"flex",gap:"2px",alignItems:"center"},children:Array.from({length:m.hpMax||1},(O,n)=>e.jsx("span",{style:{fontSize:"0.75rem",color:n<(m.hp||0)?"var(--red)":"var(--text-secondary)",transition:"all 0.1s ease"},children:e.jsx(Be,{size:16})},n))})}),m.stressMax>0&&e.jsx("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:O=>{if(O.stopPropagation(),!I||s!=="adversary")return;O.currentTarget.getBoundingClientRect();const n=O.currentTarget.querySelector(".pip-container");if(!n)return;const o=n.getBoundingClientRect(),a=O.clientX-o.left,r=m.stress||0,d=m.stressMax;if(a<0){r>0&&I(m.id,-1);return}if(a>o.width){r<d&&I(m.id,1);return}const b=o.width,P=b*.05,le=b-2*P,Z=a-P,z=r/d,c=le*z;Z<c?r>0&&I(m.id,-1):r<d&&I(m.id,1)},children:e.jsx("div",{className:"pip-container",style:{display:"flex",gap:"2px",alignItems:"center"},children:Array.from({length:m.stressMax},(O,n)=>e.jsx("span",{style:{fontSize:"0.75rem",color:n<(m.stress||0)?"var(--gold)":"var(--text-secondary)",transition:"all 0.1s ease"},children:e.jsx(_e,{size:16})},n))})})]})]},m.id)},m.id)}),t.type!=="Minion"&&(t.thresholds||h)&&e.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:"0.5rem"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",height:"36px"},children:[e.jsx("svg",{width:"300",height:"36",viewBox:"0 0 300 36",style:{position:"absolute",zIndex:1},children:e.jsx("rect",{x:"20",y:"6",width:"260",height:"24",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4"})}),e.jsx("div",{style:{position:"relative",zIndex:2,display:"flex",alignItems:"center",gap:"0.5rem"},children:h?e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",fontSize:"0.8rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"Minor"}),e.jsx(Ce,{value:((w=t.thresholds)==null?void 0:w.major)||"7"}),e.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"Major"}),e.jsx(Ce,{value:((W=t.thresholds)==null?void 0:W.severe)||"14"}),e.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"Severe"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.8rem",fontWeight:500},children:"Minor"}),e.jsx(Ce,{value:((K=t.thresholds)==null?void 0:K.major)||"7"}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.8rem",fontWeight:500},children:"Major"}),e.jsx(Ce,{value:((Q=t.thresholds)==null?void 0:Q.severe)||"14"}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.8rem",fontWeight:500},children:"Severe"})]})})]})})})]}),h&&e.jsxs("div",{style:{marginBottom:"1rem",padding:"0 8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px",textAlign:"center",minWidth:"80px"},children:"Description"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),h?e.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-primary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"none",overflow:"hidden",fontFamily:"inherit"},value:t.description,onChange:m=>{m.target.style.height="auto",m.target.style.height=m.target.scrollHeight+"px",p&&p(t.id,{description:m.target.value})},placeholder:"Enter adversary description..."}):e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",whiteSpace:"pre-wrap"},children:t.description})]}),ae()]})};return(i==="expanded"||i==="edit")&&(s==="adversary"||s==="adversaries")?ie():s==="adversary"||s==="adversaries"?null:e.jsxs("div",{className:ce(),style:F(!0),children:[e.jsxs("div",{style:pe.rowMain,children:[e.jsx("h4",{style:pe.rowTitle,children:$()}),e.jsx("div",{style:pe.rowMeta,children:de()})]}),e.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"12px",margin:0},children:["Expanded view coming soon for ",s]})]})},Et="modulepreload",It=function(t){return"/Daggerheart/"+t},qe={},we=function(s,i,g){if(!i||i.length===0)return s();const y=document.getElementsByTagName("link");return Promise.all(i.map(x=>{if(x=It(x),x in qe)return;qe[x]=!0;const l=x.endsWith(".css"),I=l?'[rel="stylesheet"]':"";if(!!g)for(let A=y.length-1;A>=0;A--){const D=y[A];if(D.href===x&&(!l||D.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${x}"]${I}`))return;const k=document.createElement("link");if(k.rel=l?"stylesheet":Et,l||(k.as="script",k.crossOrigin=""),k.href=x,document.head.appendChild(k),l)return new Promise((A,D)=>{k.addEventListener("load",A),k.addEventListener("error",()=>D(new Error(`Unable to preload CSS for ${x}`)))})})).then(()=>s()).catch(x=>{const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=x,window.dispatchEvent(l),!l.defaultPrevented)throw x})},At=({onSave:t,onRefresh:s,onAddItem:i})=>{const[g,y]=j.useState({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:11,thresholds:{major:7,severe:12},hpMax:3,stressMax:1,atk:1,weapon:"",range:"Melee",damage:"",experience:[],features:[]}),[x,l]=j.useState(!1),I=async()=>{if(!g.name.trim()){alert("Please enter a name for the adversary");return}l(!0);try{const k={...g,hp:0,stress:0,source:"Homebrew"},A=await t(k);i&&A&&i(A),s&&await s(),y({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:11,thresholds:{major:7,severe:12},hpMax:3,stressMax:1,atk:1,weapon:"",range:"Melee",damage:"",experience:[],features:[]}),alert("Custom adversary created successfully!")}catch(k){console.error("Error saving adversary:",k),alert("Error saving adversary. Please try again.")}finally{l(!1)}},p={...g,id:"new-adversary",hp:0,stress:0,source:"Homebrew"};return e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem",display:"flex",justifyContent:"center",alignItems:"flex-start"},children:e.jsxs("div",{style:{maxWidth:"600px",width:"100%"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h2",{style:{color:"var(--text-primary)",fontSize:"1.5rem",fontWeight:"600",margin:0},children:"Create Custom Adversary"}),e.jsx("button",{onClick:I,disabled:x||!g.name.trim(),style:{padding:"0.75rem 1.5rem",backgroundColor:x||!g.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"8px",cursor:x||!g.name.trim()?"not-allowed":"pointer",fontSize:"1rem",fontWeight:"600",opacity:x||!g.name.trim()?.6:1},children:x?"Creating...":"Create and Add"})]}),e.jsx(Pe,{item:p,type:"adversary",mode:"edit",onUpdate:(k,A)=>{y(D=>({...D,...A}))}})]})})},zt=(t,s)=>{const[i,g]=j.useState("max-content"),y=j.useCallback(()=>{if(!s.current||t<=3)return"max-content";const x=s.current.offsetWidth,I=Math.floor(x/120);return I<=1?"max-content":t===4?"max-content max-content":t===5||t===6?I>=2?"max-content max-content":"max-content":t===7?I>=3?"max-content max-content max-content":I>=2?"max-content max-content":"max-content":"repeat(auto-fit, minmax(80px, max-content))"},[t,s]);return j.useEffect(()=>{const x=y();g(x);const l=new ResizeObserver(()=>{const I=y();g(I)});return s.current&&l.observe(s.current),()=>{l.disconnect()}},[y]),i},Wt=({encounter:t})=>{var y,x;const s=j.useRef(null),i=((y=t.encounterItems)==null?void 0:y.length)||0,g=zt(i,s);return e.jsx("div",{ref:s,className:"saved-encounter-adversary-list",style:{flex:1,fontSize:"0.8rem",color:"var(--text-secondary)",lineHeight:"1.3",display:"grid",gridTemplateColumns:g,gap:"0.25rem 1rem",gridAutoRows:"min-content"},children:((x=t.encounterItems)==null?void 0:x.length)>0?t.encounterItems.map((l,I)=>{var k;const p=l.item.baseName||((k=l.item.name)==null?void 0:k.replace(/\s+\(\d+\)$/,""))||l.item.name;return e.jsxs("div",{style:{marginBottom:"0.125rem"},children:[l.quantity,"x ",p]},I)}):e.jsx("div",{children:"No adversaries"})})},ve={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},Se={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1,lowerTierAdversary:1};let ke={adversaries:[]},Ee={environments:[]},Ie=!1;const Je=()=>{const t=JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]"),s=JSON.parse(localStorage.getItem("daggerheart-custom-environments")||"[]");return{customAdversaries:t,customEnvironments:s}},Rt=(t,s)=>{t==="adversary"?localStorage.setItem("daggerheart-custom-adversaries",JSON.stringify(s)):t==="environment"&&localStorage.setItem("daggerheart-custom-environments",JSON.stringify(s))},Te=async()=>{if(Ie)return;let t={adversaries:[]},s={environments:[]},i={adversaries:[]},g={environments:[]};try{const l=await we(()=>import("./adversaries-9c8932de.js"),[]);t=(l==null?void 0:l.default)||l}catch(l){console.warn("Failed to load adversaries.json:",l)}try{const l=await we(()=>import("./environments-c340637c.js"),[]);s=(l==null?void 0:l.default)||l}catch(l){console.warn("Failed to load environments.json:",l)}try{const l=await we(()=>import("./playtest-adversaries-4a099c10.js"),[]);i=(l==null?void 0:l.default)||l}catch(l){console.warn("Failed to load playtest-adversaries.json:",l)}try{const l=await we(()=>import("./playtest-environments-d9cdffb6.js"),[]);g=(l==null?void 0:l.default)||l}catch(l){console.warn("Failed to load playtest-environments.json:",l)}const{customAdversaries:y,customEnvironments:x}=Je();ke={...t,adversaries:[...t.adversaries||[],...i.adversaries||[],...y]},Ee={...s,environments:[...s.environments||[],...g.environments||[],...x]},Ie=!0,console.log(`Loaded ${ke.adversaries.length} adversaries and ${Ee.environments.length} environments`)},Nt=t=>{const{customAdversaries:s}=Je(),i={...t,id:`custom-${Date.now()}-${Math.random().toString(36).slice(2,10)}`,source:t.source||"Homebrew"},g=[...s,i];return Rt("adversary",g),Ie=!1,Te(),i},Bt=(t,s=[],i=4,g=1)=>{const[y,x]=j.useState(""),[l,I]=j.useState([{field:"tier",direction:"asc"},{field:"name",direction:"asc"}]),[p,k]=j.useState([]),[A,D]=j.useState(!0),[Y,v]=j.useState([]),[R,X]=j.useState([]),[B,L]=j.useState(!1),[C,T]=j.useState(!1),E=j.useRef(null),H=j.useRef(null);j.useEffect(()=>{(async()=>{await Te(),D(!1);let W=[];t==="adversary"?W=ke.adversaries||[]:t==="environment"&&(W=Ee.environments||[]),k(W)})()},[t]);const te=j.useCallback(async()=>{Ie=!1,await Te();let w=[];t==="adversary"?w=ke.adversaries||[]:t==="environment"&&(w=Ee.environments||[]),k(w)},[t]),F=w=>{const W=p.map(K=>K[w]).filter(Boolean);return[...new Set(W)].sort((K,Q)=>typeof K=="number"&&typeof Q=="number"?K-Q:String(K).localeCompare(String(Q)))},ce=F("tier"),$=F("type"),de=j.useMemo(()=>{let w=p.filter(W=>{var U,f;const K=W.name.toLowerCase().includes(y.toLowerCase())||((U=W.type)==null?void 0:U.toLowerCase().includes(y.toLowerCase()))||((f=W.description)==null?void 0:f.toLowerCase().includes(y.toLowerCase())),Q=Y.length===0||(Y.includes("party-tier")?W.tier===g:Y.includes(W.tier.toString())),m=R.length===0||R.includes(W.type);return K&&Q&&m});return w.sort((W,K)=>{for(const Q of l){const{field:m,direction:U}=Q;let f=W[m],O=K[m];if(m==="tier")f=parseInt(f)||0,O=parseInt(O)||0;else if(m==="cost"){const n=o=>{if(t!=="adversary")return 0;const a=ve[o.type]||2;let r=0;const d=s.filter(P=>P.type==="adversary"&&P.item.type==="Solo"&&P.quantity>0).reduce((P,le)=>P+le.quantity,0),b=s.filter(P=>P.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(P.item.type)&&P.quantity>0).reduce((P,le)=>P+le.quantity,0);return o.type==="Solo"&&d===1&&(r+=2),["Bruiser","Horde","Leader","Solo"].includes(o.type)&&b===0&&(r+=1),a+r};f=n(W),O=n(K)}else if(m==="difficulty"){const n=parseInt(f),o=parseInt(O);!isNaN(n)&&!isNaN(o)?(f=n,O=o):!isNaN(n)&&isNaN(o)?(f=n,O=999):isNaN(n)&&!isNaN(o)?(f=999,O=o):(f=String(f||"").toLowerCase(),O=String(O||"").toLowerCase())}else typeof f=="string"&&typeof O=="string"?(f=f.toLowerCase(),O=O.toLowerCase()):(f=String(f||"").toLowerCase(),O=String(O||"").toLowerCase());if(U==="asc"){if(f>O)return 1;if(f<O)return-1}else{if(f<O)return 1;if(f>O)return-1}}return 0}),w},[p,y,l,Y,R,s,i,g]),ae=w=>{I(W=>{const K=W.findIndex(Q=>Q.field===w);if(K>=0)if(K===0){const Q=[...W];return Q[0]={...Q[0],direction:Q[0].direction==="asc"?"desc":"asc"},Q}else{const Q=[...W];return Q.splice(K,1)[0],[{field:w,direction:"asc"},...Q]}else return[{field:w,direction:"asc"},...W]})},ie=w=>{v(w==="clear"?[]:w==="party-tier"?["party-tier"]:W=>W.includes(w)?W.filter(K=>K!==w):[...W,w])},re=w=>{X(w==="clear"?[]:W=>W.includes(w)?W.filter(K=>K!==w):[...W,w])},u=Y.length>0,h=R.length>0;return j.useEffect(()=>{const w=K=>{const Q=K.target.closest(".filter-dropdown"),m=K.target.closest(".header-filter-icon");Q||m||(L(!1),T(!1))},W=K=>{K.key==="Escape"&&(L(!1),T(!1))};return document.addEventListener("pointerdown",w,!0),document.addEventListener("mousedown",w,!0),document.addEventListener("touchstart",w,!0),document.addEventListener("click",w,!0),document.addEventListener("keydown",W,!0),()=>{document.removeEventListener("pointerdown",w,!0),document.removeEventListener("mousedown",w,!0),document.removeEventListener("touchstart",w,!0),document.removeEventListener("click",w,!0),document.removeEventListener("keydown",W,!0)}},[L,T]),{searchTerm:y,setSearchTerm:x,sortFields:l,handleSort:ae,filteredAndSortedData:de,loading:A,refreshData:te,selectedTiers:Y,selectedTypes:R,showTierDropdown:B,setShowTierDropdown:L,showTypeDropdown:C,setShowTypeDropdown:T,tierFilterRef:E,typeFilterRef:H,uniqueTiers:ce,uniqueTypes:$,handleTierSelect:ie,handleTypeSelect:re,isTierFiltered:u,isTypeFiltered:h,getDropdownStyle:w=>{if(!w.current)return{};const W=w.current.getBoundingClientRect();return{position:"fixed",top:W.bottom+4,left:W.left-100,zIndex:99999}}}},Lt=({searchTerm:t,onSearchChange:s,type:i,partyControls:g})=>e.jsxs("div",{style:V.browserHeader,children:[e.jsx("input",{type:"text",placeholder:"Search",value:t,onChange:y=>s(y.target.value),style:V.searchInput}),g&&e.jsx("div",{style:V.partyControls,children:g})]}),Tt=({sortFields:t,onSort:s,type:i,uniqueTiers:g,uniqueTypes:y,selectedTiers:x,selectedTypes:l,showTierDropdown:I,setShowTierDropdown:p,showTypeDropdown:k,setShowTypeDropdown:A,tierFilterRef:D,typeFilterRef:Y,handleTierSelect:v,handleTypeSelect:R,isTierFiltered:X,isTypeFiltered:B,getDropdownStyle:L,costFilter:C,showCostDropdown:T,setShowCostDropdown:E,costFilterRef:H,handleCostFilterSelect:te,isCostFiltered:F})=>{const[ce,$]=j.useState(null),ae=(()=>i==="adversary"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"cost",label:"Cost",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:i==="environment"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:[])(),ie=()=>{if(!T)return null;const u=[{value:"all",label:"All"},{value:"auto-grey",label:"Auto Grey"},{value:"auto-hide",label:"Auto Hide"}];return Ne.createPortal(e.jsx("div",{className:"filter-dropdown",style:{...V.filterDropdown,...L(H),maxHeight:"60vh",overflow:"auto"},onMouseDown:h=>h.stopPropagation(),onClick:h=>h.stopPropagation(),children:u.map(h=>{const G=C===h.value;return e.jsxs("div",{style:{...V.filterOption,...G?V.filterOptionSelected:{}},onClick:()=>te(h.value),children:[e.jsx("span",{style:V.checkIcon,children:G?e.jsx(be,{size:16}):e.jsx(je,{size:16})}),e.jsx("span",{style:V.filterLabel,children:h.label})]},h.value)})}),document.body)},re=(u,h,G,w,W,K,Q,m)=>{if(!W)return null;const U=()=>{(u==="tier"||u==="type")&&w("clear")};return Ne.createPortal(e.jsxs("div",{className:"filter-dropdown",style:{...V.filterDropdown,...L(Q),maxHeight:"60vh",overflow:"auto"},onMouseDown:f=>f.stopPropagation(),onClick:f=>f.stopPropagation(),children:[e.jsxs("div",{style:{...V.filterOption,...G.length===0?V.filterOptionSelected:{}},onClick:U,children:[e.jsx("span",{style:V.checkIcon,children:G.length===0?e.jsx(be,{size:16}):e.jsx(je,{size:16})}),e.jsx("span",{style:V.filterLabel,children:"All"})]}),u==="tier"&&e.jsxs("div",{style:{...V.filterOption,...G.includes("party-tier")?V.filterOptionSelected:{}},onClick:()=>w("party-tier"),children:[e.jsx("span",{style:V.checkIcon,children:G.includes("party-tier")?e.jsx(be,{size:16}):e.jsx(je,{size:16})}),e.jsx("span",{style:V.filterLabel,children:"Party Tier"})]}),h.map(f=>{const O=G.includes(f.toString());return e.jsxs("div",{style:{...V.filterOption,...O?V.filterOptionSelected:{}},onClick:()=>w(f.toString()),children:[e.jsx("span",{style:V.checkIcon,children:O?e.jsx(be,{size:16}):e.jsx(je,{size:16})}),e.jsx("span",{style:V.filterLabel,children:f})]},f)})]}),document.body)};return e.jsx("tr",{style:V.tableHeader,children:ae.map(u=>e.jsxs("th",{style:{...V.tableHeaderCell,...ce===u.key?V.tableHeaderCellHover:{},position:"relative",...u.key==="name"?{width:"auto",minWidth:"0"}:{},...u.key==="tier"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...u.key==="type"?{width:"80px",minWidth:"80px",maxWidth:"80px"}:{},...u.key==="difficulty"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...u.key==="cost"?{width:"50px",minWidth:"50px",maxWidth:"50px"}:{},...u.key==="action"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{}},onClick:()=>s(u.key),onMouseEnter:()=>$(u.key),onMouseLeave:()=>$(null),children:[u.hasFilter?e.jsxs("div",{style:V.headerWithFilter,children:[e.jsx("span",{style:{cursor:"pointer"},onClick:h=>{h.stopPropagation(),s(u.key)},children:u.label}),e.jsxs("button",{ref:u.key==="tier"?D:u.key==="type"?Y:H,style:{...V.headerFilterIcon,...u.key==="tier"&&X?V.headerFilterIconActive:{},...u.key==="type"&&B?V.headerFilterIconActive:{},...u.key==="cost"&&F?V.headerFilterIconActive:{}},className:"header-filter-icon",onClick:h=>{h.stopPropagation(),u.key==="tier"?(p(!I),A(!1),E(!1)):u.key==="type"?(A(!k),p(!1),E(!1)):u.key==="cost"&&(E(!T),p(!1),A(!1))},children:[e.jsx(pt,{size:14}),u.key==="tier"&&X||u.key==="type"&&B||u.key==="cost"&&F?e.jsx("span",{style:V.filterActiveDot}):null]})]}):u.label,u.key==="tier"&&re("tier",g,x,v,I,p,D),u.key==="type"&&re("type",y,l,R,k,A,Y),u.key==="cost"&&ie()]},u.key))})},Mt=({item:t,onAdd:s,type:i,onRowClick:g,encounterItems:y=[],pcCount:x=4,playerTier:l=1,remainingBudget:I=0,costFilter:p="auto-grey",onAdversaryClick:k})=>{const[A,D]=j.useState(!1),Y=()=>{s(t)},v=()=>{if(i!=="adversary")return null;const B=ve[t.type]||2;let L=0;const C=y.filter(E=>E.type==="adversary"&&E.item.type==="Solo"&&E.quantity>0).reduce((E,H)=>E+H.quantity,0),T=y.filter(E=>E.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(E.item.type)&&E.quantity>0).reduce((E,H)=>E+H.quantity,0);return t.type==="Solo"&&C===1&&(L+=2),["Bruiser","Horde","Leader","Solo"].includes(t.type)&&T===0&&(L+=1),B+L},X=(()=>{if(i==="adversary"){const B=v();ve[t.type];const L=B>I||I<=0;if(p==="auto-hide"&&L)return null;const C=p==="auto-grey"&&L?{opacity:.5,color:"var(--text-secondary)"}:{};return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...V.rowCell,width:"auto",minWidth:"0",textAlign:"left",...C},children:e.jsxs("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:[e.jsx("div",{style:{fontWeight:"600"},children:t.name}),t.description&&e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"0.125rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.description})]})}),e.jsx("td",{style:{...V.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...C},children:t.tier}),e.jsx("td",{style:{...V.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center",...C},children:t.type}),e.jsx("td",{style:{...V.rowCell,width:"50px",minWidth:"50px",maxWidth:"50px",textAlign:"center",...C},children:B}),e.jsx("td",{style:{...V.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...C},children:t.difficulty})]})}else if(i==="environment")return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...V.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:t.name}),e.jsx("td",{style:{...V.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:t.tier}),e.jsx("td",{style:{...V.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:t.type}),e.jsx("td",{style:{...V.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:t.difficulty})]});return null})();return X===null?null:e.jsx(e.Fragment,{children:e.jsxs("tr",{style:{...V.row,...A?V.rowHover:{}},onClick:()=>{i==="adversary"&&k?k(t):g&&g(t,i)},onMouseEnter:()=>D(!0),onMouseLeave:()=>D(!1),children:[X,e.jsx("td",{style:{width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",boxSizing:"border-box",overflow:"visible",textOverflow:"unset",whiteSpace:"nowrap"},children:e.jsx("button",{style:V.addButton,onClick:B=>{B.stopPropagation(),Y()},onMouseEnter:B=>{B.target.style.background="var(--bg-secondary)"},onMouseLeave:B=>{B.target.style.background="var(--purple)"},children:"+"})})]})})},Pt=({type:t,onAddItem:s,onCancel:i=null,onRowClick:g,encounterItems:y=[],pcCount:x=4,playerTier:l=1,partyControls:I=null,showContainer:p=!0,savedEncounters:k=[],onLoadEncounter:A,onDeleteEncounter:D,activeTab:Y="adversaries"})=>{const[v,R]=j.useState("all"),[X,B]=j.useState(!1),[L,C]=j.useState(null),[T,E]=j.useState({}),H=j.useRef({}),te=j.useRef(null),F=z=>{T[z]?(D&&D(z),E(c=>{const S={...c};return delete S[z],S}),H.current[z]&&(clearTimeout(H.current[z]),delete H.current[z])):(E(c=>({...c,[z]:!0})),H.current[z]&&clearTimeout(H.current[z]),H.current[z]=setTimeout(()=>{E(c=>{const S={...c};return delete S[z],S}),delete H.current[z]},3e3))};j.useEffect(()=>()=>{Object.values(H.current).forEach(z=>{clearTimeout(z)})},[]);const{searchTerm:ce,setSearchTerm:$,sortFields:de,handleSort:ae,filteredAndSortedData:ie,loading:re,refreshData:u,selectedTiers:h,selectedTypes:G,showTierDropdown:w,setShowTierDropdown:W,showTypeDropdown:K,setShowTypeDropdown:Q,tierFilterRef:m,typeFilterRef:U,uniqueTiers:f,uniqueTypes:O,handleTierSelect:n,handleTypeSelect:o,isTierFiltered:a,isTypeFiltered:r,getDropdownStyle:d}=Bt(t,y,x,l),P=(()=>{const z=3*x+2,c=y.reduce((N,oe)=>{if(oe.type==="adversary"){const ue=ve[oe.item.type]||2;if(oe.item.type==="Minion"){const se=Math.ceil(oe.quantity/x);return N+se*ue}else return N+oe.quantity*ue}return N},0);let S=0;y.filter(N=>N.type==="adversary"&&N.item.type==="Solo"&&N.quantity>0).reduce((N,oe)=>N+oe.quantity,0)>=2&&(S+=Se.twoOrMoreSolos);const q=y.some(N=>N.type==="adversary"&&N.item.type==="Bruiser"&&N.quantity>0),J=y.some(N=>N.type==="adversary"&&N.item.type==="Horde"&&N.quantity>0),ne=y.some(N=>N.type==="adversary"&&N.item.type==="Leader"&&N.quantity>0),_=y.some(N=>N.type==="adversary"&&N.item.type==="Solo"&&N.quantity>0);return!q&&!J&&!ne&&!_&&(S+=Se.noBruisersHordesLeadersSolos),z+S-c})(),le=z=>{R(z),B(!1)},Z=v!=="all";return re?e.jsx("div",{style:V.browser,children:e.jsx("div",{style:V.loading,children:"Loading..."})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:p?V.browserWrapper:V.browserWrapperNoContainer,children:[Y==="adversaries"&&e.jsxs(e.Fragment,{children:[e.jsx(Lt,{searchTerm:ce,onSearchChange:$,type:t,partyControls:I}),e.jsx("div",{className:"browser-content invisible-scrollbar",style:V.browserContent,children:e.jsxs("table",{style:V.browserTable,children:[e.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,backgroundColor:"var(--bg-primary)"},children:e.jsx(Tt,{sortFields:de,onSort:ae,type:t,uniqueTiers:f,uniqueTypes:O,selectedTiers:h,selectedTypes:G,showTierDropdown:w,setShowTierDropdown:W,showTypeDropdown:K,setShowTypeDropdown:Q,tierFilterRef:m,typeFilterRef:U,handleTierSelect:n,handleTypeSelect:o,isTierFiltered:a,isTypeFiltered:r,getDropdownStyle:d,costFilter:v,showCostDropdown:X,setShowCostDropdown:B,costFilterRef:te,handleCostFilterSelect:le,isCostFiltered:Z})}),e.jsx("tbody",{children:ie.map(z=>e.jsx(Mt,{item:z,onAdd:s,type:t,onRowClick:g,encounterItems:y,pcCount:x,playerTier:l,remainingBudget:P,costFilter:v,onAdversaryClick:c=>{t==="adversary"&&C(c)}},z.id))})]})})]}),Y==="encounters"&&e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:k.length===0?e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",textAlign:"center",padding:"2rem 1rem"},children:"No saved encounters yet"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:k.map(z=>e.jsxs("div",{onClick:()=>A&&A(z.id),className:"saved-encounter-card",style:{border:"1px solid var(--border)",borderRadius:"8px",padding:"8px",backgroundColor:"var(--bg-card)",transition:"background-color 0.2s ease",display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsxs("div",{style:{minWidth:"100px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",flexDirection:"column",justifyContent:"center",minHeight:"60px"},children:[e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Tier: ",(()=>{var M,q,J,ne;const c=((ne=(J=(q=(M=z.encounterItems)==null?void 0:M.filter(_=>_.type==="adversary"))==null?void 0:q.map(_=>_.item.tier))==null?void 0:J.filter(_=>_!=null))==null?void 0:ne.sort((_,ee)=>_-ee))||[];if(c.length===0)return"N/A";if(c.length===1)return c[0];const S=[...new Set(c)];return S.length===1?S[0]:`${Math.min(...S)}-${Math.max(...S)}`})()]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Party Size: ",z.partySize||4]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)"},children:["Balance: ",(()=>{const c=z.partySize||4,S=3*c+2;let M=0;const q=z.encounterItems||[];q.filter(se=>se.type==="adversary"&&se.item.type==="Solo"&&se.quantity>0).reduce((se,xe)=>se+xe.quantity,0)>=2&&(M+=Se.twoOrMoreSolos);const ne=q.some(se=>se.type==="adversary"&&se.item.type==="Bruiser"&&se.quantity>0),_=q.some(se=>se.type==="adversary"&&se.item.type==="Horde"&&se.quantity>0),ee=q.some(se=>se.type==="adversary"&&se.item.type==="Leader"&&se.quantity>0),N=q.some(se=>se.type==="adversary"&&se.item.type==="Solo"&&se.quantity>0);!ne&&!_&&!ee&&!N&&(M+=Se.noBruisersHordesLeadersSolos);const oe=S+M,ue=q.reduce((se,xe)=>{if(xe.type==="adversary"){const ye=ve[xe.item.type]||2;if(xe.item.type==="Minion"){const he=Math.ceil(xe.quantity/c);return se+he*ye}else return se+xe.quantity*ye}return se},0);return ue>oe?`+${ue-oe}`:ue===oe?"0":`-${oe-ue}`})()]})]}),e.jsx("div",{style:{minWidth:"120px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",alignItems:"center",minHeight:"60px"},children:e.jsx("div",{style:{fontWeight:"500",color:"var(--text-primary)",fontSize:"0.9rem",wordWrap:"break-word",wordBreak:"break-word",width:"150px",maxWidth:"150px"},children:z.name})}),e.jsx(Wt,{encounter:z}),e.jsx("button",{onClick:c=>{c.stopPropagation(),F(z.id)},style:{background:T[z.id]?"var(--danger)":"var(--gray-600)",border:"none",color:"white",padding:"0.4rem 0.8rem",borderRadius:"4px",fontSize:"0.75rem",cursor:"pointer",minWidth:"60px",transition:"background-color 0.2s"},children:"Delete"})]},z.id))})}),Y==="custom"&&e.jsx(At,{onSave:Nt,onRefresh:u,onAddItem:s})]}),L&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:2e3,display:"flex",alignItems:"center",justifyContent:"center",padding:"2rem"},onClick:()=>C(null),children:e.jsx("div",{style:{maxWidth:"600px",width:"90vw",maxHeight:"80vh",overflowY:"auto"},onClick:z=>z.stopPropagation(),children:e.jsx(Pe,{item:L,type:"adversary",mode:"expanded",onClose:()=>C(null)})})})]})},V={browserWrapper:{display:"flex",flexDirection:"column",background:"var(--bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border)",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserWrapperNoContainer:{display:"flex",flexDirection:"column",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserContent:{flex:1,overflowY:"auto",overflowX:"visible",padding:0,width:"100%",scrollbarWidth:"none",msOverflowStyle:"none"},tableHeaderContainer:{flexShrink:0,position:"sticky",top:0,zIndex:15,backgroundColor:"var(--bg-secondary)"},browserTable:{width:"100%",minWidth:"100%",borderCollapse:"collapse",tableLayout:"fixed",background:"var(--bg-primary)",margin:0},browserHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--gray-900)",flexShrink:0,position:"sticky",top:0,zIndex:20},browserTitle:{margin:0,color:"var(--text-primary)",fontSize:"18px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"24px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",marginRight:"12px",transition:"all 0.2s ease"},partyControls:{display:"flex",alignItems:"center",gap:"12px",flexShrink:0},searchInputFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 3px rgba(139, 92, 246, 0.1)"},tableHeader:{background:"var(--gray-900)",borderBottom:"1px solid var(--border)",boxShadow:"0 1px 0 var(--border)",position:"sticky",top:"0",zIndex:10},tableHeaderCell:{backgroundColor:"var(--gray-900)",fontWeight:"700",borderBottom:"1px solid var(--border)",cursor:"pointer",userSelect:"none",minWidth:"100px",whiteSpace:"nowrap",padding:"4px 4px",color:"var(--text-primary)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",boxShadow:"0 1px 0 var(--border)",transition:"background-color 0.2s",position:"sticky",top:"0",zIndex:10},tableHeaderCellHover:{backgroundColor:"var(--bg-hover)"},sortIndicator:{fontSize:"12px",color:"var(--text-secondary)"},tableBody:{flex:1,overflowY:"auto",padding:"8px",backgroundColor:"var(--bg-primary)"},row:{height:"35px",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s ease",cursor:"pointer",backgroundColor:"var(--gray-900)"},rowHover:{backgroundColor:"var(--bg-secondary)"},expandedRow:{backgroundColor:"var(--bg-secondary)"},rowCell:{padding:"4px 4px",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid var(--border)"},rowCellName:{fontWeight:"500",minWidth:"150px"},rowCellCenter:{textAlign:"center",justifyContent:"center",minWidth:"80px"},rowActions:{width:"80px",textAlign:"center",padding:"4px 8px",borderBottom:"1px solid var(--border)"},addButton:{width:"2rem",height:"2rem",border:"1px solid var(--purple)",borderRadius:"var(--radius-sm)",background:"var(--purple)",color:"white",cursor:"pointer",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"500"},expandedContent:{padding:"0",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)"},columnName:{width:"auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",paddingLeft:"8px",textAlign:"left"},columnTier:{width:"80px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnType:{width:"100px",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},columnDifficulty:{width:"40px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnAction:{width:"32px",minWidth:"24px",maxWidth:"24px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"visible",textOverflow:"unset"},loading:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"var(--text-primary)",fontSize:"16px"},mobileBrowser:{width:"95vw",height:"90vh",maxWidth:"none"},mobileSearchInput:{fontSize:"16px"},headerWithFilter:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0px",position:"relative"},headerFilterIcon:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"2px 4px",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",position:"relative",marginLeft:"-2px"},headerFilterIconActive:{color:"var(--purple)"},filterIcon:{fontSize:"12px"},filterActiveDot:{position:"absolute",left:"50%",top:"2px",transform:"translateX(-50%)",width:"4px",height:"4px",borderRadius:"50%",background:"var(--purple)",pointerEvents:"none"},filterDropdown:{position:"fixed",background:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",zIndex:99999,marginTop:"4px",overflow:"hidden",width:"max-content",minWidth:"120px",maxWidth:"200px"},filterOption:{padding:"8px 12px",cursor:"pointer",color:"var(--text-primary)",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background-color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},filterOptionSelected:{backgroundColor:"var(--bg-hover)"},checkIcon:{width:"16px",height:"16px",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"12px"},filterLabel:{flex:1}},Dt=()=>e.jsx("div",{className:"pwa-install-prompt",style:{}}),Ht=({side:t="left",children:s,className:i="",style:g={}})=>{const y=t==="left",x={flex:1,minWidth:0,background:"var(--bg-primary)",overflowY:"auto",overflowX:y?"auto":"hidden",display:y?"block":"flex",flexDirection:y?"initial":"column",height:"100%",padding:y?"8px 0 8px 0":"0 8px 0 0",...g};return e.jsx("div",{className:i,style:x,children:s})},Ft=t=>3*t+2,Ot={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},Re={lessDifficult:-1,twoOrMoreSolos:-2,increasedDamage:-2,lowerTierAdversary:1,noBruisersHordesLeadersSolos:1,moreDangerous:2},$t=({isOpen:t,onClose:s,onAddAdversary:i,onAddAdversariesBulk:g,onAddEnvironment:y,onDeleteAdversary:x,onDeleteEnvironment:l,onDeleteCountdown:I,adversaries:p=[],environments:k=[],countdowns:A=[],savedEncounters:D=[],onSaveEncounter:Y,onLoadEncounter:v,onDeleteEncounter:R})=>{const{partySize:X,updatePartySize:B,currentEncounterName:L,updateCurrentEncounterName:C}=Ye(),T=X,E=B,[H,te]=j.useState({lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),[F,ce]=j.useState([]),[$,de]=j.useState(L||"Encounter"),[ae,ie]=j.useState("adversaries"),[re,u]=j.useState(null),[h,G]=j.useState(null);j.useEffect(()=>{t&&!re&&de(L||"Encounter")},[t,re,L]);const w=()=>h?$!==h.name||JSON.stringify(F)!==JSON.stringify(h.encounterItems)||T!==h.partySize||JSON.stringify(H)!==JSON.stringify(h.battlePointsAdjustments):!1,W=()=>{var c;if(F.length>0||($||"").trim()!=="Encounter")return!0;if(re&&w()){if(h){const S=F.length,M=((c=h.encounterItems)==null?void 0:c.length)||0;if(S!==M||($||"").trim()!==(h.name||""))return!0;const q=JSON.stringify(H),J=JSON.stringify(h.battlePointsAdjustments||{});return q!==J}return!0}return!1},K=({onClick:c,children:S,variant:M="secondary",isConfirmation:q=!1})=>{const J=M==="danger"||M==="secondary"&&q,ne=M==="purple";return e.jsx("button",{onClick:c,style:{background:J?"var(--danger)":ne?"var(--purple)":"var(--bg-secondary)",border:ne?"none":"1px solid var(--border)",color:J||ne?"white":"var(--text-primary)",padding:"0.375rem 0.75rem",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s",width:"70px",fontSize:"0.875rem"},children:S})},Q=ge.useRef(T),m=j.useCallback(c=>!c||c.length===0?null:D.find(M=>{var _,ee;if(((_=M.encounterItems)==null?void 0:_.length)!==c.length)return!1;const q=N=>{var oe;return{type:N.type,quantity:N.quantity,item:{name:N.item.baseName||((oe=N.item.name)==null?void 0:oe.replace(/\s+\(\d+\)$/,""))||N.item.name,type:N.item.type,tier:N.item.tier}}},J=(ee=M.encounterItems)==null?void 0:ee.map(q).sort((N,oe)=>N.item.name.localeCompare(oe.item.name)||N.item.type.localeCompare(oe.item.type)),ne=c.map(q).sort((N,oe)=>N.item.name.localeCompare(oe.item.name)||N.item.type.localeCompare(oe.item.type));return JSON.stringify(J)===JSON.stringify(ne)})||null,[D]);ge.useEffect(()=>{if(t&&p.length>0&&F.length===0){const c={};p.forEach(q=>{var ne;const J=q.baseName||((ne=q.name)==null?void 0:ne.replace(/\s+\(\d+\)$/,""))||q.name;c[J]||(c[J]={type:"adversary",item:q,quantity:0}),c[J].quantity+=1});const S=Object.values(c);ce(S);const M=m(S);M&&!re&&(u(M.id),G({name:M.name||"",encounterItems:M.encounterItems||[],partySize:M.partySize||4,battlePointsAdjustments:M.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),de(M.name||"Encounter"),C(M.name||"Encounter"))}else t&&p.length===0&&F.length===0&&ce([])},[t,m,re,C]);const U=ge.useMemo(()=>{let c=0;F.filter(_=>_.type==="adversary"&&_.item.type==="Solo"&&_.quantity>0).reduce((_,ee)=>_+ee.quantity,0)>=2&&(c+=Re.twoOrMoreSolos);const M=F.some(_=>_.type==="adversary"&&_.item.type==="Bruiser"&&_.quantity>0),q=F.some(_=>_.type==="adversary"&&_.item.type==="Horde"&&_.quantity>0),J=F.some(_=>_.type==="adversary"&&_.item.type==="Leader"&&_.quantity>0),ne=F.some(_=>_.type==="adversary"&&_.item.type==="Solo"&&_.quantity>0);return!M&&!q&&!J&&!ne&&(c+=Re.noBruisersHordesLeadersSolos),c},[F]),f=Ft(T),O=Object.entries(H).filter(([c,S])=>S).reduce((c,[S,M])=>c+Re[S],0),n=f+O+U,o=F.reduce((c,S)=>{if(S.type==="adversary"){const M=Ot[S.item.type]||2;return S.item.type==="Minion"?c+Math.ceil(S.quantity/T)*M:c+M*S.quantity}return c},0);ge.useEffect(()=>{const c=Q.current;c!==T&&(ce(S=>S.map(M=>{if(M.type==="adversary"&&M.item.type==="Minion"){const J=Math.ceil(M.quantity/c)*T;return{...M,quantity:J}}return M})),Q.current=T)},[T]);const a=(c,S)=>{const M=F.findIndex(ne=>ne.item.id===c.id&&ne.type===S),q=c.type==="Minion"?T:1;let J;M>=0?J=F.map((ne,_)=>_===M?{...ne,quantity:ne.quantity+q}:ne):J=[...F,{item:c,type:S,quantity:q}],ce(J),r(J)},r=c=>{const S=p||[],M=[];c.forEach(ee=>{for(let N=0;N<ee.quantity;N++)ee.type==="adversary"&&M.push(ee.item)});const q={};S.forEach(ee=>{var oe;const N=ee.baseName||((oe=ee.name)==null?void 0:oe.replace(/\s+\(\d+\)$/,""))||ee.name;q[N]||(q[N]=[]),q[N].push(ee)});const J={};M.forEach(ee=>{var oe;const N=ee.baseName||((oe=ee.name)==null?void 0:oe.replace(/\s+\(\d+\)$/,""))||ee.name;J[N]||(J[N]=[]),J[N].push(ee)});const ne=[],_=[];Object.keys(J).forEach(ee=>{var ue;const N=((ue=q[ee])==null?void 0:ue.length)||0,oe=J[ee].length;if(oe>N){const se=oe-N;for(let xe=0;xe<se;xe++)ne.push(J[ee][0])}else if(oe<N){const se=N-oe,ye=[...q[ee]].sort((he,Ke)=>{const Qe=he.duplicateNumber||1;return(Ke.duplicateNumber||1)-Qe});for(let he=0;he<se;he++)_.push(ye[he].id)}}),Object.keys(q).forEach(ee=>{J[ee]||[...q[ee]].sort((ue,se)=>{const xe=ue.duplicateNumber||1;return(se.duplicateNumber||1)-xe}).forEach(ue=>{_.push(ue.id)})}),_.forEach(ee=>{x(ee)}),ne.length>0&&g(ne)},d=(c,S)=>{const M=(()=>{const q=F.findIndex(J=>J.item.id===c&&J.type===S);if(q>=0){const J=F[q];if(J.quantity===0)return F.filter((ee,N)=>N!==q);const ne=J.item.type==="Minion"?T:1,_=Math.max(0,J.quantity-ne);return F.map((ee,N)=>N===q?{...ee,quantity:_}:ee)}return F})();ce(M),r(M)},b=j.useCallback(()=>{if(F.length===0)return null;const c=($||"").trim()||"Encounter",S=D.find(M=>{var ne,_;if(M.name!==c||((ne=M.encounterItems)==null?void 0:ne.length)!==F.length)return!1;const q=JSON.stringify((_=M.encounterItems)==null?void 0:_.sort()),J=JSON.stringify([...F].sort());return q===J});return(S==null?void 0:S.id)||null},[D,$,F]),P=j.useCallback(()=>{let c=($||"").trim(),S=re;if(S||(S=b()),F.length===0&&(!c||c==="Encounter")&&S){R(S),u(null),G(null);return}const M={name:c,encounterItems:F,partySize:T,battlePointsAdjustments:H};if(S){M.id=S;const q=Y(M);u(q)}else{const q=Y(M);u(q)}G({name:c,encounterItems:F,partySize:T,battlePointsAdjustments:H})},[F,$,T,H,re,Y,b,R]);j.useEffect(()=>{if(re&&w()){const c=setTimeout(()=>{P()},2e3);return()=>clearTimeout(c)}else if(!re&&F.length>0&&$&&$.trim()!==""){const c=setTimeout(()=>{P()},2e3);return()=>clearTimeout(c)}},[F,re,$,H,T]);const le=()=>{W()&&(ce([]),de("Encounter"),C("Encounter"),u(null),G(null),p.forEach(c=>{x(c.id)}),k.forEach(c=>{l(c.id)}),A.forEach(c=>{I(c.id)}))},Z=c=>{const S=v(c);if(S){const M=S.encounterItems||[];ce(M),E(S.partySize||4),te(S.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),de(S.name||""),C(S.name||""),u(c),G({name:S.name||"",encounterItems:S.encounterItems||[],partySize:S.partySize||4,battlePointsAdjustments:S.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),r(M)}},z=c=>{R(c),re===c&&(ce([]),de("Encounter"),C("Encounter"),u(null),G(null),p.forEach(S=>{x(S.id)}),k.forEach(S=>{l(S.id)}),A.forEach(S=>{I(S.id)}))};return t?e.jsx("div",{onClick:s,className:"encounter-builder-modal",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:1e3,display:"flex",alignItems:"flex-start",justifyContent:"center",padding:"12px"},children:e.jsxs("div",{onClick:c=>c.stopPropagation(),style:{backgroundColor:"var(--bg-primary)",border:"2px solid var(--border)",borderRadius:"12px",width:"100%",maxWidth:"1200px",height:"calc(100vh - 24px)",height:"calc(100dvh - 24px)",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"},children:[e.jsxs("div",{className:"encounter-top-bar",style:{flex:"0 0 auto",display:"flex",alignItems:"center",height:"39px",backgroundColor:"var(--bg-primary)"},children:[e.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center"},children:[e.jsx("button",{onClick:()=>ie("adversaries"),style:{flex:1,background:ae==="adversaries"?"var(--gray-900)":"transparent",border:"none",borderBottom:"1px solid var(--border)",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:ae==="adversaries"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Adversaries"}),e.jsx("button",{onClick:()=>ie("encounters"),style:{flex:1,background:ae==="encounters"?"var(--gray-900)":"transparent",border:"none",borderBottom:"1px solid var(--border)",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:ae==="encounters"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Encounters"}),e.jsx("button",{onClick:()=>ie("custom"),style:{flex:1,background:ae==="custom"?"var(--gray-900)":"transparent",border:"none",borderBottom:"1px solid var(--border)",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:ae==="custom"?"500":"400",transition:"all 0.2s ease",position:"relative"},children:"Custom Adversary"})]}),e.jsx("div",{className:"encounter-receipt-buttons",style:{flex:"0 0 350px",display:"flex",alignItems:"flex-start",justifyContent:"center",borderLeft:"1px solid var(--border)",height:"100%",padding:"1rem 0.75rem"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:$,onChange:c=>{de(c.target.value),C(c.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(K,{onClick:le,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:W()?1:.5,cursor:W()?"pointer":"not-allowed"},children:"New"})]})})]}),e.jsxs("div",{className:"encounter-builder-content",style:{flex:1,display:"flex",overflow:"hidden"},children:[e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",borderTop:"1px solid var(--border)"},children:e.jsx(Pt,{type:"adversary",onAddItem:c=>a(c,"adversary"),encounterItems:F,pcCount:T,showContainer:!1,savedEncounters:D,onLoadEncounter:Z,onDeleteEncounter:z,activeTab:ae})}),e.jsxs("div",{className:"encounter-right-panel",style:{flex:"0 0 350px",borderLeft:"1px solid var(--border)",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx("div",{className:"receipt-content",style:{padding:"1rem",display:"flex",flexDirection:"column",height:"100%"},children:e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"flex-start",overflowY:"auto",marginBottom:"0.75rem"},children:[e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>E(Math.max(1,T-1)),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(He,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:T}),e.jsx("button",{onClick:()=>E(T+1),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(Fe,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Party Size"})}),e.jsx("div",{style:{width:"120px",textAlign:"right"}})]}),F.map(c=>{var S;return c.type!=="adversary"?null:e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>d(c.item.id,c.type),style:{background:c.quantity===0?"var(--danger)":"var(--bg-secondary)",border:c.quantity===0?"none":"1px solid var(--border)",color:c.quantity===0?"white":"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:c.quantity===0?e.jsx(Me,{size:10}):e.jsx(He,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:c.quantity}),e.jsx("button",{onClick:()=>a(c.item,c.type),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(Fe,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:c.item.baseName||((S=c.item.name)==null?void 0:S.replace(/\s+\(\d+\)$/,""))||c.item.name})}),e.jsx("div",{style:{width:"80px",textAlign:"right"},children:e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.8rem"},children:c.item.type})})]},`${c.item.id}-${c.type}`)}),e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Balance"})}),e.jsx("div",{style:{width:"120px",textAlign:"right",display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsx("span",{style:{color:o>n?"var(--danger)":o===n?"var(--purple)":"var(--success)",fontWeight:600},children:o>n?`+${o-n}`:n-o===0?"0":`-${n-o}`})})]})]})}),e.jsx("div",{className:"encounter-receipt-buttons-vertical",style:{display:"none",padding:"0.75rem",borderTop:"1px solid var(--border)",backgroundColor:"var(--bg-primary)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:$,onChange:c=>{de(c.target.value),C(c.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",color:"var(--text-primary)",fontSize:"0.875rem"}}),e.jsx(K,{onClick:le,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:W()?1:.5,cursor:W()?"pointer":"not-allowed"},children:"New"})]})})]})]})]})}):null};class qt extends ge.Component{constructor(s){super(s),this.state={hasError:!1,error:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,i){console.error("ErrorBoundary caught an error:",s,i)}render(){var s;return this.state.hasError?e.jsxs("div",{className:"p-md text-red",children:[e.jsx("h3",{children:"Something went wrong:"}),e.jsx("pre",{children:(s=this.state.error)==null?void 0:s.toString()}),e.jsx("button",{className:"btn-base btn-text",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try again"})]}):this.props.children}}const _t=()=>{const{adversaries:t,environments:s,countdowns:i,fear:g,savedEncounters:y,updateFear:x,createAdversary:l,createAdversariesBulk:I,updateAdversary:p,deleteAdversary:k,createEnvironment:A,updateEnvironment:D,deleteEnvironment:Y,createCountdown:v,updateCountdown:R,deleteCountdown:X,advanceCountdown:B,saveEncounter:L,loadEncounter:C,deleteEncounter:T}=Ye(),[E,H]=j.useState(!1),[te,F]=j.useState(!1);j.useState(!1);const[ce,$]=j.useState(!1);j.useState(!0);const[de,ae]=j.useState(null),[ie,re]=j.useState(0),[u,h]=j.useState(0),[G,w]=j.useState(!1);j.useEffect(()=>{const r=()=>{const b=window.matchMedia("(max-width: 800px)");H(b.matches)};r();const d=window.matchMedia("(max-width: 800px)");return d.addEventListener("change",r),()=>d.removeEventListener("change",r)},[]);const W=12,K=r=>r===1?200:350,Q=r=>{if(r<=0)return{visibleColumns:1,columnWidth:K(1)};const d=W*2,b=r-d;let P={visibleColumns:1,columnWidth:b};for(let Z=1;Z<=5;Z++){const z=(Z-1)*W,c=(b-z)/Z;c>=K(Z)&&Z*c+z<=b&&(P={visibleColumns:Z,columnWidth:c})}return P.visibleColumns*P.columnWidth+(P.visibleColumns-1)*W>b&&(P={visibleColumns:1,columnWidth:b}),P},{visibleColumns:m,columnWidth:U}=Q(ie);j.useEffect(()=>{const r=()=>{re(window.innerWidth)};return r(),window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]);const f=()=>{F(!0)},O=j.useCallback(()=>{F(!1)},[]),n=j.useCallback(r=>{h(r.target.scrollLeft)},[]);j.useCallback(()=>{w(!0)},[]),j.useCallback(()=>{setTimeout(()=>w(!1),100)},[]);const a=(()=>{const r={};return t.forEach(d=>{var P;const b=d.baseName||((P=d.name)==null?void 0:P.replace(/\s+\(\d+\)$/,""))||d.name;r[b]||(r[b]={type:"adversary",baseName:b,instances:[]}),r[b].instances.push(d)}),s.forEach(d=>{r[d.name]||(r[d.name]={type:"environment",baseName:d.name,instances:[]}),r[d.name].instances.push(d)}),i.forEach(d=>{r[`countdown-${d.id}`]={type:"countdown",baseName:d.name,instances:[d]}}),Object.values(r)})();return a.length,e.jsxs("div",{className:"app",onClick:r=>{r.target,r.currentTarget},children:[e.jsx(wt,{adversaries:t,environments:s,countdowns:i,deleteAdversary:k,deleteEnvironment:Y,deleteCountdown:X,isClearMode:ce,setIsClearMode:$,sortAdversaries:()=>{},onOpenDatabase:f}),e.jsx("div",{className:"main-content",style:{position:"relative",width:"100%"},children:e.jsx("div",{className:"dashboard-scroll-container",style:{display:"flex",flexDirection:"row",overflowX:"auto",overflowY:"hidden",padding:`0 ${W}px`,scrollSnapType:"x mandatory",height:"100%",width:"100%"},onScroll:n,children:a.length===0?e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",width:"100%",padding:"2rem"},children:e.jsx("button",{onClick:f,style:{backgroundColor:"transparent",color:"var(--text-secondary)",border:"2px dashed var(--border)",borderRadius:"var(--radius-md)",padding:"1rem 2rem",fontSize:"1rem",fontWeight:"500",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:r=>{r.target.style.borderColor="var(--purple)",r.target.style.color="var(--purple)"},onMouseLeave:r=>{r.target.style.borderColor="var(--border)",r.target.style.color="var(--text-secondary)"},children:"Create Encounter"})}):a.map((r,d)=>e.jsx(Ht,{className:"invisible-scrollbar",style:{width:`${U+W}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:`${W}px`,paddingRight:"0",paddingTop:`${W}px`,paddingBottom:`${W}px`,scrollSnapAlign:"start",overflowY:"auto",overflowX:"hidden"},children:e.jsx(Pe,{type:r.type,item:{...r.instances[0],name:r.baseName,hp:0,stress:0,isDead:!1},mode:"expanded",instances:r.instances,onApplyDamage:r.type==="adversary"?(b,P,le,Z)=>{const z=r.instances.find(c=>c.id===b);z&&p(b,{hp:Math.min(z.hpMax||1,(z.hp||0)+P)})}:void 0,onApplyHealing:r.type==="adversary"?(b,P,le)=>{const Z=r.instances.find(z=>z.id===b);Z&&p(b,{hp:Math.max(0,(Z.hp||0)-P)})}:void 0,onApplyStressChange:r.type==="adversary"?(b,P)=>{var le,Z;return p(b,{stress:Math.max(0,Math.min(((le=r.instances.find(z=>z.id===b))==null?void 0:le.stressMax)||6,(((Z=r.instances.find(z=>z.id===b))==null?void 0:Z.stress)||0)+P))})}:void 0,onUpdate:r.type==="adversary"?p:r.type==="environment"?D:R,adversaries:t})},`${r.type}-${r.baseName}`))})}),e.jsx(St,{position:"bottom",children:e.jsx(vt,{type:"fear",value:(g==null?void 0:g.value)||0,maxValue:12,onChange:x,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0})}),e.jsx($t,{isOpen:te,onClose:O,onAddAdversary:r=>{l(r),ae("adversary")},onAddAdversariesBulk:r=>{I(r),ae("adversary")},onAddEnvironment:r=>{A(r),ae("environment")},onDeleteAdversary:k,onDeleteEnvironment:Y,onDeleteCountdown:X,adversaries:t,environments:s,countdowns:i,savedEncounters:y,onSaveEncounter:L,onLoadEncounter:C,onDeleteEncounter:T}),e.jsx(Dt,{})]})},Vt=()=>e.jsx(qt,{children:e.jsx(_t,{})});Le.createRoot(document.getElementById("root")).render(e.jsx(ge.StrictMode,{children:e.jsx(yt,{children:e.jsx(Vt,{})})}));
