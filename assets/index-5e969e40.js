import{r as E,a as Ye,R as je}from"./dndkit-57209f9c.js";import{F as pt,f as ut,a as mt,b as xt,c as Ze}from"./fa-b4bcccb0.js";import{D as at,A as ht,X as Fe,B as gt,H as ft,L as yt,C as vt,F as bt,S as Ne,a as Le,M as Ue,P as et}from"./lucide-44bdca53.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))p(b);new MutationObserver(b=>{for(const l of b)if(l.type==="childList")for(const g of l.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&p(g)}).observe(document,{childList:!0,subtree:!0});function c(b){const l={};return b.integrity&&(l.integrity=b.integrity),b.referrerPolicy&&(l.referrerPolicy=b.referrerPolicy),b.crossOrigin==="use-credentials"?l.credentials="include":b.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function p(b){if(b.ep)return;b.ep=!0;const l=c(b);fetch(b.href,l)}})();var it={exports:{}},Ve={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wt=E,Ct=Symbol.for("react.element"),jt=Symbol.for("react.fragment"),St=Object.prototype.hasOwnProperty,kt=wt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,It={key:!0,ref:!0,__self:!0,__source:!0};function lt(t,a,c){var p,b={},l=null,g=null;c!==void 0&&(l=""+c),a.key!==void 0&&(l=""+a.key),a.ref!==void 0&&(g=a.ref);for(p in a)St.call(a,p)&&!It.hasOwnProperty(p)&&(b[p]=a[p]);if(t&&t.defaultProps)for(p in a=t.defaultProps,a)b[p]===void 0&&(b[p]=a[p]);return{$$typeof:Ct,type:t,key:l,ref:g,props:b,_owner:kt.current}}Ve.Fragment=jt;Ve.jsx=lt;Ve.jsxs=lt;it.exports=Ve;var e=it.exports,Je={},tt=Ye;Je.createRoot=tt.createRoot,Je.hydrateRoot=tt.hydrateRoot;function Ce(t){const a=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return t?`${t}-${a}`:a}const dt=E.createContext();function qe(t){if(typeof localStorage>"u")return null;try{const a=localStorage.getItem(t);return a==null?null:JSON.parse(a)}catch{return null}}function Ee(t,a){if(!(typeof localStorage>"u"))try{localStorage.setItem(t,JSON.stringify(a))}catch{}}const Et=({children:t})=>{const[a,c]=E.useState({fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],currentEncounterName:"Encounter"}),[p,b]=E.useState(!1),[l,g]=E.useState({adversaries:[],environments:[]});E.useEffect(()=>{var s,h,Q,ne;const n=qe("daggerheart-game-state");if(n)try{(((s=n.adversaries)==null?void 0:s.length)>0||((h=n.environments)==null?void 0:h.length)>0||((Q=n.countdowns)==null?void 0:Q.length)>0||((ne=n.savedEncounters)==null?void 0:ne.length)>0)&&c(n)}catch(G){console.error("Failed to load saved state:",G)}const d=qe("daggerheart-custom-adversaries")||[],r=qe("daggerheart-custom-environments")||[];g({adversaries:d,environments:r}),b(!0)},[]),E.useEffect(()=>{Ee("daggerheart-game-state",a)},[a]);const L=n=>{c(d=>({...d,fear:{...d.fear,value:n}}))},u=()=>{c(n=>({...n,fear:{...n.fear,visible:!n.fear.visible}}))},M=n=>{c(d=>({...d,partySize:Math.max(1,n)}))},H=n=>{c(d=>({...d,currentEncounterName:n||"Encounter"}))},B=n=>{if(n.id)return c(d=>({...d,savedEncounters:(d.savedEncounters||[]).map(r=>r.id===n.id?{...r,name:n.name||r.name,encounterItems:n.encounterItems||r.encounterItems,partySize:n.partySize||r.partySize,battlePointsAdjustments:n.battlePointsAdjustments||r.battlePointsAdjustments,updatedAt:new Date().toISOString()}:r)})),n.id;{const d={id:Ce("encounter"),name:n.name||"Encounter",createdAt:new Date().toISOString(),encounterItems:n.encounterItems||[],partySize:n.partySize||4,battlePointsAdjustments:n.battlePointsAdjustments||{}};return c(r=>({...r,savedEncounters:[...r.savedEncounters||[],d]})),d.id}},U=n=>(a.savedEncounters||[]).find(r=>r.id===n),S=n=>{const d={id:Ce("encounter"),name:n.name||`Encounter ${Date.now()}`,createdAt:new Date().toISOString(),encounterItems:n.encounterItems||[],partySize:n.partySize||4,battlePointsAdjustments:n.battlePointsAdjustments||{}};return c(r=>({...r,savedEncounters:[...r.savedEncounters||[],d]})),d.id},$=n=>{c(d=>({...d,savedEncounters:(d.savedEncounters||[]).filter(r=>r.id!==n)}))},ee=E.useRef(a);E.useEffect(()=>{ee.current=a},[a]);const v={gameState:a,isLoaded:p,customContent:l,updateFear:L,toggleFearVisibility:u,updatePartySize:M,updateCurrentEncounterName:H,saveEncounter:B,saveEncounterAs:S,loadEncounter:U,deleteEncounter:$,createCountdown:n=>{const d={id:Ce("countdown"),name:n.name||"Countdown",max:parseInt(n.max)||1,value:0,visible:!0,type:n.type||"standard",loop:n.loop||"none",source:n.source||"campaign"};c(r=>({...r,countdowns:[...r.countdowns,d]}))},updateCountdown:(n,d)=>{c(r=>({...r,countdowns:r.countdowns.map(s=>s.id===n?{...s,...d}:s)}))},deleteCountdown:n=>{c(d=>({...d,countdowns:d.countdowns.filter(r=>r.id!==n)}))},advanceCountdown:(n,d)=>{c(r=>({...r,countdowns:r.countdowns.map(s=>{if(s.id!==n)return s;let h=d;if(s.loop==="loop")h>s.max?h=(h-1)%s.max+1:h<0&&(h=s.max);else if(s.loop==="increasing"){if(h>s.max)return{...s,max:s.max+1,value:1};if(h<0)return{...s,max:Math.max(1,s.max-1),value:1};h=Math.max(0,h)}else if(s.loop==="decreasing"){if(h>s.max)return{...s,max:Math.max(1,s.max-1),value:1};if(h<0)return{...s,max:s.max+1,value:1};h=Math.min(s.max,h)}else h=Math.max(0,Math.min(h,s.max));return{...s,value:h}})}))},incrementCountdown:(n,d=1)=>{c(r=>({...r,countdowns:r.countdowns.map(s=>{if(s.id!==n)return s;let h=s.value+d;if(s.loop==="loop")h>s.max&&(h=(h-1)%s.max+1);else if(s.loop==="increasing"){if(h>s.max)return{...s,max:s.max+1,value:1}}else if(s.loop==="decreasing"){if(h>s.max)return{...s,max:Math.max(1,s.max-1),value:1}}else h=Math.min(h,s.max);return{...s,value:h}})}))},decrementCountdown:n=>{c(d=>({...d,countdowns:d.countdowns.map(r=>{if(r.id!==n)return r;let s=r.value-1;if(r.loop==="loop")s<0&&(s=r.max);else if(r.loop==="increasing"){if(s<0)return{...r,max:Math.max(1,r.max-1),value:r.max};s=Math.max(0,s)}else if(r.loop==="decreasing"){if(s<0)return{...r,max:r.max+1,value:1}}else s=Math.max(0,s);return{...r,value:s}})}))},reorderCountdowns:n=>{c(d=>{const[r,s]=n,h=[...d.countdowns],[Q]=h.splice(r,1);return h.splice(s,0,Q),{...d,countdowns:h}})},createAdversary:n=>{var G;const d=Ce("adv"),r=a.adversaries||[],s=n.baseName||((G=n.name)==null?void 0:G.replace(/\s+\(\d+\)$/,""))||n.name||"Unknown",h=r.filter(Z=>Z.baseName===s);let Q=1;if(h.length===0)Q=1;else{const Z=h.map(fe=>fe.duplicateNumber||1);let le=1;for(;Z.includes(le);)le++;Q=le}const ne={...n,id:d,baseName:s,duplicateNumber:Q,name:`${s} (${Q})`,hp:0,stress:0,isVisible:!0};c(Z=>({...Z,adversaries:[...Z.adversaries,ne]}))},createAdversariesBulk:n=>{const d=[],r={};n.forEach(s=>{var be;const h=s.baseName||((be=s.name)==null?void 0:be.replace(/\s+\(\d+\)$/,""))||s.name||"Unknown",G=(a.adversaries||[]).filter(we=>we.baseName===h).length,Z=r[h]||0,le=G+Z+1;r[h]=Z+1;const fe={...s,id:Ce("adv"),baseName:h,duplicateNumber:le,name:`${h} (${le})`,hp:0,stress:0,isVisible:!0};d.push(fe)}),c(s=>({...s,adversaries:[...s.adversaries,...d]}))},updateAdversary:(n,d)=>{c(r=>({...r,adversaries:r.adversaries.map(s=>{if(s.id===n){const h={...s,...d};if(d.baseName!==void 0){const Q=d.baseName,ne=h.duplicateNumber||1;h.name=ne===1?Q:`${Q} (${ne})`}return h}return s})}))},deleteAdversary:n=>{c(d=>({...d,adversaries:d.adversaries.filter(r=>r.id!==n)}))},clearAllAdversaries:()=>{c(n=>({...n,adversaries:[]}))},reorderAdversaries:n=>{c(d=>{const[r,s]=n,h=[...d.adversaries],[Q]=h.splice(r,1);return h.splice(s,0,Q),{...d,adversaries:h}})},bulkReorderAdversaries:n=>{c(d=>({...d,adversaries:n}))},createEnvironment:n=>{const d=Ce("env"),s=(a.environments||[]).filter(ne=>ne.name.replace(/\s+\(\d+\)$/,"")===n.name);let h=n.name||"Unknown";if(s.length===0)h=n.name;else if(s.length===1){const ne=s[0],G=ne.name.replace(/\s+\(\d+\)$/,""),Z=a.environments.map(le=>le.id===ne.id?{...le,name:`${G} (1)`}:le);c(le=>({...le,environments:Z})),h=`${n.name} (2)`}else{const ne=s.map(Z=>{const le=Z.name.match(/\((\d+)\)$/);return le?parseInt(le[1]):null}).filter(Z=>Z!==null);let G=1;for(;ne.includes(G);)G++;h=`${n.name} (${G})`}const Q={...n,id:d,name:h,isVisible:!0};c(ne=>({...ne,environments:[...ne.environments,Q]}))},updateEnvironment:(n,d)=>{c(r=>({...r,environments:r.environments.map(s=>s.id===n?{...s,...d}:s)}))},deleteEnvironment:n=>{c(d=>({...d,environments:d.environments.filter(r=>r.id!==n)}))},reorderEnvironments:n=>{c(d=>{const[r,s]=n,h=[...d.environments],[Q]=h.splice(r,1);return h.splice(s,0,Q),{...d,environments:h}})},addCustomAdversary:n=>{const d={...n,id:Ce("custom-adv"),source:n.source||"Homebrew",isCustom:!0};return g(r=>({...r,adversaries:[...r.adversaries,d]})),Ee("daggerheart-custom-adversaries",[...l.adversaries,d]),d.id},addCustomEnvironment:n=>{const d={...n,id:Ce("custom-env"),source:n.source||"Homebrew",isCustom:!0};return g(r=>({...r,environments:[...r.environments,d]})),Ee("daggerheart-custom-environments",[...l.environments,d]),d.id},updateCustomAdversary:(n,d)=>{g(s=>({...s,adversaries:s.adversaries.map(h=>h.id===n?{...h,...d}:h)}));const r=l.adversaries.map(s=>s.id===n?{...s,...d}:s);Ee("daggerheart-custom-adversaries",r)},updateCustomEnvironment:(n,d)=>{g(s=>({...s,environments:s.environments.map(h=>h.id===n?{...h,...d}:h)}));const r=l.environments.map(s=>s.id===n?{...s,...d}:s);Ee("daggerheart-custom-environments",r)},deleteCustomAdversary:n=>{g(r=>({...r,adversaries:r.adversaries.filter(s=>s.id!==n)}));const d=l.adversaries.filter(r=>r.id!==n);Ee("daggerheart-custom-adversaries",d)},deleteCustomEnvironment:n=>{g(r=>({...r,environments:r.environments.filter(s=>s.id!==n)}));const d=l.environments.filter(r=>r.id!==n);Ee("daggerheart-custom-environments",d)}};return e.jsx(dt.Provider,{value:v,children:t})},Ke=()=>{const t=E.useContext(dt);if(!t)return console.warn("useGameState: Context not available yet, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{gameState:a,customContent:c,...p}=t;if(!a)return console.warn("useGameState: gameState not available, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],customContent:{adversaries:[],environments:[]},updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},addCustomAdversary:()=>{},addCustomEnvironment:()=>{},updateCustomAdversary:()=>{},updateCustomEnvironment:()=>{},deleteCustomAdversary:()=>{},deleteCustomEnvironment:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{fear:b,countdowns:l,adversaries:g,environments:L,partySize:u,savedEncounters:M}=a;return{gameState:a,fear:b,countdowns:l,adversaries:g,environments:L,partySize:u,savedEncounters:M,customContent:c,...p,hasCountdowns:l.length>0,hasAdversaries:g.length>0,hasEnvironments:L.length>0,getCountdownById:H=>l.find(B=>B.id===H),getAdversaryById:H=>g.find(B=>B.id===H),getEnvironmentById:H=>L.find(B=>B.id===H)}},rt={fear:{icon:ut,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"0.125rem",maxWidth:"none"},pipStyle:{fontSize:"var(--text-lg)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0,imageRendering:"crisp-edges"},filledColor:"var(--purple)",emptyColor:"var(--gray-dark)",tooltipTitle:"Click anywhere in header to adjust fear:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease fear by 1"},{text:"Right of boundary:",description:"Click to increase fear by 1"}]},hp:{icon:mt,maxValue:20,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stress:{icon:xt,maxValue:12,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},countdown:{icon:Ze,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust countdown:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease countdown by 1"},{text:"Right of boundary:",description:"Click to increase countdown by 1"}]},hpDots:{maxValue:20,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--red)",borderColor:"var(--red)",boxShadow:"0 0 4px rgba(239, 68, 68, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stressDots:{maxValue:12,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--purple)",borderColor:"var(--purple)",boxShadow:"0 0 4px rgba(139, 92, 246, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},adversaryHP:{icon:at,maxValue:20,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust HP:",tooltipInstructions:[{text:"Filled pip:",description:"Click to heal (reduce damage)"},{text:"Empty pip:",description:"Click to take damage"}]},adversaryStress:{icon:ht,maxValue:12,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust stress:",tooltipInstructions:[{text:"Filled pip:",description:"Click to reduce stress"},{text:"Empty pip:",description:"Click to increase stress"}]},countdownDistributed:{icon:Ze,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Countdown progress:",tooltipInstructions:[{text:"Progress:",description:"Current countdown value"}]}},Re=({type:t="fear",value:a=0,maxValue:c,onChange:p,size:b="lg",showTooltip:l=!0,containerStyle:g={},pipStyle:L={},countdownType:u=null,distributedGroups:M=null,onPipClick:H=null,enableBoundaryClick:B=!1,clickContainerWidth:U="auto",centerPips:S=!0})=>{const[$,ee]=E.useState(!1),F=rt[t]||rt.fear,V=c||F.maxValue,q=Math.max(0,Math.min(V,a));let se=F.filledColor;t==="countdown"&&u&&(["progress","dynamic-progress","simple-hope"].includes(u)?se="var(--gold)":["consequence","dynamic-consequence","simple-fear"].includes(u)?se="var(--purple)":["long-term","standard"].includes(u)&&(se="var(--text-secondary)"));const I=(K,re)=>{if(H)H(K,re);else if(p){const de=K+1;p(de)}},ie=K=>{if(!B||!p||H)return;K.currentTarget.getBoundingClientRect();const re=K.currentTarget.querySelector(".pip-container");if(!re)return;const de=re.getBoundingClientRect(),y=K.clientX-de.left;if(y<0){q>0&&p(q-1);return}if(y>de.width){q<V&&p(q+1);return}const j=de.width,C=j*.05,z=j-2*C,_=y-C,ae=q/V,T=z*ae;_<T?q>0&&p(q-1):q<V&&p(q+1)},me=(()=>{if(!M||t!=="countdownDistributed")return[{start:0,end:V,groupIndex:0}];let K=0;return M.map((re,de)=>{const y={start:K,end:K+re,groupIndex:de};return K+=re,y})})(),X=()=>e.jsxs(e.Fragment,{children:[me.map(K=>e.jsx(je.Fragment,{children:[...Array(K.end-K.start)].map((re,de)=>{const y=K.start+de,j=y<q;if(F.isDots)return e.jsx("div",{style:{...F.pipStyle,...j?F.filledStyle:F.emptyStyle,...L,cursor:p||H?"pointer":"default"},onClick:B?void 0:()=>I(y,j),title:`${y+1} of ${V}`},y);{const C=F.icon,z=C&&typeof C=="object"&&C.iconName,_=j?se:F.emptyColor;return e.jsx("span",{className:`fear-pip ${j?"filled":"empty"}`,style:{...F.pipStyle,color:_,cursor:p||H?"pointer":"default",...L},onClick:B?void 0:()=>I(y,j),title:`${y+1} of ${V}`,children:z?e.jsx(pt,{icon:C,size:b}):e.jsx(C,{size:b==="lg"?18:16})},y)}})},K.groupIndex)),l&&e.jsx("div",{style:{position:"relative",cursor:"help",pointerEvents:"none"},children:e.jsxs("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:$?"translateX(-50%) translateY(-5px)":"translateX(-50%)",background:"rgba(15, 23, 42, 0.95)",border:"1px solid var(--gray)",borderRadius:"var(--radius-md)",padding:"var(--space-md)",minWidth:"250px",zIndex:1e3,opacity:$?1:0,visibility:$?"visible":"hidden",transition:"all 0.2s ease",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.5)"},children:[e.jsx("div",{style:{fontWeight:600,color:"var(--gray-200)",marginBottom:"0.75rem",fontSize:"var(--text-sm)"},children:F.tooltipTitle}),F.tooltipInstructions.map((K,re)=>e.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.8rem",color:"var(--gray-300)",lineHeight:1.4},children:[e.jsx("strong",{style:{color:"var(--gray-200)"},children:K.text})," ",K.description]},re))]})})]});return e.jsx("div",{style:{width:U,height:"100%",cursor:p||H?"pointer":"default",touchAction:"manipulation",userSelect:"none",display:S?"flex":"block",alignItems:S?"center":"stretch",justifyContent:S?"center":"flex-start",...g},onClick:K=>{K.stopPropagation(),K.preventDefault(),B&&ie(K)},onMouseEnter:()=>ee(l),onMouseLeave:()=>ee(!1),children:e.jsx("div",{className:"pip-container",style:{...F.containerStyle,width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},children:X()})})},At=({onToggle:t,isOpen:a})=>{const p={position:"fixed",bottom:window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://")?"calc(60px + env(safe-area-inset-bottom) + 2rem)":"calc(60px + env(safe-area-inset-bottom) + 1rem)",right:"1rem",zIndex:1100,width:"56px",height:"56px",borderRadius:"50%",background:a?"var(--red)":"var(--bg-secondary)",border:"2px solid var(--border)",color:a?"white":"var(--text-primary)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"all 0.2s ease"};return e.jsx("button",{onClick:t,style:p,title:a?"Close Encounter Builder":"Open Encounter Builder",onMouseEnter:b=>{a||(b.currentTarget.style.background="var(--purple)",b.currentTarget.style.color="white")},onMouseLeave:b=>{a||(b.currentTarget.style.background="var(--bg-secondary)",b.currentTarget.style.color="var(--text-primary)")},children:a?e.jsx(Fe,{size:24}):e.jsx(gt,{size:24})})},zt=({position:t="top",children:a,onClick:c,className:p="",style:b={}})=>{const l=t==="top",g=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://"),L={background:"var(--bg-primary)",borderTop:l?"none":"1px solid var(--border)",borderBottom:l?"1px solid var(--border)":"none",padding:l?"0.25rem 0":"0.5rem",paddingBottom:l?"0.25rem":g?"calc(0.5rem + env(safe-area-inset-bottom) + 1rem)":"calc(0.5rem + env(safe-area-inset-bottom))",position:l?"relative":"sticky",[l?"top":"bottom"]:0,zIndex:l?10:100,order:l?1:3,flexShrink:0,touchAction:"manipulation",userSelect:"none",display:"flex",flexDirection:l?"column":"row",justifyContent:l?"stretch":"center",alignItems:l?"stretch":"center",gap:l?"0":"1rem",height:l?"auto":"60px",...b};return e.jsx("div",{className:p,style:L,onClick:c,children:a})},nt=({value:t})=>e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"44px",height:"32px",zIndex:3},children:[e.jsx("svg",{width:"40",height:"32",viewBox:"0 0 40 32",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",style:{position:"absolute",zIndex:1},children:e.jsx("path",{d:"M2 2h28l6 14-6 14H2l6-14-6-14z"})}),e.jsx("span",{style:{position:"absolute",fontSize:"0.8rem",fontWeight:500,color:"var(--text-primary)",textAlign:"center",zIndex:2,left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:t})]}),Wt=({type:t,tier:a,isEditMode:c,onUpdate:p,itemId:b})=>{const g=(B=>{if(!B)return 0;const S=document.createElement("canvas").getContext("2d");S.font="600 11px system-ui, -apple-system, sans-serif";const $=S.measureText(B.toUpperCase()).width;return console.log("Text measurement:",{text:B,font:S.font,width:$}),$})(t),L=4,u=18,M=Math.max(50,g+L+u),H=M+15;return c?e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",gap:"8px",height:"32px"},children:[e.jsxs("select",{value:t||"",onChange:B=>{p&&p(b,{type:B.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",outline:"none",borderRadius:"4px",padding:"4px 8px",width:"95px",height:"24px"},children:[e.jsx("option",{value:"Standard",children:"Standard"}),e.jsx("option",{value:"Solo",children:"Solo"}),e.jsx("option",{value:"Bruiser",children:"Bruiser"}),e.jsx("option",{value:"Horde",children:"Horde"}),e.jsx("option",{value:"Minion",children:"Minion"}),e.jsx("option",{value:"Ranged",children:"Ranged"}),e.jsx("option",{value:"Leader",children:"Leader"}),e.jsx("option",{value:"Skulk",children:"Skulk"}),e.jsx("option",{value:"Social",children:"Social"}),e.jsx("option",{value:"Support",children:"Support"})]}),e.jsxs("div",{style:{position:"relative",width:"24px",height:"24px"},children:[e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",width:"20px",height:"20px",backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",borderRadius:"2px"}}),e.jsx("input",{type:"text",value:a||"",onChange:B=>{const U=B.target.value.replace(/[^1-4]/g,"");U.length<=1&&p&&p(b,{tier:U===""?"":parseInt(U)})},onKeyDown:B=>{if(B.key==="ArrowUp"){B.preventDefault();const U=parseInt(a)||1;p&&p(b,{tier:Math.min(U+1,4)})}else if(B.key==="ArrowDown"){B.preventDefault();const U=parseInt(a)||1;p&&p(b,{tier:Math.max(U-1,1)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"transparent",border:"none",color:"var(--text-primary)",fontSize:"0.8rem",fontWeight:600,width:"24px",height:"24px",textAlign:"center",outline:"none",zIndex:1},maxLength:"1"})]})]}):e.jsxs("div",{style:{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"center",height:"32px",width:`${H}px`},children:[e.jsxs("svg",{width:H,height:"32",viewBox:`0 0 ${H} 32`,style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1},children:[e.jsx("rect",{x:"1",y:"6",width:M-1,height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4",ry:"4"}),e.jsx("rect",{x:M-10,y:"6",width:"20",height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"2",ry:"2",transform:`rotate(45 ${M-1} 16)`})]}),e.jsx("span",{style:{position:"absolute",top:"50%",left:"4px",transform:"translateY(-50%)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",color:"var(--text-primary)",zIndex:2,pointerEvents:"none"},children:t}),e.jsx("span",{style:{position:"absolute",top:"50%",left:`${M-.5}px`,transform:"translate(-50%, -50%)",fontSize:"0.8rem",fontWeight:600,color:"white",zIndex:2,pointerEvents:"none",textAlign:"center",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",width:"20px",height:"20px"},children:a})]})},_e=({feature:t,featureType:a,item:c,onUpdate:p,handleFeatureDeleteClick:b,deleteConfirmations:l,getFeatureKey:g})=>{var B,U;const L=()=>{try{const $=[...(c==null?void 0:c.features)||[]],ee=$.filter(V=>V.type===a),F=ee.findIndex(V=>V===t);if(F>0&&F<ee.length){const V=ee[F],q=ee[F-1];if(V&&q){const se=$.findIndex(ie=>ie===V),I=$.findIndex(ie=>ie===q);se>=0&&I>=0&&($[se]=q,$[I]=V,p&&p(c.id,{features:$}))}}}catch(S){console.error(`Error in ${a.toLowerCase()} up button:`,S)}},u=()=>{try{const $=[...(c==null?void 0:c.features)||[]],ee=$.filter(V=>V.type===a),F=ee.findIndex(V=>V===t);if(F<ee.length-1&&F>=0){const V=ee[F],q=ee[F+1];if(V&&q){const se=$.findIndex(ie=>ie===V),I=$.findIndex(ie=>ie===q);se>=0&&I>=0&&($[se]=q,$[I]=V,p&&p(c.id,{features:$}))}}}catch(S){console.error(`Error in ${a.toLowerCase()} down button:`,S)}},M=S=>S.type===a,H=S=>S.type===a&&S.name.trim();return e.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",alignSelf:"stretch"},children:[e.jsx("button",{onClick:L,disabled:(c.features||[]).filter(M).findIndex(S=>S===t)===0,tabIndex:"-1",style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(c.features||[]).filter(H).length>=2&&(c.features||[]).filter(M).findIndex(S=>S===t)!==0&&t.name.trim()?"white":"var(--text-secondary)",cursor:(c.features||[]).filter(H).length>=2&&(c.features||[]).filter(M).findIndex(S=>S===t)!==0&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↑"}),e.jsx("button",{onClick:()=>b(t),disabled:!t.name.trim()&&!t.description.trim(),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:l[g(t)]?"var(--danger)":"var(--gray-700)",color:!t.name.trim()&&!t.description.trim()?"var(--text-secondary)":"white",cursor:!t.name.trim()&&!t.description.trim()?"not-allowed":"pointer",opacity:!t.name.trim()&&!t.description.trim()?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"×"}),e.jsx("button",{onClick:u,disabled:(c.features||[]).filter(M).findIndex(S=>S===t)===(c.features||[]).filter(M).length-1,style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(c.features||[]).filter(H).length>=2&&(c.features||[]).filter(M).findIndex(S=>S===t)<(c.features||[]).filter(M).length-1&&((B=(c.features||[]).filter(M)[(c.features||[]).filter(M).findIndex(S=>S===t)+1])!=null&&B.name.trim())&&t.name.trim()?"white":"var(--text-secondary)",cursor:(c.features||[]).filter(H).length>=2&&(c.features||[]).filter(M).findIndex(S=>S===t)<(c.features||[]).filter(M).length-1&&((U=(c.features||[]).filter(M)[(c.features||[]).filter(M).findIndex(S=>S===t)+1])!=null&&U.name.trim())&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↓"})]})},ue={transitions:{hoverIn:"all 0.1s ease",hoverOut:"all 0.3s ease"},card:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"8px",cursor:"pointer",transition:"all 0.1s ease",position:"relative"},cardHover:{backgroundColor:"var(--bg-card-hover)"},cardDead:{opacity:.6,backgroundColor:"var(--gray-800)",borderColor:"var(--border)"},cardAtMax:{backgroundColor:"var(--success)",borderColor:"var(--success)"},rowMain:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},rowTitle:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",margin:0},rowMeta:{display:"flex",gap:"8px",alignItems:"center"},badge:{padding:"2px 6px",borderRadius:"3px",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},typeBadge:{backgroundColor:"var(--purple)",color:"var(--text-primary)"},tierBadge:{backgroundColor:"var(--info)",color:"var(--text-primary)"},damageInputPopup:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,borderRadius:"8px"},damageInputContent:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"8px",padding:"8px",display:"flex",flexDirection:"row",gap:"8px",minWidth:"200px",alignItems:"center",position:"absolute",right:"1rem",top:"50%",transform:"translateY(-50%)"},damageInput:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"4px",padding:"4px 6px",color:"var(--text-primary)",fontSize:"16px",width:"80px",textAlign:"center"},damageIndicators:{display:"flex",gap:"8px",alignItems:"center",justifyContent:"center"},damageDrop:{fontSize:"16px",color:"var(--text-secondary)",cursor:"pointer",transition:"color 0.1s ease"},applyButton:{backgroundColor:"var(--gray-600)",color:"white",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"32px",minHeight:"32px"}},Tt=(t,a,c,p)=>{const[b,l]=E.useState(!1),[g,L]=E.useState("");E.useEffect(()=>{if(b){const S=$=>{$.target.closest(".damage-input-popup")||(l(!1),L(""))};return document.addEventListener("click",S),()=>document.removeEventListener("click",S)}},[b]);const u=S=>{S.stopPropagation(),S.preventDefault();const $=t.hp||0,ee=t.hpMax||1,F=S.currentTarget.getBoundingClientRect(),V=S.clientX-F.left,q=F.width/ee;Math.floor(V/q)<$?c&&c(t.id,1,t.hp):a&&a(t.id,1,t.hp,t.hpMax)},M=S=>{S.stopPropagation(),S.preventDefault();const $=t.stress||0,ee=t.stressMax||1,F=S.currentTarget.getBoundingClientRect(),V=S.clientX-F.left,q=F.width/ee;Math.floor(V/q)<$?p&&p(t.id,-1,t.stress,t.stressMax):p&&p(t.id,1,t.stress,t.stressMax)},H=S=>{S.stopPropagation(),(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")&&(l(!0),L(t.type==="Minion"?"1":""))},B=()=>{const S=parseInt(g);if(S>0){if(t.type==="Minion")a&&a(t.id,S,t.hp,t.hpMax);else{let $=0;S>=t.thresholds.severe?$=3:S>=t.thresholds.major?$=2:S>=1&&($=1),a&&a(t.id,$,t.hp,t.hpMax)}l(!1),L("")}};return{showDamageInput:b,damageValue:g,setDamageValue:L,setShowDamageInput:l,handleHpClick:u,handleStressClick:M,handleDifficultyClick:H,applyDamage:B,handleKeyDown:S=>{S.key==="Enter"?B():S.key==="Escape"&&(l(!1),L(""))}}},Oe=({item:t,type:a,mode:c="expanded",onClick:p,onDelete:b,onApplyDamage:l,onApplyHealing:g,onApplyStressChange:L,onUpdate:u,adversaries:M=[],isSelected:H=!1,isEditMode:B=!1,instances:U=[],isEmbedded:S=!1})=>{const[$,ee]=E.useState({}),F=y=>{const C=(t.features||[]).filter(z=>z.type===y.type).findIndex(z=>z===y);return`${y.type}-${C}-${y.name||"blank"}`},V=(y,j)=>`experience-${j}-${typeof y=="string"?y:y.name||"blank"}`,q=y=>{const j=F(y);if($[j]){const C=t.features.filter(z=>z!==y);u&&u(t.id,{features:C}),ee(z=>{const _={...z};return delete _[j],_})}else ee(C=>({...C,[j]:!0})),setTimeout(()=>{ee(C=>{const z={...C};return delete z[j],z})},3e3)},se=(y,j)=>{const C=V(y,j);if($[C]){const z=[...t.experience||[]];z.splice(j,1),u&&u(t.id,{experience:z}),ee(_=>{const ae={..._};return delete ae[C],ae})}else ee(z=>({...z,[C]:!0})),setTimeout(()=>{ee(z=>{const _={...z};return delete _[C],_})},3e3)},I=Tt(t,l,g,L);(a==="adversary"||a==="adversaries")&&I.handleDifficultyClick;const ie=(y=!1)=>{let j={...ue.card};if(H?j.transition="none":j.transition=ue.transitions.hoverOut,y){const{marginTop:C,...z}=j;j=z}return H&&(j={...j,...ue.cardHover}),a==="adversary"&&(t.hp||0)>=(t.hpMax||1)&&(j={...j,...ue.cardDead}),j},ce=()=>{if(S)return"";let y="border rounded-lg";return H&&(y+=" border-hover"),y},me=()=>{var y;if(a==="adversary"||a==="adversaries"){const j=t.baseName||((y=t.name)==null?void 0:y.replace(/\s+\(\d+\)$/,""))||"",C=t.duplicateNumber||1,z=[...M];return M.some(T=>T.id===t.id)||z.push(t),z.filter(T=>T.baseName===j).length>1?`${j} (${C})`:j}return t.name},X=()=>{const y=[];return t.type&&y.push(e.jsx("span",{style:{...ue.badge,...ue.typeBadge},children:t.type},"type")),y},K=()=>a!=="adversary"||!I.showDamageInput||!(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")?null:e.jsx("div",{className:"damage-input-popup",style:ue.damageInputPopup,onClick:y=>{y.stopPropagation(),y.target===y.currentTarget&&(a==="adversary"||a==="adversaries")&&(I.setShowDamageInput(!1),I.setDamageValue(""))},children:e.jsxs("div",{className:"border rounded-lg",style:{...ue.damageInputContent,borderColor:"var(--border)"},onClick:y=>y.stopPropagation(),children:[e.jsx("input",{type:"number",inputMode:"numeric",enterKeyHint:"done",placeholder:"dmg",min:(t.type==="Minion","0"),value:a==="adversary"||a==="adversaries"?I.damageValue:"",onChange:y=>{(a==="adversary"||a==="adversaries")&&I.setDamageValue(y.target.value)},onKeyDown:a==="adversary"||a==="adversaries"?I.handleKeyDown:void 0,className:"border rounded-sm",style:{...ue.damageInput,borderColor:"var(--border)"},autoFocus:!0}),e.jsxs("div",{style:ue.damageIndicators,children:[t.type==="Minion"?(()=>{var _,ae;const y=parseInt(a==="adversary"||a==="adversaries"?I.damageValue:"0")||0,j=(_=t.features)==null?void 0:_.find(T=>{var i;return(i=T.name)==null?void 0:i.startsWith("Minion (")}),C=j?parseInt(((ae=j.name.match(/\((\d+)\)/))==null?void 0:ae[1])||"1"):1,z=Math.floor(y/C);return y>=C&&z>0?e.jsxs("span",{style:{...ue.damageDrop,color:"var(--red)"},title:`${y} damage can defeat ${z+1} minion${z+1!==1?"s":""} (1 + ${z} additional)`,children:["+",z," additional minion(s)"]}):e.jsx("span",{style:ue.damageDrop,title:`${y} damage defeats this minion only`,children:"+0 additional minion(s)"})})():[1,2,3].map(y=>{const j=parseInt(a==="adversary"||a==="adversaries"?I.damageValue:"0")||0;let C=!1;return y===1&&j>=1&&(C=!0),y===2&&j>=t.thresholds.major&&(C=!0),y===3&&j>=t.thresholds.severe&&(C=!0),e.jsx("span",{style:{...ue.damageDrop,color:C?"var(--red)":"var(--text-secondary)"},onClick:z=>{z.stopPropagation(),(a==="adversary"||a==="adversaries")&&(y===1?I.setDamageValue("1"):y===2?I.setDamageValue(t.thresholds.major.toString()):y===3&&I.setDamageValue(t.thresholds.severe.toString()))},title:`Click to set damage to ${y===1?"1":y===2?t.thresholds.major:t.thresholds.severe}`,children:e.jsx(at,{size:16})},y)}),e.jsx("button",{style:{...ue.applyButton,backgroundColor:"var(--gray-600)"},onClick:y=>{y.stopPropagation(),(a==="adversary"||a==="adversaries")&&(!I.damageValue||parseInt(I.damageValue)<1?(I.setShowDamageInput(!1),I.setDamageValue("")):I.applyDamage())},title:!I.damageValue||parseInt(I.damageValue)<1?"Close damage input":"Apply damage",children:!I.damageValue||parseInt(I.damageValue)<1?e.jsx(Fe,{size:16}):e.jsx(vt,{size:16})})]})]})}),re=()=>{var C,z,_,ae,T;const y=(t.hp||0)>=(t.hpMax||1),j=c==="edit";return console.log("=== EXPANDED ADVERSARY CARD DEBUG ==="),console.log("Item data:",t),console.log("Item ID:",t.id),console.log("Item name:",t.name),console.log("Item type:",t.type),console.log("Item tier:",t.tier),console.log("Item difficulty:",t.difficulty),console.log("Item atk:",t.atk,"Type:",typeof t.atk),console.log("Item hpMax:",t.hpMax),console.log("Item stressMax:",t.stressMax),console.log("Item thresholds:",t.thresholds),console.log("Item experience:",t.experience),console.log("Item features:",t.features),console.log("Item motives:",t.motives),console.log("Item description:",t.description),console.log("Is custom?",t.isCustom||t.source==="Homebrew"),console.log("====================================="),e.jsxs("div",{className:ce(),style:{...ie(!0),padding:0,minHeight:"400px",opacity:y?.7:1,backgroundColor:y?"var(--gray-900)":ie(!0).backgroundColor,borderColor:y?"color-mix(in srgb, var(--gray-600) 40%, transparent)":H?"var(--purple)":"var(--border)",borderWidth:"2px",display:"flex",flexDirection:"column",position:"relative"},onClick:p,children:[y&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                45deg,
                transparent,
                transparent 8px,
                var(--gray-600) 1px,
                var(--gray-600) 9px
              )`,pointerEvents:"none",zIndex:9999}})}),e.jsx("div",{className:"border-b",style:{padding:"8px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative",zIndex:y?1:"auto",borderBottomColor:H?"var(--purple)":"var(--border)"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",position:"relative",zIndex:y?1:"auto",padding:"2px",minHeight:"40px"},children:[j?e.jsx("input",{type:"text",value:t.name||"",onChange:i=>{u&&u(t.id,{name:i.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"4px",color:"var(--text-primary)",fontSize:"1.1rem",fontWeight:"600",padding:"0.5rem",width:"100%",maxWidth:"300px",paddingRight:"0.625rem"},placeholder:"Name"}):e.jsx("h4",{style:{...ue.rowTitle,color:y?"color-mix(in srgb, var(--gray-400) 80%, transparent)":ue.rowTitle.color,textAlign:"left",margin:0,fontSize:"1.1rem",paddingRight:"6px"},children:((C=t.name)==null?void 0:C.replace(/\s+\(\d+\)$/,""))||t.name}),(t.type||t.tier||j)&&e.jsx(Wt,{type:t.type,tier:t.tier,isEditMode:j,onUpdate:u,itemId:t.id})]})}),e.jsxs("div",{style:{borderRadius:"0 0 8px 8px"},children:[(t.motives||j)&&e.jsx("div",{style:{padding:"0.5rem 8px",textAlign:"center"},children:j?e.jsx("input",{type:"text",value:t.motives||"",onChange:i=>u&&u(t.id,{motives:i.target.value}),placeholder:"Motives...",style:{width:"100%",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}):e.jsxs("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,textAlign:"center"},children:[t.motives,t.motives&&!t.motives.endsWith(".")?".":""]})}),(t.difficulty||t.atk!==void 0||t.thresholds&&t.type!=="Minion"||t.experience&&t.experience.length>0||j)&&e.jsxs("div",{style:{padding:"0.5rem 8px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[(t.difficulty||j)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[e.jsx(ft,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(0deg)"}}),j?e.jsx("input",{type:"text",value:t.difficulty||"",onChange:i=>{const x=i.target.value.replace(/[^0-9]/g,"");x.length<=2&&u&&u(t.id,{difficulty:parseInt(x)||0})},onKeyDown:i=>{if(i.key==="ArrowUp"){i.preventDefault();const x=parseInt(t.difficulty)||0;u&&u(t.id,{difficulty:Math.min(x+1,99)})}else if(i.key==="ArrowDown"){i.preventDefault();const x=parseInt(t.difficulty)||0;u&&u(t.id,{difficulty:Math.max(x-1,0)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"2"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:t.difficulty})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Difficulty"})]}),(t.atk!==void 0||j)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[e.jsx(yt,{size:38,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(45deg)"}}),j?e.jsx("input",{type:"text",value:(()=>{const i=typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0;return i>=0?`+${i}`:i.toString()})(),onChange:i=>{const x=i.target.value.replace(/[^0-9+\-]/g,"");if(x.length<=4){const o=parseInt(x.replace(/[^0-9\-]/g,""))||0;u&&u(t.id,{atk:o})}},onKeyDown:i=>{if(i.key==="ArrowUp"){i.preventDefault();const o=(typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0)+1;u&&u(t.id,{atk:o})}else if(i.key==="ArrowDown"){i.preventDefault();const o=(typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0)-1;u&&u(t.id,{atk:o})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"3"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:(()=>{const i=typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk;return i>=0?`+${i}`:i})()})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Attack"})]})]}),e.jsx("div",{style:{paddingTop:"0"},children:j?e.jsx("div",{style:{display:"flex",flexDirection:"column",marginTop:"-0.25rem"},children:(()=>{const i=t.experience||[],x=i.length===0?[{name:"",modifier:1}]:i;return x.map((o,w)=>{var N,v,n,d,r,s,h,Q,ne,G,Z,le,fe,be,we,Se,ke,Ae,ze,We,Te,Me,m,A,P;return e.jsxs("div",{style:{position:"relative",marginBottom:"0.5rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("input",{type:"text",value:typeof o=="object"&&o.modifier>=1?`+${o.modifier}`:"+1",onChange:R=>{const W=[...t.experience||[]],f=parseInt(R.target.value.replace(/[^0-9+-]/g,""))||1,k=Math.max(1,f);W[w]={name:typeof o=="string"?o:o.name||"",modifier:k},u&&u(t.id,{experience:W})},onKeyDown:R=>{if(R.key==="ArrowUp"){R.preventDefault();const W=[...t.experience||[]],f=typeof o=="object"?Math.max(1,o.modifier):1;W[w]={name:typeof o=="string"?o:o.name||"",modifier:f+1},u&&u(t.id,{experience:W})}else if(R.key==="ArrowDown"){R.preventDefault();const W=[...t.experience||[]],f=typeof o=="object"?Math.max(1,o.modifier):1;W[w]={name:typeof o=="string"?o:o.name||"",modifier:Math.max(1,f-1)},u&&u(t.id,{experience:W})}},style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)",textAlign:"center",outline:"none"}})}),e.jsxs("div",{style:{marginLeft:"32px",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:typeof o=="string"?o:o.name||"",onChange:R=>{const W=[...t.experience||[]],f=typeof o=="object"?o.modifier:1;W[w]={name:R.target.value,modifier:f};const k=W[W.length-1];k&&k.name.trim()&&W.push({name:"",modifier:1}),u&&u(t.id,{experience:W})},placeholder:"Experience name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsxs("div",{style:{display:"flex",gap:"0.125rem"},children:[e.jsx("button",{onClick:()=>{var D,O;const R=[...t.experience||[]],W=typeof o=="string"?o.trim():(D=o.name)==null?void 0:D.trim(),f=R[w-1],k=typeof f=="string"?f.trim():(O=f.name)==null?void 0:O.trim();w>0&&w<R.length&&W&&k&&(R[w]=f,R[w-1]=o,u&&u(t.id,{experience:R}))},disabled:w===0||!(typeof o=="string"?o.trim():(N=o.name)!=null&&N.trim())||!(typeof x[w-1]=="string"?x[w-1].trim():(v=x[w-1].name)!=null&&v.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:w===0||!(typeof o=="string"?o.trim():(n=o.name)!=null&&n.trim())||!(typeof x[w-1]=="string"?x[w-1].trim():(d=x[w-1].name)!=null&&d.trim())?"var(--gray-800)":"var(--gray-700)",color:w===0||!(typeof o=="string"?o.trim():(r=o.name)!=null&&r.trim())||!(typeof x[w-1]=="string"?x[w-1].trim():(s=x[w-1].name)!=null&&s.trim())?"var(--text-secondary)":"white",cursor:w===0||!(typeof o=="string"?o.trim():(h=o.name)!=null&&h.trim())||!(typeof x[w-1]=="string"?x[w-1].trim():(Q=x[w-1].name)!=null&&Q.trim())?"not-allowed":"pointer",opacity:w===0||!(typeof o=="string"?o.trim():(ne=o.name)!=null&&ne.trim())||!(typeof x[w-1]=="string"?x[w-1].trim():(G=x[w-1].name)!=null&&G.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move up",children:"↑"}),e.jsx("button",{onClick:()=>{var D,O;const R=[...t.experience||[]],W=typeof o=="string"?o.trim():(D=o.name)==null?void 0:D.trim(),f=R[w+1],k=typeof f=="string"?f.trim():(O=f.name)==null?void 0:O.trim();w<R.length-1&&w>=0&&W&&k&&(R[w]=f,R[w+1]=o,u&&u(t.id,{experience:R}))},disabled:w===x.length-1||!(typeof o=="string"?o.trim():(Z=o.name)!=null&&Z.trim())||!(typeof x[w+1]=="string"?x[w+1].trim():(le=x[w+1].name)!=null&&le.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:w===x.length-1||!(typeof o=="string"?o.trim():(fe=o.name)!=null&&fe.trim())||!(typeof x[w+1]=="string"?x[w+1].trim():(be=x[w+1].name)!=null&&be.trim())?"var(--gray-800)":"var(--gray-700)",color:w===x.length-1||!(typeof o=="string"?o.trim():(we=o.name)!=null&&we.trim())||!(typeof x[w+1]=="string"?x[w+1].trim():(Se=x[w+1].name)!=null&&Se.trim())?"var(--text-secondary)":"white",cursor:w===x.length-1||!(typeof o=="string"?o.trim():(ke=o.name)!=null&&ke.trim())||!(typeof x[w+1]=="string"?x[w+1].trim():(Ae=x[w+1].name)!=null&&Ae.trim())?"not-allowed":"pointer",opacity:w===x.length-1||!(typeof o=="string"?o.trim():(ze=o.name)!=null&&ze.trim())||!(typeof x[w+1]=="string"?x[w+1].trim():(We=x[w+1].name)!=null&&We.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move down",children:"↓"}),e.jsx("button",{onClick:()=>se(o,w),disabled:!(typeof o=="string"?o.trim():(Te=o.name)!=null&&Te.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:$[V(o,w)]?"var(--danger)":(typeof o=="string"?o.trim():(Me=o.name)!=null&&Me.trim())?"var(--gray-700)":"var(--gray-800)",color:(typeof o=="string"?o.trim():(m=o.name)!=null&&m.trim())?"white":"var(--text-secondary)",cursor:(typeof o=="string"?o.trim():(A=o.name)!=null&&A.trim())?"pointer":"not-allowed",opacity:(typeof o=="string"?o.trim():(P=o.name)!=null&&P.trim())?1:.5,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:$[V(o,w)]?"Click again to confirm delete":"Delete experience",children:"×"})]})]})]},w)})})()}):e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:t.experience&&t.experience.length>0?t.experience.map((i,x)=>{if(typeof i=="string"){const o=i.match(/^(.+?)\s*([+-]?\d+)$/);if(o){const[,w,N]=o;return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:N})})}),e.jsx("span",{style:{marginLeft:"32px"},children:w})]},x)}else return e.jsx("div",{style:{marginBottom:"0.25rem"},children:i},x)}else return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:e.jsxs("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:[i.modifier>=0?"+":"",i.modifier]})})}),e.jsx("span",{style:{marginLeft:"32px"},children:i.name})]},x)}):null})})]}),(t.features&&t.features.length>0||j)&&e.jsxs("div",{style:{padding:"0 8px 8px 8px"},children:[(t.atk!==void 0&&t.weapon||j)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Standard Attack"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:j?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",marginTop:"0.75rem",marginBottom:"0.75rem"},children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[e.jsx("input",{type:"text",value:t.weapon||"",onChange:i=>u&&u(t.id,{weapon:i.target.value}),placeholder:"Standard attack name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}}),e.jsxs("select",{value:t.range||"",onChange:i=>u&&u(t.id,{range:i.target.value}),style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",appearance:"none",backgroundImage:`url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",backgroundSize:"1rem",paddingRight:"2rem"},children:[e.jsx("option",{value:""}),e.jsx("option",{value:"Melee",children:"Melee"}),e.jsx("option",{value:"Very Close",children:"Very Close"}),e.jsx("option",{value:"Close",children:"Close"}),e.jsx("option",{value:"Far",children:"Far"}),e.jsx("option",{value:"Very Far",children:"Very Far"})]}),e.jsx("input",{type:"text",value:t.damage||"",onChange:i=>u&&u(t.id,{damage:i.target.value}),placeholder:"Damage (e.g., 1d6+2)",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}})]})}):t.atk!==void 0&&t.weapon&&e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:t.weapon}),e.jsxs("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:["Make an attack against a target within ",t.range||"Melee"," range. On a success, deal ",t.damage||"damage varies","."]})]})})]}),(t.features.filter(i=>i.type==="Action").length>0||j)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Actions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const i=t.features.filter(o=>o.type==="Action");return(j&&i.length===0?[{type:"Action",name:"",description:""}]:i).map((o,w)=>j?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:o.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false","data-lpignore":"true","data-form-type":"other",name:`feature-name-${o.type.toLowerCase()}`,onChange:N=>{const v=[...t.features||[]],n=v.findIndex(s=>s.type==="Action"&&s===o);n>=0?v[n]={...v[n],name:N.target.value}:v.push({type:"Action",name:N.target.value,description:o.description||""});const d=v.filter(s=>s.type==="Action"),r=d[d.length-1];r&&r.name.trim()&&v.push({type:"Action",name:"",description:""}),u&&u(t.id,{features:v})},placeholder:"Action name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:o.description||"",onChange:N=>{const v=[...t.features||[]],n=v.findIndex(s=>s.type==="Action"&&s===o);n>=0?v[n]={...v[n],description:N.target.value}:v.push({type:"Action",name:o.name||"",description:N.target.value});const d=v.filter(s=>s.type==="Action"),r=d[d.length-1];r&&r.name.trim()&&v.push({type:"Action",name:"",description:""}),u&&u(t.id,{features:v})},onInput:N=>{const v=N.target.offsetHeight;N.target.style.height="auto";const n=N.target.scrollHeight,d=n>v?n:v;N.target.style.height=d+"px"},placeholder:"Action description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(_e,{feature:o,featureType:"Action",item:t,onUpdate:u,handleFeatureDeleteClick:q,deleteConfirmations:$,getFeatureKey:F})]},w):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:o.name}),o.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:o.description})]},w))})()})]}),(t.features.filter(i=>i.type==="Passive").length>0||j)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Passives"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const i=t.features.filter(o=>o.type==="Passive");return(j&&i.length===0?[{type:"Passive",name:"",description:""}]:i).map((o,w)=>j?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:o.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:N=>{const v=[...t.features||[]],n=v.findIndex(s=>s.type==="Passive"&&s===o);n>=0?v[n]={...v[n],name:N.target.value}:v.push({type:"Passive",name:N.target.value,description:o.description||""});const d=v.filter(s=>s.type==="Passive"),r=d[d.length-1];r&&r.name.trim()&&v.push({type:"Passive",name:"",description:""}),u&&u(t.id,{features:v})},placeholder:"Passive name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:o.description||"",onChange:N=>{const v=[...t.features||[]],n=v.findIndex(s=>s.type==="Passive"&&s===o);n>=0?v[n]={...v[n],description:N.target.value}:v.push({type:"Passive",name:o.name||"",description:N.target.value});const d=v.filter(s=>s.type==="Passive"),r=d[d.length-1];r&&r.name.trim()&&v.push({type:"Passive",name:"",description:""}),u&&u(t.id,{features:v})},onInput:N=>{const v=N.target.offsetHeight;N.target.style.height="auto";const n=N.target.scrollHeight,d=n>v?n:v;N.target.style.height=d+"px"},placeholder:"Passive description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(_e,{feature:o,featureType:"Passive",item:t,onUpdate:u,handleFeatureDeleteClick:q,deleteConfirmations:$,getFeatureKey:F})]},w):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:o.name}),o.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:o.description})]},w))})()})]}),(t.features.filter(i=>i.type==="Reaction").length>0||j)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Reactions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const i=t.features.filter(o=>o.type==="Reaction");return(j&&i.length===0?[{type:"Reaction",name:"",description:""}]:i).map((o,w)=>j?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:o.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:N=>{const v=[...t.features||[]],n=v.findIndex(s=>s.type==="Reaction"&&s===o);n>=0?v[n]={...v[n],name:N.target.value}:v.push({type:"Reaction",name:N.target.value,description:o.description||""});const d=v.filter(s=>s.type==="Reaction"),r=d[d.length-1];r&&r.name.trim()&&v.push({type:"Reaction",name:"",description:""}),u&&u(t.id,{features:v})},placeholder:"Reaction name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:o.description||"",onChange:N=>{const v=[...t.features||[]],n=v.findIndex(s=>s.type==="Reaction"&&s===o);n>=0?v[n]={...v[n],description:N.target.value}:v.push({type:"Reaction",name:o.name||"",description:N.target.value});const d=v.filter(s=>s.type==="Reaction"),r=d[d.length-1];r&&r.name.trim()&&v.push({type:"Reaction",name:"",description:""}),u&&u(t.id,{features:v})},onInput:N=>{const v=N.target.offsetHeight;N.target.style.height="auto";const n=N.target.scrollHeight,d=n>v?n:v;N.target.style.height=d+"px"},placeholder:"Reaction description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(_e,{feature:o,featureType:"Reaction",item:t,onUpdate:u,handleFeatureDeleteClick:q,deleteConfirmations:$,getFeatureKey:F})]},w):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:o.name}),o.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:o.description})]},w))})()})]})]})]}),(U&&U.length>0||t.type!=="Minion"&&(t.thresholds||j))&&e.jsxs("div",{style:{padding:"0 8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Status"})]}),j?e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border)"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"number",value:t.hpMax||"",onChange:i=>{const x=parseInt(i.target.value)||1;u&&u(t.id,{hpMax:x})},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),e.jsx(Re,{type:"adversaryHP",value:0,maxValue:t.hpMax||1,showTooltip:!1}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:"HP"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"number",value:t.stressMax||"",onChange:i=>{const x=parseInt(i.target.value)||1;u&&u(t.id,{stressMax:x})},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),e.jsx(Re,{type:"adversaryStress",value:0,maxValue:t.stressMax||1,showTooltip:!1}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:"Stress"})]})]})})}):U&&U.length>0&&U.map((i,x)=>{const o=(i.hp||0)>=(i.hpMax||1);return e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsxs("div",{style:{backgroundColor:o?"var(--gray-900)":"var(--bg-primary)",borderRadius:"6px",padding:"0.25rem 0.5rem",border:"1px solid",borderColor:o?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",display:"flex",justifyContent:"flex-start",alignItems:"center",gap:"0.5rem",opacity:o?.7:1,position:"relative",transition:"all 0.2s ease",minHeight:"40px"},children:[o&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                          45deg,
                          transparent 0px,
                          transparent 8px,
                          var(--gray-600) 9px,
                          var(--gray-600) 9px
                        )`,pointerEvents:"none",zIndex:1,borderRadius:"4px"}})}),e.jsx("div",{style:{backgroundColor:o?"var(--gray-900)":"var(--bg-card)",border:"1px solid",borderColor:o?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",borderRadius:"50%",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",flexShrink:0,opacity:o?.5:1},children:e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:o?"var(--gray-400)":"var(--text-primary)"},children:i.duplicateNumber||1})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.125rem"},children:[e.jsx("div",{style:{opacity:o?.3:1},children:e.jsx(Re,{type:"adversaryHP",value:i.hp||0,maxValue:i.hpMax||1,onPipClick:(w,N)=>{if(l&&a==="adversary"){const v=i.hp||0,n=i.hpMax||1;N?g&&g(i.id,1,v):v<n&&l(i.id,1,v,n)}},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})}),i.stressMax>0&&e.jsx("div",{style:{opacity:o?.3:1},children:e.jsx(Re,{type:"adversaryStress",value:i.stress||0,maxValue:i.stressMax,onPipClick:(w,N)=>{L&&a==="adversary"&&(N?L(i.id,-1):L(i.id,1))},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})})]})]},i.id)},i.id)}),t.type!=="Minion"&&(t.thresholds||j)&&e.jsx("div",{style:{display:"flex",justifyContent:"center",paddingTop:"1px",marginTop:"0.5rem",marginBottom:"0.5rem"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",position:"relative"},children:e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",height:"36px"},children:[e.jsx("svg",{width:"300",height:"36",viewBox:"0 0 300 36",style:{position:"absolute",zIndex:1},children:e.jsx("rect",{x:"20",y:"6",width:"260",height:"24",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4"})}),e.jsx("div",{style:{position:"relative",zIndex:2,display:"flex",alignItems:"center",gap:"0.5rem"},children:j?e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",fontSize:"0.8rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),e.jsx("input",{type:"text",value:((z=t.thresholds)==null?void 0:z.major)||"7",onChange:i=>{const x=i.target.value.replace(/[^0-9]/g,"");x.length<=2&&u&&u(t.id,{thresholds:{...t.thresholds,major:parseInt(x)||7}})},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),e.jsx("input",{type:"text",value:((_=t.thresholds)==null?void 0:_.severe)||"14",onChange:i=>{const x=i.target.value.replace(/[^0-9]/g,"");x.length<=2&&u&&u(t.id,{thresholds:{...t.thresholds,severe:parseInt(x)||14}})},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),e.jsx(nt,{value:((ae=t.thresholds)==null?void 0:ae.major)||"7"}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),e.jsx(nt,{value:((T=t.thresholds)==null?void 0:T.severe)||"14"}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]})})]})})})]}),(j||c==="expanded"&&t.description&&t.description.trim())&&e.jsxs("div",{style:{padding:"0 8px",textAlign:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Description"})]}),j?e.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-primary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"none",overflow:"hidden",fontFamily:"inherit",marginTop:"0.75rem",marginBottom:"0.75rem"},value:t.description,onChange:i=>{i.target.style.height="auto",i.target.style.height=i.target.scrollHeight+"px",u&&u(t.id,{description:i.target.value})},placeholder:"Description..."}):e.jsx("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,whiteSpace:"pre-wrap",padding:"0.5rem 0"},children:t.description})]}),K()]})};return(c==="expanded"||c==="edit")&&(a==="adversary"||a==="adversaries")?re():a==="adversary"||a==="adversaries"?null:e.jsxs("div",{className:ce(),style:ie(!0),children:[e.jsxs("div",{style:ue.rowMain,children:[e.jsx("h4",{style:ue.rowTitle,children:me()}),e.jsx("div",{style:ue.rowMeta,children:X()})]}),e.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"12px",margin:0},children:["Expanded view coming soon for ",a]})]})},Mt="modulepreload",Rt=function(t){return"/Daggerheart/"+t},ot={},Pe=function(a,c,p){if(!c||c.length===0)return a();const b=document.getElementsByTagName("link");return Promise.all(c.map(l=>{if(l=Rt(l),l in ot)return;ot[l]=!0;const g=l.endsWith(".css"),L=g?'[rel="stylesheet"]':"";if(!!p)for(let H=b.length-1;H>=0;H--){const B=b[H];if(B.href===l&&(!g||B.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${L}`))return;const M=document.createElement("link");if(M.rel=g?"stylesheet":Mt,g||(M.as="script",M.crossOrigin=""),M.href=l,document.head.appendChild(M),g)return new Promise((H,B)=>{M.addEventListener("load",H),M.addEventListener("error",()=>B(new Error(`Unable to preload CSS for ${l}`)))})})).then(()=>a()).catch(l=>{const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=l,window.dispatchEvent(g),!g.defaultPrevented)throw l})},Bt="/Daggerheart/assets/daggerheart-logo-fe7815ad.svg",Dt=({onSave:t,onRefresh:a,onAddItem:c,editingAdversary:p,onCancelEdit:b})=>{const[l,g]=E.useState({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:11,thresholds:{major:7,severe:12},hpMax:3,stressMax:1,atk:1,weapon:"",range:"Melee",damage:"",experience:[],features:[]}),[L,u]=E.useState(!1);je.useEffect(()=>{g(p?{name:p.name||"",tier:p.tier||1,type:p.type||"Standard",description:p.description||"",motives:p.motives||"",difficulty:p.difficulty||11,thresholds:p.thresholds||{major:7,severe:12},hpMax:p.hpMax||3,stressMax:p.stressMax||1,atk:p.atk||1,weapon:p.weapon||"",range:p.range||"Melee",damage:p.damage||"",experience:p.experience||[],features:p.features||[]}:{name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:11,thresholds:{major:7,severe:12},hpMax:3,stressMax:1,atk:1,weapon:"",range:"Melee",damage:"",experience:[],features:[]})},[p]);const M=async()=>{if(!l.name.trim()){alert("Please enter a name for the adversary");return}u(!0);try{const B={...l,hp:p?p.hp:0,stress:p?p.stress:0,source:"Homebrew"};if(p)B.id=p.id,await t(B,p.id),alert("Adversary updated successfully!"),b&&b();else{const U=await t(B);a&&await a(),g({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:11,thresholds:{major:7,severe:12},hpMax:3,stressMax:1,atk:1,weapon:"",range:"Melee",damage:"",experience:[],features:[]}),alert("Custom adversary created successfully!")}}catch(B){console.error("Error saving adversary:",B),alert("Error saving adversary. Please try again.")}finally{u(!1)}},H={...l,id:"new-adversary",hp:0,stress:0,source:"Homebrew"};return e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem",display:"flex",justifyContent:"center",alignItems:"flex-start"},children:e.jsxs("div",{style:{maxWidth:"600px",width:"100%"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h2",{style:{color:"var(--text-primary)",fontSize:"1.5rem",fontWeight:"600",margin:0},children:p?"Edit Custom Adversary":"Create Custom Adversary"}),e.jsx("button",{onClick:M,disabled:L||!l.name.trim(),style:{padding:"0.75rem 1.5rem",backgroundColor:L||!l.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"8px",cursor:L||!l.name.trim()?"not-allowed":"pointer",fontSize:"1rem",fontWeight:"600",opacity:L||!l.name.trim()?.6:1},children:L?p?"Saving...":"Creating...":p?"Save":"Create"})]}),e.jsx(Oe,{item:H,type:"adversary",mode:"edit",onUpdate:(B,U)=>{g(S=>({...S,...U}))}})]})})},Nt=(t,a)=>{const[c,p]=E.useState("max-content"),b=E.useCallback(()=>{if(!a.current||t<=3)return"max-content";const l=a.current.offsetWidth,L=Math.floor(l/120);return L<=1?"max-content":t===4?"max-content max-content":t===5||t===6?L>=2?"max-content max-content":"max-content":t===7?L>=3?"max-content max-content max-content":L>=2?"max-content max-content":"max-content":"repeat(auto-fit, minmax(80px, max-content))"},[t,a]);return E.useEffect(()=>{const l=b();p(l);const g=new ResizeObserver(()=>{const L=b();p(L)});return a.current&&g.observe(a.current),()=>{g.disconnect()}},[b]),c},Lt=({encounter:t})=>{var b,l;const a=E.useRef(null),c=((b=t.encounterItems)==null?void 0:b.length)||0,p=Nt(c,a);return e.jsx("div",{ref:a,className:"saved-encounter-adversary-list",style:{flex:1,fontSize:"0.8rem",color:"var(--text-secondary)",lineHeight:"1.3",display:"grid",gridTemplateColumns:p,gap:"0.25rem 1rem",gridAutoRows:"min-content"},children:((l=t.encounterItems)==null?void 0:l.length)>0?t.encounterItems.map((g,L)=>{var M;const u=g.item.baseName||((M=g.item.name)==null?void 0:M.replace(/\s+\(\d+\)$/,""))||g.item.name;return e.jsxs("div",{style:{marginBottom:"0.125rem"},children:[g.quantity,"x ",u]},L)}):e.jsx("div",{children:"No adversaries"})})},De={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},He={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1,lowerTierAdversary:1};let Be={adversaries:[]},$e={environments:[]},Xe=!1;const Pt=()=>{const t=JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]"),a=JSON.parse(localStorage.getItem("daggerheart-custom-environments")||"[]");return{customAdversaries:t,customEnvironments:a}},st=async()=>{if(Xe)return;let t={adversaries:[]},a={environments:[]},c={adversaries:[]},p={environments:[]};try{const g=await Pe(()=>import("./adversaries-9c8932de.js"),[]);t=(g==null?void 0:g.default)||g}catch(g){console.warn("Failed to load adversaries.json:",g)}try{const g=await Pe(()=>import("./environments-c340637c.js"),[]);a=(g==null?void 0:g.default)||g}catch(g){console.warn("Failed to load environments.json:",g)}try{const g=await Pe(()=>import("./playtest-adversaries-4a099c10.js"),[]);c=(g==null?void 0:g.default)||g}catch(g){console.warn("Failed to load playtest-adversaries.json:",g)}try{const g=await Pe(()=>import("./playtest-environments-d9cdffb6.js"),[]);p=(g==null?void 0:g.default)||g}catch(g){console.warn("Failed to load playtest-environments.json:",g)}const{customAdversaries:b,customEnvironments:l}=Pt();Be={...t,adversaries:[...t.adversaries||[],...c.adversaries||[],...b]},$e={...a,environments:[...a.environments||[],...p.environments||[],...l]},Xe=!0,console.log(`Loaded ${Be.adversaries.length} adversaries and ${$e.environments.length} environments`)},Ht=(t,a=[],c=4,p=1,b=!1)=>{const[l,g]=E.useState(""),[L,u]=E.useState([{field:"tier",direction:"asc"},{field:"name",direction:"asc"}]),[M,H]=E.useState([]),[B,U]=E.useState(!0),[S,$]=E.useState([]),[ee,F]=E.useState([]),[V,q]=E.useState(!1),[se,I]=E.useState(!1),ie=E.useRef(null),ce=E.useRef(null);E.useEffect(()=>{(async()=>{await st(),U(!1);let i=[];t==="adversary"?i=Be.adversaries||[]:t==="environment"&&(i=$e.environments||[]),H(i)})()},[t]);const me=T=>{const i=M.map(x=>x[T]).filter(Boolean);return[...new Set(i)].sort((x,o)=>typeof x=="number"&&typeof o=="number"?x-o:String(x).localeCompare(String(o)))},X=E.useCallback(async()=>{Xe=!1,await st();let T=[];t==="adversary"?b?T=(Be.adversaries||[]).filter(i=>{var x;return i.source==="Homebrew"||((x=i.id)==null?void 0:x.startsWith("custom-"))}):T=Be.adversaries||[]:t==="environment"&&(T=$e.environments||[]),H(T)},[t,b]);E.useEffect(()=>{X()},[b,X]);const K=me("tier"),re=me("type"),de=E.useMemo(()=>{let T=M.filter(i=>{var N,v;const x=i.name.toLowerCase().includes(l.toLowerCase())||((N=i.type)==null?void 0:N.toLowerCase().includes(l.toLowerCase()))||((v=i.description)==null?void 0:v.toLowerCase().includes(l.toLowerCase())),o=S.length===0||(S.includes("party-tier")?i.tier===p:S.includes(i.tier.toString())),w=ee.length===0||ee.includes(i.type);return x&&o&&w});return T.sort((i,x)=>{for(const o of L){const{field:w,direction:N}=o;let v=i[w],n=x[w];if(w==="tier")v=parseInt(v)||0,n=parseInt(n)||0;else if(w==="cost"){const d=r=>{if(t!=="adversary")return 0;const s=De[r.type]||2;let h=0;const Q=a.filter(G=>G.type==="adversary"&&G.item.type==="Solo"&&G.quantity>0).reduce((G,Z)=>G+Z.quantity,0),ne=a.filter(G=>G.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(G.item.type)&&G.quantity>0).reduce((G,Z)=>G+Z.quantity,0);return r.type==="Solo"&&Q===1&&(h+=2),["Bruiser","Horde","Leader","Solo"].includes(r.type)&&ne===0&&(h+=1),s+h};v=d(i),n=d(x)}else if(w==="difficulty"){const d=parseInt(v),r=parseInt(n);!isNaN(d)&&!isNaN(r)?(v=d,n=r):!isNaN(d)&&isNaN(r)?(v=d,n=999):isNaN(d)&&!isNaN(r)?(v=999,n=r):(v=String(v||"").toLowerCase(),n=String(n||"").toLowerCase())}else typeof v=="string"&&typeof n=="string"?(v=v.toLowerCase(),n=n.toLowerCase()):(v=String(v||"").toLowerCase(),n=String(n||"").toLowerCase());if(N==="asc"){if(v>n)return 1;if(v<n)return-1}else{if(v<n)return 1;if(v>n)return-1}}return 0}),T},[M,l,L,S,ee,a,c,p]),y=T=>{u(i=>{const x=i.findIndex(o=>o.field===T);if(x>=0)if(x===0){const o=[...i];return o[0]={...o[0],direction:o[0].direction==="asc"?"desc":"asc"},o}else{const o=[...i];return o.splice(x,1)[0],[{field:T,direction:"asc"},...o]}else return[{field:T,direction:"asc"},...i]})},j=T=>{$(T==="clear"?[]:T==="party-tier"?["party-tier"]:i=>i.includes(T)?i.filter(x=>x!==T):[...i,T])},C=T=>{F(T==="clear"?[]:i=>i.includes(T)?i.filter(x=>x!==T):[...i,T])},z=S.length>0,_=ee.length>0;return E.useEffect(()=>{const T=x=>{const o=x.target.closest(".filter-dropdown"),w=x.target.closest(".header-filter-icon");o||w||(q(!1),I(!1))},i=x=>{x.key==="Escape"&&(q(!1),I(!1))};return document.addEventListener("pointerdown",T,!0),document.addEventListener("mousedown",T,!0),document.addEventListener("touchstart",T,!0),document.addEventListener("click",T,!0),document.addEventListener("keydown",i,!0),()=>{document.removeEventListener("pointerdown",T,!0),document.removeEventListener("mousedown",T,!0),document.removeEventListener("touchstart",T,!0),document.removeEventListener("click",T,!0),document.removeEventListener("keydown",i,!0)}},[q,I]),{searchTerm:l,setSearchTerm:g,sortFields:L,handleSort:y,filteredAndSortedData:de,loading:B,refreshData:X,selectedTiers:S,selectedTypes:ee,showTierDropdown:V,setShowTierDropdown:q,showTypeDropdown:se,setShowTypeDropdown:I,tierFilterRef:ie,typeFilterRef:ce,uniqueTiers:K,uniqueTypes:re,handleTierSelect:j,handleTypeSelect:C,isTierFiltered:z,isTypeFiltered:_,getDropdownStyle:T=>{if(!T.current)return{};const i=T.current.getBoundingClientRect();return{position:"fixed",top:i.bottom+4,left:i.left-100,zIndex:99999}}}},Ft=({searchTerm:t,onSearchChange:a,type:c,partyControls:p,showCustomToggle:b=!1,onToggleCustom:l,filterCustom:g=!1,onExportCustomAdversaries:L,onImportCustomAdversaries:u})=>e.jsxs("div",{style:J.browserHeader,children:[e.jsx("input",{type:"text",placeholder:"Search",value:t,onChange:M=>a(M.target.value),style:J.searchInput}),p&&e.jsx("div",{style:J.partyControls,children:p})]}),Ot=({showCustomToggle:t=!1,onToggleCustom:a,filterCustom:c=!1,onExportCustomAdversaries:p,onImportCustomAdversaries:b})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)",flexShrink:0},children:[t&&e.jsxs("button",{onClick:()=>a&&a(!c),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:c?"var(--purple)":"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:c?"white":"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:l=>{c||(l.target.style.backgroundColor="var(--bg-hover)",l.target.style.borderColor="var(--purple)")},onMouseLeave:l=>{c||(l.target.style.backgroundColor="var(--bg-primary)",l.target.style.borderColor="var(--border)")},children:[e.jsx("span",{children:c?"✓":"○"}),"Custom Only"]}),e.jsxs("button",{onClick:p,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:l=>{l.target.style.backgroundColor="var(--bg-hover)",l.target.style.borderColor="var(--purple)"},onMouseLeave:l=>{l.target.style.backgroundColor="var(--bg-primary)",l.target.style.borderColor="var(--border)"},children:[e.jsx("span",{children:"↓"}),"Export"]}),e.jsxs("button",{onClick:()=>document.getElementById("import-file-input").click(),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:l=>{l.target.style.backgroundColor="var(--bg-hover)",l.target.style.borderColor="var(--purple)"},onMouseLeave:l=>{l.target.style.backgroundColor="var(--bg-primary)",l.target.style.borderColor="var(--border)"},children:[e.jsx("span",{children:"↑"}),"Import"]}),e.jsx("input",{id:"import-file-input",type:"file",accept:".json",onChange:b,style:{display:"none"}})]}),$t=({sortFields:t,onSort:a,type:c,uniqueTiers:p,uniqueTypes:b,selectedTiers:l,selectedTypes:g,showTierDropdown:L,setShowTierDropdown:u,showTypeDropdown:M,setShowTypeDropdown:H,tierFilterRef:B,typeFilterRef:U,handleTierSelect:S,handleTypeSelect:$,isTierFiltered:ee,isTypeFiltered:F,getDropdownStyle:V,costFilter:q,showCostDropdown:se,setShowCostDropdown:I,costFilterRef:ie,handleCostFilterSelect:ce,isCostFiltered:me})=>{const[X,K]=E.useState(null),de=(()=>c==="adversary"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"cost",label:"Cost",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:c==="environment"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:[])(),y=()=>{if(!se)return null;const C=[{value:"all",label:"All"},{value:"auto-grey",label:"Auto Grey"},{value:"auto-hide",label:"Auto Hide"}];return Ye.createPortal(e.jsx("div",{className:"filter-dropdown",style:{...J.filterDropdown,...V(ie),maxHeight:"60vh",overflow:"auto"},onMouseDown:z=>z.stopPropagation(),onClick:z=>z.stopPropagation(),children:C.map(z=>{const _=q===z.value;return e.jsxs("div",{style:{...J.filterOption,..._?J.filterOptionSelected:{}},onClick:()=>ce(z.value),children:[e.jsx("span",{style:J.checkIcon,children:_?e.jsx(Ne,{size:16}):e.jsx(Le,{size:16})}),e.jsx("span",{style:J.filterLabel,children:z.label})]},z.value)})}),document.body)},j=(C,z,_,ae,T,i,x,o)=>{if(!T)return null;const w=()=>{(C==="tier"||C==="type")&&ae("clear")};return Ye.createPortal(e.jsxs("div",{className:"filter-dropdown",style:{...J.filterDropdown,...V(x),maxHeight:"60vh",overflow:"auto"},onMouseDown:N=>N.stopPropagation(),onClick:N=>N.stopPropagation(),children:[e.jsxs("div",{style:{...J.filterOption,..._.length===0?J.filterOptionSelected:{}},onClick:w,children:[e.jsx("span",{style:J.checkIcon,children:_.length===0?e.jsx(Ne,{size:16}):e.jsx(Le,{size:16})}),e.jsx("span",{style:J.filterLabel,children:"All"})]}),C==="tier"&&e.jsxs("div",{style:{...J.filterOption,..._.includes("party-tier")?J.filterOptionSelected:{}},onClick:()=>ae("party-tier"),children:[e.jsx("span",{style:J.checkIcon,children:_.includes("party-tier")?e.jsx(Ne,{size:16}):e.jsx(Le,{size:16})}),e.jsx("span",{style:J.filterLabel,children:"Party Tier"})]}),z.map(N=>{const v=_.includes(N.toString());return e.jsxs("div",{style:{...J.filterOption,...v?J.filterOptionSelected:{}},onClick:()=>ae(N.toString()),children:[e.jsx("span",{style:J.checkIcon,children:v?e.jsx(Ne,{size:16}):e.jsx(Le,{size:16})}),e.jsx("span",{style:J.filterLabel,children:N})]},N)})]}),document.body)};return e.jsx("tr",{style:J.tableHeader,children:de.map(C=>e.jsxs("th",{style:{...J.tableHeaderCell,...X===C.key?J.tableHeaderCellHover:{},position:"relative",...C.key==="name"?{width:"auto",minWidth:"0"}:{},...C.key==="tier"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...C.key==="type"?{width:"80px",minWidth:"80px",maxWidth:"80px"}:{},...C.key==="difficulty"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...C.key==="cost"?{width:"50px",minWidth:"50px",maxWidth:"50px"}:{},...C.key==="action"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{}},onClick:()=>a(C.key),onMouseEnter:()=>K(C.key),onMouseLeave:()=>K(null),children:[C.hasFilter?e.jsxs("div",{style:J.headerWithFilter,children:[e.jsx("span",{style:{cursor:"pointer"},onClick:z=>{z.stopPropagation(),a(C.key)},children:C.label}),e.jsxs("button",{ref:C.key==="tier"?B:C.key==="type"?U:ie,style:{...J.headerFilterIcon,...C.key==="tier"&&ee?J.headerFilterIconActive:{},...C.key==="type"&&F?J.headerFilterIconActive:{},...C.key==="cost"&&me?J.headerFilterIconActive:{}},className:"header-filter-icon",onClick:z=>{z.stopPropagation(),C.key==="tier"?(u(!L),H(!1),I(!1)):C.key==="type"?(H(!M),u(!1),I(!1)):C.key==="cost"&&(I(!se),u(!1),H(!1))},children:[e.jsx(bt,{size:14}),C.key==="tier"&&ee||C.key==="type"&&F||C.key==="cost"&&me?e.jsx("span",{style:J.filterActiveDot}):null]})]}):C.label,C.key==="tier"&&j("tier",p,l,S,L,u,B),C.key==="type"&&j("type",b,g,$,M,H,U),C.key==="cost"&&y()]},C.key))})},Vt=({item:t,onAdd:a,type:c,onRowClick:p,encounterItems:b=[],pcCount:l=4,playerTier:g=1,remainingBudget:L=0,costFilter:u="auto-grey",onAdversaryClick:M})=>{const[H,B]=E.useState(!1),U=()=>{a(t)},S=()=>{if(c!=="adversary")return null;const F=De[t.type]||2;let V=0;const q=b.filter(I=>I.type==="adversary"&&I.item.type==="Solo"&&I.quantity>0).reduce((I,ie)=>I+ie.quantity,0),se=b.filter(I=>I.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(I.item.type)&&I.quantity>0).reduce((I,ie)=>I+ie.quantity,0);return t.type==="Solo"&&q===1&&(V+=2),["Bruiser","Horde","Leader","Solo"].includes(t.type)&&se===0&&(V+=1),F+V},ee=(()=>{if(c==="adversary"){const F=S();De[t.type];const V=F>L||L<=0;if(u==="auto-hide"&&V)return null;const q=u==="auto-grey"&&V?{opacity:.5,color:"var(--text-secondary)"}:{};return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...J.rowCell,width:"auto",minWidth:"0",textAlign:"left",...q},children:e.jsxs("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:[e.jsx("div",{style:{fontWeight:"600"},children:t.name}),t.description&&e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"0.125rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.description})]})}),e.jsx("td",{style:{...J.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...q},children:t.tier}),e.jsx("td",{style:{...J.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center",...q},children:t.type}),e.jsx("td",{style:{...J.rowCell,width:"50px",minWidth:"50px",maxWidth:"50px",textAlign:"center",...q},children:F}),e.jsx("td",{style:{...J.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...q},children:t.difficulty})]})}else if(c==="environment")return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...J.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:t.name}),e.jsx("td",{style:{...J.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:t.tier}),e.jsx("td",{style:{...J.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:t.type}),e.jsx("td",{style:{...J.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:t.difficulty})]});return null})();return ee===null?null:e.jsx(e.Fragment,{children:e.jsxs("tr",{style:{...J.row,...H?J.rowHover:{}},onClick:()=>{c==="adversary"&&M?M(t):p&&p(t,c)},onMouseEnter:()=>B(!0),onMouseLeave:()=>B(!1),children:[ee,e.jsx("td",{style:{width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",boxSizing:"border-box",overflow:"visible",textOverflow:"unset",whiteSpace:"nowrap"},children:e.jsx("button",{style:J.addButton,onClick:F=>{F.stopPropagation(),U()},onMouseEnter:F=>{F.target.style.background="var(--bg-secondary)"},onMouseLeave:F=>{F.target.style.background="var(--purple)"},children:"+"})})]})})},qt=({type:t,onAddItem:a,onCancel:c=null,onRowClick:p,encounterItems:b=[],pcCount:l=4,playerTier:g=1,partyControls:L=null,showContainer:u=!0,savedEncounters:M=[],onLoadEncounter:H,onDeleteEncounter:B,activeTab:U="adversaries",selectedCustomAdversaryId:S,onSelectCustomAdversary:$,onTabChange:ee,selectedAdversary:F,onSelectAdversary:V,filterCustom:q=!1,showCustomToggle:se=!1,onToggleCustom:I,onExportCustomAdversaries:ie,onImportCustomAdversaries:ce})=>{const{addCustomAdversary:me,updateCustomAdversary:X,customContent:K}=Ke(),[re,de]=E.useState(null),[y,j]=E.useState("all"),[C,z]=E.useState(!1),[_,ae]=E.useState({}),T=E.useRef({}),i=E.useRef(null),x=()=>{try{const f={version:"1.0",exportDate:new Date().toISOString(),customAdversaries:K.adversaries||[]},k=JSON.stringify(f,null,2),D=new Blob([k],{type:"application/json"}),O=URL.createObjectURL(D),Y=document.createElement("a");Y.href=O,Y.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(Y),Y.click(),document.body.removeChild(Y),URL.revokeObjectURL(O),console.log("Custom adversaries exported successfully")}catch(f){console.error("Failed to export custom adversaries:",f),alert("Failed to export custom adversaries. Please try again.")}},o=f=>{const k=f.target.files[0];if(!k)return;const D=new FileReader;D.onload=O=>{try{const Y=JSON.parse(O.target.result);if(!Y.customAdversaries||!Array.isArray(Y.customAdversaries))throw new Error("Invalid file format. Expected customAdversaries array.");const ge=K.adversaries||[],he=Y.customAdversaries,pe=[...ge];let ye=0,te=0;he.forEach(xe=>{if(ge.some(oe=>oe.name===xe.name&&oe.source===xe.source))te++;else{const oe={...xe,id:`custom-adv-${Date.now()}-${Math.random().toString(36).slice(2,10)}`};pe.push(oe),ye++}}),ye>0?(localStorage.setItem("daggerheart-custom-adversaries",JSON.stringify(pe)),window.location.reload(),alert(`Import successful! Added ${ye} new adversaries${te>0?`, skipped ${te} duplicates`:""}.`)):alert("No new adversaries were added. All imported adversaries already exist.")}catch(Y){console.error("Failed to import custom adversaries:",Y),alert("Failed to import custom adversaries. Please check the file format and try again.")}},D.readAsText(k),f.target.value=""},w=()=>{de(null)},N=async(f,k)=>{k?X(k,f):me(f)},v=f=>{_[f]?(B&&B(f),ae(k=>{const D={...k};return delete D[f],D}),T.current[f]&&(clearTimeout(T.current[f]),delete T.current[f])):(ae(k=>({...k,[f]:!0})),T.current[f]&&clearTimeout(T.current[f]),T.current[f]=setTimeout(()=>{ae(k=>{const D={...k};return delete D[f],D}),delete T.current[f]},3e3))};E.useEffect(()=>()=>{Object.values(T.current).forEach(f=>{clearTimeout(f)})},[]);const{searchTerm:n,setSearchTerm:d,sortFields:r,handleSort:s,filteredAndSortedData:h,loading:Q,selectedTiers:ne,selectedTypes:G,showTierDropdown:Z,setShowTierDropdown:le,showTypeDropdown:fe,setShowTypeDropdown:be,tierFilterRef:we,typeFilterRef:Se,uniqueTiers:ke,uniqueTypes:Ae,handleTierSelect:ze,handleTypeSelect:We,isTierFiltered:Te,isTypeFiltered:Me,getDropdownStyle:m}=Ht(t,b,l,g,q),P=(()=>{const f=3*l+2,k=b.reduce((te,xe)=>{if(xe.type==="adversary"){const ve=De[xe.item.type]||2;if(xe.item.type==="Minion"){const oe=Math.ceil(xe.quantity/l);return te+oe*ve}else return te+xe.quantity*ve}return te},0);let D=0;b.filter(te=>te.type==="adversary"&&te.item.type==="Solo"&&te.quantity>0).reduce((te,xe)=>te+xe.quantity,0)>=2&&(D+=He.twoOrMoreSolos);const Y=b.some(te=>te.type==="adversary"&&te.item.type==="Bruiser"&&te.quantity>0),ge=b.some(te=>te.type==="adversary"&&te.item.type==="Horde"&&te.quantity>0),he=b.some(te=>te.type==="adversary"&&te.item.type==="Leader"&&te.quantity>0),pe=b.some(te=>te.type==="adversary"&&te.item.type==="Solo"&&te.quantity>0);return!Y&&!ge&&!he&&!pe&&(D+=He.noBruisersHordesLeadersSolos),f+D-k})(),R=f=>{j(f),z(!1)},W=y!=="all";return Q?e.jsx("div",{style:J.browser,children:e.jsx("div",{style:J.loading,children:"Loading..."})}):e.jsx(e.Fragment,{children:e.jsxs("div",{style:u?J.browserWrapper:J.browserWrapperNoContainer,children:[U==="adversaries"&&e.jsxs(e.Fragment,{children:[e.jsx(Ft,{searchTerm:n,onSearchChange:d,type:t,partyControls:L}),e.jsx(Ot,{showCustomToggle:se,onToggleCustom:I,filterCustom:q,onExportCustomAdversaries:x,onImportCustomAdversaries:o}),e.jsx("div",{className:"browser-content invisible-scrollbar",style:J.browserContent,children:e.jsxs("table",{style:J.browserTable,children:[e.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,backgroundColor:"var(--bg-primary)"},children:e.jsx($t,{sortFields:r,onSort:s,type:t,uniqueTiers:ke,uniqueTypes:Ae,selectedTiers:ne,selectedTypes:G,showTierDropdown:Z,setShowTierDropdown:le,showTypeDropdown:fe,setShowTypeDropdown:be,tierFilterRef:we,typeFilterRef:Se,handleTierSelect:ze,handleTypeSelect:We,isTierFiltered:Te,isTypeFiltered:Me,getDropdownStyle:m,costFilter:y,showCostDropdown:C,setShowCostDropdown:z,costFilterRef:i,handleCostFilterSelect:R,isCostFiltered:W})}),e.jsx("tbody",{children:h.map(f=>e.jsx(Vt,{item:f,onAdd:a,type:t,onRowClick:p,encounterItems:b,pcCount:l,playerTier:g,remainingBudget:P,costFilter:y,onAdversaryClick:k=>{t==="adversary"&&(F&&F.id===k.id?V&&V(null):V&&V(k))}},f.id))})]})})]}),U==="encounters"&&e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:M.length===0?e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",textAlign:"center",padding:"2rem 1rem"},children:"No saved encounters yet"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:M.map(f=>e.jsxs("div",{onClick:()=>H&&H(f.id),className:"saved-encounter-card",style:{border:"1px solid var(--border)",borderRadius:"8px",padding:"8px",backgroundColor:"var(--bg-card)",transition:"background-color 0.2s ease",display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsxs("div",{style:{minWidth:"100px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",flexDirection:"column",justifyContent:"center",minHeight:"60px"},children:[e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Tier: ",(()=>{var O,Y,ge,he;const k=((he=(ge=(Y=(O=f.encounterItems)==null?void 0:O.filter(pe=>pe.type==="adversary"))==null?void 0:Y.map(pe=>pe.item.tier))==null?void 0:ge.filter(pe=>pe!=null))==null?void 0:he.sort((pe,ye)=>pe-ye))||[];if(k.length===0)return"N/A";if(k.length===1)return k[0];const D=[...new Set(k)];return D.length===1?D[0]:`${Math.min(...D)}-${Math.max(...D)}`})()]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Party Size: ",f.partySize||4]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)"},children:["Balance: ",(()=>{const k=f.partySize||4,D=3*k+2;let O=0;const Y=f.encounterItems||[];Y.filter(oe=>oe.type==="adversary"&&oe.item.type==="Solo"&&oe.quantity>0).reduce((oe,Ie)=>oe+Ie.quantity,0)>=2&&(O+=He.twoOrMoreSolos);const he=Y.some(oe=>oe.type==="adversary"&&oe.item.type==="Bruiser"&&oe.quantity>0),pe=Y.some(oe=>oe.type==="adversary"&&oe.item.type==="Horde"&&oe.quantity>0),ye=Y.some(oe=>oe.type==="adversary"&&oe.item.type==="Leader"&&oe.quantity>0),te=Y.some(oe=>oe.type==="adversary"&&oe.item.type==="Solo"&&oe.quantity>0);!he&&!pe&&!ye&&!te&&(O+=He.noBruisersHordesLeadersSolos);const xe=D+O,ve=Y.reduce((oe,Ie)=>{if(Ie.type==="adversary"){const Qe=De[Ie.item.type]||2;if(Ie.item.type==="Minion"){const ct=Math.ceil(Ie.quantity/k);return oe+ct*Qe}else return oe+Ie.quantity*Qe}return oe},0);return ve>xe?`+${ve-xe}`:ve===xe?"0":`-${xe-ve}`})()]})]}),e.jsx("div",{style:{minWidth:"120px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",alignItems:"center",minHeight:"60px"},children:e.jsx("div",{style:{fontWeight:"500",color:"var(--text-primary)",fontSize:"0.9rem",wordWrap:"break-word",wordBreak:"break-word",width:"150px",maxWidth:"150px"},children:f.name})}),e.jsx(Lt,{encounter:f}),e.jsx("button",{onClick:k=>{k.stopPropagation(),v(f.id)},style:{background:_[f.id]?"var(--danger)":"var(--gray-600)",border:"none",color:"white",padding:"0.4rem 0.8rem",borderRadius:"4px",fontSize:"0.75rem",cursor:"pointer",minWidth:"60px",transition:"background-color 0.2s"},children:"Delete"})]},f.id))})}),U==="create"&&e.jsx(Dt,{onSave:N,onRefresh:()=>{},onAddItem:a,editingAdversary:re,onCancelEdit:w}),U==="info"&&e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"2rem"},children:[e.jsxs("div",{style:{marginBottom:"2rem",textAlign:"center"},children:[e.jsx("img",{src:Bt,alt:"Daggerheart Community Content Logo",style:{width:"100%",maxWidth:"300px",height:"auto",margin:"0 auto 1.5rem auto",display:"block"},onError:f=>{console.error("Failed to load Daggerheart logo:",f.target.src),f.target.style.display="none"}}),e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",textAlign:"left",maxWidth:"600px",margin:"0 auto"},children:[e.jsx("p",{style:{marginTop:0},children:"This product includes materials from the Daggerheart System Reference Document 1.0, © Critical Role, LLC, under the terms of the Darrington Press Community Gaming (DPCGL) License."}),e.jsxs("p",{children:["More information can be found at ",e.jsx("a",{href:"https://www.daggerheart.com",target:"_blank",rel:"noopener noreferrer",style:{color:"var(--purple)",textDecoration:"underline"},children:"daggerheart.com"})]}),e.jsx("p",{style:{marginBottom:0},children:e.jsx("em",{children:"This project is unofficial and not endorsed by Darrington Press or Critical Role."})})]})]}),e.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto",border:"1px solid var(--border)",borderRadius:"8px",overflow:"hidden"},children:[e.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"1rem 1.5rem",color:"var(--text-primary)",border:"none",background:"var(--bg-secondary)",width:"100%",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"0.875rem",borderBottom:"1px solid var(--border)"},onMouseEnter:f=>{f.target.style.backgroundColor="var(--bg-hover)"},onMouseLeave:f=>{f.target.style.backgroundColor="var(--bg-secondary)"},onClick:f=>{f.stopPropagation(),window.open("https://github.com/Splinter714/Daggerheart","_blank")},children:[e.jsx("span",{children:"View on GitHub"}),e.jsx("span",{children:"→"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem 1.5rem",color:"var(--text-secondary)",background:"var(--bg-secondary)",fontSize:"0.875rem"},children:["Version ","0.4.1 (faf1cef)"]})]})]})]})})},J={browserWrapper:{display:"flex",flexDirection:"column",background:"var(--bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border)",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserWrapperNoContainer:{display:"flex",flexDirection:"column",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserContent:{flex:1,overflowY:"auto",overflowX:"visible",padding:0,width:"100%",scrollbarWidth:"none",msOverflowStyle:"none"},tableHeaderContainer:{flexShrink:0,position:"sticky",top:0,zIndex:15,backgroundColor:"var(--bg-secondary)"},browserTable:{width:"100%",minWidth:"100%",borderCollapse:"collapse",tableLayout:"fixed",background:"var(--bg-primary)",margin:0},browserHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--gray-900)",flexShrink:0,position:"sticky",top:0,zIndex:20},browserTitle:{margin:0,color:"var(--text-primary)",fontSize:"18px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"24px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",marginRight:"12px",transition:"all 0.2s ease"},partyControls:{display:"flex",alignItems:"center",gap:"12px",flexShrink:0},searchInputFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 3px rgba(139, 92, 246, 0.1)"},tableHeader:{background:"var(--gray-900)",borderBottom:"1px solid var(--border)",boxShadow:"0 1px 0 var(--border)",position:"sticky",top:"0",zIndex:10},tableHeaderCell:{backgroundColor:"var(--gray-900)",fontWeight:"700",borderBottom:"1px solid var(--border)",cursor:"pointer",userSelect:"none",minWidth:"100px",whiteSpace:"nowrap",padding:"4px 4px",color:"var(--text-primary)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",boxShadow:"0 1px 0 var(--border)",transition:"background-color 0.2s",position:"sticky",top:"0",zIndex:10},tableHeaderCellHover:{backgroundColor:"var(--bg-hover)"},sortIndicator:{fontSize:"12px",color:"var(--text-secondary)"},tableBody:{flex:1,overflowY:"auto",padding:"8px",backgroundColor:"var(--bg-primary)"},row:{height:"35px",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s ease",cursor:"pointer",backgroundColor:"var(--gray-900)"},rowHover:{backgroundColor:"var(--bg-secondary)"},expandedRow:{backgroundColor:"var(--bg-secondary)"},rowCell:{padding:"4px 4px",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid var(--border)"},rowCellName:{fontWeight:"500",minWidth:"150px"},rowCellCenter:{textAlign:"center",justifyContent:"center",minWidth:"80px"},rowActions:{width:"80px",textAlign:"center",padding:"4px 8px",borderBottom:"1px solid var(--border)"},addButton:{width:"2rem",height:"2rem",border:"1px solid var(--purple)",borderRadius:"var(--radius-sm)",background:"var(--purple)",color:"white",cursor:"pointer",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"500"},expandedContent:{padding:"0",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)"},columnName:{width:"auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",paddingLeft:"8px",textAlign:"left"},columnTier:{width:"80px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnType:{width:"100px",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},columnDifficulty:{width:"40px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnAction:{width:"32px",minWidth:"24px",maxWidth:"24px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"visible",textOverflow:"unset"},loading:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"var(--text-primary)",fontSize:"16px"},mobileBrowser:{width:"95vw",height:"90vh",maxWidth:"none"},mobileSearchInput:{fontSize:"16px"},headerWithFilter:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0px",position:"relative"},headerFilterIcon:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"2px 4px",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",position:"relative",marginLeft:"-2px"},headerFilterIconActive:{color:"var(--purple)"},filterIcon:{fontSize:"12px"},filterActiveDot:{position:"absolute",left:"50%",top:"2px",transform:"translateX(-50%)",width:"4px",height:"4px",borderRadius:"50%",background:"var(--purple)",pointerEvents:"none"},filterDropdown:{position:"fixed",background:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",zIndex:99999,marginTop:"4px",overflow:"hidden",width:"max-content",minWidth:"120px",maxWidth:"200px"},filterOption:{padding:"8px 12px",cursor:"pointer",color:"var(--text-primary)",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background-color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},filterOptionSelected:{backgroundColor:"var(--bg-hover)"},checkIcon:{width:"16px",height:"16px",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"12px"},filterLabel:{flex:1}},_t=()=>e.jsx("div",{className:"pwa-install-prompt",style:{}}),Gt=({side:t="left",children:a,className:c="",style:p={}})=>{const b=t==="left",l={flex:1,minWidth:0,background:"var(--bg-primary)",overflowY:"auto",overflowX:b?"auto":"hidden",display:b?"block":"flex",flexDirection:b?"initial":"column",height:"100%",padding:b?"8px 0 8px 0":"0 8px 0 0",...p};return e.jsx("div",{className:c,style:l,children:a})},Yt=t=>3*t+2,Jt={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},Ge={lessDifficult:-1,twoOrMoreSolos:-2,increasedDamage:-2,lowerTierAdversary:1,noBruisersHordesLeadersSolos:1,moreDangerous:2},Xt=({isOpen:t,onClose:a,onAddAdversary:c,onAddAdversariesBulk:p,onAddEnvironment:b,onDeleteAdversary:l,onDeleteEnvironment:g,onDeleteCountdown:L,adversaries:u=[],environments:M=[],countdowns:H=[],savedEncounters:B=[],onSaveEncounter:U,onLoadEncounter:S,onDeleteEncounter:$})=>{const{partySize:ee,updatePartySize:F,currentEncounterName:V,updateCurrentEncounterName:q,customContent:se}=Ke(),I=ee,ie=F,[ce,me]=E.useState({lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),[X,K]=E.useState([]),[re,de]=E.useState(V||"Encounter"),[y,j]=E.useState("adversaries"),[C,z]=E.useState(null),[_,ae]=E.useState(null),[T,i]=E.useState(null),[x,o]=E.useState(null),[w,N]=E.useState(!1);E.useEffect(()=>{t&&!C&&de(V||"Encounter")},[t,C,V]);const v=()=>_?re!==_.name||JSON.stringify(X)!==JSON.stringify(_.encounterItems)||I!==_.partySize||JSON.stringify(ce)!==JSON.stringify(_.battlePointsAdjustments):!1,n=()=>{var m;if(X.length>0||(re||"").trim()!=="Encounter")return!0;if(C&&v()){if(_){const A=X.length,P=((m=_.encounterItems)==null?void 0:m.length)||0;if(A!==P||(re||"").trim()!==(_.name||""))return!0;const R=JSON.stringify(ce),W=JSON.stringify(_.battlePointsAdjustments||{});return R!==W}return!0}return!1},d=({onClick:m,children:A,variant:P="secondary",isConfirmation:R=!1})=>{const W=P==="danger"||P==="secondary"&&R,f=P==="purple";return e.jsx("button",{onClick:m,style:{background:W?"var(--danger)":f?"var(--purple)":"var(--bg-secondary)",border:f?"none":"1px solid var(--border)",color:W||f?"white":"var(--text-primary)",padding:"0.375rem 0.75rem",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s",width:"70px",fontSize:"0.875rem"},children:A})},r=je.useRef(I),s=E.useCallback(m=>!m||m.length===0?null:B.find(P=>{var k,D;if(((k=P.encounterItems)==null?void 0:k.length)!==m.length)return!1;const R=O=>{var Y;return{type:O.type,quantity:O.quantity,item:{name:O.item.baseName||((Y=O.item.name)==null?void 0:Y.replace(/\s+\(\d+\)$/,""))||O.item.name,type:O.item.type,tier:O.item.tier}}},W=(D=P.encounterItems)==null?void 0:D.map(R).sort((O,Y)=>O.item.name.localeCompare(Y.item.name)||O.item.type.localeCompare(Y.item.type)),f=m.map(R).sort((O,Y)=>O.item.name.localeCompare(Y.item.name)||O.item.type.localeCompare(Y.item.type));return JSON.stringify(W)===JSON.stringify(f)})||null,[B]);je.useEffect(()=>{if(t&&u.length>0&&X.length===0){const m={};u.forEach(R=>{var f;const W=R.baseName||((f=R.name)==null?void 0:f.replace(/\s+\(\d+\)$/,""))||R.name;m[W]||(m[W]={type:"adversary",item:R,quantity:0}),m[W].quantity+=1});const A=Object.values(m);K(A);const P=s(A);P&&!C&&(z(P.id),ae({name:P.name||"",encounterItems:P.encounterItems||[],partySize:P.partySize||4,battlePointsAdjustments:P.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),de(P.name||"Encounter"),q(P.name||"Encounter"))}else t&&u.length===0&&X.length===0&&K([])},[t,s,C,q]);const h=je.useMemo(()=>{let m=0;X.filter(k=>k.type==="adversary"&&k.item.type==="Solo"&&k.quantity>0).reduce((k,D)=>k+D.quantity,0)>=2&&(m+=Ge.twoOrMoreSolos);const P=X.some(k=>k.type==="adversary"&&k.item.type==="Bruiser"&&k.quantity>0),R=X.some(k=>k.type==="adversary"&&k.item.type==="Horde"&&k.quantity>0),W=X.some(k=>k.type==="adversary"&&k.item.type==="Leader"&&k.quantity>0),f=X.some(k=>k.type==="adversary"&&k.item.type==="Solo"&&k.quantity>0);return!P&&!R&&!W&&!f&&(m+=Ge.noBruisersHordesLeadersSolos),m},[X]),Q=Yt(I),ne=Object.entries(ce).filter(([m,A])=>A).reduce((m,[A,P])=>m+Ge[A],0),G=Q+ne+h,Z=X.reduce((m,A)=>{if(A.type==="adversary"){const P=Jt[A.item.type]||2;return A.item.type==="Minion"?m+Math.ceil(A.quantity/I)*P:m+P*A.quantity}return m},0);je.useEffect(()=>{const m=r.current;m!==I&&(K(A=>A.map(P=>{if(P.type==="adversary"&&P.item.type==="Minion"){const W=Math.ceil(P.quantity/m)*I;return{...P,quantity:W}}return P})),r.current=I)},[I]);const le=(m,A)=>{const P=X.findIndex(f=>f.item.id===m.id&&f.type===A),R=m.type==="Minion"?I:1;let W;P>=0?W=X.map((f,k)=>k===P?{...f,quantity:f.quantity+R}:f):W=[...X,{item:m,type:A,quantity:R}],K(W),fe(W)},fe=m=>{const A=u||[],P=[];m.forEach(D=>{for(let O=0;O<D.quantity;O++)D.type==="adversary"&&P.push(D.item)});const R={};A.forEach(D=>{var Y;const O=D.baseName||((Y=D.name)==null?void 0:Y.replace(/\s+\(\d+\)$/,""))||D.name;R[O]||(R[O]=[]),R[O].push(D)});const W={};P.forEach(D=>{var Y;const O=D.baseName||((Y=D.name)==null?void 0:Y.replace(/\s+\(\d+\)$/,""))||D.name;W[O]||(W[O]=[]),W[O].push(D)});const f=[],k=[];Object.keys(W).forEach(D=>{var ge;const O=((ge=R[D])==null?void 0:ge.length)||0,Y=W[D].length;if(Y>O){const he=Y-O;for(let pe=0;pe<he;pe++)f.push(W[D][0])}else if(Y<O){const he=O-Y,ye=[...R[D]].sort((te,xe)=>{const ve=te.duplicateNumber||1;return(xe.duplicateNumber||1)-ve});for(let te=0;te<he;te++)k.push(ye[te].id)}}),Object.keys(R).forEach(D=>{W[D]||[...R[D]].sort((ge,he)=>{const pe=ge.duplicateNumber||1;return(he.duplicateNumber||1)-pe}).forEach(ge=>{k.push(ge.id)})}),k.forEach(D=>{l(D)}),f.length>0&&p(f)},be=(m,A)=>{const P=(()=>{const R=X.findIndex(W=>W.item.id===m&&W.type===A);if(R>=0){const W=X[R];if(W.quantity===0)return X.filter((D,O)=>O!==R);const f=W.item.type==="Minion"?I:1,k=Math.max(0,W.quantity-f);return X.map((D,O)=>O===R?{...D,quantity:k}:D)}return X})();K(P),fe(P)},we=E.useCallback(()=>{if(X.length===0)return null;const m=(re||"").trim()||"Encounter",A=B.find(P=>{var f,k;if(P.name!==m||((f=P.encounterItems)==null?void 0:f.length)!==X.length)return!1;const R=JSON.stringify((k=P.encounterItems)==null?void 0:k.sort()),W=JSON.stringify([...X].sort());return R===W});return(A==null?void 0:A.id)||null},[B,re,X]),Se=E.useCallback(()=>{let m=(re||"").trim(),A=C;if(A||(A=we()),X.length===0&&(!m||m==="Encounter")&&A){$(A),z(null),ae(null);return}const P={name:m,encounterItems:X,partySize:I,battlePointsAdjustments:ce};if(A){P.id=A;const R=U(P);z(R)}else{const R=U(P);z(R)}ae({name:m,encounterItems:X,partySize:I,battlePointsAdjustments:ce})},[X,re,I,ce,C,U,we,$]);E.useEffect(()=>{if(C&&v()){const m=setTimeout(()=>{Se()},2e3);return()=>clearTimeout(m)}else if(!C&&X.length>0&&re&&re.trim()!==""){const m=setTimeout(()=>{Se()},2e3);return()=>clearTimeout(m)}},[X,C,re,ce,I]);const ke=()=>{n()&&(K([]),de("Encounter"),q("Encounter"),z(null),ae(null),u.forEach(m=>{l(m.id)}),M.forEach(m=>{g(m.id)}),H.forEach(m=>{L(m.id)}))},Ae=m=>{const A=S(m);if(A){const P=A.encounterItems||[];K(P),ie(A.partySize||4),me(A.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),de(A.name||""),q(A.name||""),z(m),ae({name:A.name||"",encounterItems:A.encounterItems||[],partySize:A.partySize||4,battlePointsAdjustments:A.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),fe(P)}},ze=m=>{$(m),C===m&&(K([]),de("Encounter"),q("Encounter"),z(null),ae(null),u.forEach(A=>{l(A.id)}),M.forEach(A=>{g(A.id)}),H.forEach(A=>{L(A.id)}))},We=()=>{try{const m={version:"1.0",exportDate:new Date().toISOString(),customAdversaries:se.adversaries||[]},A=JSON.stringify(m,null,2),P=new Blob([A],{type:"application/json"}),R=URL.createObjectURL(P),W=document.createElement("a");W.href=R,W.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(W),W.click(),document.body.removeChild(W),URL.revokeObjectURL(R),console.log("Custom adversaries exported successfully")}catch(m){console.error("Failed to export custom adversaries:",m),alert("Failed to export custom adversaries. Please try again.")}},Te=m=>{const A=m.target.files[0];if(!A)return;const P=new FileReader;P.onload=R=>{try{const W=JSON.parse(R.target.result);if(!W.customAdversaries||!Array.isArray(W.customAdversaries))throw new Error("Invalid file format. Expected customAdversaries array.");const f=se.adversaries||[],k=W.customAdversaries,D=[...f];let O=0;k.forEach(Y=>{f.some(he=>he.name===Y.name&&he.type===Y.type)||(D.push({...Y,id:`custom-${Date.now()}-${Math.random().toString(36).slice(2,10)}`}),O++)}),updateCustomContent("adversary",null,D),O>0?alert(`Successfully imported ${O} custom adversaries.`):alert("No new adversaries were added. All imported adversaries already exist.")}catch(W){console.error("Failed to import custom adversaries:",W),alert("Failed to import custom adversaries. Please check the file format and try again.")}},P.readAsText(A),m.target.value=""};if(!t)return null;const Me=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://");return e.jsx("div",{onClick:a,className:"encounter-builder-modal",style:{position:"fixed",top:0,left:0,right:0,bottom:Me?"calc(60px + env(safe-area-inset-bottom) + 1rem)":"calc(60px + env(safe-area-inset-bottom))",backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:1e3,display:"flex",alignItems:"flex-start",justifyContent:"center",padding:"12px"},children:e.jsxs("div",{onClick:m=>m.stopPropagation(),style:{backgroundColor:"var(--bg-primary)",border:"2px solid var(--border)",borderRadius:"12px",width:"100%",maxWidth:"1200px",height:"100%",maxHeight:"100%",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"},children:[e.jsxs("div",{className:"encounter-top-bar",style:{flex:"0 0 auto",display:"flex",alignItems:"center",height:"39px",backgroundColor:"var(--bg-primary)",borderBottom:"1px solid var(--border)"},children:[e.jsx("button",{onClick:()=>j("adversaries"),style:{flex:1,background:y==="adversaries"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:y==="adversaries"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Builder"}),e.jsx("button",{onClick:()=>j("encounters"),style:{flex:1,background:y==="encounters"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:y==="encounters"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Saved Encounters"}),e.jsx("button",{onClick:()=>j("create"),style:{flex:1,background:y==="create"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:y==="create"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Create Adversary"}),e.jsx("button",{onClick:()=>j("info"),style:{flex:1,background:y==="info"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:y==="info"?"500":"400",transition:"all 0.2s ease",position:"relative"},children:"Info"})]}),e.jsxs("div",{className:"encounter-builder-content",style:{flex:1,display:"flex",overflow:"hidden"},children:[e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",borderTop:"1px solid var(--border)"},children:e.jsx(qt,{type:"adversary",onAddItem:m=>le(m,"adversary"),encounterItems:X,pcCount:I,showContainer:!1,savedEncounters:B,onLoadEncounter:Ae,onDeleteEncounter:ze,activeTab:y,selectedCustomAdversaryId:T,onSelectCustomAdversary:i,onTabChange:j,selectedAdversary:x,onSelectAdversary:o,filterCustom:w,showCustomToggle:!0,onToggleCustom:N,onExportCustomAdversaries:We,onImportCustomAdversaries:Te})}),y!=="info"&&e.jsxs("div",{className:"encounter-right-panel",style:{flex:1,borderLeft:"1px solid var(--border)",display:"flex",flexDirection:"column",overflow:"hidden",position:"relative"},children:[x&&e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"var(--bg-primary)",zIndex:10,display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)",flexShrink:0},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:0},children:"Adversary Preview"}),e.jsx("button",{onClick:()=>o(null),style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease"},onMouseEnter:m=>m.target.style.color="var(--text-primary)",onMouseLeave:m=>m.target.style.color="var(--text-secondary)",title:"Close preview",children:e.jsx(Fe,{size:16})})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"0.75rem"},children:e.jsx(Oe,{item:{...x,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...x,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}})})]}),(y==="adversaries"||y==="encounters")&&e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-primary)",flexShrink:0},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:re,onChange:m=>{de(m.target.value),q(m.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(d,{onClick:ke,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:n()?1:.5,cursor:n()?"pointer":"not-allowed"},children:"New"})]})}),(y==="adversaries"||y==="encounters")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"encounter-receipt-buttons-vertical",style:{display:"none",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:re,onChange:m=>{de(m.target.value),q(m.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(d,{onClick:ke,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:n()?1:.5,cursor:n()?"pointer":"not-allowed"},children:"New"})]})}),e.jsx("div",{className:"receipt-content",style:{padding:"1rem",display:"flex",flexDirection:"column",height:"100%"},children:e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"flex-start",overflowY:"auto",marginBottom:"0.75rem"},children:[e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>ie(Math.max(1,I-1)),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(Ue,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:I}),e.jsx("button",{onClick:()=>ie(I+1),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(et,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Party Size"})}),e.jsx("div",{style:{width:"120px",textAlign:"right"}})]}),X.map(m=>{var A;return m.type!=="adversary"?null:e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>be(m.item.id,m.type),style:{background:m.quantity===0?"var(--danger)":"var(--bg-secondary)",border:m.quantity===0?"none":"1px solid var(--border)",color:m.quantity===0?"white":"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:m.quantity===0?e.jsx(Fe,{size:10}):e.jsx(Ue,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:m.quantity}),e.jsx("button",{onClick:()=>le(m.item,m.type),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(et,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:m.item.baseName||((A=m.item.name)==null?void 0:A.replace(/\s+\(\d+\)$/,""))||m.item.name})}),e.jsx("div",{style:{width:"80px",textAlign:"right"},children:e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.8rem"},children:m.item.type})})]},`${m.item.id}-${m.type}`)}),e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Balance"})}),e.jsx("div",{style:{width:"120px",textAlign:"right",display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsx("span",{style:{color:Z>G?"var(--danger)":Z===G?"var(--purple)":"var(--success)",fontWeight:600},children:Z>G?`+${Z-G}`:G-Z===0?"0":`-${G-Z}`})})]})]})})]}),y==="create"&&e.jsxs("div",{style:{padding:"1.5rem",overflowY:"auto",height:"100%"},children:[e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Creating Adversaries"}),e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsx("p",{children:"Use the form to create custom adversaries for your encounters."}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Adversary Types:"}),e.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Minion (1 BP):"})," Weak enemies in groups"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Standard (2 BP):"})," Average threat level"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Leader (3 BP):"})," Commands others"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Bruiser (4 BP):"})," High HP tank"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Solo (5 BP):"})," Boss-level threat"]})]})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Tips:"}),e.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[e.jsx("li",{children:"Match adversary tier to party level"}),e.jsx("li",{children:"Balance encounter difficulty with Battle Points"}),e.jsx("li",{children:"Mix adversary types for variety"}),e.jsx("li",{children:"Add features that create interesting choices"})]})]})]})]}),y==="myAdversaries"&&e.jsx("div",{style:{padding:"0.75rem",overflowY:"auto",height:"100%"},children:T?(()=>{var A;const m=(A=se==null?void 0:se.adversaries)==null?void 0:A.find(P=>P.id===T);return m?e.jsx(Oe,{item:{...m,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...m,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}}):e.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Adversary not found"})})():e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Adversary Preview"}),e.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Select an adversary to view details"})]})})]})]})]})})};class Kt extends je.Component{constructor(a){super(a),this.state={hasError:!1,error:null}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,c){console.error("ErrorBoundary caught an error:",a,c)}render(){var a;return this.state.hasError?e.jsxs("div",{className:"p-md text-red",children:[e.jsx("h3",{children:"Something went wrong:"}),e.jsx("pre",{children:(a=this.state.error)==null?void 0:a.toString()}),e.jsx("button",{className:"btn-base btn-text",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try again"})]}):this.props.children}}const Qt=()=>{const{adversaries:t,environments:a,countdowns:c,fear:p,savedEncounters:b,updateFear:l,createAdversary:g,createAdversariesBulk:L,updateAdversary:u,deleteAdversary:M,createEnvironment:H,updateEnvironment:B,deleteEnvironment:U,createCountdown:S,updateCountdown:$,deleteCountdown:ee,advanceCountdown:F,saveEncounter:V,loadEncounter:q,deleteEncounter:se}=Ke(),[I,ie]=E.useState(!1),[ce,me]=E.useState(!1);E.useState(!1),E.useState(!1),E.useState(!0);const[X,K]=E.useState(null),[re,de]=E.useState(0),[y,j]=E.useState(0),[C,z]=E.useState(!1);E.useEffect(()=>{const r=()=>{const h=window.matchMedia("(max-width: 800px)");ie(h.matches)};r();const s=window.matchMedia("(max-width: 800px)");return s.addEventListener("change",r),()=>s.removeEventListener("change",r)},[]);const _=12,ae=r=>r===1?200:350,T=r=>{if(r<=0)return{visibleColumns:1,columnWidth:ae(1)};const s=_*2,h=r-s;let Q={visibleColumns:1,columnWidth:h};for(let G=1;G<=5;G++){const Z=(G-1)*_,le=(h-Z)/G;le>=ae(G)&&G*le+Z<=h&&(Q={visibleColumns:G,columnWidth:le})}return Q.visibleColumns*Q.columnWidth+(Q.visibleColumns-1)*_>h&&(Q={visibleColumns:1,columnWidth:h}),Q},{visibleColumns:i,columnWidth:x}=T(re);E.useEffect(()=>{const r=()=>{de(window.innerWidth)};return r(),window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]);const o=()=>{me(!0)},w=()=>{me(!ce)},N=E.useCallback(()=>{me(!1)},[]),v=E.useCallback(r=>{j(r.target.scrollLeft)},[]);E.useCallback(()=>{z(!0)},[]),E.useCallback(()=>{setTimeout(()=>z(!1),100)},[]);const d=(()=>{const r={};return t.forEach(s=>{var Q;const h=s.baseName||((Q=s.name)==null?void 0:Q.replace(/\s+\(\d+\)$/,""))||s.name;r[h]||(r[h]={type:"adversary",baseName:h,instances:[]}),r[h].instances.push(s)}),a.forEach(s=>{r[s.name]||(r[s.name]={type:"environment",baseName:s.name,instances:[]}),r[s.name].instances.push(s)}),c.forEach(s=>{r[`countdown-${s.id}`]={type:"countdown",baseName:s.name,instances:[s]}}),Object.values(r)})();return d.length,e.jsxs("div",{className:"app",onClick:r=>{r.target,r.currentTarget},children:[e.jsx(At,{onToggle:w,isOpen:ce}),e.jsx("div",{className:"main-content",style:{position:"relative",width:"100%"},children:e.jsx("div",{className:"dashboard-scroll-container",style:{display:"flex",flexDirection:"row",overflowX:"auto",overflowY:"hidden",padding:`0 ${_}px`,scrollSnapType:"x mandatory",height:"100%",width:"100%"},onScroll:v,children:d.length===0?e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",width:"100%",padding:"2rem"},children:e.jsx("button",{onClick:o,style:{backgroundColor:"transparent",color:"var(--text-secondary)",border:"2px dashed var(--border)",borderRadius:"var(--radius-md)",padding:"1rem 2rem",fontSize:"1rem",fontWeight:"500",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:r=>{r.target.style.borderColor="var(--purple)",r.target.style.color="var(--purple)"},onMouseLeave:r=>{r.target.style.borderColor="var(--border)",r.target.style.color="var(--text-secondary)"},children:"Create Encounter"})}):d.map((r,s)=>e.jsx(Gt,{className:"invisible-scrollbar",style:{width:`${x+_}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:`${_}px`,paddingRight:"0",paddingTop:`${_}px`,paddingBottom:`${_}px`,scrollSnapAlign:"start",overflowY:"auto",overflowX:"hidden"},children:e.jsx(Oe,{type:r.type,item:{...r.instances[0],name:r.baseName,hp:0,stress:0,isDead:!1},mode:"expanded",instances:r.instances,onApplyDamage:r.type==="adversary"?(h,Q,ne,G)=>{const Z=r.instances.find(le=>le.id===h);Z&&u(h,{hp:Math.min(Z.hpMax||1,(Z.hp||0)+Q)})}:void 0,onApplyHealing:r.type==="adversary"?(h,Q,ne)=>{const G=r.instances.find(Z=>Z.id===h);G&&u(h,{hp:Math.max(0,(G.hp||0)-Q)})}:void 0,onApplyStressChange:r.type==="adversary"?(h,Q)=>{var ne,G;return u(h,{stress:Math.max(0,Math.min(((ne=r.instances.find(Z=>Z.id===h))==null?void 0:ne.stressMax)||6,(((G=r.instances.find(Z=>Z.id===h))==null?void 0:G.stress)||0)+Q))})}:void 0,onUpdate:r.type==="adversary"?u:r.type==="environment"?B:$,adversaries:t})},`${r.type}-${r.baseName}`))})}),e.jsx(zt,{position:"bottom",children:e.jsx(Re,{type:"fear",value:(p==null?void 0:p.value)||0,maxValue:12,onChange:l,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0})}),e.jsx(Xt,{isOpen:ce,onClose:N,onAddAdversary:r=>{g(r),K("adversary")},onAddAdversariesBulk:r=>{L(r),K("adversary")},onAddEnvironment:r=>{H(r),K("environment")},onDeleteAdversary:M,onDeleteEnvironment:U,onDeleteCountdown:ee,adversaries:t,environments:a,countdowns:c,savedEncounters:b,onSaveEncounter:V,onLoadEncounter:q,onDeleteEncounter:se}),e.jsx(_t,{})]})},Zt=()=>e.jsx(Kt,{children:e.jsx(Qt,{})});Je.createRoot(document.getElementById("root")).render(e.jsx(je.StrictMode,{children:e.jsx(Et,{children:e.jsx(Zt,{})})}));
