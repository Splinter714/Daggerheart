import{r as c,a as jt,R as rt}from"./dndkit-57209f9c.js";import{F as Kt,f as Gt,a as Jt,b as Yt,c as Rt}from"./fa-b4bcccb0.js";import{D as Ot,A as Xt,C as zt,X as ot,M as ft,P as at,a as Zt,H as Qt,L as Ut,b as er,F as tr,S as ut,c as pt}from"./lucide-9f8be461.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const C of document.querySelectorAll('link[rel="modulepreload"]'))l(C);new MutationObserver(C=>{for(const m of C)if(m.type==="childList")for(const g of m.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&l(g)}).observe(document,{childList:!0,subtree:!0});function p(C){const m={};return C.integrity&&(m.integrity=C.integrity),C.referrerPolicy&&(m.referrerPolicy=C.referrerPolicy),C.crossOrigin==="use-credentials"?m.credentials="include":C.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function l(C){if(C.ep)return;C.ep=!0;const m=p(C);fetch(C.href,m)}})();var Ft={exports:{}},gt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rr=c,nr=Symbol.for("react.element"),sr=Symbol.for("react.fragment"),or=Object.prototype.hasOwnProperty,ar=rr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ir={key:!0,ref:!0,__self:!0,__source:!0};function $t(t,s,p){var l,C={},m=null,g=null;p!==void 0&&(m=""+p),s.key!==void 0&&(m=""+s.key),s.ref!==void 0&&(g=s.ref);for(l in s)or.call(s,l)&&!ir.hasOwnProperty(l)&&(C[l]=s[l]);if(t&&t.defaultProps)for(l in s=t.defaultProps,s)C[l]===void 0&&(C[l]=s[l]);return{$$typeof:nr,type:t,key:m,ref:g,props:C,_owner:ar.current}}gt.Fragment=sr;gt.jsx=$t;gt.jsxs=$t;Ft.exports=gt;var e=Ft.exports,kt={},Nt=jt;kt.createRoot=Nt.createRoot,kt.hydrateRoot=Nt.hydrateRoot;function et(t){const s=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return t?`${t}-${s}`:s}const _t=c.createContext();function yt(t){if(typeof localStorage>"u")return null;try{const s=localStorage.getItem(t);return s==null?null:JSON.parse(s)}catch{return null}}function tt(t,s){if(!(typeof localStorage>"u"))try{localStorage.setItem(t,JSON.stringify(s))}catch{}}const lr=({children:t})=>{const[s,p]=c.useState({fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],currentEncounterName:"Encounter"}),[l,C]=c.useState(!1),[m,g]=c.useState({adversaries:[],environments:[]});c.useEffect(()=>{var f,o,S,W;const d=yt("daggerheart-game-state");if(d)try{(((f=d.adversaries)==null?void 0:f.length)>0||((o=d.environments)==null?void 0:o.length)>0||((S=d.countdowns)==null?void 0:S.length)>0||((W=d.savedEncounters)==null?void 0:W.length)>0)&&p(d)}catch(G){console.error("Failed to load saved state:",G)}const y=yt("daggerheart-custom-adversaries")||[],v=yt("daggerheart-custom-environments")||[];g({adversaries:y,environments:v}),C(!0)},[]),c.useEffect(()=>{tt("daggerheart-game-state",s)},[s]);const q=d=>{p(y=>({...y,fear:{...y.fear,value:d}}))},x=()=>{p(d=>({...d,fear:{...d.fear,visible:!d.fear.visible}}))},N=d=>{p(y=>({...y,partySize:Math.max(1,d)}))},F=d=>{p(y=>({...y,currentEncounterName:d||"Encounter"}))},h=d=>{if(d.id)return p(y=>({...y,savedEncounters:(y.savedEncounters||[]).map(v=>v.id===d.id?{...v,name:d.name||v.name,encounterItems:d.encounterItems||v.encounterItems,partySize:d.partySize||v.partySize,battlePointsAdjustments:d.battlePointsAdjustments||v.battlePointsAdjustments,updatedAt:new Date().toISOString()}:v)})),d.id;{const y={id:et("encounter"),name:d.name||"Encounter",createdAt:new Date().toISOString(),encounterItems:d.encounterItems||[],partySize:d.partySize||4,battlePointsAdjustments:d.battlePointsAdjustments||{}};return p(v=>({...v,savedEncounters:[...v.savedEncounters||[],y]})),y.id}},D=d=>(s.savedEncounters||[]).find(v=>v.id===d),w=d=>{const y={id:et("encounter"),name:d.name||`Encounter ${Date.now()}`,createdAt:new Date().toISOString(),encounterItems:d.encounterItems||[],partySize:d.partySize||4,battlePointsAdjustments:d.battlePointsAdjustments||{}};return p(v=>({...v,savedEncounters:[...v.savedEncounters||[],y]})),y.id},X=d=>{p(y=>({...y,savedEncounters:(y.savedEncounters||[]).filter(v=>v.id!==d)}))},pe=c.useRef(s);c.useEffect(()=>{pe.current=s},[s]);const De={gameState:s,isLoaded:l,customContent:m,updateFear:q,toggleFearVisibility:x,updatePartySize:N,updateCurrentEncounterName:F,saveEncounter:h,saveEncounterAs:w,loadEncounter:D,deleteEncounter:X,createCountdown:d=>{const y={id:et("countdown"),name:d.name||"Countdown",max:parseInt(d.max)||1,value:0,visible:!0,type:d.type||"standard",loop:d.loop||"none",source:d.source||"campaign"};p(v=>({...v,countdowns:[...v.countdowns,y]}))},updateCountdown:(d,y)=>{p(v=>({...v,countdowns:v.countdowns.map(f=>f.id===d?{...f,...y}:f)}))},deleteCountdown:d=>{p(y=>({...y,countdowns:y.countdowns.filter(v=>v.id!==d)}))},advanceCountdown:(d,y)=>{p(v=>({...v,countdowns:v.countdowns.map(f=>{if(f.id!==d)return f;let o=y;if(f.loop==="loop")o>f.max?o=(o-1)%f.max+1:o<0&&(o=f.max);else if(f.loop==="increasing"){if(o>f.max)return{...f,max:f.max+1,value:1};if(o<0)return{...f,max:Math.max(1,f.max-1),value:1};o=Math.max(0,o)}else if(f.loop==="decreasing"){if(o>f.max)return{...f,max:Math.max(1,f.max-1),value:1};if(o<0)return{...f,max:f.max+1,value:1};o=Math.min(f.max,o)}else o=Math.max(0,Math.min(o,f.max));return{...f,value:o}})}))},incrementCountdown:(d,y=1)=>{p(v=>({...v,countdowns:v.countdowns.map(f=>{if(f.id!==d)return f;let o=f.value+y;if(f.loop==="loop")o>f.max&&(o=(o-1)%f.max+1);else if(f.loop==="increasing"){if(o>f.max)return{...f,max:f.max+1,value:1}}else if(f.loop==="decreasing"){if(o>f.max)return{...f,max:Math.max(1,f.max-1),value:1}}else o=Math.min(o,f.max);return{...f,value:o}})}))},decrementCountdown:d=>{p(y=>({...y,countdowns:y.countdowns.map(v=>{if(v.id!==d)return v;let f=v.value-1;if(v.loop==="loop")f<0&&(f=v.max);else if(v.loop==="increasing"){if(f<0)return{...v,max:Math.max(1,v.max-1),value:v.max};f=Math.max(0,f)}else if(v.loop==="decreasing"){if(f<0)return{...v,max:v.max+1,value:1}}else f=Math.max(0,f);return{...v,value:f}})}))},reorderCountdowns:d=>{p(y=>{const[v,f]=d,o=[...y.countdowns],[S]=o.splice(v,1);return o.splice(f,0,S),{...y,countdowns:o}})},createAdversary:d=>{var G;const y=et("adv"),v=s.adversaries||[],f=d.baseName||((G=d.name)==null?void 0:G.replace(/\s+\(\d+\)$/,""))||d.name||"Unknown",o=v.filter(U=>U.baseName===f);let S=1;if(o.length===0)S=1;else{const U=o.map(Ne=>Ne.duplicateNumber||1);let ye=1;for(;U.includes(ye);)ye++;S=ye}const W={...d,id:y,baseName:f,duplicateNumber:S,name:`${f} (${S})`,hp:0,stress:0,isVisible:!0};p(U=>({...U,adversaries:[...U.adversaries,W]}))},createAdversariesBulk:d=>{const y=[],v={};d.forEach(f=>{var Le;const o=f.baseName||((Le=f.name)==null?void 0:Le.replace(/\s+\(\d+\)$/,""))||f.name||"Unknown",G=(s.adversaries||[]).filter(Fe=>Fe.baseName===o).length,U=v[o]||0,ye=G+U+1;v[o]=U+1;const Ne={...f,id:et("adv"),baseName:o,duplicateNumber:ye,name:`${o} (${ye})`,hp:0,stress:0,isVisible:!0};y.push(Ne)}),p(f=>({...f,adversaries:[...f.adversaries,...y]}))},updateAdversary:(d,y)=>{p(v=>({...v,adversaries:v.adversaries.map(f=>{if(f.id===d){const o={...f,...y};if(y.baseName!==void 0){const S=y.baseName,W=o.duplicateNumber||1;o.name=W===1?S:`${S} (${W})`}return o}return f})}))},deleteAdversary:d=>{p(y=>({...y,adversaries:y.adversaries.filter(v=>v.id!==d)}))},clearAllAdversaries:()=>{p(d=>({...d,adversaries:[]}))},reorderAdversaries:d=>{p(y=>{const[v,f]=d,o=[...y.adversaries],[S]=o.splice(v,1);return o.splice(f,0,S),{...y,adversaries:o}})},bulkReorderAdversaries:d=>{p(y=>({...y,adversaries:d}))},createEnvironment:d=>{const y=et("env"),f=(s.environments||[]).filter(W=>W.name.replace(/\s+\(\d+\)$/,"")===d.name);let o=d.name||"Unknown";if(f.length===0)o=d.name;else if(f.length===1){const W=f[0],G=W.name.replace(/\s+\(\d+\)$/,""),U=s.environments.map(ye=>ye.id===W.id?{...ye,name:`${G} (1)`}:ye);p(ye=>({...ye,environments:U})),o=`${d.name} (2)`}else{const W=f.map(U=>{const ye=U.name.match(/\((\d+)\)$/);return ye?parseInt(ye[1]):null}).filter(U=>U!==null);let G=1;for(;W.includes(G);)G++;o=`${d.name} (${G})`}const S={...d,id:y,name:o,isVisible:!0};p(W=>({...W,environments:[...W.environments,S]}))},updateEnvironment:(d,y)=>{p(v=>({...v,environments:v.environments.map(f=>f.id===d?{...f,...y}:f)}))},deleteEnvironment:d=>{p(y=>({...y,environments:y.environments.filter(v=>v.id!==d)}))},reorderEnvironments:d=>{p(y=>{const[v,f]=d,o=[...y.environments],[S]=o.splice(v,1);return o.splice(f,0,S),{...y,environments:o}})},addCustomAdversary:d=>{const y={...d,id:et("custom-adv"),source:d.source||"Homebrew",isCustom:!0};return g(v=>({...v,adversaries:[...v.adversaries,y]})),tt("daggerheart-custom-adversaries",[...m.adversaries,y]),y.id},addCustomEnvironment:d=>{const y={...d,id:et("custom-env"),source:d.source||"Homebrew",isCustom:!0};return g(v=>({...v,environments:[...v.environments,y]})),tt("daggerheart-custom-environments",[...m.environments,y]),y.id},updateCustomAdversary:(d,y)=>{g(f=>({...f,adversaries:f.adversaries.map(o=>o.id===d?{...o,...y}:o)}));const v=m.adversaries.map(f=>f.id===d?{...f,...y}:f);tt("daggerheart-custom-adversaries",v)},updateCustomEnvironment:(d,y)=>{g(f=>({...f,environments:f.environments.map(o=>o.id===d?{...o,...y}:o)}));const v=m.environments.map(f=>f.id===d?{...f,...y}:f);tt("daggerheart-custom-environments",v)},deleteCustomAdversary:d=>{g(v=>({...v,adversaries:v.adversaries.filter(f=>f.id!==d)}));const y=m.adversaries.filter(v=>v.id!==d);tt("daggerheart-custom-adversaries",y)},deleteCustomEnvironment:d=>{g(v=>({...v,environments:v.environments.filter(f=>f.id!==d)}));const y=m.environments.filter(v=>v.id!==d);tt("daggerheart-custom-environments",y)}};return e.jsx(_t.Provider,{value:De,children:t})},Et=()=>{const t=c.useContext(_t);if(!t)return console.warn("useGameState: Context not available yet, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{gameState:s,customContent:p,...l}=t;if(!s)return console.warn("useGameState: gameState not available, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],customContent:{adversaries:[],environments:[]},updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},addCustomAdversary:()=>{},addCustomEnvironment:()=>{},updateCustomAdversary:()=>{},updateCustomEnvironment:()=>{},deleteCustomAdversary:()=>{},deleteCustomEnvironment:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{fear:C,countdowns:m,adversaries:g,environments:q,partySize:x,savedEncounters:N}=s;return{gameState:s,fear:C,countdowns:m,adversaries:g,environments:q,partySize:x,savedEncounters:N,customContent:p,...l,hasCountdowns:m.length>0,hasAdversaries:g.length>0,hasEnvironments:q.length>0,getCountdownById:F=>m.find(h=>h.id===F),getAdversaryById:F=>g.find(h=>h.id===F),getEnvironmentById:F=>q.find(h=>h.id===F)}},Wt={fear:{icon:Gt,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"0.125rem",maxWidth:"none"},pipStyle:{fontSize:"var(--text-lg)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0,imageRendering:"crisp-edges"},filledColor:"var(--purple)",emptyColor:"var(--gray-dark)",tooltipTitle:"Click anywhere in header to adjust fear:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease fear by 1"},{text:"Right of boundary:",description:"Click to increase fear by 1"}]},hp:{icon:Jt,maxValue:20,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stress:{icon:Yt,maxValue:12,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},countdown:{icon:Rt,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust countdown:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease countdown by 1"},{text:"Right of boundary:",description:"Click to increase countdown by 1"}]},hpDots:{maxValue:20,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--red)",borderColor:"var(--red)",boxShadow:"0 0 4px rgba(239, 68, 68, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stressDots:{maxValue:12,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--purple)",borderColor:"var(--purple)",boxShadow:"0 0 4px rgba(139, 92, 246, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},adversaryHP:{icon:Ot,maxValue:20,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust HP:",tooltipInstructions:[{text:"Filled pip:",description:"Click to heal (reduce damage)"},{text:"Empty pip:",description:"Click to take damage"}]},adversaryStress:{icon:Xt,maxValue:12,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust stress:",tooltipInstructions:[{text:"Filled pip:",description:"Click to reduce stress"},{text:"Empty pip:",description:"Click to increase stress"}]},countdownDistributed:{icon:Rt,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Countdown progress:",tooltipInstructions:[{text:"Progress:",description:"Current countdown value"}]}},it=({type:t="fear",value:s=0,maxValue:p,onChange:l,size:C="lg",showTooltip:m=!0,containerStyle:g={},pipStyle:q={},countdownType:x=null,distributedGroups:N=null,onPipClick:F=null,enableBoundaryClick:h=!1,clickContainerWidth:D="auto",centerPips:w=!0})=>{const[X,pe]=c.useState(!1),se=Wt[t]||Wt.fear,re=p||se.maxValue,V=Math.max(0,Math.min(re,s));let ue=se.filledColor;t==="countdown"&&x&&(["progress","dynamic-progress","simple-hope"].includes(x)?ue="var(--gold)":["consequence","dynamic-consequence","simple-fear"].includes(x)?ue="var(--purple)":["long-term","standard"].includes(x)&&(ue="var(--text-secondary)"));const le=(P,he)=>{if(F)F(P,he);else if(l){const Ie=P+1;l(Ie)}},ge=P=>{if(!h||!l||F)return;P.currentTarget.getBoundingClientRect();const he=P.currentTarget.querySelector(".pip-container");if(!he)return;const Ie=he.getBoundingClientRect(),oe=P.clientX-Ie.left;if(oe<0){V>0&&l(V-1);return}if(oe>Ie.width){V<re&&l(V+1);return}const A=Ie.width,b=A*.05,Q=A-2*b,J=oe-b,K=V/re,Ae=Q*K;J<Ae?V>0&&l(V-1):V<re&&l(V+1)},Te=(()=>{if(!N||t!=="countdownDistributed")return[{start:0,end:re,groupIndex:0}];let P=0;return N.map((he,Ie)=>{const oe={start:P,end:P+he,groupIndex:Ie};return P+=he,oe})})(),_=()=>e.jsxs(e.Fragment,{children:[Te.map(P=>e.jsx(rt.Fragment,{children:[...Array(P.end-P.start)].map((he,Ie)=>{const oe=P.start+Ie,A=oe<V;if(se.isDots)return e.jsx("div",{style:{...se.pipStyle,...A?se.filledStyle:se.emptyStyle,...q,cursor:l||F?"pointer":"default"},onClick:h?void 0:()=>le(oe,A),title:`${oe+1} of ${re}`},oe);{const b=se.icon,Q=b&&typeof b=="object"&&b.iconName,J=A?ue:se.emptyColor;return e.jsx("span",{className:`fear-pip ${A?"filled":"empty"}`,style:{...se.pipStyle,color:J,cursor:l||F?"pointer":"default",...q},onClick:h?void 0:()=>le(oe,A),title:`${oe+1} of ${re}`,children:Q?e.jsx(Kt,{icon:b,size:C}):e.jsx(b,{size:C==="lg"?18:16})},oe)}})},P.groupIndex)),m&&e.jsx("div",{style:{position:"relative",cursor:"help",pointerEvents:"none"},children:e.jsxs("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:X?"translateX(-50%) translateY(-5px)":"translateX(-50%)",background:"rgba(15, 23, 42, 0.95)",border:"1px solid var(--gray)",borderRadius:"var(--radius-md)",padding:"var(--space-md)",minWidth:"250px",zIndex:1e3,opacity:X?1:0,visibility:X?"visible":"hidden",transition:"all 0.2s ease",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.5)"},children:[e.jsx("div",{style:{fontWeight:600,color:"var(--gray-200)",marginBottom:"0.75rem",fontSize:"var(--text-sm)"},children:se.tooltipTitle}),se.tooltipInstructions.map((P,he)=>e.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.8rem",color:"var(--gray-300)",lineHeight:1.4},children:[e.jsx("strong",{style:{color:"var(--gray-200)"},children:P.text})," ",P.description]},he))]})})]});return e.jsx("div",{style:{width:D,height:"100%",cursor:l||F?"pointer":"default",touchAction:"manipulation",userSelect:"none",display:w?"flex":"block",alignItems:w?"center":"stretch",justifyContent:w?"center":"flex-start",...g},onClick:P=>{P.stopPropagation(),P.preventDefault(),h&&ge(P)},onMouseEnter:()=>pe(m),onMouseLeave:()=>pe(!1),children:e.jsx("div",{className:"pip-container",style:{...se.containerStyle,width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},children:_()})})},dr=({position:t="top",children:s,onClick:p,className:l="",style:C={}})=>{const m=t==="top",g=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://"),q={background:"var(--bg-primary)",borderTop:m?"none":"1px solid var(--border)",borderBottom:m?"1px solid var(--border)":"none",padding:m?"0.25rem 0":"0.5rem",paddingBottom:m?"0.25rem":g?"calc(0.5rem + env(safe-area-inset-bottom) + 1rem)":"calc(0.5rem + env(safe-area-inset-bottom))",position:m?"relative":"sticky",[m?"top":"bottom"]:0,zIndex:m?10:100,order:m?1:3,flexShrink:0,touchAction:"manipulation",userSelect:"none",display:"flex",flexDirection:m?"column":"row",justifyContent:m?"stretch":"center",alignItems:m?"stretch":"center",gap:m?"0":"1rem",height:m?"auto":"60px",...C};return e.jsx("div",{className:l,style:q,onClick:p,children:s})},vt=52,It=({tabContent:t,children:s,containerStyle:p={},tabStyle:l={},showTab:C=!0,tabBackgroundColor:m="var(--bg-primary)",tabBorderColor:g="var(--border)",tabJustifyContent:q="center",containerBackgroundColor:x,containerBorderColor:N,containerBorderRadius:F="8px",containerBoxShadow:h,containerOverflow:D="hidden",reserveTabSpace:w=!1,style:X={},...pe})=>{const se={display:"flex",flexDirection:"column",position:"relative",height:"100%",width:"100%",borderRadius:F,overflow:D};x&&(se.backgroundColor=x),N&&(se.border=`2px solid ${N}`),h&&(se.boxShadow=h);const re={position:"relative",overflow:"visible",height:"100%",width:"100%",display:"flex",flexDirection:"column",boxSizing:"border-box"},V=w?"0":`-${vt}px`,ue=w&&C&&t?`${vt}px`:"0";return e.jsxs("div",{style:{...re,...X},...pe,children:[C&&t&&e.jsx("div",{style:{position:"absolute",top:V,left:"7px",right:"7px",width:"calc(100% - 14px)",display:"flex",alignItems:"center",gap:"0.5rem",justifyContent:q,flexShrink:0,zIndex:0,padding:"0.5rem 0.75rem",paddingBottom:"calc(0.5rem + 4px)",minHeight:`${vt}px`,backgroundColor:m,border:`1.5px solid ${g}`,borderBottom:"none",borderRadius:"8px 8px 0 0",boxSizing:"border-box",marginBottom:"-4px",...l},children:t}),e.jsx("div",{style:{...se,...p,zIndex:1,marginTop:ue},children:s})]})},cr="modulepreload",ur=function(t){return"/Daggerheart/"+t},Lt={},st=function(s,p,l){if(!p||p.length===0)return s();const C=document.getElementsByTagName("link");return Promise.all(p.map(m=>{if(m=ur(m),m in Lt)return;Lt[m]=!0;const g=m.endsWith(".css"),q=g?'[rel="stylesheet"]':"";if(!!l)for(let F=C.length-1;F>=0;F--){const h=C[F];if(h.href===m&&(!g||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${m}"]${q}`))return;const N=document.createElement("link");if(N.rel=g?"stylesheet":cr,g||(N.as="script",N.crossOrigin=""),N.href=m,document.head.appendChild(N),g)return new Promise((F,h)=>{N.addEventListener("load",F),N.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${m}`)))})})).then(()=>s()).catch(m=>{const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=m,window.dispatchEvent(g),!g.defaultPrevented)throw m})},Bt={Minion:{difficulty:t=>[9,12,15,18][t-1],thresholds:t=>({major:0,severe:0}),hpMax:t=>1,stressMax:t=>1,atk:t=>[-1,0,1,2][t-1],damage:t=>["2","5","8","11"][t-1],range:"Melee"},Standard:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[7,10,20,25][t-1],severe:[12,20,32,45][t-1]}),hpMax:t=>[4,5,6,7][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[1,2,3,4][t-1],damage:t=>["1d8+1","2d8+2","3d8+3","4d8+4"][t-1],range:"Melee"},Bruiser:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[8,14,22,38][t-1],severe:[15,28,40,70][t-1]}),hpMax:t=>[6,7,8,9][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[-1,0,1,2][t-1],damage:t=>["1d12+2","2d12+4","3d12+6","4d12+8"][t-1],range:"Melee"},Horde:{difficulty:t=>[10,13,16,19][t-1],thresholds:t=>({major:[7,10,20,25][t-1],severe:[12,20,32,45][t-1]}),hpMax:t=>[5,6,7,8][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[-1,0,1,2][t-1],damage:t=>["1d8+2","2d8+4","3d8+6","4d8+8"][t-1],range:"Melee"},Leader:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[7,13,21,35][t-1],severe:[14,26,38,65][t-1]}),hpMax:t=>[5,6,7,8][t-1],stressMax:t=>[5,5,6,6][t-1],atk:t=>[2,4,6,8][t-1],damage:t=>["1d10+2","2d10+4","3d10+6","4d10+8"][t-1],range:"Melee"},Ranged:{difficulty:t=>[10,13,16,19][t-1],thresholds:t=>({major:[4,8,18,22][t-1],severe:[7,16,30,42][t-1]}),hpMax:t=>[3,4,5,6][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d8+2","2d8+4","3d8+6","4d8+8"][t-1],range:"Close"},Skulk:{difficulty:t=>[12,15,18,21][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,5,6,7][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d6+2","2d6+4","3d6+6","4d6+8"][t-1],range:"Melee"},Solo:{difficulty:t=>[12,15,18,21][t-1],thresholds:t=>({major:[7,13,21,35][t-1],severe:[14,26,38,65][t-1]}),hpMax:t=>[8,9,10,11][t-1],stressMax:t=>[5,5,6,6][t-1],atk:t=>[3,5,7,9][t-1],damage:t=>["1d10+3","2d10+6","3d10+9","4d10+12"][t-1],range:"Melee"},Support:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,4,5,5][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d4+2","2d4+4","3d4+6","4d4+8"][t-1],range:"Melee"},Social:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,4,5,5][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d4+2","2d4+4","3d4+6","4d4+8"][t-1],range:"Melee"}},lt=(t,s)=>{const p=Bt[s]||Bt.Standard;return{difficulty:p.difficulty(t),thresholds:p.thresholds(t),hpMax:p.hpMax(t),stressMax:p.stressMax(t),atk:p.atk(t),damage:p.damage(t),range:p.range}};let qt={adversaries:[]},Dt=!1;const pr=()=>({customAdversaries:JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]")}),mr=async()=>{if(Dt)return;let t={adversaries:[]},s={adversaries:[]};try{const l=await st(()=>import("./adversaries-9c8932de.js"),[]);t=(l==null?void 0:l.default)||l}catch(l){console.warn("Failed to load adversaries.json:",l)}try{const l=await st(()=>import("./playtest-adversaries-4a099c10.js"),[]);s=(l==null?void 0:l.default)||l}catch(l){console.warn("Failed to load playtest-adversaries.json:",l)}const{customAdversaries:p}=pr();qt={...t,adversaries:[...t.adversaries||[],...s.adversaries||[],...p]},Dt=!0},Tt=c.forwardRef(({onSave:t,onRefresh:s,onAddItem:p,editingAdversary:l,onCancelEdit:C,isStockAdversary:m=!1,autoFocus:g=!1,allAdversaries:q=[],embedded:x=!1,hideEmbeddedButtons:N=!1},F)=>{const h=c.useRef(null),D=c.useRef(null),[w,X]=c.useState(()=>{const A=lt(1,"Standard");return{name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:A.difficulty,thresholds:A.thresholds,hpMax:A.hpMax,stressMax:A.stressMax,atk:A.atk,weapon:"",range:A.range,damage:A.damage,experience:[],features:[]}}),[pe,se]=c.useState(!1),[re,V]=c.useState(!1),[ue,le]=c.useState([]),[ge,me]=c.useState(!1),[Te,_]=c.useState([]);c.useEffect(()=>{(async()=>{await mr(),q.length>0?_(q):_(qt.adversaries||[])})()},[q]),c.useEffect(()=>{g&&setTimeout(()=>{var A,b,Q;l&&D.current?((A=D.current)==null||A.focus(),(b=D.current)==null||b.select()):h.current&&((Q=h.current)==null||Q.focus())},650)},[g,l]),c.useEffect(()=>{var A;if(l){const b=l.baseName||((A=l.name)==null?void 0:A.replace(/\s+\(\d+\)$/,""))||l.name||"";X({name:b,tier:l.tier||1,type:l.type||"Standard",description:l.description||"",motives:l.motives||"",difficulty:l.difficulty||11,thresholds:l.thresholds||{major:7,severe:12},hpMax:l.hpMax||3,stressMax:l.stressMax||1,atk:l.atk||1,weapon:l.weapon||"",range:l.range||"Melee",damage:l.damage||"",experience:l.experience||[],features:l.features||[]}),V(!1)}else{const b=lt(1,"Standard");X({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:b.difficulty,thresholds:b.thresholds,hpMax:b.hpMax,stressMax:b.stressMax,atk:b.atk,weapon:"",range:b.range,damage:b.damage,experience:[],features:[]}),V(!1)}},[l]),c.useEffect(()=>{if(!l&&!re){const A=lt(w.tier,w.type);X(b=>({...b,difficulty:A.difficulty,thresholds:A.thresholds,hpMax:A.hpMax,stressMax:A.stressMax,atk:A.atk,range:A.range,damage:A.damage}))}},[w.tier,w.type,l,re]);const P=A=>{if(X(b=>({...b,name:A})),A.trim().length>0){const b=Te.filter(Q=>{var K;return(((K=Q.name)==null?void 0:K.replace(/\s+\(\d+\)$/,""))||Q.name||"").toLowerCase().includes(A.toLowerCase())}).slice(0,5);le(b),me(b.length>0)}else le([]),me(!1)},he=async()=>{if(!w.name.trim()){alert("Please enter a name for the adversary");return}se(!0);try{const A=K=>(K||[]).filter(Ae=>Ae.name&&Ae.name.trim()!==""||Ae.modifier!==void 0&&Ae.modifier!==0),b=w.name.trim()||"Unknown",Q=A(w.experience||[]),J={...w,experience:Q,baseName:b,name:b,hp:l?l.hp:0,stress:l?l.stress:0,source:"Homebrew"};if(l){if(m){const{id:K,name:Ae,...ie}=J;await t(ie),alert("Custom adversary created successfully!")}else{const K={...J,name:J.baseName};await t(K,l.id),alert("Adversary updated successfully!")}C&&C()}else{await t(J),s&&await s();const K=lt(1,"Standard");X({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:K.difficulty,thresholds:K.thresholds,hpMax:K.hpMax,stressMax:K.stressMax,atk:K.atk,weapon:"",range:K.range,damage:K.damage,experience:[],features:[]}),V(!1),alert("Custom adversary created successfully!")}}catch(A){console.error("Error saving adversary:",A),alert("Error saving adversary. Please try again.")}finally{se(!1)}};c.useImperativeHandle(F,()=>({handleSave:he,isSaving:pe,canSave:w.name.trim().length>0}));const Ie={...w,id:"new-adversary",hp:0,stress:0,source:"Homebrew"},oe=()=>pe?l?m?"Creating...":"Saving...":"Creating...":l?m?"Save As Custom":"Save":"Create";return e.jsxs(e.Fragment,{children:[!x&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h2",{style:{color:"var(--text-primary)",fontSize:"1.5rem",fontWeight:"600",margin:0},children:l?m?"Edit Adversary (Save As Custom)":"Edit Custom Adversary":"Create Custom Adversary"}),e.jsx("button",{onClick:he,disabled:pe||!w.name.trim(),style:{padding:"0.75rem 1.5rem",backgroundColor:pe||!w.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"8px",cursor:pe||!w.name.trim()?"not-allowed":"pointer",fontSize:"1rem",fontWeight:"600",opacity:pe||!w.name.trim()?.6:1},children:oe()})]}),x&&!N&&e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",marginBottom:"0.5rem",padding:"0.5rem",borderBottom:"1px solid var(--border)"},children:[e.jsx("button",{onClick:he,disabled:pe||!w.name.trim(),style:{padding:"0.5rem 1rem",backgroundColor:pe||!w.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"6px",cursor:pe||!w.name.trim()?"not-allowed":"pointer",fontSize:"0.875rem",fontWeight:"600",opacity:pe||!w.name.trim()?.6:1,marginRight:"0.5rem"},children:oe()}),C&&e.jsx("button",{onClick:C,style:{padding:"0.5rem 1rem",backgroundColor:"transparent",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"6px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600"},children:"Cancel"})]}),!l&&e.jsxs("div",{style:{marginBottom:"1rem",position:"relative"},children:[e.jsx("input",{ref:h,type:"text",value:w.name,onChange:A=>{const b=A.target.value;X(Q=>({...Q,name:b})),P(b)},placeholder:"Adversary name",style:{width:"100%",padding:"0.75rem",border:"1px solid var(--border)",borderRadius:"8px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"1rem",outline:"none"}}),ge&&ue.length>0&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"0 0 8px 8px",borderTop:"none",maxHeight:"200px",overflowY:"auto",zIndex:1e3,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)"},children:ue.map((A,b)=>{var J;const Q=A.baseName||((J=A.name)==null?void 0:J.replace(/\s+\(\d+\)$/,""))||A.name;return e.jsxs("div",{onClick:()=>{X(K=>({...K,name:Q,tier:A.tier||K.tier,type:A.type||K.type,difficulty:A.difficulty||K.difficulty,thresholds:A.thresholds||K.thresholds,hpMax:A.hpMax||K.hpMax,stressMax:A.stressMax||K.stressMax,atk:A.atk||K.atk,range:A.range||K.range,damage:A.damage||K.damage})),me(!1),V(!0),h.current&&h.current.blur()},style:{padding:"0.75rem",cursor:"pointer",borderBottom:b<ue.length-1?"1px solid var(--border)":"none",transition:"background-color 0.2s"},onMouseEnter:K=>{K.target.style.backgroundColor="var(--bg-secondary)"},onMouseLeave:K=>{K.target.style.backgroundColor="transparent"},onMouseDown:K=>K.preventDefault(),children:[e.jsx("div",{style:{fontWeight:"600"},children:Q}),e.jsxs("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",marginTop:"2px"},children:[A.type," • Tier ",A.tier]})]},b)})})]}),e.jsx(ht,{item:Ie,type:"adversary",mode:"edit",nameInputRef:l?D:void 0,autoFocusNameInput:g&&l,onUpdate:(A,b)=>{X(Q=>({...Q,...b}))}})]})});Tt.displayName="CustomAdversaryCreator";const Pt=({value:t})=>e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"44px",height:"32px",zIndex:3},children:[e.jsx("svg",{width:"40",height:"32",viewBox:"0 0 40 32",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",style:{position:"absolute",zIndex:1},children:e.jsx("path",{d:"M2 2h28l6 14-6 14H2l6-14-6-14z"})}),e.jsx("span",{style:{position:"absolute",fontSize:"0.8rem",fontWeight:500,color:"var(--text-primary)",textAlign:"center",zIndex:2,left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:t})]}),fr=({type:t,tier:s,isEditMode:p,onUpdate:l,itemId:C})=>{const g=(h=>{if(!h)return 0;const w=document.createElement("canvas").getContext("2d");return w.font="600 11px system-ui, -apple-system, sans-serif",w.measureText(h.toUpperCase()).width})(t),q=4,x=18,N=Math.max(50,g+q+x),F=N+15;return p?e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",gap:"8px",height:"32px"},children:[e.jsxs("select",{value:t||"",onChange:h=>{l&&l(C,{type:h.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",outline:"none",borderRadius:"4px",padding:"4px 8px",width:"95px",height:"24px"},children:[e.jsx("option",{value:"Standard",children:"Standard"}),e.jsx("option",{value:"Solo",children:"Solo"}),e.jsx("option",{value:"Bruiser",children:"Bruiser"}),e.jsx("option",{value:"Horde",children:"Horde"}),e.jsx("option",{value:"Minion",children:"Minion"}),e.jsx("option",{value:"Ranged",children:"Ranged"}),e.jsx("option",{value:"Leader",children:"Leader"}),e.jsx("option",{value:"Skulk",children:"Skulk"}),e.jsx("option",{value:"Social",children:"Social"}),e.jsx("option",{value:"Support",children:"Support"})]}),e.jsxs("div",{style:{position:"relative",width:"24px",height:"24px"},children:[e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",width:"20px",height:"20px",backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",borderRadius:"2px"}}),e.jsx("input",{type:"text",value:s||"",onChange:h=>{const D=h.target.value.replace(/[^1-4]/g,"");D.length<=1&&l&&l(C,{tier:D===""?"":parseInt(D)})},onKeyDown:h=>{if(h.key==="ArrowUp"){h.preventDefault();const D=parseInt(s)||1;l&&l(C,{tier:Math.min(D+1,4)})}else if(h.key==="ArrowDown"){h.preventDefault();const D=parseInt(s)||1;l&&l(C,{tier:Math.max(D-1,1)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"transparent",border:"none",color:"var(--text-primary)",fontSize:"0.8rem",fontWeight:600,width:"24px",height:"24px",textAlign:"center",outline:"none",zIndex:1},maxLength:"1"})]})]}):e.jsxs("div",{style:{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"center",height:"32px",width:`${F}px`},children:[e.jsxs("svg",{width:F,height:"32",viewBox:`0 0 ${F} 32`,style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1},children:[e.jsx("rect",{x:"1",y:"6",width:N-1,height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4",ry:"4"}),e.jsx("rect",{x:N-10,y:"6",width:"20",height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"2",ry:"2",transform:`rotate(45 ${N-1} 16)`})]}),e.jsx("span",{style:{position:"absolute",top:"50%",left:"4px",transform:"translateY(-50%)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",color:"var(--text-primary)",zIndex:2,pointerEvents:"none"},children:t}),e.jsx("span",{style:{position:"absolute",top:"50%",left:`${N-.5}px`,transform:"translate(-50%, -50%)",fontSize:"0.8rem",fontWeight:600,color:"white",zIndex:2,pointerEvents:"none",textAlign:"center",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",width:"20px",height:"20px"},children:s})]})},bt=({feature:t,featureType:s,item:p,onUpdate:l,handleFeatureDeleteClick:C,deleteConfirmations:m,getFeatureKey:g})=>{var h,D;const q=()=>{try{const X=[...(p==null?void 0:p.features)||[]],pe=X.filter(re=>re.type===s),se=pe.findIndex(re=>re===t);if(se>0&&se<pe.length){const re=pe[se],V=pe[se-1];if(re&&V){const ue=X.findIndex(ge=>ge===re),le=X.findIndex(ge=>ge===V);ue>=0&&le>=0&&(X[ue]=V,X[le]=re,l&&l(p.id,{features:X}))}}}catch(w){console.error(`Error in ${s.toLowerCase()} up button:`,w)}},x=()=>{try{const X=[...(p==null?void 0:p.features)||[]],pe=X.filter(re=>re.type===s),se=pe.findIndex(re=>re===t);if(se<pe.length-1&&se>=0){const re=pe[se],V=pe[se+1];if(re&&V){const ue=X.findIndex(ge=>ge===re),le=X.findIndex(ge=>ge===V);ue>=0&&le>=0&&(X[ue]=V,X[le]=re,l&&l(p.id,{features:X}))}}}catch(w){console.error(`Error in ${s.toLowerCase()} down button:`,w)}},N=w=>w.type===s,F=w=>w.type===s&&w.name.trim();return e.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",alignSelf:"stretch"},children:[e.jsx("button",{onClick:q,disabled:(p.features||[]).filter(N).findIndex(w=>w===t)===0,tabIndex:"-1",style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(p.features||[]).filter(F).length>=2&&(p.features||[]).filter(N).findIndex(w=>w===t)!==0&&t.name.trim()?"white":"var(--text-secondary)",cursor:(p.features||[]).filter(F).length>=2&&(p.features||[]).filter(N).findIndex(w=>w===t)!==0&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↑"}),e.jsx("button",{onClick:()=>C(t),disabled:!t.name.trim()&&!t.description.trim(),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:m[g(t)]?"var(--danger)":"var(--gray-700)",color:!t.name.trim()&&!t.description.trim()?"var(--text-secondary)":"white",cursor:!t.name.trim()&&!t.description.trim()?"not-allowed":"pointer",opacity:!t.name.trim()&&!t.description.trim()?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"×"}),e.jsx("button",{onClick:x,disabled:(p.features||[]).filter(N).findIndex(w=>w===t)===(p.features||[]).filter(N).length-1,style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(p.features||[]).filter(F).length>=2&&(p.features||[]).filter(N).findIndex(w=>w===t)<(p.features||[]).filter(N).length-1&&((h=(p.features||[]).filter(N)[(p.features||[]).filter(N).findIndex(w=>w===t)+1])!=null&&h.name.trim())&&t.name.trim()?"white":"var(--text-secondary)",cursor:(p.features||[]).filter(F).length>=2&&(p.features||[]).filter(N).findIndex(w=>w===t)<(p.features||[]).filter(N).length-1&&((D=(p.features||[]).filter(N)[(p.features||[]).filter(N).findIndex(w=>w===t)+1])!=null&&D.name.trim())&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↓"})]})},He={transitions:{hoverIn:"all 0.1s ease",hoverOut:"all 0.3s ease"},card:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"8px",cursor:"pointer",transition:"all 0.1s ease",position:"relative",border:"none"},cardHover:{backgroundColor:"var(--bg-card-hover)"},cardDead:{opacity:.6,backgroundColor:"var(--gray-800)",borderColor:"var(--border)"},cardAtMax:{backgroundColor:"var(--success)",borderColor:"var(--success)"},rowMain:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},rowTitle:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",margin:0},rowMeta:{display:"flex",gap:"8px",alignItems:"center"},badge:{padding:"2px 6px",borderRadius:"3px",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},typeBadge:{backgroundColor:"var(--purple)",color:"var(--text-primary)"},tierBadge:{backgroundColor:"var(--info)",color:"var(--text-primary)"},damageInputPopup:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,borderRadius:"8px"},damageInputContent:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"8px",padding:"8px",display:"flex",flexDirection:"row",gap:"8px",minWidth:"200px",alignItems:"center",position:"absolute",right:"1rem",top:"50%",transform:"translateY(-50%)"},damageInput:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"4px",padding:"4px 6px",color:"var(--text-primary)",fontSize:"16px",width:"80px",textAlign:"center"},damageIndicators:{display:"flex",gap:"8px",alignItems:"center",justifyContent:"center"},damageDrop:{fontSize:"16px",color:"var(--text-secondary)",cursor:"pointer",transition:"color 0.1s ease"},applyButton:{backgroundColor:"var(--gray-600)",color:"white",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"32px",minHeight:"32px"}},hr=(t,s,p,l)=>{const[C,m]=c.useState(!1),[g,q]=c.useState("");c.useEffect(()=>{if(C){const w=X=>{X.target.closest(".damage-input-popup")||(m(!1),q(""))};return document.addEventListener("click",w),()=>document.removeEventListener("click",w)}},[C]);const x=w=>{w.stopPropagation(),w.preventDefault();const X=t.hp||0,pe=t.hpMax||1,se=w.currentTarget.getBoundingClientRect(),re=w.clientX-se.left,V=se.width/pe;Math.floor(re/V)<X?p&&p(t.id,1,t.hp):s&&s(t.id,1,t.hp,t.hpMax)},N=w=>{w.stopPropagation(),w.preventDefault();const X=t.stress||0,pe=t.stressMax||1,se=w.currentTarget.getBoundingClientRect(),re=w.clientX-se.left,V=se.width/pe;Math.floor(re/V)<X?l&&l(t.id,-1,t.stress,t.stressMax):l&&l(t.id,1,t.stress,t.stressMax)},F=w=>{w.stopPropagation(),(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")&&(m(!0),q(t.type==="Minion"?"1":""))},h=()=>{const w=parseInt(g);if(w>0){if(t.type==="Minion")s&&s(t.id,w,t.hp,t.hpMax);else{let X=0;w>=t.thresholds.severe?X=3:w>=t.thresholds.major?X=2:w>=1&&(X=1),s&&s(t.id,X,t.hp,t.hpMax)}m(!1),q("")}};return{showDamageInput:C,damageValue:g,setDamageValue:q,setShowDamageInput:m,handleHpClick:x,handleStressClick:N,handleDifficultyClick:F,applyDamage:h,handleKeyDown:w=>{w.key==="Enter"?h():w.key==="Escape"&&(m(!1),q(""))}}},xr=({item:t,type:s,mode:p="expanded",onClick:l,onDelete:C,onApplyDamage:m,onApplyHealing:g,onApplyStressChange:q,onUpdate:x,adversaries:N=[],isSelected:F=!1,isEditMode:h=!1,instances:D=[],isEmbedded:w=!1,showAddRemoveButtons:X=!1,onAddInstance:pe=null,onRemoveInstance:se=null,onEdit:re=null,showCustomCreator:V=!1,onSaveCustomAdversary:ue=null,onCancelEdit:le=null,isStockAdversary:ge=!1})=>{const me=c.useRef(null),Te=c.useRef(D.length),_=c.useRef(null),P=c.useRef(null),he=c.useRef(null),Ie=c.useRef(null),oe=c.useRef(null);c.useEffect(()=>{const o=me.current;if(!o)return;const S=()=>{_.current=o.scrollHeight,P.current=o.scrollTop};o.addEventListener("scroll",S,{passive:!0});const W=setInterval(S,100);return()=>{o.removeEventListener("scroll",S),clearInterval(W)}},[]),c.useEffect(()=>()=>{me.current&&(_.current=me.current.scrollHeight,P.current=me.current.scrollTop)},[D.length,D]);const[A,b]=c.useState({});c.useEffect(()=>{if(V&&Ie.current){const o=setTimeout(()=>{var S,W;(S=Ie.current)==null||S.focus(),(W=Ie.current)==null||W.select()},650);return()=>clearTimeout(o)}},[V]),c.useLayoutEffect(()=>{const o=D.length,S=Te.current;if(o!==S&&me.current){const W=_.current,G=P.current;if(!W||G===null){Te.current=o;return}const U=me.current,ye=U.scrollHeight,Ne=U.clientHeight;if(!(o<S)){if(o>S){const Le=ye-Ne,Fe=U.scrollTop,n=Le-Fe;if(Math.abs(n)>.5){he.current&&(cancelAnimationFrame(he.current),he.current=null);const R=400,r=performance.now(),M=fe=>{if(!U){he.current=null;return}const $=fe-r,ee=Math.min($/R,1),u=1-ee,E=1-u*u*u,k=Fe+n*E;U.scrollTop=k,ee<1?he.current=requestAnimationFrame(M):(U.scrollTop=Le,he.current=null)};he.current=requestAnimationFrame(M)}}}Te.current=o}else Te.current=o},[D.length,D]);const Q=o=>{const W=(t.features||[]).filter(G=>G.type===o.type).findIndex(G=>G===o);return`${o.type}-${W}-${o.name||"blank"}`},J=(o,S)=>`experience-${S}-${typeof o=="string"?o:o.name||"blank"}`,K=o=>!o||!Array.isArray(o)?[]:o.filter(S=>{if(typeof S=="string")return S.trim().length>0;const W=S.name||"",G=S.modifier||0;return W.trim().length>0||G>0}),Ae=o=>{const S=Q(o);if(A[S]){const W=t.features.filter(G=>G!==o);x&&x(t.id,{features:W}),b(G=>{const U={...G};return delete U[S],U})}else b(W=>({...W,[S]:!0})),setTimeout(()=>{b(W=>{const G={...W};return delete G[S],G})},3e3)},ie=(o,S)=>{const W=J(o,S);if(A[W]){const G=[...t.experience||[]];G.splice(S,1);const U=K(G);x&&x(t.id,{experience:U}),b(ye=>{const Ne={...ye};return delete Ne[W],Ne})}else b(G=>({...G,[W]:!0})),setTimeout(()=>{b(G=>{const U={...G};return delete U[W],U})},3e3)},L=hr(t,m,g,q);(s==="adversary"||s==="adversaries")&&L.handleDifficultyClick;const ve=(o=!1)=>{let S={...He.card};if(F?S.transition="none":S.transition=He.transitions.hoverOut,o){const{marginTop:W,...G}=S;S=G}return F&&(S={...S,...He.cardHover}),s==="adversary"&&(t.hp||0)>=(t.hpMax||1)&&(S={...S,...He.cardDead}),S},je=()=>{if(w)return"";let o="border rounded-lg";return F&&(o+=" border-hover"),o},Re=()=>{var o;if(s==="adversary"||s==="adversaries"){const S=t.baseName||((o=t.name)==null?void 0:o.replace(/\s+\(\d+\)$/,""))||"",W=t.duplicateNumber||1,G=[...N];return N.some(Ne=>Ne.id===t.id)||G.push(t),G.filter(Ne=>Ne.baseName===S).length>1?`${S} (${W})`:S}return t.name},De=()=>{const o=[];return t.type&&o.push(e.jsx("span",{style:{...He.badge,...He.typeBadge},children:t.type},"type")),o},d=()=>s!=="adversary"||!L.showDamageInput||!(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")?null:e.jsx("div",{className:"damage-input-popup",style:He.damageInputPopup,onClick:o=>{o.stopPropagation(),o.target===o.currentTarget&&(s==="adversary"||s==="adversaries")&&(L.setShowDamageInput(!1),L.setDamageValue(""))},children:e.jsxs("div",{className:"border rounded-lg",style:{...He.damageInputContent,borderColor:"var(--border)"},onClick:o=>o.stopPropagation(),children:[e.jsx("input",{type:"number",inputMode:"numeric",enterKeyHint:"done",placeholder:"dmg",min:(t.type==="Minion","0"),value:s==="adversary"||s==="adversaries"?L.damageValue:"",onChange:o=>{(s==="adversary"||s==="adversaries")&&L.setDamageValue(o.target.value)},onKeyDown:s==="adversary"||s==="adversaries"?L.handleKeyDown:void 0,className:"border rounded-sm",style:{...He.damageInput,borderColor:"var(--border)"},autoFocus:!0}),e.jsxs("div",{style:He.damageIndicators,children:[t.type==="Minion"?(()=>{var U,ye;const o=parseInt(s==="adversary"||s==="adversaries"?L.damageValue:"0")||0,S=(U=t.features)==null?void 0:U.find(Ne=>{var Le;return(Le=Ne.name)==null?void 0:Le.startsWith("Minion (")}),W=S?parseInt(((ye=S.name.match(/\((\d+)\)/))==null?void 0:ye[1])||"1"):1,G=Math.floor(o/W);return o>=W&&G>0?e.jsxs("span",{style:{...He.damageDrop,color:"var(--red)"},title:`${o} damage can defeat ${G+1} minion${G+1!==1?"s":""} (1 + ${G} additional)`,children:["+",G," additional minion(s)"]}):e.jsx("span",{style:He.damageDrop,title:`${o} damage defeats this minion only`,children:"+0 additional minion(s)"})})():[1,2,3].map(o=>{const S=parseInt(s==="adversary"||s==="adversaries"?L.damageValue:"0")||0;let W=!1;return o===1&&S>=1&&(W=!0),o===2&&S>=t.thresholds.major&&(W=!0),o===3&&S>=t.thresholds.severe&&(W=!0),e.jsx("span",{style:{...He.damageDrop,color:W?"var(--red)":"var(--text-secondary)"},onClick:G=>{G.stopPropagation(),(s==="adversary"||s==="adversaries")&&(o===1?L.setDamageValue("1"):o===2?L.setDamageValue(t.thresholds.major.toString()):o===3&&L.setDamageValue(t.thresholds.severe.toString()))},title:`Click to set damage to ${o===1?"1":o===2?t.thresholds.major:t.thresholds.severe}`,children:e.jsx(Ot,{size:16})},o)}),e.jsx("button",{style:{...He.applyButton,backgroundColor:"var(--gray-600)"},onClick:o=>{o.stopPropagation(),(s==="adversary"||s==="adversaries")&&(!L.damageValue||parseInt(L.damageValue)<1?(L.setShowDamageInput(!1),L.setDamageValue("")):L.applyDamage())},title:!L.damageValue||parseInt(L.damageValue)<1?"Close damage input":"Apply damage",children:!L.damageValue||parseInt(L.damageValue)<1?e.jsx(ot,{size:16}):e.jsx(er,{size:16})})]})]})}),y=()=>{var U,ye,Ne,Le,Fe;const o=(t.hp||0)>=(t.hpMax||1),S=v==="edit"||V,W=s==="adversary",G=W?V?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:n=>{n.stopPropagation(),ue&&(ue(t,t.id),le&&le())},style:{background:"var(--purple)",border:"1px solid var(--purple)",color:"white",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:n=>{n.target.style.opacity="0.9"},onMouseLeave:n=>{n.target.style.opacity="1"},title:"Save",children:[e.jsx(zt,{size:16}),e.jsx("span",{children:"Save"})]}),le&&e.jsxs("button",{onClick:n=>{n.stopPropagation(),le()},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:n=>{n.target.style.backgroundColor="var(--bg-hover)",n.target.style.borderColor="var(--purple)"},onMouseLeave:n=>{n.target.style.backgroundColor="var(--bg-secondary)",n.target.style.borderColor="var(--border)"},title:"Cancel",children:[e.jsx(ot,{size:16}),e.jsx("span",{children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:n=>{n.stopPropagation(),se&&se(t.id)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease"},onMouseEnter:n=>{n.currentTarget.style.backgroundColor="var(--bg-hover)",n.currentTarget.style.borderColor="var(--purple)"},onMouseLeave:n=>{n.currentTarget.style.backgroundColor="var(--bg-secondary)",n.currentTarget.style.borderColor="var(--border)"},title:"Remove one",children:e.jsx(ft,{size:16})}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"1rem",fontWeight:"500",minWidth:"24px",textAlign:"center"},children:D.length}),e.jsx("button",{onClick:n=>{n.stopPropagation(),pe&&pe(t)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease"},onMouseEnter:n=>{n.currentTarget.style.backgroundColor="var(--purple)",n.currentTarget.style.borderColor="var(--purple)",n.currentTarget.style.color="white"},onMouseLeave:n=>{n.currentTarget.style.backgroundColor="var(--bg-secondary)",n.currentTarget.style.borderColor="var(--border)",n.currentTarget.style.color="var(--text-primary)"},title:"Add another",children:e.jsx(at,{size:16})}),re&&e.jsx("button",{onClick:n=>{n.stopPropagation(),re(t.id)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease",marginLeft:"0.25rem"},onMouseEnter:n=>{n.currentTarget.style.backgroundColor="var(--purple)",n.currentTarget.style.borderColor="var(--purple)",n.currentTarget.style.color="white"},onMouseLeave:n=>{n.currentTarget.style.backgroundColor="var(--bg-secondary)",n.currentTarget.style.borderColor="var(--border)",n.currentTarget.style.color="var(--text-primary)"},title:"Edit",children:e.jsx(Zt,{size:16})})]}):null;return e.jsx(It,{tabContent:G,showTab:W,tabBorderColor:F?"var(--purple)":"var(--border)",containerBackgroundColor:o?"var(--gray-900)":ve(!0).backgroundColor,containerBorderColor:o?"color-mix(in srgb, var(--gray-600) 40%, transparent)":F?"var(--purple)":"var(--border)",containerBorderRadius:"8px",containerOverflow:"hidden",containerStyle:{padding:0,opacity:o?.7:1,height:"auto",maxHeight:W?"calc(100vh - 120px)":"calc(100vh - 68px)",minHeight:0},children:e.jsxs("div",{className:je(),style:{...ve(!0),padding:0,display:"flex",flexDirection:"column",position:"relative",height:"100%",minHeight:0,border:"none",borderRadius:0},onClick:l,children:[o&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                45deg,
                transparent,
                transparent 8px,
                var(--gray-600) 1px,
                var(--gray-600) 9px
              )`,pointerEvents:"none",zIndex:9999}})}),e.jsx("div",{className:"border-b",style:{padding:"8px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative",zIndex:o?1:"auto",borderBottomColor:F?"var(--purple)":"var(--border)"},children:e.jsx("div",{style:{display:"flex",flexDirection:"column",position:"relative",zIndex:o?1:"auto",padding:"2px",gap:0},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",minHeight:"40px"},children:[S?e.jsx("input",{ref:Ie,type:"text",value:t.name||"",onChange:n=>{x&&t.id&&x(t.id,{name:n.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"4px",color:"var(--text-primary)",fontSize:"1.1rem",fontWeight:"600",padding:"0.5rem",width:"100%",maxWidth:"300px",paddingRight:"0.625rem"},placeholder:"Name"}):e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flex:1},children:e.jsx("h4",{style:{...He.rowTitle,color:o?"color-mix(in srgb, var(--gray-400) 80%, transparent)":He.rowTitle.color,textAlign:"left",margin:0,fontSize:"1.1rem",paddingRight:"6px",flex:1},children:((U=t.name)==null?void 0:U.replace(/\s+\(\d+\)$/,""))||t.name})}),(t.type||t.tier||S)&&e.jsx(fr,{type:t.type,tier:t.tier,isEditMode:S,onUpdate:x,itemId:t.id})]})})}),e.jsxs("div",{ref:me,style:{borderRadius:"0 0 8px 8px",flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0},className:"invisible-scrollbar",children:[(t.motives||S)&&e.jsx("div",{style:{padding:"0.5rem 8px",textAlign:"center"},children:S?e.jsx("input",{type:"text",value:t.motives||"",onChange:n=>x&&x(t.id,{motives:n.target.value}),placeholder:"Motives...",style:{width:"100%",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}):e.jsxs("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,textAlign:"center"},children:[t.motives,t.motives&&!t.motives.endsWith(".")?".":""]})}),(t.difficulty||t.atk!==void 0||t.thresholds&&t.type!=="Minion"||t.experience&&t.experience.length>0||S)&&e.jsxs("div",{style:{padding:"0.5rem 8px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[(t.difficulty||S)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[e.jsx(Qt,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(0deg)"}}),S?e.jsx("input",{type:"text",value:t.difficulty||"",onChange:n=>{const R=n.target.value.replace(/[^0-9]/g,"");R.length<=2&&x&&x(t.id,{difficulty:parseInt(R)||0})},onKeyDown:n=>{if(n.key==="ArrowUp"){n.preventDefault();const R=parseInt(t.difficulty)||0;x&&x(t.id,{difficulty:Math.min(R+1,99)})}else if(n.key==="ArrowDown"){n.preventDefault();const R=parseInt(t.difficulty)||0;x&&x(t.id,{difficulty:Math.max(R-1,0)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"2"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:t.difficulty})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Difficulty"})]}),(t.atk!==void 0||S)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[e.jsx(Ut,{size:38,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(45deg)"}}),S?e.jsx("input",{type:"text",value:(()=>{const n=typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0;return n>=0?`+${n}`:n.toString()})(),onChange:n=>{const R=n.target.value.replace(/[^0-9+\-]/g,"");if(R.length<=4){const r=parseInt(R.replace(/[^0-9\-]/g,""))||0;x&&x(t.id,{atk:r})}},onKeyDown:n=>{if(n.key==="ArrowUp"){n.preventDefault();const r=(typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0)+1;x&&x(t.id,{atk:r})}else if(n.key==="ArrowDown"){n.preventDefault();const r=(typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0)-1;x&&x(t.id,{atk:r})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"3"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:(()=>{const n=typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk;return n>=0?`+${n}`:n})()})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Attack"})]})]}),e.jsx("div",{style:{paddingTop:"0"},children:S?e.jsx("div",{style:{display:"flex",flexDirection:"column",marginTop:"-0.25rem"},children:(()=>{const n=t.experience||[],R=n.length===0?[{name:"",modifier:0}]:n;return R.map((r,M)=>{var fe,$,ee,u,E,k,ae,te,Ce,Se,we,be,Me,$e,_e,qe,Ze,Ke,Qe,Ye,O,de,ke,Pe,a;return e.jsxs("div",{style:{position:"relative",marginBottom:"0.5rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("input",{type:"text",value:typeof r=="object"&&r.modifier>0?`+${r.modifier}`:"",onChange:i=>{const T=[...t.experience||[]],j=i.target.value.replace(/[^0-9+-]/g,""),I=j===""||j==="+"?0:parseInt(j)||0,B=Math.max(0,I);T[M]={name:typeof r=="string"?r:r.name||"",modifier:B};const Y=K(T);x&&x(t.id,{experience:Y})},onKeyDown:i=>{if(i.key==="ArrowUp"){i.preventDefault();const T=[...t.experience||[]],j=typeof r=="object"&&r.modifier||0;T[M]={name:typeof r=="string"?r:r.name||"",modifier:j+1};const I=K(T);x&&x(t.id,{experience:I})}else if(i.key==="ArrowDown"){i.preventDefault();const T=[...t.experience||[]],j=typeof r=="object"&&r.modifier||0;T[M]={name:typeof r=="string"?r:r.name||"",modifier:Math.max(0,j-1)};const I=K(T);x&&x(t.id,{experience:I})}},style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)",textAlign:"center",outline:"none"}})}),e.jsxs("div",{style:{marginLeft:"32px",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:typeof r=="string"?r:r.name||"",onChange:i=>{var Y;const T=[...t.experience||[]],j=typeof r=="object"&&r.modifier||0;T[M]={name:i.target.value,modifier:j};let I=K(T);const B=I[I.length-1];B&&(typeof B=="string"?B.trim():(Y=B.name)!=null&&Y.trim())&&I.push({name:"",modifier:0}),x&&x(t.id,{experience:I})},placeholder:"Experience name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsxs("div",{style:{display:"flex",gap:"0.125rem"},children:[e.jsx("button",{onClick:()=>{var B,Y;const i=[...t.experience||[]],T=typeof r=="string"?r.trim():(B=r.name)==null?void 0:B.trim(),j=i[M-1],I=typeof j=="string"?j.trim():(Y=j.name)==null?void 0:Y.trim();if(M>0&&M<i.length&&T&&I){i[M]=j,i[M-1]=r;const z=K(i);x&&x(t.id,{experience:z})}},disabled:M===0||!(typeof r=="string"?r.trim():(fe=r.name)!=null&&fe.trim())||!(typeof R[M-1]=="string"?R[M-1].trim():($=R[M-1].name)!=null&&$.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:M===0||!(typeof r=="string"?r.trim():(ee=r.name)!=null&&ee.trim())||!(typeof R[M-1]=="string"?R[M-1].trim():(u=R[M-1].name)!=null&&u.trim())?"var(--gray-800)":"var(--gray-700)",color:M===0||!(typeof r=="string"?r.trim():(E=r.name)!=null&&E.trim())||!(typeof R[M-1]=="string"?R[M-1].trim():(k=R[M-1].name)!=null&&k.trim())?"var(--text-secondary)":"white",cursor:M===0||!(typeof r=="string"?r.trim():(ae=r.name)!=null&&ae.trim())||!(typeof R[M-1]=="string"?R[M-1].trim():(te=R[M-1].name)!=null&&te.trim())?"not-allowed":"pointer",opacity:M===0||!(typeof r=="string"?r.trim():(Ce=r.name)!=null&&Ce.trim())||!(typeof R[M-1]=="string"?R[M-1].trim():(Se=R[M-1].name)!=null&&Se.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move up",children:"↑"}),e.jsx("button",{onClick:()=>{var B,Y;const i=[...t.experience||[]],T=typeof r=="string"?r.trim():(B=r.name)==null?void 0:B.trim(),j=i[M+1],I=typeof j=="string"?j.trim():(Y=j.name)==null?void 0:Y.trim();if(M<i.length-1&&M>=0&&T&&I){i[M]=j,i[M+1]=r;const z=K(i);x&&x(t.id,{experience:z})}},disabled:M===R.length-1||!(typeof r=="string"?r.trim():(we=r.name)!=null&&we.trim())||!(typeof R[M+1]=="string"?R[M+1].trim():(be=R[M+1].name)!=null&&be.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:M===R.length-1||!(typeof r=="string"?r.trim():(Me=r.name)!=null&&Me.trim())||!(typeof R[M+1]=="string"?R[M+1].trim():($e=R[M+1].name)!=null&&$e.trim())?"var(--gray-800)":"var(--gray-700)",color:M===R.length-1||!(typeof r=="string"?r.trim():(_e=r.name)!=null&&_e.trim())||!(typeof R[M+1]=="string"?R[M+1].trim():(qe=R[M+1].name)!=null&&qe.trim())?"var(--text-secondary)":"white",cursor:M===R.length-1||!(typeof r=="string"?r.trim():(Ze=r.name)!=null&&Ze.trim())||!(typeof R[M+1]=="string"?R[M+1].trim():(Ke=R[M+1].name)!=null&&Ke.trim())?"not-allowed":"pointer",opacity:M===R.length-1||!(typeof r=="string"?r.trim():(Qe=r.name)!=null&&Qe.trim())||!(typeof R[M+1]=="string"?R[M+1].trim():(Ye=R[M+1].name)!=null&&Ye.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move down",children:"↓"}),e.jsx("button",{onClick:()=>ie(r,M),disabled:!(typeof r=="string"?r.trim():(O=r.name)!=null&&O.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:A[J(r,M)]?"var(--danger)":(typeof r=="string"?r.trim():(de=r.name)!=null&&de.trim())?"var(--gray-700)":"var(--gray-800)",color:(typeof r=="string"?r.trim():(ke=r.name)!=null&&ke.trim())?"white":"var(--text-secondary)",cursor:(typeof r=="string"?r.trim():(Pe=r.name)!=null&&Pe.trim())?"pointer":"not-allowed",opacity:(typeof r=="string"?r.trim():(a=r.name)!=null&&a.trim())?1:.5,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:A[J(r,M)]?"Click again to confirm delete":"Delete experience",children:"×"})]})]})]},M)})})()}):e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:t.experience&&t.experience.length>0?t.experience.map((n,R)=>{if(typeof n=="string"){const r=n.match(/^(.+?)\s*([+-]?\d+)$/);if(r){const[,M,fe]=r;return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:fe})})}),e.jsx("span",{style:{marginLeft:"32px"},children:M})]},R)}else return e.jsx("div",{style:{marginBottom:"0.25rem"},children:n},R)}else return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:e.jsxs("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:[n.modifier>=0?"+":"",n.modifier]})})}),e.jsx("span",{style:{marginLeft:"32px"},children:n.name})]},R)}):null})})]}),(t.features&&t.features.length>0||S)&&e.jsxs("div",{style:{padding:"0 8px 8px 8px"},children:[(t.atk!==void 0&&t.weapon||S)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Standard Attack"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:S?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",marginTop:"0.75rem",marginBottom:"0.75rem"},children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[e.jsx("input",{type:"text",value:t.weapon||"",onChange:n=>x&&x(t.id,{weapon:n.target.value}),placeholder:"Standard attack name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}}),e.jsxs("select",{value:t.range||"",onChange:n=>x&&x(t.id,{range:n.target.value}),style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",appearance:"none",backgroundImage:`url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",backgroundSize:"1rem",paddingRight:"2rem"},children:[e.jsx("option",{value:""}),e.jsx("option",{value:"Melee",children:"Melee"}),e.jsx("option",{value:"Very Close",children:"Very Close"}),e.jsx("option",{value:"Close",children:"Close"}),e.jsx("option",{value:"Far",children:"Far"}),e.jsx("option",{value:"Very Far",children:"Very Far"})]}),e.jsx("input",{type:"text",value:t.damage||"",onChange:n=>x&&x(t.id,{damage:n.target.value}),placeholder:"Damage (e.g., 1d6+2)",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}})]})}):t.atk!==void 0&&t.weapon&&e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:t.weapon}),e.jsxs("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:["Make an attack against a target within ",t.range||"Melee"," range. On a success, deal ",t.damage||"damage varies","."]})]})})]}),(t.features.filter(n=>n.type==="Action").length>0||S)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Actions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const n=t.features.filter(r=>r.type==="Action");return(S&&n.length===0?[{type:"Action",name:"",description:""}]:n).map((r,M)=>S?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:r.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false","data-lpignore":"true","data-form-type":"other",name:`feature-name-${r.type.toLowerCase()}`,onChange:fe=>{const $=[...t.features||[]],ee=$.findIndex(k=>k.type==="Action"&&k===r);ee>=0?$[ee]={...$[ee],name:fe.target.value}:$.push({type:"Action",name:fe.target.value,description:r.description||""});const u=$.filter(k=>k.type==="Action"),E=u[u.length-1];E&&E.name.trim()&&$.push({type:"Action",name:"",description:""}),x&&x(t.id,{features:$})},placeholder:"Action name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:r.description||"",onChange:fe=>{const $=[...t.features||[]],ee=$.findIndex(k=>k.type==="Action"&&k===r);ee>=0?$[ee]={...$[ee],description:fe.target.value}:$.push({type:"Action",name:r.name||"",description:fe.target.value});const u=$.filter(k=>k.type==="Action"),E=u[u.length-1];E&&E.name.trim()&&$.push({type:"Action",name:"",description:""}),x&&x(t.id,{features:$})},onInput:fe=>{const $=fe.target.offsetHeight;fe.target.style.height="auto";const ee=fe.target.scrollHeight,u=ee>$?ee:$;fe.target.style.height=u+"px"},placeholder:"Action description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(bt,{feature:r,featureType:"Action",item:t,onUpdate:x,handleFeatureDeleteClick:Ae,deleteConfirmations:A,getFeatureKey:Q})]},M):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:r.name}),r.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:r.description})]},M))})()})]}),(t.features.filter(n=>n.type==="Passive").length>0||S)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Passives"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const n=t.features.filter(r=>r.type==="Passive");return(S&&n.length===0?[{type:"Passive",name:"",description:""}]:n).map((r,M)=>S?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:r.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:fe=>{const $=[...t.features||[]],ee=$.findIndex(k=>k.type==="Passive"&&k===r);ee>=0?$[ee]={...$[ee],name:fe.target.value}:$.push({type:"Passive",name:fe.target.value,description:r.description||""});const u=$.filter(k=>k.type==="Passive"),E=u[u.length-1];E&&E.name.trim()&&$.push({type:"Passive",name:"",description:""}),x&&x(t.id,{features:$})},placeholder:"Passive name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:r.description||"",onChange:fe=>{const $=[...t.features||[]],ee=$.findIndex(k=>k.type==="Passive"&&k===r);ee>=0?$[ee]={...$[ee],description:fe.target.value}:$.push({type:"Passive",name:r.name||"",description:fe.target.value});const u=$.filter(k=>k.type==="Passive"),E=u[u.length-1];E&&E.name.trim()&&$.push({type:"Passive",name:"",description:""}),x&&x(t.id,{features:$})},onInput:fe=>{const $=fe.target.offsetHeight;fe.target.style.height="auto";const ee=fe.target.scrollHeight,u=ee>$?ee:$;fe.target.style.height=u+"px"},placeholder:"Passive description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(bt,{feature:r,featureType:"Passive",item:t,onUpdate:x,handleFeatureDeleteClick:Ae,deleteConfirmations:A,getFeatureKey:Q})]},M):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:r.name}),r.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:r.description})]},M))})()})]}),(t.features.filter(n=>n.type==="Reaction").length>0||S)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Reactions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const n=t.features.filter(r=>r.type==="Reaction");return(S&&n.length===0?[{type:"Reaction",name:"",description:""}]:n).map((r,M)=>S?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:r.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:fe=>{const $=[...t.features||[]],ee=$.findIndex(k=>k.type==="Reaction"&&k===r);ee>=0?$[ee]={...$[ee],name:fe.target.value}:$.push({type:"Reaction",name:fe.target.value,description:r.description||""});const u=$.filter(k=>k.type==="Reaction"),E=u[u.length-1];E&&E.name.trim()&&$.push({type:"Reaction",name:"",description:""}),x&&x(t.id,{features:$})},placeholder:"Reaction name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:r.description||"",onChange:fe=>{const $=[...t.features||[]],ee=$.findIndex(k=>k.type==="Reaction"&&k===r);ee>=0?$[ee]={...$[ee],description:fe.target.value}:$.push({type:"Reaction",name:r.name||"",description:fe.target.value});const u=$.filter(k=>k.type==="Reaction"),E=u[u.length-1];E&&E.name.trim()&&$.push({type:"Reaction",name:"",description:""}),x&&x(t.id,{features:$})},onInput:fe=>{const $=fe.target.offsetHeight;fe.target.style.height="auto";const ee=fe.target.scrollHeight,u=ee>$?ee:$;fe.target.style.height=u+"px"},placeholder:"Reaction description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(bt,{feature:r,featureType:"Reaction",item:t,onUpdate:x,handleFeatureDeleteClick:Ae,deleteConfirmations:A,getFeatureKey:Q})]},M):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:r.name}),r.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:r.description})]},M))})()})]})]}),(D&&D.length>0||t.type!=="Minion"&&(t.thresholds||S))&&e.jsxs("div",{style:{padding:"0 8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Status"})]}),S?e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border)"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"number",value:t.hpMax||"",onChange:n=>{const R=parseInt(n.target.value)||1;x&&x(t.id,{hpMax:R})},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),e.jsx(it,{type:"adversaryHP",value:0,maxValue:t.hpMax||1,showTooltip:!1}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:"HP"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"number",value:t.stressMax||"",onChange:n=>{const R=parseInt(n.target.value)||1;x&&x(t.id,{stressMax:R})},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),e.jsx(it,{type:"adversaryStress",value:0,maxValue:t.stressMax||1,showTooltip:!1}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:"Stress"})]})]})})}):D&&D.length>0&&D.map((n,R)=>{const r=(n.hp||0)>=(n.hpMax||1);return e.jsx("div",{"data-instance-id":n.id,style:{marginBottom:"0.5rem"},children:e.jsxs("div",{style:{backgroundColor:r?"var(--gray-900)":"var(--bg-primary)",borderRadius:"6px",padding:"0.25rem 0.5rem",border:"1px solid",borderColor:r?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",display:"flex",justifyContent:"flex-start",alignItems:"center",gap:"0.5rem",opacity:r?.7:1,position:"relative",transition:"all 0.2s ease",minHeight:"40px"},children:[r&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                          45deg,
                          transparent 0px,
                          transparent 8px,
                          var(--gray-600) 9px,
                          var(--gray-600) 9px
                        )`,pointerEvents:"none",zIndex:1,borderRadius:"4px"}})}),e.jsx("div",{style:{backgroundColor:r?"var(--gray-900)":"var(--bg-card)",border:"1px solid",borderColor:r?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",borderRadius:"50%",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",flexShrink:0,opacity:r?.5:1},children:e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:r?"var(--gray-400)":"var(--text-primary)"},children:n.duplicateNumber||1})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.125rem"},children:[e.jsx("div",{style:{opacity:r?.3:1},children:e.jsx(it,{type:"adversaryHP",value:n.hp||0,maxValue:n.hpMax||1,onPipClick:(M,fe)=>{if(m&&s==="adversary"){const $=n.hp||0,ee=n.hpMax||1;fe?g&&g(n.id,1,$):$<ee&&m(n.id,1,$,ee)}},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})}),n.stressMax>0&&e.jsx("div",{style:{opacity:r?.3:1},children:e.jsx(it,{type:"adversaryStress",value:n.stress||0,maxValue:n.stressMax,onPipClick:(M,fe)=>{q&&s==="adversary"&&(fe?q(n.id,-1):q(n.id,1))},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})})]})]},n.id)},n.id)}),t.type!=="Minion"&&(t.thresholds||S)&&e.jsx("div",{style:{display:"flex",justifyContent:"center",paddingTop:"1px",marginTop:"0.5rem",marginBottom:"0.5rem"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",position:"relative"},children:e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",height:"36px"},children:[e.jsx("svg",{width:"300",height:"36",viewBox:"0 0 300 36",style:{position:"absolute",zIndex:1},children:e.jsx("rect",{x:"20",y:"6",width:"260",height:"24",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4"})}),e.jsx("div",{style:{position:"relative",zIndex:2,display:"flex",alignItems:"center",gap:"0.5rem"},children:S?e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",fontSize:"0.8rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),e.jsx("input",{type:"number",min:"1",max:"99",value:((ye=t.thresholds)==null?void 0:ye.major)||"",onChange:n=>{const R=n.target.value;(R===""||parseInt(R)>=1&&parseInt(R)<=99)&&x&&x(t.id,{thresholds:{...t.thresholds,major:R===""?null:parseInt(R)}})},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),e.jsx("input",{type:"number",min:"1",max:"99",value:((Ne=t.thresholds)==null?void 0:Ne.severe)||"",onChange:n=>{const R=n.target.value;(R===""||parseInt(R)>=1&&parseInt(R)<=99)&&x&&x(t.id,{thresholds:{...t.thresholds,severe:R===""?null:parseInt(R)}})},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),e.jsx(Pt,{value:((Le=t.thresholds)==null?void 0:Le.major)||7}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),e.jsx(Pt,{value:((Fe=t.thresholds)==null?void 0:Fe.severe)||14}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]})})]})})})]}),(S||p==="expanded"&&t.description&&t.description.trim())&&e.jsxs("div",{style:{padding:"0 8px",textAlign:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Description"})]}),S?e.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-primary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"none",overflow:"hidden",fontFamily:"inherit",marginTop:"0.75rem",marginBottom:"0.75rem"},value:t.description,onChange:n=>{n.target.style.height="auto",n.target.style.height=n.target.scrollHeight+"px",x&&x(t.id,{description:n.target.value})},placeholder:"Description..."}):e.jsx("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,whiteSpace:"pre-wrap",padding:"0.5rem 0"},children:t.description})]})]}),d()]})})};if(V&&(s==="adversary"||s==="adversaries")){const o=s==="adversary",S=o?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:W=>{var G;W.stopPropagation(),(G=oe.current)!=null&&G.handleSave&&oe.current.handleSave()},style:{background:"var(--purple)",border:"1px solid var(--purple)",color:"white",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:W=>{W.currentTarget.style.opacity="0.9"},onMouseLeave:W=>{W.currentTarget.style.opacity="1"},title:"Save",children:[e.jsx(zt,{size:16}),e.jsx("span",{children:"Save"})]}),le&&e.jsxs("button",{onClick:W=>{W.stopPropagation(),le()},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:W=>{W.currentTarget.style.backgroundColor="var(--bg-hover)",W.currentTarget.style.borderColor="var(--purple)"},onMouseLeave:W=>{W.currentTarget.style.backgroundColor="var(--bg-secondary)",W.currentTarget.style.borderColor="var(--border)"},title:"Cancel",children:[e.jsx(ot,{size:16}),e.jsx("span",{children:"Cancel"})]})]}):null;return e.jsx(It,{tabContent:S,containerStyle:{padding:0,height:"auto",maxHeight:o?"calc(100vh - 120px)":"calc(100vh - 68px)",minHeight:0},children:e.jsx(Tt,{ref:oe,editingAdversary:t,onSave:ue,onCancelEdit:le,isStockAdversary:ge,embedded:!0,hideEmbeddedButtons:!0,allAdversaries:N,autoFocus:!t.baseName||t.baseName.trim()===""||t.baseName==="Unknown"})})}const v=V?"edit":p;return(v==="expanded"||v==="edit")&&(s==="adversary"||s==="adversaries")?y():s==="adversary"||s==="adversaries"?null:e.jsxs("div",{className:je(),style:ve(!0),children:[e.jsxs("div",{style:He.rowMain,children:[e.jsx("h4",{style:He.rowTitle,children:Re()}),e.jsx("div",{style:He.rowMeta,children:De()})]}),e.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"12px",margin:0},children:["Expanded view coming soon for ",s]})]})},ht=xr,gr="/Daggerheart/assets/daggerheart-logo-fe7815ad.svg",yr=(t,s)=>{const[p,l]=c.useState("max-content"),C=c.useCallback(()=>{if(!s.current||t<=3)return"max-content";const m=s.current.offsetWidth,q=Math.floor(m/120);return q<=1?"max-content":t===4?"max-content max-content":t===5||t===6?q>=2?"max-content max-content":"max-content":t===7?q>=3?"max-content max-content max-content":q>=2?"max-content max-content":"max-content":"repeat(auto-fit, minmax(80px, max-content))"},[t,s]);return c.useEffect(()=>{const m=C();l(m);const g=new ResizeObserver(()=>{const q=C();l(q)});return s.current&&g.observe(s.current),()=>{g.disconnect()}},[C]),p},vr=({encounter:t})=>{var C,m;const s=c.useRef(null),p=((C=t.encounterItems)==null?void 0:C.length)||0,l=yr(p,s);return e.jsx("div",{ref:s,className:"saved-encounter-adversary-list",style:{flex:1,fontSize:"0.8rem",color:"var(--text-secondary)",lineHeight:"1.3",display:"grid",gridTemplateColumns:l,gap:"0.25rem 1rem",gridAutoRows:"min-content"},children:((m=t.encounterItems)==null?void 0:m.length)>0?t.encounterItems.map((g,q)=>{var N;const x=g.item.baseName||((N=g.item.name)==null?void 0:N.replace(/\s+\(\d+\)$/,""))||g.item.name;return e.jsxs("div",{style:{marginBottom:"0.125rem"},children:[g.quantity,"x ",x]},q)}):e.jsx("div",{children:"No adversaries"})})},dt={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},mt={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1,lowerTierAdversary:1};let nt={adversaries:[]},At={environments:[]},xt=!1;const br=()=>{const t=JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]"),s=JSON.parse(localStorage.getItem("daggerheart-custom-environments")||"[]");return{customAdversaries:t,customEnvironments:s}},St=async()=>{if(xt)return;let t={adversaries:[]},s={environments:[]},p={adversaries:[]},l={environments:[]};try{const g=await st(()=>import("./adversaries-9c8932de.js"),[]);t=(g==null?void 0:g.default)||g}catch(g){console.warn("Failed to load adversaries.json:",g)}try{const g=await st(()=>import("./environments-c340637c.js"),[]);s=(g==null?void 0:g.default)||g}catch(g){console.warn("Failed to load environments.json:",g)}try{const g=await st(()=>import("./playtest-adversaries-4a099c10.js"),[]);p=(g==null?void 0:g.default)||g}catch(g){console.warn("Failed to load playtest-adversaries.json:",g)}try{const g=await st(()=>import("./playtest-environments-d9cdffb6.js"),[]);l=(g==null?void 0:g.default)||g}catch(g){console.warn("Failed to load playtest-environments.json:",g)}const{customAdversaries:C,customEnvironments:m}=br();nt={...t,adversaries:[...t.adversaries||[],...p.adversaries||[],...C]},At={...s,environments:[...s.environments||[],...l.environments||[],...m]},xt=!0},Sr=(t,s=[],p=4,l=1,C=!1,m=null)=>{const[g,q]=c.useState(""),[x,N]=c.useState([{field:"tier",direction:"asc"},{field:"name",direction:"asc"}]),[F,h]=c.useState([]),[D,w]=c.useState(!0),[X,pe]=c.useState([]),[se,re]=c.useState([]),[V,ue]=c.useState(!1),[le,ge]=c.useState(!1),me=c.useRef(null),Te=c.useRef(null);c.useEffect(()=>{(async()=>{await St(),w(!1);let L=[];t==="adversary"?L=nt.adversaries||[]:t==="environment"&&(L=At.environments||[]),h(L)})()},[t]),c.useEffect(()=>{t==="adversary"&&m&&(async()=>{xt=!1,await St();let L=[];C?L=(nt.adversaries||[]).filter(ve=>{var je;return ve.source==="Homebrew"||((je=ve.id)==null?void 0:je.startsWith("custom-"))}):L=nt.adversaries||[],h(L)})()},[m,t,C]);const _=ie=>{const L=F.map(ve=>ve[ie]).filter(Boolean);return[...new Set(L)].sort((ve,je)=>typeof ve=="number"&&typeof je=="number"?ve-je:String(ve).localeCompare(String(je)))},P=c.useCallback(async()=>{xt=!1,await St();let ie=[];t==="adversary"?C?ie=(nt.adversaries||[]).filter(L=>{var ve;return L.source==="Homebrew"||((ve=L.id)==null?void 0:ve.startsWith("custom-"))}):ie=nt.adversaries||[]:t==="environment"&&(ie=At.environments||[]),h(ie)},[t,C]);c.useEffect(()=>{P()},[C,P]);const he=_("tier"),Ie=_("type"),oe=c.useMemo(()=>{let ie=F.filter(L=>{var d,y;const je=(L.name||L.baseName||"").toLowerCase().includes(g.toLowerCase())||((d=L.type)==null?void 0:d.toLowerCase().includes(g.toLowerCase()))||((y=L.description)==null?void 0:y.toLowerCase().includes(g.toLowerCase())),Re=X.length===0||(X.includes("party-tier")?L.tier===l:X.includes(L.tier.toString())),De=se.length===0||se.includes(L.type);return je&&Re&&De});return ie.sort((L,ve)=>{for(const je of x){const{field:Re,direction:De}=je;let d=L[Re],y=ve[Re];if(Re==="tier")d=parseInt(d)||0,y=parseInt(y)||0;else if(Re==="cost"){const v=f=>{if(t!=="adversary")return 0;const o=dt[f.type]||2;let S=0;const W=s.filter(U=>U.type==="adversary"&&U.item.type==="Solo"&&U.quantity>0).reduce((U,ye)=>U+ye.quantity,0),G=s.filter(U=>U.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(U.item.type)&&U.quantity>0).reduce((U,ye)=>U+ye.quantity,0);return f.type==="Solo"&&W===1&&(S+=2),["Bruiser","Horde","Leader","Solo"].includes(f.type)&&G===0&&(S+=1),o+S};d=v(L),y=v(ve)}else if(Re==="difficulty"){const v=parseInt(d),f=parseInt(y);!isNaN(v)&&!isNaN(f)?(d=v,y=f):!isNaN(v)&&isNaN(f)?(d=v,y=999):isNaN(v)&&!isNaN(f)?(d=999,y=f):(d=String(d||"").toLowerCase(),y=String(y||"").toLowerCase())}else typeof d=="string"&&typeof y=="string"?(d=d.toLowerCase(),y=y.toLowerCase()):(d=String(d||"").toLowerCase(),y=String(y||"").toLowerCase());if(De==="asc"){if(d>y)return 1;if(d<y)return-1}else{if(d<y)return 1;if(d>y)return-1}}return 0}),ie},[F,g,x,X,se,s,p,l]),A=ie=>{N(L=>{const ve=L.findIndex(je=>je.field===ie);if(ve>=0)if(ve===0){const je=[...L];return je[0]={...je[0],direction:je[0].direction==="asc"?"desc":"asc"},je}else{const je=[...L];return je.splice(ve,1)[0],[{field:ie,direction:"asc"},...je]}else return[{field:ie,direction:"asc"},...L]})},b=ie=>{pe(ie==="clear"?[]:ie==="party-tier"?["party-tier"]:L=>L.includes(ie)?L.filter(ve=>ve!==ie):[...L,ie])},Q=ie=>{re(ie==="clear"?[]:L=>L.includes(ie)?L.filter(ve=>ve!==ie):[...L,ie])},J=X.length>0,K=se.length>0;return c.useEffect(()=>{const ie=ve=>{const je=ve.target.closest(".filter-dropdown"),Re=ve.target.closest(".header-filter-icon");je||Re||(ue(!1),ge(!1))},L=ve=>{ve.key==="Escape"&&(ue(!1),ge(!1))};return document.addEventListener("pointerdown",ie,!0),document.addEventListener("mousedown",ie,!0),document.addEventListener("touchstart",ie,!0),document.addEventListener("click",ie,!0),document.addEventListener("keydown",L,!0),()=>{document.removeEventListener("pointerdown",ie,!0),document.removeEventListener("mousedown",ie,!0),document.removeEventListener("touchstart",ie,!0),document.removeEventListener("click",ie,!0),document.removeEventListener("keydown",L,!0)}},[ue,ge]),{searchTerm:g,setSearchTerm:q,sortFields:x,handleSort:A,filteredAndSortedData:oe,loading:D,refreshData:P,selectedTiers:X,selectedTypes:se,showTierDropdown:V,setShowTierDropdown:ue,showTypeDropdown:le,setShowTypeDropdown:ge,tierFilterRef:me,typeFilterRef:Te,uniqueTiers:he,uniqueTypes:Ie,handleTierSelect:b,handleTypeSelect:Q,isTierFiltered:J,isTypeFiltered:K,getDropdownStyle:ie=>{if(!ie.current)return{};const L=ie.current.getBoundingClientRect();return{position:"fixed",top:L.bottom+4,left:L.left-100,zIndex:99999}}}},Cr=({searchTerm:t,onSearchChange:s,type:p,partyControls:l,showCustomToggle:C=!1,onToggleCustom:m,filterCustom:g=!1,onExportCustomAdversaries:q,onImportCustomAdversaries:x,autoFocus:N=!1,onClose:F=null,placeholder:h="Search"})=>{const D=c.useRef(null);return c.useEffect(()=>{N&&D.current&&setTimeout(()=>{var w;(w=D.current)==null||w.focus()},100)},[N]),e.jsxs("div",{className:"browser-header",style:xe.browserHeader,children:[e.jsx("div",{style:{display:"flex",alignItems:"center",flex:1,gap:"0.5rem"},children:e.jsx("input",{ref:D,type:"text",placeholder:h,value:t,onChange:w=>s(w.target.value),style:{...xe.searchInput,flex:1,marginRight:0}})}),l&&e.jsx("div",{style:xe.partyControls,children:l})]})},wr=({showCustomToggle:t=!1,onToggleCustom:s,filterCustom:p=!1,onExportCustomAdversaries:l,onImportCustomAdversaries:C})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)",flexShrink:0},children:[t&&e.jsxs("button",{onClick:()=>s&&s(!p),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:p?"var(--purple)":"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:p?"white":"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:m=>{p||(m.target.style.backgroundColor="var(--bg-hover)",m.target.style.borderColor="var(--purple)")},onMouseLeave:m=>{p||(m.target.style.backgroundColor="var(--bg-primary)",m.target.style.borderColor="var(--border)")},children:[e.jsx("span",{children:p?"✓":"○"}),"Custom Only"]}),e.jsxs("button",{onClick:l,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:m=>{m.target.style.backgroundColor="var(--bg-hover)",m.target.style.borderColor="var(--purple)"},onMouseLeave:m=>{m.target.style.backgroundColor="var(--bg-primary)",m.target.style.borderColor="var(--border)"},children:[e.jsx("span",{children:"↓"}),"Export"]}),e.jsxs("button",{onClick:()=>document.getElementById("import-file-input").click(),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:m=>{m.target.style.backgroundColor="var(--bg-hover)",m.target.style.borderColor="var(--purple)"},onMouseLeave:m=>{m.target.style.backgroundColor="var(--bg-primary)",m.target.style.borderColor="var(--border)"},children:[e.jsx("span",{children:"↑"}),"Import"]}),e.jsx("input",{id:"import-file-input",type:"file",accept:".csv,.json",onChange:C,style:{display:"none"}})]}),jr=({sortFields:t,onSort:s,type:p,uniqueTiers:l,uniqueTypes:C,selectedTiers:m,selectedTypes:g,showTierDropdown:q,setShowTierDropdown:x,showTypeDropdown:N,setShowTypeDropdown:F,tierFilterRef:h,typeFilterRef:D,handleTierSelect:w,handleTypeSelect:X,isTierFiltered:pe,isTypeFiltered:se,getDropdownStyle:re,costFilter:V,showCostDropdown:ue,setShowCostDropdown:le,costFilterRef:ge,handleCostFilterSelect:me,isCostFiltered:Te})=>{const[_,P]=c.useState(null),Ie=(()=>p==="adversary"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"cost",label:"Cost",hasFilter:!0},{key:"difficulty",label:"Diff"}]:p==="environment"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"}]:[])(),oe=()=>{if(!ue)return null;const b=[{value:"all",label:"All"},{value:"auto-grey",label:"Auto Grey"},{value:"auto-hide",label:"Auto Hide"}];return jt.createPortal(e.jsx("div",{className:"filter-dropdown",style:{...xe.filterDropdown,...re(ge),maxHeight:"60vh",overflow:"auto"},onMouseDown:Q=>Q.stopPropagation(),onClick:Q=>Q.stopPropagation(),children:b.map(Q=>{const J=V===Q.value;return e.jsxs("div",{style:{...xe.filterOption,...J?xe.filterOptionSelected:{}},onClick:()=>me(Q.value),children:[e.jsx("span",{style:xe.checkIcon,children:J?e.jsx(ut,{size:16}):e.jsx(pt,{size:16})}),e.jsx("span",{style:xe.filterLabel,children:Q.label})]},Q.value)})}),document.body)},A=(b,Q,J,K,Ae,ie,L,ve)=>{if(!Ae)return null;const je=()=>{(b==="tier"||b==="type")&&K("clear")};return jt.createPortal(e.jsxs("div",{className:"filter-dropdown",style:{...xe.filterDropdown,...re(L),maxHeight:"60vh",overflow:"auto"},onMouseDown:Re=>Re.stopPropagation(),onClick:Re=>Re.stopPropagation(),children:[e.jsxs("div",{style:{...xe.filterOption,...J.length===0?xe.filterOptionSelected:{}},onClick:je,children:[e.jsx("span",{style:xe.checkIcon,children:J.length===0?e.jsx(ut,{size:16}):e.jsx(pt,{size:16})}),e.jsx("span",{style:xe.filterLabel,children:"All"})]}),b==="tier"&&e.jsxs("div",{style:{...xe.filterOption,...J.includes("party-tier")?xe.filterOptionSelected:{}},onClick:()=>K("party-tier"),children:[e.jsx("span",{style:xe.checkIcon,children:J.includes("party-tier")?e.jsx(ut,{size:16}):e.jsx(pt,{size:16})}),e.jsx("span",{style:xe.filterLabel,children:"Party Tier"})]}),Q.map(Re=>{const De=J.includes(Re.toString());return e.jsxs("div",{style:{...xe.filterOption,...De?xe.filterOptionSelected:{}},onClick:()=>K(Re.toString()),children:[e.jsx("span",{style:xe.checkIcon,children:De?e.jsx(ut,{size:16}):e.jsx(pt,{size:16})}),e.jsx("span",{style:xe.filterLabel,children:Re})]},Re)})]}),document.body)};return e.jsx("tr",{style:xe.tableHeader,children:Ie.map(b=>e.jsxs("th",{style:{...xe.tableHeaderCell,..._===b.key?xe.tableHeaderCellHover:{},position:"relative",...b.key==="name"?{width:"auto",minWidth:"0"}:{},...b.key==="tier"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...b.key==="type"?{width:"80px",minWidth:"80px",maxWidth:"80px"}:{},...b.key==="difficulty"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...b.key==="cost"?{width:"50px",minWidth:"50px",maxWidth:"50px"}:{}},onClick:()=>s(b.key),onMouseEnter:()=>P(b.key),onMouseLeave:()=>P(null),children:[b.hasFilter?e.jsxs("div",{style:xe.headerWithFilter,children:[e.jsx("span",{style:{cursor:"pointer"},onClick:Q=>{Q.stopPropagation(),s(b.key)},children:b.label}),e.jsxs("button",{ref:b.key==="tier"?h:b.key==="type"?D:ge,style:{...xe.headerFilterIcon,...b.key==="tier"&&pe?xe.headerFilterIconActive:{},...b.key==="type"&&se?xe.headerFilterIconActive:{},...b.key==="cost"&&Te?xe.headerFilterIconActive:{}},className:"header-filter-icon",onClick:Q=>{Q.stopPropagation(),b.key==="tier"?(x(!q),F(!1),le(!1)):b.key==="type"?(F(!N),x(!1),le(!1)):b.key==="cost"&&(le(!ue),x(!1),F(!1))},children:[e.jsx(tr,{size:14}),b.key==="tier"&&pe||b.key==="type"&&se||b.key==="cost"&&Te?e.jsx("span",{style:xe.filterActiveDot}):null]})]}):b.label,b.key==="tier"&&A("tier",l,m,w,q,x,h),b.key==="type"&&A("type",C,g,X,N,F,D),b.key==="cost"&&oe()]},b.key))})},kr=({item:t,onAdd:s,type:p,onRowClick:l,encounterItems:C=[],pcCount:m=4,playerTier:g=1,remainingBudget:q=0,costFilter:x="auto-grey",isFocused:N=!1,rowRef:F=null})=>{const[h,D]=c.useState(!1),w=()=>{s(t)},X=()=>{if(p!=="adversary")return null;const re=dt[t.type]||2;let V=0;const ue=C.filter(ge=>ge.type==="adversary"&&ge.item.type==="Solo"&&ge.quantity>0).reduce((ge,me)=>ge+me.quantity,0),le=C.filter(ge=>ge.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(ge.item.type)&&ge.quantity>0).reduce((ge,me)=>ge+me.quantity,0);return t.type==="Solo"&&ue===1&&(V+=2),["Bruiser","Horde","Leader","Solo"].includes(t.type)&&le===0&&(V+=1),re+V},se=(()=>{if(p==="adversary"){const re=X();dt[t.type];const V=re>q||q<=0;if(x==="auto-hide"&&V)return null;const ue=x==="auto-grey"&&V?{opacity:.5,color:"var(--text-secondary)"}:{};return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...xe.rowCell,width:"auto",minWidth:"0",textAlign:"left",...ue},children:e.jsxs("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:[e.jsx("div",{style:{fontWeight:"600"},children:t.name||t.baseName||""}),t.description&&e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"0.125rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.description})]})}),e.jsx("td",{style:{...xe.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...ue},children:t.tier}),e.jsx("td",{style:{...xe.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center",...ue},children:t.type}),e.jsx("td",{style:{...xe.rowCell,width:"50px",minWidth:"50px",maxWidth:"50px",textAlign:"center",...ue},children:re}),e.jsx("td",{style:{...xe.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...ue},children:t.difficulty})]})}else if(p==="environment")return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...xe.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:t.name||t.baseName||""}),e.jsx("td",{style:{...xe.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:t.tier}),e.jsx("td",{style:{...xe.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:t.type}),e.jsx("td",{style:{...xe.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:t.difficulty})]});return null})();return se===null?null:e.jsx(e.Fragment,{children:e.jsx("tr",{ref:F,style:{...xe.row,...h?xe.rowHover:{},...N?xe.rowFocused:{}},onClick:()=>{p==="adversary"?w():l&&l(t,p)},onMouseEnter:()=>D(!0),onMouseLeave:()=>D(!1),children:se})})},Vt=({type:t,onAddItem:s,onCancel:p=null,onRowClick:l,encounterItems:C=[],pcCount:m=4,playerTier:g=1,partyControls:q=null,showContainer:x=!0,savedEncounters:N=[],onLoadEncounter:F,onDeleteEncounter:h,activeTab:D="adversaries",selectedCustomAdversaryId:w,onSelectCustomAdversary:X,onTabChange:pe,selectedAdversary:se,onSelectAdversary:re,filterCustom:V=!1,showCustomToggle:ue=!1,onToggleCustom:le,onExportCustomAdversaries:ge,onImportCustomAdversaries:me,autoFocus:Te=!1,hideImportExport:_=!1,onClose:P=null,searchPlaceholder:he="Search"})=>{const{addCustomAdversary:Ie,updateCustomAdversary:oe,customContent:A}=Et(),[b,Q]=c.useState(null),[J,K]=c.useState("all"),[Ae,ie]=c.useState(!1),[L,ve]=c.useState({}),je=c.useRef({}),Re=c.useRef(null),[De,d]=c.useState(-1),[y,v]=c.useState(null),f=c.useRef({}),o=()=>{try{const O=A.adversaries||[];if(O.length===0){alert("No custom adversaries to export.");return}const de=["name","tier","type","difficulty","threshold_major","threshold_severe","hp_max","stress_max","atk","weapon","range","damage","description","motives"],ke=O.map(I=>{var B,Y;return[I.name||"",I.tier||"",I.type||"",I.difficulty||"",((B=I.thresholds)==null?void 0:B.major)||"",((Y=I.thresholds)==null?void 0:Y.severe)||"",I.hpMax||"",I.stressMax||"",I.atk||"",I.weapon||"",I.range||"",I.damage||"",I.description||"",I.motives||""]}),Pe=I=>{const B=String(I);return B.includes(",")||B.includes('"')||B.includes(`
`)?`"${B.replace(/"/g,'""')}"`:B},a=[de.join(","),...ke.map(I=>I.map(Pe).join(","))].join(`
`),i=new Blob([a],{type:"text/csv;charset=utf-8;"}),T=URL.createObjectURL(i),j=document.createElement("a");j.href=T,j.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(j),j.click(),document.body.removeChild(j),URL.revokeObjectURL(T),console.log(`Exported ${O.length} custom adversaries to CSV`)}catch(O){console.error("Failed to export custom adversaries:",O),alert("Failed to export custom adversaries. Please try again.")}},S=O=>{const de=O.target.files[0];if(!de)return;const ke=de.name.endsWith(".csv"),Pe=de.name.endsWith(".json");if(!ke&&!Pe){alert("Please upload a CSV or JSON file."),O.target.value="";return}const a=new FileReader;a.onload=i=>{try{let T=[];if(ke){const H=i.target.result.split(`
`).filter(ne=>ne.trim());if(H.length<2)throw new Error("CSV file is empty or invalid.");const Z=H[0].split(",").map(ne=>ne.trim().replace(/^"|"$/g,""));for(let ne=1;ne<H.length;ne++){const ce=[];let ze="",Ve=!1;for(let Be=0;Be<H[ne].length;Be++){const Ee=H[ne][Be],Ge=H[ne][Be+1];Ee==='"'&&Ve&&Ge==='"'?(ze+='"',Be++):Ee==='"'?Ve=!Ve:Ee===","&&!Ve?(ce.push(ze.trim()),ze=""):ze+=Ee}ce.push(ze.trim());const We={name:ce[Z.indexOf("name")]||"",tier:parseInt(ce[Z.indexOf("tier")])||1,type:ce[Z.indexOf("type")]||"Standard",difficulty:parseInt(ce[Z.indexOf("difficulty")])||11,thresholds:{major:parseInt(ce[Z.indexOf("threshold_major")])||7,severe:parseInt(ce[Z.indexOf("threshold_severe")])||12},hpMax:parseInt(ce[Z.indexOf("hp_max")])||3,stressMax:parseInt(ce[Z.indexOf("stress_max")])||1,atk:parseInt(ce[Z.indexOf("atk")])||1,weapon:ce[Z.indexOf("weapon")]||"",range:ce[Z.indexOf("range")]||"Melee",damage:ce[Z.indexOf("damage")]||"",description:ce[Z.indexOf("description")]||"",motives:ce[Z.indexOf("motives")]||"",source:"Homebrew"};We.name&&T.push(We)}}else if(Pe){const z=JSON.parse(i.target.result);if(!z.customAdversaries||!Array.isArray(z.customAdversaries))throw new Error("Invalid JSON format. Expected customAdversaries array.");T=z.customAdversaries}const j=A.adversaries||[],I=[...j];let B=0,Y=0;T.forEach(z=>{if(j.some(Z=>Z.name===z.name&&Z.source===z.source))Y++;else{const Z={...z,id:`custom-adv-${Date.now()}-${Math.random().toString(36).slice(2,10)}`,hp:0,stress:0};I.push(Z),B++}}),B>0?(localStorage.setItem("daggerheart-custom-adversaries",JSON.stringify(I)),window.location.reload(),alert(`Import successful! Added ${B} new adversaries${Y>0?`, skipped ${Y} duplicates`:""}.`)):alert("No new adversaries were added. All imported adversaries already exist.")}catch(T){console.error("Failed to import custom adversaries:",T),alert(`Failed to import custom adversaries: ${T.message}`)}},a.readAsText(de),O.target.value=""},W=()=>{Q(null)},G=async(O,de)=>{de?oe(de,O):Ie(O)},U=O=>{L[O]?(h&&h(O),ve(de=>{const ke={...de};return delete ke[O],ke}),je.current[O]&&(clearTimeout(je.current[O]),delete je.current[O])):(ve(de=>({...de,[O]:!0})),je.current[O]&&clearTimeout(je.current[O]),je.current[O]=setTimeout(()=>{ve(de=>{const ke={...de};return delete ke[O],ke}),delete je.current[O]},3e3))};c.useEffect(()=>()=>{Object.values(je.current).forEach(O=>{clearTimeout(O)})},[]);const{searchTerm:ye,setSearchTerm:Ne,sortFields:Le,handleSort:Fe,filteredAndSortedData:n,loading:R,selectedTiers:r,selectedTypes:M,showTierDropdown:fe,setShowTierDropdown:$,showTypeDropdown:ee,setShowTypeDropdown:u,tierFilterRef:E,typeFilterRef:k,uniqueTiers:ae,uniqueTypes:te,handleTierSelect:Ce,handleTypeSelect:Se,isTierFiltered:we,isTypeFiltered:be,getDropdownStyle:Me}=Sr(t,C,m,g,V,A),$e=c.useRef(ye),_e=c.useRef(JSON.stringify(r)),qe=c.useRef(JSON.stringify(M));c.useEffect(()=>{const O=$e.current!==ye,de=_e.current!==JSON.stringify(r),ke=qe.current!==JSON.stringify(M);(O||de||ke)&&(d(-1),v(null),$e.current=ye,_e.current=JSON.stringify(r),qe.current=JSON.stringify(M))},[ye,r,M]),c.useEffect(()=>{if(D!=="adversaries")return;const O=de=>{const ke=document.activeElement;if(ke&&["INPUT","TEXTAREA","SELECT"].includes(ke.tagName))if(de.key==="ArrowDown"||de.key==="ArrowUp"||de.key==="Enter")(de.key!=="Enter"||ke.tagName!=="INPUT")&&ke.blur();else return;const Pe=n.length-1;if(de.key==="ArrowDown")de.preventDefault(),d(a=>{var T;const i=a<Pe?a+1:a;return i>=0&&i<n.length&&(v(((T=n[i])==null?void 0:T.id)||null),f.current[i]&&setTimeout(()=>{var j;(j=f.current[i])==null||j.scrollIntoView({behavior:"smooth",block:"nearest"})},0)),i});else if(de.key==="ArrowUp")de.preventDefault(),d(a=>{var T;if(a<=0)return v(null),setTimeout(()=>{const j=document.querySelector('.browser-header input[type="text"]');j==null||j.focus()},0),-1;const i=a-1;return i>=0&&i<n.length?(v(((T=n[i])==null?void 0:T.id)||null),f.current[i]&&setTimeout(()=>{var j;(j=f.current[i])==null||j.scrollIntoView({behavior:"smooth",block:"nearest"})},0)):v(null),i});else if(de.key==="Enter"&&De>=0&&De<=Pe){de.preventDefault();const a=n[De];a&&s&&s(a)}};return document.addEventListener("keydown",O),()=>{document.removeEventListener("keydown",O)}},[D,n,De,s]);const Ke=(()=>{const O=3*m+2,de=C.reduce((B,Y)=>{if(Y.type==="adversary"){const z=dt[Y.item.type]||2;if(Y.item.type==="Minion"){const H=Math.ceil(Y.quantity/m);return B+H*z}else return B+Y.quantity*z}return B},0);let ke=0;C.filter(B=>B.type==="adversary"&&B.item.type==="Solo"&&B.quantity>0).reduce((B,Y)=>B+Y.quantity,0)>=2&&(ke+=mt.twoOrMoreSolos);const a=C.some(B=>B.type==="adversary"&&B.item.type==="Bruiser"&&B.quantity>0),i=C.some(B=>B.type==="adversary"&&B.item.type==="Horde"&&B.quantity>0),T=C.some(B=>B.type==="adversary"&&B.item.type==="Leader"&&B.quantity>0),j=C.some(B=>B.type==="adversary"&&B.item.type==="Solo"&&B.quantity>0);return!a&&!i&&!T&&!j&&(ke+=mt.noBruisersHordesLeadersSolos),O+ke-de})(),Qe=O=>{K(O),ie(!1)},Ye=J!=="all";return R?e.jsx("div",{style:xe.browser,children:e.jsx("div",{style:xe.loading,children:"Loading..."})}):e.jsx(e.Fragment,{children:e.jsxs("div",{style:x?xe.browserWrapper:xe.browserWrapperNoContainer,children:[D==="adversaries"&&e.jsxs(e.Fragment,{children:[e.jsx(Cr,{searchTerm:ye,onSearchChange:Ne,type:t,partyControls:q,autoFocus:Te,onClose:P,placeholder:he}),!_&&e.jsx(wr,{showCustomToggle:ue,onToggleCustom:le,filterCustom:V,onExportCustomAdversaries:o,onImportCustomAdversaries:S}),e.jsx("div",{className:"browser-content invisible-scrollbar",style:xe.browserContent,children:e.jsxs("table",{style:xe.browserTable,children:[e.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,backgroundColor:"var(--bg-primary)"},children:e.jsx(jr,{sortFields:Le,onSort:Fe,type:t,uniqueTiers:ae,uniqueTypes:te,selectedTiers:r,selectedTypes:M,showTierDropdown:fe,setShowTierDropdown:$,showTypeDropdown:ee,setShowTypeDropdown:u,tierFilterRef:E,typeFilterRef:k,handleTierSelect:Ce,handleTypeSelect:Se,isTierFiltered:we,isTypeFiltered:be,getDropdownStyle:Me,costFilter:J,showCostDropdown:Ae,setShowCostDropdown:ie,costFilterRef:Re,handleCostFilterSelect:Qe,isCostFiltered:Ye})}),e.jsx("tbody",{children:n.map((O,de)=>e.jsx(kr,{item:O,onAdd:s,type:t,onRowClick:l,encounterItems:C,pcCount:m,playerTier:g,remainingBudget:Ke,costFilter:J,isFocused:y===O.id||De===de,rowRef:ke=>{ke?f.current[de]=ke:delete f.current[de]}},O.id))})]})})]}),D==="encounters"&&e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:N.length===0?e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",textAlign:"center",padding:"2rem 1rem"},children:"No saved encounters yet"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:N.map(O=>e.jsxs("div",{onClick:()=>F&&F(O.id),className:"saved-encounter-card",style:{border:"1px solid var(--border)",borderRadius:"8px",padding:"8px",backgroundColor:"var(--bg-card)",transition:"background-color 0.2s ease",display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsxs("div",{style:{minWidth:"100px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",flexDirection:"column",justifyContent:"center",minHeight:"60px"},children:[e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Tier: ",(()=>{var Pe,a,i,T;const de=((T=(i=(a=(Pe=O.encounterItems)==null?void 0:Pe.filter(j=>j.type==="adversary"))==null?void 0:a.map(j=>j.item.tier))==null?void 0:i.filter(j=>j!=null))==null?void 0:T.sort((j,I)=>j-I))||[];if(de.length===0)return"N/A";if(de.length===1)return de[0];const ke=[...new Set(de)];return ke.length===1?ke[0]:`${Math.min(...ke)}-${Math.max(...ke)}`})()]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Party Size: ",O.partySize||4]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)"},children:["Balance: ",(()=>{const de=O.partySize||4,ke=3*de+2;let Pe=0;const a=O.encounterItems||[];a.filter(H=>H.type==="adversary"&&H.item.type==="Solo"&&H.quantity>0).reduce((H,Z)=>H+Z.quantity,0)>=2&&(Pe+=mt.twoOrMoreSolos);const T=a.some(H=>H.type==="adversary"&&H.item.type==="Bruiser"&&H.quantity>0),j=a.some(H=>H.type==="adversary"&&H.item.type==="Horde"&&H.quantity>0),I=a.some(H=>H.type==="adversary"&&H.item.type==="Leader"&&H.quantity>0),B=a.some(H=>H.type==="adversary"&&H.item.type==="Solo"&&H.quantity>0);!T&&!j&&!I&&!B&&(Pe+=mt.noBruisersHordesLeadersSolos);const Y=ke+Pe,z=a.reduce((H,Z)=>{if(Z.type==="adversary"){const ne=dt[Z.item.type]||2;if(Z.item.type==="Minion"){const ce=Math.ceil(Z.quantity/de);return H+ce*ne}else return H+Z.quantity*ne}return H},0);return z>Y?`+${z-Y}`:z===Y?"0":`-${Y-z}`})()]})]}),e.jsx("div",{style:{minWidth:"120px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",alignItems:"center",minHeight:"60px"},children:e.jsx("div",{style:{fontWeight:"500",color:"var(--text-primary)",fontSize:"0.9rem",wordWrap:"break-word",wordBreak:"break-word",width:"150px",maxWidth:"150px"},children:O.name})}),e.jsx(vr,{encounter:O}),e.jsx("button",{onClick:de=>{de.stopPropagation(),U(O.id)},style:{background:L[O.id]?"var(--danger)":"var(--gray-600)",border:"none",color:"white",padding:"0.4rem 0.8rem",borderRadius:"4px",fontSize:"0.75rem",cursor:"pointer",minWidth:"60px",transition:"background-color 0.2s"},children:"Delete"})]},O.id))})}),D==="create"&&e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"1rem",display:"flex",justifyContent:"center",alignItems:"flex-start",height:"100%",minHeight:0},children:e.jsx("div",{style:{maxWidth:"600px",width:"100%",height:"auto",display:"flex",flexDirection:"column",padding:"0",overflowY:"visible",overflowX:"hidden",minHeight:0},children:e.jsx(Tt,{onSave:G,onRefresh:()=>{},onAddItem:s,editingAdversary:b,onCancelEdit:W,embedded:!1})})}),D==="info"&&e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"2rem"},children:[e.jsxs("div",{style:{marginBottom:"2rem",textAlign:"center"},children:[e.jsx("img",{src:gr,alt:"Daggerheart Community Content Logo",style:{width:"100%",maxWidth:"300px",height:"auto",margin:"0 auto 1.5rem auto",display:"block"},onError:O=>{console.error("Failed to load Daggerheart logo:",O.target.src),O.target.style.display="none"}}),e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",textAlign:"left",maxWidth:"600px",margin:"0 auto"},children:[e.jsx("p",{style:{marginTop:0},children:"This product includes materials from the Daggerheart System Reference Document 1.0, © Critical Role, LLC, under the terms of the Darrington Press Community Gaming (DPCGL) License."}),e.jsxs("p",{children:["More information can be found at ",e.jsx("a",{href:"https://www.daggerheart.com",target:"_blank",rel:"noopener noreferrer",style:{color:"var(--purple)",textDecoration:"underline"},children:"daggerheart.com"})]}),e.jsx("p",{style:{marginBottom:0},children:e.jsx("em",{children:"This project is unofficial and not endorsed by Darrington Press or Critical Role."})})]})]}),e.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto",border:"1px solid var(--border)",borderRadius:"8px",overflow:"hidden"},children:[e.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"1rem 1.5rem",color:"var(--text-primary)",border:"none",background:"var(--bg-secondary)",width:"100%",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"0.875rem",borderBottom:"1px solid var(--border)"},onMouseEnter:O=>{O.target.style.backgroundColor="var(--bg-hover)"},onMouseLeave:O=>{O.target.style.backgroundColor="var(--bg-secondary)"},onClick:O=>{O.stopPropagation(),window.open("https://github.com/Splinter714/Daggerheart","_blank")},children:[e.jsx("span",{children:"View on GitHub"}),e.jsx("span",{children:"→"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem 1.5rem",color:"var(--text-secondary)",background:"var(--bg-secondary)",fontSize:"0.875rem"},children:["Version ","0.4.9 (6b4a2c2)"]})]})]})]})})},xe={browserWrapper:{display:"flex",flexDirection:"column",background:"var(--bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border)",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserWrapperNoContainer:{display:"flex",flexDirection:"column",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserContent:{flex:1,overflowY:"auto",overflowX:"visible",padding:0,width:"100%",scrollbarWidth:"none",msOverflowStyle:"none",borderRadius:"0 0 8px 8px"},tableHeaderContainer:{flexShrink:0,position:"sticky",top:0,zIndex:15,backgroundColor:"var(--bg-secondary)"},browserTable:{width:"100%",minWidth:"100%",borderCollapse:"collapse",tableLayout:"fixed",background:"var(--bg-primary)",margin:0},browserHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--gray-900)",flexShrink:0,position:"sticky",top:0,zIndex:20},browserTitle:{margin:0,color:"var(--text-primary)",fontSize:"18px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"24px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",marginRight:"12px",transition:"all 0.2s ease"},partyControls:{display:"flex",alignItems:"center",gap:"12px",flexShrink:0},searchInputFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 3px rgba(139, 92, 246, 0.1)"},tableHeader:{background:"var(--gray-900)",borderBottom:"1px solid var(--border)",boxShadow:"0 1px 0 var(--border)",position:"sticky",top:"0",zIndex:10},tableHeaderCell:{backgroundColor:"var(--gray-900)",fontWeight:"700",borderBottom:"1px solid var(--border)",cursor:"pointer",userSelect:"none",minWidth:"100px",whiteSpace:"nowrap",padding:"4px 4px",color:"var(--text-primary)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",boxShadow:"0 1px 0 var(--border)",transition:"background-color 0.2s",position:"sticky",top:"0",zIndex:10},tableHeaderCellHover:{backgroundColor:"var(--bg-hover)"},sortIndicator:{fontSize:"12px",color:"var(--text-secondary)"},tableBody:{flex:1,overflowY:"auto",padding:"8px",backgroundColor:"var(--bg-primary)"},row:{height:"35px",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s ease",cursor:"pointer",backgroundColor:"var(--gray-900)"},rowHover:{backgroundColor:"var(--bg-secondary)"},rowFocused:{backgroundColor:"var(--bg-secondary)",outline:"2px solid var(--purple)",outlineOffset:"-2px"},expandedRow:{backgroundColor:"var(--bg-secondary)"},rowCell:{padding:"4px 4px",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid var(--border)"},rowCellName:{fontWeight:"500",minWidth:"150px"},rowCellCenter:{textAlign:"center",justifyContent:"center",minWidth:"80px"},rowActions:{width:"80px",textAlign:"center",padding:"4px 8px",borderBottom:"1px solid var(--border)"},addButton:{width:"2rem",height:"2rem",border:"1px solid var(--purple)",borderRadius:"var(--radius-sm)",background:"var(--purple)",color:"white",cursor:"pointer",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"500"},expandedContent:{padding:"0",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)"},columnName:{width:"auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",paddingLeft:"8px",textAlign:"left"},columnTier:{width:"80px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnType:{width:"100px",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},columnDifficulty:{width:"40px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnAction:{width:"32px",minWidth:"24px",maxWidth:"24px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"visible",textOverflow:"unset"},loading:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"var(--text-primary)",fontSize:"16px"},mobileBrowser:{width:"95vw",height:"90vh",maxWidth:"none"},mobileSearchInput:{fontSize:"16px"},headerWithFilter:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0px",position:"relative"},headerFilterIcon:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"2px 4px",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",position:"relative",marginLeft:"-2px"},headerFilterIconActive:{color:"var(--purple)"},filterIcon:{fontSize:"12px"},filterActiveDot:{position:"absolute",left:"50%",top:"2px",transform:"translateX(-50%)",width:"4px",height:"4px",borderRadius:"50%",background:"var(--purple)",pointerEvents:"none"},filterDropdown:{position:"fixed",background:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",zIndex:99999,marginTop:"4px",overflow:"hidden",width:"max-content",minWidth:"120px",maxWidth:"200px"},filterOption:{padding:"8px 12px",cursor:"pointer",color:"var(--text-primary)",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background-color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},filterOptionSelected:{backgroundColor:"var(--bg-hover)"},checkIcon:{width:"16px",height:"16px",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"12px"},filterLabel:{flex:1}},Ir=()=>e.jsx("div",{className:"pwa-install-prompt",style:{}}),Ct=({side:t="left",children:s,className:p="",style:l={}})=>{const C=t==="left",m={flex:1,minWidth:0,background:"var(--bg-primary)",overflowY:"auto",overflowX:C?"auto":"hidden",display:C?"block":"flex",flexDirection:C?"initial":"column",height:"100%",padding:C?"8px 0 8px 0":"0 8px 0 0",...l};return e.jsx("div",{className:p,style:m,children:s})},Ar=t=>3*t+2,Er={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},wt={lessDifficult:-1,twoOrMoreSolos:-2,increasedDamage:-2,lowerTierAdversary:1,noBruisersHordesLeadersSolos:1,moreDangerous:2},Tr=({isOpen:t,onClose:s,onAddAdversary:p,onAddAdversariesBulk:l,onAddEnvironment:C,onDeleteAdversary:m,onDeleteEnvironment:g,onDeleteCountdown:q,adversaries:x=[],environments:N=[],countdowns:F=[],savedEncounters:h=[],onSaveEncounter:D,onLoadEncounter:w,onDeleteEncounter:X})=>{const{partySize:pe,updatePartySize:se,currentEncounterName:re,updateCurrentEncounterName:V,customContent:ue}=Et(),le=pe,ge=se,[me,Te]=c.useState({lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),[_,P]=c.useState([]),[he,Ie]=c.useState(re||"Encounter"),[oe,A]=c.useState("adversaries"),[b,Q]=c.useState(null),[J,K]=c.useState(null),[Ae,ie]=c.useState(null),[L,ve]=c.useState(null),[je,Re]=c.useState(!1);c.useEffect(()=>{t&&!b&&Ie(re||"Encounter")},[t,b,re]);const De=()=>J?he!==J.name||JSON.stringify(_)!==JSON.stringify(J.encounterItems)||le!==J.partySize||JSON.stringify(me)!==JSON.stringify(J.battlePointsAdjustments):!1,d=()=>{var u;if(_.length>0||(he||"").trim()!=="Encounter")return!0;if(b&&De()){if(J){const E=_.length,k=((u=J.encounterItems)==null?void 0:u.length)||0;if(E!==k||(he||"").trim()!==(J.name||""))return!0;const ae=JSON.stringify(me),te=JSON.stringify(J.battlePointsAdjustments||{});return ae!==te}return!0}return!1},y=({onClick:u,children:E,variant:k="secondary",isConfirmation:ae=!1})=>{const te=k==="danger"||k==="secondary"&&ae,Ce=k==="purple";return e.jsx("button",{onClick:u,style:{background:te?"var(--danger)":Ce?"var(--purple)":"var(--bg-secondary)",border:Ce?"none":"1px solid var(--border)",color:te||Ce?"white":"var(--text-primary)",padding:"0.375rem 0.75rem",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s",width:"70px",fontSize:"0.875rem"},children:E})},v=rt.useRef(le),f=c.useCallback(u=>!u||u.length===0?null:h.find(k=>{var Se,we;if(((Se=k.encounterItems)==null?void 0:Se.length)!==u.length)return!1;const ae=be=>{var Me;return{type:be.type,quantity:be.quantity,item:{name:be.item.baseName||((Me=be.item.name)==null?void 0:Me.replace(/\s+\(\d+\)$/,""))||be.item.name,type:be.item.type,tier:be.item.tier}}},te=(we=k.encounterItems)==null?void 0:we.map(ae).sort((be,Me)=>be.item.name.localeCompare(Me.item.name)||be.item.type.localeCompare(Me.item.type)),Ce=u.map(ae).sort((be,Me)=>be.item.name.localeCompare(Me.item.name)||be.item.type.localeCompare(Me.item.type));return JSON.stringify(te)===JSON.stringify(Ce)})||null,[h]);rt.useEffect(()=>{if(t&&x.length>0&&_.length===0){const u={};x.forEach(ae=>{var Ce;const te=ae.baseName||((Ce=ae.name)==null?void 0:Ce.replace(/\s+\(\d+\)$/,""))||ae.name;u[te]||(u[te]={type:"adversary",item:ae,quantity:0}),u[te].quantity+=1});const E=Object.values(u);P(E);const k=f(E);k&&!b&&(Q(k.id),K({name:k.name||"",encounterItems:k.encounterItems||[],partySize:k.partySize||4,battlePointsAdjustments:k.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),Ie(k.name||"Encounter"),V(k.name||"Encounter"))}else t&&x.length===0&&_.length===0&&P([])},[t,f,b,V]);const o=rt.useMemo(()=>{let u=0;_.filter(Se=>Se.type==="adversary"&&Se.item.type==="Solo"&&Se.quantity>0).reduce((Se,we)=>Se+we.quantity,0)>=2&&(u+=wt.twoOrMoreSolos);const k=_.some(Se=>Se.type==="adversary"&&Se.item.type==="Bruiser"&&Se.quantity>0),ae=_.some(Se=>Se.type==="adversary"&&Se.item.type==="Horde"&&Se.quantity>0),te=_.some(Se=>Se.type==="adversary"&&Se.item.type==="Leader"&&Se.quantity>0),Ce=_.some(Se=>Se.type==="adversary"&&Se.item.type==="Solo"&&Se.quantity>0);return!k&&!ae&&!te&&!Ce&&(u+=wt.noBruisersHordesLeadersSolos),u},[_]),S=Ar(le),W=Object.entries(me).filter(([u,E])=>E).reduce((u,[E,k])=>u+wt[E],0),G=S+W+o,U=_.reduce((u,E)=>{if(E.type==="adversary"){const k=Er[E.item.type]||2;return E.item.type==="Minion"?u+Math.ceil(E.quantity/le)*k:u+k*E.quantity}return u},0);rt.useEffect(()=>{const u=v.current;u!==le&&(P(E=>E.map(k=>{if(k.type==="adversary"&&k.item.type==="Minion"){const te=Math.ceil(k.quantity/u)*le;return{...k,quantity:te}}return k})),v.current=le)},[le]);const ye=(u,E)=>{const k=_.findIndex(Ce=>Ce.item.id===u.id&&Ce.type===E),ae=u.type==="Minion"?le:1;let te;k>=0?te=_.map((Ce,Se)=>Se===k?{...Ce,quantity:Ce.quantity+ae}:Ce):te=[..._,{item:u,type:E,quantity:ae}],P(te),Ne(te)},Ne=u=>{const E=x||[],k=[];u.forEach(we=>{for(let be=0;be<we.quantity;be++)we.type==="adversary"&&k.push(we.item)});const ae={};E.forEach(we=>{var Me;const be=we.baseName||((Me=we.name)==null?void 0:Me.replace(/\s+\(\d+\)$/,""))||we.name;ae[be]||(ae[be]=[]),ae[be].push(we)});const te={};k.forEach(we=>{var Me;const be=we.baseName||((Me=we.name)==null?void 0:Me.replace(/\s+\(\d+\)$/,""))||we.name;te[be]||(te[be]=[]),te[be].push(we)});const Ce=[],Se=[];Object.keys(te).forEach(we=>{var $e;const be=(($e=ae[we])==null?void 0:$e.length)||0,Me=te[we].length;if(Me>be){const _e=Me-be;for(let qe=0;qe<_e;qe++)Ce.push(te[we][0])}else if(Me<be){const _e=be-Me,Ze=[...ae[we]].sort((Ke,Qe)=>{const Ye=Ke.duplicateNumber||1;return(Qe.duplicateNumber||1)-Ye});for(let Ke=0;Ke<_e;Ke++)Se.push(Ze[Ke].id)}}),Object.keys(ae).forEach(we=>{te[we]||[...ae[we]].sort(($e,_e)=>{const qe=$e.duplicateNumber||1;return(_e.duplicateNumber||1)-qe}).forEach($e=>{Se.push($e.id)})}),Se.forEach(we=>{m(we)}),Ce.length>0&&l(Ce)},Le=(u,E)=>{const k=(()=>{const ae=_.findIndex(te=>te.item.id===u&&te.type===E);if(ae>=0){const te=_[ae];if(te.quantity===0)return _.filter((we,be)=>be!==ae);const Ce=te.item.type==="Minion"?le:1,Se=Math.max(0,te.quantity-Ce);return _.map((we,be)=>be===ae?{...we,quantity:Se}:we)}return _})();P(k),Ne(k)},Fe=c.useCallback(()=>{if(_.length===0)return null;const u=(he||"").trim()||"Encounter",E=h.find(k=>{var Ce,Se;if(k.name!==u||((Ce=k.encounterItems)==null?void 0:Ce.length)!==_.length)return!1;const ae=JSON.stringify((Se=k.encounterItems)==null?void 0:Se.sort()),te=JSON.stringify([..._].sort());return ae===te});return(E==null?void 0:E.id)||null},[h,he,_]),n=c.useCallback(()=>{let u=(he||"").trim(),E=b;if(E||(E=Fe()),_.length===0&&(!u||u==="Encounter")&&E){X(E),Q(null),K(null);return}const k={name:u,encounterItems:_,partySize:le,battlePointsAdjustments:me};if(E){k.id=E;const ae=D(k);Q(ae)}else{const ae=D(k);Q(ae)}K({name:u,encounterItems:_,partySize:le,battlePointsAdjustments:me})},[_,he,le,me,b,D,Fe,X]);c.useEffect(()=>{if(b&&De()){const u=setTimeout(()=>{n()},2e3);return()=>clearTimeout(u)}else if(!b&&_.length>0&&he&&he.trim()!==""){const u=setTimeout(()=>{n()},2e3);return()=>clearTimeout(u)}},[_,b,he,me,le]);const R=()=>{d()&&(P([]),Ie("Encounter"),V("Encounter"),Q(null),K(null),x.forEach(u=>{m(u.id)}),N.forEach(u=>{g(u.id)}),F.forEach(u=>{q(u.id)}))},r=u=>{const E=w(u);if(E){const k=E.encounterItems||[];P(k),ge(E.partySize||4),Te(E.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),Ie(E.name||""),V(E.name||""),Q(u),K({name:E.name||"",encounterItems:E.encounterItems||[],partySize:E.partySize||4,battlePointsAdjustments:E.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),Ne(k)}},M=u=>{X(u),b===u&&(P([]),Ie("Encounter"),V("Encounter"),Q(null),K(null),x.forEach(E=>{m(E.id)}),N.forEach(E=>{g(E.id)}),F.forEach(E=>{q(E.id)}))},fe=()=>{try{const u={version:"1.0",exportDate:new Date().toISOString(),customAdversaries:ue.adversaries||[]},E=JSON.stringify(u,null,2),k=new Blob([E],{type:"application/json"}),ae=URL.createObjectURL(k),te=document.createElement("a");te.href=ae,te.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(te),te.click(),document.body.removeChild(te),URL.revokeObjectURL(ae),console.log("Custom adversaries exported successfully")}catch(u){console.error("Failed to export custom adversaries:",u),alert("Failed to export custom adversaries. Please try again.")}},$=u=>{const E=u.target.files[0];if(!E)return;const k=new FileReader;k.onload=ae=>{try{const te=JSON.parse(ae.target.result);if(!te.customAdversaries||!Array.isArray(te.customAdversaries))throw new Error("Invalid file format. Expected customAdversaries array.");const Ce=ue.adversaries||[],Se=te.customAdversaries,we=[...Ce];let be=0;Se.forEach(Me=>{Ce.some(_e=>_e.name===Me.name&&_e.type===Me.type)||(we.push({...Me,id:`custom-${Date.now()}-${Math.random().toString(36).slice(2,10)}`}),be++)}),updateCustomContent("adversary",null,we),be>0?alert(`Successfully imported ${be} custom adversaries.`):alert("No new adversaries were added. All imported adversaries already exist.")}catch(te){console.error("Failed to import custom adversaries:",te),alert("Failed to import custom adversaries. Please check the file format and try again.")}},k.readAsText(E),u.target.value=""};if(!t)return null;const ee=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://");return e.jsx("div",{onClick:s,className:"encounter-builder-modal",style:{position:"fixed",top:0,left:0,right:0,bottom:ee?"calc(60px + env(safe-area-inset-bottom) + 1rem)":"calc(60px + env(safe-area-inset-bottom))",backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:1e3,display:"flex",alignItems:"flex-start",justifyContent:"center",padding:"12px"},children:e.jsxs("div",{onClick:u=>u.stopPropagation(),style:{backgroundColor:"var(--bg-primary)",border:"2px solid var(--border)",borderRadius:"12px",width:"100%",maxWidth:"1200px",height:"100%",maxHeight:"100%",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"},children:[e.jsxs("div",{className:"encounter-top-bar",style:{flex:"0 0 auto",display:"flex",alignItems:"center",height:"39px",backgroundColor:"var(--bg-primary)",borderBottom:"1px solid var(--border)"},children:[e.jsx("button",{onClick:()=>A("adversaries"),style:{flex:1,background:oe==="adversaries"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:oe==="adversaries"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Builder"}),e.jsx("button",{onClick:()=>A("encounters"),style:{flex:1,background:oe==="encounters"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:oe==="encounters"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Saved Encounters"}),e.jsx("button",{onClick:()=>A("create"),style:{flex:1,background:oe==="create"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:oe==="create"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Create Adversary"}),e.jsx("button",{onClick:()=>A("info"),style:{flex:1,background:oe==="info"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:oe==="info"?"500":"400",transition:"all 0.2s ease",position:"relative"},children:"Info"})]}),e.jsxs("div",{className:"encounter-builder-content",style:{flex:1,display:"flex",overflow:"hidden"},children:[e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",borderTop:"1px solid var(--border)"},children:e.jsx(Vt,{type:"adversary",onAddItem:u=>ye(u,"adversary"),encounterItems:_,pcCount:le,showContainer:!1,savedEncounters:h,onLoadEncounter:r,onDeleteEncounter:M,activeTab:oe,selectedCustomAdversaryId:Ae,onSelectCustomAdversary:ie,onTabChange:A,selectedAdversary:L,onSelectAdversary:ve,filterCustom:je,showCustomToggle:!0,onToggleCustom:Re,onExportCustomAdversaries:fe,onImportCustomAdversaries:$})}),oe!=="info"&&e.jsxs("div",{className:"encounter-right-panel",style:{flex:1,borderLeft:"1px solid var(--border)",display:"flex",flexDirection:"column",overflow:"hidden",position:"relative"},children:[L&&e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"var(--bg-primary)",zIndex:10,display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)",flexShrink:0},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:0},children:"Adversary Preview"}),e.jsx("button",{onClick:()=>ve(null),style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease"},onMouseEnter:u=>u.target.style.color="var(--text-primary)",onMouseLeave:u=>u.target.style.color="var(--text-secondary)",title:"Close preview",children:e.jsx(ot,{size:16})})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"0.75rem"},children:e.jsx(ht,{item:{...L,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...L,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}})})]}),(oe==="adversaries"||oe==="encounters")&&e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-primary)",flexShrink:0},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:he,onChange:u=>{Ie(u.target.value),V(u.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(y,{onClick:R,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:d()?1:.5,cursor:d()?"pointer":"not-allowed"},children:"New"})]})}),(oe==="adversaries"||oe==="encounters")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"encounter-receipt-buttons-vertical",style:{display:"none",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:he,onChange:u=>{Ie(u.target.value),V(u.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(y,{onClick:R,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:d()?1:.5,cursor:d()?"pointer":"not-allowed"},children:"New"})]})}),e.jsx("div",{className:"receipt-content",style:{padding:"1rem",display:"flex",flexDirection:"column",height:"100%"},children:e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"flex-start",overflowY:"auto",marginBottom:"0.75rem"},children:[e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>ge(Math.max(1,le-1)),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(ft,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:le}),e.jsx("button",{onClick:()=>ge(le+1),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(at,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Party Size"})}),e.jsx("div",{style:{width:"120px",textAlign:"right"}})]}),_.map(u=>{var E;return u.type!=="adversary"?null:e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>Le(u.item.id,u.type),style:{background:u.quantity===0?"var(--danger)":"var(--bg-secondary)",border:u.quantity===0?"none":"1px solid var(--border)",color:u.quantity===0?"white":"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:u.quantity===0?e.jsx(ot,{size:10}):e.jsx(ft,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:u.quantity}),e.jsx("button",{onClick:()=>ye(u.item,u.type),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(at,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:u.item.baseName||((E=u.item.name)==null?void 0:E.replace(/\s+\(\d+\)$/,""))||u.item.name})}),e.jsx("div",{style:{width:"80px",textAlign:"right"},children:e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.8rem"},children:u.item.type})})]},`${u.item.id}-${u.type}`)}),e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Balance"})}),e.jsx("div",{style:{width:"120px",textAlign:"right",display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsx("span",{style:{color:U>G?"var(--danger)":U===G?"var(--purple)":"var(--success)",fontWeight:600},children:U>G?`+${U-G}`:G-U===0?"0":`-${G-U}`})})]})]})})]}),oe==="create"&&e.jsxs("div",{style:{padding:"1.5rem",overflowY:"auto",height:"100%"},children:[e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Creating Adversaries"}),e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsx("p",{children:"Use the form to create custom adversaries for your encounters."}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Adversary Types:"}),e.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Minion (1 BP):"})," Weak enemies in groups"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Standard (2 BP):"})," Average threat level"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Leader (3 BP):"})," Commands others"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Bruiser (4 BP):"})," High HP tank"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Solo (5 BP):"})," Boss-level threat"]})]})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Tips:"}),e.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[e.jsx("li",{children:"Match adversary tier to party level"}),e.jsx("li",{children:"Balance encounter difficulty with Battle Points"}),e.jsx("li",{children:"Mix adversary types for variety"}),e.jsx("li",{children:"Add features that create interesting choices"})]})]})]})]}),oe==="myAdversaries"&&e.jsx("div",{style:{padding:"0.75rem",overflowY:"auto",height:"100%"},children:Ae?(()=>{var E;const u=(E=ue==null?void 0:ue.adversaries)==null?void 0:E.find(k=>k.id===Ae);return u?e.jsx(ht,{item:{...u,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...u,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}}):e.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Adversary not found"})})():e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Adversary Preview"}),e.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Select an adversary to view details"})]})})]})]})]})})},Mr=({browserOpenAtPosition:t,handleCloseBrowser:s,handleOpenBrowser:p,getEntityGroups:l,fear:C,updateFear:m})=>{const g=c.useRef(!1),q=c.useRef(null),x=c.useRef(null),N=c.useMemo(()=>({"shift+space":()=>{if(t!==null)s();else{const h=l();p(h.length)}},escape:()=>{t!==null&&s()},"+":()=>{const h=(C==null?void 0:C.value)||0,D=Math.min(12,h+1);m(D)},"=":()=>{const h=(C==null?void 0:C.value)||0,D=Math.min(12,h+1);m(D)},"-":()=>{const h=(C==null?void 0:C.value)||0,D=Math.max(0,h-1);m(D)},_:()=>{const h=(C==null?void 0:C.value)||0,D=Math.max(0,h-1);m(D)}}),[t,s,p,l,C,m]),F=c.useCallback(h=>{var le;if(window.matchMedia("(max-width: 800px)").matches)return;const w=h.key===" "||h.key==="Space"||h.code==="Space";if(h.shiftKey&&w&&!h.ctrlKey&&!h.metaKey&&!h.altKey){if(console.log("[Keyboard] Shift+Space detected, toggling browser"),h.preventDefault(),h.stopPropagation(),h.stopImmediatePropagation(),t!==null)s();else{const ge=l();p(ge.length)}return}const pe=document.activeElement;if(pe&&["INPUT","TEXTAREA","SELECT"].includes(pe.tagName)){const ge=h.key==="Escape",me=h.shiftKey&&w&&!h.ctrlKey&&!h.metaKey&&!h.altKey;if(!ge&&!me)return}const re=[];(h.ctrlKey||h.metaKey)&&re.push("ctrl"),h.shiftKey&&re.push("shift"),h.altKey&&re.push("alt");let V=h.key.toLowerCase();V===" "&&(V="space"),re.push(V);const ue=re.join("+");if(N[ue]){h.preventDefault(),N[ue](h);return}if(!h.ctrlKey&&!h.metaKey&&!h.shiftKey&&!h.altKey&&N[V]){h.preventDefault(),N[V](h);return}if(!h.ctrlKey&&!h.metaKey&&!h.shiftKey&&!h.altKey&&(h.key==="ArrowLeft"||h.key==="ArrowRight")&&t===null){const ge=document.activeElement;if(ge&&["INPUT","TEXTAREA","SELECT"].includes(ge.tagName))return;const me=document.querySelector(".dashboard-scroll-container");if(me){h.preventDefault(),console.log("[Keyboard] Dashboard scroll requested:",{key:h.key,currentScrollLeft:me.scrollLeft,containerWidth:me.clientWidth,scrollWidth:me.scrollWidth,scrollInProgress:g.current});const Te=Array.from(me.children).filter(_=>getComputedStyle(_).scrollSnapAlign!=="none");if(console.log("[Keyboard] Found panels:",{totalPanels:Te.length,panelDetails:Te.map((_,P)=>({index:P,offsetLeft:_.offsetLeft,offsetWidth:_.offsetWidth,scrollSnapAlign:getComputedStyle(_).scrollSnapAlign}))}),Te.length>0){const _=me.scrollLeft;let P=0,he=1/0;Te.forEach((A,b)=>{const Q=A.offsetLeft,J=Math.abs(Q-_);J<he&&(he=J,P=b)}),console.log("[Keyboard] Panel detection:",{currentScroll:_,currentPanelIndex:P,currentPanelOffsetLeft:(le=Te[P])==null?void 0:le.offsetLeft,minDistance:he,allPanels:Te.map((A,b)=>({index:b,offsetLeft:A.offsetLeft,distance:Math.abs(A.offsetLeft-_)}))});const Ie=h.key==="ArrowLeft"?-1:1,oe=P+Ie;if(console.log("[Keyboard] Scrolling decision:",{scrollDirection:Ie,currentPanelIndex:P,nextPanelIndex:oe,canScroll:oe>=0&&oe<Te.length}),oe>=0&&oe<Te.length){const A=Te[oe],b=A.offsetLeft;console.log("[Keyboard] Scrolling to panel:",{index:oe,offsetLeft:A.offsetLeft,offsetWidth:A.offsetWidth,targetScrollPosition:b,currentScroll:_,scrollInProgress:g.current}),q.current&&(clearTimeout(q.current),q.current=null),x.current=oe,g.current?(console.log("[Keyboard] Redirecting scroll to new target",{previousTarget:x.current,newTarget:oe,targetScrollPosition:b}),me.scrollTo({left:b,behavior:"smooth"})):(g.current=!0,A.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"})),q.current=setTimeout(()=>{if(x.current===oe){const Q=me.scrollLeft,J=A.offsetLeft,K=Math.abs(Q-J);K>.5&&(console.log("[Keyboard] Correcting misalignment:",{finalScroll:Q,expectedScroll:J,misalignment:K}),me.scrollTo({left:J,behavior:"auto"})),g.current=!1,x.current=null,console.log("[Keyboard] Scroll after action:",{newScrollLeft:me.scrollLeft,targetScrollPosition:b,difference:me.scrollLeft-_,actualDifference:me.scrollLeft-b,misalignment:K})}q.current=null},600)}else console.log("[Keyboard] Cannot scroll - panel index out of bounds")}else{console.log("[Keyboard] No panels found, using fallback scroll");const _=me.firstElementChild;if(_){const P=_.offsetWidth,he=h.key==="ArrowLeft"?-1:1;me.scrollBy({left:P*he,behavior:"smooth"})}}}else console.log("[Keyboard] Scroll container not found")}},[N,t,s,p,l]);c.useEffect(()=>(document.addEventListener("keydown",F,!0),()=>{document.removeEventListener("keydown",F,!0)}),[F])},Rr=t=>3*t+2,zr={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},Ht={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1};class Nr extends rt.Component{constructor(s){super(s),this.state={hasError:!1,error:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,p){console.error("ErrorBoundary caught an error:",s,p)}render(){var s;return this.state.hasError?e.jsxs("div",{className:"p-md text-red",children:[e.jsx("h3",{children:"Something went wrong:"}),e.jsx("pre",{children:(s=this.state.error)==null?void 0:s.toString()}),e.jsx("button",{className:"btn-base btn-text",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try again"})]}):this.props.children}}const Wr=()=>{const{adversaries:t,environments:s,countdowns:p,fear:l,savedEncounters:C,partySize:m,customContent:g,updatePartySize:q,updateFear:x,createAdversary:N,createAdversariesBulk:F,updateAdversary:h,deleteAdversary:D,addCustomAdversary:w,updateCustomAdversary:X,createEnvironment:pe,updateEnvironment:se,deleteEnvironment:re,createCountdown:V,updateCountdown:ue,deleteCountdown:le,advanceCountdown:ge,saveEncounter:me,loadEncounter:Te,deleteEncounter:_}=Et(),P=m||4,[he,Ie]=c.useState(!1),[oe,A]=c.useState(!1);c.useState(!1),c.useState(!1),c.useState(!0);const[b,Q]=c.useState(null),[J,K]=c.useState(null),[Ae,ie]=c.useState(null),[L,ve]=c.useState(!1),[je,Re]=c.useState("adversaries"),[De,d]=c.useState(null),[y,v]=c.useState(0),[f,o]=c.useState(0),[S,W]=c.useState(!1);c.useState(new Set);const[G,U]=c.useState(new Set),[ye,Ne]=c.useState(null),[Le,Fe]=c.useState(!1),n=c.useRef(null),R=c.useRef(P);c.useEffect(()=>{const a=R.current;if(a!==P&&a>0){const i={};t.forEach(T=>{var I;const j=T.baseName||((I=T.name)==null?void 0:I.replace(/\s+\(\d+\)$/,""))||T.name;i[j]||(i[j]={type:"adversary",baseName:j,instances:[]}),i[j].instances.push(T)}),Object.values(i).forEach(T=>{if(T.type==="adversary"&&T.instances.length>0){const j=T.instances[0];if(j.type==="Minion"){const I=T.instances.length,Y=Math.ceil(I/a)*P;if(Y!==I)if(Y>I){const z=Y-I,H=Array(z).fill(null).map(()=>({...j}));F(H)}else{const z=I-Y;T.instances.slice(-z).forEach(Z=>{D(Z.id)})}}}}),R.current=P}else(a===0||R.current===0)&&(R.current=P)},[P]),c.useEffect(()=>{const a=()=>{const T=window.matchMedia("(max-width: 800px)");Ie(T.matches)};a();const i=window.matchMedia("(max-width: 800px)");return i.addEventListener("change",a),()=>i.removeEventListener("change",a)},[]);const r=12,M=a=>a===1?200:350,fe=a=>{if(a<=0)return{visibleColumns:1,columnWidth:M(1)};const i=r*2;let T=a-i,j=0,I={visibleColumns:1,columnWidth:T};for(let B=0;B<5;B++){const Y=T-j;let z={visibleColumns:1,columnWidth:Y};for(let ne=1;ne<=5;ne++){const ce=(ne-1)*r,ze=(Y-ce)/ne;ze>=M(ne)&&ne*ze+ce<=Y&&(z={visibleColumns:ne,columnWidth:ze})}z.visibleColumns*z.columnWidth+(z.visibleColumns-1)*r>Y&&(z={visibleColumns:1,columnWidth:Y});const Z=z.columnWidth+r;if(Math.abs(Z-j)<.1)return z;j=Z,I=z}return I},{visibleColumns:$,columnWidth:ee}=fe(y);c.useEffect(()=>{const a=()=>{v(window.innerWidth)};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]);const u=c.useCallback(()=>{A(!1)},[]),E=c.useCallback(a=>{let i=!1;if(n.current){const T=n.current,j=T.scrollLeft,I=T.scrollWidth-T.clientWidth;i=Math.abs(j-I)<1,i&&(T._wasAtMaxScrollOnBrowserOpen=!0)}K(a)},[]);c.useEffect(()=>{J!==null&&n.current&&n.current._wasAtMaxScrollOnBrowserOpen&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(n.current){const T=n.current,j=T.scrollWidth-T.clientWidth;T.scrollLeft=j,T._wasAtMaxScrollOnBrowserOpen=!1}})})},[J,ee,r]);const k=c.useCallback(()=>{K(null),Re("adversaries")},[]),ae=c.useCallback((a,i=500,T="unknown")=>{if(console.log("[HORIZONTAL_SCROLL] smoothScrollTo called:",{targetScrollLeft:a,duration:i,reason:T,timestamp:performance.now()}),!n.current){console.log("[HORIZONTAL_SCROLL] No container ref, aborting");return}const j=n.current,I=j.scrollLeft,B=a-I;if(console.log("[HORIZONTAL_SCROLL] Scroll params:",{startScrollLeft:I,targetScrollLeft:a,distance:B,containerWidth:j.clientWidth,scrollWidth:j.scrollWidth}),Math.abs(B)<1){console.log("[HORIZONTAL_SCROLL] Distance too small, skipping animation");return}j._horizontalScrollAnimationId&&(console.log("[HORIZONTAL_SCROLL] Canceling existing animation"),cancelAnimationFrame(j._horizontalScrollAnimationId),j._horizontalScrollAnimationId=null);const z=window.getComputedStyle(j).scrollSnapType!=="none",H=z?"x mandatory":null;console.log("[HORIZONTAL_SCROLL] Scroll-snap state:",{hasScrollSnap:z,originalScrollSnapType:H}),z&&(j.style.scrollSnapType="none");const Z=performance.now();console.log("[HORIZONTAL_SCROLL] Starting animation at:",Z);const ne=ce=>{const ze=ce-Z,Ve=Math.min(ze/i,1),We=1-Ve,Be=1-We*We*We;if(j){const Ee=I+B*Be;j.scrollLeft=Ee}Ve<1?j._horizontalScrollAnimationId=requestAnimationFrame(ne):(console.log("[HORIZONTAL_SCROLL] Animation complete, final scrollLeft:",j.scrollLeft),j&&(j.scrollLeft=a,j._horizontalScrollAnimationId=null))};return j._horizontalScrollAnimationId=requestAnimationFrame(ne),()=>{animationId&&cancelAnimationFrame(animationId),z&&j&&(j.style.scrollSnapType=H||"")}},[]),te=c.useCallback(()=>{const a={};return t.forEach(i=>{var j;const T=i.baseName||((j=i.name)==null?void 0:j.replace(/\s+\(\d+\)$/,""))||i.name;a[T]||(a[T]={type:"adversary",baseName:T,instances:[]}),a[T].instances.push(i)}),p.forEach(i=>{a[`countdown-${i.id}`]={type:"countdown",baseName:i.name,instances:[i]}}),Object.values(a)},[t,p]),Ce=te();Mr({browserOpenAtPosition:J,handleCloseBrowser:k,handleOpenBrowser:E,getEntityGroups:te,fear:l,updateFear:x});const Se=c.useCallback(a=>{var ce,ze,Ve;const i=a.baseName||((ce=a.name)==null?void 0:ce.replace(/\s+\(\d+\)$/,""))||a.name,j=!Ce.find(We=>We.baseName===i&&We.type==="adversary"),I=a.type==="Minion",B=I?P:1,Y=performance.now(),z=((ze=n.current)==null?void 0:ze.scrollWidth)??0,H=((Ve=n.current)==null?void 0:Ve.scrollLeft)??0,Z=n.current;let ne=!1;if(Z&&j&&window.getComputedStyle(Z).scrollSnapType!=="none"&&(Z.style.scrollSnapType="none",ne=!0,console.log("[ADVERSARY_ADD] Disabled scroll-snap before adding adversary to prevent auto-scroll")),console.log("[ADVERSARY_ADD] handleAddAdversaryFromBrowser called:",{baseName:i,isNewAdversary:j,isMinion:I,instancesToAdd:B,timestamp:Y,currentScroll:H,scrollWidth:z,scrollSnapDisabled:ne}),I&&B>1){const We=Array(B).fill(null).map(()=>({...a}));F(We)}else N(a);if(Q("adversary"),j){const We=`adversary-${i}`;U(Be=>new Set(Be).add(We)),setTimeout(()=>{U(Be=>{const Ee=new Set(Be);return Ee.delete(We),Ee})},10)}setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!n.current)return;const We=n.current;if(!(We.scrollWidth<=We.clientWidth))if(j){const Be=We.scrollWidth;setTimeout(()=>{if(!n.current)return;const Ee=n.current;if(Ee.scrollWidth!==Be)requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!n.current)return;const Oe=n.current,Je=Oe.scrollWidth-Oe.clientWidth,Ue=Oe.scrollLeft,Xe=Je-H,ct=Oe.scrollWidth>z;console.log("[HORIZONTAL_SCROLL] New adversary added, scrollWidth stabilized:",{maxScroll:Je,scrollWidth:Oe.scrollWidth,clientWidth:Oe.clientWidth,scrollWidthBeforeAdd:z,scrollLeftBeforeAdd:H,currentScroll:Ue,scrollChanged:Ue!==H,scrollWidthIncreased:ct,distance:Xe}),ct&&Math.abs(Xe)<1?ae(Je+10,500,"new-adversary"):Math.abs(Xe)>1&&ae(Je,500,"new-adversary")})});else{const Oe=Ee.scrollWidth-Ee.clientWidth,Je=Ee.scrollLeft,Ue=Oe-H,Xe=Ee.scrollWidth>z;console.log("[HORIZONTAL_SCROLL] New adversary added, scrollWidth stable:",{maxScroll:Oe,scrollWidth:Ee.scrollWidth,clientWidth:Ee.clientWidth,scrollWidthBeforeAdd:z,scrollLeftBeforeAdd:H,currentScroll:Je,scrollChanged:Je!==H,scrollWidthIncreased:Xe,distance:Ue}),Xe&&Math.abs(Ue)<1?ae(Oe+10,500,"new-adversary"):Math.abs(Ue)>1&&ae(Oe,500,"new-adversary")}},10)}else{const Ee=te().findIndex(Ge=>Ge.baseName===i&&Ge.type==="adversary");if(Ee>=0){const Ge=n.current,Oe=Ge.scrollLeft,Je=Ge.clientWidth,Ue=J!==null?Je-(ee+r):Je,Xe=Ee*(ee+r),ct=Xe+ee+r,Mt=10;Xe>=Oe-Mt&&ct<=Oe+Ue+Mt||ae(Xe,500)}}})})},50)},[N,Ce,ee,r,ae,te,J]),we=c.useCallback(()=>{const i="Standard",T=lt(1,i),j={name:"",baseName:"",tier:1,type:i,description:"",motives:"",difficulty:T.difficulty,thresholds:T.thresholds,hpMax:T.hpMax,stressMax:T.stressMax,atk:T.atk,weapon:"",range:T.range,damage:T.damage,experience:[],features:[],source:"Homebrew",hp:0,stress:0,isVisible:!0};N(j),setTimeout(()=>{const I=te();for(const B of I)if(B.type==="adversary"){const Y=B.instances.find(z=>z.source==="Homebrew"&&(!z.baseName||z.baseName.trim()===""||z.baseName==="Unknown"));if(Y&&!Ae){ie(Y.id),requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(n.current){n.current;const z=I.findIndex(H=>H.instances.some(Z=>Z.id===Y.id));if(z>=0){const H=z*(ee+r);ae(H,600,"new-custom-adversary")}}})});break}}},100)},[N,te,ee,r,ae,Ae]),be=c.useCallback(a=>{ie(a),ve(!1)},[]),Me=c.useCallback(()=>{ie(null),ve(!1)},[]),$e=c.useCallback(async(a,i)=>{var T,j;if(i){const I=t.find(Y=>Y.id===i);if((I==null?void 0:I.source)==="Homebrew"||(I==null?void 0:I.isCustom)){const Y=I==null?void 0:I.customContentId,z=I==null?void 0:I.baseName,H=Y?(T=g==null?void 0:g.adversaries)==null?void 0:T.find(Z=>Z.id===Y):(j=g==null?void 0:g.adversaries)==null?void 0:j.find(Z=>Z.baseName===z&&(Z.source==="Homebrew"||Z.isCustom));if(H){const Z={...a,name:a.baseName||a.name};X(H.id,Z);const ne=a.baseName||(I==null?void 0:I.baseName);t.forEach(ce=>{(ce.customContentId===Y||ce.baseName===ne&&(ce.source==="Homebrew"||ce.isCustom))&&h(ce.id,{...a,customContentId:H.id})})}else{const Z={...a,name:a.baseName||a.name},ne=w(Z),ce=a.baseName||(I==null?void 0:I.baseName);t.forEach(ze=>{ze.baseName===ce&&(ze.source==="Homebrew"||ze.isCustom)&&h(ze.id,{...a,customContentId:ne})})}}else{const Y=I==null?void 0:I.baseName,z=t.filter(ne=>{const ce=ne.baseName===Y,ze=!ne.source||ne.source!=="Homebrew"&&!ne.isCustom;return ce&&ze});console.log("[SAVE_AS] Found stock instances to replace:",{originalBaseName:Y,stockInstancesCount:z.length,stockInstanceIds:z.map(ne=>ne.id)});const H={...a,name:a.baseName||a.name},Z=w(H);z.forEach(ne=>{console.log("[SAVE_AS] Deleting stock instance:",ne.id,ne.name),D(ne.id)}),setTimeout(()=>{const ne=z.map(()=>({...a,source:"Homebrew",isCustom:!0,customContentId:Z,hp:0,stress:0}));ne.length>0&&(console.log("[SAVE_AS] Creating",ne.length,"custom instances to replace stock ones"),F(ne))},0)}ie(null)}else if(Ae){const I={...a,name:a.baseName||a.name},B=w(I),Y=N({...a,source:"Homebrew",isCustom:!0,customContentId:B});return ie(null),Y}else{const I={...a,name:a.baseName||a.name},B=w(I),Y=N({...a,source:"Homebrew",isCustom:!0,customContentId:B});return ve(!1),Y}},[Ae,t,g,N,h,w,X]),qe=c.useCallback(()=>{const a={};return t.forEach(i=>{var j;const T=i.baseName||((j=i.name)==null?void 0:j.replace(/\s+\(\d+\)$/,""))||i.name;a[T]||(a[T]={type:"adversary",item:i,quantity:0}),a[T].quantity+=1}),Object.values(a)},[t])(),Ze=Rr(P),Ke=qe.filter(a=>a.item.type==="Solo"&&a.quantity>0).reduce((a,i)=>a+i.quantity,0),Qe=qe.some(a=>a.item.type&&["Bruiser","Horde","Leader","Solo"].includes(a.item.type)&&a.quantity>0);let Ye=0;Ke>=2&&(Ye+=Ht.twoOrMoreSolos),Qe||(Ye+=Ht.noBruisersHordesLeadersSolos);const O=Ze+Ye,de=qe.reduce((a,i)=>{if(i.type==="adversary"){const T=zr[i.item.type]||2;return i.item.type==="Minion"?a+Math.ceil(i.quantity/P)*T:a+T*i.quantity}return a},0),ke=c.useRef(null),Pe=c.useCallback(a=>{o(a.target.scrollLeft),ke.current&&clearTimeout(ke.current),ke.current=setTimeout(()=>{const i=a.target;i&&i.style.scrollSnapType==="none"&&(i.style.scrollSnapType="x mandatory")},150)},[]);return c.useCallback(()=>{W(!0)},[]),c.useCallback(()=>{setTimeout(()=>W(!1),100)},[]),Ce.length,e.jsxs("div",{className:"app",onClick:a=>{a.target,a.currentTarget},children:[e.jsx(dr,{position:"top",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",width:"100%",justifyContent:"space-between",padding:"0 1rem"},children:[e.jsx(it,{type:"fear",value:(l==null?void 0:l.value)||0,maxValue:12,onChange:x,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0}),e.jsx("button",{onClick:()=>{J!==null?k():E(Ce.length)},title:J!==null?"Close Browser":"Add Adversaries",style:{width:"36px",height:"36px",padding:0,backgroundColor:J!==null?"var(--purple)":"transparent",border:"1px solid var(--border)",borderRadius:"50%",color:J!==null?"white":"var(--text-primary)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",flexShrink:0},onMouseEnter:a=>{J===null&&(a.target.style.borderColor="var(--purple)",a.target.style.backgroundColor="var(--bg-secondary)")},onMouseLeave:a=>{J===null&&(a.target.style.borderColor="var(--border)",a.target.style.backgroundColor="transparent")},children:e.jsx(at,{size:18})})]})}),e.jsxs("div",{className:"main-content",style:{position:"relative",width:"100%"},children:[J!==null&&e.jsx("div",{style:{position:"absolute",top:`${r}px`,right:`${r}px`,bottom:`${r}px`,width:`${ee}px`,zIndex:100,overflow:"visible"},children:e.jsx(It,{tabContent:e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:we,style:{padding:"0.375rem 0.75rem",backgroundColor:"var(--purple)",border:"none",color:"white",borderRadius:"4px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",transition:"opacity 0.2s ease"},onMouseEnter:a=>{a.target.style.opacity="0.9"},onMouseLeave:a=>{a.target.style.opacity="1"},children:[e.jsx(at,{size:16}),e.jsx("span",{children:"Add Custom"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:"500"},children:"Party Size:"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",border:"1px solid var(--border)",borderRadius:"4px",padding:"0.125rem 0.25rem",backgroundColor:"var(--bg-secondary)"},children:[e.jsx("button",{onClick:()=>q(Math.max(1,P-1)),style:{background:"transparent",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:"0",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem"},onMouseEnter:a=>{a.target.style.color="var(--purple)"},onMouseLeave:a=>{a.target.style.color="var(--text-primary)"},children:e.jsx(ft,{size:12})}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:"500",minWidth:"1.5rem",textAlign:"center"},children:P}),e.jsx("button",{onClick:()=>q(P+1),style:{background:"transparent",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:"0",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem"},onMouseEnter:a=>{a.target.style.color="var(--purple)"},onMouseLeave:a=>{a.target.style.color="var(--text-primary)"},children:e.jsx(at,{size:12})})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:"500"},children:"Balance:"}),e.jsx("span",{style:{color:de>O?"var(--danger)":de===O?"var(--purple)":"var(--success)",fontWeight:600,fontSize:"0.875rem"},children:de>O?`+${de-O}`:O-de===0?"0":`-${O-de}`})]}),k&&e.jsx("button",{onClick:k,style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease",flexShrink:0},onMouseEnter:a=>a.target.style.color="var(--text-primary)",onMouseLeave:a=>a.target.style.color="var(--text-secondary)",title:"Close browser",children:e.jsx(ot,{size:16})})]}),showTab:!0,tabBackgroundColor:"var(--bg-primary)",tabBorderColor:"var(--border)",tabJustifyContent:"space-between",containerBackgroundColor:"var(--bg-primary)",containerBorderColor:"var(--border)",containerBorderRadius:"8px",containerBoxShadow:"-4px 0 12px rgba(0, 0, 0, 0.3)",containerOverflow:"hidden",reserveTabSpace:!0,containerStyle:{height:"100%"},children:e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,display:"flex",flexDirection:"column",width:"100%",minWidth:0},children:e.jsx(Vt,{type:"adversary",onAddItem:Se,showContainer:!1,activeTab:je,onTabChange:Re,pcCount:P,savedEncounters:C,onLoadEncounter:Te,onDeleteEncounter:_,selectedCustomAdversaryId:De,onSelectCustomAdversary:d,autoFocus:!0,hideImportExport:!0,onClose:k,searchPlaceholder:"Search adversaries"})})})}),e.jsxs("div",{ref:n,className:"dashboard-scroll-container",style:{display:"flex",flexDirection:"row",overflowX:"auto",overflowY:"hidden",padding:`0 ${r}px 0 0`,scrollSnapType:"x mandatory",height:"100%",width:"100%"},onScroll:Pe,children:[Ce.length===0?null:(()=>{const a=[];if(Ce.forEach((i,T)=>{var I,B,Y;if(ye&&ye.baseName===i.baseName&&i.type==="adversary"){a.push(e.jsx(Ct,{style:{width:Le?"0px":`${ee+r}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:Le?"0px":`${r}px`,paddingRight:"0",paddingTop:Le?"0px":`${r}px`,paddingBottom:Le?"0px":`${r}px`,scrollSnapAlign:"none",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"100%",opacity:0,transition:"width 0.3s ease, padding-left 0.3s ease, padding-top 0.3s ease, padding-bottom 0.3s ease"}},`spacer-${ye.baseName}`));return}a.push(e.jsx(Ct,{style:{width:`${ee+r}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:`${r}px`,paddingRight:"0",paddingTop:`${i.type==="adversary"?r+52:r}px`,paddingBottom:`${r}px`,scrollSnapAlign:"start",overflow:i.type==="adversary"?"visible":"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"auto",opacity:G.has(`${i.type}-${i.baseName}`)?0:1,transition:(G.has(`${i.type}-${i.baseName}`),"opacity 0.2s ease")},children:e.jsx(ht,{type:i.type,item:{...i.instances[0],name:((I=i.instances[0])==null?void 0:I.name)||i.baseName,hp:0,stress:0,isDead:!1},mode:"expanded",instances:i.instances,showCustomCreator:i.type==="adversary"&&Ae&&i.instances.some(z=>z.id===Ae),onSaveCustomAdversary:i.type==="adversary"&&Ae&&i.instances.some(z=>z.id===Ae)?$e:void 0,onCancelEdit:i.type==="adversary"&&Ae&&i.instances.some(z=>z.id===Ae)?Me:void 0,isStockAdversary:i.type==="adversary"&&Ae&&i.instances.some(z=>z.id===Ae)?!((B=i.instances[0])!=null&&B.source)||((Y=i.instances[0])==null?void 0:Y.source)!=="Homebrew":!1,onApplyDamage:i.type==="adversary"?(z,H,Z,ne)=>{const ce=i.instances.find(ze=>ze.id===z);ce&&h(z,{hp:Math.min(ce.hpMax||1,(ce.hp||0)+H)})}:void 0,onApplyHealing:i.type==="adversary"?(z,H,Z)=>{const ne=i.instances.find(ce=>ce.id===z);ne&&h(z,{hp:Math.max(0,(ne.hp||0)-H)})}:void 0,onApplyStressChange:i.type==="adversary"?(z,H)=>{var Z,ne;return h(z,{stress:Math.max(0,Math.min(((Z=i.instances.find(ce=>ce.id===z))==null?void 0:Z.stressMax)||6,(((ne=i.instances.find(ce=>ce.id===z))==null?void 0:ne.stress)||0)+H))})}:void 0,onUpdate:i.type==="adversary"?h:i.type==="environment"?se:ue,adversaries:t,showAddRemoveButtons:J!==null&&i.type==="adversary",onEdit:i.type==="adversary"?z=>be(z):void 0,onAddInstance:i.type==="adversary"?z=>{const H=z.type==="Minion",Z=H?P:1;if(H&&Z>1){const ne=Array(Z).fill(null).map(()=>({...z}));F(ne)}else N(z);setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(n.current){const ne=n.current,ce=ne.scrollLeft,ze=ne.clientWidth,Ve=J!==null?ze-(ee+r):ze,Be=te().findIndex(Ee=>Ee.baseName===i.baseName&&Ee.type==="adversary");if(Be>=0){const Ee=Be*(ee+r),Ge=Ee+ee+r,Oe=10;Ee>=ce-Oe&&Ge<=ce+Ve+Oe||ae(Ee,500)}}})})},50)}:void 0,onRemoveInstance:i.type==="adversary"?z=>{const H=i.instances[0],ne=(H==null?void 0:H.type)==="Minion"?P:1,ce=i.instances.sort((We,Be)=>{const Ee=We.duplicateNumber||1;return(Be.duplicateNumber||1)-Ee}),Ve=Math.max(0,ce.length-ne)===0;if(ce.length>0){const We=ce.slice(0,ne);if(Ve){const Be=Ce.findIndex(Ee=>Ee.baseName===i.baseName&&Ee.type==="adversary");Ne({baseName:i.baseName,groupIndex:Be}),Fe(!1),requestAnimationFrame(()=>{requestAnimationFrame(()=>{We.forEach(Ee=>{D(Ee.id)}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{Fe(!0),setTimeout(()=>{Ne(null),Fe(!1)},300)})})})})}else We.forEach(Be=>{D(Be.id)})}}:void 0})},`${i.type}-${i.baseName}`))}),ye&&!a.some(i=>(i==null?void 0:i.key)===`spacer-${ye.baseName}`)){const i=Math.min(ye.groupIndex,a.length);a.splice(i,0,e.jsx(Ct,{style:{width:Le?"0px":`${ee+r}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:Le?"0px":`${r}px`,paddingRight:"0",paddingTop:Le?"0px":`${r}px`,paddingBottom:Le?"0px":`${r}px`,scrollSnapAlign:"none",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"100%",opacity:0,transition:"width 0.3s ease, padding-left 0.3s ease, padding-top 0.3s ease, padding-bottom 0.3s ease"}},`spacer-${ye.baseName}`))}return a})(),J!==null&&e.jsx("div",{style:{width:`${ee+r}px`,flexShrink:0,flexGrow:0,flex:"none",height:"100%"}})]})]}),e.jsx(Tr,{isOpen:oe,onClose:u,onAddAdversary:a=>{N(a),Q("adversary")},onAddAdversariesBulk:a=>{F(a),Q("adversary")},onAddEnvironment:a=>{pe(a),Q("environment")},onDeleteAdversary:D,onDeleteEnvironment:re,onDeleteCountdown:le,adversaries:t,environments:s,countdowns:p,savedEncounters:C,onSaveEncounter:me,onLoadEncounter:Te,onDeleteEncounter:_}),e.jsx(Ir,{})]})},Lr=()=>e.jsx(Nr,{children:e.jsx(Wr,{})});kt.createRoot(document.getElementById("root")).render(e.jsx(rt.StrictMode,{children:e.jsx(lr,{children:e.jsx(Lr,{})})}));
