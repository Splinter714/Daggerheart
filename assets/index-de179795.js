import{r as b,a as Ne,R as ge}from"./dndkit-57209f9c.js";import{F as Ze,f as Ue,a as et,b as tt,c as De}from"./fa-b4bcccb0.js";import{D as _e,A as rt,C as nt,T as ot,S as st,M as at,X as Me,E as it,a as lt,H as dt,L as ct,b as pt,F as ut,c as be,d as je,e as He,P as Fe}from"./lucide-fbfda5ab.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const y of document.querySelectorAll('link[rel="modulepreload"]'))f(y);new MutationObserver(y=>{for(const x of y)if(x.type==="childList")for(const l of x.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&f(l)}).observe(document,{childList:!0,subtree:!0});function i(y){const x={};return y.integrity&&(x.integrity=y.integrity),y.referrerPolicy&&(x.referrerPolicy=y.referrerPolicy),y.crossOrigin==="use-credentials"?x.credentials="include":y.crossOrigin==="anonymous"?x.credentials="omit":x.credentials="same-origin",x}function f(y){if(y.ep)return;y.ep=!0;const x=i(y);fetch(y.href,x)}})();var Ve={exports:{}},Ae={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xt=b,mt=Symbol.for("react.element"),ht=Symbol.for("react.fragment"),ft=Object.prototype.hasOwnProperty,gt=xt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,yt={key:!0,ref:!0,__self:!0,__source:!0};function Ge(t,s,i){var f,y={},x=null,l=null;i!==void 0&&(x=""+i),s.key!==void 0&&(x=""+s.key),s.ref!==void 0&&(l=s.ref);for(f in s)ft.call(s,f)&&!yt.hasOwnProperty(f)&&(y[f]=s[f]);if(t&&t.defaultProps)for(f in s=t.defaultProps,s)y[f]===void 0&&(y[f]=s[f]);return{$$typeof:mt,type:t,key:x,ref:l,props:y,_owner:gt.current}}Ae.Fragment=ht;Ae.jsx=Ge;Ae.jsxs=Ge;Ve.exports=Ae;var e=Ve.exports,Be={},Oe=Ne;Be.createRoot=Oe.createRoot,Be.hydrateRoot=Oe.hydrateRoot;function me(t){const s=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return t?`${t}-${s}`:s}const Ye=b.createContext();function ze(t){if(typeof localStorage>"u")return null;try{const s=localStorage.getItem(t);return s==null?null:JSON.parse(s)}catch{return null}}function fe(t,s){if(!(typeof localStorage>"u"))try{localStorage.setItem(t,JSON.stringify(s))}catch{}}const vt=({children:t})=>{const[s,i]=b.useState({fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],currentEncounterName:"Encounter"}),[f,y]=b.useState(!1),[x,l]=b.useState({adversaries:[],environments:[]});b.useEffect(()=>{var r,u,S,F;const o=ze("daggerheart-game-state");if(o)try{(((r=o.adversaries)==null?void 0:r.length)>0||((u=o.environments)==null?void 0:u.length)>0||((S=o.countdowns)==null?void 0:S.length)>0||((F=o.savedEncounters)==null?void 0:F.length)>0)&&i(o)}catch(de){console.error("Failed to load saved state:",de)}const n=ze("daggerheart-custom-adversaries")||[],a=ze("daggerheart-custom-environments")||[];l({adversaries:n,environments:a}),y(!0)},[]),b.useEffect(()=>{fe("daggerheart-game-state",s)},[s]);const A=o=>{i(n=>({...n,fear:{...n.fear,value:o}}))},c=()=>{i(o=>({...o,fear:{...o.fear,visible:!o.fear.visible}}))},k=o=>{i(n=>({...n,partySize:Math.max(1,o)}))},I=o=>{i(n=>({...n,currentEncounterName:o||"Encounter"}))},P=o=>{if(o.id)return i(n=>({...n,savedEncounters:(n.savedEncounters||[]).map(a=>a.id===o.id?{...a,name:o.name||a.name,encounterItems:o.encounterItems||a.encounterItems,partySize:o.partySize||a.partySize,battlePointsAdjustments:o.battlePointsAdjustments||a.battlePointsAdjustments,updatedAt:new Date().toISOString()}:a)})),o.id;{const n={id:me("encounter"),name:o.name||"Encounter",createdAt:new Date().toISOString(),encounterItems:o.encounterItems||[],partySize:o.partySize||4,battlePointsAdjustments:o.battlePointsAdjustments||{}};return i(a=>({...a,savedEncounters:[...a.savedEncounters||[],n]})),n.id}},Y=o=>(s.savedEncounters||[]).find(a=>a.id===o),v=o=>{const n={id:me("encounter"),name:o.name||`Encounter ${Date.now()}`,createdAt:new Date().toISOString(),encounterItems:o.encounterItems||[],partySize:o.partySize||4,battlePointsAdjustments:o.battlePointsAdjustments||{}};return i(a=>({...a,savedEncounters:[...a.savedEncounters||[],n]})),n.id},R=o=>{i(n=>({...n,savedEncounters:(n.savedEncounters||[]).filter(a=>a.id!==o)}))},G=b.useRef(s);b.useEffect(()=>{G.current=s},[s]);const J={gameState:s,isLoaded:f,customContent:x,updateFear:A,toggleFearVisibility:c,updatePartySize:k,updateCurrentEncounterName:I,saveEncounter:P,saveEncounterAs:v,loadEncounter:Y,deleteEncounter:R,createCountdown:o=>{const n={id:me("countdown"),name:o.name||"Countdown",max:parseInt(o.max)||1,value:0,visible:!0,type:o.type||"standard",loop:o.loop||"none",source:o.source||"campaign"};i(a=>({...a,countdowns:[...a.countdowns,n]}))},updateCountdown:(o,n)=>{i(a=>({...a,countdowns:a.countdowns.map(r=>r.id===o?{...r,...n}:r)}))},deleteCountdown:o=>{i(n=>({...n,countdowns:n.countdowns.filter(a=>a.id!==o)}))},advanceCountdown:(o,n)=>{i(a=>({...a,countdowns:a.countdowns.map(r=>{if(r.id!==o)return r;let u=n;if(r.loop==="loop")u>r.max?u=(u-1)%r.max+1:u<0&&(u=r.max);else if(r.loop==="increasing"){if(u>r.max)return{...r,max:r.max+1,value:1};if(u<0)return{...r,max:Math.max(1,r.max-1),value:1};u=Math.max(0,u)}else if(r.loop==="decreasing"){if(u>r.max)return{...r,max:Math.max(1,r.max-1),value:1};if(u<0)return{...r,max:r.max+1,value:1};u=Math.min(r.max,u)}else u=Math.max(0,Math.min(u,r.max));return{...r,value:u}})}))},incrementCountdown:(o,n=1)=>{i(a=>({...a,countdowns:a.countdowns.map(r=>{if(r.id!==o)return r;let u=r.value+n;if(r.loop==="loop")u>r.max&&(u=(u-1)%r.max+1);else if(r.loop==="increasing"){if(u>r.max)return{...r,max:r.max+1,value:1}}else if(r.loop==="decreasing"){if(u>r.max)return{...r,max:Math.max(1,r.max-1),value:1}}else u=Math.min(u,r.max);return{...r,value:u}})}))},decrementCountdown:o=>{i(n=>({...n,countdowns:n.countdowns.map(a=>{if(a.id!==o)return a;let r=a.value-1;if(a.loop==="loop")r<0&&(r=a.max);else if(a.loop==="increasing"){if(r<0)return{...a,max:Math.max(1,a.max-1),value:a.max};r=Math.max(0,r)}else if(a.loop==="decreasing"){if(r<0)return{...a,max:a.max+1,value:1}}else r=Math.max(0,r);return{...a,value:r}})}))},reorderCountdowns:o=>{i(n=>{const[a,r]=o,u=[...n.countdowns],[S]=u.splice(a,1);return u.splice(r,0,S),{...n,countdowns:u}})},createAdversary:o=>{var de;const n=me("adv"),a=s.adversaries||[],r=o.baseName||((de=o.name)==null?void 0:de.replace(/\s+\(\d+\)$/,""))||o.name||"Unknown",u=a.filter(re=>re.baseName===r);let S=1;if(u.length===0)S=1;else{const re=u.map(d=>d.duplicateNumber||1);let W=1;for(;re.includes(W);)W++;S=W}const F={...o,id:n,baseName:r,duplicateNumber:S,name:`${r} (${S})`,hp:0,stress:0,isVisible:!0};i(re=>({...re,adversaries:[...re.adversaries,F]}))},createAdversariesBulk:o=>{const n=[],a={};o.forEach(r=>{var C;const u=r.baseName||((C=r.name)==null?void 0:C.replace(/\s+\(\d+\)$/,""))||r.name||"Unknown",de=(s.adversaries||[]).filter(M=>M.baseName===u).length,re=a[u]||0,W=de+re+1;a[u]=re+1;const d={...r,id:me("adv"),baseName:u,duplicateNumber:W,name:`${u} (${W})`,hp:0,stress:0,isVisible:!0};n.push(d)}),i(r=>({...r,adversaries:[...r.adversaries,...n]}))},updateAdversary:(o,n)=>{i(a=>({...a,adversaries:a.adversaries.map(r=>{if(r.id===o){const u={...r,...n};if(n.baseName!==void 0){const S=n.baseName,F=u.duplicateNumber||1;u.name=F===1?S:`${S} (${F})`}return u}return r})}))},deleteAdversary:o=>{i(n=>({...n,adversaries:n.adversaries.filter(a=>a.id!==o)}))},clearAllAdversaries:()=>{i(o=>({...o,adversaries:[]}))},reorderAdversaries:o=>{i(n=>{const[a,r]=o,u=[...n.adversaries],[S]=u.splice(a,1);return u.splice(r,0,S),{...n,adversaries:u}})},bulkReorderAdversaries:o=>{i(n=>({...n,adversaries:o}))},createEnvironment:o=>{const n=me("env"),r=(s.environments||[]).filter(F=>F.name.replace(/\s+\(\d+\)$/,"")===o.name);let u=o.name||"Unknown";if(r.length===0)u=o.name;else if(r.length===1){const F=r[0],de=F.name.replace(/\s+\(\d+\)$/,""),re=s.environments.map(W=>W.id===F.id?{...W,name:`${de} (1)`}:W);i(W=>({...W,environments:re})),u=`${o.name} (2)`}else{const F=r.map(re=>{const W=re.name.match(/\((\d+)\)$/);return W?parseInt(W[1]):null}).filter(re=>re!==null);let de=1;for(;F.includes(de);)de++;u=`${o.name} (${de})`}const S={...o,id:n,name:u,isVisible:!0};i(F=>({...F,environments:[...F.environments,S]}))},updateEnvironment:(o,n)=>{i(a=>({...a,environments:a.environments.map(r=>r.id===o?{...r,...n}:r)}))},deleteEnvironment:o=>{i(n=>({...n,environments:n.environments.filter(a=>a.id!==o)}))},reorderEnvironments:o=>{i(n=>{const[a,r]=o,u=[...n.environments],[S]=u.splice(a,1);return u.splice(r,0,S),{...n,environments:u}})},addCustomAdversary:o=>{const n={...o,id:me("custom-adv"),source:o.source||"Homebrew",isCustom:!0};return l(a=>({...a,adversaries:[...a.adversaries,n]})),fe("daggerheart-custom-adversaries",[...x.adversaries,n]),n.id},addCustomEnvironment:o=>{const n={...o,id:me("custom-env"),source:o.source||"Homebrew",isCustom:!0};return l(a=>({...a,environments:[...a.environments,n]})),fe("daggerheart-custom-environments",[...x.environments,n]),n.id},updateCustomAdversary:(o,n)=>{l(r=>({...r,adversaries:r.adversaries.map(u=>u.id===o?{...u,...n}:u)}));const a=x.adversaries.map(r=>r.id===o?{...r,...n}:r);fe("daggerheart-custom-adversaries",a)},updateCustomEnvironment:(o,n)=>{l(r=>({...r,environments:r.environments.map(u=>u.id===o?{...u,...n}:u)}));const a=x.environments.map(r=>r.id===o?{...r,...n}:r);fe("daggerheart-custom-environments",a)},deleteCustomAdversary:o=>{l(a=>({...a,adversaries:a.adversaries.filter(r=>r.id!==o)}));const n=x.adversaries.filter(a=>a.id!==o);fe("daggerheart-custom-adversaries",n)},deleteCustomEnvironment:o=>{l(a=>({...a,environments:a.environments.filter(r=>r.id!==o)}));const n=x.environments.filter(a=>a.id!==o);fe("daggerheart-custom-environments",n)}};return e.jsx(Ye.Provider,{value:J,children:t})},Je=()=>{const t=b.useContext(Ye);if(!t)return console.warn("useGameState: Context not available yet, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{gameState:s,customContent:i,...f}=t;if(!s)return console.warn("useGameState: gameState not available, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],customContent:{adversaries:[],environments:[]},updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},addCustomAdversary:()=>{},addCustomEnvironment:()=>{},updateCustomAdversary:()=>{},updateCustomEnvironment:()=>{},deleteCustomAdversary:()=>{},deleteCustomEnvironment:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{fear:y,countdowns:x,adversaries:l,environments:A,partySize:c,savedEncounters:k}=s;return{gameState:s,fear:y,countdowns:x,adversaries:l,environments:A,partySize:c,savedEncounters:k,customContent:i,...f,hasCountdowns:x.length>0,hasAdversaries:l.length>0,hasEnvironments:A.length>0,getCountdownById:I=>x.find(P=>P.id===I),getAdversaryById:I=>l.find(P=>P.id===I),getEnvironmentById:I=>A.find(P=>P.id===I)}},$e={fear:{icon:Ue,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"0.125rem",maxWidth:"none"},pipStyle:{fontSize:"var(--text-lg)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0,imageRendering:"crisp-edges"},filledColor:"var(--purple)",emptyColor:"var(--gray-dark)",tooltipTitle:"Click anywhere in header to adjust fear:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease fear by 1"},{text:"Right of boundary:",description:"Click to increase fear by 1"}]},hp:{icon:et,maxValue:20,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stress:{icon:tt,maxValue:12,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},countdown:{icon:De,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust countdown:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease countdown by 1"},{text:"Right of boundary:",description:"Click to increase countdown by 1"}]},hpDots:{maxValue:20,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--red)",borderColor:"var(--red)",boxShadow:"0 0 4px rgba(239, 68, 68, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stressDots:{maxValue:12,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--purple)",borderColor:"var(--purple)",boxShadow:"0 0 4px rgba(139, 92, 246, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},adversaryHP:{icon:_e,maxValue:20,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust HP:",tooltipInstructions:[{text:"Filled pip:",description:"Click to heal (reduce damage)"},{text:"Empty pip:",description:"Click to take damage"}]},adversaryStress:{icon:rt,maxValue:12,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust stress:",tooltipInstructions:[{text:"Filled pip:",description:"Click to reduce stress"},{text:"Empty pip:",description:"Click to increase stress"}]},countdownDistributed:{icon:De,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Countdown progress:",tooltipInstructions:[{text:"Progress:",description:"Current countdown value"}]}},Le=({type:t="fear",value:s=0,maxValue:i,onChange:f,size:y="lg",showTooltip:x=!0,containerStyle:l={},pipStyle:A={},countdownType:c=null,distributedGroups:k=null,onPipClick:I=null,enableBoundaryClick:P=!1,clickContainerWidth:Y="auto",centerPips:v=!0})=>{const[R,G]=b.useState(!1),B=$e[t]||$e.fear,L=i||B.maxValue,j=Math.max(0,Math.min(L,s));let T=B.filledColor;t==="countdown"&&c&&(["progress","dynamic-progress","simple-hope"].includes(c)?T="var(--gold)":["consequence","dynamic-consequence","simple-fear"].includes(c)?T="var(--purple)":["long-term","standard"].includes(c)&&(T="var(--text-secondary)"));const E=(O,le)=>{if(I)I(O,le);else if(f){const ae=O+1;f(ae)}},D=O=>{if(!P||!f||I)return;O.currentTarget.getBoundingClientRect();const le=O.currentTarget.querySelector(".pip-container");if(!le)return;const ae=le.getBoundingClientRect(),ie=O.clientX-ae.left;if(ie<0){j>0&&f(j-1);return}if(ie>ae.width){j<L&&f(j+1);return}const te=ae.width,p=te*.05,h=te-2*p,V=ie-p,w=j/L,z=h*w;V<z?j>0&&f(j-1):j<L&&f(j+1)},H=(()=>{if(!k||t!=="countdownDistributed")return[{start:0,end:L,groupIndex:0}];let O=0;return k.map((le,ae)=>{const ie={start:O,end:O+le,groupIndex:ae};return O+=le,ie})})(),ce=()=>e.jsxs(e.Fragment,{children:[H.map(O=>e.jsx(ge.Fragment,{children:[...Array(O.end-O.start)].map((le,ae)=>{const ie=O.start+ae,te=ie<j;if(B.isDots)return e.jsx("div",{style:{...B.pipStyle,...te?B.filledStyle:B.emptyStyle,...A,cursor:f||I?"pointer":"default"},onClick:P?void 0:()=>E(ie,te),title:`${ie+1} of ${L}`},ie);{const p=B.icon,h=p&&typeof p=="object"&&p.iconName,V=te?T:B.emptyColor;return e.jsx("span",{className:`fear-pip ${te?"filled":"empty"}`,style:{...B.pipStyle,color:V,cursor:f||I?"pointer":"default",...A},onClick:P?void 0:()=>E(ie,te),title:`${ie+1} of ${L}`,children:h?e.jsx(Ze,{icon:p,size:y}):e.jsx(p,{size:y==="lg"?18:16})},ie)}})},O.groupIndex)),x&&e.jsx("div",{style:{position:"relative",cursor:"help",pointerEvents:"none"},children:e.jsxs("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:R?"translateX(-50%) translateY(-5px)":"translateX(-50%)",background:"rgba(15, 23, 42, 0.95)",border:"1px solid var(--gray)",borderRadius:"var(--radius-md)",padding:"var(--space-md)",minWidth:"250px",zIndex:1e3,opacity:R?1:0,visibility:R?"visible":"hidden",transition:"all 0.2s ease",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.5)"},children:[e.jsx("div",{style:{fontWeight:600,color:"var(--gray-200)",marginBottom:"0.75rem",fontSize:"var(--text-sm)"},children:B.tooltipTitle}),B.tooltipInstructions.map((O,le)=>e.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.8rem",color:"var(--gray-300)",lineHeight:1.4},children:[e.jsx("strong",{style:{color:"var(--gray-200)"},children:O.text})," ",O.description]},le))]})})]});return e.jsx("div",{style:{width:Y,height:"100%",cursor:f||I?"pointer":"default",touchAction:"manipulation",userSelect:"none",display:v?"flex":"block",alignItems:v?"center":"stretch",justifyContent:v?"center":"flex-start",...l},onClick:O=>{O.stopPropagation(),O.preventDefault(),P&&D(O)},onMouseEnter:()=>G(x),onMouseLeave:()=>G(!1),children:e.jsx("div",{className:"pip-container",style:{...B.containerStyle,width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},children:ce()})})},bt="/Daggerheart/assets/daggerheart-logo-fe7815ad.svg",jt=({showFlyout:t,onFlyoutChange:s})=>{const[i,f]=b.useState(!1),[y,x]=b.useState(!1),l=t!==void 0?t:i,A=s||f;return b.useEffect(()=>{const c=k=>{k.target.closest(".help-button")||A(!1)};return document.addEventListener("click",c),()=>document.removeEventListener("click",c)},[A]),b.useEffect(()=>{const c=window.matchMedia("(max-width: 800px)"),k=I=>x(I.matches);return x(c.matches),c.addEventListener("change",k),()=>c.removeEventListener("change",k)},[]),e.jsxs("div",{className:"help-button",style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",padding:"0.5rem",color:l?"white":"var(--text-primary)",borderRadius:"50%",cursor:"pointer",transition:"all 0.2s ease",minWidth:"44px",minHeight:"44px",backgroundColor:l?"var(--purple)":"transparent"},onMouseEnter:c=>{l||(c.currentTarget.style.backgroundColor="var(--bg-secondary)")},onMouseLeave:c=>{l||(c.currentTarget.style.backgroundColor="transparent")},onClick:c=>{c.stopPropagation(),A(!l)},title:"Help & Info",children:[e.jsx("div",{style:{width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center",color:"inherit",backgroundColor:"transparent",border:"none",outline:"none"},children:e.jsx(nt,{size:20})}),e.jsxs("div",{style:{position:"absolute",top:"50%",right:"100%",left:"auto",transform:"translateY(-50%)",background:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,opacity:l?1:0,visibility:l?"visible":"hidden",transition:"opacity 0.2s ease, visibility 0.2s ease, transform 0.2s ease",pointerEvents:l?"auto":"none",minWidth:"280px",maxWidth:y?"calc(100vw - 2rem)":"320px",marginRight:"0.5rem"},children:[e.jsxs("div",{style:{padding:"0.75rem",borderTop:"1px solid rgba(255, 255, 255, 0.1)",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",background:"var(--bg-primary)",maxWidth:"280px"},children:[e.jsx("img",{src:bt,alt:"Daggerheart Community Content Logo",style:{width:"100%",maxWidth:"200px",height:"auto",margin:"0 auto 0.75rem auto",display:"block"},onError:c=>{console.error("Failed to load Daggerheart logo:",c.target.src),c.target.style.display="none";const k=document.createElement("div");k.style.cssText="text-align: center; margin-bottom: 0.75rem; font-size: 1.5rem; font-weight: bold; color: var(--purple);",k.textContent="⚔️ DAGGERHEART ⚔️",c.target.parentNode.insertBefore(k,c.target)},onLoad:()=>{}}),e.jsxs("div",{style:{fontSize:"0.7rem",lineHeight:1.3,color:"var(--text-secondary)",textAlign:"left",wordWrap:"break-word",overflowWrap:"break-word"},children:[e.jsx("p",{children:"This product includes materials from the Daggerheart System Reference Document 1.0, © Critical Role, LLC, under the terms of the Darrington Press Community Gaming (DPCGL) License."}),e.jsxs("p",{children:["More information can be found at ",e.jsx("a",{href:"https://www.daggerheart.com",target:"_blank",rel:"noopener noreferrer",children:"daggerheart.com"})]}),e.jsx("p",{children:e.jsx("em",{children:"This project is unofficial and not endorsed by Darrington Press or Critical Role."})})]})]}),e.jsx("button",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"0.25rem 1rem",color:"var(--text-primary)",border:"none",background:"none",width:"100%",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"0.875rem",minHeight:"32px",borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},onMouseEnter:c=>{c.target.style.backgroundColor="var(--gray-dark)"},onMouseLeave:c=>{c.target.style.backgroundColor="transparent"},onClick:c=>{c.stopPropagation(),A(!1),window.open("https://github.com/Splinter714/Daggerheart","_blank")},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.25rem"},children:e.jsx("span",{children:"GitHub"})})}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"0.25rem 1rem",color:"var(--text-secondary)",border:"none",background:"none",width:"100%",textAlign:"left",cursor:"default",fontSize:"0.875rem",minHeight:"32px"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.25rem"},children:e.jsxs("span",{children:["Version ","0.3.11 (8b3dde3)"]})})})]})]})},wt=({adversaries:t,environments:s,countdowns:i,deleteAdversary:f,deleteEnvironment:y,deleteCountdown:x,isClearMode:l,setIsClearMode:A,showFlyout:c,onFlyoutChange:k})=>{const[I,P]=b.useState(!1),Y=c!==void 0?c:I,v=k||P,R=((t==null?void 0:t.length)||0)>0||((s==null?void 0:s.length)||0)>0||((i==null?void 0:i.length)||0)>0,G=(t||[]).some(E=>(E.hp||0)>=(E.hpMax||1));b.useEffect(()=>{const E=D=>{D.target.closest(".delete-clear-container")||(v(!1),l&&A(!1))};return document.addEventListener("click",E),()=>document.removeEventListener("click",E)},[l,v]),b.useEffect(()=>{l&&!R&&(A(!1),v(!1))},[l,R,A,v]);const B={position:"absolute",top:"50%",right:"100%",left:"auto",transform:"translateY(-50%)",backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",padding:"0.5rem",minWidth:"200px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,display:Y?"block":"none",marginRight:"0.5rem"},L={background:l||Y?"var(--red)":"none",border:"none",color:l||Y?"white":R?"var(--text-primary)":"var(--text-secondary)",cursor:R?"pointer":"not-allowed",padding:"0.5rem",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s",opacity:R?1:.5,minWidth:"44px",minHeight:"44px"},j={background:"none",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:"0.5rem",borderRadius:"var(--radius-sm)",width:"100%",textAlign:"left",display:"flex",alignItems:"center",gap:"0.5rem",transition:"background-color 0.2s"},T={backgroundColor:"var(--bg-hover)"};return e.jsxs("div",{className:"delete-clear-container",style:{position:"relative"},children:[e.jsx("button",{style:L,onClick:E=>{E.stopPropagation(),R&&(l?(A(!1),v(!1)):(A(!0),v(!0)))},title:R?l?"Clear Items":"Enter Clear Mode":"Nothing to clear",children:e.jsx(ot,{size:20})}),e.jsxs("div",{style:B,children:[t&&t.length>0&&e.jsxs("button",{style:j,onMouseEnter:E=>Object.assign(E.target.style,T),onMouseLeave:E=>Object.assign(E.target.style,j),onClick:E=>{E.stopPropagation(),P(!1),t.forEach(D=>f(D.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Adversaries"})]}),t&&t.length>0&&G&&e.jsxs("button",{style:j,onMouseEnter:E=>Object.assign(E.target.style,T),onMouseLeave:E=>Object.assign(E.target.style,j),onClick:E=>{E.stopPropagation(),P(!1),t.filter(ee=>(ee.hp||0)>=(ee.hpMax||1)).forEach(ee=>f(ee.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"Dead Adversaries"})]}),s&&s.length>0&&e.jsxs("button",{style:j,onMouseEnter:E=>Object.assign(E.target.style,T),onMouseLeave:E=>Object.assign(E.target.style,j),onClick:E=>{E.stopPropagation(),P(!1),s.forEach(D=>y(D.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Environments"})]}),i&&i.length>0&&e.jsxs("button",{style:j,onMouseEnter:E=>Object.assign(E.target.style,T),onMouseLeave:E=>Object.assign(E.target.style,j),onClick:E=>{E.stopPropagation(),P(!1),i.forEach(D=>x(D.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Countdowns"})]})]})]})},Ct=({adversaries:t,environments:s,countdowns:i,deleteAdversary:f,deleteEnvironment:y,deleteCountdown:x,isClearMode:l,setIsClearMode:A,sortAdversaries:c,onOpenDatabase:k})=>{const[I,P]=b.useState(!1),[Y,v]=b.useState(!1),[R,G]=b.useState(!1);b.useEffect(()=>{const ee=H=>{H.target.closest(".floating-menu-container")||(P(!1),v(!1),G(!1),l&&A(!1))};return document.addEventListener("click",ee),()=>document.removeEventListener("click",ee)},[l,A]),b.useEffect(()=>{I||(v(!1),G(!1),l&&A(!1))},[I,l,A]);const B=ee=>{v(ee),ee&&(G(!1),l&&A(!1))},L=ee=>{G(ee),ee&&v(!1)},T={position:"fixed",bottom:window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://")?"calc(60px + env(safe-area-inset-bottom) + 2rem)":"calc(60px + env(safe-area-inset-bottom) + 1rem)",right:"1rem",zIndex:1100,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",pointerEvents:"none",width:"56px",height:"56px"},E={width:"56px",height:"56px",borderRadius:"50%",background:I?"var(--red)":"var(--bg-secondary)",border:"2px solid var(--border)",color:I?"white":"var(--text-primary)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"all 0.3s ease",pointerEvents:"auto"},D=(ee,H)=>{const ae=135+ee*135/(H-1),ie=70,te=ae*Math.PI/180,p=Math.cos(te)*ie,h=Math.sin(te)*ie;return{width:"48px",height:"48px",borderRadius:"50%",background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.2)",transition:"all 0.3s ease",position:"absolute",pointerEvents:"auto",transform:I?`translate(${p}px, ${h}px)`:"translate(0px, 0px)",opacity:I?1:0,visibility:I?"visible":"hidden"}};return e.jsxs("div",{className:"floating-menu-container",style:T,children:[e.jsxs("div",{style:{position:"absolute",top:"0",left:"0",width:"56px",height:"56px",pointerEvents:"none"},children:[e.jsx("div",{style:D(0,4),children:e.jsx("button",{onClick:ee=>{ee.stopPropagation(),k("adversaries"),P(!1)},style:{width:"100%",height:"100%",background:"none",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Browse Adversaries",children:e.jsx(st,{size:20})})}),e.jsx("div",{style:D(1,4),children:e.jsx("button",{onClick:ee=>{ee.stopPropagation(),k("environments"),P(!1)},style:{width:"100%",height:"100%",background:"none",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Browse Environments",children:e.jsx(at,{size:20})})}),e.jsx("div",{style:D(2,4),children:e.jsx(wt,{adversaries:t,environments:s,countdowns:i,deleteAdversary:f,deleteEnvironment:y,deleteCountdown:x,isClearMode:l,setIsClearMode:A,showFlyout:R,onFlyoutChange:L})}),e.jsx("div",{style:D(3,4),children:e.jsx(jt,{showFlyout:Y,onFlyoutChange:B})})]}),e.jsx("button",{style:E,onClick:ee=>{ee.stopPropagation(),P(!I)},title:I?"Close Menu":"Open Menu",children:I?e.jsx(Me,{size:24}):e.jsx(it,{size:24})})]})},St=({position:t="top",children:s,onClick:i,className:f="",style:y={}})=>{const x=t==="top",l=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://"),A={background:"var(--bg-primary)",borderTop:x?"none":"1px solid var(--border)",borderBottom:x?"1px solid var(--border)":"none",padding:x?"0.25rem 0":"0.5rem",paddingBottom:x?"0.25rem":l?"calc(0.5rem + env(safe-area-inset-bottom) + 1rem)":"calc(0.5rem + env(safe-area-inset-bottom))",position:x?"relative":"sticky",[x?"top":"bottom"]:0,zIndex:x?10:100,order:x?1:3,flexShrink:0,touchAction:"manipulation",userSelect:"none",display:"flex",flexDirection:x?"column":"row",justifyContent:x?"stretch":"center",alignItems:x?"stretch":"center",gap:x?"0":"1rem",height:x?"auto":"60px",...y};return e.jsx("div",{className:f,style:A,onClick:i,children:s})},we=({value:t})=>e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"44px",height:"32px",zIndex:3},children:[e.jsx("svg",{width:"40",height:"32",viewBox:"0 0 40 32",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",style:{position:"absolute",zIndex:1},children:e.jsx("path",{d:"M2 2h28l6 14-6 14H2l6-14-6-14z"})}),e.jsx("span",{style:{position:"absolute",fontSize:"0.7rem",fontWeight:500,color:"var(--text-primary)",textAlign:"center",zIndex:2,left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:t})]}),We=({feature:t,featureType:s,item:i,onUpdate:f,handleFeatureDeleteClick:y,deleteConfirmations:x,getFeatureKey:l})=>{var P,Y;const A=()=>{try{const R=[...(i==null?void 0:i.features)||[]],G=R.filter(L=>L.type===s),B=G.findIndex(L=>L===t);if(B>0&&B<G.length){const L=G[B],j=G[B-1];if(L&&j){const T=R.findIndex(D=>D===L),E=R.findIndex(D=>D===j);T>=0&&E>=0&&(R[T]=j,R[E]=L,f&&f(i.id,{features:R}))}}}catch(v){console.error(`Error in ${s.toLowerCase()} up button:`,v)}},c=()=>{try{const R=[...(i==null?void 0:i.features)||[]],G=R.filter(L=>L.type===s),B=G.findIndex(L=>L===t);if(B<G.length-1&&B>=0){const L=G[B],j=G[B+1];if(L&&j){const T=R.findIndex(D=>D===L),E=R.findIndex(D=>D===j);T>=0&&E>=0&&(R[T]=j,R[E]=L,f&&f(i.id,{features:R}))}}}catch(v){console.error(`Error in ${s.toLowerCase()} down button:`,v)}},k=v=>v.type===s,I=v=>v.type===s&&v.name.trim();return e.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",alignSelf:"stretch"},children:[e.jsx("button",{onClick:A,disabled:(i.features||[]).filter(k).findIndex(v=>v===t)===0,tabIndex:"-1",style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(i.features||[]).filter(I).length>=2&&(i.features||[]).filter(k).findIndex(v=>v===t)!==0&&t.name.trim()?"white":"var(--text-secondary)",cursor:(i.features||[]).filter(I).length>=2&&(i.features||[]).filter(k).findIndex(v=>v===t)!==0&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↑"}),e.jsx("button",{onClick:()=>y(t),disabled:!t.name.trim()&&!t.description.trim(),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:x[l(t)]?"var(--danger)":"var(--gray-700)",color:!t.name.trim()&&!t.description.trim()?"var(--text-secondary)":"white",cursor:!t.name.trim()&&!t.description.trim()?"not-allowed":"pointer",opacity:!t.name.trim()&&!t.description.trim()?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"×"}),e.jsx("button",{onClick:c,disabled:(i.features||[]).filter(k).findIndex(v=>v===t)===(i.features||[]).filter(k).length-1,style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(i.features||[]).filter(I).length>=2&&(i.features||[]).filter(k).findIndex(v=>v===t)<(i.features||[]).filter(k).length-1&&((P=(i.features||[]).filter(k)[(i.features||[]).filter(k).findIndex(v=>v===t)+1])!=null&&P.name.trim())&&t.name.trim()?"white":"var(--text-secondary)",cursor:(i.features||[]).filter(I).length>=2&&(i.features||[]).filter(k).findIndex(v=>v===t)<(i.features||[]).filter(k).length-1&&((Y=(i.features||[]).filter(k)[(i.features||[]).filter(k).findIndex(v=>v===t)+1])!=null&&Y.name.trim())&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↓"})]})},pe={transitions:{hoverIn:"all 0.1s ease",hoverOut:"all 0.3s ease"},card:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"8px",cursor:"pointer",transition:"all 0.1s ease",position:"relative"},cardHover:{backgroundColor:"var(--bg-card-hover)"},cardDead:{opacity:.6,backgroundColor:"var(--gray-800)",borderColor:"var(--border)"},cardAtMax:{backgroundColor:"var(--success)",borderColor:"var(--success)"},rowMain:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},rowTitle:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",margin:0},rowMeta:{display:"flex",gap:"8px",alignItems:"center"},badge:{padding:"2px 6px",borderRadius:"3px",fontSize:"10px",fontWeight:"600",textTransform:"uppercase"},typeBadge:{backgroundColor:"var(--purple)",color:"var(--text-primary)"},tierBadge:{backgroundColor:"var(--info)",color:"var(--text-primary)"},damageInputPopup:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,borderRadius:"8px"},damageInputContent:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"8px",padding:"8px",display:"flex",flexDirection:"row",gap:"8px",minWidth:"200px",alignItems:"center",position:"absolute",right:"1rem",top:"50%",transform:"translateY(-50%)"},damageInput:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"4px",padding:"4px 6px",color:"var(--text-primary)",fontSize:"16px",width:"80px",textAlign:"center"},damageIndicators:{display:"flex",gap:"8px",alignItems:"center",justifyContent:"center"},damageDrop:{fontSize:"16px",color:"var(--text-secondary)",cursor:"pointer",transition:"color 0.1s ease"},applyButton:{backgroundColor:"var(--gray-600)",color:"white",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"32px",minHeight:"32px"}},kt=(t,s,i,f)=>{const[y,x]=b.useState(!1),[l,A]=b.useState("");b.useEffect(()=>{if(y){const v=R=>{R.target.closest(".damage-input-popup")||(x(!1),A(""))};return document.addEventListener("click",v),()=>document.removeEventListener("click",v)}},[y]);const c=v=>{v.stopPropagation(),v.preventDefault();const R=t.hp||0,G=t.hpMax||1,B=v.currentTarget.getBoundingClientRect(),L=v.clientX-B.left,j=B.width/G;Math.floor(L/j)<R?i&&i(t.id,1,t.hp):s&&s(t.id,1,t.hp,t.hpMax)},k=v=>{v.stopPropagation(),v.preventDefault();const R=t.stress||0,G=t.stressMax||1,B=v.currentTarget.getBoundingClientRect(),L=v.clientX-B.left,j=B.width/G;Math.floor(L/j)<R?f&&f(t.id,-1,t.stress,t.stressMax):f&&f(t.id,1,t.stress,t.stressMax)},I=v=>{v.stopPropagation(),(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")&&(x(!0),A(t.type==="Minion"?"1":""))},P=()=>{const v=parseInt(l);if(v>0){if(t.type==="Minion")s&&s(t.id,v,t.hp,t.hpMax);else{let R=0;v>=t.thresholds.severe?R=3:v>=t.thresholds.major?R=2:v>=1&&(R=1),s&&s(t.id,R,t.hp,t.hpMax)}x(!1),A("")}};return{showDamageInput:y,damageValue:l,setDamageValue:A,setShowDamageInput:x,handleHpClick:c,handleStressClick:k,handleDifficultyClick:I,applyDamage:P,handleKeyDown:v=>{v.key==="Enter"?P():v.key==="Escape"&&(x(!1),A(""))}}},Pe=({item:t,type:s,mode:i="expanded",onClick:f,onDelete:y,onApplyDamage:x,onApplyHealing:l,onApplyStressChange:A,onUpdate:c,adversaries:k=[],isSelected:I=!1,isEditMode:P=!1,instances:Y=[],isEmbedded:v=!1})=>{const[R,G]=b.useState({}),B=p=>{const V=(t.features||[]).filter(w=>w.type===p.type).findIndex(w=>w===p);return`${p.type}-${V}-${p.name||"blank"}`},L=p=>{const h=B(p);if(R[h]){const V=t.features.filter(w=>w!==p);c&&c(t.id,{features:V}),G(w=>{const z={...w};return delete z[h],z})}else G(V=>({...V,[h]:!0})),setTimeout(()=>{G(V=>{const w={...V};return delete w[h],w})},3e3)},j=kt(t,x,l,A);(s==="adversary"||s==="adversaries")&&j.handleDifficultyClick;const[T,E]=b.useState(!1),D=()=>{E(!0)},ee=()=>{E(!1)},H=(p=!1)=>{let h={...pe.card};if(I?h.transition="none":h.transition=T?pe.transitions.hoverIn:pe.transitions.hoverOut,p){const{marginTop:V,...w}=h;h=w}return(T&&i!=="expanded"||I)&&(h={...h,...pe.cardHover}),s==="adversary"&&(t.hp||0)>=(t.hpMax||1)&&(h={...h,...pe.cardDead}),h},ce=()=>{if(v)return"";let p="border rounded-lg";return(T&&i!=="expanded"||I)&&(p+=" border-hover"),p},O=()=>{var p;if(s==="adversary"||s==="adversaries"){const h=t.baseName||((p=t.name)==null?void 0:p.replace(/\s+\(\d+\)$/,""))||"",V=t.duplicateNumber||1,w=[...k];return k.some(Q=>Q.id===t.id)||w.push(t),w.filter(Q=>Q.baseName===h).length>1?`${h} (${V})`:h}return t.name},le=()=>{const p=[];return t.type&&p.push(e.jsx("span",{style:{...pe.badge,...pe.typeBadge},children:t.type},"type")),p},ae=()=>s!=="adversary"||!j.showDamageInput||!(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")?null:e.jsx("div",{className:"damage-input-popup",style:pe.damageInputPopup,onClick:p=>{p.stopPropagation(),p.target===p.currentTarget&&(s==="adversary"||s==="adversaries")&&(j.setShowDamageInput(!1),j.setDamageValue(""))},children:e.jsxs("div",{className:"border rounded-lg",style:{...pe.damageInputContent,borderColor:"var(--border)"},onClick:p=>p.stopPropagation(),children:[e.jsx("input",{type:"number",inputMode:"numeric",enterKeyHint:"done",placeholder:"dmg",min:(t.type==="Minion","0"),value:s==="adversary"||s==="adversaries"?j.damageValue:"",onChange:p=>{(s==="adversary"||s==="adversaries")&&j.setDamageValue(p.target.value)},onKeyDown:s==="adversary"||s==="adversaries"?j.handleKeyDown:void 0,className:"border rounded-sm",style:{...pe.damageInput,borderColor:"var(--border)"},autoFocus:!0}),e.jsxs("div",{style:pe.damageIndicators,children:[t.type==="Minion"?(()=>{var z,K;const p=parseInt(s==="adversary"||s==="adversaries"?j.damageValue:"0")||0,h=(z=t.features)==null?void 0:z.find(Q=>{var g;return(g=Q.name)==null?void 0:g.startsWith("Minion (")}),V=h?parseInt(((K=h.name.match(/\((\d+)\)/))==null?void 0:K[1])||"1"):1,w=Math.floor(p/V);return p>=V&&w>0?e.jsxs("span",{style:{...pe.damageDrop,color:"var(--red)"},title:`${p} damage can defeat ${w+1} minion${w+1!==1?"s":""} (1 + ${w} additional)`,children:["+",w," additional minion(s)"]}):e.jsx("span",{style:pe.damageDrop,title:`${p} damage defeats this minion only`,children:"+0 additional minion(s)"})})():[1,2,3].map(p=>{const h=parseInt(s==="adversary"||s==="adversaries"?j.damageValue:"0")||0;let V=!1;return p===1&&h>=1&&(V=!0),p===2&&h>=t.thresholds.major&&(V=!0),p===3&&h>=t.thresholds.severe&&(V=!0),e.jsx("span",{style:{...pe.damageDrop,color:V?"var(--red)":"var(--text-secondary)"},onClick:w=>{w.stopPropagation(),(s==="adversary"||s==="adversaries")&&(p===1?j.setDamageValue("1"):p===2?j.setDamageValue(t.thresholds.major.toString()):p===3&&j.setDamageValue(t.thresholds.severe.toString()))},title:`Click to set damage to ${p===1?"1":p===2?t.thresholds.major:t.thresholds.severe}`,children:e.jsx(_e,{size:16})},p)}),e.jsx("button",{style:{...pe.applyButton,backgroundColor:"var(--gray-600)"},onClick:p=>{p.stopPropagation(),(s==="adversary"||s==="adversaries")&&(!j.damageValue||parseInt(j.damageValue)<1?(j.setShowDamageInput(!1),j.setDamageValue("")):j.applyDamage())},title:!j.damageValue||parseInt(j.damageValue)<1?"Close damage input":"Apply damage",children:!j.damageValue||parseInt(j.damageValue)<1?e.jsx(Me,{size:16}):e.jsx(pt,{size:16})})]})]})}),ie=()=>{var V,w,z,K,Q;const p=(t.hp||0)>=(t.hpMax||1),h=i==="edit";return e.jsxs("div",{className:ce(),style:{...H(!0),padding:0,minHeight:"400px",opacity:p?.7:1,backgroundColor:p?"var(--gray-900)":H(!0).backgroundColor,borderColor:p?"color-mix(in srgb, var(--gray-600) 40%, transparent)":I?"var(--purple)":T&&i!=="expanded"?"var(--border-hover)":"var(--border)",borderWidth:"2px",display:"flex",flexDirection:"column",position:"relative"},onClick:f,...i!=="expanded"&&{onMouseEnter:D,onMouseLeave:ee},children:[p&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                45deg,
                transparent,
                transparent 8px,
                var(--gray-600) 1px,
                var(--gray-600) 9px
              )`,pointerEvents:"none",zIndex:9999}}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"var(--text-secondary)",fontSize:"1rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em",zIndex:1e4,pointerEvents:"none",textShadow:"1px 1px 2px rgba(0, 0, 0, 0.5)",backgroundColor:"var(--gray-900)",padding:"0.25rem 0.5rem",borderRadius:"0.5rem",border:"0.5px solid var(--gray-600)"},children:"DEFEATED"})]}),e.jsx("div",{className:"border-b",style:{padding:"8px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative",zIndex:p?1:"auto",borderBottomColor:I?"var(--purple)":"var(--border)"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",position:"relative",zIndex:p?1:"auto"},children:[h?e.jsx("input",{type:"text",value:t.name||"",onChange:g=>{c&&c(t.id,{name:g.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"4px",color:"var(--text-primary)",fontSize:"1.1rem",fontWeight:"600",padding:"0.5rem",width:"100%",maxWidth:"300px"},placeholder:"Adversary name"}):e.jsx("h4",{style:{...pe.rowTitle,color:p?"color-mix(in srgb, var(--gray-400) 80%, transparent)":pe.rowTitle.color,textAlign:"left",margin:0,fontSize:"1.1rem"},children:((V=t.name)==null?void 0:V.replace(/\s+\(\d+\)$/,""))||t.name}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[(t.type||h)&&e.jsx("div",{children:h?e.jsxs("select",{value:t.type||"",onChange:g=>{c&&c(t.id,{type:g.target.value})},style:{backgroundColor:"var(--purple)",border:"1px solid var(--border)",borderRadius:"3px",color:"var(--text-primary)",fontSize:"14px",fontWeight:"600",textTransform:"uppercase",padding:"2px 6px",outline:"none"},children:[e.jsx("option",{value:"Standard",children:"Standard"}),e.jsx("option",{value:"Solo",children:"Solo"}),e.jsx("option",{value:"Bruiser",children:"Bruiser"}),e.jsx("option",{value:"Horde",children:"Horde"}),e.jsx("option",{value:"Minion",children:"Minion"}),e.jsx("option",{value:"Ranged",children:"Ranged"}),e.jsx("option",{value:"Leader",children:"Leader"}),e.jsx("option",{value:"Skulk",children:"Skulk"}),e.jsx("option",{value:"Social",children:"Social"}),e.jsx("option",{value:"Support",children:"Support"})]}):e.jsx("span",{style:{...pe.badge,...pe.typeBadge},children:t.type})}),(t.tier||h)&&e.jsx("div",{children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[e.jsx(lt,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)"}}),h?e.jsx("input",{type:"text",value:t.tier||"",onChange:g=>{const Z=g.target.value.replace(/[^1-4]/g,"");Z.length<=1&&c&&c(t.id,{tier:Z===""?"":parseInt(Z)})},onKeyDown:g=>{if(g.key==="ArrowUp"){g.preventDefault();const Z=parseInt(t.tier)||1;c&&c(t.id,{tier:Math.min(Z+1,4)})}else if(g.key==="ArrowDown"){g.preventDefault();const Z=parseInt(t.tier)||1;c&&c(t.id,{tier:Math.max(Z-1,1)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.75rem",fontWeight:600,width:"20px",textAlign:"center",outline:"none"},maxLength:"1"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",fontWeight:600,color:"white",pointerEvents:"none"},children:t.tier})]})})]})]})}),e.jsxs("div",{style:{borderRadius:"0 0 8px 8px"},children:[(t.motives||h)&&e.jsx("div",{style:{padding:"0.5rem 8px",textAlign:"center"},children:h?e.jsx("input",{type:"text",value:t.motives||"",onChange:g=>c&&c(t.id,{motives:g.target.value}),placeholder:"Enter motives (e.g., Hunt, defend, patrol)",style:{width:"100%",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}):e.jsxs("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4},children:[t.motives,t.motives&&!t.motives.endsWith(".")?".":""]})}),(t.difficulty||t.atk!==void 0||t.thresholds&&t.type!=="Minion"||t.experience&&t.experience.length>0||h)&&e.jsxs("div",{style:{padding:"0.5rem 8px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[(t.difficulty||h)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",width:"36px"},children:[e.jsx(dt,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(0deg)"}}),h?e.jsx("input",{type:"text",value:t.difficulty||"",onChange:g=>{const Z=g.target.value.replace(/[^0-9]/g,"");Z.length<=2&&c&&c(t.id,{difficulty:parseInt(Z)||0})},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.75rem",fontWeight:600,width:"20px",textAlign:"center",outline:"none"},maxLength:"2"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",fontWeight:600,color:"white",pointerEvents:"none"},children:t.difficulty})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Difficulty"})]}),(t.atk!==void 0||h)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",width:"36px"},children:[e.jsx(ct,{size:36,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(45deg)"}}),h?e.jsx("input",{type:"text",value:t.atk||"",onChange:g=>{const Z=g.target.value.replace(/[^0-9+\-d]/g,"");Z.length<=3&&c&&c(t.id,{atk:Z})},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.75rem",fontWeight:600,width:"20px",textAlign:"center",outline:"none"},maxLength:"3"}):e.jsxs("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",fontWeight:600,color:"white",pointerEvents:"none"},children:[t.atk>=0?"+":"",t.atk]})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Attack"})]})]}),e.jsx("div",{children:h?e.jsx("textarea",{value:(t.experience||[]).join(", ")||"",onChange:g=>{const Z=g.target.value.split(",").map(m=>m.trim()).filter(m=>m.length>0);c&&c(t.id,{experience:Z})},placeholder:"Enter experience tags (e.g., Battle Hardened +3, Keen Senses +2)",rows:3,style:{width:"100%",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"vertical"}}):e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:t.experience&&t.experience.length>0?t.experience.map((g,Z)=>{if(typeof g=="string"){const m=g.match(/^(.+?)\s*([+-]?\d+)$/);if(m){const[,J,o]=m;return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("span",{style:{fontSize:"0.75rem",fontWeight:600,color:"var(--text-primary)"},children:o})})}),e.jsx("span",{style:{marginLeft:"32px"},children:J})]},Z)}else return e.jsx("div",{style:{marginBottom:"0.25rem"},children:g},Z)}else return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("span",{style:{fontSize:"0.75rem",fontWeight:600,color:"var(--text-primary)"},children:[g.modifier>=0?"+":"",g.modifier]})})}),e.jsx("span",{style:{marginLeft:"32px"},children:g.name})]},Z)}):null})})]}),(t.features&&t.features.length>0||h)&&e.jsxs("div",{style:{padding:"0 8px 8px 8px"},children:[t.atk!==void 0&&t.weapon&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Standard Attack"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:h?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)"},children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[e.jsx("input",{type:"text",value:t.weapon||"",onChange:g=>c&&c(t.id,{weapon:g.target.value}),placeholder:"Standard attack name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}}),e.jsxs("select",{value:t.range||"",onChange:g=>c&&c(t.id,{range:g.target.value}),style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",appearance:"none",backgroundImage:`url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",backgroundSize:"1rem",paddingRight:"2rem"},children:[e.jsx("option",{value:"",children:"Range"}),e.jsx("option",{value:"Melee",children:"Melee"}),e.jsx("option",{value:"Very Close",children:"Very Close"}),e.jsx("option",{value:"Close",children:"Close"}),e.jsx("option",{value:"Far",children:"Far"}),e.jsx("option",{value:"Very Far",children:"Very Far"})]}),e.jsx("input",{type:"text",value:t.damage||"",onChange:g=>c&&c(t.id,{damage:g.target.value}),placeholder:"Damage (e.g., 1d6+2)",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}})]})}):t.atk!==void 0&&t.weapon&&e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:t.weapon}),e.jsxs("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:["Make an attack against a target within ",t.range||"Melee"," range. On a success, deal ",t.damage||"damage varies","."]})]})})]}),(t.features.filter(g=>g.type==="Action").length>0||h)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Actions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const g=t.features.filter(m=>m.type==="Action");return(h&&g.length===0?[{type:"Action",name:"",description:""}]:g).map((m,J)=>h?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:m.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false","data-lpignore":"true","data-form-type":"other",name:`feature-name-${m.type.toLowerCase()}`,onChange:o=>{const n=[...t.features||[]],a=n.findIndex(S=>S.type==="Action"&&S===m);a>=0?n[a]={...n[a],name:o.target.value}:n.push({type:"Action",name:o.target.value,description:m.description||""});const r=n.filter(S=>S.type==="Action"),u=r[r.length-1];u&&u.name.trim()&&n.push({type:"Action",name:"",description:""}),c&&c(t.id,{features:n})},placeholder:"Action name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:m.description||"",onChange:o=>{const n=[...t.features||[]],a=n.findIndex(S=>S.type==="Action"&&S===m);a>=0?n[a]={...n[a],description:o.target.value}:n.push({type:"Action",name:m.name||"",description:o.target.value});const r=n.filter(S=>S.type==="Action"),u=r[r.length-1];u&&u.name.trim()&&n.push({type:"Action",name:"",description:""}),c&&c(t.id,{features:n})},onInput:o=>{const n=o.target.offsetHeight;o.target.style.height="auto";const a=o.target.scrollHeight,r=a>n?a:n;o.target.style.height=r+"px"},placeholder:"Action description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(We,{feature:m,featureType:"Action",item:t,onUpdate:c,handleFeatureDeleteClick:L,deleteConfirmations:R,getFeatureKey:B})]},J):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:m.name}),m.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:m.description})]},J))})()})]}),(t.features.filter(g=>g.type==="Passive").length>0||h)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Passives"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const g=t.features.filter(m=>m.type==="Passive");return(h&&g.length===0?[{type:"Passive",name:"",description:""}]:g).map((m,J)=>h?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:m.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:o=>{const n=[...t.features||[]],a=n.findIndex(S=>S.type==="Passive"&&S===m);a>=0?n[a]={...n[a],name:o.target.value}:n.push({type:"Passive",name:o.target.value,description:m.description||""});const r=n.filter(S=>S.type==="Passive"),u=r[r.length-1];u&&u.name.trim()&&n.push({type:"Passive",name:"",description:""}),c&&c(t.id,{features:n})},placeholder:"Passive name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:m.description||"",onChange:o=>{const n=[...t.features||[]],a=n.findIndex(S=>S.type==="Passive"&&S===m);a>=0?n[a]={...n[a],description:o.target.value}:n.push({type:"Passive",name:m.name||"",description:o.target.value});const r=n.filter(S=>S.type==="Passive"),u=r[r.length-1];u&&u.name.trim()&&n.push({type:"Passive",name:"",description:""}),c&&c(t.id,{features:n})},onInput:o=>{const n=o.target.offsetHeight;o.target.style.height="auto";const a=o.target.scrollHeight,r=a>n?a:n;o.target.style.height=r+"px"},placeholder:"Passive description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(We,{feature:m,featureType:"Passive",item:t,onUpdate:c,handleFeatureDeleteClick:L,deleteConfirmations:R,getFeatureKey:B})]},J):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:m.name}),m.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:m.description})]},J))})()})]}),(t.features.filter(g=>g.type==="Reaction").length>0||h)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Reactions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const g=t.features.filter(m=>m.type==="Reaction");return(h&&g.length===0?[{type:"Reaction",name:"",description:""}]:g).map((m,J)=>h?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:m.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:o=>{const n=[...t.features||[]],a=n.findIndex(S=>S.type==="Reaction"&&S===m);a>=0?n[a]={...n[a],name:o.target.value}:n.push({type:"Reaction",name:o.target.value,description:m.description||""});const r=n.filter(S=>S.type==="Reaction"),u=r[r.length-1];u&&u.name.trim()&&n.push({type:"Reaction",name:"",description:""}),c&&c(t.id,{features:n})},placeholder:"Reaction name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:m.description||"",onChange:o=>{const n=[...t.features||[]],a=n.findIndex(S=>S.type==="Reaction"&&S===m);a>=0?n[a]={...n[a],description:o.target.value}:n.push({type:"Reaction",name:m.name||"",description:o.target.value});const r=n.filter(S=>S.type==="Reaction"),u=r[r.length-1];u&&u.name.trim()&&n.push({type:"Reaction",name:"",description:""}),c&&c(t.id,{features:n})},onInput:o=>{const n=o.target.offsetHeight;o.target.style.height="auto";const a=o.target.scrollHeight,r=a>n?a:n;o.target.style.height=r+"px"},placeholder:"Reaction description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(We,{feature:m,featureType:"Reaction",item:t,onUpdate:c,handleFeatureDeleteClick:L,deleteConfirmations:R,getFeatureKey:B})]},J):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:m.name}),m.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:m.description})]},J))})()})]})]})]}),(Y&&Y.length>0||t.type!=="Minion"&&(t.thresholds||h))&&e.jsxs("div",{style:{padding:"0 8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Status"})]}),Y&&Y.length>0&&Y.map((g,Z)=>{const m=(g.hp||0)>=(g.hpMax||1);return e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsxs("div",{style:{backgroundColor:m?"var(--gray-900)":"var(--bg-primary)",borderRadius:"6px",padding:"0.25rem 0.5rem",border:"1px solid",borderColor:m?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",display:"flex",justifyContent:"flex-start",alignItems:"center",gap:"0.5rem",opacity:m?.7:1,position:"relative",transition:"all 0.2s ease",minHeight:"40px"},children:[m&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                          45deg,
                          transparent 0px,
                          transparent 8px,
                          var(--gray-600) 9px,
                          var(--gray-600) 9px
                        )`,pointerEvents:"none",zIndex:1,borderRadius:"4px"}}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"var(--text-secondary)",fontSize:"0.75rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em",zIndex:2,backgroundColor:"var(--gray-900)",padding:"0.125rem 0.25rem",borderRadius:"0.25rem",border:"0.5px solid var(--gray-600)"},children:"DEFEATED"})]}),e.jsx("div",{style:{backgroundColor:m?"var(--gray-900)":"var(--bg-card)",border:"1px solid",borderColor:m?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",borderRadius:"50%",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,opacity:m?.5:1},children:e.jsx("span",{style:{fontSize:"0.75rem",fontWeight:600,color:m?"var(--gray-400)":"var(--text-primary)"},children:g.duplicateNumber||1})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.125rem"},children:[e.jsx("div",{style:{opacity:m?.3:1},children:e.jsx(Le,{type:"adversaryHP",value:g.hp||0,maxValue:g.hpMax||1,onPipClick:(J,o)=>{if(x&&s==="adversary"){const n=g.hp||0,a=g.hpMax||1;o?l&&l(g.id,1,n):n<a&&x(g.id,1,n,a)}},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})}),g.stressMax>0&&e.jsx("div",{style:{opacity:m?.3:1},children:e.jsx(Le,{type:"adversaryStress",value:g.stress||0,maxValue:g.stressMax,onPipClick:(J,o)=>{A&&s==="adversary"&&(o?A(g.id,-1):A(g.id,1))},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})})]})]},g.id)},g.id)}),t.type!=="Minion"&&(t.thresholds||h)&&e.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:"0.5rem",marginBottom:"0.5rem"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",height:"36px"},children:[e.jsx("svg",{width:"300",height:"36",viewBox:"0 0 300 36",style:{position:"absolute",zIndex:1},children:e.jsx("rect",{x:"20",y:"6",width:"260",height:"24",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4"})}),e.jsx("div",{style:{position:"relative",zIndex:2,display:"flex",alignItems:"center",gap:"0.5rem"},children:h?e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",fontSize:"0.8rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"Minor"}),e.jsx(we,{value:((w=t.thresholds)==null?void 0:w.major)||"7"}),e.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"Major"}),e.jsx(we,{value:((z=t.thresholds)==null?void 0:z.severe)||"14"}),e.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"Severe"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.8rem",fontWeight:500},children:"Minor"}),e.jsx(we,{value:((K=t.thresholds)==null?void 0:K.major)||"7"}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.8rem",fontWeight:500},children:"Major"}),e.jsx(we,{value:((Q=t.thresholds)==null?void 0:Q.severe)||"14"}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.8rem",fontWeight:500},children:"Severe"})]})})]})})})]}),h&&e.jsxs("div",{style:{marginBottom:"1rem",padding:"0 8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px",textAlign:"center",minWidth:"80px"},children:"Description"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),h?e.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-primary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"none",overflow:"hidden",fontFamily:"inherit"},value:t.description,onChange:g=>{g.target.style.height="auto",g.target.style.height=g.target.scrollHeight+"px",c&&c(t.id,{description:g.target.value})},placeholder:"Enter adversary description..."}):e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",whiteSpace:"pre-wrap"},children:t.description})]}),ae()]})};return(i==="expanded"||i==="edit")&&(s==="adversary"||s==="adversaries")?ie():s==="adversary"||s==="adversaries"?null:e.jsxs("div",{className:ce(),style:H(!0),children:[e.jsxs("div",{style:pe.rowMain,children:[e.jsx("h4",{style:pe.rowTitle,children:O()}),e.jsx("div",{style:pe.rowMeta,children:le()})]}),e.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"12px",margin:0},children:["Expanded view coming soon for ",s]})]})},Et="modulepreload",It=function(t){return"/Daggerheart/"+t},qe={},Ce=function(s,i,f){if(!i||i.length===0)return s();const y=document.getElementsByTagName("link");return Promise.all(i.map(x=>{if(x=It(x),x in qe)return;qe[x]=!0;const l=x.endsWith(".css"),A=l?'[rel="stylesheet"]':"";if(!!f)for(let I=y.length-1;I>=0;I--){const P=y[I];if(P.href===x&&(!l||P.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${x}"]${A}`))return;const k=document.createElement("link");if(k.rel=l?"stylesheet":Et,l||(k.as="script",k.crossOrigin=""),k.href=x,document.head.appendChild(k),l)return new Promise((I,P)=>{k.addEventListener("load",I),k.addEventListener("error",()=>P(new Error(`Unable to preload CSS for ${x}`)))})})).then(()=>s()).catch(x=>{const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=x,window.dispatchEvent(l),!l.defaultPrevented)throw x})},At=({onSave:t,onRefresh:s,onAddItem:i})=>{const[f,y]=b.useState({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:11,thresholds:{major:7,severe:12},hpMax:3,stressMax:1,atk:1,weapon:"",range:"Melee",damage:"",experience:[],features:[]}),[x,l]=b.useState(!1),A=async()=>{if(!f.name.trim()){alert("Please enter a name for the adversary");return}l(!0);try{const k={...f,hp:0,stress:0,source:"Homebrew"},I=await t(k);i&&I&&i(I),s&&await s(),y({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:11,thresholds:{major:7,severe:12},hpMax:3,stressMax:1,atk:1,weapon:"",range:"Melee",damage:"",experience:[],features:[]}),alert("Custom adversary created successfully!")}catch(k){console.error("Error saving adversary:",k),alert("Error saving adversary. Please try again.")}finally{l(!1)}},c={...f,id:"new-adversary",hp:0,stress:0,source:"Homebrew"};return e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem",display:"flex",justifyContent:"center",alignItems:"flex-start"},children:e.jsxs("div",{style:{maxWidth:"600px",width:"100%"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h2",{style:{color:"var(--text-primary)",fontSize:"1.5rem",fontWeight:"600",margin:0},children:"Create Custom Adversary"}),e.jsx("button",{onClick:A,disabled:x||!f.name.trim(),style:{padding:"0.75rem 1.5rem",backgroundColor:x||!f.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"8px",cursor:x||!f.name.trim()?"not-allowed":"pointer",fontSize:"1rem",fontWeight:"600",opacity:x||!f.name.trim()?.6:1},children:x?"Creating...":"Create and Add"})]}),e.jsx(Pe,{item:c,type:"adversary",mode:"edit",onUpdate:(k,I)=>{y(P=>({...P,...I}))}})]})})},zt=(t,s)=>{const[i,f]=b.useState("max-content"),y=b.useCallback(()=>{if(!s.current||t<=3)return"max-content";const x=s.current.offsetWidth,A=Math.floor(x/120);return A<=1?"max-content":t===4?"max-content max-content":t===5||t===6?A>=2?"max-content max-content":"max-content":t===7?A>=3?"max-content max-content max-content":A>=2?"max-content max-content":"max-content":"repeat(auto-fit, minmax(80px, max-content))"},[t,s]);return b.useEffect(()=>{const x=y();f(x);const l=new ResizeObserver(()=>{const A=y();f(A)});return s.current&&l.observe(s.current),()=>{l.disconnect()}},[y]),i},Wt=({encounter:t})=>{var y,x;const s=b.useRef(null),i=((y=t.encounterItems)==null?void 0:y.length)||0,f=zt(i,s);return e.jsx("div",{ref:s,className:"saved-encounter-adversary-list",style:{flex:1,fontSize:"0.8rem",color:"var(--text-secondary)",lineHeight:"1.3",display:"grid",gridTemplateColumns:f,gap:"0.25rem 1rem",gridAutoRows:"min-content"},children:((x=t.encounterItems)==null?void 0:x.length)>0?t.encounterItems.map((l,A)=>{var k;const c=l.item.baseName||((k=l.item.name)==null?void 0:k.replace(/\s+\(\d+\)$/,""))||l.item.name;return e.jsxs("div",{style:{marginBottom:"0.125rem"},children:[l.quantity,"x ",c]},A)}):e.jsx("div",{children:"No adversaries"})})},ve={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},Se={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1,lowerTierAdversary:1};let ke={adversaries:[]},Ee={environments:[]},Ie=!1;const Xe=()=>{const t=JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]"),s=JSON.parse(localStorage.getItem("daggerheart-custom-environments")||"[]");return{customAdversaries:t,customEnvironments:s}},Rt=(t,s)=>{t==="adversary"?localStorage.setItem("daggerheart-custom-adversaries",JSON.stringify(s)):t==="environment"&&localStorage.setItem("daggerheart-custom-environments",JSON.stringify(s))},Te=async()=>{if(Ie)return;let t={adversaries:[]},s={environments:[]},i={adversaries:[]},f={environments:[]};try{const l=await Ce(()=>import("./adversaries-9c8932de.js"),[]);t=(l==null?void 0:l.default)||l}catch(l){console.warn("Failed to load adversaries.json:",l)}try{const l=await Ce(()=>import("./environments-c340637c.js"),[]);s=(l==null?void 0:l.default)||l}catch(l){console.warn("Failed to load environments.json:",l)}try{const l=await Ce(()=>import("./playtest-adversaries-4a099c10.js"),[]);i=(l==null?void 0:l.default)||l}catch(l){console.warn("Failed to load playtest-adversaries.json:",l)}try{const l=await Ce(()=>import("./playtest-environments-d9cdffb6.js"),[]);f=(l==null?void 0:l.default)||l}catch(l){console.warn("Failed to load playtest-environments.json:",l)}const{customAdversaries:y,customEnvironments:x}=Xe();ke={...t,adversaries:[...t.adversaries||[],...i.adversaries||[],...y]},Ee={...s,environments:[...s.environments||[],...f.environments||[],...x]},Ie=!0,console.log(`Loaded ${ke.adversaries.length} adversaries and ${Ee.environments.length} environments`)},Nt=t=>{const{customAdversaries:s}=Xe(),i={...t,id:`custom-${Date.now()}-${Math.random().toString(36).slice(2,10)}`,source:t.source||"Homebrew"},f=[...s,i];return Rt("adversary",f),Ie=!1,Te(),i},Bt=(t,s=[],i=4,f=1)=>{const[y,x]=b.useState(""),[l,A]=b.useState([{field:"tier",direction:"asc"},{field:"name",direction:"asc"}]),[c,k]=b.useState([]),[I,P]=b.useState(!0),[Y,v]=b.useState([]),[R,G]=b.useState([]),[B,L]=b.useState(!1),[j,T]=b.useState(!1),E=b.useRef(null),D=b.useRef(null);b.useEffect(()=>{(async()=>{await Te(),P(!1);let z=[];t==="adversary"?z=ke.adversaries||[]:t==="environment"&&(z=Ee.environments||[]),k(z)})()},[t]);const ee=b.useCallback(async()=>{Ie=!1,await Te();let w=[];t==="adversary"?w=ke.adversaries||[]:t==="environment"&&(w=Ee.environments||[]),k(w)},[t]),H=w=>{const z=c.map(K=>K[w]).filter(Boolean);return[...new Set(z)].sort((K,Q)=>typeof K=="number"&&typeof Q=="number"?K-Q:String(K).localeCompare(String(Q)))},ce=H("tier"),O=H("type"),le=b.useMemo(()=>{let w=c.filter(z=>{var Z,m;const K=z.name.toLowerCase().includes(y.toLowerCase())||((Z=z.type)==null?void 0:Z.toLowerCase().includes(y.toLowerCase()))||((m=z.description)==null?void 0:m.toLowerCase().includes(y.toLowerCase())),Q=Y.length===0||(Y.includes("party-tier")?z.tier===f:Y.includes(z.tier.toString())),g=R.length===0||R.includes(z.type);return K&&Q&&g});return w.sort((z,K)=>{for(const Q of l){const{field:g,direction:Z}=Q;let m=z[g],J=K[g];if(g==="tier")m=parseInt(m)||0,J=parseInt(J)||0;else if(g==="cost"){const o=n=>{if(t!=="adversary")return 0;const a=ve[n.type]||2;let r=0;const u=s.filter(F=>F.type==="adversary"&&F.item.type==="Solo"&&F.quantity>0).reduce((F,de)=>F+de.quantity,0),S=s.filter(F=>F.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(F.item.type)&&F.quantity>0).reduce((F,de)=>F+de.quantity,0);return n.type==="Solo"&&u===1&&(r+=2),["Bruiser","Horde","Leader","Solo"].includes(n.type)&&S===0&&(r+=1),a+r};m=o(z),J=o(K)}else if(g==="difficulty"){const o=parseInt(m),n=parseInt(J);!isNaN(o)&&!isNaN(n)?(m=o,J=n):!isNaN(o)&&isNaN(n)?(m=o,J=999):isNaN(o)&&!isNaN(n)?(m=999,J=n):(m=String(m||"").toLowerCase(),J=String(J||"").toLowerCase())}else typeof m=="string"&&typeof J=="string"?(m=m.toLowerCase(),J=J.toLowerCase()):(m=String(m||"").toLowerCase(),J=String(J||"").toLowerCase());if(Z==="asc"){if(m>J)return 1;if(m<J)return-1}else{if(m<J)return 1;if(m>J)return-1}}return 0}),w},[c,y,l,Y,R,s,i,f]),ae=w=>{A(z=>{const K=z.findIndex(Q=>Q.field===w);if(K>=0)if(K===0){const Q=[...z];return Q[0]={...Q[0],direction:Q[0].direction==="asc"?"desc":"asc"},Q}else{const Q=[...z];return Q.splice(K,1)[0],[{field:w,direction:"asc"},...Q]}else return[{field:w,direction:"asc"},...z]})},ie=w=>{v(w==="clear"?[]:w==="party-tier"?["party-tier"]:z=>z.includes(w)?z.filter(K=>K!==w):[...z,w])},te=w=>{G(w==="clear"?[]:z=>z.includes(w)?z.filter(K=>K!==w):[...z,w])},p=Y.length>0,h=R.length>0;return b.useEffect(()=>{const w=K=>{const Q=K.target.closest(".filter-dropdown"),g=K.target.closest(".header-filter-icon");Q||g||(L(!1),T(!1))},z=K=>{K.key==="Escape"&&(L(!1),T(!1))};return document.addEventListener("pointerdown",w,!0),document.addEventListener("mousedown",w,!0),document.addEventListener("touchstart",w,!0),document.addEventListener("click",w,!0),document.addEventListener("keydown",z,!0),()=>{document.removeEventListener("pointerdown",w,!0),document.removeEventListener("mousedown",w,!0),document.removeEventListener("touchstart",w,!0),document.removeEventListener("click",w,!0),document.removeEventListener("keydown",z,!0)}},[L,T]),{searchTerm:y,setSearchTerm:x,sortFields:l,handleSort:ae,filteredAndSortedData:le,loading:I,refreshData:ee,selectedTiers:Y,selectedTypes:R,showTierDropdown:B,setShowTierDropdown:L,showTypeDropdown:j,setShowTypeDropdown:T,tierFilterRef:E,typeFilterRef:D,uniqueTiers:ce,uniqueTypes:O,handleTierSelect:ie,handleTypeSelect:te,isTierFiltered:p,isTypeFiltered:h,getDropdownStyle:w=>{if(!w.current)return{};const z=w.current.getBoundingClientRect();return{position:"fixed",top:z.bottom+4,left:z.left-100,zIndex:99999}}}},Lt=({searchTerm:t,onSearchChange:s,type:i,partyControls:f})=>e.jsxs("div",{style:_.browserHeader,children:[e.jsx("input",{type:"text",placeholder:"Search",value:t,onChange:y=>s(y.target.value),style:_.searchInput}),f&&e.jsx("div",{style:_.partyControls,children:f})]}),Tt=({sortFields:t,onSort:s,type:i,uniqueTiers:f,uniqueTypes:y,selectedTiers:x,selectedTypes:l,showTierDropdown:A,setShowTierDropdown:c,showTypeDropdown:k,setShowTypeDropdown:I,tierFilterRef:P,typeFilterRef:Y,handleTierSelect:v,handleTypeSelect:R,isTierFiltered:G,isTypeFiltered:B,getDropdownStyle:L,costFilter:j,showCostDropdown:T,setShowCostDropdown:E,costFilterRef:D,handleCostFilterSelect:ee,isCostFiltered:H})=>{const[ce,O]=b.useState(null),ae=(()=>i==="adversary"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"cost",label:"Cost",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:i==="environment"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:[])(),ie=()=>{if(!T)return null;const p=[{value:"all",label:"All"},{value:"auto-grey",label:"Auto Grey"},{value:"auto-hide",label:"Auto Hide"}];return Ne.createPortal(e.jsx("div",{className:"filter-dropdown",style:{..._.filterDropdown,...L(D),maxHeight:"60vh",overflow:"auto"},onMouseDown:h=>h.stopPropagation(),onClick:h=>h.stopPropagation(),children:p.map(h=>{const V=j===h.value;return e.jsxs("div",{style:{..._.filterOption,...V?_.filterOptionSelected:{}},onClick:()=>ee(h.value),children:[e.jsx("span",{style:_.checkIcon,children:V?e.jsx(be,{size:16}):e.jsx(je,{size:16})}),e.jsx("span",{style:_.filterLabel,children:h.label})]},h.value)})}),document.body)},te=(p,h,V,w,z,K,Q,g)=>{if(!z)return null;const Z=()=>{(p==="tier"||p==="type")&&w("clear")};return Ne.createPortal(e.jsxs("div",{className:"filter-dropdown",style:{..._.filterDropdown,...L(Q),maxHeight:"60vh",overflow:"auto"},onMouseDown:m=>m.stopPropagation(),onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{style:{..._.filterOption,...V.length===0?_.filterOptionSelected:{}},onClick:Z,children:[e.jsx("span",{style:_.checkIcon,children:V.length===0?e.jsx(be,{size:16}):e.jsx(je,{size:16})}),e.jsx("span",{style:_.filterLabel,children:"All"})]}),p==="tier"&&e.jsxs("div",{style:{..._.filterOption,...V.includes("party-tier")?_.filterOptionSelected:{}},onClick:()=>w("party-tier"),children:[e.jsx("span",{style:_.checkIcon,children:V.includes("party-tier")?e.jsx(be,{size:16}):e.jsx(je,{size:16})}),e.jsx("span",{style:_.filterLabel,children:"Party Tier"})]}),h.map(m=>{const J=V.includes(m.toString());return e.jsxs("div",{style:{..._.filterOption,...J?_.filterOptionSelected:{}},onClick:()=>w(m.toString()),children:[e.jsx("span",{style:_.checkIcon,children:J?e.jsx(be,{size:16}):e.jsx(je,{size:16})}),e.jsx("span",{style:_.filterLabel,children:m})]},m)})]}),document.body)};return e.jsx("tr",{style:_.tableHeader,children:ae.map(p=>e.jsxs("th",{style:{..._.tableHeaderCell,...ce===p.key?_.tableHeaderCellHover:{},position:"relative",...p.key==="name"?{width:"auto",minWidth:"0"}:{},...p.key==="tier"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...p.key==="type"?{width:"80px",minWidth:"80px",maxWidth:"80px"}:{},...p.key==="difficulty"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...p.key==="cost"?{width:"50px",minWidth:"50px",maxWidth:"50px"}:{},...p.key==="action"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{}},onClick:()=>s(p.key),onMouseEnter:()=>O(p.key),onMouseLeave:()=>O(null),children:[p.hasFilter?e.jsxs("div",{style:_.headerWithFilter,children:[e.jsx("span",{style:{cursor:"pointer"},onClick:h=>{h.stopPropagation(),s(p.key)},children:p.label}),e.jsxs("button",{ref:p.key==="tier"?P:p.key==="type"?Y:D,style:{..._.headerFilterIcon,...p.key==="tier"&&G?_.headerFilterIconActive:{},...p.key==="type"&&B?_.headerFilterIconActive:{},...p.key==="cost"&&H?_.headerFilterIconActive:{}},className:"header-filter-icon",onClick:h=>{h.stopPropagation(),p.key==="tier"?(c(!A),I(!1),E(!1)):p.key==="type"?(I(!k),c(!1),E(!1)):p.key==="cost"&&(E(!T),c(!1),I(!1))},children:[e.jsx(ut,{size:14}),p.key==="tier"&&G||p.key==="type"&&B||p.key==="cost"&&H?e.jsx("span",{style:_.filterActiveDot}):null]})]}):p.label,p.key==="tier"&&te("tier",f,x,v,A,c,P),p.key==="type"&&te("type",y,l,R,k,I,Y),p.key==="cost"&&ie()]},p.key))})},Mt=({item:t,onAdd:s,type:i,onRowClick:f,encounterItems:y=[],pcCount:x=4,playerTier:l=1,remainingBudget:A=0,costFilter:c="auto-grey",onAdversaryClick:k})=>{const[I,P]=b.useState(!1),Y=()=>{s(t)},v=()=>{if(i!=="adversary")return null;const B=ve[t.type]||2;let L=0;const j=y.filter(E=>E.type==="adversary"&&E.item.type==="Solo"&&E.quantity>0).reduce((E,D)=>E+D.quantity,0),T=y.filter(E=>E.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(E.item.type)&&E.quantity>0).reduce((E,D)=>E+D.quantity,0);return t.type==="Solo"&&j===1&&(L+=2),["Bruiser","Horde","Leader","Solo"].includes(t.type)&&T===0&&(L+=1),B+L},G=(()=>{if(i==="adversary"){const B=v();ve[t.type];const L=B>A||A<=0;if(c==="auto-hide"&&L)return null;const j=c==="auto-grey"&&L?{opacity:.5,color:"var(--text-secondary)"}:{};return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{..._.rowCell,width:"auto",minWidth:"0",textAlign:"left",...j},children:e.jsxs("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:[e.jsx("div",{style:{fontWeight:"600"},children:t.name}),t.description&&e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"0.125rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.description})]})}),e.jsx("td",{style:{..._.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...j},children:t.tier}),e.jsx("td",{style:{..._.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center",...j},children:t.type}),e.jsx("td",{style:{..._.rowCell,width:"50px",minWidth:"50px",maxWidth:"50px",textAlign:"center",...j},children:B}),e.jsx("td",{style:{..._.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...j},children:t.difficulty})]})}else if(i==="environment")return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{..._.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:t.name}),e.jsx("td",{style:{..._.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:t.tier}),e.jsx("td",{style:{..._.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:t.type}),e.jsx("td",{style:{..._.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:t.difficulty})]});return null})();return G===null?null:e.jsx(e.Fragment,{children:e.jsxs("tr",{style:{..._.row,...I?_.rowHover:{}},onClick:()=>{i==="adversary"&&k?k(t):f&&f(t,i)},onMouseEnter:()=>P(!0),onMouseLeave:()=>P(!1),children:[G,e.jsx("td",{style:{width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",boxSizing:"border-box",overflow:"visible",textOverflow:"unset",whiteSpace:"nowrap"},children:e.jsx("button",{style:_.addButton,onClick:B=>{B.stopPropagation(),Y()},onMouseEnter:B=>{B.target.style.background="var(--bg-secondary)"},onMouseLeave:B=>{B.target.style.background="var(--purple)"},children:"+"})})]})})},Pt=({type:t,onAddItem:s,onCancel:i=null,onRowClick:f,encounterItems:y=[],pcCount:x=4,playerTier:l=1,partyControls:A=null,showContainer:c=!0,savedEncounters:k=[],onLoadEncounter:I,onDeleteEncounter:P,activeTab:Y="adversaries"})=>{const[v,R]=b.useState("all"),[G,B]=b.useState(!1),[L,j]=b.useState(null),[T,E]=b.useState({}),D=b.useRef({}),ee=b.useRef(null),H=W=>{T[W]?(P&&P(W),E(d=>{const C={...d};return delete C[W],C}),D.current[W]&&(clearTimeout(D.current[W]),delete D.current[W])):(E(d=>({...d,[W]:!0})),D.current[W]&&clearTimeout(D.current[W]),D.current[W]=setTimeout(()=>{E(d=>{const C={...d};return delete C[W],C}),delete D.current[W]},3e3))};b.useEffect(()=>()=>{Object.values(D.current).forEach(W=>{clearTimeout(W)})},[]);const{searchTerm:ce,setSearchTerm:O,sortFields:le,handleSort:ae,filteredAndSortedData:ie,loading:te,refreshData:p,selectedTiers:h,selectedTypes:V,showTierDropdown:w,setShowTierDropdown:z,showTypeDropdown:K,setShowTypeDropdown:Q,tierFilterRef:g,typeFilterRef:Z,uniqueTiers:m,uniqueTypes:J,handleTierSelect:o,handleTypeSelect:n,isTierFiltered:a,isTypeFiltered:r,getDropdownStyle:u}=Bt(t,y,x,l),F=(()=>{const W=3*x+2,d=y.reduce((N,oe)=>{if(oe.type==="adversary"){const ue=ve[oe.item.type]||2;if(oe.item.type==="Minion"){const se=Math.ceil(oe.quantity/x);return N+se*ue}else return N+oe.quantity*ue}return N},0);let C=0;y.filter(N=>N.type==="adversary"&&N.item.type==="Solo"&&N.quantity>0).reduce((N,oe)=>N+oe.quantity,0)>=2&&(C+=Se.twoOrMoreSolos);const $=y.some(N=>N.type==="adversary"&&N.item.type==="Bruiser"&&N.quantity>0),X=y.some(N=>N.type==="adversary"&&N.item.type==="Horde"&&N.quantity>0),ne=y.some(N=>N.type==="adversary"&&N.item.type==="Leader"&&N.quantity>0),q=y.some(N=>N.type==="adversary"&&N.item.type==="Solo"&&N.quantity>0);return!$&&!X&&!ne&&!q&&(C+=Se.noBruisersHordesLeadersSolos),W+C-d})(),de=W=>{R(W),B(!1)},re=v!=="all";return te?e.jsx("div",{style:_.browser,children:e.jsx("div",{style:_.loading,children:"Loading..."})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:c?_.browserWrapper:_.browserWrapperNoContainer,children:[Y==="adversaries"&&e.jsxs(e.Fragment,{children:[e.jsx(Lt,{searchTerm:ce,onSearchChange:O,type:t,partyControls:A}),e.jsx("div",{className:"browser-content invisible-scrollbar",style:_.browserContent,children:e.jsxs("table",{style:_.browserTable,children:[e.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,backgroundColor:"var(--bg-primary)"},children:e.jsx(Tt,{sortFields:le,onSort:ae,type:t,uniqueTiers:m,uniqueTypes:J,selectedTiers:h,selectedTypes:V,showTierDropdown:w,setShowTierDropdown:z,showTypeDropdown:K,setShowTypeDropdown:Q,tierFilterRef:g,typeFilterRef:Z,handleTierSelect:o,handleTypeSelect:n,isTierFiltered:a,isTypeFiltered:r,getDropdownStyle:u,costFilter:v,showCostDropdown:G,setShowCostDropdown:B,costFilterRef:ee,handleCostFilterSelect:de,isCostFiltered:re})}),e.jsx("tbody",{children:ie.map(W=>e.jsx(Mt,{item:W,onAdd:s,type:t,onRowClick:f,encounterItems:y,pcCount:x,playerTier:l,remainingBudget:F,costFilter:v,onAdversaryClick:d=>{t==="adversary"&&j(d)}},W.id))})]})})]}),Y==="encounters"&&e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:k.length===0?e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",textAlign:"center",padding:"2rem 1rem"},children:"No saved encounters yet"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:k.map(W=>e.jsxs("div",{onClick:()=>I&&I(W.id),className:"saved-encounter-card",style:{border:"1px solid var(--border)",borderRadius:"8px",padding:"8px",backgroundColor:"var(--bg-card)",transition:"background-color 0.2s ease",display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsxs("div",{style:{minWidth:"100px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",flexDirection:"column",justifyContent:"center",minHeight:"60px"},children:[e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Tier: ",(()=>{var M,$,X,ne;const d=((ne=(X=($=(M=W.encounterItems)==null?void 0:M.filter(q=>q.type==="adversary"))==null?void 0:$.map(q=>q.item.tier))==null?void 0:X.filter(q=>q!=null))==null?void 0:ne.sort((q,U)=>q-U))||[];if(d.length===0)return"N/A";if(d.length===1)return d[0];const C=[...new Set(d)];return C.length===1?C[0]:`${Math.min(...C)}-${Math.max(...C)}`})()]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Party Size: ",W.partySize||4]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)"},children:["Balance: ",(()=>{const d=W.partySize||4,C=3*d+2;let M=0;const $=W.encounterItems||[];$.filter(se=>se.type==="adversary"&&se.item.type==="Solo"&&se.quantity>0).reduce((se,xe)=>se+xe.quantity,0)>=2&&(M+=Se.twoOrMoreSolos);const ne=$.some(se=>se.type==="adversary"&&se.item.type==="Bruiser"&&se.quantity>0),q=$.some(se=>se.type==="adversary"&&se.item.type==="Horde"&&se.quantity>0),U=$.some(se=>se.type==="adversary"&&se.item.type==="Leader"&&se.quantity>0),N=$.some(se=>se.type==="adversary"&&se.item.type==="Solo"&&se.quantity>0);!ne&&!q&&!U&&!N&&(M+=Se.noBruisersHordesLeadersSolos);const oe=C+M,ue=$.reduce((se,xe)=>{if(xe.type==="adversary"){const ye=ve[xe.item.type]||2;if(xe.item.type==="Minion"){const he=Math.ceil(xe.quantity/d);return se+he*ye}else return se+xe.quantity*ye}return se},0);return ue>oe?`+${ue-oe}`:ue===oe?"0":`-${oe-ue}`})()]})]}),e.jsx("div",{style:{minWidth:"120px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",alignItems:"center",minHeight:"60px"},children:e.jsx("div",{style:{fontWeight:"500",color:"var(--text-primary)",fontSize:"0.9rem",wordWrap:"break-word",wordBreak:"break-word",width:"150px",maxWidth:"150px"},children:W.name})}),e.jsx(Wt,{encounter:W}),e.jsx("button",{onClick:d=>{d.stopPropagation(),H(W.id)},style:{background:T[W.id]?"var(--danger)":"var(--gray-600)",border:"none",color:"white",padding:"0.4rem 0.8rem",borderRadius:"4px",fontSize:"0.75rem",cursor:"pointer",minWidth:"60px",transition:"background-color 0.2s"},children:"Delete"})]},W.id))})}),Y==="custom"&&e.jsx(At,{onSave:Nt,onRefresh:p,onAddItem:s})]}),L&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:2e3,display:"flex",alignItems:"center",justifyContent:"center",padding:"2rem"},onClick:()=>j(null),children:e.jsx("div",{style:{maxWidth:"600px",width:"90vw",maxHeight:"80vh",overflowY:"auto"},onClick:W=>W.stopPropagation(),children:e.jsx(Pe,{item:L,type:"adversary",mode:"expanded",onClose:()=>j(null)})})})]})},_={browserWrapper:{display:"flex",flexDirection:"column",background:"var(--bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border)",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserWrapperNoContainer:{display:"flex",flexDirection:"column",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserContent:{flex:1,overflowY:"auto",overflowX:"visible",padding:0,width:"100%",scrollbarWidth:"none",msOverflowStyle:"none"},tableHeaderContainer:{flexShrink:0,position:"sticky",top:0,zIndex:15,backgroundColor:"var(--bg-secondary)"},browserTable:{width:"100%",minWidth:"100%",borderCollapse:"collapse",tableLayout:"fixed",background:"var(--bg-primary)",margin:0},browserHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--gray-900)",flexShrink:0,position:"sticky",top:0,zIndex:20},browserTitle:{margin:0,color:"var(--text-primary)",fontSize:"18px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"24px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",marginRight:"12px",transition:"all 0.2s ease"},partyControls:{display:"flex",alignItems:"center",gap:"12px",flexShrink:0},searchInputFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 3px rgba(139, 92, 246, 0.1)"},tableHeader:{background:"var(--gray-900)",borderBottom:"1px solid var(--border)",boxShadow:"0 1px 0 var(--border)",position:"sticky",top:"0",zIndex:10},tableHeaderCell:{backgroundColor:"var(--gray-900)",fontWeight:"700",borderBottom:"1px solid var(--border)",cursor:"pointer",userSelect:"none",minWidth:"100px",whiteSpace:"nowrap",padding:"4px 4px",color:"var(--text-primary)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",boxShadow:"0 1px 0 var(--border)",transition:"background-color 0.2s",position:"sticky",top:"0",zIndex:10},tableHeaderCellHover:{backgroundColor:"var(--bg-hover)"},sortIndicator:{fontSize:"12px",color:"var(--text-secondary)"},tableBody:{flex:1,overflowY:"auto",padding:"8px",backgroundColor:"var(--bg-primary)"},row:{height:"35px",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s ease",cursor:"pointer",backgroundColor:"var(--gray-900)"},rowHover:{backgroundColor:"var(--bg-secondary)"},expandedRow:{backgroundColor:"var(--bg-secondary)"},rowCell:{padding:"4px 4px",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid var(--border)"},rowCellName:{fontWeight:"500",minWidth:"150px"},rowCellCenter:{textAlign:"center",justifyContent:"center",minWidth:"80px"},rowActions:{width:"80px",textAlign:"center",padding:"4px 8px",borderBottom:"1px solid var(--border)"},addButton:{width:"2rem",height:"2rem",border:"1px solid var(--purple)",borderRadius:"var(--radius-sm)",background:"var(--purple)",color:"white",cursor:"pointer",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"500"},expandedContent:{padding:"0",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)"},columnName:{width:"auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",paddingLeft:"8px",textAlign:"left"},columnTier:{width:"80px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnType:{width:"100px",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},columnDifficulty:{width:"40px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnAction:{width:"32px",minWidth:"24px",maxWidth:"24px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"visible",textOverflow:"unset"},loading:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"var(--text-primary)",fontSize:"16px"},mobileBrowser:{width:"95vw",height:"90vh",maxWidth:"none"},mobileSearchInput:{fontSize:"16px"},headerWithFilter:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0px",position:"relative"},headerFilterIcon:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"2px 4px",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",position:"relative",marginLeft:"-2px"},headerFilterIconActive:{color:"var(--purple)"},filterIcon:{fontSize:"12px"},filterActiveDot:{position:"absolute",left:"50%",top:"2px",transform:"translateX(-50%)",width:"4px",height:"4px",borderRadius:"50%",background:"var(--purple)",pointerEvents:"none"},filterDropdown:{position:"fixed",background:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",zIndex:99999,marginTop:"4px",overflow:"hidden",width:"max-content",minWidth:"120px",maxWidth:"200px"},filterOption:{padding:"8px 12px",cursor:"pointer",color:"var(--text-primary)",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background-color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},filterOptionSelected:{backgroundColor:"var(--bg-hover)"},checkIcon:{width:"16px",height:"16px",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"12px"},filterLabel:{flex:1}},Dt=()=>e.jsx("div",{className:"pwa-install-prompt",style:{}}),Ht=({side:t="left",children:s,className:i="",style:f={}})=>{const y=t==="left",x={flex:1,minWidth:0,background:"var(--bg-primary)",overflowY:"auto",overflowX:y?"auto":"hidden",display:y?"block":"flex",flexDirection:y?"initial":"column",height:"100%",padding:y?"8px 0 8px 0":"0 8px 0 0",...f};return e.jsx("div",{className:i,style:x,children:s})},Ft=t=>3*t+2,Ot={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},Re={lessDifficult:-1,twoOrMoreSolos:-2,increasedDamage:-2,lowerTierAdversary:1,noBruisersHordesLeadersSolos:1,moreDangerous:2},$t=({isOpen:t,onClose:s,onAddAdversary:i,onAddAdversariesBulk:f,onAddEnvironment:y,onDeleteAdversary:x,onDeleteEnvironment:l,onDeleteCountdown:A,adversaries:c=[],environments:k=[],countdowns:I=[],savedEncounters:P=[],onSaveEncounter:Y,onLoadEncounter:v,onDeleteEncounter:R})=>{const{partySize:G,updatePartySize:B,currentEncounterName:L,updateCurrentEncounterName:j}=Je(),T=G,E=B,[D,ee]=b.useState({lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),[H,ce]=b.useState([]),[O,le]=b.useState(L||"Encounter"),[ae,ie]=b.useState("adversaries"),[te,p]=b.useState(null),[h,V]=b.useState(null);b.useEffect(()=>{t&&!te&&le(L||"Encounter")},[t,te,L]);const w=()=>h?O!==h.name||JSON.stringify(H)!==JSON.stringify(h.encounterItems)||T!==h.partySize||JSON.stringify(D)!==JSON.stringify(h.battlePointsAdjustments):!1,z=()=>{var d;if(H.length>0||(O||"").trim()!=="Encounter")return!0;if(te&&w()){if(h){const C=H.length,M=((d=h.encounterItems)==null?void 0:d.length)||0;if(C!==M||(O||"").trim()!==(h.name||""))return!0;const $=JSON.stringify(D),X=JSON.stringify(h.battlePointsAdjustments||{});return $!==X}return!0}return!1},K=({onClick:d,children:C,variant:M="secondary",isConfirmation:$=!1})=>{const X=M==="danger"||M==="secondary"&&$,ne=M==="purple";return e.jsx("button",{onClick:d,style:{background:X?"var(--danger)":ne?"var(--purple)":"var(--bg-secondary)",border:ne?"none":"1px solid var(--border)",color:X||ne?"white":"var(--text-primary)",padding:"0.375rem 0.75rem",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s",width:"70px",fontSize:"0.875rem"},children:C})},Q=ge.useRef(T),g=b.useCallback(d=>!d||d.length===0?null:P.find(M=>{var q,U;if(((q=M.encounterItems)==null?void 0:q.length)!==d.length)return!1;const $=N=>{var oe;return{type:N.type,quantity:N.quantity,item:{name:N.item.baseName||((oe=N.item.name)==null?void 0:oe.replace(/\s+\(\d+\)$/,""))||N.item.name,type:N.item.type,tier:N.item.tier}}},X=(U=M.encounterItems)==null?void 0:U.map($).sort((N,oe)=>N.item.name.localeCompare(oe.item.name)||N.item.type.localeCompare(oe.item.type)),ne=d.map($).sort((N,oe)=>N.item.name.localeCompare(oe.item.name)||N.item.type.localeCompare(oe.item.type));return JSON.stringify(X)===JSON.stringify(ne)})||null,[P]);ge.useEffect(()=>{if(t&&c.length>0&&H.length===0){const d={};c.forEach($=>{var ne;const X=$.baseName||((ne=$.name)==null?void 0:ne.replace(/\s+\(\d+\)$/,""))||$.name;d[X]||(d[X]={type:"adversary",item:$,quantity:0}),d[X].quantity+=1});const C=Object.values(d);ce(C);const M=g(C);M&&!te&&(p(M.id),V({name:M.name||"",encounterItems:M.encounterItems||[],partySize:M.partySize||4,battlePointsAdjustments:M.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),le(M.name||"Encounter"),j(M.name||"Encounter"))}else t&&c.length===0&&H.length===0&&ce([])},[t,g,te,j]);const Z=ge.useMemo(()=>{let d=0;H.filter(q=>q.type==="adversary"&&q.item.type==="Solo"&&q.quantity>0).reduce((q,U)=>q+U.quantity,0)>=2&&(d+=Re.twoOrMoreSolos);const M=H.some(q=>q.type==="adversary"&&q.item.type==="Bruiser"&&q.quantity>0),$=H.some(q=>q.type==="adversary"&&q.item.type==="Horde"&&q.quantity>0),X=H.some(q=>q.type==="adversary"&&q.item.type==="Leader"&&q.quantity>0),ne=H.some(q=>q.type==="adversary"&&q.item.type==="Solo"&&q.quantity>0);return!M&&!$&&!X&&!ne&&(d+=Re.noBruisersHordesLeadersSolos),d},[H]),m=Ft(T),J=Object.entries(D).filter(([d,C])=>C).reduce((d,[C,M])=>d+Re[C],0),o=m+J+Z,n=H.reduce((d,C)=>{if(C.type==="adversary"){const M=Ot[C.item.type]||2;return C.item.type==="Minion"?d+Math.ceil(C.quantity/T)*M:d+M*C.quantity}return d},0);ge.useEffect(()=>{const d=Q.current;d!==T&&(ce(C=>C.map(M=>{if(M.type==="adversary"&&M.item.type==="Minion"){const X=Math.ceil(M.quantity/d)*T;return{...M,quantity:X}}return M})),Q.current=T)},[T]);const a=(d,C)=>{const M=H.findIndex(ne=>ne.item.id===d.id&&ne.type===C),$=d.type==="Minion"?T:1;let X;M>=0?X=H.map((ne,q)=>q===M?{...ne,quantity:ne.quantity+$}:ne):X=[...H,{item:d,type:C,quantity:$}],ce(X),r(X)},r=d=>{const C=c||[],M=[];d.forEach(U=>{for(let N=0;N<U.quantity;N++)U.type==="adversary"&&M.push(U.item)});const $={};C.forEach(U=>{var oe;const N=U.baseName||((oe=U.name)==null?void 0:oe.replace(/\s+\(\d+\)$/,""))||U.name;$[N]||($[N]=[]),$[N].push(U)});const X={};M.forEach(U=>{var oe;const N=U.baseName||((oe=U.name)==null?void 0:oe.replace(/\s+\(\d+\)$/,""))||U.name;X[N]||(X[N]=[]),X[N].push(U)});const ne=[],q=[];Object.keys(X).forEach(U=>{var ue;const N=((ue=$[U])==null?void 0:ue.length)||0,oe=X[U].length;if(oe>N){const se=oe-N;for(let xe=0;xe<se;xe++)ne.push(X[U][0])}else if(oe<N){const se=N-oe,ye=[...$[U]].sort((he,Ke)=>{const Qe=he.duplicateNumber||1;return(Ke.duplicateNumber||1)-Qe});for(let he=0;he<se;he++)q.push(ye[he].id)}}),Object.keys($).forEach(U=>{X[U]||[...$[U]].sort((ue,se)=>{const xe=ue.duplicateNumber||1;return(se.duplicateNumber||1)-xe}).forEach(ue=>{q.push(ue.id)})}),q.forEach(U=>{x(U)}),ne.length>0&&f(ne)},u=(d,C)=>{const M=(()=>{const $=H.findIndex(X=>X.item.id===d&&X.type===C);if($>=0){const X=H[$];if(X.quantity===0)return H.filter((U,N)=>N!==$);const ne=X.item.type==="Minion"?T:1,q=Math.max(0,X.quantity-ne);return H.map((U,N)=>N===$?{...U,quantity:q}:U)}return H})();ce(M),r(M)},S=b.useCallback(()=>{if(H.length===0)return null;const d=(O||"").trim()||"Encounter",C=P.find(M=>{var ne,q;if(M.name!==d||((ne=M.encounterItems)==null?void 0:ne.length)!==H.length)return!1;const $=JSON.stringify((q=M.encounterItems)==null?void 0:q.sort()),X=JSON.stringify([...H].sort());return $===X});return(C==null?void 0:C.id)||null},[P,O,H]),F=b.useCallback(()=>{let d=(O||"").trim(),C=te;if(C||(C=S()),H.length===0&&(!d||d==="Encounter")&&C){R(C),p(null),V(null);return}const M={name:d,encounterItems:H,partySize:T,battlePointsAdjustments:D};if(C){M.id=C;const $=Y(M);p($)}else{const $=Y(M);p($)}V({name:d,encounterItems:H,partySize:T,battlePointsAdjustments:D})},[H,O,T,D,te,Y,S,R]);b.useEffect(()=>{if(te&&w()){const d=setTimeout(()=>{F()},2e3);return()=>clearTimeout(d)}else if(!te&&H.length>0&&O&&O.trim()!==""){const d=setTimeout(()=>{F()},2e3);return()=>clearTimeout(d)}},[H,te,O,D,T]);const de=()=>{z()&&(ce([]),le("Encounter"),j("Encounter"),p(null),V(null),c.forEach(d=>{x(d.id)}),k.forEach(d=>{l(d.id)}),I.forEach(d=>{A(d.id)}))},re=d=>{const C=v(d);if(C){const M=C.encounterItems||[];ce(M),E(C.partySize||4),ee(C.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),le(C.name||""),j(C.name||""),p(d),V({name:C.name||"",encounterItems:C.encounterItems||[],partySize:C.partySize||4,battlePointsAdjustments:C.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),r(M)}},W=d=>{R(d),te===d&&(ce([]),le("Encounter"),j("Encounter"),p(null),V(null),c.forEach(C=>{x(C.id)}),k.forEach(C=>{l(C.id)}),I.forEach(C=>{A(C.id)}))};return t?e.jsx("div",{onClick:s,className:"encounter-builder-modal",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:1e3,display:"flex",alignItems:"flex-start",justifyContent:"center",padding:"12px"},children:e.jsxs("div",{onClick:d=>d.stopPropagation(),style:{backgroundColor:"var(--bg-primary)",border:"2px solid var(--border)",borderRadius:"12px",width:"100%",maxWidth:"1200px",height:"calc(100vh - 24px)",height:"calc(100dvh - 24px)",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"},children:[e.jsxs("div",{className:"encounter-top-bar",style:{flex:"0 0 auto",display:"flex",alignItems:"center",height:"39px",backgroundColor:"var(--bg-primary)"},children:[e.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center"},children:[e.jsx("button",{onClick:()=>ie("adversaries"),style:{flex:1,background:ae==="adversaries"?"var(--gray-900)":"transparent",border:"none",borderBottom:"1px solid var(--border)",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:ae==="adversaries"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Adversaries"}),e.jsx("button",{onClick:()=>ie("encounters"),style:{flex:1,background:ae==="encounters"?"var(--gray-900)":"transparent",border:"none",borderBottom:"1px solid var(--border)",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:ae==="encounters"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Encounters"}),e.jsx("button",{onClick:()=>ie("custom"),style:{flex:1,background:ae==="custom"?"var(--gray-900)":"transparent",border:"none",borderBottom:"1px solid var(--border)",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:ae==="custom"?"500":"400",transition:"all 0.2s ease",position:"relative"},children:"Custom Adversary"})]}),e.jsx("div",{className:"encounter-receipt-buttons",style:{flex:"0 0 350px",display:"flex",alignItems:"flex-start",justifyContent:"center",borderLeft:"1px solid var(--border)",height:"100%",padding:"1rem 0.75rem"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:O,onChange:d=>{le(d.target.value),j(d.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(K,{onClick:de,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:z()?1:.5,cursor:z()?"pointer":"not-allowed"},children:"New"})]})})]}),e.jsxs("div",{className:"encounter-builder-content",style:{flex:1,display:"flex",overflow:"hidden"},children:[e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",borderTop:"1px solid var(--border)"},children:e.jsx(Pt,{type:"adversary",onAddItem:d=>a(d,"adversary"),encounterItems:H,pcCount:T,showContainer:!1,savedEncounters:P,onLoadEncounter:re,onDeleteEncounter:W,activeTab:ae})}),e.jsxs("div",{className:"encounter-right-panel",style:{flex:"0 0 350px",borderLeft:"1px solid var(--border)",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx("div",{className:"receipt-content",style:{padding:"1rem",display:"flex",flexDirection:"column",height:"100%"},children:e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"flex-start",overflowY:"auto",marginBottom:"0.75rem"},children:[e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>E(Math.max(1,T-1)),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(He,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:T}),e.jsx("button",{onClick:()=>E(T+1),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(Fe,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Party Size"})}),e.jsx("div",{style:{width:"120px",textAlign:"right"}})]}),H.map(d=>{var C;return d.type!=="adversary"?null:e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>u(d.item.id,d.type),style:{background:d.quantity===0?"var(--danger)":"var(--bg-secondary)",border:d.quantity===0?"none":"1px solid var(--border)",color:d.quantity===0?"white":"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:d.quantity===0?e.jsx(Me,{size:10}):e.jsx(He,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:d.quantity}),e.jsx("button",{onClick:()=>a(d.item,d.type),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(Fe,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:d.item.baseName||((C=d.item.name)==null?void 0:C.replace(/\s+\(\d+\)$/,""))||d.item.name})}),e.jsx("div",{style:{width:"80px",textAlign:"right"},children:e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.8rem"},children:d.item.type})})]},`${d.item.id}-${d.type}`)}),e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Balance"})}),e.jsx("div",{style:{width:"120px",textAlign:"right",display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsx("span",{style:{color:n>o?"var(--danger)":n===o?"var(--purple)":"var(--success)",fontWeight:600},children:n>o?`+${n-o}`:o-n===0?"0":`-${o-n}`})})]})]})}),e.jsx("div",{className:"encounter-receipt-buttons-vertical",style:{display:"none",padding:"0.75rem",borderTop:"1px solid var(--border)",backgroundColor:"var(--bg-primary)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:O,onChange:d=>{le(d.target.value),j(d.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",color:"var(--text-primary)",fontSize:"0.875rem"}}),e.jsx(K,{onClick:de,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:z()?1:.5,cursor:z()?"pointer":"not-allowed"},children:"New"})]})})]})]})]})}):null};class qt extends ge.Component{constructor(s){super(s),this.state={hasError:!1,error:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,i){console.error("ErrorBoundary caught an error:",s,i)}render(){var s;return this.state.hasError?e.jsxs("div",{className:"p-md text-red",children:[e.jsx("h3",{children:"Something went wrong:"}),e.jsx("pre",{children:(s=this.state.error)==null?void 0:s.toString()}),e.jsx("button",{className:"btn-base btn-text",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try again"})]}):this.props.children}}const _t=()=>{const{adversaries:t,environments:s,countdowns:i,fear:f,savedEncounters:y,updateFear:x,createAdversary:l,createAdversariesBulk:A,updateAdversary:c,deleteAdversary:k,createEnvironment:I,updateEnvironment:P,deleteEnvironment:Y,createCountdown:v,updateCountdown:R,deleteCountdown:G,advanceCountdown:B,saveEncounter:L,loadEncounter:j,deleteEncounter:T}=Je(),[E,D]=b.useState(!1),[ee,H]=b.useState(!1);b.useState(!1);const[ce,O]=b.useState(!1);b.useState(!0);const[le,ae]=b.useState(null),[ie,te]=b.useState(0),[p,h]=b.useState(0),[V,w]=b.useState(!1);b.useEffect(()=>{const r=()=>{const S=window.matchMedia("(max-width: 800px)");D(S.matches)};r();const u=window.matchMedia("(max-width: 800px)");return u.addEventListener("change",r),()=>u.removeEventListener("change",r)},[]);const z=12,K=r=>r===1?200:350,Q=r=>{if(r<=0)return{visibleColumns:1,columnWidth:K(1)};const u=z*2,S=r-u;let F={visibleColumns:1,columnWidth:S};for(let re=1;re<=5;re++){const W=(re-1)*z,d=(S-W)/re;d>=K(re)&&re*d+W<=S&&(F={visibleColumns:re,columnWidth:d})}return F.visibleColumns*F.columnWidth+(F.visibleColumns-1)*z>S&&(F={visibleColumns:1,columnWidth:S}),F},{visibleColumns:g,columnWidth:Z}=Q(ie);b.useEffect(()=>{const r=()=>{te(window.innerWidth)};return r(),window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]);const m=()=>{H(!0)},J=b.useCallback(()=>{H(!1)},[]),o=b.useCallback(r=>{h(r.target.scrollLeft)},[]);b.useCallback(()=>{w(!0)},[]),b.useCallback(()=>{setTimeout(()=>w(!1),100)},[]);const a=(()=>{const r={};return t.forEach(u=>{var F;const S=u.baseName||((F=u.name)==null?void 0:F.replace(/\s+\(\d+\)$/,""))||u.name;r[S]||(r[S]={type:"adversary",baseName:S,instances:[]}),r[S].instances.push(u)}),s.forEach(u=>{r[u.name]||(r[u.name]={type:"environment",baseName:u.name,instances:[]}),r[u.name].instances.push(u)}),i.forEach(u=>{r[`countdown-${u.id}`]={type:"countdown",baseName:u.name,instances:[u]}}),Object.values(r)})();return a.length,e.jsxs("div",{className:"app",onClick:r=>{r.target,r.currentTarget},children:[e.jsx(Ct,{adversaries:t,environments:s,countdowns:i,deleteAdversary:k,deleteEnvironment:Y,deleteCountdown:G,isClearMode:ce,setIsClearMode:O,sortAdversaries:()=>{},onOpenDatabase:m}),e.jsx("div",{className:"main-content",style:{position:"relative",width:"100%"},children:e.jsx("div",{className:"dashboard-scroll-container",style:{display:"flex",flexDirection:"row",overflowX:"auto",overflowY:"hidden",padding:`0 ${z}px`,scrollSnapType:"x mandatory",height:"100%",width:"100%"},onScroll:o,children:a.length===0?e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",width:"100%",padding:"2rem"},children:e.jsx("button",{onClick:m,style:{backgroundColor:"transparent",color:"var(--text-secondary)",border:"2px dashed var(--border)",borderRadius:"var(--radius-md)",padding:"1rem 2rem",fontSize:"1rem",fontWeight:"500",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:r=>{r.target.style.borderColor="var(--purple)",r.target.style.color="var(--purple)"},onMouseLeave:r=>{r.target.style.borderColor="var(--border)",r.target.style.color="var(--text-secondary)"},children:"Create Encounter"})}):a.map((r,u)=>e.jsx(Ht,{className:"invisible-scrollbar",style:{width:`${Z+z}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:`${z}px`,paddingRight:"0",paddingTop:`${z}px`,paddingBottom:`${z}px`,scrollSnapAlign:"start",overflowY:"auto",overflowX:"hidden"},children:e.jsx(Pe,{type:r.type,item:{...r.instances[0],name:r.baseName,hp:0,stress:0,isDead:!1},mode:"expanded",instances:r.instances,onApplyDamage:r.type==="adversary"?(S,F,de,re)=>{const W=r.instances.find(d=>d.id===S);W&&c(S,{hp:Math.min(W.hpMax||1,(W.hp||0)+F)})}:void 0,onApplyHealing:r.type==="adversary"?(S,F,de)=>{const re=r.instances.find(W=>W.id===S);re&&c(S,{hp:Math.max(0,(re.hp||0)-F)})}:void 0,onApplyStressChange:r.type==="adversary"?(S,F)=>{var de,re;return c(S,{stress:Math.max(0,Math.min(((de=r.instances.find(W=>W.id===S))==null?void 0:de.stressMax)||6,(((re=r.instances.find(W=>W.id===S))==null?void 0:re.stress)||0)+F))})}:void 0,onUpdate:r.type==="adversary"?c:r.type==="environment"?P:R,adversaries:t})},`${r.type}-${r.baseName}`))})}),e.jsx(St,{position:"bottom",children:e.jsx(Le,{type:"fear",value:(f==null?void 0:f.value)||0,maxValue:12,onChange:x,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0})}),e.jsx($t,{isOpen:ee,onClose:J,onAddAdversary:r=>{l(r),ae("adversary")},onAddAdversariesBulk:r=>{A(r),ae("adversary")},onAddEnvironment:r=>{I(r),ae("environment")},onDeleteAdversary:k,onDeleteEnvironment:Y,onDeleteCountdown:G,adversaries:t,environments:s,countdowns:i,savedEncounters:y,onSaveEncounter:L,onLoadEncounter:j,onDeleteEncounter:T}),e.jsx(Dt,{})]})},Vt=()=>e.jsx(qt,{children:e.jsx(_t,{})});Be.createRoot(document.getElementById("root")).render(e.jsx(ge.StrictMode,{children:e.jsx(vt,{children:e.jsx(Vt,{})})}));
