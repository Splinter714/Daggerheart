import{r as j,a as Fe,R as we}from"./dndkit-57209f9c.js";import{F as ot,f as st,a as at,b as it,c as _e}from"./fa-b4bcccb0.js";import{D as Ze,A as lt,C as dt,T as ct,S as pt,M as ut,X as qe,E as mt,H as xt,L as ht,a as ft,F as gt,b as ze,c as We,d as Ge,P as Ye}from"./lucide-c371f2a3.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const g of document.querySelectorAll('link[rel="modulepreload"]'))h(g);new MutationObserver(g=>{for(const x of g)if(x.type==="childList")for(const c of x.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&h(c)}).observe(document,{childList:!0,subtree:!0});function d(g){const x={};return g.integrity&&(x.integrity=g.integrity),g.referrerPolicy&&(x.referrerPolicy=g.referrerPolicy),g.crossOrigin==="use-credentials"?x.credentials="include":g.crossOrigin==="anonymous"?x.credentials="omit":x.credentials="same-origin",x}function h(g){if(g.ep)return;g.ep=!0;const x=d(g);fetch(g.href,x)}})();var Ue={exports:{}},De={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yt=j,vt=Symbol.for("react.element"),bt=Symbol.for("react.fragment"),jt=Object.prototype.hasOwnProperty,wt=yt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ct={key:!0,ref:!0,__self:!0,__source:!0};function et(t,s,d){var h,g={},x=null,c=null;d!==void 0&&(x=""+d),s.key!==void 0&&(x=""+s.key),s.ref!==void 0&&(c=s.ref);for(h in s)jt.call(s,h)&&!Ct.hasOwnProperty(h)&&(g[h]=s[h]);if(t&&t.defaultProps)for(h in s=t.defaultProps,s)g[h]===void 0&&(g[h]=s[h]);return{$$typeof:vt,type:t,key:x,ref:c,props:g,_owner:wt.current}}De.Fragment=bt;De.jsx=et;De.jsxs=et;Ue.exports=De;var e=Ue.exports,Oe={},Je=Fe;Oe.createRoot=Je.createRoot,Oe.hydrateRoot=Je.hydrateRoot;function be(t){const s=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return t?`${t}-${s}`:s}const tt=j.createContext();function Le(t){if(typeof localStorage>"u")return null;try{const s=localStorage.getItem(t);return s==null?null:JSON.parse(s)}catch{return null}}function je(t,s){if(!(typeof localStorage>"u"))try{localStorage.setItem(t,JSON.stringify(s))}catch{}}const St=({children:t})=>{const[s,d]=j.useState({fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],currentEncounterName:"Encounter"}),[h,g]=j.useState(!1),[x,c]=j.useState({adversaries:[],environments:[]});j.useEffect(()=>{var n,l,E,A;const r=Le("daggerheart-game-state");if(r)try{(((n=r.adversaries)==null?void 0:n.length)>0||((l=r.environments)==null?void 0:l.length)>0||((E=r.countdowns)==null?void 0:E.length)>0||((A=r.savedEncounters)==null?void 0:A.length)>0)&&d(r)}catch(H){console.error("Failed to load saved state:",H)}const o=Le("daggerheart-custom-adversaries")||[],a=Le("daggerheart-custom-environments")||[];c({adversaries:o,environments:a}),g(!0)},[]),j.useEffect(()=>{je("daggerheart-game-state",s)},[s]);const I=r=>{d(o=>({...o,fear:{...o.fear,value:r}}))},i=()=>{d(r=>({...r,fear:{...r.fear,visible:!r.fear.visible}}))},S=r=>{d(o=>({...o,partySize:Math.max(1,r)}))},k=r=>{d(o=>({...o,currentEncounterName:r||"Encounter"}))},z=r=>{if(r.id)return d(o=>({...o,savedEncounters:(o.savedEncounters||[]).map(a=>a.id===r.id?{...a,name:r.name||a.name,encounterItems:r.encounterItems||a.encounterItems,partySize:r.partySize||a.partySize,battlePointsAdjustments:r.battlePointsAdjustments||a.battlePointsAdjustments,updatedAt:new Date().toISOString()}:a)})),r.id;{const o={id:be("encounter"),name:r.name||"Encounter",createdAt:new Date().toISOString(),encounterItems:r.encounterItems||[],partySize:r.partySize||4,battlePointsAdjustments:r.battlePointsAdjustments||{}};return d(a=>({...a,savedEncounters:[...a.savedEncounters||[],o]})),o.id}},q=r=>(s.savedEncounters||[]).find(a=>a.id===r),v=r=>{const o={id:be("encounter"),name:r.name||`Encounter ${Date.now()}`,createdAt:new Date().toISOString(),encounterItems:r.encounterItems||[],partySize:r.partySize||4,battlePointsAdjustments:r.battlePointsAdjustments||{}};return d(a=>({...a,savedEncounters:[...a.savedEncounters||[],o]})),o.id},W=r=>{d(o=>({...o,savedEncounters:(o.savedEncounters||[]).filter(a=>a.id!==r)}))},Y=j.useRef(s);j.useEffect(()=>{Y.current=s},[s]);const f={gameState:s,isLoaded:h,customContent:x,updateFear:I,toggleFearVisibility:i,updatePartySize:S,updateCurrentEncounterName:k,saveEncounter:z,saveEncounterAs:v,loadEncounter:q,deleteEncounter:W,createCountdown:r=>{const o={id:be("countdown"),name:r.name||"Countdown",max:parseInt(r.max)||1,value:0,visible:!0,type:r.type||"standard",loop:r.loop||"none",source:r.source||"campaign"};d(a=>({...a,countdowns:[...a.countdowns,o]}))},updateCountdown:(r,o)=>{d(a=>({...a,countdowns:a.countdowns.map(n=>n.id===r?{...n,...o}:n)}))},deleteCountdown:r=>{d(o=>({...o,countdowns:o.countdowns.filter(a=>a.id!==r)}))},advanceCountdown:(r,o)=>{d(a=>({...a,countdowns:a.countdowns.map(n=>{if(n.id!==r)return n;let l=o;if(n.loop==="loop")l>n.max?l=(l-1)%n.max+1:l<0&&(l=n.max);else if(n.loop==="increasing"){if(l>n.max)return{...n,max:n.max+1,value:1};if(l<0)return{...n,max:Math.max(1,n.max-1),value:1};l=Math.max(0,l)}else if(n.loop==="decreasing"){if(l>n.max)return{...n,max:Math.max(1,n.max-1),value:1};if(l<0)return{...n,max:n.max+1,value:1};l=Math.min(n.max,l)}else l=Math.max(0,Math.min(l,n.max));return{...n,value:l}})}))},incrementCountdown:(r,o=1)=>{d(a=>({...a,countdowns:a.countdowns.map(n=>{if(n.id!==r)return n;let l=n.value+o;if(n.loop==="loop")l>n.max&&(l=(l-1)%n.max+1);else if(n.loop==="increasing"){if(l>n.max)return{...n,max:n.max+1,value:1}}else if(n.loop==="decreasing"){if(l>n.max)return{...n,max:Math.max(1,n.max-1),value:1}}else l=Math.min(l,n.max);return{...n,value:l}})}))},decrementCountdown:r=>{d(o=>({...o,countdowns:o.countdowns.map(a=>{if(a.id!==r)return a;let n=a.value-1;if(a.loop==="loop")n<0&&(n=a.max);else if(a.loop==="increasing"){if(n<0)return{...a,max:Math.max(1,a.max-1),value:a.max};n=Math.max(0,n)}else if(a.loop==="decreasing"){if(n<0)return{...a,max:a.max+1,value:1}}else n=Math.max(0,n);return{...a,value:n}})}))},reorderCountdowns:r=>{d(o=>{const[a,n]=r,l=[...o.countdowns],[E]=l.splice(a,1);return l.splice(n,0,E),{...o,countdowns:l}})},createAdversary:r=>{var H;const o=be("adv"),a=s.adversaries||[],n=r.baseName||((H=r.name)==null?void 0:H.replace(/\s+\(\d+\)$/,""))||r.name||"Unknown",l=a.filter(U=>U.baseName===n);let E=1;if(l.length===0)E=1;else{const U=l.map(u=>u.duplicateNumber||1);let T=1;for(;U.includes(T);)T++;E=T}const A={...r,id:o,baseName:n,duplicateNumber:E,name:`${n} (${E})`,hp:0,stress:0,isVisible:!0};d(U=>({...U,adversaries:[...U.adversaries,A]}))},createAdversariesBulk:r=>{const o=[],a={};r.forEach(n=>{var C;const l=n.baseName||((C=n.name)==null?void 0:C.replace(/\s+\(\d+\)$/,""))||n.name||"Unknown",H=(s.adversaries||[]).filter(B=>B.baseName===l).length,U=a[l]||0,T=H+U+1;a[l]=U+1;const u={...n,id:be("adv"),baseName:l,duplicateNumber:T,name:`${l} (${T})`,hp:0,stress:0,isVisible:!0};o.push(u)}),d(n=>({...n,adversaries:[...n.adversaries,...o]}))},updateAdversary:(r,o)=>{d(a=>({...a,adversaries:a.adversaries.map(n=>{if(n.id===r){const l={...n,...o};if(o.baseName!==void 0){const E=o.baseName,A=l.duplicateNumber||1;l.name=A===1?E:`${E} (${A})`}return l}return n})}))},deleteAdversary:r=>{d(o=>({...o,adversaries:o.adversaries.filter(a=>a.id!==r)}))},clearAllAdversaries:()=>{d(r=>({...r,adversaries:[]}))},reorderAdversaries:r=>{d(o=>{const[a,n]=r,l=[...o.adversaries],[E]=l.splice(a,1);return l.splice(n,0,E),{...o,adversaries:l}})},bulkReorderAdversaries:r=>{d(o=>({...o,adversaries:r}))},createEnvironment:r=>{const o=be("env"),n=(s.environments||[]).filter(A=>A.name.replace(/\s+\(\d+\)$/,"")===r.name);let l=r.name||"Unknown";if(n.length===0)l=r.name;else if(n.length===1){const A=n[0],H=A.name.replace(/\s+\(\d+\)$/,""),U=s.environments.map(T=>T.id===A.id?{...T,name:`${H} (1)`}:T);d(T=>({...T,environments:U})),l=`${r.name} (2)`}else{const A=n.map(U=>{const T=U.name.match(/\((\d+)\)$/);return T?parseInt(T[1]):null}).filter(U=>U!==null);let H=1;for(;A.includes(H);)H++;l=`${r.name} (${H})`}const E={...r,id:o,name:l,isVisible:!0};d(A=>({...A,environments:[...A.environments,E]}))},updateEnvironment:(r,o)=>{d(a=>({...a,environments:a.environments.map(n=>n.id===r?{...n,...o}:n)}))},deleteEnvironment:r=>{d(o=>({...o,environments:o.environments.filter(a=>a.id!==r)}))},reorderEnvironments:r=>{d(o=>{const[a,n]=r,l=[...o.environments],[E]=l.splice(a,1);return l.splice(n,0,E),{...o,environments:l}})},addCustomAdversary:r=>{const o={...r,id:be("custom-adv"),source:r.source||"Homebrew",isCustom:!0};return c(a=>({...a,adversaries:[...a.adversaries,o]})),je("daggerheart-custom-adversaries",[...x.adversaries,o]),o.id},addCustomEnvironment:r=>{const o={...r,id:be("custom-env"),source:r.source||"Homebrew",isCustom:!0};return c(a=>({...a,environments:[...a.environments,o]})),je("daggerheart-custom-environments",[...x.environments,o]),o.id},updateCustomAdversary:(r,o)=>{c(n=>({...n,adversaries:n.adversaries.map(l=>l.id===r?{...l,...o}:l)}));const a=x.adversaries.map(n=>n.id===r?{...n,...o}:n);je("daggerheart-custom-adversaries",a)},updateCustomEnvironment:(r,o)=>{c(n=>({...n,environments:n.environments.map(l=>l.id===r?{...l,...o}:l)}));const a=x.environments.map(n=>n.id===r?{...n,...o}:n);je("daggerheart-custom-environments",a)},deleteCustomAdversary:r=>{c(a=>({...a,adversaries:a.adversaries.filter(n=>n.id!==r)}));const o=x.adversaries.filter(a=>a.id!==r);je("daggerheart-custom-adversaries",o)},deleteCustomEnvironment:r=>{c(a=>({...a,environments:a.environments.filter(n=>n.id!==r)}));const o=x.environments.filter(a=>a.id!==r);je("daggerheart-custom-environments",o)}};return e.jsx(tt.Provider,{value:f,children:t})},rt=()=>{const t=j.useContext(tt);if(!t)return console.warn("useGameState: Context not available yet, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{gameState:s,customContent:d,...h}=t;if(!s)return console.warn("useGameState: gameState not available, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],customContent:{adversaries:[],environments:[]},updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},addCustomAdversary:()=>{},addCustomEnvironment:()=>{},updateCustomAdversary:()=>{},updateCustomEnvironment:()=>{},deleteCustomAdversary:()=>{},deleteCustomEnvironment:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{fear:g,countdowns:x,adversaries:c,environments:I,partySize:i,savedEncounters:S}=s;return{gameState:s,fear:g,countdowns:x,adversaries:c,environments:I,partySize:i,savedEncounters:S,customContent:d,...h,hasCountdowns:x.length>0,hasAdversaries:c.length>0,hasEnvironments:I.length>0,getCountdownById:k=>x.find(z=>z.id===k),getAdversaryById:k=>c.find(z=>z.id===k),getEnvironmentById:k=>I.find(z=>z.id===k)}},Xe={fear:{icon:st,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"0.125rem",maxWidth:"none"},pipStyle:{fontSize:"var(--text-lg)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0,imageRendering:"crisp-edges"},filledColor:"var(--purple)",emptyColor:"var(--gray-dark)",tooltipTitle:"Click anywhere in header to adjust fear:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease fear by 1"},{text:"Right of boundary:",description:"Click to increase fear by 1"}]},hp:{icon:at,maxValue:20,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stress:{icon:it,maxValue:12,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},countdown:{icon:_e,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust countdown:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease countdown by 1"},{text:"Right of boundary:",description:"Click to increase countdown by 1"}]},hpDots:{maxValue:20,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--red)",borderColor:"var(--red)",boxShadow:"0 0 4px rgba(239, 68, 68, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stressDots:{maxValue:12,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--purple)",borderColor:"var(--purple)",boxShadow:"0 0 4px rgba(139, 92, 246, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},adversaryHP:{icon:Ze,maxValue:20,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust HP:",tooltipInstructions:[{text:"Filled pip:",description:"Click to heal (reduce damage)"},{text:"Empty pip:",description:"Click to take damage"}]},adversaryStress:{icon:lt,maxValue:12,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust stress:",tooltipInstructions:[{text:"Filled pip:",description:"Click to reduce stress"},{text:"Empty pip:",description:"Click to increase stress"}]},countdownDistributed:{icon:_e,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Countdown progress:",tooltipInstructions:[{text:"Progress:",description:"Current countdown value"}]}},ke=({type:t="fear",value:s=0,maxValue:d,onChange:h,size:g="lg",showTooltip:x=!0,containerStyle:c={},pipStyle:I={},countdownType:i=null,distributedGroups:S=null,onPipClick:k=null,enableBoundaryClick:z=!1,clickContainerWidth:q="auto",centerPips:v=!0})=>{const[W,Y]=j.useState(!1),L=Xe[t]||Xe.fear,P=d||L.maxValue,N=Math.max(0,Math.min(P,s));let O=L.filledColor;t==="countdown"&&i&&(["progress","dynamic-progress","simple-hope"].includes(i)?O="var(--gold)":["consequence","dynamic-consequence","simple-fear"].includes(i)?O="var(--purple)":["long-term","standard"].includes(i)&&(O="var(--text-secondary)"));const y=(G,ie)=>{if(k)k(G,ie);else if(h){const se=G+1;h(se)}},F=G=>{if(!z||!h||k)return;G.currentTarget.getBoundingClientRect();const ie=G.currentTarget.querySelector(".pip-container");if(!ie)return;const se=ie.getBoundingClientRect(),ae=G.clientX-se.left;if(ae<0){N>0&&h(N-1);return}if(ae>se.width){N<P&&h(N+1);return}const oe=se.width,D=oe*.05,Z=oe-2*D,w=ae-D,m=N/P,b=Z*m;w<b?N>0&&h(N-1):N<P&&h(N+1)},$=(()=>{if(!S||t!=="countdownDistributed")return[{start:0,end:P,groupIndex:0}];let G=0;return S.map((ie,se)=>{const ae={start:G,end:G+ie,groupIndex:se};return G+=ie,ae})})(),de=()=>e.jsxs(e.Fragment,{children:[$.map(G=>e.jsx(we.Fragment,{children:[...Array(G.end-G.start)].map((ie,se)=>{const ae=G.start+se,oe=ae<N;if(L.isDots)return e.jsx("div",{style:{...L.pipStyle,...oe?L.filledStyle:L.emptyStyle,...I,cursor:h||k?"pointer":"default"},onClick:z?void 0:()=>y(ae,oe),title:`${ae+1} of ${P}`},ae);{const D=L.icon,Z=D&&typeof D=="object"&&D.iconName,w=oe?O:L.emptyColor;return e.jsx("span",{className:`fear-pip ${oe?"filled":"empty"}`,style:{...L.pipStyle,color:w,cursor:h||k?"pointer":"default",...I},onClick:z?void 0:()=>y(ae,oe),title:`${ae+1} of ${P}`,children:Z?e.jsx(ot,{icon:D,size:g}):e.jsx(D,{size:g==="lg"?18:16})},ae)}})},G.groupIndex)),x&&e.jsx("div",{style:{position:"relative",cursor:"help",pointerEvents:"none"},children:e.jsxs("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:W?"translateX(-50%) translateY(-5px)":"translateX(-50%)",background:"rgba(15, 23, 42, 0.95)",border:"1px solid var(--gray)",borderRadius:"var(--radius-md)",padding:"var(--space-md)",minWidth:"250px",zIndex:1e3,opacity:W?1:0,visibility:W?"visible":"hidden",transition:"all 0.2s ease",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.5)"},children:[e.jsx("div",{style:{fontWeight:600,color:"var(--gray-200)",marginBottom:"0.75rem",fontSize:"var(--text-sm)"},children:L.tooltipTitle}),L.tooltipInstructions.map((G,ie)=>e.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.8rem",color:"var(--gray-300)",lineHeight:1.4},children:[e.jsx("strong",{style:{color:"var(--gray-200)"},children:G.text})," ",G.description]},ie))]})})]});return e.jsx("div",{style:{width:q,height:"100%",cursor:h||k?"pointer":"default",touchAction:"manipulation",userSelect:"none",display:v?"flex":"block",alignItems:v?"center":"stretch",justifyContent:v?"center":"flex-start",...c},onClick:G=>{G.stopPropagation(),G.preventDefault(),z&&F(G)},onMouseEnter:()=>Y(x),onMouseLeave:()=>Y(!1),children:e.jsx("div",{className:"pip-container",style:{...L.containerStyle,width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},children:de()})})},kt="/Daggerheart/assets/daggerheart-logo-fe7815ad.svg",Et=({showFlyout:t,onFlyoutChange:s})=>{const[d,h]=j.useState(!1),[g,x]=j.useState(!1),c=t!==void 0?t:d,I=s||h;return j.useEffect(()=>{const i=S=>{S.target.closest(".help-button")||I(!1)};return document.addEventListener("click",i),()=>document.removeEventListener("click",i)},[I]),j.useEffect(()=>{const i=window.matchMedia("(max-width: 800px)"),S=k=>x(k.matches);return x(i.matches),i.addEventListener("change",S),()=>i.removeEventListener("change",S)},[]),e.jsxs("div",{className:"help-button",style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",padding:"0.5rem",color:c?"white":"var(--text-primary)",borderRadius:"50%",cursor:"pointer",transition:"all 0.2s ease",minWidth:"44px",minHeight:"44px",backgroundColor:c?"var(--purple)":"transparent"},onMouseEnter:i=>{c||(i.currentTarget.style.backgroundColor="var(--bg-secondary)")},onMouseLeave:i=>{c||(i.currentTarget.style.backgroundColor="transparent")},onClick:i=>{i.stopPropagation(),I(!c)},title:"Help & Info",children:[e.jsx("div",{style:{width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center",color:"inherit",backgroundColor:"transparent",border:"none",outline:"none"},children:e.jsx(dt,{size:20})}),e.jsxs("div",{style:{position:"absolute",top:"50%",right:"100%",left:"auto",transform:"translateY(-50%)",background:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,opacity:c?1:0,visibility:c?"visible":"hidden",transition:"opacity 0.2s ease, visibility 0.2s ease, transform 0.2s ease",pointerEvents:c?"auto":"none",minWidth:"280px",maxWidth:g?"calc(100vw - 2rem)":"320px",marginRight:"0.5rem"},children:[e.jsxs("div",{style:{padding:"0.75rem",borderTop:"1px solid rgba(255, 255, 255, 0.1)",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",background:"var(--bg-primary)",maxWidth:"280px"},children:[e.jsx("img",{src:kt,alt:"Daggerheart Community Content Logo",style:{width:"100%",maxWidth:"200px",height:"auto",margin:"0 auto 0.75rem auto",display:"block"},onError:i=>{console.error("Failed to load Daggerheart logo:",i.target.src),i.target.style.display="none";const S=document.createElement("div");S.style.cssText="text-align: center; margin-bottom: 0.75rem; font-size: 1.5rem; font-weight: bold; color: var(--purple);",S.textContent="⚔️ DAGGERHEART ⚔️",i.target.parentNode.insertBefore(S,i.target)},onLoad:()=>{}}),e.jsxs("div",{style:{fontSize:"0.7rem",lineHeight:1.3,color:"var(--text-secondary)",textAlign:"left",wordWrap:"break-word",overflowWrap:"break-word"},children:[e.jsx("p",{children:"This product includes materials from the Daggerheart System Reference Document 1.0, © Critical Role, LLC, under the terms of the Darrington Press Community Gaming (DPCGL) License."}),e.jsxs("p",{children:["More information can be found at ",e.jsx("a",{href:"https://www.daggerheart.com",target:"_blank",rel:"noopener noreferrer",children:"daggerheart.com"})]}),e.jsx("p",{children:e.jsx("em",{children:"This project is unofficial and not endorsed by Darrington Press or Critical Role."})})]})]}),e.jsx("button",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"0.25rem 1rem",color:"var(--text-primary)",border:"none",background:"none",width:"100%",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"0.875rem",minHeight:"32px",borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},onMouseEnter:i=>{i.target.style.backgroundColor="var(--gray-dark)"},onMouseLeave:i=>{i.target.style.backgroundColor="transparent"},onClick:i=>{i.stopPropagation(),I(!1),window.open("https://github.com/Splinter714/Daggerheart","_blank")},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.25rem"},children:e.jsx("span",{children:"GitHub"})})}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"0.25rem 1rem",color:"var(--text-secondary)",border:"none",background:"none",width:"100%",textAlign:"left",cursor:"default",fontSize:"0.875rem",minHeight:"32px"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.25rem"},children:e.jsxs("span",{children:["Version ","0.3.13 (84f3912)"]})})})]})]})},It=({adversaries:t,environments:s,countdowns:d,deleteAdversary:h,deleteEnvironment:g,deleteCountdown:x,isClearMode:c,setIsClearMode:I,showFlyout:i,onFlyoutChange:S})=>{const[k,z]=j.useState(!1),q=i!==void 0?i:k,v=S||z,W=((t==null?void 0:t.length)||0)>0||((s==null?void 0:s.length)||0)>0||((d==null?void 0:d.length)||0)>0,Y=(t||[]).some(y=>(y.hp||0)>=(y.hpMax||1));j.useEffect(()=>{const y=F=>{F.target.closest(".delete-clear-container")||(v(!1),c&&I(!1))};return document.addEventListener("click",y),()=>document.removeEventListener("click",y)},[c,v]),j.useEffect(()=>{c&&!W&&(I(!1),v(!1))},[c,W,I,v]);const L={position:"absolute",top:"50%",right:"100%",left:"auto",transform:"translateY(-50%)",backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",padding:"0.5rem",minWidth:"200px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,display:q?"block":"none",marginRight:"0.5rem"},P={background:c||q?"var(--red)":"none",border:"none",color:c||q?"white":W?"var(--text-primary)":"var(--text-secondary)",cursor:W?"pointer":"not-allowed",padding:"0.5rem",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s",opacity:W?1:.5,minWidth:"44px",minHeight:"44px"},N={background:"none",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:"0.5rem",borderRadius:"var(--radius-sm)",width:"100%",textAlign:"left",display:"flex",alignItems:"center",gap:"0.5rem",transition:"background-color 0.2s"},O={backgroundColor:"var(--bg-hover)"};return e.jsxs("div",{className:"delete-clear-container",style:{position:"relative"},children:[e.jsx("button",{style:P,onClick:y=>{y.stopPropagation(),W&&(c?(I(!1),v(!1)):(I(!0),v(!0)))},title:W?c?"Clear Items":"Enter Clear Mode":"Nothing to clear",children:e.jsx(ct,{size:20})}),e.jsxs("div",{style:L,children:[t&&t.length>0&&e.jsxs("button",{style:N,onMouseEnter:y=>Object.assign(y.target.style,O),onMouseLeave:y=>Object.assign(y.target.style,N),onClick:y=>{y.stopPropagation(),z(!1),t.forEach(F=>h(F.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Adversaries"})]}),t&&t.length>0&&Y&&e.jsxs("button",{style:N,onMouseEnter:y=>Object.assign(y.target.style,O),onMouseLeave:y=>Object.assign(y.target.style,N),onClick:y=>{y.stopPropagation(),z(!1),t.filter(ee=>(ee.hp||0)>=(ee.hpMax||1)).forEach(ee=>h(ee.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"Dead Adversaries"})]}),s&&s.length>0&&e.jsxs("button",{style:N,onMouseEnter:y=>Object.assign(y.target.style,O),onMouseLeave:y=>Object.assign(y.target.style,N),onClick:y=>{y.stopPropagation(),z(!1),s.forEach(F=>g(F.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Environments"})]}),d&&d.length>0&&e.jsxs("button",{style:N,onMouseEnter:y=>Object.assign(y.target.style,O),onMouseLeave:y=>Object.assign(y.target.style,N),onClick:y=>{y.stopPropagation(),z(!1),d.forEach(F=>x(F.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Countdowns"})]})]})]})},At=({adversaries:t,environments:s,countdowns:d,deleteAdversary:h,deleteEnvironment:g,deleteCountdown:x,isClearMode:c,setIsClearMode:I,sortAdversaries:i,onOpenDatabase:S})=>{const[k,z]=j.useState(!1),[q,v]=j.useState(!1),[W,Y]=j.useState(!1);j.useEffect(()=>{const ee=$=>{$.target.closest(".floating-menu-container")||(z(!1),v(!1),Y(!1),c&&I(!1))};return document.addEventListener("click",ee),()=>document.removeEventListener("click",ee)},[c,I]),j.useEffect(()=>{k||(v(!1),Y(!1),c&&I(!1))},[k,c,I]);const L=ee=>{v(ee),ee&&(Y(!1),c&&I(!1))},P=ee=>{Y(ee),ee&&v(!1)},O={position:"fixed",bottom:window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://")?"calc(60px + env(safe-area-inset-bottom) + 2rem)":"calc(60px + env(safe-area-inset-bottom) + 1rem)",right:"1rem",zIndex:1100,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",pointerEvents:"none",width:"56px",height:"56px"},y={width:"56px",height:"56px",borderRadius:"50%",background:k?"var(--red)":"var(--bg-secondary)",border:"2px solid var(--border)",color:k?"white":"var(--text-primary)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"all 0.3s ease",pointerEvents:"auto"},F=(ee,$)=>{const se=135+ee*135/($-1),ae=70,oe=se*Math.PI/180,D=Math.cos(oe)*ae,Z=Math.sin(oe)*ae;return{width:"48px",height:"48px",borderRadius:"50%",background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.2)",transition:"all 0.3s ease",position:"absolute",pointerEvents:"auto",transform:k?`translate(${D}px, ${Z}px)`:"translate(0px, 0px)",opacity:k?1:0,visibility:k?"visible":"hidden"}};return e.jsxs("div",{className:"floating-menu-container",style:O,children:[e.jsxs("div",{style:{position:"absolute",top:"0",left:"0",width:"56px",height:"56px",pointerEvents:"none"},children:[e.jsx("div",{style:F(0,4),children:e.jsx("button",{onClick:ee=>{ee.stopPropagation(),S("adversaries"),z(!1)},style:{width:"100%",height:"100%",background:"none",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Browse Adversaries",children:e.jsx(pt,{size:20})})}),e.jsx("div",{style:F(1,4),children:e.jsx("button",{onClick:ee=>{ee.stopPropagation(),S("environments"),z(!1)},style:{width:"100%",height:"100%",background:"none",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Browse Environments",children:e.jsx(ut,{size:20})})}),e.jsx("div",{style:F(2,4),children:e.jsx(It,{adversaries:t,environments:s,countdowns:d,deleteAdversary:h,deleteEnvironment:g,deleteCountdown:x,isClearMode:c,setIsClearMode:I,showFlyout:W,onFlyoutChange:P})}),e.jsx("div",{style:F(3,4),children:e.jsx(Et,{showFlyout:q,onFlyoutChange:L})})]}),e.jsx("button",{style:y,onClick:ee=>{ee.stopPropagation(),z(!k)},title:k?"Close Menu":"Open Menu",children:k?e.jsx(qe,{size:24}):e.jsx(mt,{size:24})})]})},zt=({position:t="top",children:s,onClick:d,className:h="",style:g={}})=>{const x=t==="top",c=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://"),I={background:"var(--bg-primary)",borderTop:x?"none":"1px solid var(--border)",borderBottom:x?"1px solid var(--border)":"none",padding:x?"0.25rem 0":"0.5rem",paddingBottom:x?"0.25rem":c?"calc(0.5rem + env(safe-area-inset-bottom) + 1rem)":"calc(0.5rem + env(safe-area-inset-bottom))",position:x?"relative":"sticky",[x?"top":"bottom"]:0,zIndex:x?10:100,order:x?1:3,flexShrink:0,touchAction:"manipulation",userSelect:"none",display:"flex",flexDirection:x?"column":"row",justifyContent:x?"stretch":"center",alignItems:x?"stretch":"center",gap:x?"0":"1rem",height:x?"auto":"60px",...g};return e.jsx("div",{className:h,style:I,onClick:d,children:s})},Ke=({value:t})=>e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"44px",height:"32px",zIndex:3},children:[e.jsx("svg",{width:"40",height:"32",viewBox:"0 0 40 32",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",style:{position:"absolute",zIndex:1},children:e.jsx("path",{d:"M2 2h28l6 14-6 14H2l6-14-6-14z"})}),e.jsx("span",{style:{position:"absolute",fontSize:"0.8rem",fontWeight:500,color:"var(--text-primary)",textAlign:"center",zIndex:2,left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:t})]}),Wt=({type:t,tier:s,isEditMode:d,onUpdate:h,itemId:g})=>{const c=(z=>{if(!z)return 0;const v=document.createElement("canvas").getContext("2d");v.font="600 11px system-ui, -apple-system, sans-serif";const W=v.measureText(z.toUpperCase()).width;return console.log("Text measurement:",{text:z,font:v.font,width:W}),W})(t),I=4,i=18,S=Math.max(50,c+I+i),k=S+15;return d?e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",gap:"8px",height:"32px"},children:[e.jsxs("select",{value:t||"",onChange:z=>{h&&h(g,{type:z.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",outline:"none",borderRadius:"4px",padding:"4px 8px",width:"95px",height:"24px"},children:[e.jsx("option",{value:"Standard",children:"Standard"}),e.jsx("option",{value:"Solo",children:"Solo"}),e.jsx("option",{value:"Bruiser",children:"Bruiser"}),e.jsx("option",{value:"Horde",children:"Horde"}),e.jsx("option",{value:"Minion",children:"Minion"}),e.jsx("option",{value:"Ranged",children:"Ranged"}),e.jsx("option",{value:"Leader",children:"Leader"}),e.jsx("option",{value:"Skulk",children:"Skulk"}),e.jsx("option",{value:"Social",children:"Social"}),e.jsx("option",{value:"Support",children:"Support"})]}),e.jsxs("div",{style:{position:"relative",width:"24px",height:"24px"},children:[e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",width:"20px",height:"20px",backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",borderRadius:"2px"}}),e.jsx("input",{type:"text",value:s||"",onChange:z=>{const q=z.target.value.replace(/[^1-4]/g,"");q.length<=1&&h&&h(g,{tier:q===""?"":parseInt(q)})},onKeyDown:z=>{if(z.key==="ArrowUp"){z.preventDefault();const q=parseInt(s)||1;h&&h(g,{tier:Math.min(q+1,4)})}else if(z.key==="ArrowDown"){z.preventDefault();const q=parseInt(s)||1;h&&h(g,{tier:Math.max(q-1,1)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"transparent",border:"none",color:"var(--text-primary)",fontSize:"0.8rem",fontWeight:600,width:"24px",height:"24px",textAlign:"center",outline:"none",zIndex:1},maxLength:"1"})]})]}):e.jsxs("div",{style:{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"center",height:"32px",width:`${k}px`},children:[e.jsxs("svg",{width:k,height:"32",viewBox:`0 0 ${k} 32`,style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1},children:[e.jsx("rect",{x:"1",y:"6",width:S-1,height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4",ry:"4"}),e.jsx("rect",{x:S-10,y:"6",width:"20",height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"2",ry:"2",transform:`rotate(45 ${S-1} 16)`})]}),e.jsx("span",{style:{position:"absolute",top:"50%",left:"4px",transform:"translateY(-50%)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",color:"var(--text-primary)",zIndex:2,pointerEvents:"none"},children:t}),e.jsx("span",{style:{position:"absolute",top:"50%",left:`${S-.5}px`,transform:"translate(-50%, -50%)",fontSize:"0.8rem",fontWeight:600,color:"white",zIndex:2,pointerEvents:"none",textAlign:"center",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",width:"20px",height:"20px"},children:s})]})},Pe=({feature:t,featureType:s,item:d,onUpdate:h,handleFeatureDeleteClick:g,deleteConfirmations:x,getFeatureKey:c})=>{var z,q;const I=()=>{try{const W=[...(d==null?void 0:d.features)||[]],Y=W.filter(P=>P.type===s),L=Y.findIndex(P=>P===t);if(L>0&&L<Y.length){const P=Y[L],N=Y[L-1];if(P&&N){const O=W.findIndex(F=>F===P),y=W.findIndex(F=>F===N);O>=0&&y>=0&&(W[O]=N,W[y]=P,h&&h(d.id,{features:W}))}}}catch(v){console.error(`Error in ${s.toLowerCase()} up button:`,v)}},i=()=>{try{const W=[...(d==null?void 0:d.features)||[]],Y=W.filter(P=>P.type===s),L=Y.findIndex(P=>P===t);if(L<Y.length-1&&L>=0){const P=Y[L],N=Y[L+1];if(P&&N){const O=W.findIndex(F=>F===P),y=W.findIndex(F=>F===N);O>=0&&y>=0&&(W[O]=N,W[y]=P,h&&h(d.id,{features:W}))}}}catch(v){console.error(`Error in ${s.toLowerCase()} down button:`,v)}},S=v=>v.type===s,k=v=>v.type===s&&v.name.trim();return e.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",alignSelf:"stretch"},children:[e.jsx("button",{onClick:I,disabled:(d.features||[]).filter(S).findIndex(v=>v===t)===0,tabIndex:"-1",style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(d.features||[]).filter(k).length>=2&&(d.features||[]).filter(S).findIndex(v=>v===t)!==0&&t.name.trim()?"white":"var(--text-secondary)",cursor:(d.features||[]).filter(k).length>=2&&(d.features||[]).filter(S).findIndex(v=>v===t)!==0&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↑"}),e.jsx("button",{onClick:()=>g(t),disabled:!t.name.trim()&&!t.description.trim(),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:x[c(t)]?"var(--danger)":"var(--gray-700)",color:!t.name.trim()&&!t.description.trim()?"var(--text-secondary)":"white",cursor:!t.name.trim()&&!t.description.trim()?"not-allowed":"pointer",opacity:!t.name.trim()&&!t.description.trim()?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"×"}),e.jsx("button",{onClick:i,disabled:(d.features||[]).filter(S).findIndex(v=>v===t)===(d.features||[]).filter(S).length-1,style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(d.features||[]).filter(k).length>=2&&(d.features||[]).filter(S).findIndex(v=>v===t)<(d.features||[]).filter(S).length-1&&((z=(d.features||[]).filter(S)[(d.features||[]).filter(S).findIndex(v=>v===t)+1])!=null&&z.name.trim())&&t.name.trim()?"white":"var(--text-secondary)",cursor:(d.features||[]).filter(k).length>=2&&(d.features||[]).filter(S).findIndex(v=>v===t)<(d.features||[]).filter(S).length-1&&((q=(d.features||[]).filter(S)[(d.features||[]).filter(S).findIndex(v=>v===t)+1])!=null&&q.name.trim())&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↓"})]})},ue={transitions:{hoverIn:"all 0.1s ease",hoverOut:"all 0.3s ease"},card:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"8px",cursor:"pointer",transition:"all 0.1s ease",position:"relative"},cardHover:{backgroundColor:"var(--bg-card-hover)"},cardDead:{opacity:.6,backgroundColor:"var(--gray-800)",borderColor:"var(--border)"},cardAtMax:{backgroundColor:"var(--success)",borderColor:"var(--success)"},rowMain:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},rowTitle:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",margin:0},rowMeta:{display:"flex",gap:"8px",alignItems:"center"},badge:{padding:"2px 6px",borderRadius:"3px",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},typeBadge:{backgroundColor:"var(--purple)",color:"var(--text-primary)"},tierBadge:{backgroundColor:"var(--info)",color:"var(--text-primary)"},damageInputPopup:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,borderRadius:"8px"},damageInputContent:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"8px",padding:"8px",display:"flex",flexDirection:"row",gap:"8px",minWidth:"200px",alignItems:"center",position:"absolute",right:"1rem",top:"50%",transform:"translateY(-50%)"},damageInput:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"4px",padding:"4px 6px",color:"var(--text-primary)",fontSize:"16px",width:"80px",textAlign:"center"},damageIndicators:{display:"flex",gap:"8px",alignItems:"center",justifyContent:"center"},damageDrop:{fontSize:"16px",color:"var(--text-secondary)",cursor:"pointer",transition:"color 0.1s ease"},applyButton:{backgroundColor:"var(--gray-600)",color:"white",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"32px",minHeight:"32px"}},Tt=(t,s,d,h)=>{const[g,x]=j.useState(!1),[c,I]=j.useState("");j.useEffect(()=>{if(g){const v=W=>{W.target.closest(".damage-input-popup")||(x(!1),I(""))};return document.addEventListener("click",v),()=>document.removeEventListener("click",v)}},[g]);const i=v=>{v.stopPropagation(),v.preventDefault();const W=t.hp||0,Y=t.hpMax||1,L=v.currentTarget.getBoundingClientRect(),P=v.clientX-L.left,N=L.width/Y;Math.floor(P/N)<W?d&&d(t.id,1,t.hp):s&&s(t.id,1,t.hp,t.hpMax)},S=v=>{v.stopPropagation(),v.preventDefault();const W=t.stress||0,Y=t.stressMax||1,L=v.currentTarget.getBoundingClientRect(),P=v.clientX-L.left,N=L.width/Y;Math.floor(P/N)<W?h&&h(t.id,-1,t.stress,t.stressMax):h&&h(t.id,1,t.stress,t.stressMax)},k=v=>{v.stopPropagation(),(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")&&(x(!0),I(t.type==="Minion"?"1":""))},z=()=>{const v=parseInt(c);if(v>0){if(t.type==="Minion")s&&s(t.id,v,t.hp,t.hpMax);else{let W=0;v>=t.thresholds.severe?W=3:v>=t.thresholds.major?W=2:v>=1&&(W=1),s&&s(t.id,W,t.hp,t.hpMax)}x(!1),I("")}};return{showDamageInput:g,damageValue:c,setDamageValue:I,setShowDamageInput:x,handleHpClick:i,handleStressClick:S,handleDifficultyClick:k,applyDamage:z,handleKeyDown:v=>{v.key==="Enter"?z():v.key==="Escape"&&(x(!1),I(""))}}},Ve=({item:t,type:s,mode:d="expanded",onClick:h,onDelete:g,onApplyDamage:x,onApplyHealing:c,onApplyStressChange:I,onUpdate:i,adversaries:S=[],isSelected:k=!1,isEditMode:z=!1,instances:q=[],isEmbedded:v=!1})=>{const[W,Y]=j.useState({}),L=w=>{const b=(t.features||[]).filter(R=>R.type===w.type).findIndex(R=>R===w);return`${w.type}-${b}-${w.name||"blank"}`},P=(w,m)=>`experience-${m}-${typeof w=="string"?w:w.name||"blank"}`,N=w=>{const m=L(w);if(W[m]){const b=t.features.filter(R=>R!==w);i&&i(t.id,{features:b}),Y(R=>{const K={...R};return delete K[m],K})}else Y(b=>({...b,[m]:!0})),setTimeout(()=>{Y(b=>{const R={...b};return delete R[m],R})},3e3)},O=(w,m)=>{const b=P(w,m);if(W[b]){const R=[...t.experience||[]];R.splice(m,1),i&&i(t.id,{experience:R}),Y(K=>{const le={...K};return delete le[b],le})}else Y(R=>({...R,[b]:!0})),setTimeout(()=>{Y(R=>{const K={...R};return delete K[b],K})},3e3)},y=Tt(t,x,c,I);(s==="adversary"||s==="adversaries")&&y.handleDifficultyClick;const[F,ee]=j.useState(!1),$=()=>{ee(!0)},de=()=>{ee(!1)},G=(w=!1)=>{let m={...ue.card};if(k?m.transition="none":m.transition=F?ue.transitions.hoverIn:ue.transitions.hoverOut,w){const{marginTop:b,...R}=m;m=R}return(F&&d!=="expanded"||k)&&(m={...m,...ue.cardHover}),s==="adversary"&&(t.hp||0)>=(t.hpMax||1)&&(m={...m,...ue.cardDead}),m},ie=()=>{if(v)return"";let w="border rounded-lg";return(F&&d!=="expanded"||k)&&(w+=" border-hover"),w},se=()=>{var w;if(s==="adversary"||s==="adversaries"){const m=t.baseName||((w=t.name)==null?void 0:w.replace(/\s+\(\d+\)$/,""))||"",b=t.duplicateNumber||1,R=[...S];return S.some(ce=>ce.id===t.id)||R.push(t),R.filter(ce=>ce.baseName===m).length>1?`${m} (${b})`:m}return t.name},ae=()=>{const w=[];return t.type&&w.push(e.jsx("span",{style:{...ue.badge,...ue.typeBadge},children:t.type},"type")),w},oe=()=>s!=="adversary"||!y.showDamageInput||!(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")?null:e.jsx("div",{className:"damage-input-popup",style:ue.damageInputPopup,onClick:w=>{w.stopPropagation(),w.target===w.currentTarget&&(s==="adversary"||s==="adversaries")&&(y.setShowDamageInput(!1),y.setDamageValue(""))},children:e.jsxs("div",{className:"border rounded-lg",style:{...ue.damageInputContent,borderColor:"var(--border)"},onClick:w=>w.stopPropagation(),children:[e.jsx("input",{type:"number",inputMode:"numeric",enterKeyHint:"done",placeholder:"dmg",min:(t.type==="Minion","0"),value:s==="adversary"||s==="adversaries"?y.damageValue:"",onChange:w=>{(s==="adversary"||s==="adversaries")&&y.setDamageValue(w.target.value)},onKeyDown:s==="adversary"||s==="adversaries"?y.handleKeyDown:void 0,className:"border rounded-sm",style:{...ue.damageInput,borderColor:"var(--border)"},autoFocus:!0}),e.jsxs("div",{style:ue.damageIndicators,children:[t.type==="Minion"?(()=>{var K,le;const w=parseInt(s==="adversary"||s==="adversaries"?y.damageValue:"0")||0,m=(K=t.features)==null?void 0:K.find(ce=>{var p;return(p=ce.name)==null?void 0:p.startsWith("Minion (")}),b=m?parseInt(((le=m.name.match(/\((\d+)\)/))==null?void 0:le[1])||"1"):1,R=Math.floor(w/b);return w>=b&&R>0?e.jsxs("span",{style:{...ue.damageDrop,color:"var(--red)"},title:`${w} damage can defeat ${R+1} minion${R+1!==1?"s":""} (1 + ${R} additional)`,children:["+",R," additional minion(s)"]}):e.jsx("span",{style:ue.damageDrop,title:`${w} damage defeats this minion only`,children:"+0 additional minion(s)"})})():[1,2,3].map(w=>{const m=parseInt(s==="adversary"||s==="adversaries"?y.damageValue:"0")||0;let b=!1;return w===1&&m>=1&&(b=!0),w===2&&m>=t.thresholds.major&&(b=!0),w===3&&m>=t.thresholds.severe&&(b=!0),e.jsx("span",{style:{...ue.damageDrop,color:b?"var(--red)":"var(--text-secondary)"},onClick:R=>{R.stopPropagation(),(s==="adversary"||s==="adversaries")&&(w===1?y.setDamageValue("1"):w===2?y.setDamageValue(t.thresholds.major.toString()):w===3&&y.setDamageValue(t.thresholds.severe.toString()))},title:`Click to set damage to ${w===1?"1":w===2?t.thresholds.major:t.thresholds.severe}`,children:e.jsx(Ze,{size:16})},w)}),e.jsx("button",{style:{...ue.applyButton,backgroundColor:"var(--gray-600)"},onClick:w=>{w.stopPropagation(),(s==="adversary"||s==="adversaries")&&(!y.damageValue||parseInt(y.damageValue)<1?(y.setShowDamageInput(!1),y.setDamageValue("")):y.applyDamage())},title:!y.damageValue||parseInt(y.damageValue)<1?"Close damage input":"Apply damage",children:!y.damageValue||parseInt(y.damageValue)<1?e.jsx(qe,{size:16}):e.jsx(ft,{size:16})})]})]})}),D=()=>{var b,R,K,le,ce;const w=(t.hp||0)>=(t.hpMax||1),m=d==="edit";return e.jsxs("div",{className:ie(),style:{...G(!0),padding:0,minHeight:"400px",opacity:w?.7:1,backgroundColor:w?"var(--gray-900)":G(!0).backgroundColor,borderColor:w?"color-mix(in srgb, var(--gray-600) 40%, transparent)":k?"var(--purple)":F&&d!=="expanded"?"var(--border-hover)":"var(--border)",borderWidth:"2px",display:"flex",flexDirection:"column",position:"relative"},onClick:h,...d!=="expanded"&&{onMouseEnter:$,onMouseLeave:de},children:[w&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                45deg,
                transparent,
                transparent 8px,
                var(--gray-600) 1px,
                var(--gray-600) 9px
              )`,pointerEvents:"none",zIndex:9999}}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"var(--text-secondary)",fontSize:"1rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em",zIndex:1e4,pointerEvents:"none",textShadow:"1px 1px 2px rgba(0, 0, 0, 0.5)",backgroundColor:"var(--gray-900)",padding:"0.25rem 0.5rem",borderRadius:"0.5rem",border:"0.5px solid var(--gray-600)"},children:"DEFEATED"})]}),e.jsx("div",{className:"border-b",style:{padding:"8px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative",zIndex:w?1:"auto",borderBottomColor:k?"var(--purple)":"var(--border)"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",position:"relative",zIndex:w?1:"auto",padding:"2px",minHeight:"40px"},children:[m?e.jsx("input",{type:"text",value:t.name||"",onChange:p=>{i&&i(t.id,{name:p.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"4px",color:"var(--text-primary)",fontSize:"1.1rem",fontWeight:"600",padding:"0.5rem",width:"100%",maxWidth:"300px",paddingRight:"0.625rem"},placeholder:"Name"}):e.jsx("h4",{style:{...ue.rowTitle,color:w?"color-mix(in srgb, var(--gray-400) 80%, transparent)":ue.rowTitle.color,textAlign:"left",margin:0,fontSize:"1.1rem",paddingRight:"6px"},children:((b=t.name)==null?void 0:b.replace(/\s+\(\d+\)$/,""))||t.name}),(t.type||t.tier||m)&&e.jsx(Wt,{type:t.type,tier:t.tier,isEditMode:m,onUpdate:i,itemId:t.id})]})}),e.jsxs("div",{style:{borderRadius:"0 0 8px 8px"},children:[(t.motives||m)&&e.jsx("div",{style:{padding:"0.5rem 8px",textAlign:"center"},children:m?e.jsx("input",{type:"text",value:t.motives||"",onChange:p=>i&&i(t.id,{motives:p.target.value}),placeholder:"Motives...",style:{width:"100%",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}):e.jsxs("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,textAlign:"center"},children:[t.motives,t.motives&&!t.motives.endsWith(".")?".":""]})}),(t.difficulty||t.atk!==void 0||t.thresholds&&t.type!=="Minion"||t.experience&&t.experience.length>0||m)&&e.jsxs("div",{style:{padding:"0.5rem 8px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[(t.difficulty||m)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[e.jsx(xt,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(0deg)"}}),m?e.jsx("input",{type:"text",value:t.difficulty||"",onChange:p=>{const f=p.target.value.replace(/[^0-9]/g,"");f.length<=2&&i&&i(t.id,{difficulty:parseInt(f)||0})},onKeyDown:p=>{if(p.key==="ArrowUp"){p.preventDefault();const f=parseInt(t.difficulty)||0;i&&i(t.id,{difficulty:Math.min(f+1,99)})}else if(p.key==="ArrowDown"){p.preventDefault();const f=parseInt(t.difficulty)||0;i&&i(t.id,{difficulty:Math.max(f-1,0)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"2"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:t.difficulty})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Difficulty"})]}),(t.atk!==void 0||m)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[e.jsx(ht,{size:38,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(45deg)"}}),m?e.jsx("input",{type:"text",value:t.atk||"",onChange:p=>{const f=p.target.value.replace(/[^0-9+\-d]/g,"");f.length<=4&&i&&i(t.id,{atk:f})},onKeyDown:p=>{if(p.key==="ArrowUp"){p.preventDefault();const r=(parseInt(t.atk)||0)+1;i&&i(t.id,{atk:r>=0?`+${r}`:r.toString()})}else if(p.key==="ArrowDown"){p.preventDefault();const r=(parseInt(t.atk)||0)-1;i&&i(t.id,{atk:r>=0?`+${r}`:r.toString()})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"3"}):e.jsxs("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:[t.atk>=0?"+":"",t.atk]})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Attack"})]})]}),e.jsx("div",{style:{paddingTop:"0"},children:m?e.jsx("div",{style:{display:"flex",flexDirection:"column",marginTop:"-0.25rem"},children:(()=>{const p=t.experience||[],f=p.length===0?[{name:"",modifier:1}]:p;return f.map((r,o)=>{var a,n,l,E,A,H,U,T,u,C,B,V,X,te,_,Q,M,re,xe,ne,fe,ye,ge,Ie,Ae;return e.jsxs("div",{style:{position:"relative",marginBottom:"0.5rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("input",{type:"text",value:typeof r=="object"&&r.modifier>=1?`+${r.modifier}`:"+1",onChange:pe=>{const me=[...t.experience||[]],he=parseInt(pe.target.value.replace(/[^0-9+-]/g,""))||1,ve=Math.max(1,he);me[o]={name:typeof r=="string"?r:r.name||"",modifier:ve},i&&i(t.id,{experience:me})},onKeyDown:pe=>{if(pe.key==="ArrowUp"){pe.preventDefault();const me=[...t.experience||[]],he=typeof r=="object"?Math.max(1,r.modifier):1;me[o]={name:typeof r=="string"?r:r.name||"",modifier:he+1},i&&i(t.id,{experience:me})}else if(pe.key==="ArrowDown"){pe.preventDefault();const me=[...t.experience||[]],he=typeof r=="object"?Math.max(1,r.modifier):1;me[o]={name:typeof r=="string"?r:r.name||"",modifier:Math.max(1,he-1)},i&&i(t.id,{experience:me})}},style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)",textAlign:"center",outline:"none"}})}),e.jsxs("div",{style:{marginLeft:"32px",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:typeof r=="string"?r:r.name||"",onChange:pe=>{const me=[...t.experience||[]],he=typeof r=="object"?r.modifier:1;me[o]={name:pe.target.value,modifier:he};const ve=me[me.length-1];ve&&ve.name.trim()&&me.push({name:"",modifier:1}),i&&i(t.id,{experience:me})},placeholder:"Experience name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsxs("div",{style:{display:"flex",gap:"0.125rem"},children:[e.jsx("button",{onClick:()=>{var Ce,Se;const pe=[...t.experience||[]],me=typeof r=="string"?r.trim():(Ce=r.name)==null?void 0:Ce.trim(),he=pe[o-1],ve=typeof he=="string"?he.trim():(Se=he.name)==null?void 0:Se.trim();o>0&&o<pe.length&&me&&ve&&(pe[o]=he,pe[o-1]=r,i&&i(t.id,{experience:pe}))},disabled:o===0||!(typeof r=="string"?r.trim():(a=r.name)!=null&&a.trim())||!(typeof f[o-1]=="string"?f[o-1].trim():(n=f[o-1].name)!=null&&n.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:o===0||!(typeof r=="string"?r.trim():(l=r.name)!=null&&l.trim())||!(typeof f[o-1]=="string"?f[o-1].trim():(E=f[o-1].name)!=null&&E.trim())?"var(--gray-800)":"var(--gray-700)",color:o===0||!(typeof r=="string"?r.trim():(A=r.name)!=null&&A.trim())||!(typeof f[o-1]=="string"?f[o-1].trim():(H=f[o-1].name)!=null&&H.trim())?"var(--text-secondary)":"white",cursor:o===0||!(typeof r=="string"?r.trim():(U=r.name)!=null&&U.trim())||!(typeof f[o-1]=="string"?f[o-1].trim():(T=f[o-1].name)!=null&&T.trim())?"not-allowed":"pointer",opacity:o===0||!(typeof r=="string"?r.trim():(u=r.name)!=null&&u.trim())||!(typeof f[o-1]=="string"?f[o-1].trim():(C=f[o-1].name)!=null&&C.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move up",children:"↑"}),e.jsx("button",{onClick:()=>{var Ce,Se;const pe=[...t.experience||[]],me=typeof r=="string"?r.trim():(Ce=r.name)==null?void 0:Ce.trim(),he=pe[o+1],ve=typeof he=="string"?he.trim():(Se=he.name)==null?void 0:Se.trim();o<pe.length-1&&o>=0&&me&&ve&&(pe[o]=he,pe[o+1]=r,i&&i(t.id,{experience:pe}))},disabled:o===f.length-1||!(typeof r=="string"?r.trim():(B=r.name)!=null&&B.trim())||!(typeof f[o+1]=="string"?f[o+1].trim():(V=f[o+1].name)!=null&&V.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:o===f.length-1||!(typeof r=="string"?r.trim():(X=r.name)!=null&&X.trim())||!(typeof f[o+1]=="string"?f[o+1].trim():(te=f[o+1].name)!=null&&te.trim())?"var(--gray-800)":"var(--gray-700)",color:o===f.length-1||!(typeof r=="string"?r.trim():(_=r.name)!=null&&_.trim())||!(typeof f[o+1]=="string"?f[o+1].trim():(Q=f[o+1].name)!=null&&Q.trim())?"var(--text-secondary)":"white",cursor:o===f.length-1||!(typeof r=="string"?r.trim():(M=r.name)!=null&&M.trim())||!(typeof f[o+1]=="string"?f[o+1].trim():(re=f[o+1].name)!=null&&re.trim())?"not-allowed":"pointer",opacity:o===f.length-1||!(typeof r=="string"?r.trim():(xe=r.name)!=null&&xe.trim())||!(typeof f[o+1]=="string"?f[o+1].trim():(ne=f[o+1].name)!=null&&ne.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move down",children:"↓"}),e.jsx("button",{onClick:()=>O(r,o),disabled:!(typeof r=="string"?r.trim():(fe=r.name)!=null&&fe.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:W[P(r,o)]?"var(--danger)":(typeof r=="string"?r.trim():(ye=r.name)!=null&&ye.trim())?"var(--gray-700)":"var(--gray-800)",color:(typeof r=="string"?r.trim():(ge=r.name)!=null&&ge.trim())?"white":"var(--text-secondary)",cursor:(typeof r=="string"?r.trim():(Ie=r.name)!=null&&Ie.trim())?"pointer":"not-allowed",opacity:(typeof r=="string"?r.trim():(Ae=r.name)!=null&&Ae.trim())?1:.5,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:W[P(r,o)]?"Click again to confirm delete":"Delete experience",children:"×"})]})]})]},o)})})()}):e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:t.experience&&t.experience.length>0?t.experience.map((p,f)=>{if(typeof p=="string"){const r=p.match(/^(.+?)\s*([+-]?\d+)$/);if(r){const[,o,a]=r;return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:a})})}),e.jsx("span",{style:{marginLeft:"32px"},children:o})]},f)}else return e.jsx("div",{style:{marginBottom:"0.25rem"},children:p},f)}else return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:e.jsxs("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:[p.modifier>=0?"+":"",p.modifier]})})}),e.jsx("span",{style:{marginLeft:"32px"},children:p.name})]},f)}):null})})]}),(t.features&&t.features.length>0||m)&&e.jsxs("div",{style:{padding:"0 8px 8px 8px"},children:[(t.atk!==void 0&&t.weapon||m)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Standard Attack"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:m?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",marginTop:"0.75rem",marginBottom:"0.75rem"},children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[e.jsx("input",{type:"text",value:t.weapon||"",onChange:p=>i&&i(t.id,{weapon:p.target.value}),placeholder:"Standard attack name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}}),e.jsxs("select",{value:t.range||"",onChange:p=>i&&i(t.id,{range:p.target.value}),style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",appearance:"none",backgroundImage:`url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",backgroundSize:"1rem",paddingRight:"2rem"},children:[e.jsx("option",{value:""}),e.jsx("option",{value:"Melee",children:"Melee"}),e.jsx("option",{value:"Very Close",children:"Very Close"}),e.jsx("option",{value:"Close",children:"Close"}),e.jsx("option",{value:"Far",children:"Far"}),e.jsx("option",{value:"Very Far",children:"Very Far"})]}),e.jsx("input",{type:"text",value:t.damage||"",onChange:p=>i&&i(t.id,{damage:p.target.value}),placeholder:"Damage (e.g., 1d6+2)",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}})]})}):t.atk!==void 0&&t.weapon&&e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:t.weapon}),e.jsxs("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:["Make an attack against a target within ",t.range||"Melee"," range. On a success, deal ",t.damage||"damage varies","."]})]})})]}),(t.features.filter(p=>p.type==="Action").length>0||m)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Actions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const p=t.features.filter(r=>r.type==="Action");return(m&&p.length===0?[{type:"Action",name:"",description:""}]:p).map((r,o)=>m?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:r.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false","data-lpignore":"true","data-form-type":"other",name:`feature-name-${r.type.toLowerCase()}`,onChange:a=>{const n=[...t.features||[]],l=n.findIndex(H=>H.type==="Action"&&H===r);l>=0?n[l]={...n[l],name:a.target.value}:n.push({type:"Action",name:a.target.value,description:r.description||""});const E=n.filter(H=>H.type==="Action"),A=E[E.length-1];A&&A.name.trim()&&n.push({type:"Action",name:"",description:""}),i&&i(t.id,{features:n})},placeholder:"Action name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:r.description||"",onChange:a=>{const n=[...t.features||[]],l=n.findIndex(H=>H.type==="Action"&&H===r);l>=0?n[l]={...n[l],description:a.target.value}:n.push({type:"Action",name:r.name||"",description:a.target.value});const E=n.filter(H=>H.type==="Action"),A=E[E.length-1];A&&A.name.trim()&&n.push({type:"Action",name:"",description:""}),i&&i(t.id,{features:n})},onInput:a=>{const n=a.target.offsetHeight;a.target.style.height="auto";const l=a.target.scrollHeight,E=l>n?l:n;a.target.style.height=E+"px"},placeholder:"Action description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(Pe,{feature:r,featureType:"Action",item:t,onUpdate:i,handleFeatureDeleteClick:N,deleteConfirmations:W,getFeatureKey:L})]},o):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:r.name}),r.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:r.description})]},o))})()})]}),(t.features.filter(p=>p.type==="Passive").length>0||m)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Passives"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const p=t.features.filter(r=>r.type==="Passive");return(m&&p.length===0?[{type:"Passive",name:"",description:""}]:p).map((r,o)=>m?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:r.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:a=>{const n=[...t.features||[]],l=n.findIndex(H=>H.type==="Passive"&&H===r);l>=0?n[l]={...n[l],name:a.target.value}:n.push({type:"Passive",name:a.target.value,description:r.description||""});const E=n.filter(H=>H.type==="Passive"),A=E[E.length-1];A&&A.name.trim()&&n.push({type:"Passive",name:"",description:""}),i&&i(t.id,{features:n})},placeholder:"Passive name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:r.description||"",onChange:a=>{const n=[...t.features||[]],l=n.findIndex(H=>H.type==="Passive"&&H===r);l>=0?n[l]={...n[l],description:a.target.value}:n.push({type:"Passive",name:r.name||"",description:a.target.value});const E=n.filter(H=>H.type==="Passive"),A=E[E.length-1];A&&A.name.trim()&&n.push({type:"Passive",name:"",description:""}),i&&i(t.id,{features:n})},onInput:a=>{const n=a.target.offsetHeight;a.target.style.height="auto";const l=a.target.scrollHeight,E=l>n?l:n;a.target.style.height=E+"px"},placeholder:"Passive description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(Pe,{feature:r,featureType:"Passive",item:t,onUpdate:i,handleFeatureDeleteClick:N,deleteConfirmations:W,getFeatureKey:L})]},o):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:r.name}),r.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:r.description})]},o))})()})]}),(t.features.filter(p=>p.type==="Reaction").length>0||m)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Reactions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const p=t.features.filter(r=>r.type==="Reaction");return(m&&p.length===0?[{type:"Reaction",name:"",description:""}]:p).map((r,o)=>m?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:r.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:a=>{const n=[...t.features||[]],l=n.findIndex(H=>H.type==="Reaction"&&H===r);l>=0?n[l]={...n[l],name:a.target.value}:n.push({type:"Reaction",name:a.target.value,description:r.description||""});const E=n.filter(H=>H.type==="Reaction"),A=E[E.length-1];A&&A.name.trim()&&n.push({type:"Reaction",name:"",description:""}),i&&i(t.id,{features:n})},placeholder:"Reaction name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:r.description||"",onChange:a=>{const n=[...t.features||[]],l=n.findIndex(H=>H.type==="Reaction"&&H===r);l>=0?n[l]={...n[l],description:a.target.value}:n.push({type:"Reaction",name:r.name||"",description:a.target.value});const E=n.filter(H=>H.type==="Reaction"),A=E[E.length-1];A&&A.name.trim()&&n.push({type:"Reaction",name:"",description:""}),i&&i(t.id,{features:n})},onInput:a=>{const n=a.target.offsetHeight;a.target.style.height="auto";const l=a.target.scrollHeight,E=l>n?l:n;a.target.style.height=E+"px"},placeholder:"Reaction description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(Pe,{feature:r,featureType:"Reaction",item:t,onUpdate:i,handleFeatureDeleteClick:N,deleteConfirmations:W,getFeatureKey:L})]},o):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:r.name}),r.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:r.description})]},o))})()})]})]})]}),(q&&q.length>0||t.type!=="Minion"&&(t.thresholds||m))&&e.jsxs("div",{style:{padding:"0 8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Status"})]}),m?e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border)"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"number",value:t.hpMax||"",onChange:p=>{const f=parseInt(p.target.value)||1;i&&i(t.id,{hpMax:f})},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),e.jsx(ke,{type:"adversaryHP",value:0,maxValue:t.hpMax||1,showTooltip:!1}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:"HP"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"number",value:t.stressMax||"",onChange:p=>{const f=parseInt(p.target.value)||1;i&&i(t.id,{stressMax:f})},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),e.jsx(ke,{type:"adversaryStress",value:0,maxValue:t.stressMax||1,showTooltip:!1}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:"Stress"})]})]})})}):q&&q.length>0&&q.map((p,f)=>{const r=(p.hp||0)>=(p.hpMax||1);return e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsxs("div",{style:{backgroundColor:r?"var(--gray-900)":"var(--bg-primary)",borderRadius:"6px",padding:"0.25rem 0.5rem",border:"1px solid",borderColor:r?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",display:"flex",justifyContent:"flex-start",alignItems:"center",gap:"0.5rem",opacity:r?.7:1,position:"relative",transition:"all 0.2s ease",minHeight:"40px"},children:[r&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                          45deg,
                          transparent 0px,
                          transparent 8px,
                          var(--gray-600) 9px,
                          var(--gray-600) 9px
                        )`,pointerEvents:"none",zIndex:1,borderRadius:"4px"}}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"var(--text-secondary)",fontSize:"0.8rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em",zIndex:2,backgroundColor:"var(--gray-900)",padding:"0.125rem 0.25rem",borderRadius:"0.25rem",border:"0.5px solid var(--gray-600)"},children:"DEFEATED"})]}),e.jsx("div",{style:{backgroundColor:r?"var(--gray-900)":"var(--bg-card)",border:"1px solid",borderColor:r?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",borderRadius:"50%",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",flexShrink:0,opacity:r?.5:1},children:e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:r?"var(--gray-400)":"var(--text-primary)"},children:p.duplicateNumber||1})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.125rem"},children:[e.jsx("div",{style:{opacity:r?.3:1},children:e.jsx(ke,{type:"adversaryHP",value:p.hp||0,maxValue:p.hpMax||1,onPipClick:(o,a)=>{if(x&&s==="adversary"){const n=p.hp||0,l=p.hpMax||1;a?c&&c(p.id,1,n):n<l&&x(p.id,1,n,l)}},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})}),p.stressMax>0&&e.jsx("div",{style:{opacity:r?.3:1},children:e.jsx(ke,{type:"adversaryStress",value:p.stress||0,maxValue:p.stressMax,onPipClick:(o,a)=>{I&&s==="adversary"&&(a?I(p.id,-1):I(p.id,1))},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})})]})]},p.id)},p.id)}),t.type!=="Minion"&&(t.thresholds||m)&&e.jsx("div",{style:{display:"flex",justifyContent:"center",paddingTop:"1px",marginTop:"0.5rem",marginBottom:"0.5rem"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",position:"relative"},children:e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",height:"36px"},children:[e.jsx("svg",{width:"300",height:"36",viewBox:"0 0 300 36",style:{position:"absolute",zIndex:1},children:e.jsx("rect",{x:"20",y:"6",width:"260",height:"24",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4"})}),e.jsx("div",{style:{position:"relative",zIndex:2,display:"flex",alignItems:"center",gap:"0.5rem"},children:m?e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",fontSize:"0.8rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),e.jsx("input",{type:"text",value:((R=t.thresholds)==null?void 0:R.major)||"7",onChange:p=>{const f=p.target.value.replace(/[^0-9]/g,"");f.length<=2&&i&&i(t.id,{thresholds:{...t.thresholds,major:parseInt(f)||7}})},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),e.jsx("input",{type:"text",value:((K=t.thresholds)==null?void 0:K.severe)||"14",onChange:p=>{const f=p.target.value.replace(/[^0-9]/g,"");f.length<=2&&i&&i(t.id,{thresholds:{...t.thresholds,severe:parseInt(f)||14}})},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),e.jsx(Ke,{value:((le=t.thresholds)==null?void 0:le.major)||"7"}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),e.jsx(Ke,{value:((ce=t.thresholds)==null?void 0:ce.severe)||"14"}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]})})]})})})]}),m&&e.jsxs("div",{style:{padding:"0 8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Description"})]}),m?e.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-primary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"none",overflow:"hidden",fontFamily:"inherit",marginTop:"0.75rem",marginBottom:"0.75rem"},value:t.description,onChange:p=>{p.target.style.height="auto",p.target.style.height=p.target.scrollHeight+"px",i&&i(t.id,{description:p.target.value})},placeholder:"Description..."}):e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",whiteSpace:"pre-wrap"},children:t.description})]}),oe()]})};return(d==="expanded"||d==="edit")&&(s==="adversary"||s==="adversaries")?D():s==="adversary"||s==="adversaries"?null:e.jsxs("div",{className:ie(),style:G(!0),children:[e.jsxs("div",{style:ue.rowMain,children:[e.jsx("h4",{style:ue.rowTitle,children:se()}),e.jsx("div",{style:ue.rowMeta,children:ae()})]}),e.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"12px",margin:0},children:["Expanded view coming soon for ",s]})]})},Rt="modulepreload",Mt=function(t){return"/Daggerheart/"+t},Qe={},Te=function(s,d,h){if(!d||d.length===0)return s();const g=document.getElementsByTagName("link");return Promise.all(d.map(x=>{if(x=Mt(x),x in Qe)return;Qe[x]=!0;const c=x.endsWith(".css"),I=c?'[rel="stylesheet"]':"";if(!!h)for(let k=g.length-1;k>=0;k--){const z=g[k];if(z.href===x&&(!c||z.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${x}"]${I}`))return;const S=document.createElement("link");if(S.rel=c?"stylesheet":Rt,c||(S.as="script",S.crossOrigin=""),S.href=x,document.head.appendChild(S),c)return new Promise((k,z)=>{S.addEventListener("load",k),S.addEventListener("error",()=>z(new Error(`Unable to preload CSS for ${x}`)))})})).then(()=>s()).catch(x=>{const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=x,window.dispatchEvent(c),!c.defaultPrevented)throw x})},Nt=({onSave:t,onRefresh:s,onAddItem:d})=>{const[h,g]=j.useState({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:11,thresholds:{major:7,severe:12},hpMax:3,stressMax:1,atk:"+1",weapon:"",range:"Melee",damage:"",experience:[],features:[]}),[x,c]=j.useState(!1),I=async()=>{if(!h.name.trim()){alert("Please enter a name for the adversary");return}c(!0);try{const S={...h,hp:0,stress:0,source:"Homebrew"},k=await t(S);d&&k&&d(k),s&&await s(),g({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:11,thresholds:{major:7,severe:12},hpMax:3,stressMax:1,atk:"+1",weapon:"",range:"Melee",damage:"",experience:[],features:[]}),alert("Custom adversary created successfully!")}catch(S){console.error("Error saving adversary:",S),alert("Error saving adversary. Please try again.")}finally{c(!1)}},i={...h,id:"new-adversary",hp:0,stress:0,source:"Homebrew"};return e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem",display:"flex",justifyContent:"center",alignItems:"flex-start"},children:e.jsxs("div",{style:{maxWidth:"600px",width:"100%"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h2",{style:{color:"var(--text-primary)",fontSize:"1.5rem",fontWeight:"600",margin:0},children:"Create Custom Adversary"}),e.jsx("button",{onClick:I,disabled:x||!h.name.trim(),style:{padding:"0.75rem 1.5rem",backgroundColor:x||!h.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"8px",cursor:x||!h.name.trim()?"not-allowed":"pointer",fontSize:"1rem",fontWeight:"600",opacity:x||!h.name.trim()?.6:1},children:x?"Creating...":"Create and Add"})]}),e.jsx(Ve,{item:i,type:"adversary",mode:"edit",onUpdate:(S,k)=>{g(z=>({...z,...k}))}})]})})},Bt=(t,s)=>{const[d,h]=j.useState("max-content"),g=j.useCallback(()=>{if(!s.current||t<=3)return"max-content";const x=s.current.offsetWidth,I=Math.floor(x/120);return I<=1?"max-content":t===4?"max-content max-content":t===5||t===6?I>=2?"max-content max-content":"max-content":t===7?I>=3?"max-content max-content max-content":I>=2?"max-content max-content":"max-content":"repeat(auto-fit, minmax(80px, max-content))"},[t,s]);return j.useEffect(()=>{const x=g();h(x);const c=new ResizeObserver(()=>{const I=g();h(I)});return s.current&&c.observe(s.current),()=>{c.disconnect()}},[g]),d},Dt=({encounter:t})=>{var g,x;const s=j.useRef(null),d=((g=t.encounterItems)==null?void 0:g.length)||0,h=Bt(d,s);return e.jsx("div",{ref:s,className:"saved-encounter-adversary-list",style:{flex:1,fontSize:"0.8rem",color:"var(--text-secondary)",lineHeight:"1.3",display:"grid",gridTemplateColumns:h,gap:"0.25rem 1rem",gridAutoRows:"min-content"},children:((x=t.encounterItems)==null?void 0:x.length)>0?t.encounterItems.map((c,I)=>{var S;const i=c.item.baseName||((S=c.item.name)==null?void 0:S.replace(/\s+\(\d+\)$/,""))||c.item.name;return e.jsxs("div",{style:{marginBottom:"0.125rem"},children:[c.quantity,"x ",i]},I)}):e.jsx("div",{children:"No adversaries"})})},Ee={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},Re={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1,lowerTierAdversary:1};let Me={adversaries:[]},Ne={environments:[]},Be=!1;const nt=()=>{const t=JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]"),s=JSON.parse(localStorage.getItem("daggerheart-custom-environments")||"[]");return{customAdversaries:t,customEnvironments:s}},Lt=(t,s)=>{t==="adversary"?localStorage.setItem("daggerheart-custom-adversaries",JSON.stringify(s)):t==="environment"&&localStorage.setItem("daggerheart-custom-environments",JSON.stringify(s))},$e=async()=>{if(Be)return;let t={adversaries:[]},s={environments:[]},d={adversaries:[]},h={environments:[]};try{const c=await Te(()=>import("./adversaries-9c8932de.js"),[]);t=(c==null?void 0:c.default)||c}catch(c){console.warn("Failed to load adversaries.json:",c)}try{const c=await Te(()=>import("./environments-c340637c.js"),[]);s=(c==null?void 0:c.default)||c}catch(c){console.warn("Failed to load environments.json:",c)}try{const c=await Te(()=>import("./playtest-adversaries-4a099c10.js"),[]);d=(c==null?void 0:c.default)||c}catch(c){console.warn("Failed to load playtest-adversaries.json:",c)}try{const c=await Te(()=>import("./playtest-environments-d9cdffb6.js"),[]);h=(c==null?void 0:c.default)||c}catch(c){console.warn("Failed to load playtest-environments.json:",c)}const{customAdversaries:g,customEnvironments:x}=nt();Me={...t,adversaries:[...t.adversaries||[],...d.adversaries||[],...g]},Ne={...s,environments:[...s.environments||[],...h.environments||[],...x]},Be=!0,console.log(`Loaded ${Me.adversaries.length} adversaries and ${Ne.environments.length} environments`)},Pt=t=>{const{customAdversaries:s}=nt(),d={...t,id:`custom-${Date.now()}-${Math.random().toString(36).slice(2,10)}`,source:t.source||"Homebrew"},h=[...s,d];return Lt("adversary",h),Be=!1,$e(),d},Ht=(t,s=[],d=4,h=1)=>{const[g,x]=j.useState(""),[c,I]=j.useState([{field:"tier",direction:"asc"},{field:"name",direction:"asc"}]),[i,S]=j.useState([]),[k,z]=j.useState(!0),[q,v]=j.useState([]),[W,Y]=j.useState([]),[L,P]=j.useState(!1),[N,O]=j.useState(!1),y=j.useRef(null),F=j.useRef(null);j.useEffect(()=>{(async()=>{await $e(),z(!1);let b=[];t==="adversary"?b=Me.adversaries||[]:t==="environment"&&(b=Ne.environments||[]),S(b)})()},[t]);const ee=j.useCallback(async()=>{Be=!1,await $e();let m=[];t==="adversary"?m=Me.adversaries||[]:t==="environment"&&(m=Ne.environments||[]),S(m)},[t]),$=m=>{const b=i.map(R=>R[m]).filter(Boolean);return[...new Set(b)].sort((R,K)=>typeof R=="number"&&typeof K=="number"?R-K:String(R).localeCompare(String(K)))},de=$("tier"),G=$("type"),ie=j.useMemo(()=>{let m=i.filter(b=>{var ce,p;const R=b.name.toLowerCase().includes(g.toLowerCase())||((ce=b.type)==null?void 0:ce.toLowerCase().includes(g.toLowerCase()))||((p=b.description)==null?void 0:p.toLowerCase().includes(g.toLowerCase())),K=q.length===0||(q.includes("party-tier")?b.tier===h:q.includes(b.tier.toString())),le=W.length===0||W.includes(b.type);return R&&K&&le});return m.sort((b,R)=>{for(const K of c){const{field:le,direction:ce}=K;let p=b[le],f=R[le];if(le==="tier")p=parseInt(p)||0,f=parseInt(f)||0;else if(le==="cost"){const r=o=>{if(t!=="adversary")return 0;const a=Ee[o.type]||2;let n=0;const l=s.filter(A=>A.type==="adversary"&&A.item.type==="Solo"&&A.quantity>0).reduce((A,H)=>A+H.quantity,0),E=s.filter(A=>A.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(A.item.type)&&A.quantity>0).reduce((A,H)=>A+H.quantity,0);return o.type==="Solo"&&l===1&&(n+=2),["Bruiser","Horde","Leader","Solo"].includes(o.type)&&E===0&&(n+=1),a+n};p=r(b),f=r(R)}else if(le==="difficulty"){const r=parseInt(p),o=parseInt(f);!isNaN(r)&&!isNaN(o)?(p=r,f=o):!isNaN(r)&&isNaN(o)?(p=r,f=999):isNaN(r)&&!isNaN(o)?(p=999,f=o):(p=String(p||"").toLowerCase(),f=String(f||"").toLowerCase())}else typeof p=="string"&&typeof f=="string"?(p=p.toLowerCase(),f=f.toLowerCase()):(p=String(p||"").toLowerCase(),f=String(f||"").toLowerCase());if(ce==="asc"){if(p>f)return 1;if(p<f)return-1}else{if(p<f)return 1;if(p>f)return-1}}return 0}),m},[i,g,c,q,W,s,d,h]),se=m=>{I(b=>{const R=b.findIndex(K=>K.field===m);if(R>=0)if(R===0){const K=[...b];return K[0]={...K[0],direction:K[0].direction==="asc"?"desc":"asc"},K}else{const K=[...b];return K.splice(R,1)[0],[{field:m,direction:"asc"},...K]}else return[{field:m,direction:"asc"},...b]})},ae=m=>{v(m==="clear"?[]:m==="party-tier"?["party-tier"]:b=>b.includes(m)?b.filter(R=>R!==m):[...b,m])},oe=m=>{Y(m==="clear"?[]:b=>b.includes(m)?b.filter(R=>R!==m):[...b,m])},D=q.length>0,Z=W.length>0;return j.useEffect(()=>{const m=R=>{const K=R.target.closest(".filter-dropdown"),le=R.target.closest(".header-filter-icon");K||le||(P(!1),O(!1))},b=R=>{R.key==="Escape"&&(P(!1),O(!1))};return document.addEventListener("pointerdown",m,!0),document.addEventListener("mousedown",m,!0),document.addEventListener("touchstart",m,!0),document.addEventListener("click",m,!0),document.addEventListener("keydown",b,!0),()=>{document.removeEventListener("pointerdown",m,!0),document.removeEventListener("mousedown",m,!0),document.removeEventListener("touchstart",m,!0),document.removeEventListener("click",m,!0),document.removeEventListener("keydown",b,!0)}},[P,O]),{searchTerm:g,setSearchTerm:x,sortFields:c,handleSort:se,filteredAndSortedData:ie,loading:k,refreshData:ee,selectedTiers:q,selectedTypes:W,showTierDropdown:L,setShowTierDropdown:P,showTypeDropdown:N,setShowTypeDropdown:O,tierFilterRef:y,typeFilterRef:F,uniqueTiers:de,uniqueTypes:G,handleTierSelect:ae,handleTypeSelect:oe,isTierFiltered:D,isTypeFiltered:Z,getDropdownStyle:m=>{if(!m.current)return{};const b=m.current.getBoundingClientRect();return{position:"fixed",top:b.bottom+4,left:b.left-100,zIndex:99999}}}},Ft=({searchTerm:t,onSearchChange:s,type:d,partyControls:h})=>e.jsxs("div",{style:J.browserHeader,children:[e.jsx("input",{type:"text",placeholder:"Search",value:t,onChange:g=>s(g.target.value),style:J.searchInput}),h&&e.jsx("div",{style:J.partyControls,children:h})]}),Ot=({sortFields:t,onSort:s,type:d,uniqueTiers:h,uniqueTypes:g,selectedTiers:x,selectedTypes:c,showTierDropdown:I,setShowTierDropdown:i,showTypeDropdown:S,setShowTypeDropdown:k,tierFilterRef:z,typeFilterRef:q,handleTierSelect:v,handleTypeSelect:W,isTierFiltered:Y,isTypeFiltered:L,getDropdownStyle:P,costFilter:N,showCostDropdown:O,setShowCostDropdown:y,costFilterRef:F,handleCostFilterSelect:ee,isCostFiltered:$})=>{const[de,G]=j.useState(null),se=(()=>d==="adversary"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"cost",label:"Cost",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:d==="environment"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:[])(),ae=()=>{if(!O)return null;const D=[{value:"all",label:"All"},{value:"auto-grey",label:"Auto Grey"},{value:"auto-hide",label:"Auto Hide"}];return Fe.createPortal(e.jsx("div",{className:"filter-dropdown",style:{...J.filterDropdown,...P(F),maxHeight:"60vh",overflow:"auto"},onMouseDown:Z=>Z.stopPropagation(),onClick:Z=>Z.stopPropagation(),children:D.map(Z=>{const w=N===Z.value;return e.jsxs("div",{style:{...J.filterOption,...w?J.filterOptionSelected:{}},onClick:()=>ee(Z.value),children:[e.jsx("span",{style:J.checkIcon,children:w?e.jsx(ze,{size:16}):e.jsx(We,{size:16})}),e.jsx("span",{style:J.filterLabel,children:Z.label})]},Z.value)})}),document.body)},oe=(D,Z,w,m,b,R,K,le)=>{if(!b)return null;const ce=()=>{(D==="tier"||D==="type")&&m("clear")};return Fe.createPortal(e.jsxs("div",{className:"filter-dropdown",style:{...J.filterDropdown,...P(K),maxHeight:"60vh",overflow:"auto"},onMouseDown:p=>p.stopPropagation(),onClick:p=>p.stopPropagation(),children:[e.jsxs("div",{style:{...J.filterOption,...w.length===0?J.filterOptionSelected:{}},onClick:ce,children:[e.jsx("span",{style:J.checkIcon,children:w.length===0?e.jsx(ze,{size:16}):e.jsx(We,{size:16})}),e.jsx("span",{style:J.filterLabel,children:"All"})]}),D==="tier"&&e.jsxs("div",{style:{...J.filterOption,...w.includes("party-tier")?J.filterOptionSelected:{}},onClick:()=>m("party-tier"),children:[e.jsx("span",{style:J.checkIcon,children:w.includes("party-tier")?e.jsx(ze,{size:16}):e.jsx(We,{size:16})}),e.jsx("span",{style:J.filterLabel,children:"Party Tier"})]}),Z.map(p=>{const f=w.includes(p.toString());return e.jsxs("div",{style:{...J.filterOption,...f?J.filterOptionSelected:{}},onClick:()=>m(p.toString()),children:[e.jsx("span",{style:J.checkIcon,children:f?e.jsx(ze,{size:16}):e.jsx(We,{size:16})}),e.jsx("span",{style:J.filterLabel,children:p})]},p)})]}),document.body)};return e.jsx("tr",{style:J.tableHeader,children:se.map(D=>e.jsxs("th",{style:{...J.tableHeaderCell,...de===D.key?J.tableHeaderCellHover:{},position:"relative",...D.key==="name"?{width:"auto",minWidth:"0"}:{},...D.key==="tier"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...D.key==="type"?{width:"80px",minWidth:"80px",maxWidth:"80px"}:{},...D.key==="difficulty"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...D.key==="cost"?{width:"50px",minWidth:"50px",maxWidth:"50px"}:{},...D.key==="action"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{}},onClick:()=>s(D.key),onMouseEnter:()=>G(D.key),onMouseLeave:()=>G(null),children:[D.hasFilter?e.jsxs("div",{style:J.headerWithFilter,children:[e.jsx("span",{style:{cursor:"pointer"},onClick:Z=>{Z.stopPropagation(),s(D.key)},children:D.label}),e.jsxs("button",{ref:D.key==="tier"?z:D.key==="type"?q:F,style:{...J.headerFilterIcon,...D.key==="tier"&&Y?J.headerFilterIconActive:{},...D.key==="type"&&L?J.headerFilterIconActive:{},...D.key==="cost"&&$?J.headerFilterIconActive:{}},className:"header-filter-icon",onClick:Z=>{Z.stopPropagation(),D.key==="tier"?(i(!I),k(!1),y(!1)):D.key==="type"?(k(!S),i(!1),y(!1)):D.key==="cost"&&(y(!O),i(!1),k(!1))},children:[e.jsx(gt,{size:14}),D.key==="tier"&&Y||D.key==="type"&&L||D.key==="cost"&&$?e.jsx("span",{style:J.filterActiveDot}):null]})]}):D.label,D.key==="tier"&&oe("tier",h,x,v,I,i,z),D.key==="type"&&oe("type",g,c,W,S,k,q),D.key==="cost"&&ae()]},D.key))})},$t=({item:t,onAdd:s,type:d,onRowClick:h,encounterItems:g=[],pcCount:x=4,playerTier:c=1,remainingBudget:I=0,costFilter:i="auto-grey",onAdversaryClick:S})=>{const[k,z]=j.useState(!1),q=()=>{s(t)},v=()=>{if(d!=="adversary")return null;const L=Ee[t.type]||2;let P=0;const N=g.filter(y=>y.type==="adversary"&&y.item.type==="Solo"&&y.quantity>0).reduce((y,F)=>y+F.quantity,0),O=g.filter(y=>y.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(y.item.type)&&y.quantity>0).reduce((y,F)=>y+F.quantity,0);return t.type==="Solo"&&N===1&&(P+=2),["Bruiser","Horde","Leader","Solo"].includes(t.type)&&O===0&&(P+=1),L+P},Y=(()=>{if(d==="adversary"){const L=v();Ee[t.type];const P=L>I||I<=0;if(i==="auto-hide"&&P)return null;const N=i==="auto-grey"&&P?{opacity:.5,color:"var(--text-secondary)"}:{};return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...J.rowCell,width:"auto",minWidth:"0",textAlign:"left",...N},children:e.jsxs("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:[e.jsx("div",{style:{fontWeight:"600"},children:t.name}),t.description&&e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"0.125rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.description})]})}),e.jsx("td",{style:{...J.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...N},children:t.tier}),e.jsx("td",{style:{...J.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center",...N},children:t.type}),e.jsx("td",{style:{...J.rowCell,width:"50px",minWidth:"50px",maxWidth:"50px",textAlign:"center",...N},children:L}),e.jsx("td",{style:{...J.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...N},children:t.difficulty})]})}else if(d==="environment")return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...J.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:t.name}),e.jsx("td",{style:{...J.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:t.tier}),e.jsx("td",{style:{...J.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:t.type}),e.jsx("td",{style:{...J.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:t.difficulty})]});return null})();return Y===null?null:e.jsx(e.Fragment,{children:e.jsxs("tr",{style:{...J.row,...k?J.rowHover:{}},onClick:()=>{d==="adversary"&&S?S(t):h&&h(t,d)},onMouseEnter:()=>z(!0),onMouseLeave:()=>z(!1),children:[Y,e.jsx("td",{style:{width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",boxSizing:"border-box",overflow:"visible",textOverflow:"unset",whiteSpace:"nowrap"},children:e.jsx("button",{style:J.addButton,onClick:L=>{L.stopPropagation(),q()},onMouseEnter:L=>{L.target.style.background="var(--bg-secondary)"},onMouseLeave:L=>{L.target.style.background="var(--purple)"},children:"+"})})]})})},qt=({type:t,onAddItem:s,onCancel:d=null,onRowClick:h,encounterItems:g=[],pcCount:x=4,playerTier:c=1,partyControls:I=null,showContainer:i=!0,savedEncounters:S=[],onLoadEncounter:k,onDeleteEncounter:z,activeTab:q="adversaries"})=>{const[v,W]=j.useState("all"),[Y,L]=j.useState(!1),[P,N]=j.useState(null),[O,y]=j.useState({}),F=j.useRef({}),ee=j.useRef(null),$=T=>{O[T]?(z&&z(T),y(u=>{const C={...u};return delete C[T],C}),F.current[T]&&(clearTimeout(F.current[T]),delete F.current[T])):(y(u=>({...u,[T]:!0})),F.current[T]&&clearTimeout(F.current[T]),F.current[T]=setTimeout(()=>{y(u=>{const C={...u};return delete C[T],C}),delete F.current[T]},3e3))};j.useEffect(()=>()=>{Object.values(F.current).forEach(T=>{clearTimeout(T)})},[]);const{searchTerm:de,setSearchTerm:G,sortFields:ie,handleSort:se,filteredAndSortedData:ae,loading:oe,refreshData:D,selectedTiers:Z,selectedTypes:w,showTierDropdown:m,setShowTierDropdown:b,showTypeDropdown:R,setShowTypeDropdown:K,tierFilterRef:le,typeFilterRef:ce,uniqueTiers:p,uniqueTypes:f,handleTierSelect:r,handleTypeSelect:o,isTierFiltered:a,isTypeFiltered:n,getDropdownStyle:l}=Ht(t,g,x,c),A=(()=>{const T=3*x+2,u=g.reduce((M,re)=>{if(re.type==="adversary"){const xe=Ee[re.item.type]||2;if(re.item.type==="Minion"){const ne=Math.ceil(re.quantity/x);return M+ne*xe}else return M+re.quantity*xe}return M},0);let C=0;g.filter(M=>M.type==="adversary"&&M.item.type==="Solo"&&M.quantity>0).reduce((M,re)=>M+re.quantity,0)>=2&&(C+=Re.twoOrMoreSolos);const V=g.some(M=>M.type==="adversary"&&M.item.type==="Bruiser"&&M.quantity>0),X=g.some(M=>M.type==="adversary"&&M.item.type==="Horde"&&M.quantity>0),te=g.some(M=>M.type==="adversary"&&M.item.type==="Leader"&&M.quantity>0),_=g.some(M=>M.type==="adversary"&&M.item.type==="Solo"&&M.quantity>0);return!V&&!X&&!te&&!_&&(C+=Re.noBruisersHordesLeadersSolos),T+C-u})(),H=T=>{W(T),L(!1)},U=v!=="all";return oe?e.jsx("div",{style:J.browser,children:e.jsx("div",{style:J.loading,children:"Loading..."})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:i?J.browserWrapper:J.browserWrapperNoContainer,children:[q==="adversaries"&&e.jsxs(e.Fragment,{children:[e.jsx(Ft,{searchTerm:de,onSearchChange:G,type:t,partyControls:I}),e.jsx("div",{className:"browser-content invisible-scrollbar",style:J.browserContent,children:e.jsxs("table",{style:J.browserTable,children:[e.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,backgroundColor:"var(--bg-primary)"},children:e.jsx(Ot,{sortFields:ie,onSort:se,type:t,uniqueTiers:p,uniqueTypes:f,selectedTiers:Z,selectedTypes:w,showTierDropdown:m,setShowTierDropdown:b,showTypeDropdown:R,setShowTypeDropdown:K,tierFilterRef:le,typeFilterRef:ce,handleTierSelect:r,handleTypeSelect:o,isTierFiltered:a,isTypeFiltered:n,getDropdownStyle:l,costFilter:v,showCostDropdown:Y,setShowCostDropdown:L,costFilterRef:ee,handleCostFilterSelect:H,isCostFiltered:U})}),e.jsx("tbody",{children:ae.map(T=>e.jsx($t,{item:T,onAdd:s,type:t,onRowClick:h,encounterItems:g,pcCount:x,playerTier:c,remainingBudget:A,costFilter:v,onAdversaryClick:u=>{t==="adversary"&&N(u)}},T.id))})]})})]}),q==="encounters"&&e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:S.length===0?e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",textAlign:"center",padding:"2rem 1rem"},children:"No saved encounters yet"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:S.map(T=>e.jsxs("div",{onClick:()=>k&&k(T.id),className:"saved-encounter-card",style:{border:"1px solid var(--border)",borderRadius:"8px",padding:"8px",backgroundColor:"var(--bg-card)",transition:"background-color 0.2s ease",display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsxs("div",{style:{minWidth:"100px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",flexDirection:"column",justifyContent:"center",minHeight:"60px"},children:[e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Tier: ",(()=>{var B,V,X,te;const u=((te=(X=(V=(B=T.encounterItems)==null?void 0:B.filter(_=>_.type==="adversary"))==null?void 0:V.map(_=>_.item.tier))==null?void 0:X.filter(_=>_!=null))==null?void 0:te.sort((_,Q)=>_-Q))||[];if(u.length===0)return"N/A";if(u.length===1)return u[0];const C=[...new Set(u)];return C.length===1?C[0]:`${Math.min(...C)}-${Math.max(...C)}`})()]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Party Size: ",T.partySize||4]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)"},children:["Balance: ",(()=>{const u=T.partySize||4,C=3*u+2;let B=0;const V=T.encounterItems||[];V.filter(ne=>ne.type==="adversary"&&ne.item.type==="Solo"&&ne.quantity>0).reduce((ne,fe)=>ne+fe.quantity,0)>=2&&(B+=Re.twoOrMoreSolos);const te=V.some(ne=>ne.type==="adversary"&&ne.item.type==="Bruiser"&&ne.quantity>0),_=V.some(ne=>ne.type==="adversary"&&ne.item.type==="Horde"&&ne.quantity>0),Q=V.some(ne=>ne.type==="adversary"&&ne.item.type==="Leader"&&ne.quantity>0),M=V.some(ne=>ne.type==="adversary"&&ne.item.type==="Solo"&&ne.quantity>0);!te&&!_&&!Q&&!M&&(B+=Re.noBruisersHordesLeadersSolos);const re=C+B,xe=V.reduce((ne,fe)=>{if(fe.type==="adversary"){const ye=Ee[fe.item.type]||2;if(fe.item.type==="Minion"){const ge=Math.ceil(fe.quantity/u);return ne+ge*ye}else return ne+fe.quantity*ye}return ne},0);return xe>re?`+${xe-re}`:xe===re?"0":`-${re-xe}`})()]})]}),e.jsx("div",{style:{minWidth:"120px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",alignItems:"center",minHeight:"60px"},children:e.jsx("div",{style:{fontWeight:"500",color:"var(--text-primary)",fontSize:"0.9rem",wordWrap:"break-word",wordBreak:"break-word",width:"150px",maxWidth:"150px"},children:T.name})}),e.jsx(Dt,{encounter:T}),e.jsx("button",{onClick:u=>{u.stopPropagation(),$(T.id)},style:{background:O[T.id]?"var(--danger)":"var(--gray-600)",border:"none",color:"white",padding:"0.4rem 0.8rem",borderRadius:"4px",fontSize:"0.75rem",cursor:"pointer",minWidth:"60px",transition:"background-color 0.2s"},children:"Delete"})]},T.id))})}),q==="custom"&&e.jsx(Nt,{onSave:Pt,onRefresh:D,onAddItem:s})]}),P&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:2e3,display:"flex",alignItems:"center",justifyContent:"center",padding:"2rem"},onClick:()=>N(null),children:e.jsx("div",{style:{maxWidth:"600px",width:"90vw",maxHeight:"80vh",overflowY:"auto"},onClick:T=>T.stopPropagation(),children:e.jsx(Ve,{item:P,type:"adversary",mode:"expanded",onClose:()=>N(null)})})})]})},J={browserWrapper:{display:"flex",flexDirection:"column",background:"var(--bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border)",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserWrapperNoContainer:{display:"flex",flexDirection:"column",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserContent:{flex:1,overflowY:"auto",overflowX:"visible",padding:0,width:"100%",scrollbarWidth:"none",msOverflowStyle:"none"},tableHeaderContainer:{flexShrink:0,position:"sticky",top:0,zIndex:15,backgroundColor:"var(--bg-secondary)"},browserTable:{width:"100%",minWidth:"100%",borderCollapse:"collapse",tableLayout:"fixed",background:"var(--bg-primary)",margin:0},browserHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--gray-900)",flexShrink:0,position:"sticky",top:0,zIndex:20},browserTitle:{margin:0,color:"var(--text-primary)",fontSize:"18px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"24px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",marginRight:"12px",transition:"all 0.2s ease"},partyControls:{display:"flex",alignItems:"center",gap:"12px",flexShrink:0},searchInputFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 3px rgba(139, 92, 246, 0.1)"},tableHeader:{background:"var(--gray-900)",borderBottom:"1px solid var(--border)",boxShadow:"0 1px 0 var(--border)",position:"sticky",top:"0",zIndex:10},tableHeaderCell:{backgroundColor:"var(--gray-900)",fontWeight:"700",borderBottom:"1px solid var(--border)",cursor:"pointer",userSelect:"none",minWidth:"100px",whiteSpace:"nowrap",padding:"4px 4px",color:"var(--text-primary)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",boxShadow:"0 1px 0 var(--border)",transition:"background-color 0.2s",position:"sticky",top:"0",zIndex:10},tableHeaderCellHover:{backgroundColor:"var(--bg-hover)"},sortIndicator:{fontSize:"12px",color:"var(--text-secondary)"},tableBody:{flex:1,overflowY:"auto",padding:"8px",backgroundColor:"var(--bg-primary)"},row:{height:"35px",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s ease",cursor:"pointer",backgroundColor:"var(--gray-900)"},rowHover:{backgroundColor:"var(--bg-secondary)"},expandedRow:{backgroundColor:"var(--bg-secondary)"},rowCell:{padding:"4px 4px",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid var(--border)"},rowCellName:{fontWeight:"500",minWidth:"150px"},rowCellCenter:{textAlign:"center",justifyContent:"center",minWidth:"80px"},rowActions:{width:"80px",textAlign:"center",padding:"4px 8px",borderBottom:"1px solid var(--border)"},addButton:{width:"2rem",height:"2rem",border:"1px solid var(--purple)",borderRadius:"var(--radius-sm)",background:"var(--purple)",color:"white",cursor:"pointer",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"500"},expandedContent:{padding:"0",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)"},columnName:{width:"auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",paddingLeft:"8px",textAlign:"left"},columnTier:{width:"80px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnType:{width:"100px",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},columnDifficulty:{width:"40px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnAction:{width:"32px",minWidth:"24px",maxWidth:"24px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"visible",textOverflow:"unset"},loading:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"var(--text-primary)",fontSize:"16px"},mobileBrowser:{width:"95vw",height:"90vh",maxWidth:"none"},mobileSearchInput:{fontSize:"16px"},headerWithFilter:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0px",position:"relative"},headerFilterIcon:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"2px 4px",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",position:"relative",marginLeft:"-2px"},headerFilterIconActive:{color:"var(--purple)"},filterIcon:{fontSize:"12px"},filterActiveDot:{position:"absolute",left:"50%",top:"2px",transform:"translateX(-50%)",width:"4px",height:"4px",borderRadius:"50%",background:"var(--purple)",pointerEvents:"none"},filterDropdown:{position:"fixed",background:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",zIndex:99999,marginTop:"4px",overflow:"hidden",width:"max-content",minWidth:"120px",maxWidth:"200px"},filterOption:{padding:"8px 12px",cursor:"pointer",color:"var(--text-primary)",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background-color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},filterOptionSelected:{backgroundColor:"var(--bg-hover)"},checkIcon:{width:"16px",height:"16px",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"12px"},filterLabel:{flex:1}},Vt=()=>e.jsx("div",{className:"pwa-install-prompt",style:{}}),_t=({side:t="left",children:s,className:d="",style:h={}})=>{const g=t==="left",x={flex:1,minWidth:0,background:"var(--bg-primary)",overflowY:"auto",overflowX:g?"auto":"hidden",display:g?"block":"flex",flexDirection:g?"initial":"column",height:"100%",padding:g?"8px 0 8px 0":"0 8px 0 0",...h};return e.jsx("div",{className:d,style:x,children:s})},Gt=t=>3*t+2,Yt={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},He={lessDifficult:-1,twoOrMoreSolos:-2,increasedDamage:-2,lowerTierAdversary:1,noBruisersHordesLeadersSolos:1,moreDangerous:2},Jt=({isOpen:t,onClose:s,onAddAdversary:d,onAddAdversariesBulk:h,onAddEnvironment:g,onDeleteAdversary:x,onDeleteEnvironment:c,onDeleteCountdown:I,adversaries:i=[],environments:S=[],countdowns:k=[],savedEncounters:z=[],onSaveEncounter:q,onLoadEncounter:v,onDeleteEncounter:W})=>{const{partySize:Y,updatePartySize:L,currentEncounterName:P,updateCurrentEncounterName:N}=rt(),O=Y,y=L,[F,ee]=j.useState({lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),[$,de]=j.useState([]),[G,ie]=j.useState(P||"Encounter"),[se,ae]=j.useState("adversaries"),[oe,D]=j.useState(null),[Z,w]=j.useState(null);j.useEffect(()=>{t&&!oe&&ie(P||"Encounter")},[t,oe,P]);const m=()=>Z?G!==Z.name||JSON.stringify($)!==JSON.stringify(Z.encounterItems)||O!==Z.partySize||JSON.stringify(F)!==JSON.stringify(Z.battlePointsAdjustments):!1,b=()=>{var u;if($.length>0||(G||"").trim()!=="Encounter")return!0;if(oe&&m()){if(Z){const C=$.length,B=((u=Z.encounterItems)==null?void 0:u.length)||0;if(C!==B||(G||"").trim()!==(Z.name||""))return!0;const V=JSON.stringify(F),X=JSON.stringify(Z.battlePointsAdjustments||{});return V!==X}return!0}return!1},R=({onClick:u,children:C,variant:B="secondary",isConfirmation:V=!1})=>{const X=B==="danger"||B==="secondary"&&V,te=B==="purple";return e.jsx("button",{onClick:u,style:{background:X?"var(--danger)":te?"var(--purple)":"var(--bg-secondary)",border:te?"none":"1px solid var(--border)",color:X||te?"white":"var(--text-primary)",padding:"0.375rem 0.75rem",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s",width:"70px",fontSize:"0.875rem"},children:C})},K=we.useRef(O),le=j.useCallback(u=>!u||u.length===0?null:z.find(B=>{var _,Q;if(((_=B.encounterItems)==null?void 0:_.length)!==u.length)return!1;const V=M=>{var re;return{type:M.type,quantity:M.quantity,item:{name:M.item.baseName||((re=M.item.name)==null?void 0:re.replace(/\s+\(\d+\)$/,""))||M.item.name,type:M.item.type,tier:M.item.tier}}},X=(Q=B.encounterItems)==null?void 0:Q.map(V).sort((M,re)=>M.item.name.localeCompare(re.item.name)||M.item.type.localeCompare(re.item.type)),te=u.map(V).sort((M,re)=>M.item.name.localeCompare(re.item.name)||M.item.type.localeCompare(re.item.type));return JSON.stringify(X)===JSON.stringify(te)})||null,[z]);we.useEffect(()=>{if(t&&i.length>0&&$.length===0){const u={};i.forEach(V=>{var te;const X=V.baseName||((te=V.name)==null?void 0:te.replace(/\s+\(\d+\)$/,""))||V.name;u[X]||(u[X]={type:"adversary",item:V,quantity:0}),u[X].quantity+=1});const C=Object.values(u);de(C);const B=le(C);B&&!oe&&(D(B.id),w({name:B.name||"",encounterItems:B.encounterItems||[],partySize:B.partySize||4,battlePointsAdjustments:B.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),ie(B.name||"Encounter"),N(B.name||"Encounter"))}else t&&i.length===0&&$.length===0&&de([])},[t,le,oe,N]);const ce=we.useMemo(()=>{let u=0;$.filter(_=>_.type==="adversary"&&_.item.type==="Solo"&&_.quantity>0).reduce((_,Q)=>_+Q.quantity,0)>=2&&(u+=He.twoOrMoreSolos);const B=$.some(_=>_.type==="adversary"&&_.item.type==="Bruiser"&&_.quantity>0),V=$.some(_=>_.type==="adversary"&&_.item.type==="Horde"&&_.quantity>0),X=$.some(_=>_.type==="adversary"&&_.item.type==="Leader"&&_.quantity>0),te=$.some(_=>_.type==="adversary"&&_.item.type==="Solo"&&_.quantity>0);return!B&&!V&&!X&&!te&&(u+=He.noBruisersHordesLeadersSolos),u},[$]),p=Gt(O),f=Object.entries(F).filter(([u,C])=>C).reduce((u,[C,B])=>u+He[C],0),r=p+f+ce,o=$.reduce((u,C)=>{if(C.type==="adversary"){const B=Yt[C.item.type]||2;return C.item.type==="Minion"?u+Math.ceil(C.quantity/O)*B:u+B*C.quantity}return u},0);we.useEffect(()=>{const u=K.current;u!==O&&(de(C=>C.map(B=>{if(B.type==="adversary"&&B.item.type==="Minion"){const X=Math.ceil(B.quantity/u)*O;return{...B,quantity:X}}return B})),K.current=O)},[O]);const a=(u,C)=>{const B=$.findIndex(te=>te.item.id===u.id&&te.type===C),V=u.type==="Minion"?O:1;let X;B>=0?X=$.map((te,_)=>_===B?{...te,quantity:te.quantity+V}:te):X=[...$,{item:u,type:C,quantity:V}],de(X),n(X)},n=u=>{const C=i||[],B=[];u.forEach(Q=>{for(let M=0;M<Q.quantity;M++)Q.type==="adversary"&&B.push(Q.item)});const V={};C.forEach(Q=>{var re;const M=Q.baseName||((re=Q.name)==null?void 0:re.replace(/\s+\(\d+\)$/,""))||Q.name;V[M]||(V[M]=[]),V[M].push(Q)});const X={};B.forEach(Q=>{var re;const M=Q.baseName||((re=Q.name)==null?void 0:re.replace(/\s+\(\d+\)$/,""))||Q.name;X[M]||(X[M]=[]),X[M].push(Q)});const te=[],_=[];Object.keys(X).forEach(Q=>{var xe;const M=((xe=V[Q])==null?void 0:xe.length)||0,re=X[Q].length;if(re>M){const ne=re-M;for(let fe=0;fe<ne;fe++)te.push(X[Q][0])}else if(re<M){const ne=M-re,ye=[...V[Q]].sort((ge,Ie)=>{const Ae=ge.duplicateNumber||1;return(Ie.duplicateNumber||1)-Ae});for(let ge=0;ge<ne;ge++)_.push(ye[ge].id)}}),Object.keys(V).forEach(Q=>{X[Q]||[...V[Q]].sort((xe,ne)=>{const fe=xe.duplicateNumber||1;return(ne.duplicateNumber||1)-fe}).forEach(xe=>{_.push(xe.id)})}),_.forEach(Q=>{x(Q)}),te.length>0&&h(te)},l=(u,C)=>{const B=(()=>{const V=$.findIndex(X=>X.item.id===u&&X.type===C);if(V>=0){const X=$[V];if(X.quantity===0)return $.filter((Q,M)=>M!==V);const te=X.item.type==="Minion"?O:1,_=Math.max(0,X.quantity-te);return $.map((Q,M)=>M===V?{...Q,quantity:_}:Q)}return $})();de(B),n(B)},E=j.useCallback(()=>{if($.length===0)return null;const u=(G||"").trim()||"Encounter",C=z.find(B=>{var te,_;if(B.name!==u||((te=B.encounterItems)==null?void 0:te.length)!==$.length)return!1;const V=JSON.stringify((_=B.encounterItems)==null?void 0:_.sort()),X=JSON.stringify([...$].sort());return V===X});return(C==null?void 0:C.id)||null},[z,G,$]),A=j.useCallback(()=>{let u=(G||"").trim(),C=oe;if(C||(C=E()),$.length===0&&(!u||u==="Encounter")&&C){W(C),D(null),w(null);return}const B={name:u,encounterItems:$,partySize:O,battlePointsAdjustments:F};if(C){B.id=C;const V=q(B);D(V)}else{const V=q(B);D(V)}w({name:u,encounterItems:$,partySize:O,battlePointsAdjustments:F})},[$,G,O,F,oe,q,E,W]);j.useEffect(()=>{if(oe&&m()){const u=setTimeout(()=>{A()},2e3);return()=>clearTimeout(u)}else if(!oe&&$.length>0&&G&&G.trim()!==""){const u=setTimeout(()=>{A()},2e3);return()=>clearTimeout(u)}},[$,oe,G,F,O]);const H=()=>{b()&&(de([]),ie("Encounter"),N("Encounter"),D(null),w(null),i.forEach(u=>{x(u.id)}),S.forEach(u=>{c(u.id)}),k.forEach(u=>{I(u.id)}))},U=u=>{const C=v(u);if(C){const B=C.encounterItems||[];de(B),y(C.partySize||4),ee(C.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),ie(C.name||""),N(C.name||""),D(u),w({name:C.name||"",encounterItems:C.encounterItems||[],partySize:C.partySize||4,battlePointsAdjustments:C.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),n(B)}},T=u=>{W(u),oe===u&&(de([]),ie("Encounter"),N("Encounter"),D(null),w(null),i.forEach(C=>{x(C.id)}),S.forEach(C=>{c(C.id)}),k.forEach(C=>{I(C.id)}))};return t?e.jsx("div",{onClick:s,className:"encounter-builder-modal",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:1e3,display:"flex",alignItems:"flex-start",justifyContent:"center",padding:"12px"},children:e.jsxs("div",{onClick:u=>u.stopPropagation(),style:{backgroundColor:"var(--bg-primary)",border:"2px solid var(--border)",borderRadius:"12px",width:"100%",maxWidth:"1200px",height:"calc(100vh - 24px)",height:"calc(100dvh - 24px)",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"},children:[e.jsxs("div",{className:"encounter-top-bar",style:{flex:"0 0 auto",display:"flex",alignItems:"center",height:"39px",backgroundColor:"var(--bg-primary)"},children:[e.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center"},children:[e.jsx("button",{onClick:()=>ae("adversaries"),style:{flex:1,background:se==="adversaries"?"var(--gray-900)":"transparent",border:"none",borderBottom:"1px solid var(--border)",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:se==="adversaries"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Adversary Browser"}),e.jsx("button",{onClick:()=>ae("encounters"),style:{flex:1,background:se==="encounters"?"var(--gray-900)":"transparent",border:"none",borderBottom:"1px solid var(--border)",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:se==="encounters"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Saved Encounters"}),e.jsx("button",{onClick:()=>ae("custom"),style:{flex:1,background:se==="custom"?"var(--gray-900)":"transparent",border:"none",borderBottom:"1px solid var(--border)",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:se==="custom"?"500":"400",transition:"all 0.2s ease",position:"relative"},children:"Adversary Creator"})]}),e.jsx("div",{className:"encounter-receipt-buttons",style:{flex:"0 0 350px",display:"flex",alignItems:"flex-start",justifyContent:"center",borderLeft:"1px solid var(--border)",height:"100%",padding:"1rem 0.75rem"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:G,onChange:u=>{ie(u.target.value),N(u.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(R,{onClick:H,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:b()?1:.5,cursor:b()?"pointer":"not-allowed"},children:"New"})]})})]}),e.jsxs("div",{className:"encounter-builder-content",style:{flex:1,display:"flex",overflow:"hidden"},children:[e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",borderTop:"1px solid var(--border)"},children:e.jsx(qt,{type:"adversary",onAddItem:u=>a(u,"adversary"),encounterItems:$,pcCount:O,showContainer:!1,savedEncounters:z,onLoadEncounter:U,onDeleteEncounter:T,activeTab:se})}),e.jsxs("div",{className:"encounter-right-panel",style:{flex:"0 0 350px",borderLeft:"1px solid var(--border)",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx("div",{className:"encounter-receipt-buttons-vertical",style:{display:"none",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:G,onChange:u=>{ie(u.target.value),N(u.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(R,{onClick:H,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:b()?1:.5,cursor:b()?"pointer":"not-allowed"},children:"New"})]})}),e.jsx("div",{className:"receipt-content",style:{padding:"1rem",display:"flex",flexDirection:"column",height:"100%"},children:e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"flex-start",overflowY:"auto",marginBottom:"0.75rem"},children:[e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>y(Math.max(1,O-1)),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(Ge,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:O}),e.jsx("button",{onClick:()=>y(O+1),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(Ye,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Party Size"})}),e.jsx("div",{style:{width:"120px",textAlign:"right"}})]}),$.map(u=>{var C;return u.type!=="adversary"?null:e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>l(u.item.id,u.type),style:{background:u.quantity===0?"var(--danger)":"var(--bg-secondary)",border:u.quantity===0?"none":"1px solid var(--border)",color:u.quantity===0?"white":"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:u.quantity===0?e.jsx(qe,{size:10}):e.jsx(Ge,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:u.quantity}),e.jsx("button",{onClick:()=>a(u.item,u.type),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(Ye,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:u.item.baseName||((C=u.item.name)==null?void 0:C.replace(/\s+\(\d+\)$/,""))||u.item.name})}),e.jsx("div",{style:{width:"80px",textAlign:"right"},children:e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.8rem"},children:u.item.type})})]},`${u.item.id}-${u.type}`)}),e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Balance"})}),e.jsx("div",{style:{width:"120px",textAlign:"right",display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsx("span",{style:{color:o>r?"var(--danger)":o===r?"var(--purple)":"var(--success)",fontWeight:600},children:o>r?`+${o-r}`:r-o===0?"0":`-${r-o}`})})]})]})})]})]})]})}):null};class Xt extends we.Component{constructor(s){super(s),this.state={hasError:!1,error:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,d){console.error("ErrorBoundary caught an error:",s,d)}render(){var s;return this.state.hasError?e.jsxs("div",{className:"p-md text-red",children:[e.jsx("h3",{children:"Something went wrong:"}),e.jsx("pre",{children:(s=this.state.error)==null?void 0:s.toString()}),e.jsx("button",{className:"btn-base btn-text",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try again"})]}):this.props.children}}const Kt=()=>{const{adversaries:t,environments:s,countdowns:d,fear:h,savedEncounters:g,updateFear:x,createAdversary:c,createAdversariesBulk:I,updateAdversary:i,deleteAdversary:S,createEnvironment:k,updateEnvironment:z,deleteEnvironment:q,createCountdown:v,updateCountdown:W,deleteCountdown:Y,advanceCountdown:L,saveEncounter:P,loadEncounter:N,deleteEncounter:O}=rt(),[y,F]=j.useState(!1),[ee,$]=j.useState(!1);j.useState(!1);const[de,G]=j.useState(!1);j.useState(!0);const[ie,se]=j.useState(null),[ae,oe]=j.useState(0),[D,Z]=j.useState(0),[w,m]=j.useState(!1);j.useEffect(()=>{const n=()=>{const E=window.matchMedia("(max-width: 800px)");F(E.matches)};n();const l=window.matchMedia("(max-width: 800px)");return l.addEventListener("change",n),()=>l.removeEventListener("change",n)},[]);const b=12,R=n=>n===1?200:350,K=n=>{if(n<=0)return{visibleColumns:1,columnWidth:R(1)};const l=b*2,E=n-l;let A={visibleColumns:1,columnWidth:E};for(let U=1;U<=5;U++){const T=(U-1)*b,u=(E-T)/U;u>=R(U)&&U*u+T<=E&&(A={visibleColumns:U,columnWidth:u})}return A.visibleColumns*A.columnWidth+(A.visibleColumns-1)*b>E&&(A={visibleColumns:1,columnWidth:E}),A},{visibleColumns:le,columnWidth:ce}=K(ae);j.useEffect(()=>{const n=()=>{oe(window.innerWidth)};return n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]);const p=()=>{$(!0)},f=j.useCallback(()=>{$(!1)},[]),r=j.useCallback(n=>{Z(n.target.scrollLeft)},[]);j.useCallback(()=>{m(!0)},[]),j.useCallback(()=>{setTimeout(()=>m(!1),100)},[]);const a=(()=>{const n={};return t.forEach(l=>{var A;const E=l.baseName||((A=l.name)==null?void 0:A.replace(/\s+\(\d+\)$/,""))||l.name;n[E]||(n[E]={type:"adversary",baseName:E,instances:[]}),n[E].instances.push(l)}),s.forEach(l=>{n[l.name]||(n[l.name]={type:"environment",baseName:l.name,instances:[]}),n[l.name].instances.push(l)}),d.forEach(l=>{n[`countdown-${l.id}`]={type:"countdown",baseName:l.name,instances:[l]}}),Object.values(n)})();return a.length,e.jsxs("div",{className:"app",onClick:n=>{n.target,n.currentTarget},children:[e.jsx(At,{adversaries:t,environments:s,countdowns:d,deleteAdversary:S,deleteEnvironment:q,deleteCountdown:Y,isClearMode:de,setIsClearMode:G,sortAdversaries:()=>{},onOpenDatabase:p}),e.jsx("div",{className:"main-content",style:{position:"relative",width:"100%"},children:e.jsx("div",{className:"dashboard-scroll-container",style:{display:"flex",flexDirection:"row",overflowX:"auto",overflowY:"hidden",padding:`0 ${b}px`,scrollSnapType:"x mandatory",height:"100%",width:"100%"},onScroll:r,children:a.length===0?e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",width:"100%",padding:"2rem"},children:e.jsx("button",{onClick:p,style:{backgroundColor:"transparent",color:"var(--text-secondary)",border:"2px dashed var(--border)",borderRadius:"var(--radius-md)",padding:"1rem 2rem",fontSize:"1rem",fontWeight:"500",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:n=>{n.target.style.borderColor="var(--purple)",n.target.style.color="var(--purple)"},onMouseLeave:n=>{n.target.style.borderColor="var(--border)",n.target.style.color="var(--text-secondary)"},children:"Create Encounter"})}):a.map((n,l)=>e.jsx(_t,{className:"invisible-scrollbar",style:{width:`${ce+b}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:`${b}px`,paddingRight:"0",paddingTop:`${b}px`,paddingBottom:`${b}px`,scrollSnapAlign:"start",overflowY:"auto",overflowX:"hidden"},children:e.jsx(Ve,{type:n.type,item:{...n.instances[0],name:n.baseName,hp:0,stress:0,isDead:!1},mode:"expanded",instances:n.instances,onApplyDamage:n.type==="adversary"?(E,A,H,U)=>{const T=n.instances.find(u=>u.id===E);T&&i(E,{hp:Math.min(T.hpMax||1,(T.hp||0)+A)})}:void 0,onApplyHealing:n.type==="adversary"?(E,A,H)=>{const U=n.instances.find(T=>T.id===E);U&&i(E,{hp:Math.max(0,(U.hp||0)-A)})}:void 0,onApplyStressChange:n.type==="adversary"?(E,A)=>{var H,U;return i(E,{stress:Math.max(0,Math.min(((H=n.instances.find(T=>T.id===E))==null?void 0:H.stressMax)||6,(((U=n.instances.find(T=>T.id===E))==null?void 0:U.stress)||0)+A))})}:void 0,onUpdate:n.type==="adversary"?i:n.type==="environment"?z:W,adversaries:t})},`${n.type}-${n.baseName}`))})}),e.jsx(zt,{position:"bottom",children:e.jsx(ke,{type:"fear",value:(h==null?void 0:h.value)||0,maxValue:12,onChange:x,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0})}),e.jsx(Jt,{isOpen:ee,onClose:f,onAddAdversary:n=>{c(n),se("adversary")},onAddAdversariesBulk:n=>{I(n),se("adversary")},onAddEnvironment:n=>{k(n),se("environment")},onDeleteAdversary:S,onDeleteEnvironment:q,onDeleteCountdown:Y,adversaries:t,environments:s,countdowns:d,savedEncounters:g,onSaveEncounter:P,onLoadEncounter:N,onDeleteEncounter:O}),e.jsx(Vt,{})]})},Qt=()=>e.jsx(Xt,{children:e.jsx(Kt,{})});Oe.createRoot(document.getElementById("root")).render(e.jsx(we.StrictMode,{children:e.jsx(St,{children:e.jsx(Qt,{})})}));
