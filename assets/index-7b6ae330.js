import{r as h,a as vt,R as Ve}from"./dndkit-57209f9c.js";import{F as ar,f as ir,a as lr,b as dr,c as It}from"./fa-b4bcccb0.js";import{D as cr,A as ur,C as Vt,X as tt,M as it,P as Ye,a as pr,H as mr,L as fr,F as hr,S as ft,b as ht,T as Tt,c as Mt,B as Nt}from"./lucide-e69a925c.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const d of l)if(d.type==="childList")for(const c of d.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function i(l){const d={};return l.integrity&&(d.integrity=l.integrity),l.referrerPolicy&&(d.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?d.credentials="include":l.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function o(l){if(l.ep)return;l.ep=!0;const d=i(l);fetch(l.href,d)}})();var Kt={exports:{}},ct={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xr=h,gr=Symbol.for("react.element"),yr=Symbol.for("react.fragment"),vr=Object.prototype.hasOwnProperty,br=xr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,wr={key:!0,ref:!0,__self:!0,__source:!0};function Gt(e,a,i){var o,l={},d=null,c=null;i!==void 0&&(d=""+i),a.key!==void 0&&(d=""+a.key),a.ref!==void 0&&(c=a.ref);for(o in a)vr.call(a,o)&&!wr.hasOwnProperty(o)&&(l[o]=a[o]);if(e&&e.defaultProps)for(o in a=e.defaultProps,a)l[o]===void 0&&(l[o]=a[o]);return{$$typeof:gr,type:e,key:d,ref:c,props:l,_owner:br.current}}ct.Fragment=yr;ct.jsx=Gt;ct.jsxs=Gt;Kt.exports=ct;var t=Kt.exports,bt={},zt=vt;bt.createRoot=zt.createRoot,bt.hydrateRoot=zt.hydrateRoot;function $e(e){if(typeof localStorage>"u")return null;try{const a=localStorage.getItem(e);return a==null?null:JSON.parse(a)}catch{return null}}function Ge(e,a){if(!(typeof localStorage>"u"))try{localStorage.setItem(e,JSON.stringify(a))}catch{}}function Xe(e){const a=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return e?`${e}-${a}`:a}function Sr(e=[]){const[a,i]=h.useState(e),o=h.useRef(!0);return h.useEffect(()=>{if(o.current){o.current=!1;return}const u=$e("daggerheart-game-state")||{};Ge("daggerheart-game-state",{...u,adversaries:a})},[a]),{adversaries:a,createAdversary:u=>{var x;const f=Xe("adv"),p=u.baseName||((x=u.name)==null?void 0:x.replace(/\s+\(\d+\)$/,""))||u.name||"Unknown",r=a.filter(v=>v.baseName===p);let n=1;if(r.length>0){const v=r.map(N=>N.duplicateNumber||1);let k=1;for(;v.includes(k);)k++;n=k}const s={...u,id:f,baseName:p,duplicateNumber:n,name:`${p} (${n})`,hp:0,stress:0,isVisible:!0};i(v=>[...v,s])},createAdversariesBulk:u=>{const f=[],p={};u.forEach(r=>{var L;const n=r.baseName||((L=r.name)==null?void 0:L.replace(/\s+\(\d+\)$/,""))||r.name||"Unknown",x=a.filter(J=>J.baseName===n).length,v=p[n]||0,k=x+v+1;p[n]=v+1;const N={...r,id:Xe("adv"),baseName:n,duplicateNumber:k,name:`${n} (${k})`,hp:0,stress:0,isVisible:!0};f.push(N)}),i(r=>[...r,...f])},updateAdversary:(u,f)=>{i(p=>p.map(r=>{if(r.id===u){const n={...r,...f};if(f.baseName!==void 0){const s=f.baseName,x=n.duplicateNumber||1;n.name=x===1?s:`${s} (${x})`}return n}return r}))},deleteAdversary:u=>{i(f=>f.filter(p=>p.id!==u))}}}function jr(e=[]){const[a,i]=h.useState(e),o=h.useRef(!0);return h.useEffect(()=>{if(o.current){o.current=!1;return}const p=$e("daggerheart-game-state")||{};Ge("daggerheart-game-state",{...p,countdowns:a})},[a]),{countdowns:a,createCountdown:p=>{const r={id:Xe("countdown"),name:p.name||"Countdown",max:parseInt(p.max)||1,value:0,visible:!0,type:p.type||"standard",loop:p.loop||"none",source:p.source||"campaign"};i(n=>[...n,r])},updateCountdown:(p,r)=>{i(n=>n.map(s=>s.id===p?{...s,...r}:s))},deleteCountdown:p=>{i(r=>r.filter(n=>n.id!==p))},advanceCountdown:(p,r)=>{i(n=>n.map(s=>{if(s.id!==p)return s;let x=r;if(s.loop==="loop")x>s.max?x=(x-1)%s.max+1:x<0&&(x=s.max);else if(s.loop==="increasing"){if(x>s.max)return{...s,max:s.max+1,value:1};if(x<0)return{...s,max:Math.max(1,s.max-1),value:1};x=Math.max(0,x)}else if(s.loop==="decreasing"){if(x>s.max)return{...s,max:Math.max(1,s.max-1),value:1};if(x<0)return{...s,max:s.max+1,value:1};x=Math.min(s.max,x)}else x=Math.max(0,Math.min(x,s.max));return{...s,value:x}}))},incrementCountdown:(p,r=1)=>{i(n=>n.map(s=>{if(s.id!==p)return s;let x=s.value+r;if(s.loop==="loop")x>s.max&&(x=(x-1)%s.max+1);else if(s.loop==="increasing"){if(x>s.max)return{...s,max:s.max+1,value:1}}else if(s.loop==="decreasing"){if(x>s.max)return{...s,max:Math.max(1,s.max-1),value:1}}else x=Math.min(x,s.max);return{...s,value:x}}))},decrementCountdown:p=>{i(r=>r.map(n=>{if(n.id!==p)return n;let s=n.value-1;if(n.loop==="loop")s<0&&(s=n.max);else if(n.loop==="increasing"){if(s<0)return{...n,max:Math.max(1,n.max-1),value:n.max};s=Math.max(0,s)}else if(n.loop==="decreasing"){if(s<0)return{...n,max:n.max+1,value:1}}else s=Math.max(0,s);return{...n,value:s}}))}}}function Cr(e=[]){const[a,i]=h.useState(e),o=h.useRef(!0);return h.useEffect(()=>{if(o.current){o.current=!1;return}const m=$e("daggerheart-game-state")||{};Ge("daggerheart-game-state",{...m,environments:a})},[a]),{environments:a,createEnvironment:m=>{const u=Xe("env"),p=(a||[]).filter(s=>s.name.replace(/\s+\(\d+\)$/,"")===m.name);let r=m.name||"Unknown";if(p.length===0)r=m.name;else if(p.length===1){const s=p[0],x=s.name.replace(/\s+\(\d+\)$/,""),v=a.map(k=>k.id===s.id?{...k,name:`${x} (1)`}:k);i(v),r=`${m.name} (2)`}else{const s=p.map(v=>{const k=v.name.match(/\((\d+)\)$/);return k?parseInt(k[1]):null}).filter(v=>v!==null);let x=1;for(;s.includes(x);)x++;r=`${m.name} (${x})`}const n={...m,id:u,name:r,isVisible:!0};i(s=>[...s,n])},updateEnvironment:(m,u)=>{i(f=>f.map(p=>p.id===m?{...p,...u}:p))},deleteEnvironment:m=>{i(u=>u.filter(f=>f.id!==m))}}}function kr(e=[],a="Encounter"){const[i,o]=h.useState(e),[l,d]=h.useState(a),c=h.useRef(!0);return h.useEffect(()=>{if(c.current){c.current=!1;return}const r=$e("daggerheart-game-state")||{};Ge("daggerheart-game-state",{...r,savedEncounters:i,currentEncounterName:l})},[i,l]),{savedEncounters:i,currentEncounterName:l,saveEncounter:r=>{if(r.id)return o(n=>n.map(s=>s.id===r.id?{...s,name:r.name||s.name,encounterItems:r.encounterItems||s.encounterItems,partySize:r.partySize||s.partySize,battlePointsAdjustments:r.battlePointsAdjustments||s.battlePointsAdjustments,updatedAt:new Date().toISOString()}:s)),r.id;{const n={id:Xe("encounter"),name:r.name||"Encounter",createdAt:new Date().toISOString(),encounterItems:r.encounterItems||[],partySize:r.partySize||4,battlePointsAdjustments:r.battlePointsAdjustments||{}};return o(s=>[...s,n]),n.id}},loadEncounter:r=>i.find(n=>n.id===r),deleteEncounter:r=>{o(n=>n.filter(s=>s.id!==r))},updateCurrentEncounterName:r=>{d(r||"Encounter")}}}function Er(e={value:0,visible:!1},a=4){const[i,o]=h.useState(e),[l,d]=h.useState(a),c=h.useRef(!0);return h.useEffect(()=>{if(c.current){c.current=!1;return}const f=$e("daggerheart-game-state")||{};Ge("daggerheart-game-state",{...f,fear:i,partySize:l})},[i,l]),{fear:i,partySize:l,updateFear:f=>{o(p=>({...p,value:f}))},updatePartySize:f=>{d(Math.max(1,f))}}}function Ar(){const[e,a]=h.useState({adversaries:[],environments:[]});return h.useEffect(()=>{const d=$e("daggerheart-custom-adversaries")||[],c=$e("daggerheart-custom-environments")||[];a({adversaries:d,environments:c})},[]),h.useEffect(()=>{Ge("daggerheart-custom-adversaries",e.adversaries)},[e.adversaries]),h.useEffect(()=>{Ge("daggerheart-custom-environments",e.environments)},[e.environments]),{customContent:e,addCustomAdversary:d=>{const c={...d,id:Xe("custom-adv"),source:d.source||"Homebrew",isCustom:!0};return a(m=>({...m,adversaries:[...m.adversaries,c]})),c.id},updateCustomAdversary:(d,c)=>{a(m=>({...m,adversaries:m.adversaries.map(u=>u.id===d?{...u,...c}:u)}))},deleteCustomAdversary:d=>{a(c=>({...c,adversaries:c.adversaries.filter(m=>m.id!==d)}))}}}const Jt=h.createContext(),Ir=({children:e})=>{const[a,i]=h.useState(!1),[o,l]=h.useState(()=>$e("daggerheart-game-state")||{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],currentEncounterName:"Encounter"}),d=Er(o.fear,o.partySize),c=Sr(o.adversaries||[]),m=jr(o.countdowns||[]),u=Cr(o.environments||[]),f=kr(o.savedEncounters||[],o.currentEncounterName||"Encounter"),p=Ar();h.useEffect(()=>{i(!0)},[]);const n={gameState:{fear:d.fear,countdowns:m.countdowns,adversaries:c.adversaries,environments:u.environments,partySize:d.partySize,savedEncounters:f.savedEncounters,currentEncounterName:f.currentEncounterName},isLoaded:a,customContent:p.customContent,updateFear:d.updateFear,updatePartySize:d.updatePartySize,updateCurrentEncounterName:f.updateCurrentEncounterName,saveEncounter:f.saveEncounter,loadEncounter:f.loadEncounter,deleteEncounter:f.deleteEncounter,createCountdown:m.createCountdown,updateCountdown:m.updateCountdown,deleteCountdown:m.deleteCountdown,advanceCountdown:m.advanceCountdown,incrementCountdown:m.incrementCountdown,decrementCountdown:m.decrementCountdown,createAdversary:c.createAdversary,createAdversariesBulk:c.createAdversariesBulk,updateAdversary:c.updateAdversary,deleteAdversary:c.deleteAdversary,createEnvironment:u.createEnvironment,updateEnvironment:u.updateEnvironment,deleteEnvironment:u.deleteEnvironment,addCustomAdversary:p.addCustomAdversary,updateCustomAdversary:p.updateCustomAdversary,deleteCustomAdversary:p.deleteCustomAdversary};return t.jsx(Jt.Provider,{value:n,children:e})},ut=()=>{const e=h.useContext(Jt);if(!e)return console.warn("useGameState: Context not available yet, returning defaults"),{isLoaded:!1,fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],customContent:{adversaries:[],environments:[]},updateFear:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},addCustomAdversary:()=>{},updateCustomAdversary:()=>{},deleteCustomAdversary:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{gameState:a,customContent:i,...o}=e;if(!a)return console.warn("useGameState: gameState not available, returning defaults"),{isLoaded:e.isLoaded||!1,fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],customContent:{adversaries:[],environments:[]},updateFear:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},addCustomAdversary:()=>{},updateCustomAdversary:()=>{},deleteCustomAdversary:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{fear:l,countdowns:d,adversaries:c,environments:m,partySize:u,savedEncounters:f}=a;return{gameState:a,isLoaded:e.isLoaded,fear:l,countdowns:d,adversaries:c,environments:m,partySize:u,savedEncounters:f,customContent:i,...o,hasCountdowns:d.length>0,hasAdversaries:c.length>0,hasEnvironments:m.length>0,getCountdownById:p=>d.find(r=>r.id===p),getAdversaryById:p=>c.find(r=>r.id===p),getEnvironmentById:p=>m.find(r=>r.id===p)}},Tr=()=>t.jsx("div",{className:"pwa-install-prompt",style:{}}),xt=52,wt=({tabContent:e,children:a,containerStyle:i={},tabStyle:o={},showTab:l=!0,tabBackgroundColor:d="var(--bg-primary)",tabBorderColor:c="var(--border)",tabJustifyContent:m="center",containerBackgroundColor:u,containerBorderColor:f,containerBorderRadius:p="8px",containerBoxShadow:r,containerOverflow:n="hidden",reserveTabSpace:s=!1,style:x={},...v})=>{const k={display:"flex",flexDirection:"column",position:"relative",height:"100%",width:"100%",borderRadius:p,overflow:n};u&&(k.backgroundColor=u),f&&(k.border=`2px solid ${f}`),r&&(k.boxShadow=r);const N={position:"relative",overflow:"visible",height:"100%",width:"100%",display:"flex",flexDirection:"column",boxSizing:"border-box"},L=s?"0":`-${xt}px`,J=s&&l&&e?`${xt}px`:"0";return t.jsxs("div",{style:{...N,...x},...v,children:[l&&e&&t.jsx("div",{style:{position:"absolute",top:L,left:"7px",right:"7px",width:"calc(100% - 14px)",display:"flex",alignItems:"center",gap:"0.5rem",justifyContent:m,flexShrink:0,zIndex:0,padding:"0.5rem 0.75rem",paddingBottom:"calc(0.5rem + 4px)",minHeight:`${xt}px`,backgroundColor:d,border:`1.5px solid ${c}`,borderBottom:"none",borderRadius:"8px 8px 0 0",boxSizing:"border-box",marginBottom:"-4px",...o},children:e}),t.jsx("div",{style:{...k,...i,zIndex:1,marginTop:J},children:a})]})},Mr="modulepreload",Nr=function(e){return"/Daggerheart/"+e},Wt={},Je=function(a,i,o){if(!i||i.length===0)return a();const l=document.getElementsByTagName("link");return Promise.all(i.map(d=>{if(d=Nr(d),d in Wt)return;Wt[d]=!0;const c=d.endsWith(".css"),m=c?'[rel="stylesheet"]':"";if(!!o)for(let p=l.length-1;p>=0;p--){const r=l[p];if(r.href===d&&(!c||r.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${m}`))return;const f=document.createElement("link");if(f.rel=c?"stylesheet":Mr,c||(f.as="script",f.crossOrigin=""),f.href=d,document.head.appendChild(f),c)return new Promise((p,r)=>{f.addEventListener("load",p),f.addEventListener("error",()=>r(new Error(`Unable to preload CSS for ${d}`)))})})).then(()=>a()).catch(d=>{const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=d,window.dispatchEvent(c),!c.defaultPrevented)throw d})},Bt={Minion:{difficulty:e=>[9,12,15,18][e-1],thresholds:e=>({major:0,severe:0}),hpMax:e=>1,stressMax:e=>1,atk:e=>[-1,0,1,2][e-1],damage:e=>["2","5","8","11"][e-1],range:"Melee"},Standard:{difficulty:e=>[11,14,17,20][e-1],thresholds:e=>({major:[7,10,20,25][e-1],severe:[12,20,32,45][e-1]}),hpMax:e=>[4,5,6,7][e-1],stressMax:e=>[3,3,4,4][e-1],atk:e=>[1,2,3,4][e-1],damage:e=>["1d8+1","2d8+2","3d8+3","4d8+4"][e-1],range:"Melee"},Bruiser:{difficulty:e=>[11,14,17,20][e-1],thresholds:e=>({major:[8,14,22,38][e-1],severe:[15,28,40,70][e-1]}),hpMax:e=>[6,7,8,9][e-1],stressMax:e=>[4,4,5,5][e-1],atk:e=>[-1,0,1,2][e-1],damage:e=>["1d12+2","2d12+4","3d12+6","4d12+8"][e-1],range:"Melee"},Horde:{difficulty:e=>[10,13,16,19][e-1],thresholds:e=>({major:[7,10,20,25][e-1],severe:[12,20,32,45][e-1]}),hpMax:e=>[5,6,7,8][e-1],stressMax:e=>[3,3,4,4][e-1],atk:e=>[-1,0,1,2][e-1],damage:e=>["1d8+2","2d8+4","3d8+6","4d8+8"][e-1],range:"Melee"},Leader:{difficulty:e=>[11,14,17,20][e-1],thresholds:e=>({major:[7,13,21,35][e-1],severe:[14,26,38,65][e-1]}),hpMax:e=>[5,6,7,8][e-1],stressMax:e=>[5,5,6,6][e-1],atk:e=>[2,4,6,8][e-1],damage:e=>["1d10+2","2d10+4","3d10+6","4d10+8"][e-1],range:"Melee"},Ranged:{difficulty:e=>[10,13,16,19][e-1],thresholds:e=>({major:[4,8,18,22][e-1],severe:[7,16,30,42][e-1]}),hpMax:e=>[3,4,5,6][e-1],stressMax:e=>[3,3,4,4][e-1],atk:e=>[2,3,4,5][e-1],damage:e=>["1d8+2","2d8+4","3d8+6","4d8+8"][e-1],range:"Close"},Skulk:{difficulty:e=>[12,15,18,21][e-1],thresholds:e=>({major:[5,9,19,23][e-1],severe:[10,18,31,43][e-1]}),hpMax:e=>[4,5,6,7][e-1],stressMax:e=>[3,3,4,4][e-1],atk:e=>[2,3,4,5][e-1],damage:e=>["1d6+2","2d6+4","3d6+6","4d6+8"][e-1],range:"Melee"},Solo:{difficulty:e=>[12,15,18,21][e-1],thresholds:e=>({major:[7,13,21,35][e-1],severe:[14,26,38,65][e-1]}),hpMax:e=>[8,9,10,11][e-1],stressMax:e=>[5,5,6,6][e-1],atk:e=>[3,5,7,9][e-1],damage:e=>["1d10+3","2d10+6","3d10+9","4d10+12"][e-1],range:"Melee"},Support:{difficulty:e=>[11,14,17,20][e-1],thresholds:e=>({major:[5,9,19,23][e-1],severe:[10,18,31,43][e-1]}),hpMax:e=>[4,4,5,5][e-1],stressMax:e=>[4,4,5,5][e-1],atk:e=>[2,3,4,5][e-1],damage:e=>["1d4+2","2d4+4","3d4+6","4d4+8"][e-1],range:"Melee"},Social:{difficulty:e=>[11,14,17,20][e-1],thresholds:e=>({major:[5,9,19,23][e-1],severe:[10,18,31,43][e-1]}),hpMax:e=>[4,4,5,5][e-1],stressMax:e=>[4,4,5,5][e-1],atk:e=>[2,3,4,5][e-1],damage:e=>["1d4+2","2d4+4","3d4+6","4d4+8"][e-1],range:"Melee"}},Ue=(e,a)=>{const i=Bt[a]||Bt.Standard;return{difficulty:i.difficulty(e),thresholds:i.thresholds(e),hpMax:i.hpMax(e),stressMax:i.stressMax(e),atk:i.atk(e),damage:i.damage(e),range:i.range}};let Yt={adversaries:[]},Lt=!1;const zr=()=>({customAdversaries:JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]")}),Wr=async()=>{if(Lt)return;let e={adversaries:[]},a={adversaries:[]};try{const o=await Je(()=>import("./adversaries-9c8932de.js"),[]);e=(o==null?void 0:o.default)||o}catch(o){console.warn("Failed to load adversaries.json:",o)}try{const o=await Je(()=>import("./playtest-adversaries-4a099c10.js"),[]);a=(o==null?void 0:o.default)||o}catch(o){console.warn("Failed to load playtest-adversaries.json:",o)}const{customAdversaries:i}=zr();Yt={...e,adversaries:[...e.adversaries||[],...a.adversaries||[],...i]},Lt=!0},jt=h.forwardRef(({onSave:e,onRefresh:a,onAddItem:i,editingAdversary:o,onCancelEdit:l,isStockAdversary:d=!1,autoFocus:c=!1,allAdversaries:m=[],embedded:u=!1,hideEmbeddedButtons:f=!1},p)=>{const r=h.useRef(null),n=h.useRef(null),[s,x]=h.useState(()=>{const S=Ue(1,"Standard");return{name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:S.difficulty,thresholds:S.thresholds,hpMax:S.hpMax,stressMax:S.stressMax,atk:S.atk,weapon:"",range:S.range,damage:S.damage,experience:[],features:[]}}),[v,k]=h.useState(!1),[N,L]=h.useState(!1),[J,D]=h.useState([]),[K,$]=h.useState(!1),[R,A]=h.useState([]);h.useEffect(()=>{(async()=>{await Wr(),m.length>0?A(m):A(Yt.adversaries||[])})()},[m]),h.useEffect(()=>{c&&setTimeout(()=>{var S,g,P;o&&n.current?((S=n.current)==null||S.focus(),(g=n.current)==null||g.select()):r.current&&((P=r.current)==null||P.focus())},650)},[c,o]),h.useEffect(()=>{var S;if(o){const g=o.baseName||((S=o.name)==null?void 0:S.replace(/\s+\(\d+\)$/,""))||o.name||"";x({name:g,tier:o.tier||1,type:o.type||"Standard",description:o.description||"",motives:o.motives||"",difficulty:o.difficulty||11,thresholds:o.thresholds||{major:7,severe:12},hpMax:o.hpMax||3,stressMax:o.stressMax||1,atk:o.atk||1,weapon:o.weapon||"",range:o.range||"Melee",damage:o.damage||"",experience:o.experience||[],features:o.features||[]}),L(!1)}else{const g=Ue(1,"Standard");x({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:g.difficulty,thresholds:g.thresholds,hpMax:g.hpMax,stressMax:g.stressMax,atk:g.atk,weapon:"",range:g.range,damage:g.damage,experience:[],features:[]}),L(!1)}},[o]),h.useEffect(()=>{if(!o&&!N){const S=Ue(s.tier,s.type);x(g=>({...g,difficulty:S.difficulty,thresholds:S.thresholds,hpMax:S.hpMax,stressMax:S.stressMax,atk:S.atk,range:S.range,damage:S.damage}))}},[s.tier,s.type,o,N]);const z=S=>{if(x(g=>({...g,name:S})),S.trim().length>0){const g=R.filter(P=>{var b;return(((b=P.name)==null?void 0:b.replace(/\s+\(\d+\)$/,""))||P.name||"").toLowerCase().includes(S.toLowerCase())}).slice(0,5);D(g),$(g.length>0)}else D([]),$(!1)},y=async()=>{if(!s.name.trim()){alert("Please enter a name for the adversary");return}k(!0);try{const S=b=>(b||[]).filter(I=>I.name&&I.name.trim()!==""||I.modifier!==void 0&&I.modifier!==0),g=s.name.trim()||"Unknown",P=S(s.experience||[]),T={...s,experience:P,baseName:g,name:g,hp:o?o.hp:0,stress:o?o.stress:0,source:"Homebrew"};if(o){if(d){const{id:b,name:I,...j}=T;await e(j),alert("Custom adversary created successfully!")}else{const b={...T,name:T.baseName};await e(b,o.id),alert("Adversary updated successfully!")}l&&l()}else{await e(T),a&&await a();const b=Ue(1,"Standard");x({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:b.difficulty,thresholds:b.thresholds,hpMax:b.hpMax,stressMax:b.stressMax,atk:b.atk,weapon:"",range:b.range,damage:b.damage,experience:[],features:[]}),L(!1),alert("Custom adversary created successfully!")}}catch(S){console.error("Error saving adversary:",S),alert("Error saving adversary. Please try again.")}finally{k(!1)}};h.useImperativeHandle(p,()=>({handleSave:y,isSaving:v,canSave:s.name.trim().length>0}));const Z={...s,id:"new-adversary",hp:0,stress:0,source:"Homebrew"},F=()=>v?o?d?"Creating...":"Saving...":"Creating...":o?d?"Save As Custom":"Save":"Create";return t.jsxs(t.Fragment,{children:[!u&&t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[t.jsx("h2",{style:{color:"var(--text-primary)",fontSize:"1.5rem",fontWeight:"600",margin:0},children:o?d?"Edit Adversary (Save As Custom)":"Edit Custom Adversary":"Create Custom Adversary"}),t.jsx("button",{onClick:y,disabled:v||!s.name.trim(),style:{padding:"0.75rem 1.5rem",backgroundColor:v||!s.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"8px",cursor:v||!s.name.trim()?"not-allowed":"pointer",fontSize:"1rem",fontWeight:"600",opacity:v||!s.name.trim()?.6:1},children:F()})]}),u&&!f&&t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",marginBottom:"0.5rem",padding:"0.5rem",borderBottom:"1px solid var(--border)"},children:[t.jsx("button",{onClick:y,disabled:v||!s.name.trim(),style:{padding:"0.5rem 1rem",backgroundColor:v||!s.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"6px",cursor:v||!s.name.trim()?"not-allowed":"pointer",fontSize:"0.875rem",fontWeight:"600",opacity:v||!s.name.trim()?.6:1,marginRight:"0.5rem"},children:F()}),l&&t.jsx("button",{onClick:l,style:{padding:"0.5rem 1rem",backgroundColor:"transparent",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"6px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600"},children:"Cancel"})]}),!o&&t.jsxs("div",{style:{marginBottom:"1rem",position:"relative"},children:[t.jsx("input",{ref:r,type:"text",value:s.name,onChange:S=>{const g=S.target.value;x(P=>({...P,name:g})),z(g)},placeholder:"Adversary name",style:{width:"100%",padding:"0.75rem",border:"1px solid var(--border)",borderRadius:"8px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"1rem",outline:"none"}}),K&&J.length>0&&t.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"0 0 8px 8px",borderTop:"none",maxHeight:"200px",overflowY:"auto",zIndex:1e3,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)"},children:J.map((S,g)=>{var T;const P=S.baseName||((T=S.name)==null?void 0:T.replace(/\s+\(\d+\)$/,""))||S.name;return t.jsxs("div",{onClick:()=>{x(b=>({...b,name:P,tier:S.tier||b.tier,type:S.type||b.type,difficulty:S.difficulty||b.difficulty,thresholds:S.thresholds||b.thresholds,hpMax:S.hpMax||b.hpMax,stressMax:S.stressMax||b.stressMax,atk:S.atk||b.atk,range:S.range||b.range,damage:S.damage||b.damage})),$(!1),L(!0),r.current&&r.current.blur()},style:{padding:"0.75rem",cursor:"pointer",borderBottom:g<J.length-1?"1px solid var(--border)":"none",transition:"background-color 0.2s"},onMouseEnter:b=>{b.target.style.backgroundColor="var(--bg-secondary)"},onMouseLeave:b=>{b.target.style.backgroundColor="transparent"},onMouseDown:b=>b.preventDefault(),children:[t.jsx("div",{style:{fontWeight:"600"},children:P}),t.jsxs("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",marginTop:"2px"},children:[S.type," • Tier ",S.tier]})]},g)})})]}),t.jsx(dt,{item:Z,type:"adversary",mode:"edit",nameInputRef:o?n:void 0,autoFocusNameInput:c&&o,onUpdate:(S,g)=>{x(P=>({...P,...g}))}})]})});jt.displayName="CustomAdversaryCreator";const Br=({feature:e,featureType:a,item:i,onUpdate:o,handleFeatureDeleteClick:l,deleteConfirmations:d,getFeatureKey:c})=>{const m=()=>(i.features||[]).filter(r=>r.type===a),u=r=>r.type===a&&r.name.trim(),f=r=>{try{const s=[...(i==null?void 0:i.features)||[]],x=m(),v=x.findIndex(k=>k===e);if(r==="up"&&v>0){const k=x[v],N=x[v-1];p(s,k,N)}else if(r==="down"&&v<x.length-1&&v>=0){const k=x[v],N=x[v+1];p(s,k,N)}}catch(n){console.error(`Error in ${a.toLowerCase()} ${r} button:`,n)}},p=(r,n,s)=>{if(!n||!s)return;const x=r.findIndex(k=>k===n),v=r.findIndex(k=>k===s);x>=0&&v>=0&&(r[x]=s,r[v]=n,o&&o(i.id,{features:r}))};return t.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",alignSelf:"stretch"},children:[t.jsx("button",{onClick:()=>f("up"),disabled:m().findIndex(r=>r===e)===0,tabIndex:"-1",style:{width:"22px",height:"22px",padding:0,border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:u(e)&&m().findIndex(r=>r===e)!==0&&e.name.trim()?"white":"var(--text-secondary)",cursor:u(e)&&m().findIndex(r=>r===e)!==0&&e.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↑"}),t.jsx("button",{onClick:()=>l(e),disabled:!e.name.trim()&&!e.description.trim(),style:{width:"22px",height:"22px",padding:0,border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:d[c(e)]?"var(--danger)":"var(--gray-700)",color:!e.name.trim()&&!e.description.trim()?"var(--text-secondary)":"white",cursor:!e.name.trim()&&!e.description.trim()?"not-allowed":"pointer",opacity:!e.name.trim()&&!e.description.trim()?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"×"}),t.jsx("button",{onClick:()=>f("down"),disabled:m().findIndex(r=>r===e)===m().length-1,style:{width:"22px",height:"22px",padding:0,border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:u(e)&&m().findIndex(r=>r===e)<m().length-1&&e.name.trim()?"white":"var(--text-secondary)",cursor:u(e)&&m().findIndex(r=>r===e)<m().length-1&&e.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↓"})]})},Rt=({title:e})=>t.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[t.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),t.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:e})]}),Lr=({item:e,isEditMode:a,onUpdate:i,handleFeatureDeleteClick:o,deleteConfirmations:l,getFeatureKey:d})=>{if(!(e.features&&e.features.length>0||a))return null;const c=(p,r,n)=>t.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[t.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[t.jsx("input",{type:"text",value:p.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false","data-lpignore":"true","data-form-type":"other",name:`feature-name-${n.toLowerCase()}`,onChange:s=>{const x=[...e.features||[]],v=x.findIndex(L=>L.type===n&&L===p);v>=0?x[v]={...x[v],name:s.target.value}:x.push({type:n,name:s.target.value,description:p.description||""});const k=x.filter(L=>L.type===n),N=k[k.length-1];N&&N.name.trim()&&x.push({type:n,name:"",description:""}),i&&i(e.id,{features:x})},placeholder:`${r} name`,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),t.jsx("textarea",{value:p.description||"",onChange:s=>{const x=[...e.features||[]],v=x.findIndex(L=>L.type===n&&L===p);v>=0?x[v]={...x[v],description:s.target.value}:x.push({type:n,name:p.name||"",description:s.target.value});const k=x.filter(L=>L.type===n),N=k[k.length-1];N&&N.name.trim()&&x.push({type:n,name:"",description:""}),i&&i(e.id,{features:x})},placeholder:`${r} description`,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",minHeight:"4.5rem",resize:"vertical"}})]}),t.jsx(Br,{feature:p,featureType:n,item:e,onUpdate:i,handleFeatureDeleteClick:o,deleteConfirmations:l,getFeatureKey:d})]},p.id||`${n}-${p.name}-${p.description}-${Math.random()}`),m=(p,r)=>t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginTop:"0.75rem"},children:p.map((n,s)=>t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[t.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:t.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",fontSize:"0.9rem"},children:n.name})}),t.jsx("div",{style:{fontSize:"0.85rem",lineHeight:1.4,color:"var(--text-secondary)"},children:n.description||r})]},`${n.type}-${s}`))}),u=(p,r)=>{const n=(e.features||[]).filter(v=>v.type===p);if(!(n.length>0)&&!a)return null;const x=a&&n.length===0?[{type:p,name:"",description:""}]:n;return t.jsxs("div",{children:[t.jsx(Rt,{title:r}),t.jsx("div",{style:{display:"flex",flexDirection:"column"},children:a?x.map(v=>c(v,r.slice(0,-1),p)):m(x,`Describe the ${r.toLowerCase()}`)})]})},f=()=>e.atk!==void 0&&e.weapon||a?t.jsxs("div",{children:[t.jsx(Rt,{title:"Standard Attack"}),t.jsx("div",{style:{display:"flex",flexDirection:"column"},children:a?t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",marginTop:"0.75rem",marginBottom:"0.75rem"},children:t.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[t.jsx("input",{type:"text",value:e.weapon||"",onChange:p=>i&&i(e.id,{weapon:p.target.value}),placeholder:"Standard attack name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}}),t.jsxs("select",{value:e.range||"",onChange:p=>i&&i(e.id,{range:p.target.value}),style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",appearance:"none",backgroundImage:`url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",backgroundSize:"1rem",paddingRight:"2rem"},children:[t.jsx("option",{value:""}),t.jsx("option",{value:"Melee",children:"Melee"}),t.jsx("option",{value:"Very Close",children:"Very Close"}),t.jsx("option",{value:"Close",children:"Close"}),t.jsx("option",{value:"Far",children:"Far"}),t.jsx("option",{value:"Very Far",children:"Very Far"})]}),t.jsx("input",{type:"text",value:e.damage||"",onChange:p=>i&&i(e.id,{damage:p.target.value}),placeholder:"Damage (e.g., 1d6+2)",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}})]})}):e.atk!==void 0&&e.weapon&&t.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[t.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:e.weapon}),t.jsxs("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:["Make an attack against a target within ",e.range||"Melee"," range. On a success, deal ",e.damage||"damage varies","."]})]})})]}):null;return t.jsxs("div",{style:{padding:"0 8px 8px 8px"},children:[f(),u("Action","Actions"),u("Passive","Passives"),u("Reaction","Reactions")]})},Rr=({item:e,isEditMode:a,onUpdate:i})=>a||e.atk!==void 0&&e.weapon?t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[t.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),t.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Standard Attack"})]}),t.jsx("div",{style:{display:"flex",flexDirection:"column"},children:a?t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",marginTop:"0.75rem",marginBottom:"0.75rem"},children:t.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[t.jsx("input",{type:"text",value:e.weapon||"",onChange:l=>i&&i(e.id,{weapon:l.target.value}),placeholder:"Standard attack name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}}),t.jsxs("select",{value:e.range||"",onChange:l=>i&&i(e.id,{range:l.target.value}),style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",appearance:"none",backgroundImage:`url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",backgroundSize:"1rem",paddingRight:"2rem"},children:[t.jsx("option",{value:""}),t.jsx("option",{value:"Melee",children:"Melee"}),t.jsx("option",{value:"Very Close",children:"Very Close"}),t.jsx("option",{value:"Close",children:"Close"}),t.jsx("option",{value:"Far",children:"Far"}),t.jsx("option",{value:"Very Far",children:"Very Far"})]}),t.jsx("input",{type:"text",value:e.damage||"",onChange:l=>i&&i(e.id,{damage:l.target.value}),placeholder:"Damage (e.g., 1d6+2)",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}})]})}):t.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[t.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:e.weapon}),t.jsxs("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:["Make an attack against a target within ",e.range||"Melee"," range. On a success, deal"," ",e.damage||"damage varies","."]})]})})]}):null,Ft={fear:{icon:ir,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"0.125rem",maxWidth:"none"},pipStyle:{fontSize:"var(--text-lg)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0,imageRendering:"crisp-edges"},filledColor:"var(--purple)",emptyColor:"var(--gray-dark)",tooltipTitle:"Click anywhere in header to adjust fear:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease fear by 1"},{text:"Right of boundary:",description:"Click to increase fear by 1"}]},hp:{icon:lr,maxValue:20,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stress:{icon:dr,maxValue:12,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},countdown:{icon:It,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust countdown:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease countdown by 1"},{text:"Right of boundary:",description:"Click to increase countdown by 1"}]},hpDots:{maxValue:20,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--red)",borderColor:"var(--red)",boxShadow:"0 0 4px rgba(239, 68, 68, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stressDots:{maxValue:12,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--purple)",borderColor:"var(--purple)",boxShadow:"0 0 4px rgba(139, 92, 246, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},adversaryHP:{icon:cr,maxValue:20,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust HP:",tooltipInstructions:[{text:"Filled pip:",description:"Click to heal (reduce damage)"},{text:"Empty pip:",description:"Click to take damage"}]},adversaryStress:{icon:ur,maxValue:12,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust stress:",tooltipInstructions:[{text:"Filled pip:",description:"Click to reduce stress"},{text:"Empty pip:",description:"Click to increase stress"}]},countdownDistributed:{icon:It,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Countdown progress:",tooltipInstructions:[{text:"Progress:",description:"Current countdown value"}]}},lt=({type:e="fear",value:a=0,maxValue:i,onChange:o,size:l="lg",showTooltip:d=!0,containerStyle:c={},pipStyle:m={},countdownType:u=null,distributedGroups:f=null,onPipClick:p=null,enableBoundaryClick:r=!1,clickContainerWidth:n="auto",centerPips:s=!0})=>{const[x,v]=h.useState(!1),k=Ft[e]||Ft.fear,N=i||k.maxValue,L=Math.max(0,Math.min(N,a));let J=k.filledColor;e==="countdown"&&u&&(["progress","dynamic-progress","simple-hope"].includes(u)?J="var(--gold)":["consequence","dynamic-consequence","simple-fear"].includes(u)?J="var(--purple)":["long-term","standard"].includes(u)&&(J="var(--text-secondary)"));const D=(z,y)=>{if(p)p(z,y);else if(o){const Z=z+1;o(Z)}},K=z=>{if(!r||!o||p)return;z.currentTarget.getBoundingClientRect();const y=z.currentTarget.querySelector(".pip-container");if(!y)return;const Z=y.getBoundingClientRect(),F=z.clientX-Z.left;if(F<0){L>0&&o(L-1);return}if(F>Z.width){L<N&&o(L+1);return}const S=Z.width,g=S*.05,P=S-2*g,T=F-g,b=L/N,I=P*b;T<I?L>0&&o(L-1):L<N&&o(L+1)},R=(()=>{if(!f||e!=="countdownDistributed")return[{start:0,end:N,groupIndex:0}];let z=0;return f.map((y,Z)=>{const F={start:z,end:z+y,groupIndex:Z};return z+=y,F})})(),A=()=>t.jsxs(t.Fragment,{children:[R.map(z=>t.jsx(Ve.Fragment,{children:[...Array(z.end-z.start)].map((y,Z)=>{const F=z.start+Z,S=F<L;if(k.isDots)return t.jsx("div",{style:{...k.pipStyle,...S?k.filledStyle:k.emptyStyle,...m,cursor:o||p?"pointer":"default"},onClick:r?void 0:()=>D(F,S),title:`${F+1} of ${N}`},F);{const g=k.icon,P=g&&typeof g=="object"&&g.iconName,T=S?J:k.emptyColor;return t.jsx("span",{className:`fear-pip ${S?"filled":"empty"}`,style:{...k.pipStyle,color:T,cursor:o||p?"pointer":"default",...m},onClick:r?void 0:()=>D(F,S),title:`${F+1} of ${N}`,children:P?t.jsx(ar,{icon:g,size:l}):t.jsx(g,{size:l==="lg"?18:16})},F)}})},z.groupIndex)),d&&t.jsx("div",{style:{position:"relative",cursor:"help",pointerEvents:"none"},children:t.jsxs("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:x?"translateX(-50%) translateY(-5px)":"translateX(-50%)",background:"rgba(15, 23, 42, 0.95)",border:"1px solid var(--gray)",borderRadius:"var(--radius-md)",padding:"var(--space-md)",minWidth:"250px",zIndex:1e3,opacity:x?1:0,visibility:x?"visible":"hidden",transition:"all 0.2s ease",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.5)"},children:[t.jsx("div",{style:{fontWeight:600,color:"var(--gray-200)",marginBottom:"0.75rem",fontSize:"var(--text-sm)"},children:k.tooltipTitle}),k.tooltipInstructions.map((z,y)=>t.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.8rem",color:"var(--gray-300)",lineHeight:1.4},children:[t.jsx("strong",{style:{color:"var(--gray-200)"},children:z.text})," ",z.description]},y))]})})]});return t.jsx("div",{style:{width:n,height:"100%",cursor:o||p?"pointer":"default",touchAction:"manipulation",userSelect:"none",display:s?"flex":"block",alignItems:s?"center":"stretch",justifyContent:s?"center":"flex-start",...c},onClick:z=>{z.stopPropagation(),z.preventDefault(),r&&K(z)},onMouseEnter:()=>v(d),onMouseLeave:()=>v(!1),children:t.jsx("div",{className:"pip-container",style:{...k.containerStyle,width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},children:A()})})},Dt=({value:e})=>t.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"44px",height:"32px",zIndex:3},children:[t.jsx("svg",{width:"40",height:"32",viewBox:"0 0 40 32",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",style:{position:"absolute",zIndex:1},children:t.jsx("path",{d:"M2 2h28l6 14-6 14H2l6-14-6-14z"})}),t.jsx("span",{style:{position:"absolute",fontSize:"0.8rem",fontWeight:500,color:"var(--text-primary)",textAlign:"center",zIndex:2,left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:e})]}),Fr=({item:e,instances:a=[],isEditMode:i,type:o,onUpdate:l,onApplyDamage:d,onApplyHealing:c,onApplyStressChange:m})=>{if(!(a&&a.length>0||e.type!=="Minion"&&(e.thresholds||i)))return null;const f=r=>{const n=(r.hp||0)>=(r.hpMax||1);return t.jsx("div",{"data-instance-id":r.id,style:{marginBottom:"0.5rem"},children:t.jsxs("div",{style:{backgroundColor:n?"var(--gray-900)":"var(--bg-primary)",borderRadius:"6px",padding:"0.25rem 0.5rem",border:"1px solid",borderColor:n?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",display:"flex",justifyContent:"flex-start",alignItems:"center",gap:"0.5rem",opacity:n?.7:1,position:"relative",transition:"all 0.2s ease",minHeight:"40px"},children:[n&&t.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                          45deg,
                          transparent 0px,
                          transparent 8px,
                          var(--gray-600) 9px,
                          var(--gray-600) 9px
                        )`,pointerEvents:"none",zIndex:1,borderRadius:"4px"}}),t.jsx("div",{style:{backgroundColor:n?"var(--gray-900)":"var(--bg-card)",border:"1px solid",borderColor:n?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",borderRadius:"50%",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",flexShrink:0,opacity:n?.5:1},children:t.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:n?"var(--gray-400)":"var(--text-primary)"},children:r.duplicateNumber||1})}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.125rem"},children:[t.jsx("div",{style:{opacity:n?.3:1},children:t.jsx(lt,{type:"adversaryHP",value:r.hp||0,maxValue:r.hpMax||1,onPipClick:(s,x)=>{if(d&&o==="adversary"){const v=r.hp||0,k=r.hpMax||1;x?c==null||c(r.id,1,v):v<k&&d(r.id,1,v,k)}},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})}),r.stressMax>0&&t.jsx("div",{style:{opacity:n?.3:1},children:t.jsx(lt,{type:"adversaryStress",value:r.stress||0,maxValue:r.stressMax,onPipClick:(s,x)=>{m&&o==="adversary"&&m(r.id,x?-1:1)},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})})]})]})},r.id)},p=()=>{var r,n,s,x;return e.type==="Minion"||!e.thresholds&&!i?null:t.jsx("div",{style:{display:"flex",justifyContent:"center",paddingTop:"1px",marginTop:"0.5rem",marginBottom:"0.5rem"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",position:"relative"},children:[t.jsx("svg",{width:"300",height:"36",viewBox:"0 0 300 36",style:{position:"absolute",zIndex:1},children:t.jsx("rect",{x:"20",y:"6",width:"260",height:"24",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4"})}),t.jsx("div",{style:{position:"relative",zIndex:2,display:"flex",alignItems:"center",gap:"0.5rem"},children:i?t.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",fontSize:"0.8rem"},children:[t.jsx(Ht,{label:"Minor",value:(r=e.thresholds)==null?void 0:r.major,onChange:v=>Ot("major",v,l,e)}),t.jsx(Ht,{label:"Major",value:(n=e.thresholds)==null?void 0:n.severe,onChange:v=>Ot("severe",v,l,e)})]}):t.jsxs(t.Fragment,{children:[t.jsx(nt,{text:"Minor"}),t.jsx(Dt,{value:((s=e.thresholds)==null?void 0:s.major)||7}),t.jsx(nt,{text:"Major"}),t.jsx(Dt,{value:((x=e.thresholds)==null?void 0:x.severe)||14}),t.jsx(nt,{text:"Severe"})]})})]})})};return t.jsxs("div",{style:{padding:"0 8px"},children:[t.jsx(Dr,{title:"Status"}),i?t.jsx(Pr,{item:e,onUpdate:l}):a.map(r=>f(r)),p()]})},Dr=({title:e})=>t.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"0.25rem"},children:[t.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),t.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:e})]}),Pr=({item:e,onUpdate:a})=>t.jsx("div",{style:{marginBottom:"0.5rem"},children:t.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border)"},children:t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[t.jsx(Pt,{label:"HP",pipType:"adversaryHP",value:e.hpMax||"",onChange:i=>a&&a(e.id,{hpMax:i})}),t.jsx(Pt,{label:"Stress",pipType:"adversaryStress",value:e.stressMax||"",onChange:i=>a&&a(e.id,{stressMax:i})})]})})}),Pt=({label:e,pipType:a,value:i,onChange:o})=>t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("input",{type:"number",value:i,onChange:l=>{const d=parseInt(l.target.value)||1;o(d)},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),t.jsx(lt,{type:a,value:0,maxValue:i||1,showTooltip:!1}),t.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:e})]}),nt=({text:e})=>t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:e}),Ht=({label:e,value:a,onChange:i})=>t.jsxs(t.Fragment,{children:[t.jsx(nt,{text:e}),t.jsx("input",{type:"number",min:"1",max:"99",value:a||"",onChange:o=>{const l=o.target.value;(l===""||parseInt(l)>=1&&parseInt(l)<=99)&&i(l===""?null:parseInt(l))},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}})]}),Ot=(e,a,i,o)=>{i&&i(o.id,{thresholds:{...o.thresholds,[e]:a}})},Hr=({item:e,isEditMode:a,mode:i,onUpdate:o})=>a||i==="expanded"&&e.description&&e.description.trim()?t.jsxs("div",{style:{padding:"0 8px",textAlign:"center"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[t.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),t.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Description"})]}),a?t.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-primary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"none",overflow:"hidden",fontFamily:"inherit",marginTop:"0.75rem",marginBottom:"0.75rem"},value:e.description,onChange:d=>{d.target.style.height="auto",d.target.style.height=d.target.scrollHeight+"px",o&&o(e.id,{description:d.target.value})},placeholder:"Description..."}):t.jsx("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,whiteSpace:"pre-wrap",padding:"0.5rem 0"},children:e.description})]}):null,Or=({type:e,tier:a,isEditMode:i,onUpdate:o,itemId:l})=>{const c=(r=>{if(!r)return 0;const s=document.createElement("canvas").getContext("2d");return s.font="600 11px system-ui, -apple-system, sans-serif",s.measureText(r.toUpperCase()).width})(e),m=4,u=18,f=Math.max(50,c+m+u),p=f+15;return i?t.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",gap:"8px",height:"32px"},children:[t.jsxs("select",{value:e||"",onChange:r=>{o&&o(l,{type:r.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",outline:"none",borderRadius:"4px",padding:"4px 8px",width:"95px",height:"24px"},children:[t.jsx("option",{value:"Standard",children:"Standard"}),t.jsx("option",{value:"Solo",children:"Solo"}),t.jsx("option",{value:"Bruiser",children:"Bruiser"}),t.jsx("option",{value:"Horde",children:"Horde"}),t.jsx("option",{value:"Minion",children:"Minion"}),t.jsx("option",{value:"Ranged",children:"Ranged"}),t.jsx("option",{value:"Leader",children:"Leader"}),t.jsx("option",{value:"Skulk",children:"Skulk"}),t.jsx("option",{value:"Social",children:"Social"}),t.jsx("option",{value:"Support",children:"Support"})]}),t.jsxs("div",{style:{position:"relative",width:"24px",height:"24px"},children:[t.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",width:"20px",height:"20px",backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",borderRadius:"2px"}}),t.jsx("input",{type:"text",value:a||"",onChange:r=>{const n=r.target.value.replace(/[^1-4]/g,"");n.length<=1&&o&&o(l,{tier:n===""?"":parseInt(n)})},onKeyDown:r=>{if(r.key==="ArrowUp"){r.preventDefault();const n=parseInt(a)||1;o&&o(l,{tier:Math.min(n+1,4)})}else if(r.key==="ArrowDown"){r.preventDefault();const n=parseInt(a)||1;o&&o(l,{tier:Math.max(n-1,1)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"transparent",border:"none",color:"var(--text-primary)",fontSize:"0.8rem",fontWeight:600,width:"24px",height:"24px",textAlign:"center",outline:"none",zIndex:1},maxLength:"1"})]})]}):t.jsxs("div",{style:{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"center",height:"32px",width:`${p}px`},children:[t.jsxs("svg",{width:p,height:"32",viewBox:`0 0 ${p} 32`,style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1},children:[t.jsx("rect",{x:"1",y:"6",width:f-1,height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4",ry:"4"}),t.jsx("rect",{x:f-10,y:"6",width:"20",height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"2",ry:"2",transform:`rotate(45 ${f-1} 16)`})]}),t.jsx("span",{style:{position:"absolute",top:"50%",left:"4px",transform:"translateY(-50%)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",color:"var(--text-primary)",zIndex:2,pointerEvents:"none"},children:e}),t.jsx("span",{style:{position:"absolute",top:"50%",left:`${f-.5}px`,transform:"translate(-50%, -50%)",fontSize:"0.8rem",fontWeight:600,color:"white",zIndex:2,pointerEvents:"none",textAlign:"center",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",width:"20px",height:"20px"},children:a})]})},$r=({item:e,isEditMode:a,onUpdate:i,deleteConfirmations:o,setDeleteConfirmations:l})=>{const d=(p,r)=>`experience-${r}-${typeof p=="string"?p:p.name||"blank"}`,c=p=>Array.isArray(p)?p.filter(r=>{if(typeof r=="string")return r.trim().length>0;const n=r.name||"",s=r.modifier||0;return n.trim().length>0||s>0}):[],m=(p,r)=>{const n=d(p,r);if(o[n]){const s=[...e.experience||[]];s.splice(r,1);const x=c(s);i&&i(e.id,{experience:x}),l(v=>{const k={...v};return delete k[n],k})}else l(s=>({...s,[n]:!0})),setTimeout(()=>{l(s=>{const x={...s};return delete x[n],x})},3e3)},u=()=>{const p=e.experience||[],r=p.length===0?[{name:"",modifier:0}]:p;return t.jsx("div",{style:{display:"flex",flexDirection:"column",marginTop:"-0.25rem"},children:r.map((n,s)=>{var x,v,k,N,L,J,D,K,$,R,A,z,y,Z,F,S,g,P,T,b,I,j,E,X,W,H,ne,_,G,ce,de,ze,ge,Ce,Be;return t.jsxs("div",{style:{position:"relative",marginBottom:"0.5rem"},children:[t.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:t.jsx("input",{type:"text",value:typeof n=="object"&&n.modifier>0?`+${n.modifier}`:"",onChange:re=>{const fe=[...e.experience||[]],ue=re.target.value.replace(/[^0-9+-]/g,""),ke=ue===""||ue==="+"?0:parseInt(ue)||0,Ee=Math.max(0,ke);fe[s]={name:typeof n=="string"?n:n.name||"",modifier:Ee};const Ie=c(fe);i&&i(e.id,{experience:Ie})},onKeyDown:re=>{if(re.key==="ArrowUp"||re.key==="ArrowDown"){re.preventDefault();const fe=[...e.experience||[]],ue=typeof n=="object"&&n.modifier||0,ke=re.key==="ArrowUp"?1:-1;fe[s]={name:typeof n=="string"?n:n.name||"",modifier:Math.max(0,ue+ke)};const Ee=c(fe);i&&i(e.id,{experience:Ee})}},style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)",textAlign:"center",outline:"none"}})}),t.jsxs("div",{style:{marginLeft:"32px",display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("input",{type:"text",value:typeof n=="string"?n:n.name||"",onChange:re=>{var Ie;const fe=[...e.experience||[]],ue=typeof n=="object"&&n.modifier||0;fe[s]={name:re.target.value,modifier:ue};let ke=c(fe);const Ee=ke[ke.length-1];Ee&&(typeof Ee=="string"?Ee.trim():(Ie=Ee.name)!=null&&Ie.trim())&&(ke=[...ke,{name:"",modifier:0}]),i&&i(e.id,{experience:ke})},placeholder:"Experience name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),t.jsxs("div",{style:{display:"flex",gap:"0.125rem"},children:[t.jsx("button",{onClick:()=>{var Ee,Ie;const re=[...e.experience||[]],fe=typeof n=="string"?n.trim():(Ee=n.name)==null?void 0:Ee.trim(),ue=re[s-1],ke=typeof ue=="string"?ue==null?void 0:ue.trim():(Ie=ue==null?void 0:ue.name)==null?void 0:Ie.trim();if(s>0&&s<re.length&&fe&&ke){re[s]=ue,re[s-1]=n;const Fe=c(re);i&&i(e.id,{experience:Fe})}},disabled:s===0||!(typeof n=="string"?n.trim():(x=n.name)!=null&&x.trim())||!(typeof r[s-1]=="string"?r[s-1].trim():(k=(v=r[s-1])==null?void 0:v.name)!=null&&k.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:s===0||!(typeof n=="string"?n.trim():(N=n.name)!=null&&N.trim())||!(typeof r[s-1]=="string"?r[s-1].trim():(J=(L=r[s-1])==null?void 0:L.name)!=null&&J.trim())?"var(--gray-800)":"var(--gray-700)",color:s===0||!(typeof n=="string"?n.trim():(D=n.name)!=null&&D.trim())||!(typeof r[s-1]=="string"?r[s-1].trim():($=(K=r[s-1])==null?void 0:K.name)!=null&&$.trim())?"var(--text-secondary)":"white",cursor:s===0||!(typeof n=="string"?n.trim():(R=n.name)!=null&&R.trim())||!(typeof r[s-1]=="string"?r[s-1].trim():(z=(A=r[s-1])==null?void 0:A.name)!=null&&z.trim())?"not-allowed":"pointer",opacity:s===0||!(typeof n=="string"?n.trim():(y=n.name)!=null&&y.trim())||!(typeof r[s-1]=="string"?r[s-1].trim():(F=(Z=r[s-1])==null?void 0:Z.name)!=null&&F.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move up",children:"↑"}),t.jsx("button",{onClick:()=>{var Ee,Ie;const re=[...e.experience||[]],fe=typeof n=="string"?n.trim():(Ee=n.name)==null?void 0:Ee.trim(),ue=re[s+1],ke=typeof ue=="string"?ue==null?void 0:ue.trim():(Ie=ue==null?void 0:ue.name)==null?void 0:Ie.trim();if(s<re.length-1&&s>=0&&fe&&ke){re[s]=ue,re[s+1]=n;const Fe=c(re);i&&i(e.id,{experience:Fe})}},disabled:s===r.length-1||!(typeof n=="string"?n.trim():(S=n.name)!=null&&S.trim())||!(typeof r[s+1]=="string"?r[s+1].trim():(P=(g=r[s+1])==null?void 0:g.name)!=null&&P.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:s===r.length-1||!(typeof n=="string"?n.trim():(T=n.name)!=null&&T.trim())||!(typeof r[s+1]=="string"?r[s+1].trim():(I=(b=r[s+1])==null?void 0:b.name)!=null&&I.trim())?"var(--gray-800)":"var(--gray-700)",color:s===r.length-1||!(typeof n=="string"?n.trim():(j=n.name)!=null&&j.trim())||!(typeof r[s+1]=="string"?r[s+1].trim():(X=(E=r[s+1])==null?void 0:E.name)!=null&&X.trim())?"var(--text-secondary)":"white",cursor:s===r.length-1||!(typeof n=="string"?n.trim():(W=n.name)!=null&&W.trim())||!(typeof r[s+1]=="string"?r[s+1].trim():(ne=(H=r[s+1])==null?void 0:H.name)!=null&&ne.trim())?"not-allowed":"pointer",opacity:s===r.length-1||!(typeof n=="string"?n.trim():(_=n.name)!=null&&_.trim())||!(typeof r[s+1]=="string"?r[s+1].trim():(ce=(G=r[s+1])==null?void 0:G.name)!=null&&ce.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move down",children:"↓"}),t.jsx("button",{onClick:()=>m(n,s),disabled:!(typeof n=="string"?n.trim():(de=n.name)!=null&&de.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:o[d(n,s)]?"var(--danger)":(typeof n=="string"?n.trim():(ze=n.name)!=null&&ze.trim())?"var(--gray-700)":"var(--gray-800)",color:(typeof n=="string"?n.trim():(ge=n.name)!=null&&ge.trim())?"white":"var(--text-secondary)",cursor:(typeof n=="string"?n.trim():(Ce=n.name)!=null&&Ce.trim())?"pointer":"not-allowed",opacity:(typeof n=="string"?n.trim():(Be=n.name)!=null&&Be.trim())?1:.5,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:o[d(n,s)]?"Click again to confirm delete":"Delete experience",children:"×"})]})]})]},s)})})},f=()=>!e.experience||e.experience.length===0?null:e.experience.map((p,r)=>{if(typeof p=="string"){const n=p.match(/^(.+?)\s*([+-]?\d+)$/);if(n){const[,s,x]=n;return t.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[t.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:t.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:t.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:x})})}),t.jsx("span",{style:{marginLeft:"32px"},children:s})]},r)}return t.jsx("div",{style:{marginBottom:"0.25rem"},children:p},r)}return t.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[t.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:t.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:t.jsxs("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:[p.modifier>=0?"+":"",p.modifier]})})}),t.jsx("span",{style:{marginLeft:"32px"},children:p.name})]},r)});return t.jsx("div",{style:{paddingTop:"0"},children:a?u():t.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:f()})})},gt={background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease"},$t={background:"var(--purple)",border:"1px solid var(--purple)",color:"white",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},qr=({showCustomCreator:e,onSaveCustomAdversary:a,item:i,onCancelEdit:o,onRemoveInstance:l,onAddInstance:d,instances:c,onEdit:m})=>e?t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:u=>{u.stopPropagation(),a&&(a(i,i.id),o&&o())},style:$t,onMouseEnter:u=>{u.currentTarget.style.opacity="0.9"},onMouseLeave:u=>{u.currentTarget.style.opacity="1"},title:"Save",children:[t.jsx(Vt,{size:16}),t.jsx("span",{children:"Save"})]}),o&&t.jsxs("button",{onClick:u=>{u.stopPropagation(),o()},style:{...$t,background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)"},onMouseEnter:u=>{u.currentTarget.style.backgroundColor="var(--bg-hover)",u.currentTarget.style.borderColor="var(--purple)"},onMouseLeave:u=>{u.currentTarget.style.backgroundColor="var(--bg-secondary)",u.currentTarget.style.borderColor="var(--border)"},title:"Cancel",children:[t.jsx(tt,{size:16}),t.jsx("span",{children:"Cancel"})]})]}):t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:u=>{u.stopPropagation(),l&&l(i.id)},style:gt,onMouseEnter:u=>{u.currentTarget.style.backgroundColor="var(--bg-hover)",u.currentTarget.style.borderColor="var(--purple)"},onMouseLeave:u=>{u.currentTarget.style.backgroundColor="var(--bg-secondary)",u.currentTarget.style.borderColor="var(--border)"},title:"Remove one",children:t.jsx(it,{size:16})}),t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"1rem",fontWeight:"500",minWidth:"24px",textAlign:"center"},children:c.length}),t.jsx("button",{onClick:u=>{u.stopPropagation(),d&&d(i)},style:gt,onMouseEnter:u=>{u.currentTarget.style.backgroundColor="var(--purple)",u.currentTarget.style.borderColor="var(--purple)",u.currentTarget.style.color="white"},onMouseLeave:u=>{u.currentTarget.style.backgroundColor="var(--bg-secondary)",u.currentTarget.style.borderColor="var(--border)",u.currentTarget.style.color="var(--text-primary)"},title:"Add another",children:t.jsx(Ye,{size:16})}),m&&t.jsx("button",{onClick:u=>{u.stopPropagation(),m(i.id)},style:{...gt,marginLeft:"0.25rem"},onMouseEnter:u=>{u.currentTarget.style.backgroundColor="var(--purple)",u.currentTarget.style.borderColor="var(--purple)",u.currentTarget.style.color="white"},onMouseLeave:u=>{u.currentTarget.style.backgroundColor="var(--bg-secondary)",u.currentTarget.style.borderColor="var(--border)",u.currentTarget.style.color="var(--text-primary)"},title:"Edit",children:t.jsx(pr,{size:16})})]}),_r=e=>{const a=h.useRef(null),i=h.useRef(e.length),o=h.useRef(null),l=h.useRef(null),d=h.useRef(null);return h.useEffect(()=>{const c=a.current;if(!c)return;const m=()=>{o.current=c.scrollHeight,l.current=c.scrollTop};c.addEventListener("scroll",m,{passive:!0});const u=setInterval(m,100);return()=>{c.removeEventListener("scroll",m),clearInterval(u),d.current&&(cancelAnimationFrame(d.current),d.current=null)}},[]),h.useEffect(()=>()=>{const c=a.current;c&&(o.current=c.scrollHeight,l.current=c.scrollTop)},[e.length,e]),h.useLayoutEffect(()=>{const c=e.length,m=i.current,u=a.current;if(!u){i.current=c;return}if(c!==m){const f=o.current,p=l.current;if(!f||p===null){i.current=c;return}const r=u.scrollHeight,n=u.clientHeight;if(c>m){const s=r-n,x=u.scrollTop,v=s-x;if(Math.abs(v)>.5){d.current&&(cancelAnimationFrame(d.current),d.current=null);const k=400,N=performance.now(),L=J=>{const D=J-N,K=Math.min(D/k,1),$=1-K,R=1-$*$*$,A=x+v*R;u.scrollTop=A,K<1?d.current=requestAnimationFrame(L):(u.scrollTop=s,d.current=null)};d.current=requestAnimationFrame(L)}}}i.current=c},[e.length,e]),{scrollableContentRef:a}},Re={transitions:{hoverIn:"all 0.1s ease",hoverOut:"all 0.3s ease"},card:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"8px",cursor:"pointer",transition:"all 0.1s ease",position:"relative",border:"none"},cardHover:{backgroundColor:"var(--bg-card-hover)"},cardDead:{opacity:.6,backgroundColor:"var(--gray-800)",borderColor:"var(--border)"},cardAtMax:{backgroundColor:"var(--success)",borderColor:"var(--success)"},rowMain:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},rowTitle:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",margin:0},rowMeta:{display:"flex",gap:"8px",alignItems:"center"},badge:{padding:"2px 6px",borderRadius:"3px",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},typeBadge:{backgroundColor:"var(--purple)",color:"var(--text-primary)"},tierBadge:{backgroundColor:"var(--info)",color:"var(--text-primary)"}},Vr=({item:e,type:a,mode:i="expanded",onClick:o,onApplyDamage:l,onApplyHealing:d,onApplyStressChange:c,onUpdate:m,adversaries:u=[],isSelected:f=!1,instances:p=[],isEmbedded:r=!1,onAddInstance:n=null,onRemoveInstance:s=null,onEdit:x=null,showCustomCreator:v=!1,onSaveCustomAdversary:k=null,onCancelEdit:N=null,isStockAdversary:L=!1})=>{const{scrollableContentRef:J}=_r(p),D=h.useRef(null),K=h.useRef(null),[$,R]=h.useState({});h.useEffect(()=>{if(v&&D.current){const b=setTimeout(()=>{var I,j;(I=D.current)==null||I.focus(),(j=D.current)==null||j.select()},650);return()=>clearTimeout(b)}},[v]);const A=b=>{const j=(e.features||[]).filter(E=>E.type===b.type).findIndex(E=>E===b);return`${b.type}-${j}-${b.name||"blank"}`},z=b=>{const I=A(b);if($[I]){const j=e.features.filter(E=>E!==b);m&&m(e.id,{features:j}),R(E=>{const X={...E};return delete X[I],X})}else R(j=>({...j,[I]:!0})),setTimeout(()=>{R(j=>{const E={...j};return delete E[I],E})},3e3)},y=(b=!1)=>{let I={...Re.card};if(f?I.transition="none":I.transition=Re.transitions.hoverOut,b){const{marginTop:j,...E}=I;I=E}return f&&(I={...I,...Re.cardHover}),a==="adversary"&&(e.hp||0)>=(e.hpMax||1)&&(I={...I,...Re.cardDead}),I},Z=()=>{if(r)return"";let b="border rounded-lg";return f&&(b+=" border-hover"),b},F=()=>{var b;if(a==="adversary"||a==="adversaries"){const I=e.baseName||((b=e.name)==null?void 0:b.replace(/\s+\(\d+\)$/,""))||"",j=e.duplicateNumber||1,E=[...u];return u.some(H=>H.id===e.id)||E.push(e),E.filter(H=>H.baseName===I).length>1?`${I} (${j})`:I}return e.name},S=()=>{const b=[];return e.type&&b.push(t.jsx("span",{style:{...Re.badge,...Re.typeBadge},children:e.type},"type")),b},g=()=>{var X;const b=(e.hp||0)>=(e.hpMax||1),I=P==="edit"||v,j=a==="adversary",E=j?t.jsx(qr,{showCustomCreator:v,onSaveCustomAdversary:k,item:e,onCancelEdit:N,onRemoveInstance:s,onAddInstance:n,instances:p,onEdit:x}):null;return t.jsx(wt,{tabContent:E,showTab:j,tabBorderColor:f?"var(--purple)":"var(--border)",containerBackgroundColor:b?"var(--gray-900)":y(!0).backgroundColor,containerBorderColor:b?"color-mix(in srgb, var(--gray-600) 40%, transparent)":f?"var(--purple)":"var(--border)",containerBorderRadius:"8px",containerOverflow:"hidden",containerStyle:{padding:0,opacity:b?.7:1,height:"auto",maxHeight:j?"calc(100vh - 120px)":"calc(100vh - 68px)",minHeight:0},children:t.jsxs("div",{className:Z(),style:{...y(!0),padding:0,display:"flex",flexDirection:"column",position:"relative",height:"100%",minHeight:0,border:"none",borderRadius:0},onClick:o,children:[b&&t.jsx(t.Fragment,{children:t.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                45deg,
                transparent,
                transparent 8px,
                var(--gray-600) 1px,
                var(--gray-600) 9px
              )`,pointerEvents:"none",zIndex:9999}})}),t.jsx("div",{className:"border-b",style:{padding:"8px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative",zIndex:b?1:"auto",borderBottomColor:f?"var(--purple)":"var(--border)"},children:t.jsx("div",{style:{display:"flex",flexDirection:"column",position:"relative",zIndex:b?1:"auto",padding:"2px",gap:0},children:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",minHeight:"40px"},children:[I?t.jsx("input",{ref:D,type:"text",value:e.name||"",onChange:W=>{m&&e.id&&m(e.id,{name:W.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"4px",color:"var(--text-primary)",fontSize:"1.1rem",fontWeight:"600",padding:"0.5rem",width:"100%",maxWidth:"300px",paddingRight:"0.625rem"},placeholder:"Name"}):t.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flex:1},children:t.jsx("h4",{style:{...Re.rowTitle,color:b?"color-mix(in srgb, var(--gray-400) 80%, transparent)":Re.rowTitle.color,textAlign:"left",margin:0,fontSize:"1.1rem",paddingRight:"6px",flex:1},children:((X=e.name)==null?void 0:X.replace(/\s+\(\d+\)$/,""))||e.name})}),(e.type||e.tier||I)&&t.jsx(Or,{type:e.type,tier:e.tier,isEditMode:I,onUpdate:m,itemId:e.id})]})})}),t.jsxs("div",{ref:J,style:{borderRadius:"0 0 8px 8px",flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0},className:"invisible-scrollbar",children:[(e.motives||I)&&t.jsx("div",{style:{padding:"0.5rem 8px",textAlign:"center"},children:I?t.jsx("input",{type:"text",value:e.motives||"",onChange:W=>m&&m(e.id,{motives:W.target.value}),placeholder:"Motives...",style:{width:"100%",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}):t.jsxs("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,textAlign:"center"},children:[e.motives,e.motives&&!e.motives.endsWith(".")?".":""]})}),(e.difficulty||e.atk!==void 0||e.thresholds&&e.type!=="Minion"||e.experience&&e.experience.length>0||I)&&t.jsxs("div",{style:{padding:"0.5rem 8px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[(e.difficulty||I)&&t.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[t.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[t.jsx(mr,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(0deg)"}}),I?t.jsx("input",{type:"text",value:e.difficulty||"",onChange:W=>{const H=W.target.value.replace(/[^0-9]/g,"");H.length<=2&&m&&m(e.id,{difficulty:parseInt(H)||0})},onKeyDown:W=>{if(W.key==="ArrowUp"){W.preventDefault();const H=parseInt(e.difficulty)||0;m&&m(e.id,{difficulty:Math.min(H+1,99)})}else if(W.key==="ArrowDown"){W.preventDefault();const H=parseInt(e.difficulty)||0;m&&m(e.id,{difficulty:Math.max(H-1,0)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"2"}):t.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:e.difficulty})]}),t.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Difficulty"})]}),(e.atk!==void 0||I)&&t.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[t.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[t.jsx(fr,{size:38,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(45deg)"}}),I?t.jsx("input",{type:"text",value:(()=>{if(typeof e.atk=="string"&&e.atk.includes("d"))return e.atk;const W=typeof e.atk=="string"?parseInt(e.atk.replace(/[^0-9-]/g,"")):e.atk||0;return W>=0?`+${W}`:W.toString()})(),onChange:W=>{const H=W.target.value;if(H.includes("d"))m&&m(e.id,{atk:H});else{const ne=H.replace(/[^0-9+-]/g,"");if(ne.length<=4){const _=parseInt(ne.replace(/[^0-9-]/g,""))||0;m&&m(e.id,{atk:_})}}},onKeyDown:W=>{if(!(typeof e.atk=="string"&&e.atk.includes("d"))){if(W.key==="ArrowUp"){W.preventDefault();const ne=(typeof e.atk=="string"?parseInt(e.atk.replace(/[^0-9-]/g,"")):e.atk||0)+1;m&&m(e.id,{atk:ne})}else if(W.key==="ArrowDown"){W.preventDefault();const ne=(typeof e.atk=="string"?parseInt(e.atk.replace(/[^0-9-]/g,"")):e.atk||0)-1;m&&m(e.id,{atk:ne})}}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"3"}):t.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:(()=>{if(typeof e.atk=="string"&&e.atk.includes("d"))return e.atk;const W=typeof e.atk=="string"?parseInt(e.atk.replace(/[^0-9-]/g,"")):e.atk;return W>=0?`+${W}`:W})()})]}),t.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Attack"})]})]}),t.jsx($r,{item:e,isEditMode:I,onUpdate:m,deleteConfirmations:$,setDeleteConfirmations:R})]}),t.jsx(Rr,{item:e,isEditMode:I,onUpdate:m}),t.jsx(Lr,{item:e,isEditMode:I,onUpdate:m,handleFeatureDeleteClick:z,deleteConfirmations:$,getFeatureKey:A}),t.jsx(Fr,{item:e,instances:p,isEditMode:I,type:a,onUpdate:m,onApplyDamage:l,onApplyHealing:d,onApplyStressChange:c}),t.jsx(Hr,{item:e,isEditMode:I,mode:i,onUpdate:m})]})]})})};if(v&&(a==="adversary"||a==="adversaries")){const b=a==="adversary",I=b?t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:j=>{var E;j.stopPropagation(),(E=K.current)!=null&&E.handleSave&&K.current.handleSave()},style:{background:"var(--purple)",border:"1px solid var(--purple)",color:"white",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:j=>{j.currentTarget.style.opacity="0.9"},onMouseLeave:j=>{j.currentTarget.style.opacity="1"},title:"Save",children:[t.jsx(Vt,{size:16}),t.jsx("span",{children:"Save"})]}),N&&t.jsxs("button",{onClick:j=>{j.stopPropagation(),N()},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:j=>{j.currentTarget.style.backgroundColor="var(--bg-hover)",j.currentTarget.style.borderColor="var(--purple)"},onMouseLeave:j=>{j.currentTarget.style.backgroundColor="var(--bg-secondary)",j.currentTarget.style.borderColor="var(--border)"},title:"Cancel",children:[t.jsx(tt,{size:16}),t.jsx("span",{children:"Cancel"})]})]}):null;return t.jsx(wt,{tabContent:I,containerStyle:{padding:0,height:"auto",maxHeight:b?"calc(100vh - 120px)":"calc(100vh - 68px)",minHeight:0},children:t.jsx(jt,{ref:K,editingAdversary:e,onSave:k,onCancelEdit:N,isStockAdversary:L,embedded:!0,hideEmbeddedButtons:!0,allAdversaries:u,autoFocus:!e.baseName||e.baseName.trim()===""||e.baseName==="Unknown"})})}const P=v?"edit":i;return(P==="expanded"||P==="edit")&&(a==="adversary"||a==="adversaries")?g():a==="adversary"||a==="adversaries"?null:t.jsxs("div",{className:Z(),style:y(!0),children:[t.jsxs("div",{style:Re.rowMain,children:[t.jsx("h4",{style:Re.rowTitle,children:F()}),t.jsx("div",{style:Re.rowMeta,children:S()})]}),t.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"12px",margin:0},children:["Expanded view coming soon for ",a]})]})},dt=Vr,Kr="/Daggerheart/assets/daggerheart-logo-fe7815ad.svg",Qe={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},Ke={lessDifficult:-1,twoOrMoreSolos:-2,increasedDamage:-2,lowerTierAdversary:1,noBruisersHordesLeadersSolos:1,moreDangerous:2};function Xt(e){return 3*e+2}function Qt(e,a){return e.reduce((i,o)=>{if(o.type==="adversary"){const l=Qe[o.item.type]||2;return o.item.type==="Minion"?i+Math.ceil(o.quantity/a)*l:i+l*o.quantity}return i},0)}function Zt(e){let a=0;return e.filter(l=>l.type==="adversary"&&l.item.type==="Solo"&&l.quantity>0).reduce((l,d)=>l+d.quantity,0)>=2&&(a+=Ke.twoOrMoreSolos),e.some(l=>l.type==="adversary"&&l.item.type&&["Bruiser","Horde","Leader","Solo"].includes(l.item.type)&&l.quantity>0)||(a+=Ke.noBruisersHordesLeadersSolos),a}function Gr(e,a={}){const i=Xt(e),o=Object.entries(a).filter(([l,d])=>d).reduce((l,[d,c])=>l+Ke[d],0);return i+o}let ot={adversaries:[]},st={environments:[]},St=!1;function Jr(){const e=JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]"),a=JSON.parse(localStorage.getItem("daggerheart-custom-environments")||"[]");return{customAdversaries:e,customEnvironments:a}}async function Ut(){if(St)return{adversariesData:ot,environmentsData:st};let e={adversaries:[]},a={environments:[]},i={adversaries:[]},o={environments:[]};try{const c=await Je(()=>import("./adversaries-9c8932de.js"),[]);e=(c==null?void 0:c.default)||c}catch(c){console.warn("Failed to load adversaries.json:",c)}try{const c=await Je(()=>import("./environments-c340637c.js"),[]);a=(c==null?void 0:c.default)||c}catch(c){console.warn("Failed to load environments.json:",c)}try{const c=await Je(()=>import("./playtest-adversaries-4a099c10.js"),[]);i=(c==null?void 0:c.default)||c}catch(c){console.warn("Failed to load playtest-adversaries.json:",c)}try{const c=await Je(()=>import("./playtest-environments-d9cdffb6.js"),[]);o=(c==null?void 0:c.default)||c}catch(c){console.warn("Failed to load playtest-environments.json:",c)}const{customAdversaries:l,customEnvironments:d}=Jr();return ot={...e,adversaries:[...e.adversaries||[],...i.adversaries||[],...l]},st={...a,environments:[...a.environments||[],...o.environments||[],...d]},St=!0,{adversariesData:ot,environmentsData:st}}function qt(){return St=!1,Ut()}const Yr=(e,a)=>{const[i,o]=h.useState("max-content"),l=h.useCallback(()=>{if(!a.current||e<=3)return"max-content";const d=a.current.offsetWidth,m=Math.floor(d/120);return m<=1?"max-content":e===4?"max-content max-content":e===5||e===6?m>=2?"max-content max-content":"max-content":e===7?m>=3?"max-content max-content max-content":m>=2?"max-content max-content":"max-content":"repeat(auto-fit, minmax(80px, max-content))"},[e,a]);return h.useEffect(()=>{const d=l();o(d);const c=new ResizeObserver(()=>{const m=l();o(m)});return a.current&&c.observe(a.current),()=>{c.disconnect()}},[l]),i},Xr=({encounter:e})=>{var l,d;const a=h.useRef(null),i=((l=e.encounterItems)==null?void 0:l.length)||0,o=Yr(i,a);return t.jsx("div",{ref:a,className:"saved-encounter-adversary-list",style:{flex:1,fontSize:"0.8rem",color:"var(--text-secondary)",lineHeight:"1.3",display:"grid",gridTemplateColumns:o,gap:"0.25rem 1rem",gridAutoRows:"min-content"},children:((d=e.encounterItems)==null?void 0:d.length)>0?e.encounterItems.map((c,m)=>{var f;const u=c.item.baseName||((f=c.item.name)==null?void 0:f.replace(/\s+\(\d+\)$/,""))||c.item.name;return t.jsxs("div",{style:{marginBottom:"0.125rem"},children:[c.quantity,"x ",u]},m)}):t.jsx("div",{children:"No adversaries"})})};let Oe=ot,et=st;const Qr=async()=>{const e=await Ut();Oe=e.adversariesData,et=e.environmentsData},Zr=(e,a=[],i=4,o=1,l=!1,d=null)=>{const[c,m]=h.useState(""),[u,f]=h.useState([{field:"tier",direction:"asc"},{field:"name",direction:"asc"}]),[p,r]=h.useState([]),[n,s]=h.useState(!0),[x,v]=h.useState([]),[k,N]=h.useState([]),[L,J]=h.useState(!1),[D,K]=h.useState(!1),$=h.useRef(null),R=h.useRef(null);h.useEffect(()=>{(async()=>{await Qr(),s(!1);let E=[];e==="adversary"?E=Oe.adversaries||[]:e==="environment"&&(E=et.environments||[]),r(E)})()},[e]),h.useEffect(()=>{e==="adversary"&&d&&(async()=>{const E=await qt();Oe=E.adversariesData,et=E.environmentsData;let X=[];l?X=(Oe.adversaries||[]).filter(W=>{var H;return W.source==="Homebrew"||((H=W.id)==null?void 0:H.startsWith("custom-"))}):X=Oe.adversaries||[],r(X)})()},[d,e,l]);const A=j=>{const E=p.map(X=>X[j]).filter(Boolean);return[...new Set(E)].sort((X,W)=>typeof X=="number"&&typeof W=="number"?X-W:String(X).localeCompare(String(W)))},z=h.useCallback(async()=>{const j=await qt();Oe=j.adversariesData,et=j.environmentsData;let E=[];e==="adversary"?l?E=(Oe.adversaries||[]).filter(X=>{var W;return X.source==="Homebrew"||((W=X.id)==null?void 0:W.startsWith("custom-"))}):E=Oe.adversaries||[]:e==="environment"&&(E=et.environments||[]),r(E)},[e,l]);h.useEffect(()=>{z()},[l,z]);const y=A("tier"),Z=A("type"),F=h.useMemo(()=>{let j=p.filter(E=>{var _,G;const W=(E.name||E.baseName||"").toLowerCase().includes(c.toLowerCase())||((_=E.type)==null?void 0:_.toLowerCase().includes(c.toLowerCase()))||((G=E.description)==null?void 0:G.toLowerCase().includes(c.toLowerCase())),H=x.length===0||x.includes(E.tier.toString()),ne=k.length===0||k.includes(E.type);return W&&H&&ne});return j.sort((E,X)=>{for(const W of u){const{field:H,direction:ne}=W;let _=E[H],G=X[H];if(H==="tier")_=parseInt(_)||0,G=parseInt(G)||0;else if(H==="atk")_=parseInt(_)||0,G=parseInt(G)||0;else if(H==="cost"){const ce=de=>{if(e!=="adversary")return 0;const ze=Qe[de.type]||2;let ge=0;const Ce=a.filter(re=>re.type==="adversary"&&re.item.type==="Solo"&&re.quantity>0).reduce((re,fe)=>re+fe.quantity,0),Be=a.filter(re=>re.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(re.item.type)&&re.quantity>0).reduce((re,fe)=>re+fe.quantity,0);return de.type==="Solo"&&Ce===1&&(ge+=2),["Bruiser","Horde","Leader","Solo"].includes(de.type)&&Be===0&&(ge+=1),ze+ge};_=ce(E),G=ce(X)}else if(H==="difficulty"){const ce=parseInt(_),de=parseInt(G);!isNaN(ce)&&!isNaN(de)?(_=ce,G=de):!isNaN(ce)&&isNaN(de)?(_=ce,G=999):isNaN(ce)&&!isNaN(de)?(_=999,G=de):(_=String(_||"").toLowerCase(),G=String(G||"").toLowerCase())}else typeof _=="string"&&typeof G=="string"?(_=_.toLowerCase(),G=G.toLowerCase()):(_=String(_||"").toLowerCase(),G=String(G||"").toLowerCase());if(ne==="asc"){if(_>G)return 1;if(_<G)return-1}else{if(_<G)return 1;if(_>G)return-1}}return 0}),j},[p,c,u,x,k,a,i,o]),S=j=>{f(E=>{const X=E.findIndex(W=>W.field===j);if(X>=0)if(X===0){const W=[...E];return W[0]={...W[0],direction:W[0].direction==="asc"?"desc":"asc"},W}else{const W=[...E];return W.splice(X,1)[0],[{field:j,direction:"asc"},...W]}else return[{field:j,direction:"asc"},...E]})},g=j=>{v(j==="clear"?[]:E=>E.includes(j)?E.filter(X=>X!==j):[...E,j])},P=j=>{N(j==="clear"?[]:E=>E.includes(j)?E.filter(X=>X!==j):[...E,j])},T=x.length>0,b=k.length>0;return h.useEffect(()=>{const j=X=>{const W=X.target.closest(".filter-dropdown"),H=X.target.closest(".header-filter-icon");W||H||(J(!1),K(!1))},E=X=>{X.key==="Escape"&&(J(!1),K(!1))};return document.addEventListener("pointerdown",j,!0),document.addEventListener("mousedown",j,!0),document.addEventListener("touchstart",j,!0),document.addEventListener("click",j,!0),document.addEventListener("keydown",E,!0),()=>{document.removeEventListener("pointerdown",j,!0),document.removeEventListener("mousedown",j,!0),document.removeEventListener("touchstart",j,!0),document.removeEventListener("click",j,!0),document.removeEventListener("keydown",E,!0)}},[J,K]),{searchTerm:c,setSearchTerm:m,sortFields:u,handleSort:S,filteredAndSortedData:F,loading:n,refreshData:z,selectedTiers:x,selectedTypes:k,showTierDropdown:L,setShowTierDropdown:J,showTypeDropdown:D,setShowTypeDropdown:K,tierFilterRef:$,typeFilterRef:R,uniqueTiers:y,uniqueTypes:Z,handleTierSelect:g,handleTypeSelect:P,isTierFiltered:T,isTypeFiltered:b,getDropdownStyle:j=>{if(!j.current)return{};const E=j.current.getBoundingClientRect();return{position:"fixed",top:E.bottom+4,left:E.left-100,zIndex:99999}}}},Ur=({searchTerm:e,onSearchChange:a,type:i,partyControls:o,showCustomToggle:l=!1,onToggleCustom:d,filterCustom:c=!1,onExportCustomAdversaries:m,onImportCustomAdversaries:u,autoFocus:f=!1,onClose:p=null,placeholder:r="Search"})=>{const n=h.useRef(null);return h.useEffect(()=>{f&&n.current&&setTimeout(()=>{var s;(s=n.current)==null||s.focus()},100)},[f]),t.jsxs("div",{className:"browser-header",style:Q.browserHeader,children:[t.jsx("div",{style:{display:"flex",alignItems:"center",flex:1,gap:"0.5rem"},children:t.jsx("input",{ref:n,type:"text",placeholder:r,value:e,onChange:s=>a(s.target.value),style:{...Q.searchInput,flex:1,marginRight:0}})}),o&&t.jsx("div",{style:Q.partyControls,children:o})]})},en=({showCustomToggle:e=!1,onToggleCustom:a,filterCustom:i=!1,onExportCustomAdversaries:o,onImportCustomAdversaries:l})=>t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e&&t.jsxs("button",{onClick:()=>a&&a(!i),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:i?"var(--purple)":"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:i?"white":"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:d=>{i||(d.target.style.backgroundColor="var(--bg-hover)",d.target.style.borderColor="var(--purple)")},onMouseLeave:d=>{i||(d.target.style.backgroundColor="var(--bg-primary)",d.target.style.borderColor="var(--border)")},children:[t.jsx("span",{children:i?"✓":"○"}),"Custom Only"]}),t.jsxs("button",{onClick:o,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:d=>{d.target.style.backgroundColor="var(--bg-hover)",d.target.style.borderColor="var(--purple)"},onMouseLeave:d=>{d.target.style.backgroundColor="var(--bg-primary)",d.target.style.borderColor="var(--border)"},children:[t.jsx("span",{children:"↓"}),"Export"]}),t.jsxs("button",{onClick:()=>document.getElementById("import-file-input").click(),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:d=>{d.target.style.backgroundColor="var(--bg-hover)",d.target.style.borderColor="var(--purple)"},onMouseLeave:d=>{d.target.style.backgroundColor="var(--bg-primary)",d.target.style.borderColor="var(--border)"},children:[t.jsx("span",{children:"↑"}),"Import"]}),t.jsx("input",{id:"import-file-input",type:"file",accept:".csv,.json",onChange:l,style:{display:"none"}})]}),tn=({sortFields:e,onSort:a,type:i,uniqueTiers:o,uniqueTypes:l,selectedTiers:d,selectedTypes:c,showTierDropdown:m,setShowTierDropdown:u,showTypeDropdown:f,setShowTypeDropdown:p,tierFilterRef:r,typeFilterRef:n,handleTierSelect:s,handleTypeSelect:x,isTierFiltered:v,isTypeFiltered:k,getDropdownStyle:N,costFilter:L,showCostDropdown:J,setShowCostDropdown:D,costFilterRef:K,handleCostFilterSelect:$,isCostFiltered:R})=>{const[A,z]=h.useState(null),Z=(()=>i==="adversary"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0,hasCostFilter:!0},{key:"source",label:"Src"}]:i==="environment"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"}]:[])(),F=()=>{if(!J)return null;const g=[{value:"all",label:"All"},{value:"auto-grey",label:"Auto Grey"},{value:"auto-hide",label:"Auto Hide"}];return vt.createPortal(t.jsx("div",{className:"filter-dropdown",style:{...Q.filterDropdown,...N(K),maxHeight:"60vh",overflow:"auto"},onMouseDown:P=>P.stopPropagation(),onClick:P=>P.stopPropagation(),children:g.map(P=>{const T=L===P.value;return t.jsxs("div",{style:{...Q.filterOption,...T?Q.filterOptionSelected:{}},onClick:()=>$(P.value),children:[t.jsx("span",{style:Q.checkIcon,children:T?t.jsx(ft,{size:16}):t.jsx(ht,{size:16})}),t.jsx("span",{style:Q.filterLabel,children:P.label})]},P.value)})}),document.body)},S=(g,P,T,b,I,j,E,X)=>{if(!I)return null;const W=()=>{(g==="tier"||g==="type")&&b("clear")};return vt.createPortal(t.jsxs("div",{className:"filter-dropdown",style:{...Q.filterDropdown,...N(E),maxHeight:"60vh",overflow:"auto"},onMouseDown:H=>H.stopPropagation(),onClick:H=>H.stopPropagation(),children:[t.jsxs("div",{style:{...Q.filterOption,...T.length===0?Q.filterOptionSelected:{}},onClick:W,children:[t.jsx("span",{style:Q.checkIcon,children:T.length===0?t.jsx(ft,{size:16}):t.jsx(ht,{size:16})}),t.jsx("span",{style:Q.filterLabel,children:"All"})]}),P.map(H=>{const ne=T.includes(H.toString());return t.jsxs("div",{style:{...Q.filterOption,...ne?Q.filterOptionSelected:{}},onClick:()=>b(H.toString()),children:[t.jsx("span",{style:Q.checkIcon,children:ne?t.jsx(ft,{size:16}):t.jsx(ht,{size:16})}),t.jsx("span",{style:Q.filterLabel,children:H})]},H)})]}),document.body)};return t.jsx("tr",{style:Q.tableHeader,children:Z.map(g=>t.jsxs("th",{style:{...Q.tableHeaderCell,...A===g.key?Q.tableHeaderCellHover:{},position:"relative",...g.key==="name"?{width:"auto",minWidth:"0"}:{},...g.key==="tier"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...g.key==="type"?{width:"80px",minWidth:"80px",maxWidth:"80px"}:{},...g.key==="source"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{}},onClick:()=>a(g.key),onMouseEnter:()=>z(g.key),onMouseLeave:()=>z(null),children:[g.hasFilter?t.jsxs("div",{style:Q.headerWithFilter,children:[t.jsx("span",{style:{cursor:"pointer"},onClick:P=>{P.stopPropagation(),a(g.key)},children:g.label}),t.jsxs("button",{ref:g.key==="tier"?r:g.key==="type"&&g.hasCostFilter?K:g.key==="type"?n:K,style:{...Q.headerFilterIcon,...g.key==="tier"&&v?Q.headerFilterIconActive:{},...g.key==="type"&&(k||R)?Q.headerFilterIconActive:{},...g.key==="cost"&&R?Q.headerFilterIconActive:{}},className:"header-filter-icon",onClick:P=>{P.stopPropagation(),g.key==="tier"?(u(!m),p(!1),D(!1)):g.key==="type"&&(g.hasCostFilter?(D(!J),u(!1),p(!1)):(p(!f),u(!1),D(!1)))},children:[t.jsx(hr,{size:14}),g.key==="tier"&&v||g.key==="type"&&(k||R)||g.key==="cost"&&R?t.jsx("span",{style:Q.filterActiveDot}):null]})]}):g.label,g.key==="tier"&&S("tier",o,d,s,m,u,r),g.key==="type"&&!g.hasCostFilter&&S("type",l,c,x,f,p,n),g.key==="type"&&g.hasCostFilter&&F()]},g.key))})},rn=({item:e,onAdd:a,type:i,onRowClick:o,encounterItems:l=[],pcCount:d=4,playerTier:c=1,remainingBudget:m=0,costFilter:u="auto-grey",isFocused:f=!1,rowRef:p=null,onDeleteCustomAdversary:r=null,isDeleteConfirmed:n=!1})=>{const[s,x]=h.useState(!1),v=()=>{a(e)},k=()=>{if(i!=="adversary")return null;const J=Qe[e.type]||2;let D=0;const K=l.filter(R=>R.type==="adversary"&&R.item.type==="Solo"&&R.quantity>0).reduce((R,A)=>R+A.quantity,0),$=l.filter(R=>R.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(R.item.type)&&R.quantity>0).reduce((R,A)=>R+A.quantity,0);return e.type==="Solo"&&K===1&&(D+=2),["Bruiser","Horde","Leader","Solo"].includes(e.type)&&$===0&&(D+=1),J+D},L=(()=>{if(i==="adversary"){const J=k();Qe[e.type];const D=J>m||m<=0;if(u==="auto-hide"&&D)return null;const K=u==="auto-grey"&&D?{opacity:.5,color:"var(--text-secondary)"}:{};return e.description||e.motives?[[t.jsx("td",{style:{...Q.rowCell,width:"auto",minWidth:"0",textAlign:"left",...K,borderBottom:"none",padding:"0.25rem 0.25rem 0 0.5rem",outline:"none"},children:t.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%",display:"flex",alignItems:"center",gap:"0.5rem"},children:t.jsx("div",{style:{flex:1,minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.jsx("div",{style:{fontWeight:"600"},children:e.name||e.baseName||""})})})},"name"),t.jsx("td",{style:{...Q.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...K,borderBottom:"none",padding:"0.25rem 0.25rem 0 0.25rem",outline:"none"},children:e.tier},"tier"),t.jsx("td",{style:{...Q.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center",...K,borderBottom:"none",padding:"0.25rem 0.25rem 0 0.25rem",outline:"none"},children:e.type},"type"),t.jsx("td",{style:{...Q.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...K,borderBottom:"none",outline:"none"},rowSpan:2,children:e.source==="Homebrew"||e.isCustom?(s||f||n)&&r?t.jsx("button",{onClick:$=>{$.stopPropagation(),r(e.id)},style:{background:n?"var(--danger)":"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"4px",padding:"0.25rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:n?"var(--text-primary)":"var(--danger)",transition:"all 0.2s ease",flexShrink:0,width:"24px",height:"24px",margin:"0 auto"},title:n?"Click again to confirm delete":"Delete custom adversary",children:t.jsx(Tt,{size:14})}):t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",margin:"0 auto"},children:t.jsx(Mt,{size:14,style:{color:"var(--text-secondary)",opacity:.7},title:"Custom adversary"})}):t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",margin:"0 auto"},children:t.jsx(Nt,{size:14,style:{color:"var(--text-secondary)",opacity:.7},title:"Stock adversary"})})},"source")],[t.jsx("td",{colSpan:3,style:{...Q.rowCell,textAlign:"left",...K,padding:"0 0.25rem 0.25rem 0.5rem",borderTop:"none",borderBottom:"none",outline:"none"},children:t.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.description||e.motives||""})},"desc")]]:t.jsxs(t.Fragment,{children:[t.jsx("td",{style:{...Q.rowCell,width:"auto",minWidth:"0",textAlign:"left",...K,paddingLeft:"0.5rem"},children:t.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%",display:"flex",alignItems:"center",gap:"0.5rem"},children:t.jsx("div",{style:{flex:1,minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.jsx("div",{style:{fontWeight:"600"},children:e.name||e.baseName||""})})})}),t.jsx("td",{style:{...Q.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...K},children:e.tier}),t.jsx("td",{style:{...Q.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center",...K},children:e.type}),t.jsx("td",{style:{...Q.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...K},children:e.source==="Homebrew"||e.isCustom?(s||f||n)&&r?t.jsx("button",{onClick:$=>{$.stopPropagation(),r(e.id)},style:{background:n?"var(--danger)":"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"4px",padding:"0.25rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:n?"var(--text-primary)":"var(--danger)",transition:"all 0.2s ease",flexShrink:0,width:"24px",height:"24px",margin:"0 auto"},title:n?"Click again to confirm delete":"Delete custom adversary",children:t.jsx(Tt,{size:14})}):t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",margin:"0 auto"},children:t.jsx(Mt,{size:14,style:{color:"var(--text-secondary)",opacity:.7},title:"Custom adversary"})}):t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",margin:"0 auto"},children:t.jsx(Nt,{size:14,style:{color:"var(--text-secondary)",opacity:.7},title:"Stock adversary"})})})]})}else if(i==="environment")return t.jsxs(t.Fragment,{children:[t.jsx("td",{style:{...Q.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:e.name||e.baseName||""}),t.jsx("td",{style:{...Q.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:e.tier}),t.jsx("td",{style:{...Q.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:e.type}),t.jsx("td",{style:{...Q.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:e.difficulty})]});return null})();return L===null?null:Array.isArray(L)?t.jsx(t.Fragment,{children:L.map((J,D)=>t.jsx("tr",{ref:D===0?p:null,style:{...Q.row,...s?Q.rowHover:{},...f?Q.rowFocused:{},...D===0?{borderBottom:"none"}:{},...D===1?{borderTop:"none",height:"auto",outline:"none"}:{}},onClick:()=>{i==="adversary"?v():o&&o(e,i)},onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1),children:J},D))}):t.jsx(t.Fragment,{children:t.jsx("tr",{ref:p,style:{...Q.row,...s?Q.rowHover:{},...f?Q.rowFocused:{}},onClick:()=>{i==="adversary"?v():o&&o(e,i)},onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1),children:L})})},er=({type:e,onAddItem:a,onCancel:i=null,onRowClick:o,encounterItems:l=[],pcCount:d=4,playerTier:c=1,partyControls:m=null,showContainer:u=!0,savedEncounters:f=[],onLoadEncounter:p,onDeleteEncounter:r,activeTab:n="adversaries",selectedCustomAdversaryId:s,onSelectCustomAdversary:x,onTabChange:v,selectedAdversary:k,onSelectAdversary:N,filterCustom:L=!1,showCustomToggle:J=!1,onToggleCustom:D,onExportCustomAdversaries:K,onImportCustomAdversaries:$,autoFocus:R=!1,hideImportExport:A=!1,onClose:z=null,searchPlaceholder:y="Search"})=>{const{addCustomAdversary:Z,updateCustomAdversary:F,deleteCustomAdversary:S,customContent:g,adversaries:P,deleteAdversary:T}=ut(),[b,I]=h.useState(null),[j,E]=h.useState("all"),[X,W]=h.useState(!1),[H,ne]=h.useState({}),[_,G]=h.useState({}),ce=h.useRef({}),de=h.useRef({}),ze=h.useRef(null),[ge,Ce]=h.useState(-1),[Be,re]=h.useState(null),fe=h.useRef({}),ue=()=>{try{const M=g.adversaries||[];if(M.length===0){alert("No custom adversaries to export.");return}const ee=["name","tier","type","difficulty","threshold_major","threshold_severe","hp_max","stress_max","atk","weapon","range","damage","description","motives"],oe=M.map(ie=>{var te,he;return[ie.name||"",ie.tier||"",ie.type||"",ie.difficulty||"",((te=ie.thresholds)==null?void 0:te.major)||"",((he=ie.thresholds)==null?void 0:he.severe)||"",ie.hpMax||"",ie.stressMax||"",ie.atk||"",ie.weapon||"",ie.range||"",ie.damage||"",ie.description||"",ie.motives||""]}),Ae=ie=>{const te=String(ie);return te.includes(",")||te.includes('"')||te.includes(`
`)?`"${te.replace(/"/g,'""')}"`:te},xe=[ee.join(","),...oe.map(ie=>ie.map(Ae).join(","))].join(`
`),be=new Blob([xe],{type:"text/csv;charset=utf-8;"}),je=URL.createObjectURL(be),se=document.createElement("a");se.href=je,se.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(se),se.click(),document.body.removeChild(se),URL.revokeObjectURL(je),console.log(`Exported ${M.length} custom adversaries to CSV`)}catch(M){console.error("Failed to export custom adversaries:",M),alert("Failed to export custom adversaries. Please try again.")}},ke=M=>{const ee=M.target.files[0];if(!ee)return;const oe=ee.name.endsWith(".csv"),Ae=ee.name.endsWith(".json");if(!oe&&!Ae){alert("Please upload a CSV or JSON file."),M.target.value="";return}const xe=new FileReader;xe.onload=be=>{try{let je=[];if(oe){const ae=be.target.result.split(`
`).filter(Ne=>Ne.trim());if(ae.length<2)throw new Error("CSV file is empty or invalid.");const pe=ae[0].split(",").map(Ne=>Ne.trim().replace(/^"|"$/g,""));for(let Ne=1;Ne<ae.length;Ne++){const me=[];let We="",Pe=!1;for(let Me=0;Me<ae[Ne].length;Me++){const He=ae[Ne][Me],sr=ae[Ne][Me+1];He==='"'&&Pe&&sr==='"'?(We+='"',Me++):He==='"'?Pe=!Pe:He===","&&!Pe?(me.push(We.trim()),We=""):We+=He}me.push(We.trim());const rt={name:me[pe.indexOf("name")]||"",tier:parseInt(me[pe.indexOf("tier")])||1,type:me[pe.indexOf("type")]||"Standard",difficulty:parseInt(me[pe.indexOf("difficulty")])||11,thresholds:{major:parseInt(me[pe.indexOf("threshold_major")])||7,severe:parseInt(me[pe.indexOf("threshold_severe")])||12},hpMax:parseInt(me[pe.indexOf("hp_max")])||3,stressMax:parseInt(me[pe.indexOf("stress_max")])||1,atk:parseInt(me[pe.indexOf("atk")])||1,weapon:me[pe.indexOf("weapon")]||"",range:me[pe.indexOf("range")]||"Melee",damage:me[pe.indexOf("damage")]||"",description:me[pe.indexOf("description")]||"",motives:me[pe.indexOf("motives")]||"",source:"Homebrew"};rt.name&&je.push(rt)}}else if(Ae){const we=JSON.parse(be.target.result);if(!we.customAdversaries||!Array.isArray(we.customAdversaries))throw new Error("Invalid JSON format. Expected customAdversaries array.");je=we.customAdversaries}const se=g.adversaries||[],ie=[...se];let te=0,he=0;je.forEach(we=>{if(se.some(pe=>pe.name===we.name&&pe.source===we.source))he++;else{const pe={...we,id:`custom-adv-${Date.now()}-${Math.random().toString(36).slice(2,10)}`,hp:0,stress:0};ie.push(pe),te++}}),te>0?(localStorage.setItem("daggerheart-custom-adversaries",JSON.stringify(ie)),window.location.reload(),alert(`Import successful! Added ${te} new adversaries${he>0?`, skipped ${he} duplicates`:""}.`)):alert("No new adversaries were added. All imported adversaries already exist.")}catch(je){console.error("Failed to import custom adversaries:",je),alert(`Failed to import custom adversaries: ${je.message}`)}},xe.readAsText(ee),M.target.value=""},Ee=()=>{I(null)},Ie=async(M,ee)=>{ee?F(ee,M):Z(M)},Fe=M=>{H[M]?(r&&r(M),ne(ee=>{const oe={...ee};return delete oe[M],oe}),ce.current[M]&&(clearTimeout(ce.current[M]),delete ce.current[M])):(ne(ee=>({...ee,[M]:!0})),ce.current[M]&&clearTimeout(ce.current[M]),ce.current[M]=setTimeout(()=>{ne(ee=>{const oe={...ee};return delete oe[M],oe}),delete ce.current[M]},3e3))},Ze=M=>{_[M]?(P.filter(oe=>oe.customContentId===M).forEach(oe=>{T(oe.id)}),S(M),G(oe=>{const Ae={...oe};return delete Ae[M],Ae}),de.current[M]&&(clearTimeout(de.current[M]),delete de.current[M])):(G(ee=>({...ee,[M]:!0})),de.current[M]&&clearTimeout(de.current[M]),de.current[M]=setTimeout(()=>{G(ee=>{const oe={...ee};return delete oe[M],oe}),delete de.current[M]},3e3))};h.useEffect(()=>()=>{Object.values(ce.current).forEach(M=>{clearTimeout(M)}),Object.values(de.current).forEach(M=>{clearTimeout(M)})},[]);const{searchTerm:De,setSearchTerm:qe,sortFields:C,handleSort:w,filteredAndSortedData:B,loading:V,selectedTiers:q,selectedTypes:O,showTierDropdown:ye,setShowTierDropdown:U,showTypeDropdown:Y,setShowTypeDropdown:le,tierFilterRef:Se,typeFilterRef:ve,uniqueTiers:Te,uniqueTypes:Le,handleTierSelect:_e,handleTypeSelect:pt,isTierFiltered:mt,isTypeFiltered:Ct,getDropdownStyle:tr}=Zr(e,l,d,c,L,g),kt=h.useRef(De),Et=h.useRef(JSON.stringify(q)),At=h.useRef(JSON.stringify(O));h.useEffect(()=>{const M=kt.current!==De,ee=Et.current!==JSON.stringify(q),oe=At.current!==JSON.stringify(O);(M||ee||oe)&&(Ce(-1),re(null),kt.current=De,Et.current=JSON.stringify(q),At.current=JSON.stringify(O))},[De,q,O]),h.useEffect(()=>{if(n!=="adversaries")return;const M=ee=>{const oe=document.activeElement;if(oe&&["INPUT","TEXTAREA","SELECT"].includes(oe.tagName))if(ee.key==="ArrowDown"||ee.key==="ArrowUp"||ee.key==="Enter")(ee.key!=="Enter"||oe.tagName!=="INPUT")&&oe.blur();else return;const Ae=B.length-1;if(ee.key==="ArrowDown")ee.preventDefault(),Ce(xe=>{var je;const be=xe<Ae?xe+1:xe;return be>=0&&be<B.length&&(re(((je=B[be])==null?void 0:je.id)||null),fe.current[be]&&setTimeout(()=>{const se=fe.current[be];if(se){const ie=se.closest(".browser-content");if(ie){const te=ie.getBoundingClientRect(),he=se.getBoundingClientRect(),we=se.nextElementSibling,ae=we&&we.tagName==="TR"&&we.querySelector("td[colspan]");let pe=he.height;ae&&(pe+=we.getBoundingClientRect().height);const Ne=he.bottom-te.top,me=te.height,We=Ne>=me-1,Pe=he.bottom>te.bottom;if(We||Pe){let Me=se.offsetTop+pe-me;const He=ie.scrollHeight-me;Me=Math.min(Me,He),Me=Math.max(0,Me),ie.scrollTo({top:Me,behavior:"smooth"})}}else se.scrollIntoView({behavior:"smooth",block:"end"})}},0)),be});else if(ee.key==="ArrowUp")ee.preventDefault(),Ce(xe=>{var je;if(xe<=0)return re(null),setTimeout(()=>{const se=document.querySelector('.browser-header input[type="text"]');se==null||se.focus()},0),-1;const be=xe-1;return be>=0&&be<B.length?(re(((je=B[be])==null?void 0:je.id)||null),fe.current[be]&&setTimeout(()=>{const se=fe.current[be];if(se){const ie=se.closest(".browser-content");if(ie){const te=ie.getBoundingClientRect(),he=se.getBoundingClientRect(),we=(()=>{const me=se.closest("table"),We=me==null?void 0:me.querySelector("thead");return We?We.getBoundingClientRect().height:0})(),ae=he.top-te.top,pe=Math.abs(ae-we)<=1;if(he.top<te.top||pe){const me=se.nextElementSibling,We=me&&me.tagName==="TR"&&me.querySelector("td[colspan]");let Pe=he.height;We&&(Pe+=me.getBoundingClientRect().height);let Me=se.offsetTop-we;const He=ie.scrollHeight-ie.clientHeight;Me=Math.min(Me,He),Me=Math.max(0,Me),ie.scrollTo({top:Me,behavior:"smooth"})}}else se.scrollIntoView({behavior:"smooth",block:"start"})}},0)):re(null),be});else if(ee.key==="Enter"&&ge>=0&&ge<=Ae){ee.preventDefault();const xe=B[ge];xe&&a&&a(xe)}};return document.addEventListener("keydown",M),()=>{document.removeEventListener("keydown",M)}},[n,B,ge,a]);const rr=(()=>{const M=3*d+2,ee=l.reduce((te,he)=>{if(he.type==="adversary"){const we=Qe[he.item.type]||2;if(he.item.type==="Minion"){const ae=Math.ceil(he.quantity/d);return te+ae*we}else return te+he.quantity*we}return te},0);let oe=0;l.filter(te=>te.type==="adversary"&&te.item.type==="Solo"&&te.quantity>0).reduce((te,he)=>te+he.quantity,0)>=2&&(oe+=Ke.twoOrMoreSolos);const xe=l.some(te=>te.type==="adversary"&&te.item.type==="Bruiser"&&te.quantity>0),be=l.some(te=>te.type==="adversary"&&te.item.type==="Horde"&&te.quantity>0),je=l.some(te=>te.type==="adversary"&&te.item.type==="Leader"&&te.quantity>0),se=l.some(te=>te.type==="adversary"&&te.item.type==="Solo"&&te.quantity>0);return!xe&&!be&&!je&&!se&&(oe+=Ke.noBruisersHordesLeadersSolos),M+oe-ee})(),nr=M=>{E(M),W(!1)},or=j!=="all";return V?t.jsx("div",{style:Q.browser,children:t.jsx("div",{style:Q.loading,children:"Loading..."})}):t.jsx(t.Fragment,{children:t.jsxs("div",{style:u?Q.browserWrapper:Q.browserWrapperNoContainer,children:[n==="adversaries"&&t.jsxs(t.Fragment,{children:[t.jsx(Ur,{searchTerm:De,onSearchChange:qe,type:e,partyControls:m,autoFocus:R,onClose:z,placeholder:y}),!A&&t.jsx(en,{showCustomToggle:J,onToggleCustom:D,filterCustom:L,onExportCustomAdversaries:ue,onImportCustomAdversaries:ke}),t.jsx("div",{className:"browser-content invisible-scrollbar",style:Q.browserContent,children:t.jsxs("table",{style:Q.browserTable,children:[t.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,backgroundColor:"var(--bg-primary)"},children:t.jsx(tn,{sortFields:C,onSort:w,type:e,uniqueTiers:Te,uniqueTypes:Le,selectedTiers:q,selectedTypes:O,showTierDropdown:ye,setShowTierDropdown:U,showTypeDropdown:Y,setShowTypeDropdown:le,tierFilterRef:Se,typeFilterRef:ve,handleTierSelect:_e,handleTypeSelect:pt,isTierFiltered:mt,isTypeFiltered:Ct,getDropdownStyle:tr,costFilter:j,showCostDropdown:X,setShowCostDropdown:W,costFilterRef:ze,handleCostFilterSelect:nr,isCostFiltered:or})}),t.jsx("tbody",{children:B.map((M,ee)=>t.jsx(rn,{item:M,onAdd:a,type:e,onRowClick:o,encounterItems:l,pcCount:d,playerTier:c,remainingBudget:rr,costFilter:j,isFocused:Be===M.id||ge===ee,onDeleteCustomAdversary:e==="adversary"?Ze:null,isDeleteConfirmed:_[M.id]||!1,rowRef:oe=>{oe?fe.current[ee]=oe:delete fe.current[ee]}},M.id))})]})})]}),n==="encounters"&&t.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:f.length===0?t.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",textAlign:"center",padding:"2rem 1rem"},children:"No saved encounters yet"}):t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:f.map(M=>t.jsxs("div",{onClick:()=>p&&p(M.id),className:"saved-encounter-card",style:{border:"1px solid var(--border)",borderRadius:"8px",padding:"8px",backgroundColor:"var(--bg-card)",transition:"background-color 0.2s ease",display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[t.jsxs("div",{style:{minWidth:"100px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",flexDirection:"column",justifyContent:"center",minHeight:"60px"},children:[t.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Tier: ",(()=>{var Ae,xe,be,je;const ee=((je=(be=(xe=(Ae=M.encounterItems)==null?void 0:Ae.filter(se=>se.type==="adversary"))==null?void 0:xe.map(se=>se.item.tier))==null?void 0:be.filter(se=>se!=null))==null?void 0:je.sort((se,ie)=>se-ie))||[];if(ee.length===0)return"N/A";if(ee.length===1)return ee[0];const oe=[...new Set(ee)];return oe.length===1?oe[0]:`${Math.min(...oe)}-${Math.max(...oe)}`})()]}),t.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Party Size: ",M.partySize||4]}),t.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)"},children:["Balance: ",(()=>{const ee=M.partySize||4,oe=3*ee+2;let Ae=0;const xe=M.encounterItems||[];xe.filter(ae=>ae.type==="adversary"&&ae.item.type==="Solo"&&ae.quantity>0).reduce((ae,pe)=>ae+pe.quantity,0)>=2&&(Ae+=Ke.twoOrMoreSolos);const je=xe.some(ae=>ae.type==="adversary"&&ae.item.type==="Bruiser"&&ae.quantity>0),se=xe.some(ae=>ae.type==="adversary"&&ae.item.type==="Horde"&&ae.quantity>0),ie=xe.some(ae=>ae.type==="adversary"&&ae.item.type==="Leader"&&ae.quantity>0),te=xe.some(ae=>ae.type==="adversary"&&ae.item.type==="Solo"&&ae.quantity>0);!je&&!se&&!ie&&!te&&(Ae+=Ke.noBruisersHordesLeadersSolos);const he=oe+Ae,we=xe.reduce((ae,pe)=>{if(pe.type==="adversary"){const Ne=Qe[pe.item.type]||2;if(pe.item.type==="Minion"){const me=Math.ceil(pe.quantity/ee);return ae+me*Ne}else return ae+pe.quantity*Ne}return ae},0);return we>he?`+${we-he}`:we===he?"0":`-${he-we}`})()]})]}),t.jsx("div",{style:{minWidth:"120px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",alignItems:"center",minHeight:"60px"},children:t.jsx("div",{style:{fontWeight:"500",color:"var(--text-primary)",fontSize:"0.9rem",wordWrap:"break-word",wordBreak:"break-word",width:"150px",maxWidth:"150px"},children:M.name})}),t.jsx(Xr,{encounter:M}),t.jsx("button",{onClick:ee=>{ee.stopPropagation(),Fe(M.id)},style:{background:H[M.id]?"var(--danger)":"var(--gray-600)",border:"none",color:"white",padding:"0.4rem 0.8rem",borderRadius:"4px",fontSize:"0.75rem",cursor:"pointer",minWidth:"60px",transition:"background-color 0.2s"},children:"Delete"})]},M.id))})}),n==="create"&&t.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"1rem",display:"flex",justifyContent:"center",alignItems:"flex-start",height:"100%",minHeight:0},children:t.jsx("div",{style:{maxWidth:"600px",width:"100%",height:"auto",display:"flex",flexDirection:"column",padding:"0",overflowY:"visible",overflowX:"hidden",minHeight:0},children:t.jsx(jt,{onSave:Ie,onRefresh:()=>{},onAddItem:a,editingAdversary:b,onCancelEdit:Ee,embedded:!1})})}),n==="info"&&t.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"2rem"},children:[t.jsxs("div",{style:{marginBottom:"2rem",textAlign:"center"},children:[t.jsx("img",{src:Kr,alt:"Daggerheart Community Content Logo",style:{width:"100%",maxWidth:"300px",height:"auto",margin:"0 auto 1.5rem auto",display:"block"},onError:M=>{console.error("Failed to load Daggerheart logo:",M.target.src),M.target.style.display="none"}}),t.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",textAlign:"left",maxWidth:"600px",margin:"0 auto"},children:[t.jsx("p",{style:{marginTop:0},children:"This product includes materials from the Daggerheart System Reference Document 1.0, © Critical Role, LLC, under the terms of the Darrington Press Community Gaming (DPCGL) License."}),t.jsxs("p",{children:["More information can be found at ",t.jsx("a",{href:"https://www.daggerheart.com",target:"_blank",rel:"noopener noreferrer",style:{color:"var(--purple)",textDecoration:"underline"},children:"daggerheart.com"})]}),t.jsx("p",{style:{marginBottom:0},children:t.jsx("em",{children:"This project is unofficial and not endorsed by Darrington Press or Critical Role."})})]})]}),t.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto",border:"1px solid var(--border)",borderRadius:"8px",overflow:"hidden"},children:[t.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"1rem 1.5rem",color:"var(--text-primary)",border:"none",background:"var(--bg-secondary)",width:"100%",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"0.875rem",borderBottom:"1px solid var(--border)"},onMouseEnter:M=>{M.target.style.backgroundColor="var(--bg-hover)"},onMouseLeave:M=>{M.target.style.backgroundColor="var(--bg-secondary)"},onClick:M=>{M.stopPropagation(),window.open("https://github.com/Splinter714/Daggerheart","_blank")},children:[t.jsx("span",{children:"View on GitHub"}),t.jsx("span",{children:"→"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem 1.5rem",color:"var(--text-secondary)",background:"var(--bg-secondary)",fontSize:"0.875rem"},children:["Version ","0.4.15 (916af86)"]})]})]})]})})},Q={browserWrapper:{display:"flex",flexDirection:"column",background:"var(--bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border)",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserWrapperNoContainer:{display:"flex",flexDirection:"column",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserContent:{flex:1,overflowY:"auto",overflowX:"visible",padding:0,width:"100%",scrollbarWidth:"none",msOverflowStyle:"none",borderRadius:"0 0 8px 8px"},tableHeaderContainer:{flexShrink:0,position:"sticky",top:0,zIndex:15,backgroundColor:"var(--bg-secondary)"},browserTable:{width:"100%",minWidth:"100%",borderCollapse:"collapse",tableLayout:"fixed",background:"var(--bg-primary)",margin:0},browserHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--gray-900)",flexShrink:0,position:"sticky",top:0,zIndex:20},browserTitle:{margin:0,color:"var(--text-primary)",fontSize:"18px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"24px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",marginRight:"12px",transition:"all 0.2s ease"},partyControls:{display:"flex",alignItems:"center",gap:"12px",flexShrink:0},searchInputFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 3px rgba(139, 92, 246, 0.1)"},tableHeader:{background:"var(--gray-900)",borderBottom:"1px solid var(--border)",boxShadow:"0 1px 0 var(--border)",position:"sticky",top:"0",zIndex:10},tableHeaderCell:{backgroundColor:"var(--gray-900)",fontWeight:"700",borderBottom:"1px solid var(--border)",cursor:"pointer",userSelect:"none",minWidth:"100px",whiteSpace:"nowrap",padding:"4px 4px",color:"var(--text-primary)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",boxShadow:"0 1px 0 var(--border)",transition:"background-color 0.2s",position:"sticky",top:"0",zIndex:10},tableHeaderCellHover:{backgroundColor:"var(--bg-hover)"},sortIndicator:{fontSize:"12px",color:"var(--text-secondary)"},tableBody:{flex:1,overflowY:"auto",padding:"8px",backgroundColor:"var(--bg-primary)"},row:{height:"auto",minHeight:"35px",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s ease",cursor:"pointer",backgroundColor:"var(--gray-900)"},rowHover:{backgroundColor:"var(--bg-secondary)"},rowFocused:{backgroundColor:"var(--bg-secondary)",boxShadow:"inset 0 0 0 2px var(--purple)"},expandedRow:{backgroundColor:"var(--bg-secondary)"},rowCell:{padding:"4px 4px",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid var(--border)"},rowCellName:{fontWeight:"500",minWidth:"150px"},rowCellCenter:{textAlign:"center",justifyContent:"center",minWidth:"80px"},rowActions:{width:"80px",textAlign:"center",padding:"4px 8px",borderBottom:"1px solid var(--border)"},addButton:{width:"2rem",height:"2rem",border:"1px solid var(--purple)",borderRadius:"var(--radius-sm)",background:"var(--purple)",color:"white",cursor:"pointer",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"500"},expandedContent:{padding:"0",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)"},columnName:{width:"auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",paddingLeft:"8px",textAlign:"left"},columnTier:{width:"80px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnType:{width:"100px",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},columnDifficulty:{width:"40px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnAction:{width:"32px",minWidth:"24px",maxWidth:"24px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"visible",textOverflow:"unset"},loading:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"var(--text-primary)",fontSize:"16px"},mobileBrowser:{width:"95vw",height:"90vh",maxWidth:"none"},mobileSearchInput:{fontSize:"16px"},headerWithFilter:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0px",position:"relative"},headerFilterIcon:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"2px 4px",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",position:"relative",marginLeft:"-2px"},headerFilterIconActive:{color:"var(--purple)"},filterIcon:{fontSize:"12px"},filterActiveDot:{position:"absolute",left:"50%",top:"2px",transform:"translateX(-50%)",width:"4px",height:"4px",borderRadius:"50%",background:"var(--purple)",pointerEvents:"none"},filterDropdown:{position:"fixed",background:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",zIndex:99999,marginTop:"4px",overflow:"hidden",width:"max-content",minWidth:"120px",maxWidth:"200px"},filterOption:{padding:"8px 12px",cursor:"pointer",color:"var(--text-primary)",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background-color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},filterOptionSelected:{backgroundColor:"var(--bg-hover)"},checkIcon:{width:"16px",height:"16px",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"12px"},filterLabel:{flex:1}},nn=({isOpen:e,onClose:a,onAddAdversary:i,onAddAdversariesBulk:o,onAddEnvironment:l,onDeleteAdversary:d,onDeleteEnvironment:c,onDeleteCountdown:m,adversaries:u=[],environments:f=[],countdowns:p=[],savedEncounters:r=[],onSaveEncounter:n,onLoadEncounter:s,onDeleteEncounter:x})=>{const{partySize:v,updatePartySize:k,currentEncounterName:N,updateCurrentEncounterName:L,customContent:J}=ut(),D=v,K=k,[$,R]=h.useState({lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),[A,z]=h.useState([]),[y,Z]=h.useState(N||"Encounter"),[F,S]=h.useState("adversaries"),[g,P]=h.useState(null),[T,b]=h.useState(null),[I,j]=h.useState(null),[E,X]=h.useState(null),[W,H]=h.useState(!1);h.useEffect(()=>{e&&!g&&Z(N||"Encounter")},[e,g,N]);const ne=()=>T?y!==T.name||JSON.stringify(A)!==JSON.stringify(T.encounterItems)||D!==T.partySize||JSON.stringify($)!==JSON.stringify(T.battlePointsAdjustments):!1,_=()=>{var C;if(A.length>0||(y||"").trim()!=="Encounter")return!0;if(g&&ne()){if(T){const w=A.length,B=((C=T.encounterItems)==null?void 0:C.length)||0;if(w!==B||(y||"").trim()!==(T.name||""))return!0;const V=JSON.stringify($),q=JSON.stringify(T.battlePointsAdjustments||{});return V!==q}return!0}return!1},G=({onClick:C,children:w,variant:B="secondary",isConfirmation:V=!1})=>{const q=B==="danger"||B==="secondary"&&V,O=B==="purple";return t.jsx("button",{onClick:C,style:{background:q?"var(--danger)":O?"var(--purple)":"var(--bg-secondary)",border:O?"none":"1px solid var(--border)",color:q||O?"white":"var(--text-primary)",padding:"0.375rem 0.75rem",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s",width:"70px",fontSize:"0.875rem"},children:w})},ce=Ve.useRef(D),de=h.useCallback(C=>!C||C.length===0?null:r.find(B=>{var ye,U;if(((ye=B.encounterItems)==null?void 0:ye.length)!==C.length)return!1;const V=Y=>{var le;return{type:Y.type,quantity:Y.quantity,item:{name:Y.item.baseName||((le=Y.item.name)==null?void 0:le.replace(/\s+\(\d+\)$/,""))||Y.item.name,type:Y.item.type,tier:Y.item.tier}}},q=(U=B.encounterItems)==null?void 0:U.map(V).sort((Y,le)=>Y.item.name.localeCompare(le.item.name)||Y.item.type.localeCompare(le.item.type)),O=C.map(V).sort((Y,le)=>Y.item.name.localeCompare(le.item.name)||Y.item.type.localeCompare(le.item.type));return JSON.stringify(q)===JSON.stringify(O)})||null,[r]);Ve.useEffect(()=>{if(e&&u.length>0&&A.length===0){const C={};u.forEach(V=>{var O;const q=V.baseName||((O=V.name)==null?void 0:O.replace(/\s+\(\d+\)$/,""))||V.name;C[q]||(C[q]={type:"adversary",item:V,quantity:0}),C[q].quantity+=1});const w=Object.values(C);z(w);const B=de(w);B&&!g&&(P(B.id),b({name:B.name||"",encounterItems:B.encounterItems||[],partySize:B.partySize||4,battlePointsAdjustments:B.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),Z(B.name||"Encounter"),L(B.name||"Encounter"))}else e&&u.length===0&&A.length===0&&z([])},[e,de,g,L]);const ze=Ve.useMemo(()=>Zt(A),[A]),ge=Gr(D,$)+ze,Ce=Qt(A,D);Ve.useEffect(()=>{const C=ce.current;C!==D&&(z(w=>w.map(B=>{if(B.type==="adversary"&&B.item.type==="Minion"){const q=Math.ceil(B.quantity/C)*D;return{...B,quantity:q}}return B})),ce.current=D)},[D]);const Be=(C,w)=>{const B=A.findIndex(O=>O.item.id===C.id&&O.type===w),V=C.type==="Minion"?D:1;let q;B>=0?q=A.map((O,ye)=>ye===B?{...O,quantity:O.quantity+V}:O):q=[...A,{item:C,type:w,quantity:V}],z(q),re(q)},re=C=>{const w=u||[],B=[];C.forEach(U=>{for(let Y=0;Y<U.quantity;Y++)U.type==="adversary"&&B.push(U.item)});const V={};w.forEach(U=>{var le;const Y=U.baseName||((le=U.name)==null?void 0:le.replace(/\s+\(\d+\)$/,""))||U.name;V[Y]||(V[Y]=[]),V[Y].push(U)});const q={};B.forEach(U=>{var le;const Y=U.baseName||((le=U.name)==null?void 0:le.replace(/\s+\(\d+\)$/,""))||U.name;q[Y]||(q[Y]=[]),q[Y].push(U)});const O=[],ye=[];Object.keys(q).forEach(U=>{var Se;const Y=((Se=V[U])==null?void 0:Se.length)||0,le=q[U].length;if(le>Y){const ve=le-Y;for(let Te=0;Te<ve;Te++)O.push(q[U][0])}else if(le<Y){const ve=Y-le,Le=[...V[U]].sort((_e,pt)=>{const mt=_e.duplicateNumber||1;return(pt.duplicateNumber||1)-mt});for(let _e=0;_e<ve;_e++)ye.push(Le[_e].id)}}),Object.keys(V).forEach(U=>{q[U]||[...V[U]].sort((Se,ve)=>{const Te=Se.duplicateNumber||1;return(ve.duplicateNumber||1)-Te}).forEach(Se=>{ye.push(Se.id)})}),ye.forEach(U=>{d(U)}),O.length>0&&o(O)},fe=(C,w)=>{const B=(()=>{const V=A.findIndex(q=>q.item.id===C&&q.type===w);if(V>=0){const q=A[V];if(q.quantity===0)return A.filter((U,Y)=>Y!==V);const O=q.item.type==="Minion"?D:1,ye=Math.max(0,q.quantity-O);return A.map((U,Y)=>Y===V?{...U,quantity:ye}:U)}return A})();z(B),re(B)},ue=h.useCallback(()=>{if(A.length===0)return null;const C=(y||"").trim()||"Encounter",w=r.find(B=>{var O,ye;if(B.name!==C||((O=B.encounterItems)==null?void 0:O.length)!==A.length)return!1;const V=JSON.stringify((ye=B.encounterItems)==null?void 0:ye.sort()),q=JSON.stringify([...A].sort());return V===q});return(w==null?void 0:w.id)||null},[r,y,A]),ke=h.useCallback(()=>{let C=(y||"").trim(),w=g;if(w||(w=ue()),A.length===0&&(!C||C==="Encounter")&&w){x(w),P(null),b(null);return}const B={name:C,encounterItems:A,partySize:D,battlePointsAdjustments:$};if(w){B.id=w;const V=n(B);P(V)}else{const V=n(B);P(V)}b({name:C,encounterItems:A,partySize:D,battlePointsAdjustments:$})},[A,y,D,$,g,n,ue,x]);h.useEffect(()=>{if(g&&ne()){const C=setTimeout(()=>{ke()},2e3);return()=>clearTimeout(C)}else if(!g&&A.length>0&&y&&y.trim()!==""){const C=setTimeout(()=>{ke()},2e3);return()=>clearTimeout(C)}},[A,g,y,$,D]);const Ee=()=>{_()&&(z([]),Z("Encounter"),L("Encounter"),P(null),b(null),u.forEach(C=>{d(C.id)}),f.forEach(C=>{c(C.id)}),p.forEach(C=>{m(C.id)}))},Ie=C=>{const w=s(C);if(w){const B=w.encounterItems||[];z(B),K(w.partySize||4),R(w.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),Z(w.name||""),L(w.name||""),P(C),b({name:w.name||"",encounterItems:w.encounterItems||[],partySize:w.partySize||4,battlePointsAdjustments:w.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),re(B)}},Fe=C=>{x(C),g===C&&(z([]),Z("Encounter"),L("Encounter"),P(null),b(null),u.forEach(w=>{d(w.id)}),f.forEach(w=>{c(w.id)}),p.forEach(w=>{m(w.id)}))},Ze=()=>{try{const C={version:"1.0",exportDate:new Date().toISOString(),customAdversaries:J.adversaries||[]},w=JSON.stringify(C,null,2),B=new Blob([w],{type:"application/json"}),V=URL.createObjectURL(B),q=document.createElement("a");q.href=V,q.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(V),console.log("Custom adversaries exported successfully")}catch(C){console.error("Failed to export custom adversaries:",C),alert("Failed to export custom adversaries. Please try again.")}},De=C=>{const w=C.target.files[0];if(!w)return;const B=new FileReader;B.onload=V=>{try{const q=JSON.parse(V.target.result);if(!q.customAdversaries||!Array.isArray(q.customAdversaries))throw new Error("Invalid file format. Expected customAdversaries array.");const O=J.adversaries||[],ye=q.customAdversaries,U=[...O];let Y=0;ye.forEach(le=>{O.some(ve=>ve.name===le.name&&ve.type===le.type)||(U.push({...le,id:`custom-${Date.now()}-${Math.random().toString(36).slice(2,10)}`}),Y++)}),updateCustomContent("adversary",null,U),Y>0?alert(`Successfully imported ${Y} custom adversaries.`):alert("No new adversaries were added. All imported adversaries already exist.")}catch(q){console.error("Failed to import custom adversaries:",q),alert("Failed to import custom adversaries. Please check the file format and try again.")}},B.readAsText(w),C.target.value=""};if(!e)return null;const qe=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://");return t.jsx("div",{onClick:a,className:"encounter-builder-modal",style:{position:"fixed",top:0,left:0,right:0,bottom:qe?"calc(60px + env(safe-area-inset-bottom) + 1rem)":"calc(60px + env(safe-area-inset-bottom))",backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:1e3,display:"flex",alignItems:"flex-start",justifyContent:"center",padding:"12px"},children:t.jsxs("div",{onClick:C=>C.stopPropagation(),style:{backgroundColor:"var(--bg-primary)",border:"2px solid var(--border)",borderRadius:"12px",width:"100%",maxWidth:"1200px",height:"100%",maxHeight:"100%",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"},children:[t.jsxs("div",{className:"encounter-top-bar",style:{flex:"0 0 auto",display:"flex",alignItems:"center",height:"39px",backgroundColor:"var(--bg-primary)",borderBottom:"1px solid var(--border)"},children:[t.jsx("button",{onClick:()=>S("adversaries"),style:{flex:1,background:F==="adversaries"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:F==="adversaries"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Builder"}),t.jsx("button",{onClick:()=>S("encounters"),style:{flex:1,background:F==="encounters"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:F==="encounters"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Saved Encounters"}),t.jsx("button",{onClick:()=>S("create"),style:{flex:1,background:F==="create"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:F==="create"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Create Adversary"}),t.jsx("button",{onClick:()=>S("info"),style:{flex:1,background:F==="info"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:F==="info"?"500":"400",transition:"all 0.2s ease",position:"relative"},children:"Info"})]}),t.jsxs("div",{className:"encounter-builder-content",style:{flex:1,display:"flex",overflow:"hidden"},children:[t.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",borderTop:"1px solid var(--border)"},children:t.jsx(er,{type:"adversary",onAddItem:C=>Be(C,"adversary"),encounterItems:A,pcCount:D,showContainer:!1,savedEncounters:r,onLoadEncounter:Ie,onDeleteEncounter:Fe,activeTab:F,selectedCustomAdversaryId:I,onSelectCustomAdversary:j,onTabChange:S,selectedAdversary:E,onSelectAdversary:X,filterCustom:W,showCustomToggle:!0,onToggleCustom:H,onExportCustomAdversaries:Ze,onImportCustomAdversaries:De})}),F!=="info"&&t.jsxs("div",{className:"encounter-right-panel",style:{flex:1,borderLeft:"1px solid var(--border)",display:"flex",flexDirection:"column",overflow:"hidden",position:"relative"},children:[E&&t.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"var(--bg-primary)",zIndex:10,display:"flex",flexDirection:"column"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)",flexShrink:0},children:[t.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:0},children:"Adversary Preview"}),t.jsx("button",{onClick:()=>X(null),style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease"},onMouseEnter:C=>C.target.style.color="var(--text-primary)",onMouseLeave:C=>C.target.style.color="var(--text-secondary)",title:"Close preview",children:t.jsx(tt,{size:16})})]}),t.jsx("div",{style:{flex:1,overflowY:"auto",padding:"0.75rem"},children:t.jsx(dt,{item:{...E,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...E,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}})})]}),(F==="adversaries"||F==="encounters")&&t.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-primary)",flexShrink:0},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[t.jsx("input",{type:"text",value:y,onChange:C=>{Z(C.target.value),L(C.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),t.jsx(G,{onClick:Ee,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:_()?1:.5,cursor:_()?"pointer":"not-allowed"},children:"New"})]})}),(F==="adversaries"||F==="encounters")&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"encounter-receipt-buttons-vertical",style:{display:"none",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[t.jsx("input",{type:"text",value:y,onChange:C=>{Z(C.target.value),L(C.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),t.jsx(G,{onClick:Ee,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:_()?1:.5,cursor:_()?"pointer":"not-allowed"},children:"New"})]})}),t.jsx("div",{className:"receipt-content",style:{padding:"1rem",display:"flex",flexDirection:"column",height:"100%"},children:t.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"flex-start",overflowY:"auto",marginBottom:"0.75rem"},children:[t.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[t.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[t.jsx("button",{onClick:()=>K(Math.max(1,D-1)),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:t.jsx(it,{size:10})}),t.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:D}),t.jsx("button",{onClick:()=>K(D+1),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:t.jsx(Ye,{size:10})})]}),t.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Party Size"})}),t.jsx("div",{style:{width:"120px",textAlign:"right"}})]}),A.map(C=>{var w;return C.type!=="adversary"?null:t.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[t.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[t.jsx("button",{onClick:()=>fe(C.item.id,C.type),style:{background:C.quantity===0?"var(--danger)":"var(--bg-secondary)",border:C.quantity===0?"none":"1px solid var(--border)",color:C.quantity===0?"white":"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:C.quantity===0?t.jsx(tt,{size:10}):t.jsx(it,{size:10})}),t.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:C.quantity}),t.jsx("button",{onClick:()=>Be(C.item,C.type),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:t.jsx(Ye,{size:10})})]}),t.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:C.item.baseName||((w=C.item.name)==null?void 0:w.replace(/\s+\(\d+\)$/,""))||C.item.name})}),t.jsx("div",{style:{width:"80px",textAlign:"right"},children:t.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.8rem"},children:C.item.type})})]},`${C.item.id}-${C.type}`)}),t.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[t.jsx("div",{style:{flex:1,display:"flex",alignItems:"center"},children:t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Balance"})}),t.jsx("div",{style:{width:"120px",textAlign:"right",display:"flex",alignItems:"center",justifyContent:"flex-end"},children:t.jsx("span",{style:{color:Ce>ge?"var(--danger)":Ce===ge?"var(--purple)":"var(--success)",fontWeight:600},children:Ce>ge?`+${Ce-ge}`:ge-Ce===0?"0":`-${ge-Ce}`})})]})]})})]}),F==="create"&&t.jsxs("div",{style:{padding:"1.5rem",overflowY:"auto",height:"100%"},children:[t.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Creating Adversaries"}),t.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",display:"flex",flexDirection:"column",gap:"1rem"},children:[t.jsx("p",{children:"Use the form to create custom adversaries for your encounters."}),t.jsxs("div",{children:[t.jsx("strong",{style:{color:"var(--text-primary)"},children:"Adversary Types:"}),t.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Minion (1 BP):"})," Weak enemies in groups"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Standard (2 BP):"})," Average threat level"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Leader (3 BP):"})," Commands others"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Bruiser (4 BP):"})," High HP tank"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Solo (5 BP):"})," Boss-level threat"]})]})]}),t.jsxs("div",{children:[t.jsx("strong",{style:{color:"var(--text-primary)"},children:"Tips:"}),t.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[t.jsx("li",{children:"Match adversary tier to party level"}),t.jsx("li",{children:"Balance encounter difficulty with Battle Points"}),t.jsx("li",{children:"Mix adversary types for variety"}),t.jsx("li",{children:"Add features that create interesting choices"})]})]})]})]}),F==="myAdversaries"&&t.jsx("div",{style:{padding:"0.75rem",overflowY:"auto",height:"100%"},children:I?(()=>{var w;const C=(w=J==null?void 0:J.adversaries)==null?void 0:w.find(B=>B.id===I);return C?t.jsx(dt,{item:{...C,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...C,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}}):t.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Adversary not found"})})():t.jsxs("div",{children:[t.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Adversary Preview"}),t.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Select an adversary to view details"})]})})]})]})]})})},on=({browserOpenAtPosition:e,handleCloseBrowser:a,handleOpenBrowser:i,getEntityGroups:o,fear:l,updateFear:d})=>{const c=h.useRef(!1),m=h.useRef(null),u=h.useRef(null),f=h.useMemo(()=>({"shift+space":()=>{if(e!==null)a();else{const r=o();i(r.length)}},escape:()=>{e!==null&&a()},"+":()=>{const r=(l==null?void 0:l.value)||0,n=Math.min(12,r+1);d(n)},"=":()=>{const r=(l==null?void 0:l.value)||0,n=Math.min(12,r+1);d(n)},"-":()=>{const r=(l==null?void 0:l.value)||0,n=Math.max(0,r-1);d(n)},_:()=>{const r=(l==null?void 0:l.value)||0,n=Math.max(0,r-1);d(n)}}),[e,a,i,o,l,d]),p=h.useCallback(r=>{var D;if(window.matchMedia("(max-width: 800px)").matches)return;const s=r.key===" "||r.key==="Space"||r.code==="Space";if(r.shiftKey&&s&&!r.ctrlKey&&!r.metaKey&&!r.altKey){if(console.log("[Keyboard] Shift+Space detected, toggling browser"),r.preventDefault(),r.stopPropagation(),r.stopImmediatePropagation(),e!==null)a();else{const K=o();i(K.length)}return}const v=document.activeElement;if(v&&["INPUT","TEXTAREA","SELECT"].includes(v.tagName)){const K=r.key==="Escape",$=r.shiftKey&&s&&!r.ctrlKey&&!r.metaKey&&!r.altKey;if(!K&&!$)return}const N=[];(r.ctrlKey||r.metaKey)&&N.push("ctrl"),r.shiftKey&&N.push("shift"),r.altKey&&N.push("alt");let L=r.key.toLowerCase();L===" "&&(L="space"),N.push(L);const J=N.join("+");if(f[J]){r.preventDefault(),f[J](r);return}if(!r.ctrlKey&&!r.metaKey&&!r.shiftKey&&!r.altKey&&f[L]){r.preventDefault(),f[L](r);return}if(!r.ctrlKey&&!r.metaKey&&!r.shiftKey&&!r.altKey&&(r.key==="ArrowLeft"||r.key==="ArrowRight")){const K=document.activeElement;if(K&&["INPUT","TEXTAREA","SELECT"].includes(K.tagName))return;const $=document.querySelector(".dashboard-scroll-container");if($){r.preventDefault(),console.log("[Keyboard] Dashboard scroll requested:",{key:r.key,currentScrollLeft:$.scrollLeft,containerWidth:$.clientWidth,scrollWidth:$.scrollWidth,scrollInProgress:c.current,browserOpen:e!==null});const R=Array.from($.children).filter(A=>getComputedStyle(A).scrollSnapAlign!=="none");if(console.log("[Keyboard] Found panels:",{totalPanels:R.length,panelDetails:R.map((A,z)=>({index:z,offsetLeft:A.offsetLeft,offsetWidth:A.offsetWidth,scrollSnapAlign:getComputedStyle(A).scrollSnapAlign}))}),R.length>0){const A=$.scrollLeft;let z=0,y=1/0;R.forEach((S,g)=>{const P=S.offsetLeft,T=Math.abs(P-A);T<y&&(y=T,z=g)}),console.log("[Keyboard] Panel detection:",{currentScroll:A,currentPanelIndex:z,currentPanelOffsetLeft:(D=R[z])==null?void 0:D.offsetLeft,minDistance:y,allPanels:R.map((S,g)=>({index:g,offsetLeft:S.offsetLeft,distance:Math.abs(S.offsetLeft-A)}))});const Z=r.key==="ArrowLeft"?-1:1,F=z+Z;if(console.log("[Keyboard] Scrolling decision:",{scrollDirection:Z,currentPanelIndex:z,nextPanelIndex:F,canScroll:F>=0&&F<R.length}),F>=0&&F<R.length){const S=R[F],g=S.offsetLeft;console.log("[Keyboard] Scrolling to panel:",{index:F,offsetLeft:S.offsetLeft,offsetWidth:S.offsetWidth,targetScrollPosition:g,currentScroll:A,scrollInProgress:c.current}),m.current&&(clearTimeout(m.current),m.current=null),u.current=F,c.current?(console.log("[Keyboard] Redirecting scroll to new target",{previousTarget:u.current,newTarget:F,targetScrollPosition:g}),$.scrollTo({left:g,behavior:"smooth"})):(c.current=!0,S.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"})),m.current=setTimeout(()=>{if(u.current===F){const P=$.scrollLeft,T=S.offsetLeft,b=Math.abs(P-T);b>.5&&(console.log("[Keyboard] Correcting misalignment:",{finalScroll:P,expectedScroll:T,misalignment:b}),$.scrollTo({left:T,behavior:"auto"})),c.current=!1,u.current=null,console.log("[Keyboard] Scroll after action:",{newScrollLeft:$.scrollLeft,targetScrollPosition:g,difference:$.scrollLeft-A,actualDifference:$.scrollLeft-g,misalignment:b})}m.current=null},600)}else console.log("[Keyboard] Cannot scroll - panel index out of bounds")}else{console.log("[Keyboard] No panels found, using fallback scroll");const A=$.firstElementChild;if(A){const z=A.offsetWidth,y=r.key==="ArrowLeft"?-1:1;$.scrollBy({left:z*y,behavior:"smooth"})}}}else console.log("[Keyboard] Scroll container not found")}},[f,e,a,i,o]);h.useEffect(()=>(document.addEventListener("keydown",p,!0),()=>{document.removeEventListener("keydown",p,!0)}),[p])},sn=({position:e="top",children:a,onClick:i,className:o="",style:l={}})=>{const d=e==="top",c=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://"),m={background:"var(--bg-primary)",borderTop:d?"none":"1px solid var(--border)",borderBottom:d?"1px solid var(--border)":"none",padding:d?"0.25rem 0":"0.5rem",paddingBottom:d?"0.25rem":c?"calc(0.5rem + env(safe-area-inset-bottom) + 1rem)":"calc(0.5rem + env(safe-area-inset-bottom))",position:d?"relative":"sticky",[d?"top":"bottom"]:0,zIndex:d?10:100,order:d?1:3,flexShrink:0,touchAction:"manipulation",userSelect:"none",display:"flex",flexDirection:d?"column":"row",justifyContent:d?"stretch":"center",alignItems:d?"stretch":"center",gap:d?"0":"1rem",height:d?"auto":"60px",...l};return t.jsx("div",{className:o,style:m,onClick:i,children:a})},an=({fearValue:e,onUpdateFear:a,onToggleBrowser:i,isBrowserOpen:o})=>t.jsx(sn,{position:"top",children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",width:"100%",justifyContent:"space-between",padding:"0 1rem"},children:[t.jsx(lt,{type:"fear",value:e,maxValue:12,onChange:a,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0}),t.jsx("button",{onClick:i,title:o?"Close Browser":"Add Adversaries",style:{width:"36px",height:"36px",padding:0,backgroundColor:o?"var(--purple)":"transparent",border:"1px solid var(--border)",borderRadius:"50%",color:o?"white":"var(--text-primary)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",flexShrink:0},onMouseEnter:l=>{o||(l.currentTarget.style.borderColor="var(--purple)",l.currentTarget.style.backgroundColor="var(--bg-secondary)")},onMouseLeave:l=>{o||(l.currentTarget.style.borderColor="var(--border)",l.currentTarget.style.backgroundColor="transparent")},children:t.jsx(Ye,{size:18})})]})}),ln=({isOpen:e,columnWidth:a,gap:i,onClose:o,onCreateCustomAdversary:l,pcCount:d,updatePartySize:c,availableBattlePoints:m,spentBattlePoints:u,browserActiveTab:f,onTabChange:p,savedEncounters:r,loadEncounter:n,deleteEncounter:s,selectedCustomAdversaryId:x,onSelectCustomAdversary:v,onAddAdversaryFromBrowser:k})=>e?t.jsx("div",{style:{position:"absolute",top:`${i}px`,right:`${i}px`,bottom:`${i}px`,width:`${a}px`,zIndex:100,overflow:"visible"},children:t.jsx(wt,{tabContent:t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:l,style:{padding:"0.375rem 0.75rem",backgroundColor:"var(--purple)",border:"none",color:"white",borderRadius:"4px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",transition:"opacity 0.2s ease"},onMouseEnter:N=>{N.currentTarget.style.opacity="0.9"},onMouseLeave:N=>{N.currentTarget.style.opacity="1"},children:[t.jsx(Ye,{size:16}),t.jsx("span",{children:"Add Custom"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:"500"},children:"Party Size:"}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",border:"1px solid var(--border)",borderRadius:"4px",padding:"0.125rem 0.25rem",backgroundColor:"var(--bg-secondary)"},children:[t.jsx("button",{onClick:()=>c(Math.max(1,d-1)),style:{background:"transparent",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:0,display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem"},onMouseEnter:N=>{N.currentTarget.style.color="var(--purple)"},onMouseLeave:N=>{N.currentTarget.style.color="var(--text-primary)"},children:t.jsx(it,{size:12})}),t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:"500",minWidth:"1.5rem",textAlign:"center"},children:d}),t.jsx("button",{onClick:()=>c(d+1),style:{background:"transparent",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:0,display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem"},onMouseEnter:N=>{N.currentTarget.style.color="var(--purple)"},onMouseLeave:N=>{N.currentTarget.style.color="var(--text-primary)"},children:t.jsx(Ye,{size:12})})]})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:"500"},children:"Balance:"}),t.jsx("span",{style:{color:u>m?"var(--danger)":u===m?"var(--purple)":"var(--success)",fontWeight:600,fontSize:"0.875rem"},children:u>m?`+${u-m}`:m-u===0?"0":`-${m-u}`})]}),o&&t.jsx("button",{onClick:o,style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease",flexShrink:0},onMouseEnter:N=>N.currentTarget.style.color="var(--text-primary)",onMouseLeave:N=>N.currentTarget.style.color="var(--text-secondary)",title:"Close browser",children:t.jsx(tt,{size:16})})]}),showTab:!0,tabBackgroundColor:"var(--bg-primary)",tabBorderColor:"var(--border)",tabJustifyContent:"space-between",containerBackgroundColor:"var(--bg-primary)",containerBorderColor:"var(--border)",containerBorderRadius:"8px",containerBoxShadow:"-4px 0 12px rgba(0, 0, 0, 0.3)",containerOverflow:"hidden",reserveTabSpace:!0,containerStyle:{height:"100%"},children:t.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,display:"flex",flexDirection:"column",width:"100%",minWidth:0},children:t.jsx(er,{type:"adversary",onAddItem:k,showContainer:!1,activeTab:f,onTabChange:p,pcCount:d,savedEncounters:r,onLoadEncounter:n,onDeleteEncounter:s,selectedCustomAdversaryId:x,onSelectCustomAdversary:v,autoFocus:!0,hideImportExport:!0,onClose:o,searchPlaceholder:"Search adversaries"})})})}):null,yt=({side:e="left",children:a,className:i="",style:o={}})=>{const l=e==="left",d={flex:1,minWidth:0,background:"var(--bg-primary)",overflowY:"auto",overflowX:l?"auto":"hidden",display:l?"block":"flex",flexDirection:l?"initial":"column",height:"100%",padding:l?"8px 0 8px 0":"0 8px 0 0",...o};return t.jsx("div",{className:i,style:d,children:a})},dn=({entityGroups:e,columnWidth:a,gap:i,scrollContainerRef:o,onScroll:l,newCards:d,removingCardSpacer:c,spacerShrinking:m,browserOpenAtPosition:u,editingAdversaryId:f,handleSaveCustomAdversary:p,handleCancelEdit:r,updateAdversary:n,updateEnvironment:s,updateCountdown:x,adversaries:v,handleEditAdversary:k,createAdversary:N,createAdversariesBulk:L,pcCount:J,smoothScrollTo:D,getEntityGroups:K,deleteAdversary:$,setRemovingCardSpacer:R,setSpacerShrinking:A})=>t.jsxs("div",{ref:o,className:"dashboard-scroll-container",onScroll:l,children:[e.length===0?null:(()=>{const z=[];if(e.forEach((y,Z)=>{var S,g,P;if(c&&c.baseName===y.baseName&&y.type==="adversary"){z.push(t.jsx(yt,{style:{width:m?"0px":`${a}px`,flexShrink:0,flexGrow:0,flex:"none",paddingRight:"0",paddingTop:m?"0px":`${i}px`,paddingBottom:m?"0px":`${i}px`,scrollSnapAlign:"none",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"100%",opacity:0,transition:"width 0.3s ease, padding-top 0.3s ease, padding-bottom 0.3s ease"}},`spacer-${c.baseName}`));return}z.push(t.jsx(yt,{className:Z===0?"dashboard-column dashboard-column--first":Z===e.length-1?"dashboard-column dashboard-column--last":"dashboard-column",style:{width:`${a}px`,flexShrink:0,flexGrow:0,flex:"none",paddingRight:"0",paddingTop:`${y.type==="adversary"?i+52:i}px`,paddingBottom:`${i}px`,scrollSnapAlign:"start",overflow:y.type==="adversary"?"visible":"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"auto",opacity:d.has(`${y.type}-${y.baseName}`)?0:1,transition:"opacity 0.2s ease"},children:t.jsx(dt,{type:y.type,item:{...y.instances[0],name:((S=y.instances[0])==null?void 0:S.name)||y.baseName,hp:0,stress:0,isDead:!1},mode:"expanded",instances:y.instances,showCustomCreator:y.type==="adversary"&&f&&y.instances.some(T=>T.id===f),onSaveCustomAdversary:y.type==="adversary"&&f&&y.instances.some(T=>T.id===f)?p:void 0,onCancelEdit:y.type==="adversary"&&f&&y.instances.some(T=>T.id===f)?r:void 0,isStockAdversary:y.type==="adversary"&&f&&y.instances.some(T=>T.id===f)?!((g=y.instances[0])!=null&&g.source)||((P=y.instances[0])==null?void 0:P.source)!=="Homebrew":!1,onApplyDamage:y.type==="adversary"?(T,b)=>{const I=y.instances.find(j=>j.id===T);I&&n(T,{hp:Math.min(I.hpMax||1,(I.hp||0)+b)})}:void 0,onApplyHealing:y.type==="adversary"?(T,b)=>{const I=y.instances.find(j=>j.id===T);I&&n(T,{hp:Math.max(0,(I.hp||0)-b)})}:void 0,onApplyStressChange:y.type==="adversary"?(T,b)=>{var I,j;return n(T,{stress:Math.max(0,Math.min(((I=y.instances.find(E=>E.id===T))==null?void 0:I.stressMax)||6,(((j=y.instances.find(E=>E.id===T))==null?void 0:j.stress)||0)+b))})}:void 0,onUpdate:y.type==="adversary"?n:y.type==="environment"?s:x,adversaries:v,showAddRemoveButtons:u!==null&&y.type==="adversary",onEdit:y.type==="adversary"?T=>k(T):void 0,onAddInstance:y.type==="adversary"?T=>{const b=T.type==="Minion",I=b?J:1;if(b&&I>1){const j=Array(I).fill(null).map(()=>({...T}));L(j)}else N(T);setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!o.current)return;const j=o.current,E=j.scrollLeft,X=j.clientWidth,W=u!==null?X-(a+i):X,ne=K().findIndex(_=>_.baseName===y.baseName&&_.type==="adversary");if(ne>=0){const _=i+ne*(a+i),G=_+a,ce=10;_>=E-ce&&G<=E+W+ce||D(_,500)}})})},50)}:void 0,onRemoveInstance:y.type==="adversary"?()=>{const T=y.instances[0],I=(T==null?void 0:T.type)==="Minion"?J:1,j=y.instances.sort((H,ne)=>{const _=H.duplicateNumber||1;return(ne.duplicateNumber||1)-_}),X=Math.max(0,j.length-I)===0;if(j.length===0)return;const W=j.slice(0,I);if(X){const H=e.findIndex(G=>G.baseName===y.baseName&&G.type==="adversary"),ne=H===0;let _=!1;if(o.current){const G=o.current,ce=G.scrollLeft,de=G.scrollWidth-G.clientWidth;_=Math.abs(ce-de)<1}R({baseName:y.baseName,groupIndex:H}),A(!1),ne&&o.current&&(o.current.style.scrollSnapType="none"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{o.current&&o.current.offsetHeight,W.forEach(G=>{$(G.id)}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{o.current&&o.current.offsetHeight,setTimeout(()=>{if(A(!0),_&&o.current){const G=performance.now(),ce=300,de=()=>{if(!o.current)return;const ze=o.current,ge=ze.scrollWidth-ze.clientWidth;ze.scrollLeft=ge,performance.now()-G<ce&&requestAnimationFrame(de)};requestAnimationFrame(de)}setTimeout(()=>{if(R(null),A(!1),ne&&o.current&&(o.current.style.scrollSnapType="x mandatory"),_&&o.current){const G=o.current;G.scrollLeft=G.scrollWidth-G.clientWidth}},300)},50)})})})})}else W.forEach(H=>{$(H.id)})}:void 0})},`${y.type}-${y.baseName}`))}),c&&!z.some(y=>(y==null?void 0:y.key)===`spacer-${c.baseName}`)){const y=Math.min(c.groupIndex,z.length);z.splice(y,0,t.jsx(yt,{className:"dashboard-column",style:{width:m?"0px":`${a}px`,flexShrink:0,flexGrow:0,flex:"none",paddingRight:"0",paddingTop:m?"0px":`${i}px`,paddingBottom:m?"0px":`${i}px`,scrollSnapAlign:"none",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"100%",opacity:0,transition:"width 0.3s ease, padding-top 0.3s ease, padding-bottom 0.3s ease"}},`spacer-${c.baseName}`))}return z})(),u!==null&&t.jsx("div",{style:{width:`${a}px`,flexShrink:0,flexGrow:0,flex:"none",height:"100%"}})]}),cn=(e=[])=>e.reduce((a,i)=>{var l;const o=i.baseName||((l=i.name)==null?void 0:l.replace(/\s+\(\d+\)$/,""))||i.name||"Unknown";return a[o]||(a[o]={type:"adversary",baseName:o,instances:[]}),a[o].instances.push(i),a},{}),un=(e,a,i,o)=>{const l=h.useRef(a);h.useEffect(()=>{const d=l.current;if(d!==a&&d>0){const c=cn(e);Object.values(c).forEach(m=>{if(m.type!=="adversary"||m.instances.length===0)return;const u=m.instances[0];if(u.type!=="Minion")return;const f=m.instances.length,r=Math.ceil(f/d)*a;if(r!==f)if(r>f){const n=r-f,s=Array(n).fill(null).map(()=>({...u}));i(s)}else{const n=f-r;m.instances.slice(-n).forEach(x=>o(x.id))}}),l.current=a}else(d===0||l.current===0)&&(l.current=a)},[e,a,i,o])},at=8,_t=e=>e===1?200:350,pn=e=>{if(e<=0)return{visibleColumns:1,columnWidth:_t(1)};const a=e-at*2;let i={visibleColumns:1,columnWidth:a};for(let l=1;l<=5;l+=1){const d=(l-1)*at,c=(a-d)/l;c>=_t(l)&&l*c+d<=a&&(i={visibleColumns:l,columnWidth:c})}return i.visibleColumns*i.columnWidth+(i.visibleColumns-1)*at>a&&(i={visibleColumns:1,columnWidth:a}),i},mn=()=>typeof window>"u"?0:window.innerWidth,fn=e=>{const[a,i]=h.useState(mn),o=h.useMemo(()=>pn(a),[a]);return h.useLayoutEffect(()=>{const l=()=>{e.current?i(e.current.clientWidth):typeof window<"u"&&i(window.innerWidth)};l();const d=()=>l();window.addEventListener("resize",d);let c;return typeof ResizeObserver<"u"&&e.current&&(c=new ResizeObserver(()=>{e.current&&i(e.current.clientWidth)}),c.observe(e.current)),()=>{window.removeEventListener("resize",d),c&&c.disconnect()}},[e]),{gap:at,columnWidth:o.columnWidth,visibleColumns:o.visibleColumns}};class hn extends Ve.Component{constructor(a){super(a),this.state={hasError:!1,error:null}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,i){console.error("ErrorBoundary caught an error:",a,i)}render(){var a;return this.state.hasError?t.jsxs("div",{className:"p-md text-red",children:[t.jsx("h3",{children:"Something went wrong:"}),t.jsx("pre",{children:(a=this.state.error)==null?void 0:a.toString()}),t.jsx("button",{className:"btn-base btn-text",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try again"})]}):this.props.children}}const xn=({scrollContainerRef:e,columnWidth:a,gap:i,onCloseReset:o})=>{const[l,d]=h.useState(null),c=h.useCallback(u=>{if(d(u),e.current){const f=e.current,p=f.scrollLeft,r=f.scrollWidth-f.clientWidth,n=Math.abs(p-r)<1;f._scrollBeforeBrowserOpen=p,f._scrollWidthBeforeOpen=f.scrollWidth,f._wasAtMaxScrollBeforeBrowserOpen=n}},[e]),m=h.useCallback(()=>{if(e.current){const u=e.current;u._scrollBeforeBrowserClose=u.scrollLeft,u._scrollWidthBeforeClose=u.scrollWidth}d(null),o==null||o()},[e,o]);return h.useEffect(()=>{e.current&&requestAnimationFrame(l!==null?()=>{requestAnimationFrame(()=>{if(!e.current)return;const u=e.current,f=u._wasAtMaxScrollBeforeBrowserOpen,p=u._scrollBeforeBrowserOpen||0;u.scrollLeft=p,delete u._scrollBeforeBrowserOpen,delete u._wasAtMaxScrollBeforeBrowserOpen})}:()=>{requestAnimationFrame(()=>{if(!e.current)return;const u=e.current,f=u._scrollBeforeBrowserClose||0,p=u.scrollWidth-u.clientWidth,r=Math.min(f,p);u.scrollLeft=r,delete u._scrollBeforeBrowserClose})})},[l,a,i,e]),{browserOpenAtPosition:l,handleOpenBrowser:c,handleCloseBrowser:m}},gn=e=>h.useCallback((a,i=500)=>{if(!e.current)return;const o=e.current,l=o.scrollLeft,d=a-l;if(Math.abs(d)<1)return;o._horizontalScrollAnimationId&&(cancelAnimationFrame(o._horizontalScrollAnimationId),o._horizontalScrollAnimationId=null),window.getComputedStyle(o).scrollSnapType!=="none"&&(o.style.scrollSnapType="none");const u=performance.now(),f=p=>{const r=p-u,n=Math.min(r/i,1),s=1-n,x=1-s*s*s;if(o){const v=l+d*x;o.scrollLeft=v}n<1?o._horizontalScrollAnimationId=requestAnimationFrame(f):o&&(o.scrollLeft=a,o._horizontalScrollAnimationId=null)};o._horizontalScrollAnimationId=requestAnimationFrame(f)},[e]),yn=(e,a)=>{const i=h.useCallback(()=>{const l={};return e.forEach(d=>{var m;const c=d.baseName||((m=d.name)==null?void 0:m.replace(/\s+\(\d+\)$/,""))||d.name;l[c]||(l[c]={type:"adversary",baseName:c,instances:[]}),l[c].instances.push(d)}),a.forEach(d=>{l[`countdown-${d.id}`]={type:"countdown",baseName:d.name,instances:[d]}}),Object.values(l)},[e,a]);return{entityGroups:h.useMemo(()=>i(),[i]),getEntityGroups:i}},vn=({entityGroups:e,pcCount:a,scrollContainerRef:i,createAdversariesBulk:o,createAdversary:l,setNewCards:d,getEntityGroups:c,smoothScrollTo:m,browserOpenAtPosition:u,columnWidth:f,gap:p})=>h.useCallback(r=>{var D,K,$;const n=r.baseName||((D=r.name)==null?void 0:D.replace(/\s+\(\d+\)$/,""))||r.name,x=!e.find(R=>R.baseName===n&&R.type==="adversary"),v=r.type==="Minion",k=v?a:1,N=((K=i.current)==null?void 0:K.scrollWidth)??0,L=(($=i.current)==null?void 0:$.scrollLeft)??0,J=i.current;if(J&&x&&window.getComputedStyle(J).scrollSnapType!=="none"&&(J.style.scrollSnapType="none"),v&&k>1){const R=Array(k).fill(null).map(()=>({...r}));o(R)}else l(r);if(x){const R=`adversary-${n}`;d(A=>new Set(A).add(R)),setTimeout(()=>{d(A=>{const z=new Set(A);return z.delete(R),z})},10)}setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!i.current)return;const R=i.current;if(!(R.scrollWidth<=R.clientWidth))if(x){const A=R.scrollWidth;setTimeout(()=>{if(!i.current)return;const z=i.current,y=()=>{if(!i.current)return;const Z=i.current,F=Z.scrollWidth-Z.clientWidth,S=F-L;Z.scrollWidth>N&&Math.abs(S)<1?m(F+10,500):Math.abs(S)>1&&m(F,500)};z.scrollWidth!==A?requestAnimationFrame(()=>{requestAnimationFrame(()=>{y()})}):y()},10)}else{const z=c().findIndex(y=>y.baseName===n&&y.type==="adversary");if(z>=0){const y=i.current,Z=y.scrollLeft,F=y.clientWidth,S=u!==null?F-(f+p):F,g=p+z*(f+p),P=g+f,T=10;g>=Z-T&&P<=Z+S+T||m(g,500)}}})})},50)},[u,f,o,l,e,p,c,a,i,d,m]);const bn=()=>{const{adversaries:e,environments:a,countdowns:i,fear:o,savedEncounters:l,partySize:d,customContent:c,updatePartySize:m,updateFear:u,createAdversary:f,createAdversariesBulk:p,updateAdversary:r,deleteAdversary:n,addCustomAdversary:s,updateCustomAdversary:x,createEnvironment:v,updateEnvironment:k,deleteEnvironment:N,updateCountdown:L,deleteCountdown:J,saveEncounter:D,loadEncounter:K,deleteEncounter:$}=ut(),R=d||4,[A,z]=h.useState(!1),[y,Z]=h.useState(null),[F,S]=h.useState("adversaries"),[g,P]=h.useState(null),[T,b]=h.useState(new Set),[I,j]=h.useState(null),[E,X]=h.useState(!1),W=h.useRef(null);un(e,R,p,n);const{columnWidth:H,gap:ne}=fn(W),{browserOpenAtPosition:_,handleOpenBrowser:G,handleCloseBrowser:ce}=xn({scrollContainerRef:W,columnWidth:H,gap:ne,onCloseReset:()=>S("adversaries")}),de=gn(W),ze=h.useCallback(()=>{z(!1)},[]),{entityGroups:ge,getEntityGroups:Ce}=yn(e,i);on({browserOpenAtPosition:_,handleCloseBrowser:ce,handleOpenBrowser:G,getEntityGroups:Ce,fear:o,updateFear:u});const Be=vn({entityGroups:ge,pcCount:R,scrollContainerRef:W,createAdversariesBulk:p,createAdversary:f,setNewCards:b,getEntityGroups:Ce,smoothScrollTo:de,browserOpenAtPosition:_,columnWidth:H,gap:ne}),re=h.useCallback(()=>{const B="Standard",V=Ue(1,B),q={name:"",baseName:"",tier:1,type:B,description:"",motives:"",difficulty:V.difficulty,thresholds:V.thresholds,hpMax:V.hpMax,stressMax:V.stressMax,atk:V.atk,weapon:"",range:V.range,damage:V.damage,experience:[],features:[],source:"Homebrew",hp:0,stress:0,isVisible:!0};f(q),setTimeout(()=>{const O=Ce();for(const ye of O)if(ye.type==="adversary"){const U=ye.instances.find(Y=>Y.source==="Homebrew"&&(!Y.baseName||Y.baseName.trim()===""||Y.baseName==="Unknown"));if(U&&!y){Z(U.id),requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(W.current){const Y=O.findIndex(le=>le.instances.some(Se=>Se.id===U.id));if(Y>=0){const le=ne+Y*(H+ne);de(le,600,"new-custom-adversary")}}})});break}}},100)},[f,Ce,H,ne,de,y]),fe=h.useCallback(w=>{Z(w)},[]),ue=h.useCallback(()=>{Z(null)},[]),ke=h.useCallback(async(w,B)=>{var V,q;if(B){const O=e.find(U=>U.id===B);if((O==null?void 0:O.source)==="Homebrew"||(O==null?void 0:O.isCustom)){const U=O==null?void 0:O.customContentId,Y=O==null?void 0:O.baseName,le=U?(V=c==null?void 0:c.adversaries)==null?void 0:V.find(Se=>Se.id===U):(q=c==null?void 0:c.adversaries)==null?void 0:q.find(Se=>Se.baseName===Y&&(Se.source==="Homebrew"||Se.isCustom));if(le){const Se={...w,name:w.baseName||w.name};x(le.id,Se);const ve=w.baseName||(O==null?void 0:O.baseName);e.forEach(Te=>{(Te.customContentId===U||Te.baseName===ve&&(Te.source==="Homebrew"||Te.isCustom))&&r(Te.id,{...w,customContentId:le.id})})}else{const Se={...w,name:w.baseName||w.name},ve=s(Se),Te=w.baseName||(O==null?void 0:O.baseName);e.forEach(Le=>{Le.baseName===Te&&(Le.source==="Homebrew"||Le.isCustom)&&r(Le.id,{...w,customContentId:ve})})}}else{const U=O==null?void 0:O.baseName,Y=e.filter(ve=>{const Te=ve.baseName===U,Le=!ve.source||ve.source!=="Homebrew"&&!ve.isCustom;return Te&&Le}),le={...w,name:w.baseName||w.name},Se=s(le);Y.forEach(ve=>{n(ve.id)}),setTimeout(()=>{const ve=Y.map(()=>({...w,source:"Homebrew",isCustom:!0,customContentId:Se,hp:0,stress:0}));ve.length>0&&p(ve)},0)}Z(null)}else if(y){const O={...w,name:w.baseName||w.name},ye=s(O),U=f({...w,source:"Homebrew",isCustom:!0,customContentId:ye});return Z(null),U}else{const O={...w,name:w.baseName||w.name},ye=s(O);return f({...w,source:"Homebrew",isCustom:!0,customContentId:ye})}},[y,e,c,f,r,s,x,p,n]),Ie=h.useCallback(()=>{const w={};return e.forEach(B=>{var q;const V=B.baseName||((q=B.name)==null?void 0:q.replace(/\s+\(\d+\)$/,""))||B.name;w[V]||(w[V]={type:"adversary",item:B,quantity:0}),w[V].quantity+=1}),Object.values(w)},[e])(),Fe=Zt(Ie),Ze=Xt(R)+Fe,De=Qt(Ie,R),qe=h.useRef(null),C=h.useCallback(w=>{qe.current&&clearTimeout(qe.current),qe.current=setTimeout(()=>{const B=w.target;B&&B.style.scrollSnapType==="none"&&(B.style.scrollSnapType="x mandatory")},150)},[]);return t.jsxs("div",{className:"app dashboard-root",style:{"--dashboard-gap":`${ne}px`},onClick:w=>{w.target,w.currentTarget},children:[t.jsx(an,{fearValue:(o==null?void 0:o.value)||0,onUpdateFear:u,isBrowserOpen:_!==null,onToggleBrowser:()=>{_!==null?ce():G(ge.length)}}),t.jsxs("div",{className:"dashboard-main",children:[t.jsx(ln,{isOpen:_!==null,columnWidth:H,gap:ne,onClose:ce,onCreateCustomAdversary:re,pcCount:R,updatePartySize:m,availableBattlePoints:Ze,spentBattlePoints:De,browserActiveTab:F,onTabChange:S,savedEncounters:l,loadEncounter:K,deleteEncounter:$,selectedCustomAdversaryId:g,onSelectCustomAdversary:P,onAddAdversaryFromBrowser:Be}),t.jsx(dn,{entityGroups:ge,columnWidth:H,gap:ne,scrollContainerRef:W,onScroll:C,newCards:T,removingCardSpacer:I,spacerShrinking:E,browserOpenAtPosition:_,editingAdversaryId:y,handleSaveCustomAdversary:ke,handleCancelEdit:ue,updateAdversary:r,updateEnvironment:k,updateCountdown:L,adversaries:e,handleEditAdversary:fe,createAdversary:f,createAdversariesBulk:p,pcCount:R,smoothScrollTo:de,getEntityGroups:Ce,deleteAdversary:n,setRemovingCardSpacer:j,setSpacerShrinking:X})]}),t.jsx(nn,{isOpen:A,onClose:ze,onAddAdversary:w=>{f(w)},onAddAdversariesBulk:w=>{p(w)},onAddEnvironment:w=>{v(w)},onDeleteAdversary:n,onDeleteEnvironment:N,onDeleteCountdown:J,adversaries:e,environments:a,countdowns:i,savedEncounters:l,onSaveEncounter:D,onLoadEncounter:K,onDeleteEncounter:$}),t.jsx(Tr,{})]})},wn=()=>{const{isLoaded:e}=ut();return e?t.jsx(hn,{children:t.jsx(bn,{})}):t.jsx("div",{className:"app loading-state",children:t.jsx("div",{className:"loading-placeholder","aria-hidden":"true"})})};bt.createRoot(document.getElementById("root")).render(t.jsx(Ve.StrictMode,{children:t.jsx(Ir,{children:t.jsx(wn,{})})}));
