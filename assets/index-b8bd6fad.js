import{r as f,a as jt,R as rt}from"./dndkit-57209f9c.js";import{F as Gt,f as Kt,a as Yt,b as Jt,c as zt}from"./fa-b4bcccb0.js";import{D as Ot,A as Xt,C as Rt,X as ot,M as ft,P as at,a as Zt,H as Qt,L as Ut,b as er,F as tr,S as ut,c as pt}from"./lucide-9f8be461.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))d(b);new MutationObserver(b=>{for(const m of b)if(m.type==="childList")for(const x of m.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&d(x)}).observe(document,{childList:!0,subtree:!0});function p(b){const m={};return b.integrity&&(m.integrity=b.integrity),b.referrerPolicy&&(m.referrerPolicy=b.referrerPolicy),b.crossOrigin==="use-credentials"?m.credentials="include":b.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function d(b){if(b.ep)return;b.ep=!0;const m=p(b);fetch(b.href,m)}})();var Ft={exports:{}},gt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rr=f,nr=Symbol.for("react.element"),sr=Symbol.for("react.fragment"),or=Object.prototype.hasOwnProperty,ar=rr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ir={key:!0,ref:!0,__self:!0,__source:!0};function $t(t,n,p){var d,b={},m=null,x=null;p!==void 0&&(m=""+p),n.key!==void 0&&(m=""+n.key),n.ref!==void 0&&(x=n.ref);for(d in n)or.call(n,d)&&!ir.hasOwnProperty(d)&&(b[d]=n[d]);if(t&&t.defaultProps)for(d in n=t.defaultProps,n)b[d]===void 0&&(b[d]=n[d]);return{$$typeof:nr,type:t,key:m,ref:x,props:b,_owner:ar.current}}gt.Fragment=sr;gt.jsx=$t;gt.jsxs=$t;Ft.exports=gt;var e=Ft.exports,kt={},Nt=jt;kt.createRoot=Nt.createRoot,kt.hydrateRoot=Nt.hydrateRoot;function et(t){const n=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return t?`${t}-${n}`:n}const _t=f.createContext();function yt(t){if(typeof localStorage>"u")return null;try{const n=localStorage.getItem(t);return n==null?null:JSON.parse(n)}catch{return null}}function tt(t,n){if(!(typeof localStorage>"u"))try{localStorage.setItem(t,JSON.stringify(n))}catch{}}const lr=({children:t})=>{const[n,p]=f.useState({fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],currentEncounterName:"Encounter"}),[d,b]=f.useState(!1),[m,x]=f.useState({adversaries:[],environments:[]});f.useEffect(()=>{var h,a,v,R;const c=yt("daggerheart-game-state");if(c)try{(((h=c.adversaries)==null?void 0:h.length)>0||((a=c.environments)==null?void 0:a.length)>0||((v=c.countdowns)==null?void 0:v.length)>0||((R=c.savedEncounters)==null?void 0:R.length)>0)&&p(c)}catch(O){console.error("Failed to load saved state:",O)}const g=yt("daggerheart-custom-adversaries")||[],y=yt("daggerheart-custom-environments")||[];x({adversaries:g,environments:y}),b(!0)},[]),f.useEffect(()=>{tt("daggerheart-game-state",n)},[n]);const $=c=>{p(g=>({...g,fear:{...g.fear,value:c}}))},i=()=>{p(c=>({...c,fear:{...c.fear,visible:!c.fear.visible}}))},E=c=>{p(g=>({...g,partySize:Math.max(1,c)}))},H=c=>{p(g=>({...g,currentEncounterName:c||"Encounter"}))},W=c=>{if(c.id)return p(g=>({...g,savedEncounters:(g.savedEncounters||[]).map(y=>y.id===c.id?{...y,name:c.name||y.name,encounterItems:c.encounterItems||y.encounterItems,partySize:c.partySize||y.partySize,battlePointsAdjustments:c.battlePointsAdjustments||y.battlePointsAdjustments,updatedAt:new Date().toISOString()}:y)})),c.id;{const g={id:et("encounter"),name:c.name||"Encounter",createdAt:new Date().toISOString(),encounterItems:c.encounterItems||[],partySize:c.partySize||4,battlePointsAdjustments:c.battlePointsAdjustments||{}};return p(y=>({...y,savedEncounters:[...y.savedEncounters||[],g]})),g.id}},F=c=>(n.savedEncounters||[]).find(y=>y.id===c),C=c=>{const g={id:et("encounter"),name:c.name||`Encounter ${Date.now()}`,createdAt:new Date().toISOString(),encounterItems:c.encounterItems||[],partySize:c.partySize||4,battlePointsAdjustments:c.battlePointsAdjustments||{}};return p(y=>({...y,savedEncounters:[...y.savedEncounters||[],g]})),g.id},P=c=>{p(g=>({...g,savedEncounters:(g.savedEncounters||[]).filter(y=>y.id!==c)}))},Z=f.useRef(n);f.useEffect(()=>{Z.current=n},[n]);const Ve={gameState:n,isLoaded:d,customContent:m,updateFear:$,toggleFearVisibility:i,updatePartySize:E,updateCurrentEncounterName:H,saveEncounter:W,saveEncounterAs:C,loadEncounter:F,deleteEncounter:P,createCountdown:c=>{const g={id:et("countdown"),name:c.name||"Countdown",max:parseInt(c.max)||1,value:0,visible:!0,type:c.type||"standard",loop:c.loop||"none",source:c.source||"campaign"};p(y=>({...y,countdowns:[...y.countdowns,g]}))},updateCountdown:(c,g)=>{p(y=>({...y,countdowns:y.countdowns.map(h=>h.id===c?{...h,...g}:h)}))},deleteCountdown:c=>{p(g=>({...g,countdowns:g.countdowns.filter(y=>y.id!==c)}))},advanceCountdown:(c,g)=>{p(y=>({...y,countdowns:y.countdowns.map(h=>{if(h.id!==c)return h;let a=g;if(h.loop==="loop")a>h.max?a=(a-1)%h.max+1:a<0&&(a=h.max);else if(h.loop==="increasing"){if(a>h.max)return{...h,max:h.max+1,value:1};if(a<0)return{...h,max:Math.max(1,h.max-1),value:1};a=Math.max(0,a)}else if(h.loop==="decreasing"){if(a>h.max)return{...h,max:Math.max(1,h.max-1),value:1};if(a<0)return{...h,max:h.max+1,value:1};a=Math.min(h.max,a)}else a=Math.max(0,Math.min(a,h.max));return{...h,value:a}})}))},incrementCountdown:(c,g=1)=>{p(y=>({...y,countdowns:y.countdowns.map(h=>{if(h.id!==c)return h;let a=h.value+g;if(h.loop==="loop")a>h.max&&(a=(a-1)%h.max+1);else if(h.loop==="increasing"){if(a>h.max)return{...h,max:h.max+1,value:1}}else if(h.loop==="decreasing"){if(a>h.max)return{...h,max:Math.max(1,h.max-1),value:1}}else a=Math.min(a,h.max);return{...h,value:a}})}))},decrementCountdown:c=>{p(g=>({...g,countdowns:g.countdowns.map(y=>{if(y.id!==c)return y;let h=y.value-1;if(y.loop==="loop")h<0&&(h=y.max);else if(y.loop==="increasing"){if(h<0)return{...y,max:Math.max(1,y.max-1),value:y.max};h=Math.max(0,h)}else if(y.loop==="decreasing"){if(h<0)return{...y,max:y.max+1,value:1}}else h=Math.max(0,h);return{...y,value:h}})}))},reorderCountdowns:c=>{p(g=>{const[y,h]=c,a=[...g.countdowns],[v]=a.splice(y,1);return a.splice(h,0,v),{...g,countdowns:a}})},createAdversary:c=>{var O;const g=et("adv"),y=n.adversaries||[],h=c.baseName||((O=c.name)==null?void 0:O.replace(/\s+\(\d+\)$/,""))||c.name||"Unknown",a=y.filter(K=>K.baseName===h);let v=1;if(a.length===0)v=1;else{const K=a.map(Ne=>Ne.duplicateNumber||1);let fe=1;for(;K.includes(fe);)fe++;v=fe}const R={...c,id:g,baseName:h,duplicateNumber:v,name:`${h} (${v})`,hp:0,stress:0,isVisible:!0};p(K=>({...K,adversaries:[...K.adversaries,R]}))},createAdversariesBulk:c=>{const g=[],y={};c.forEach(h=>{var Be;const a=h.baseName||((Be=h.name)==null?void 0:Be.replace(/\s+\(\d+\)$/,""))||h.name||"Unknown",O=(n.adversaries||[]).filter(Ye=>Ye.baseName===a).length,K=y[a]||0,fe=O+K+1;y[a]=K+1;const Ne={...h,id:et("adv"),baseName:a,duplicateNumber:fe,name:`${a} (${fe})`,hp:0,stress:0,isVisible:!0};g.push(Ne)}),p(h=>({...h,adversaries:[...h.adversaries,...g]}))},updateAdversary:(c,g)=>{p(y=>({...y,adversaries:y.adversaries.map(h=>{if(h.id===c){const a={...h,...g};if(g.baseName!==void 0){const v=g.baseName,R=a.duplicateNumber||1;a.name=R===1?v:`${v} (${R})`}return a}return h})}))},deleteAdversary:c=>{p(g=>({...g,adversaries:g.adversaries.filter(y=>y.id!==c)}))},clearAllAdversaries:()=>{p(c=>({...c,adversaries:[]}))},reorderAdversaries:c=>{p(g=>{const[y,h]=c,a=[...g.adversaries],[v]=a.splice(y,1);return a.splice(h,0,v),{...g,adversaries:a}})},bulkReorderAdversaries:c=>{p(g=>({...g,adversaries:c}))},createEnvironment:c=>{const g=et("env"),h=(n.environments||[]).filter(R=>R.name.replace(/\s+\(\d+\)$/,"")===c.name);let a=c.name||"Unknown";if(h.length===0)a=c.name;else if(h.length===1){const R=h[0],O=R.name.replace(/\s+\(\d+\)$/,""),K=n.environments.map(fe=>fe.id===R.id?{...fe,name:`${O} (1)`}:fe);p(fe=>({...fe,environments:K})),a=`${c.name} (2)`}else{const R=h.map(K=>{const fe=K.name.match(/\((\d+)\)$/);return fe?parseInt(fe[1]):null}).filter(K=>K!==null);let O=1;for(;R.includes(O);)O++;a=`${c.name} (${O})`}const v={...c,id:g,name:a,isVisible:!0};p(R=>({...R,environments:[...R.environments,v]}))},updateEnvironment:(c,g)=>{p(y=>({...y,environments:y.environments.map(h=>h.id===c?{...h,...g}:h)}))},deleteEnvironment:c=>{p(g=>({...g,environments:g.environments.filter(y=>y.id!==c)}))},reorderEnvironments:c=>{p(g=>{const[y,h]=c,a=[...g.environments],[v]=a.splice(y,1);return a.splice(h,0,v),{...g,environments:a}})},addCustomAdversary:c=>{const g={...c,id:et("custom-adv"),source:c.source||"Homebrew",isCustom:!0};return x(y=>({...y,adversaries:[...y.adversaries,g]})),tt("daggerheart-custom-adversaries",[...m.adversaries,g]),g.id},addCustomEnvironment:c=>{const g={...c,id:et("custom-env"),source:c.source||"Homebrew",isCustom:!0};return x(y=>({...y,environments:[...y.environments,g]})),tt("daggerheart-custom-environments",[...m.environments,g]),g.id},updateCustomAdversary:(c,g)=>{x(h=>({...h,adversaries:h.adversaries.map(a=>a.id===c?{...a,...g}:a)}));const y=m.adversaries.map(h=>h.id===c?{...h,...g}:h);tt("daggerheart-custom-adversaries",y)},updateCustomEnvironment:(c,g)=>{x(h=>({...h,environments:h.environments.map(a=>a.id===c?{...a,...g}:a)}));const y=m.environments.map(h=>h.id===c?{...h,...g}:h);tt("daggerheart-custom-environments",y)},deleteCustomAdversary:c=>{x(y=>({...y,adversaries:y.adversaries.filter(h=>h.id!==c)}));const g=m.adversaries.filter(y=>y.id!==c);tt("daggerheart-custom-adversaries",g)},deleteCustomEnvironment:c=>{x(y=>({...y,environments:y.environments.filter(h=>h.id!==c)}));const g=m.environments.filter(y=>y.id!==c);tt("daggerheart-custom-environments",g)}};return e.jsx(_t.Provider,{value:Ve,children:t})},Et=()=>{const t=f.useContext(_t);if(!t)return console.warn("useGameState: Context not available yet, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{gameState:n,customContent:p,...d}=t;if(!n)return console.warn("useGameState: gameState not available, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],customContent:{adversaries:[],environments:[]},updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},addCustomAdversary:()=>{},addCustomEnvironment:()=>{},updateCustomAdversary:()=>{},updateCustomEnvironment:()=>{},deleteCustomAdversary:()=>{},deleteCustomEnvironment:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{fear:b,countdowns:m,adversaries:x,environments:$,partySize:i,savedEncounters:E}=n;return{gameState:n,fear:b,countdowns:m,adversaries:x,environments:$,partySize:i,savedEncounters:E,customContent:p,...d,hasCountdowns:m.length>0,hasAdversaries:x.length>0,hasEnvironments:$.length>0,getCountdownById:H=>m.find(W=>W.id===H),getAdversaryById:H=>x.find(W=>W.id===H),getEnvironmentById:H=>$.find(W=>W.id===H)}},Wt={fear:{icon:Kt,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"0.125rem",maxWidth:"none"},pipStyle:{fontSize:"var(--text-lg)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0,imageRendering:"crisp-edges"},filledColor:"var(--purple)",emptyColor:"var(--gray-dark)",tooltipTitle:"Click anywhere in header to adjust fear:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease fear by 1"},{text:"Right of boundary:",description:"Click to increase fear by 1"}]},hp:{icon:Yt,maxValue:20,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stress:{icon:Jt,maxValue:12,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},countdown:{icon:zt,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust countdown:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease countdown by 1"},{text:"Right of boundary:",description:"Click to increase countdown by 1"}]},hpDots:{maxValue:20,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--red)",borderColor:"var(--red)",boxShadow:"0 0 4px rgba(239, 68, 68, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stressDots:{maxValue:12,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--purple)",borderColor:"var(--purple)",boxShadow:"0 0 4px rgba(139, 92, 246, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},adversaryHP:{icon:Ot,maxValue:20,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust HP:",tooltipInstructions:[{text:"Filled pip:",description:"Click to heal (reduce damage)"},{text:"Empty pip:",description:"Click to take damage"}]},adversaryStress:{icon:Xt,maxValue:12,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust stress:",tooltipInstructions:[{text:"Filled pip:",description:"Click to reduce stress"},{text:"Empty pip:",description:"Click to increase stress"}]},countdownDistributed:{icon:zt,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Countdown progress:",tooltipInstructions:[{text:"Progress:",description:"Current countdown value"}]}},it=({type:t="fear",value:n=0,maxValue:p,onChange:d,size:b="lg",showTooltip:m=!0,containerStyle:x={},pipStyle:$={},countdownType:i=null,distributedGroups:E=null,onPipClick:H=null,enableBoundaryClick:W=!1,clickContainerWidth:F="auto",centerPips:C=!0})=>{const[P,Z]=f.useState(!1),_=Wt[t]||Wt.fear,G=p||_.maxValue,Q=Math.max(0,Math.min(G,n));let re=_.filledColor;t==="countdown"&&i&&(["progress","dynamic-progress","simple-hope"].includes(i)?re="var(--gold)":["consequence","dynamic-consequence","simple-fear"].includes(i)?re="var(--purple)":["long-term","standard"].includes(i)&&(re="var(--text-secondary)"));const ne=(q,he)=>{if(H)H(q,he);else if(d){const Ae=q+1;d(Ae)}},Te=q=>{if(!W||!d||H)return;q.currentTarget.getBoundingClientRect();const he=q.currentTarget.querySelector(".pip-container");if(!he)return;const Ae=he.getBoundingClientRect(),ce=q.clientX-Ae.left;if(ce<0){Q>0&&d(Q-1);return}if(ce>Ae.width){Q<G&&d(Q+1);return}const M=Ae.width,w=M*.05,U=M-2*w,X=ce-w,V=Q/G,je=U*V;X<je?Q>0&&d(Q-1):Q<G&&d(Q+1)},Oe=(()=>{if(!E||t!=="countdownDistributed")return[{start:0,end:G,groupIndex:0}];let q=0;return E.map((he,Ae)=>{const ce={start:q,end:q+he,groupIndex:Ae};return q+=he,ce})})(),se=()=>e.jsxs(e.Fragment,{children:[Oe.map(q=>e.jsx(rt.Fragment,{children:[...Array(q.end-q.start)].map((he,Ae)=>{const ce=q.start+Ae,M=ce<Q;if(_.isDots)return e.jsx("div",{style:{..._.pipStyle,...M?_.filledStyle:_.emptyStyle,...$,cursor:d||H?"pointer":"default"},onClick:W?void 0:()=>ne(ce,M),title:`${ce+1} of ${G}`},ce);{const w=_.icon,U=w&&typeof w=="object"&&w.iconName,X=M?re:_.emptyColor;return e.jsx("span",{className:`fear-pip ${M?"filled":"empty"}`,style:{..._.pipStyle,color:X,cursor:d||H?"pointer":"default",...$},onClick:W?void 0:()=>ne(ce,M),title:`${ce+1} of ${G}`,children:U?e.jsx(Gt,{icon:w,size:b}):e.jsx(w,{size:b==="lg"?18:16})},ce)}})},q.groupIndex)),m&&e.jsx("div",{style:{position:"relative",cursor:"help",pointerEvents:"none"},children:e.jsxs("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:P?"translateX(-50%) translateY(-5px)":"translateX(-50%)",background:"rgba(15, 23, 42, 0.95)",border:"1px solid var(--gray)",borderRadius:"var(--radius-md)",padding:"var(--space-md)",minWidth:"250px",zIndex:1e3,opacity:P?1:0,visibility:P?"visible":"hidden",transition:"all 0.2s ease",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.5)"},children:[e.jsx("div",{style:{fontWeight:600,color:"var(--gray-200)",marginBottom:"0.75rem",fontSize:"var(--text-sm)"},children:_.tooltipTitle}),_.tooltipInstructions.map((q,he)=>e.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.8rem",color:"var(--gray-300)",lineHeight:1.4},children:[e.jsx("strong",{style:{color:"var(--gray-200)"},children:q.text})," ",q.description]},he))]})})]});return e.jsx("div",{style:{width:F,height:"100%",cursor:d||H?"pointer":"default",touchAction:"manipulation",userSelect:"none",display:C?"flex":"block",alignItems:C?"center":"stretch",justifyContent:C?"center":"flex-start",...x},onClick:q=>{q.stopPropagation(),q.preventDefault(),W&&Te(q)},onMouseEnter:()=>Z(m),onMouseLeave:()=>Z(!1),children:e.jsx("div",{className:"pip-container",style:{..._.containerStyle,width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},children:se()})})},dr=({position:t="top",children:n,onClick:p,className:d="",style:b={}})=>{const m=t==="top",x=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://"),$={background:"var(--bg-primary)",borderTop:m?"none":"1px solid var(--border)",borderBottom:m?"1px solid var(--border)":"none",padding:m?"0.25rem 0":"0.5rem",paddingBottom:m?"0.25rem":x?"calc(0.5rem + env(safe-area-inset-bottom) + 1rem)":"calc(0.5rem + env(safe-area-inset-bottom))",position:m?"relative":"sticky",[m?"top":"bottom"]:0,zIndex:m?10:100,order:m?1:3,flexShrink:0,touchAction:"manipulation",userSelect:"none",display:"flex",flexDirection:m?"column":"row",justifyContent:m?"stretch":"center",alignItems:m?"stretch":"center",gap:m?"0":"1rem",height:m?"auto":"60px",...b};return e.jsx("div",{className:d,style:$,onClick:p,children:n})},vt=52,It=({tabContent:t,children:n,containerStyle:p={},tabStyle:d={},showTab:b=!0,tabBackgroundColor:m="var(--bg-primary)",tabBorderColor:x="var(--border)",tabJustifyContent:$="center",containerBackgroundColor:i,containerBorderColor:E,containerBorderRadius:H="8px",containerBoxShadow:W,containerOverflow:F="hidden",reserveTabSpace:C=!1,style:P={},...Z})=>{const _={display:"flex",flexDirection:"column",position:"relative",height:"100%",width:"100%",borderRadius:H,overflow:F};i&&(_.backgroundColor=i),E&&(_.border=`2px solid ${E}`),W&&(_.boxShadow=W);const G={position:"relative",overflow:"visible",height:"100%",width:"100%",display:"flex",flexDirection:"column",boxSizing:"border-box"},Q=C?"0":`-${vt}px`,re=C&&b&&t?`${vt}px`:"0";return e.jsxs("div",{style:{...G,...P},...Z,children:[b&&t&&e.jsx("div",{style:{position:"absolute",top:Q,left:"7px",right:"7px",width:"calc(100% - 14px)",display:"flex",alignItems:"center",gap:"0.5rem",justifyContent:$,flexShrink:0,zIndex:0,padding:"0.5rem 0.75rem",paddingBottom:"calc(0.5rem + 4px)",minHeight:`${vt}px`,backgroundColor:m,border:`1.5px solid ${x}`,borderBottom:"none",borderRadius:"8px 8px 0 0",boxSizing:"border-box",marginBottom:"-4px",...d},children:t}),e.jsx("div",{style:{..._,...p,zIndex:1,marginTop:re},children:n})]})},cr="modulepreload",ur=function(t){return"/Daggerheart/"+t},Lt={},st=function(n,p,d){if(!p||p.length===0)return n();const b=document.getElementsByTagName("link");return Promise.all(p.map(m=>{if(m=ur(m),m in Lt)return;Lt[m]=!0;const x=m.endsWith(".css"),$=x?'[rel="stylesheet"]':"";if(!!d)for(let H=b.length-1;H>=0;H--){const W=b[H];if(W.href===m&&(!x||W.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${m}"]${$}`))return;const E=document.createElement("link");if(E.rel=x?"stylesheet":cr,x||(E.as="script",E.crossOrigin=""),E.href=m,document.head.appendChild(E),x)return new Promise((H,W)=>{E.addEventListener("load",H),E.addEventListener("error",()=>W(new Error(`Unable to preload CSS for ${m}`)))})})).then(()=>n()).catch(m=>{const x=new Event("vite:preloadError",{cancelable:!0});if(x.payload=m,window.dispatchEvent(x),!x.defaultPrevented)throw m})},Bt={Minion:{difficulty:t=>[9,12,15,18][t-1],thresholds:t=>({major:0,severe:0}),hpMax:t=>1,stressMax:t=>1,atk:t=>[-1,0,1,2][t-1],damage:t=>["2","5","8","11"][t-1],range:"Melee"},Standard:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[7,10,20,25][t-1],severe:[12,20,32,45][t-1]}),hpMax:t=>[4,5,6,7][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[1,2,3,4][t-1],damage:t=>["1d8+1","2d8+2","3d8+3","4d8+4"][t-1],range:"Melee"},Bruiser:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[8,14,22,38][t-1],severe:[15,28,40,70][t-1]}),hpMax:t=>[6,7,8,9][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[-1,0,1,2][t-1],damage:t=>["1d12+2","2d12+4","3d12+6","4d12+8"][t-1],range:"Melee"},Horde:{difficulty:t=>[10,13,16,19][t-1],thresholds:t=>({major:[7,10,20,25][t-1],severe:[12,20,32,45][t-1]}),hpMax:t=>[5,6,7,8][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[-1,0,1,2][t-1],damage:t=>["1d8+2","2d8+4","3d8+6","4d8+8"][t-1],range:"Melee"},Leader:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[7,13,21,35][t-1],severe:[14,26,38,65][t-1]}),hpMax:t=>[5,6,7,8][t-1],stressMax:t=>[5,5,6,6][t-1],atk:t=>[2,4,6,8][t-1],damage:t=>["1d10+2","2d10+4","3d10+6","4d10+8"][t-1],range:"Melee"},Ranged:{difficulty:t=>[10,13,16,19][t-1],thresholds:t=>({major:[4,8,18,22][t-1],severe:[7,16,30,42][t-1]}),hpMax:t=>[3,4,5,6][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d8+2","2d8+4","3d8+6","4d8+8"][t-1],range:"Close"},Skulk:{difficulty:t=>[12,15,18,21][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,5,6,7][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d6+2","2d6+4","3d6+6","4d6+8"][t-1],range:"Melee"},Solo:{difficulty:t=>[12,15,18,21][t-1],thresholds:t=>({major:[7,13,21,35][t-1],severe:[14,26,38,65][t-1]}),hpMax:t=>[8,9,10,11][t-1],stressMax:t=>[5,5,6,6][t-1],atk:t=>[3,5,7,9][t-1],damage:t=>["1d10+3","2d10+6","3d10+9","4d10+12"][t-1],range:"Melee"},Support:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,4,5,5][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d4+2","2d4+4","3d4+6","4d4+8"][t-1],range:"Melee"},Social:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,4,5,5][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d4+2","2d4+4","3d4+6","4d4+8"][t-1],range:"Melee"}},lt=(t,n)=>{const p=Bt[n]||Bt.Standard;return{difficulty:p.difficulty(t),thresholds:p.thresholds(t),hpMax:p.hpMax(t),stressMax:p.stressMax(t),atk:p.atk(t),damage:p.damage(t),range:p.range}};let qt={adversaries:[]},Ht=!1;const pr=()=>({customAdversaries:JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]")}),mr=async()=>{if(Ht)return;let t={adversaries:[]},n={adversaries:[]};try{const d=await st(()=>import("./adversaries-9c8932de.js"),[]);t=(d==null?void 0:d.default)||d}catch(d){console.warn("Failed to load adversaries.json:",d)}try{const d=await st(()=>import("./playtest-adversaries-4a099c10.js"),[]);n=(d==null?void 0:d.default)||d}catch(d){console.warn("Failed to load playtest-adversaries.json:",d)}const{customAdversaries:p}=pr();qt={...t,adversaries:[...t.adversaries||[],...n.adversaries||[],...p]},Ht=!0},Mt=f.forwardRef(({onSave:t,onRefresh:n,onAddItem:p,editingAdversary:d,onCancelEdit:b,isStockAdversary:m=!1,autoFocus:x=!1,allAdversaries:$=[],embedded:i=!1,hideEmbeddedButtons:E=!1},H)=>{const W=f.useRef(null),F=f.useRef(null),[C,P]=f.useState(()=>{const M=lt(1,"Standard");return{name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:M.difficulty,thresholds:M.thresholds,hpMax:M.hpMax,stressMax:M.stressMax,atk:M.atk,weapon:"",range:M.range,damage:M.damage,experience:[],features:[]}}),[Z,_]=f.useState(!1),[G,Q]=f.useState(!1),[re,ne]=f.useState([]),[Te,ze]=f.useState(!1),[Oe,se]=f.useState([]);f.useEffect(()=>{(async()=>{await mr(),$.length>0?se($):se(qt.adversaries||[])})()},[$]),f.useEffect(()=>{x&&setTimeout(()=>{var M,w,U;d&&F.current?((M=F.current)==null||M.focus(),(w=F.current)==null||w.select()):W.current&&((U=W.current)==null||U.focus())},650)},[x,d]),f.useEffect(()=>{var M;if(d){const w=d.baseName||((M=d.name)==null?void 0:M.replace(/\s+\(\d+\)$/,""))||d.name||"";P({name:w,tier:d.tier||1,type:d.type||"Standard",description:d.description||"",motives:d.motives||"",difficulty:d.difficulty||11,thresholds:d.thresholds||{major:7,severe:12},hpMax:d.hpMax||3,stressMax:d.stressMax||1,atk:d.atk||1,weapon:d.weapon||"",range:d.range||"Melee",damage:d.damage||"",experience:d.experience||[],features:d.features||[]}),Q(!1)}else{const w=lt(1,"Standard");P({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:w.difficulty,thresholds:w.thresholds,hpMax:w.hpMax,stressMax:w.stressMax,atk:w.atk,weapon:"",range:w.range,damage:w.damage,experience:[],features:[]}),Q(!1)}},[d]),f.useEffect(()=>{if(!d&&!G){const M=lt(C.tier,C.type);P(w=>({...w,difficulty:M.difficulty,thresholds:M.thresholds,hpMax:M.hpMax,stressMax:M.stressMax,atk:M.atk,range:M.range,damage:M.damage}))}},[C.tier,C.type,d,G]);const q=M=>{if(P(w=>({...w,name:M})),M.trim().length>0){const w=Oe.filter(U=>{var V;return(((V=U.name)==null?void 0:V.replace(/\s+\(\d+\)$/,""))||U.name||"").toLowerCase().includes(M.toLowerCase())}).slice(0,5);ne(w),ze(w.length>0)}else ne([]),ze(!1)},he=async()=>{if(!C.name.trim()){alert("Please enter a name for the adversary");return}_(!0);try{const M=V=>(V||[]).filter(je=>je.name&&je.name.trim()!==""||je.modifier!==void 0&&je.modifier!==0),w=C.name.trim()||"Unknown",U=M(C.experience||[]),X={...C,experience:U,baseName:w,name:w,hp:d?d.hp:0,stress:d?d.stress:0,source:"Homebrew"};if(d){if(m){const{id:V,name:je,...te}=X;await t(te),alert("Custom adversary created successfully!")}else{const V={...X,name:X.baseName};await t(V,d.id),alert("Adversary updated successfully!")}b&&b()}else{await t(X),n&&await n();const V=lt(1,"Standard");P({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:V.difficulty,thresholds:V.thresholds,hpMax:V.hpMax,stressMax:V.stressMax,atk:V.atk,weapon:"",range:V.range,damage:V.damage,experience:[],features:[]}),Q(!1),alert("Custom adversary created successfully!")}}catch(M){console.error("Error saving adversary:",M),alert("Error saving adversary. Please try again.")}finally{_(!1)}};f.useImperativeHandle(H,()=>({handleSave:he,isSaving:Z,canSave:C.name.trim().length>0}));const Ae={...C,id:"new-adversary",hp:0,stress:0,source:"Homebrew"},ce=()=>Z?d?m?"Creating...":"Saving...":"Creating...":d?m?"Save As Custom":"Save":"Create";return e.jsxs(e.Fragment,{children:[!i&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h2",{style:{color:"var(--text-primary)",fontSize:"1.5rem",fontWeight:"600",margin:0},children:d?m?"Edit Adversary (Save As Custom)":"Edit Custom Adversary":"Create Custom Adversary"}),e.jsx("button",{onClick:he,disabled:Z||!C.name.trim(),style:{padding:"0.75rem 1.5rem",backgroundColor:Z||!C.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"8px",cursor:Z||!C.name.trim()?"not-allowed":"pointer",fontSize:"1rem",fontWeight:"600",opacity:Z||!C.name.trim()?.6:1},children:ce()})]}),i&&!E&&e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",marginBottom:"0.5rem",padding:"0.5rem",borderBottom:"1px solid var(--border)"},children:[e.jsx("button",{onClick:he,disabled:Z||!C.name.trim(),style:{padding:"0.5rem 1rem",backgroundColor:Z||!C.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"6px",cursor:Z||!C.name.trim()?"not-allowed":"pointer",fontSize:"0.875rem",fontWeight:"600",opacity:Z||!C.name.trim()?.6:1,marginRight:"0.5rem"},children:ce()}),b&&e.jsx("button",{onClick:b,style:{padding:"0.5rem 1rem",backgroundColor:"transparent",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"6px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600"},children:"Cancel"})]}),!d&&e.jsxs("div",{style:{marginBottom:"1rem",position:"relative"},children:[e.jsx("input",{ref:W,type:"text",value:C.name,onChange:M=>{const w=M.target.value;P(U=>({...U,name:w})),q(w)},placeholder:"Adversary name",style:{width:"100%",padding:"0.75rem",border:"1px solid var(--border)",borderRadius:"8px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"1rem",outline:"none"}}),Te&&re.length>0&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"0 0 8px 8px",borderTop:"none",maxHeight:"200px",overflowY:"auto",zIndex:1e3,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)"},children:re.map((M,w)=>{var X;const U=M.baseName||((X=M.name)==null?void 0:X.replace(/\s+\(\d+\)$/,""))||M.name;return e.jsxs("div",{onClick:()=>{P(V=>({...V,name:U,tier:M.tier||V.tier,type:M.type||V.type,difficulty:M.difficulty||V.difficulty,thresholds:M.thresholds||V.thresholds,hpMax:M.hpMax||V.hpMax,stressMax:M.stressMax||V.stressMax,atk:M.atk||V.atk,range:M.range||V.range,damage:M.damage||V.damage})),ze(!1),Q(!0),W.current&&W.current.blur()},style:{padding:"0.75rem",cursor:"pointer",borderBottom:w<re.length-1?"1px solid var(--border)":"none",transition:"background-color 0.2s"},onMouseEnter:V=>{V.target.style.backgroundColor="var(--bg-secondary)"},onMouseLeave:V=>{V.target.style.backgroundColor="transparent"},onMouseDown:V=>V.preventDefault(),children:[e.jsx("div",{style:{fontWeight:"600"},children:U}),e.jsxs("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",marginTop:"2px"},children:[M.type," • Tier ",M.tier]})]},w)})})]}),e.jsx(ht,{item:Ae,type:"adversary",mode:"edit",nameInputRef:d?F:void 0,autoFocusNameInput:x&&d,onUpdate:(M,w)=>{P(U=>({...U,...w}))}})]})});Mt.displayName="CustomAdversaryCreator";const Dt=({value:t})=>e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"44px",height:"32px",zIndex:3},children:[e.jsx("svg",{width:"40",height:"32",viewBox:"0 0 40 32",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",style:{position:"absolute",zIndex:1},children:e.jsx("path",{d:"M2 2h28l6 14-6 14H2l6-14-6-14z"})}),e.jsx("span",{style:{position:"absolute",fontSize:"0.8rem",fontWeight:500,color:"var(--text-primary)",textAlign:"center",zIndex:2,left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:t})]}),fr=({type:t,tier:n,isEditMode:p,onUpdate:d,itemId:b})=>{const x=(W=>{if(!W)return 0;const C=document.createElement("canvas").getContext("2d");return C.font="600 11px system-ui, -apple-system, sans-serif",C.measureText(W.toUpperCase()).width})(t),$=4,i=18,E=Math.max(50,x+$+i),H=E+15;return p?e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",gap:"8px",height:"32px"},children:[e.jsxs("select",{value:t||"",onChange:W=>{d&&d(b,{type:W.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",outline:"none",borderRadius:"4px",padding:"4px 8px",width:"95px",height:"24px"},children:[e.jsx("option",{value:"Standard",children:"Standard"}),e.jsx("option",{value:"Solo",children:"Solo"}),e.jsx("option",{value:"Bruiser",children:"Bruiser"}),e.jsx("option",{value:"Horde",children:"Horde"}),e.jsx("option",{value:"Minion",children:"Minion"}),e.jsx("option",{value:"Ranged",children:"Ranged"}),e.jsx("option",{value:"Leader",children:"Leader"}),e.jsx("option",{value:"Skulk",children:"Skulk"}),e.jsx("option",{value:"Social",children:"Social"}),e.jsx("option",{value:"Support",children:"Support"})]}),e.jsxs("div",{style:{position:"relative",width:"24px",height:"24px"},children:[e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",width:"20px",height:"20px",backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",borderRadius:"2px"}}),e.jsx("input",{type:"text",value:n||"",onChange:W=>{const F=W.target.value.replace(/[^1-4]/g,"");F.length<=1&&d&&d(b,{tier:F===""?"":parseInt(F)})},onKeyDown:W=>{if(W.key==="ArrowUp"){W.preventDefault();const F=parseInt(n)||1;d&&d(b,{tier:Math.min(F+1,4)})}else if(W.key==="ArrowDown"){W.preventDefault();const F=parseInt(n)||1;d&&d(b,{tier:Math.max(F-1,1)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"transparent",border:"none",color:"var(--text-primary)",fontSize:"0.8rem",fontWeight:600,width:"24px",height:"24px",textAlign:"center",outline:"none",zIndex:1},maxLength:"1"})]})]}):e.jsxs("div",{style:{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"center",height:"32px",width:`${H}px`},children:[e.jsxs("svg",{width:H,height:"32",viewBox:`0 0 ${H} 32`,style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1},children:[e.jsx("rect",{x:"1",y:"6",width:E-1,height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4",ry:"4"}),e.jsx("rect",{x:E-10,y:"6",width:"20",height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"2",ry:"2",transform:`rotate(45 ${E-1} 16)`})]}),e.jsx("span",{style:{position:"absolute",top:"50%",left:"4px",transform:"translateY(-50%)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",color:"var(--text-primary)",zIndex:2,pointerEvents:"none"},children:t}),e.jsx("span",{style:{position:"absolute",top:"50%",left:`${E-.5}px`,transform:"translate(-50%, -50%)",fontSize:"0.8rem",fontWeight:600,color:"white",zIndex:2,pointerEvents:"none",textAlign:"center",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",width:"20px",height:"20px"},children:n})]})},bt=({feature:t,featureType:n,item:p,onUpdate:d,handleFeatureDeleteClick:b,deleteConfirmations:m,getFeatureKey:x})=>{var W,F;const $=()=>{try{const P=[...(p==null?void 0:p.features)||[]],Z=P.filter(G=>G.type===n),_=Z.findIndex(G=>G===t);if(_>0&&_<Z.length){const G=Z[_],Q=Z[_-1];if(G&&Q){const re=P.findIndex(Te=>Te===G),ne=P.findIndex(Te=>Te===Q);re>=0&&ne>=0&&(P[re]=Q,P[ne]=G,d&&d(p.id,{features:P}))}}}catch(C){console.error(`Error in ${n.toLowerCase()} up button:`,C)}},i=()=>{try{const P=[...(p==null?void 0:p.features)||[]],Z=P.filter(G=>G.type===n),_=Z.findIndex(G=>G===t);if(_<Z.length-1&&_>=0){const G=Z[_],Q=Z[_+1];if(G&&Q){const re=P.findIndex(Te=>Te===G),ne=P.findIndex(Te=>Te===Q);re>=0&&ne>=0&&(P[re]=Q,P[ne]=G,d&&d(p.id,{features:P}))}}}catch(C){console.error(`Error in ${n.toLowerCase()} down button:`,C)}},E=C=>C.type===n,H=C=>C.type===n&&C.name.trim();return e.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",alignSelf:"stretch"},children:[e.jsx("button",{onClick:$,disabled:(p.features||[]).filter(E).findIndex(C=>C===t)===0,tabIndex:"-1",style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(p.features||[]).filter(H).length>=2&&(p.features||[]).filter(E).findIndex(C=>C===t)!==0&&t.name.trim()?"white":"var(--text-secondary)",cursor:(p.features||[]).filter(H).length>=2&&(p.features||[]).filter(E).findIndex(C=>C===t)!==0&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↑"}),e.jsx("button",{onClick:()=>b(t),disabled:!t.name.trim()&&!t.description.trim(),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:m[x(t)]?"var(--danger)":"var(--gray-700)",color:!t.name.trim()&&!t.description.trim()?"var(--text-secondary)":"white",cursor:!t.name.trim()&&!t.description.trim()?"not-allowed":"pointer",opacity:!t.name.trim()&&!t.description.trim()?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"×"}),e.jsx("button",{onClick:i,disabled:(p.features||[]).filter(E).findIndex(C=>C===t)===(p.features||[]).filter(E).length-1,style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(p.features||[]).filter(H).length>=2&&(p.features||[]).filter(E).findIndex(C=>C===t)<(p.features||[]).filter(E).length-1&&((W=(p.features||[]).filter(E)[(p.features||[]).filter(E).findIndex(C=>C===t)+1])!=null&&W.name.trim())&&t.name.trim()?"white":"var(--text-secondary)",cursor:(p.features||[]).filter(H).length>=2&&(p.features||[]).filter(E).findIndex(C=>C===t)<(p.features||[]).filter(E).length-1&&((F=(p.features||[]).filter(E)[(p.features||[]).filter(E).findIndex(C=>C===t)+1])!=null&&F.name.trim())&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↓"})]})},qe={transitions:{hoverIn:"all 0.1s ease",hoverOut:"all 0.3s ease"},card:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"8px",cursor:"pointer",transition:"all 0.1s ease",position:"relative",border:"none"},cardHover:{backgroundColor:"var(--bg-card-hover)"},cardDead:{opacity:.6,backgroundColor:"var(--gray-800)",borderColor:"var(--border)"},cardAtMax:{backgroundColor:"var(--success)",borderColor:"var(--success)"},rowMain:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},rowTitle:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",margin:0},rowMeta:{display:"flex",gap:"8px",alignItems:"center"},badge:{padding:"2px 6px",borderRadius:"3px",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},typeBadge:{backgroundColor:"var(--purple)",color:"var(--text-primary)"},tierBadge:{backgroundColor:"var(--info)",color:"var(--text-primary)"},damageInputPopup:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,borderRadius:"8px"},damageInputContent:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"8px",padding:"8px",display:"flex",flexDirection:"row",gap:"8px",minWidth:"200px",alignItems:"center",position:"absolute",right:"1rem",top:"50%",transform:"translateY(-50%)"},damageInput:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"4px",padding:"4px 6px",color:"var(--text-primary)",fontSize:"16px",width:"80px",textAlign:"center"},damageIndicators:{display:"flex",gap:"8px",alignItems:"center",justifyContent:"center"},damageDrop:{fontSize:"16px",color:"var(--text-secondary)",cursor:"pointer",transition:"color 0.1s ease"},applyButton:{backgroundColor:"var(--gray-600)",color:"white",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"32px",minHeight:"32px"}},hr=(t,n,p,d)=>{const[b,m]=f.useState(!1),[x,$]=f.useState("");f.useEffect(()=>{if(b){const C=P=>{P.target.closest(".damage-input-popup")||(m(!1),$(""))};return document.addEventListener("click",C),()=>document.removeEventListener("click",C)}},[b]);const i=C=>{C.stopPropagation(),C.preventDefault();const P=t.hp||0,Z=t.hpMax||1,_=C.currentTarget.getBoundingClientRect(),G=C.clientX-_.left,Q=_.width/Z;Math.floor(G/Q)<P?p&&p(t.id,1,t.hp):n&&n(t.id,1,t.hp,t.hpMax)},E=C=>{C.stopPropagation(),C.preventDefault();const P=t.stress||0,Z=t.stressMax||1,_=C.currentTarget.getBoundingClientRect(),G=C.clientX-_.left,Q=_.width/Z;Math.floor(G/Q)<P?d&&d(t.id,-1,t.stress,t.stressMax):d&&d(t.id,1,t.stress,t.stressMax)},H=C=>{C.stopPropagation(),(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")&&(m(!0),$(t.type==="Minion"?"1":""))},W=()=>{const C=parseInt(x);if(C>0){if(t.type==="Minion")n&&n(t.id,C,t.hp,t.hpMax);else{let P=0;C>=t.thresholds.severe?P=3:C>=t.thresholds.major?P=2:C>=1&&(P=1),n&&n(t.id,P,t.hp,t.hpMax)}m(!1),$("")}};return{showDamageInput:b,damageValue:x,setDamageValue:$,setShowDamageInput:m,handleHpClick:i,handleStressClick:E,handleDifficultyClick:H,applyDamage:W,handleKeyDown:C=>{C.key==="Enter"?W():C.key==="Escape"&&(m(!1),$(""))}}},xr=({item:t,type:n,mode:p="expanded",onClick:d,onDelete:b,onApplyDamage:m,onApplyHealing:x,onApplyStressChange:$,onUpdate:i,adversaries:E=[],isSelected:H=!1,isEditMode:W=!1,instances:F=[],isEmbedded:C=!1,showAddRemoveButtons:P=!1,onAddInstance:Z=null,onRemoveInstance:_=null,onEdit:G=null,showCustomCreator:Q=!1,onSaveCustomAdversary:re=null,onCancelEdit:ne=null,isStockAdversary:Te=!1})=>{const ze=f.useRef(null),Oe=f.useRef(F.length),se=f.useRef(null),q=f.useRef(null),he=f.useRef(null),Ae=f.useRef(null),ce=f.useRef(null);f.useEffect(()=>{const a=ze.current;if(!a)return;const v=()=>{se.current=a.scrollHeight,q.current=a.scrollTop};a.addEventListener("scroll",v,{passive:!0});const R=setInterval(v,100);return()=>{a.removeEventListener("scroll",v),clearInterval(R)}},[]),f.useEffect(()=>()=>{ze.current&&(se.current=ze.current.scrollHeight,q.current=ze.current.scrollTop)},[F.length,F]);const[M,w]=f.useState({});f.useEffect(()=>{if(Q&&Ae.current){const a=setTimeout(()=>{var v,R;(v=Ae.current)==null||v.focus(),(R=Ae.current)==null||R.select()},650);return()=>clearTimeout(a)}},[Q]),f.useLayoutEffect(()=>{const a=F.length,v=Oe.current;if(a!==v&&ze.current){const R=se.current,O=q.current;if(!R||O===null){Oe.current=a;return}const K=ze.current,fe=K.scrollHeight,Ne=K.clientHeight;if(!(a<v)){if(a>v){const Be=fe-Ne,Ye=K.scrollTop,o=Be-Ye;if(Math.abs(o)>.5){he.current&&(cancelAnimationFrame(he.current),he.current=null);const I=400,r=performance.now(),T=ae=>{if(!K){he.current=null;return}const D=ae-r,Y=Math.min(D/I,1),u=1-Y,j=1-u*u*u,S=Ye+o*j;K.scrollTop=S,Y<1?he.current=requestAnimationFrame(T):(K.scrollTop=Be,he.current=null)};he.current=requestAnimationFrame(T)}}}Oe.current=a}else Oe.current=a},[F.length,F]);const U=a=>{const R=(t.features||[]).filter(O=>O.type===a.type).findIndex(O=>O===a);return`${a.type}-${R}-${a.name||"blank"}`},X=(a,v)=>`experience-${v}-${typeof a=="string"?a:a.name||"blank"}`,V=a=>!a||!Array.isArray(a)?[]:a.filter(v=>{if(typeof v=="string")return v.trim().length>0;const R=v.name||"",O=v.modifier||0;return R.trim().length>0||O>0}),je=a=>{const v=U(a);if(M[v]){const R=t.features.filter(O=>O!==a);i&&i(t.id,{features:R}),w(O=>{const K={...O};return delete K[v],K})}else w(R=>({...R,[v]:!0})),setTimeout(()=>{w(R=>{const O={...R};return delete O[v],O})},3e3)},te=(a,v)=>{const R=X(a,v);if(M[R]){const O=[...t.experience||[]];O.splice(v,1);const K=V(O);i&&i(t.id,{experience:K}),w(fe=>{const Ne={...fe};return delete Ne[R],Ne})}else w(O=>({...O,[R]:!0})),setTimeout(()=>{w(O=>{const K={...O};return delete K[R],K})},3e3)},N=hr(t,m,x,$);(n==="adversary"||n==="adversaries")&&N.handleDifficultyClick;const ue=(a=!1)=>{let v={...qe.card};if(H?v.transition="none":v.transition=qe.transitions.hoverOut,a){const{marginTop:R,...O}=v;v=O}return H&&(v={...v,...qe.cardHover}),n==="adversary"&&(t.hp||0)>=(t.hpMax||1)&&(v={...v,...qe.cardDead}),v},ye=()=>{if(C)return"";let a="border rounded-lg";return H&&(a+=" border-hover"),a},Re=()=>{var a;if(n==="adversary"||n==="adversaries"){const v=t.baseName||((a=t.name)==null?void 0:a.replace(/\s+\(\d+\)$/,""))||"",R=t.duplicateNumber||1,O=[...E];return E.some(Ne=>Ne.id===t.id)||O.push(t),O.filter(Ne=>Ne.baseName===v).length>1?`${v} (${R})`:v}return t.name},Ve=()=>{const a=[];return t.type&&a.push(e.jsx("span",{style:{...qe.badge,...qe.typeBadge},children:t.type},"type")),a},c=()=>n!=="adversary"||!N.showDamageInput||!(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")?null:e.jsx("div",{className:"damage-input-popup",style:qe.damageInputPopup,onClick:a=>{a.stopPropagation(),a.target===a.currentTarget&&(n==="adversary"||n==="adversaries")&&(N.setShowDamageInput(!1),N.setDamageValue(""))},children:e.jsxs("div",{className:"border rounded-lg",style:{...qe.damageInputContent,borderColor:"var(--border)"},onClick:a=>a.stopPropagation(),children:[e.jsx("input",{type:"number",inputMode:"numeric",enterKeyHint:"done",placeholder:"dmg",min:(t.type==="Minion","0"),value:n==="adversary"||n==="adversaries"?N.damageValue:"",onChange:a=>{(n==="adversary"||n==="adversaries")&&N.setDamageValue(a.target.value)},onKeyDown:n==="adversary"||n==="adversaries"?N.handleKeyDown:void 0,className:"border rounded-sm",style:{...qe.damageInput,borderColor:"var(--border)"},autoFocus:!0}),e.jsxs("div",{style:qe.damageIndicators,children:[t.type==="Minion"?(()=>{var K,fe;const a=parseInt(n==="adversary"||n==="adversaries"?N.damageValue:"0")||0,v=(K=t.features)==null?void 0:K.find(Ne=>{var Be;return(Be=Ne.name)==null?void 0:Be.startsWith("Minion (")}),R=v?parseInt(((fe=v.name.match(/\((\d+)\)/))==null?void 0:fe[1])||"1"):1,O=Math.floor(a/R);return a>=R&&O>0?e.jsxs("span",{style:{...qe.damageDrop,color:"var(--red)"},title:`${a} damage can defeat ${O+1} minion${O+1!==1?"s":""} (1 + ${O} additional)`,children:["+",O," additional minion(s)"]}):e.jsx("span",{style:qe.damageDrop,title:`${a} damage defeats this minion only`,children:"+0 additional minion(s)"})})():[1,2,3].map(a=>{const v=parseInt(n==="adversary"||n==="adversaries"?N.damageValue:"0")||0;let R=!1;return a===1&&v>=1&&(R=!0),a===2&&v>=t.thresholds.major&&(R=!0),a===3&&v>=t.thresholds.severe&&(R=!0),e.jsx("span",{style:{...qe.damageDrop,color:R?"var(--red)":"var(--text-secondary)"},onClick:O=>{O.stopPropagation(),(n==="adversary"||n==="adversaries")&&(a===1?N.setDamageValue("1"):a===2?N.setDamageValue(t.thresholds.major.toString()):a===3&&N.setDamageValue(t.thresholds.severe.toString()))},title:`Click to set damage to ${a===1?"1":a===2?t.thresholds.major:t.thresholds.severe}`,children:e.jsx(Ot,{size:16})},a)}),e.jsx("button",{style:{...qe.applyButton,backgroundColor:"var(--gray-600)"},onClick:a=>{a.stopPropagation(),(n==="adversary"||n==="adversaries")&&(!N.damageValue||parseInt(N.damageValue)<1?(N.setShowDamageInput(!1),N.setDamageValue("")):N.applyDamage())},title:!N.damageValue||parseInt(N.damageValue)<1?"Close damage input":"Apply damage",children:!N.damageValue||parseInt(N.damageValue)<1?e.jsx(ot,{size:16}):e.jsx(er,{size:16})})]})]})}),g=()=>{var K,fe,Ne,Be,Ye;const a=(t.hp||0)>=(t.hpMax||1),v=y==="edit"||Q,R=n==="adversary",O=R?Q?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:o=>{o.stopPropagation(),re&&(re(t,t.id),ne&&ne())},style:{background:"var(--purple)",border:"1px solid var(--purple)",color:"white",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:o=>{o.target.style.opacity="0.9"},onMouseLeave:o=>{o.target.style.opacity="1"},title:"Save",children:[e.jsx(Rt,{size:16}),e.jsx("span",{children:"Save"})]}),ne&&e.jsxs("button",{onClick:o=>{o.stopPropagation(),ne()},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:o=>{o.target.style.backgroundColor="var(--bg-hover)",o.target.style.borderColor="var(--purple)"},onMouseLeave:o=>{o.target.style.backgroundColor="var(--bg-secondary)",o.target.style.borderColor="var(--border)"},title:"Cancel",children:[e.jsx(ot,{size:16}),e.jsx("span",{children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:o=>{o.stopPropagation(),_&&_(t.id)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease"},onMouseEnter:o=>{o.currentTarget.style.backgroundColor="var(--bg-hover)",o.currentTarget.style.borderColor="var(--purple)"},onMouseLeave:o=>{o.currentTarget.style.backgroundColor="var(--bg-secondary)",o.currentTarget.style.borderColor="var(--border)"},title:"Remove one",children:e.jsx(ft,{size:16})}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"1rem",fontWeight:"500",minWidth:"24px",textAlign:"center"},children:F.length}),e.jsx("button",{onClick:o=>{o.stopPropagation(),Z&&Z(t)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease"},onMouseEnter:o=>{o.currentTarget.style.backgroundColor="var(--purple)",o.currentTarget.style.borderColor="var(--purple)",o.currentTarget.style.color="white"},onMouseLeave:o=>{o.currentTarget.style.backgroundColor="var(--bg-secondary)",o.currentTarget.style.borderColor="var(--border)",o.currentTarget.style.color="var(--text-primary)"},title:"Add another",children:e.jsx(at,{size:16})}),G&&e.jsx("button",{onClick:o=>{o.stopPropagation(),G(t.id)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease",marginLeft:"0.25rem"},onMouseEnter:o=>{o.currentTarget.style.backgroundColor="var(--purple)",o.currentTarget.style.borderColor="var(--purple)",o.currentTarget.style.color="white"},onMouseLeave:o=>{o.currentTarget.style.backgroundColor="var(--bg-secondary)",o.currentTarget.style.borderColor="var(--border)",o.currentTarget.style.color="var(--text-primary)"},title:"Edit",children:e.jsx(Zt,{size:16})})]}):null;return e.jsx(It,{tabContent:O,showTab:R,tabBorderColor:H?"var(--purple)":"var(--border)",containerBackgroundColor:a?"var(--gray-900)":ue(!0).backgroundColor,containerBorderColor:a?"color-mix(in srgb, var(--gray-600) 40%, transparent)":H?"var(--purple)":"var(--border)",containerBorderRadius:"8px",containerOverflow:"hidden",containerStyle:{padding:0,opacity:a?.7:1,height:"auto",maxHeight:R?"calc(100vh - 120px)":"calc(100vh - 68px)",minHeight:0},children:e.jsxs("div",{className:ye(),style:{...ue(!0),padding:0,display:"flex",flexDirection:"column",position:"relative",height:"100%",minHeight:0,border:"none",borderRadius:0},onClick:d,children:[a&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                  45deg,
                  transparent,
                  transparent 8px,
                  var(--gray-600) 1px,
                  var(--gray-600) 9px
                )`,pointerEvents:"none",zIndex:9999}})}),e.jsx("div",{className:"border-b",style:{padding:"8px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative",zIndex:a?1:"auto",borderBottomColor:H?"var(--purple)":"var(--border)"},children:e.jsx("div",{style:{display:"flex",flexDirection:"column",position:"relative",zIndex:a?1:"auto",padding:"2px",gap:0},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",minHeight:"40px"},children:[v?e.jsx("input",{ref:Ae,type:"text",value:t.name||"",onChange:o=>{i&&t.id&&i(t.id,{name:o.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"4px",color:"var(--text-primary)",fontSize:"1.1rem",fontWeight:"600",padding:"0.5rem",width:"100%",maxWidth:"300px",paddingRight:"0.625rem"},placeholder:"Name"}):e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flex:1},children:e.jsx("h4",{style:{...qe.rowTitle,color:a?"color-mix(in srgb, var(--gray-400) 80%, transparent)":qe.rowTitle.color,textAlign:"left",margin:0,fontSize:"1.1rem",paddingRight:"6px",flex:1},children:((K=t.name)==null?void 0:K.replace(/\s+\(\d+\)$/,""))||t.name})}),(t.type||t.tier||v)&&e.jsx(fr,{type:t.type,tier:t.tier,isEditMode:v,onUpdate:i,itemId:t.id})]})})}),e.jsxs("div",{ref:ze,style:{borderRadius:"0 0 8px 8px",flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0},className:"invisible-scrollbar",children:[(t.motives||v)&&e.jsx("div",{style:{padding:"0.5rem 8px",textAlign:"center"},children:v?e.jsx("input",{type:"text",value:t.motives||"",onChange:o=>i&&i(t.id,{motives:o.target.value}),placeholder:"Motives...",style:{width:"100%",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}):e.jsxs("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,textAlign:"center"},children:[t.motives,t.motives&&!t.motives.endsWith(".")?".":""]})}),(t.difficulty||t.atk!==void 0||t.thresholds&&t.type!=="Minion"||t.experience&&t.experience.length>0||v)&&e.jsxs("div",{style:{padding:"0.5rem 8px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[(t.difficulty||v)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[e.jsx(Qt,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(0deg)"}}),v?e.jsx("input",{type:"text",value:t.difficulty||"",onChange:o=>{const I=o.target.value.replace(/[^0-9]/g,"");I.length<=2&&i&&i(t.id,{difficulty:parseInt(I)||0})},onKeyDown:o=>{if(o.key==="ArrowUp"){o.preventDefault();const I=parseInt(t.difficulty)||0;i&&i(t.id,{difficulty:Math.min(I+1,99)})}else if(o.key==="ArrowDown"){o.preventDefault();const I=parseInt(t.difficulty)||0;i&&i(t.id,{difficulty:Math.max(I-1,0)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"2"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:t.difficulty})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Difficulty"})]}),(t.atk!==void 0||v)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[e.jsx(Ut,{size:38,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(45deg)"}}),v?e.jsx("input",{type:"text",value:(()=>{const o=typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0;return o>=0?`+${o}`:o.toString()})(),onChange:o=>{const I=o.target.value.replace(/[^0-9+\-]/g,"");if(I.length<=4){const r=parseInt(I.replace(/[^0-9\-]/g,""))||0;i&&i(t.id,{atk:r})}},onKeyDown:o=>{if(o.key==="ArrowUp"){o.preventDefault();const r=(typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0)+1;i&&i(t.id,{atk:r})}else if(o.key==="ArrowDown"){o.preventDefault();const r=(typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0)-1;i&&i(t.id,{atk:r})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"3"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:(()=>{const o=typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk;return o>=0?`+${o}`:o})()})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Attack"})]})]}),e.jsx("div",{style:{paddingTop:"0"},children:v?e.jsx("div",{style:{display:"flex",flexDirection:"column",marginTop:"-0.25rem"},children:(()=>{const o=t.experience||[],I=o.length===0?[{name:"",modifier:0}]:o;return I.map((r,T)=>{var ae,D,Y,u,j,S,ee,J,ve,me,xe,pe,A,be,ke,Le,He,Fe,De,Ee,Se,oe,We,$e,s;return e.jsxs("div",{style:{position:"relative",marginBottom:"0.5rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("input",{type:"text",value:typeof r=="object"&&r.modifier>0?`+${r.modifier}`:"",onChange:l=>{const z=[...t.experience||[]],k=l.target.value.replace(/[^0-9+-]/g,""),L=k===""||k==="+"?0:parseInt(k)||0,Ce=Math.max(0,L);z[T]={name:typeof r=="string"?r:r.name||"",modifier:Ce};const ie=V(z);i&&i(t.id,{experience:ie})},onKeyDown:l=>{if(l.key==="ArrowUp"){l.preventDefault();const z=[...t.experience||[]],k=typeof r=="object"&&r.modifier||0;z[T]={name:typeof r=="string"?r:r.name||"",modifier:k+1};const L=V(z);i&&i(t.id,{experience:L})}else if(l.key==="ArrowDown"){l.preventDefault();const z=[...t.experience||[]],k=typeof r=="object"&&r.modifier||0;z[T]={name:typeof r=="string"?r:r.name||"",modifier:Math.max(0,k-1)};const L=V(z);i&&i(t.id,{experience:L})}},style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)",textAlign:"center",outline:"none"}})}),e.jsxs("div",{style:{marginLeft:"32px",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:typeof r=="string"?r:r.name||"",onChange:l=>{var ie;const z=[...t.experience||[]],k=typeof r=="object"&&r.modifier||0;z[T]={name:l.target.value,modifier:k};let L=V(z);const Ce=L[L.length-1];Ce&&(typeof Ce=="string"?Ce.trim():(ie=Ce.name)!=null&&ie.trim())&&L.push({name:"",modifier:0}),i&&i(t.id,{experience:L})},placeholder:"Experience name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsxs("div",{style:{display:"flex",gap:"0.125rem"},children:[e.jsx("button",{onClick:()=>{var Ce,ie;const l=[...t.experience||[]],z=typeof r=="string"?r.trim():(Ce=r.name)==null?void 0:Ce.trim(),k=l[T-1],L=typeof k=="string"?k.trim():(ie=k.name)==null?void 0:ie.trim();if(T>0&&T<l.length&&z&&L){l[T]=k,l[T-1]=r;const B=V(l);i&&i(t.id,{experience:B})}},disabled:T===0||!(typeof r=="string"?r.trim():(ae=r.name)!=null&&ae.trim())||!(typeof I[T-1]=="string"?I[T-1].trim():(D=I[T-1].name)!=null&&D.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:T===0||!(typeof r=="string"?r.trim():(Y=r.name)!=null&&Y.trim())||!(typeof I[T-1]=="string"?I[T-1].trim():(u=I[T-1].name)!=null&&u.trim())?"var(--gray-800)":"var(--gray-700)",color:T===0||!(typeof r=="string"?r.trim():(j=r.name)!=null&&j.trim())||!(typeof I[T-1]=="string"?I[T-1].trim():(S=I[T-1].name)!=null&&S.trim())?"var(--text-secondary)":"white",cursor:T===0||!(typeof r=="string"?r.trim():(ee=r.name)!=null&&ee.trim())||!(typeof I[T-1]=="string"?I[T-1].trim():(J=I[T-1].name)!=null&&J.trim())?"not-allowed":"pointer",opacity:T===0||!(typeof r=="string"?r.trim():(ve=r.name)!=null&&ve.trim())||!(typeof I[T-1]=="string"?I[T-1].trim():(me=I[T-1].name)!=null&&me.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move up",children:"↑"}),e.jsx("button",{onClick:()=>{var Ce,ie;const l=[...t.experience||[]],z=typeof r=="string"?r.trim():(Ce=r.name)==null?void 0:Ce.trim(),k=l[T+1],L=typeof k=="string"?k.trim():(ie=k.name)==null?void 0:ie.trim();if(T<l.length-1&&T>=0&&z&&L){l[T]=k,l[T+1]=r;const B=V(l);i&&i(t.id,{experience:B})}},disabled:T===I.length-1||!(typeof r=="string"?r.trim():(xe=r.name)!=null&&xe.trim())||!(typeof I[T+1]=="string"?I[T+1].trim():(pe=I[T+1].name)!=null&&pe.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:T===I.length-1||!(typeof r=="string"?r.trim():(A=r.name)!=null&&A.trim())||!(typeof I[T+1]=="string"?I[T+1].trim():(be=I[T+1].name)!=null&&be.trim())?"var(--gray-800)":"var(--gray-700)",color:T===I.length-1||!(typeof r=="string"?r.trim():(ke=r.name)!=null&&ke.trim())||!(typeof I[T+1]=="string"?I[T+1].trim():(Le=I[T+1].name)!=null&&Le.trim())?"var(--text-secondary)":"white",cursor:T===I.length-1||!(typeof r=="string"?r.trim():(He=r.name)!=null&&He.trim())||!(typeof I[T+1]=="string"?I[T+1].trim():(Fe=I[T+1].name)!=null&&Fe.trim())?"not-allowed":"pointer",opacity:T===I.length-1||!(typeof r=="string"?r.trim():(De=r.name)!=null&&De.trim())||!(typeof I[T+1]=="string"?I[T+1].trim():(Ee=I[T+1].name)!=null&&Ee.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move down",children:"↓"}),e.jsx("button",{onClick:()=>te(r,T),disabled:!(typeof r=="string"?r.trim():(Se=r.name)!=null&&Se.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:M[X(r,T)]?"var(--danger)":(typeof r=="string"?r.trim():(oe=r.name)!=null&&oe.trim())?"var(--gray-700)":"var(--gray-800)",color:(typeof r=="string"?r.trim():(We=r.name)!=null&&We.trim())?"white":"var(--text-secondary)",cursor:(typeof r=="string"?r.trim():($e=r.name)!=null&&$e.trim())?"pointer":"not-allowed",opacity:(typeof r=="string"?r.trim():(s=r.name)!=null&&s.trim())?1:.5,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:M[X(r,T)]?"Click again to confirm delete":"Delete experience",children:"×"})]})]})]},T)})})()}):e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:t.experience&&t.experience.length>0?t.experience.map((o,I)=>{if(typeof o=="string"){const r=o.match(/^(.+?)\s*([+-]?\d+)$/);if(r){const[,T,ae]=r;return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:ae})})}),e.jsx("span",{style:{marginLeft:"32px"},children:T})]},I)}else return e.jsx("div",{style:{marginBottom:"0.25rem"},children:o},I)}else return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:e.jsxs("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:[o.modifier>=0?"+":"",o.modifier]})})}),e.jsx("span",{style:{marginLeft:"32px"},children:o.name})]},I)}):null})})]}),(t.features&&t.features.length>0||v)&&e.jsxs("div",{style:{padding:"0 8px 8px 8px"},children:[(t.atk!==void 0&&t.weapon||v)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Standard Attack"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:v?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",marginTop:"0.75rem",marginBottom:"0.75rem"},children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[e.jsx("input",{type:"text",value:t.weapon||"",onChange:o=>i&&i(t.id,{weapon:o.target.value}),placeholder:"Standard attack name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}}),e.jsxs("select",{value:t.range||"",onChange:o=>i&&i(t.id,{range:o.target.value}),style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",appearance:"none",backgroundImage:`url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",backgroundSize:"1rem",paddingRight:"2rem"},children:[e.jsx("option",{value:""}),e.jsx("option",{value:"Melee",children:"Melee"}),e.jsx("option",{value:"Very Close",children:"Very Close"}),e.jsx("option",{value:"Close",children:"Close"}),e.jsx("option",{value:"Far",children:"Far"}),e.jsx("option",{value:"Very Far",children:"Very Far"})]}),e.jsx("input",{type:"text",value:t.damage||"",onChange:o=>i&&i(t.id,{damage:o.target.value}),placeholder:"Damage (e.g., 1d6+2)",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}})]})}):t.atk!==void 0&&t.weapon&&e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:t.weapon}),e.jsxs("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:["Make an attack against a target within ",t.range||"Melee"," range. On a success, deal ",t.damage||"damage varies","."]})]})})]}),(t.features.filter(o=>o.type==="Action").length>0||v)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Actions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const o=t.features.filter(r=>r.type==="Action");return(v&&o.length===0?[{type:"Action",name:"",description:""}]:o).map((r,T)=>v?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:r.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false","data-lpignore":"true","data-form-type":"other",name:`feature-name-${r.type.toLowerCase()}`,onChange:ae=>{const D=[...t.features||[]],Y=D.findIndex(S=>S.type==="Action"&&S===r);Y>=0?D[Y]={...D[Y],name:ae.target.value}:D.push({type:"Action",name:ae.target.value,description:r.description||""});const u=D.filter(S=>S.type==="Action"),j=u[u.length-1];j&&j.name.trim()&&D.push({type:"Action",name:"",description:""}),i&&i(t.id,{features:D})},placeholder:"Action name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:r.description||"",onChange:ae=>{const D=[...t.features||[]],Y=D.findIndex(S=>S.type==="Action"&&S===r);Y>=0?D[Y]={...D[Y],description:ae.target.value}:D.push({type:"Action",name:r.name||"",description:ae.target.value});const u=D.filter(S=>S.type==="Action"),j=u[u.length-1];j&&j.name.trim()&&D.push({type:"Action",name:"",description:""}),i&&i(t.id,{features:D})},onInput:ae=>{const D=ae.target.offsetHeight;ae.target.style.height="auto";const Y=ae.target.scrollHeight,u=Y>D?Y:D;ae.target.style.height=u+"px"},placeholder:"Action description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(bt,{feature:r,featureType:"Action",item:t,onUpdate:i,handleFeatureDeleteClick:je,deleteConfirmations:M,getFeatureKey:U})]},T):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:r.name}),r.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:r.description})]},T))})()})]}),(t.features.filter(o=>o.type==="Passive").length>0||v)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Passives"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const o=t.features.filter(r=>r.type==="Passive");return(v&&o.length===0?[{type:"Passive",name:"",description:""}]:o).map((r,T)=>v?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:r.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:ae=>{const D=[...t.features||[]],Y=D.findIndex(S=>S.type==="Passive"&&S===r);Y>=0?D[Y]={...D[Y],name:ae.target.value}:D.push({type:"Passive",name:ae.target.value,description:r.description||""});const u=D.filter(S=>S.type==="Passive"),j=u[u.length-1];j&&j.name.trim()&&D.push({type:"Passive",name:"",description:""}),i&&i(t.id,{features:D})},placeholder:"Passive name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:r.description||"",onChange:ae=>{const D=[...t.features||[]],Y=D.findIndex(S=>S.type==="Passive"&&S===r);Y>=0?D[Y]={...D[Y],description:ae.target.value}:D.push({type:"Passive",name:r.name||"",description:ae.target.value});const u=D.filter(S=>S.type==="Passive"),j=u[u.length-1];j&&j.name.trim()&&D.push({type:"Passive",name:"",description:""}),i&&i(t.id,{features:D})},onInput:ae=>{const D=ae.target.offsetHeight;ae.target.style.height="auto";const Y=ae.target.scrollHeight,u=Y>D?Y:D;ae.target.style.height=u+"px"},placeholder:"Passive description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(bt,{feature:r,featureType:"Passive",item:t,onUpdate:i,handleFeatureDeleteClick:je,deleteConfirmations:M,getFeatureKey:U})]},T):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:r.name}),r.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:r.description})]},T))})()})]}),(t.features.filter(o=>o.type==="Reaction").length>0||v)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Reactions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const o=t.features.filter(r=>r.type==="Reaction");return(v&&o.length===0?[{type:"Reaction",name:"",description:""}]:o).map((r,T)=>v?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:r.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:ae=>{const D=[...t.features||[]],Y=D.findIndex(S=>S.type==="Reaction"&&S===r);Y>=0?D[Y]={...D[Y],name:ae.target.value}:D.push({type:"Reaction",name:ae.target.value,description:r.description||""});const u=D.filter(S=>S.type==="Reaction"),j=u[u.length-1];j&&j.name.trim()&&D.push({type:"Reaction",name:"",description:""}),i&&i(t.id,{features:D})},placeholder:"Reaction name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:r.description||"",onChange:ae=>{const D=[...t.features||[]],Y=D.findIndex(S=>S.type==="Reaction"&&S===r);Y>=0?D[Y]={...D[Y],description:ae.target.value}:D.push({type:"Reaction",name:r.name||"",description:ae.target.value});const u=D.filter(S=>S.type==="Reaction"),j=u[u.length-1];j&&j.name.trim()&&D.push({type:"Reaction",name:"",description:""}),i&&i(t.id,{features:D})},onInput:ae=>{const D=ae.target.offsetHeight;ae.target.style.height="auto";const Y=ae.target.scrollHeight,u=Y>D?Y:D;ae.target.style.height=u+"px"},placeholder:"Reaction description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(bt,{feature:r,featureType:"Reaction",item:t,onUpdate:i,handleFeatureDeleteClick:je,deleteConfirmations:M,getFeatureKey:U})]},T):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:r.name}),r.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:r.description})]},T))})()})]})]}),(F&&F.length>0||t.type!=="Minion"&&(t.thresholds||v))&&e.jsxs("div",{style:{padding:"0 8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Status"})]}),v?e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border)"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"number",value:t.hpMax||"",onChange:o=>{const I=parseInt(o.target.value)||1;i&&i(t.id,{hpMax:I})},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),e.jsx(it,{type:"adversaryHP",value:0,maxValue:t.hpMax||1,showTooltip:!1}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:"HP"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"number",value:t.stressMax||"",onChange:o=>{const I=parseInt(o.target.value)||1;i&&i(t.id,{stressMax:I})},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),e.jsx(it,{type:"adversaryStress",value:0,maxValue:t.stressMax||1,showTooltip:!1}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:"Stress"})]})]})})}):F&&F.length>0&&F.map((o,I)=>{const r=(o.hp||0)>=(o.hpMax||1);return e.jsx("div",{"data-instance-id":o.id,style:{marginBottom:"0.5rem"},children:e.jsxs("div",{style:{backgroundColor:r?"var(--gray-900)":"var(--bg-primary)",borderRadius:"6px",padding:"0.25rem 0.5rem",border:"1px solid",borderColor:r?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",display:"flex",justifyContent:"flex-start",alignItems:"center",gap:"0.5rem",opacity:r?.7:1,position:"relative",transition:"all 0.2s ease",minHeight:"40px"},children:[r&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                          45deg,
                          transparent 0px,
                          transparent 8px,
                          var(--gray-600) 9px,
                          var(--gray-600) 9px
                        )`,pointerEvents:"none",zIndex:1,borderRadius:"4px"}})}),e.jsx("div",{style:{backgroundColor:r?"var(--gray-900)":"var(--bg-card)",border:"1px solid",borderColor:r?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",borderRadius:"50%",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",flexShrink:0,opacity:r?.5:1},children:e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:r?"var(--gray-400)":"var(--text-primary)"},children:o.duplicateNumber||1})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.125rem"},children:[e.jsx("div",{style:{opacity:r?.3:1},children:e.jsx(it,{type:"adversaryHP",value:o.hp||0,maxValue:o.hpMax||1,onPipClick:(T,ae)=>{if(m&&n==="adversary"){const D=o.hp||0,Y=o.hpMax||1;ae?x&&x(o.id,1,D):D<Y&&m(o.id,1,D,Y)}},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})}),o.stressMax>0&&e.jsx("div",{style:{opacity:r?.3:1},children:e.jsx(it,{type:"adversaryStress",value:o.stress||0,maxValue:o.stressMax,onPipClick:(T,ae)=>{$&&n==="adversary"&&(ae?$(o.id,-1):$(o.id,1))},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})})]})]},o.id)},o.id)}),t.type!=="Minion"&&(t.thresholds||v)&&e.jsx("div",{style:{display:"flex",justifyContent:"center",paddingTop:"1px",marginTop:"0.5rem",marginBottom:"0.5rem"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",position:"relative"},children:e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",height:"36px"},children:[e.jsx("svg",{width:"300",height:"36",viewBox:"0 0 300 36",style:{position:"absolute",zIndex:1},children:e.jsx("rect",{x:"20",y:"6",width:"260",height:"24",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4"})}),e.jsx("div",{style:{position:"relative",zIndex:2,display:"flex",alignItems:"center",gap:"0.5rem"},children:v?e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",fontSize:"0.8rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),e.jsx("input",{type:"number",min:"1",max:"99",value:((fe=t.thresholds)==null?void 0:fe.major)||"",onChange:o=>{const I=o.target.value;(I===""||parseInt(I)>=1&&parseInt(I)<=99)&&i&&i(t.id,{thresholds:{...t.thresholds,major:I===""?null:parseInt(I)}})},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),e.jsx("input",{type:"number",min:"1",max:"99",value:((Ne=t.thresholds)==null?void 0:Ne.severe)||"",onChange:o=>{const I=o.target.value;(I===""||parseInt(I)>=1&&parseInt(I)<=99)&&i&&i(t.id,{thresholds:{...t.thresholds,severe:I===""?null:parseInt(I)}})},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),e.jsx(Dt,{value:((Be=t.thresholds)==null?void 0:Be.major)||7}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),e.jsx(Dt,{value:((Ye=t.thresholds)==null?void 0:Ye.severe)||14}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]})})]})})})]}),(v||p==="expanded"&&t.description&&t.description.trim())&&e.jsxs("div",{style:{padding:"0 8px",textAlign:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Description"})]}),v?e.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-primary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"none",overflow:"hidden",fontFamily:"inherit",marginTop:"0.75rem",marginBottom:"0.75rem"},value:t.description,onChange:o=>{o.target.style.height="auto",o.target.style.height=o.target.scrollHeight+"px",i&&i(t.id,{description:o.target.value})},placeholder:"Description..."}):e.jsx("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,whiteSpace:"pre-wrap",padding:"0.5rem 0"},children:t.description})]})]}),c()]})})};if(Q&&(n==="adversary"||n==="adversaries")){const a=n==="adversary",v=a?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:R=>{var O;R.stopPropagation(),(O=ce.current)!=null&&O.handleSave&&ce.current.handleSave()},style:{background:"var(--purple)",border:"1px solid var(--purple)",color:"white",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:R=>{R.currentTarget.style.opacity="0.9"},onMouseLeave:R=>{R.currentTarget.style.opacity="1"},title:"Save",children:[e.jsx(Rt,{size:16}),e.jsx("span",{children:"Save"})]}),ne&&e.jsxs("button",{onClick:R=>{R.stopPropagation(),ne()},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:R=>{R.currentTarget.style.backgroundColor="var(--bg-hover)",R.currentTarget.style.borderColor="var(--purple)"},onMouseLeave:R=>{R.currentTarget.style.backgroundColor="var(--bg-secondary)",R.currentTarget.style.borderColor="var(--border)"},title:"Cancel",children:[e.jsx(ot,{size:16}),e.jsx("span",{children:"Cancel"})]})]}):null;return e.jsx(It,{tabContent:v,containerStyle:{padding:0,height:"auto",maxHeight:a?"calc(100vh - 120px)":"calc(100vh - 68px)",minHeight:0},children:e.jsx(Mt,{ref:ce,editingAdversary:t,onSave:re,onCancelEdit:ne,isStockAdversary:Te,embedded:!0,hideEmbeddedButtons:!0,allAdversaries:E,autoFocus:!t.baseName||t.baseName.trim()===""||t.baseName==="Unknown"})})}const y=Q?"edit":p;return(y==="expanded"||y==="edit")&&(n==="adversary"||n==="adversaries")?g():n==="adversary"||n==="adversaries"?null:e.jsxs("div",{className:ye(),style:ue(!0),children:[e.jsxs("div",{style:qe.rowMain,children:[e.jsx("h4",{style:qe.rowTitle,children:Re()}),e.jsx("div",{style:qe.rowMeta,children:Ve()})]}),e.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"12px",margin:0},children:["Expanded view coming soon for ",n]})]})},ht=xr,gr="/Daggerheart/assets/daggerheart-logo-fe7815ad.svg",yr=(t,n)=>{const[p,d]=f.useState("max-content"),b=f.useCallback(()=>{if(!n.current||t<=3)return"max-content";const m=n.current.offsetWidth,$=Math.floor(m/120);return $<=1?"max-content":t===4?"max-content max-content":t===5||t===6?$>=2?"max-content max-content":"max-content":t===7?$>=3?"max-content max-content max-content":$>=2?"max-content max-content":"max-content":"repeat(auto-fit, minmax(80px, max-content))"},[t,n]);return f.useEffect(()=>{const m=b();d(m);const x=new ResizeObserver(()=>{const $=b();d($)});return n.current&&x.observe(n.current),()=>{x.disconnect()}},[b]),p},vr=({encounter:t})=>{var b,m;const n=f.useRef(null),p=((b=t.encounterItems)==null?void 0:b.length)||0,d=yr(p,n);return e.jsx("div",{ref:n,className:"saved-encounter-adversary-list",style:{flex:1,fontSize:"0.8rem",color:"var(--text-secondary)",lineHeight:"1.3",display:"grid",gridTemplateColumns:d,gap:"0.25rem 1rem",gridAutoRows:"min-content"},children:((m=t.encounterItems)==null?void 0:m.length)>0?t.encounterItems.map((x,$)=>{var E;const i=x.item.baseName||((E=x.item.name)==null?void 0:E.replace(/\s+\(\d+\)$/,""))||x.item.name;return e.jsxs("div",{style:{marginBottom:"0.125rem"},children:[x.quantity,"x ",i]},$)}):e.jsx("div",{children:"No adversaries"})})},dt={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},mt={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1,lowerTierAdversary:1};let nt={adversaries:[]},At={environments:[]},xt=!1;const br=()=>{const t=JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]"),n=JSON.parse(localStorage.getItem("daggerheart-custom-environments")||"[]");return{customAdversaries:t,customEnvironments:n}},Ct=async()=>{if(xt)return;let t={adversaries:[]},n={environments:[]},p={adversaries:[]},d={environments:[]};try{const x=await st(()=>import("./adversaries-9c8932de.js"),[]);t=(x==null?void 0:x.default)||x}catch(x){console.warn("Failed to load adversaries.json:",x)}try{const x=await st(()=>import("./environments-c340637c.js"),[]);n=(x==null?void 0:x.default)||x}catch(x){console.warn("Failed to load environments.json:",x)}try{const x=await st(()=>import("./playtest-adversaries-4a099c10.js"),[]);p=(x==null?void 0:x.default)||x}catch(x){console.warn("Failed to load playtest-adversaries.json:",x)}try{const x=await st(()=>import("./playtest-environments-d9cdffb6.js"),[]);d=(x==null?void 0:x.default)||x}catch(x){console.warn("Failed to load playtest-environments.json:",x)}const{customAdversaries:b,customEnvironments:m}=br();nt={...t,adversaries:[...t.adversaries||[],...p.adversaries||[],...b]},At={...n,environments:[...n.environments||[],...d.environments||[],...m]},xt=!0},Cr=(t,n=[],p=4,d=1,b=!1,m=null)=>{const[x,$]=f.useState(""),[i,E]=f.useState([{field:"tier",direction:"asc"},{field:"name",direction:"asc"}]),[H,W]=f.useState([]),[F,C]=f.useState(!0),[P,Z]=f.useState([]),[_,G]=f.useState([]),[Q,re]=f.useState(!1),[ne,Te]=f.useState(!1),ze=f.useRef(null),Oe=f.useRef(null);f.useEffect(()=>{(async()=>{await Ct(),C(!1);let N=[];t==="adversary"?N=nt.adversaries||[]:t==="environment"&&(N=At.environments||[]),W(N)})()},[t]),f.useEffect(()=>{t==="adversary"&&m&&(async()=>{xt=!1,await Ct();let N=[];b?N=(nt.adversaries||[]).filter(ue=>{var ye;return ue.source==="Homebrew"||((ye=ue.id)==null?void 0:ye.startsWith("custom-"))}):N=nt.adversaries||[],W(N)})()},[m,t,b]);const se=te=>{const N=H.map(ue=>ue[te]).filter(Boolean);return[...new Set(N)].sort((ue,ye)=>typeof ue=="number"&&typeof ye=="number"?ue-ye:String(ue).localeCompare(String(ye)))},q=f.useCallback(async()=>{xt=!1,await Ct();let te=[];t==="adversary"?b?te=(nt.adversaries||[]).filter(N=>{var ue;return N.source==="Homebrew"||((ue=N.id)==null?void 0:ue.startsWith("custom-"))}):te=nt.adversaries||[]:t==="environment"&&(te=At.environments||[]),W(te)},[t,b]);f.useEffect(()=>{q()},[b,q]);const he=se("tier"),Ae=se("type"),ce=f.useMemo(()=>{let te=H.filter(N=>{var c,g;const ye=(N.name||N.baseName||"").toLowerCase().includes(x.toLowerCase())||((c=N.type)==null?void 0:c.toLowerCase().includes(x.toLowerCase()))||((g=N.description)==null?void 0:g.toLowerCase().includes(x.toLowerCase())),Re=P.length===0||(P.includes("party-tier")?N.tier===d:P.includes(N.tier.toString())),Ve=_.length===0||_.includes(N.type);return ye&&Re&&Ve});return te.sort((N,ue)=>{for(const ye of i){const{field:Re,direction:Ve}=ye;let c=N[Re],g=ue[Re];if(Re==="tier")c=parseInt(c)||0,g=parseInt(g)||0;else if(Re==="cost"){const y=h=>{if(t!=="adversary")return 0;const a=dt[h.type]||2;let v=0;const R=n.filter(K=>K.type==="adversary"&&K.item.type==="Solo"&&K.quantity>0).reduce((K,fe)=>K+fe.quantity,0),O=n.filter(K=>K.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(K.item.type)&&K.quantity>0).reduce((K,fe)=>K+fe.quantity,0);return h.type==="Solo"&&R===1&&(v+=2),["Bruiser","Horde","Leader","Solo"].includes(h.type)&&O===0&&(v+=1),a+v};c=y(N),g=y(ue)}else if(Re==="difficulty"){const y=parseInt(c),h=parseInt(g);!isNaN(y)&&!isNaN(h)?(c=y,g=h):!isNaN(y)&&isNaN(h)?(c=y,g=999):isNaN(y)&&!isNaN(h)?(c=999,g=h):(c=String(c||"").toLowerCase(),g=String(g||"").toLowerCase())}else typeof c=="string"&&typeof g=="string"?(c=c.toLowerCase(),g=g.toLowerCase()):(c=String(c||"").toLowerCase(),g=String(g||"").toLowerCase());if(Ve==="asc"){if(c>g)return 1;if(c<g)return-1}else{if(c<g)return 1;if(c>g)return-1}}return 0}),te},[H,x,i,P,_,n,p,d]),M=te=>{E(N=>{const ue=N.findIndex(ye=>ye.field===te);if(ue>=0)if(ue===0){const ye=[...N];return ye[0]={...ye[0],direction:ye[0].direction==="asc"?"desc":"asc"},ye}else{const ye=[...N];return ye.splice(ue,1)[0],[{field:te,direction:"asc"},...ye]}else return[{field:te,direction:"asc"},...N]})},w=te=>{Z(te==="clear"?[]:te==="party-tier"?["party-tier"]:N=>N.includes(te)?N.filter(ue=>ue!==te):[...N,te])},U=te=>{G(te==="clear"?[]:N=>N.includes(te)?N.filter(ue=>ue!==te):[...N,te])},X=P.length>0,V=_.length>0;return f.useEffect(()=>{const te=ue=>{const ye=ue.target.closest(".filter-dropdown"),Re=ue.target.closest(".header-filter-icon");ye||Re||(re(!1),Te(!1))},N=ue=>{ue.key==="Escape"&&(re(!1),Te(!1))};return document.addEventListener("pointerdown",te,!0),document.addEventListener("mousedown",te,!0),document.addEventListener("touchstart",te,!0),document.addEventListener("click",te,!0),document.addEventListener("keydown",N,!0),()=>{document.removeEventListener("pointerdown",te,!0),document.removeEventListener("mousedown",te,!0),document.removeEventListener("touchstart",te,!0),document.removeEventListener("click",te,!0),document.removeEventListener("keydown",N,!0)}},[re,Te]),{searchTerm:x,setSearchTerm:$,sortFields:i,handleSort:M,filteredAndSortedData:ce,loading:F,refreshData:q,selectedTiers:P,selectedTypes:_,showTierDropdown:Q,setShowTierDropdown:re,showTypeDropdown:ne,setShowTypeDropdown:Te,tierFilterRef:ze,typeFilterRef:Oe,uniqueTiers:he,uniqueTypes:Ae,handleTierSelect:w,handleTypeSelect:U,isTierFiltered:X,isTypeFiltered:V,getDropdownStyle:te=>{if(!te.current)return{};const N=te.current.getBoundingClientRect();return{position:"fixed",top:N.bottom+4,left:N.left-100,zIndex:99999}}}},Sr=({searchTerm:t,onSearchChange:n,type:p,partyControls:d,showCustomToggle:b=!1,onToggleCustom:m,filterCustom:x=!1,onExportCustomAdversaries:$,onImportCustomAdversaries:i,autoFocus:E=!1,onClose:H=null,placeholder:W="Search"})=>{const F=f.useRef(null);return f.useEffect(()=>{E&&F.current&&setTimeout(()=>{var C;(C=F.current)==null||C.focus()},100)},[E]),e.jsxs("div",{style:de.browserHeader,children:[e.jsx("div",{style:{display:"flex",alignItems:"center",flex:1,gap:"0.5rem"},children:e.jsx("input",{ref:F,type:"text",placeholder:W,value:t,onChange:C=>n(C.target.value),style:{...de.searchInput,flex:1,marginRight:0}})}),d&&e.jsx("div",{style:de.partyControls,children:d})]})},wr=({showCustomToggle:t=!1,onToggleCustom:n,filterCustom:p=!1,onExportCustomAdversaries:d,onImportCustomAdversaries:b})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)",flexShrink:0},children:[t&&e.jsxs("button",{onClick:()=>n&&n(!p),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:p?"var(--purple)":"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:p?"white":"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:m=>{p||(m.target.style.backgroundColor="var(--bg-hover)",m.target.style.borderColor="var(--purple)")},onMouseLeave:m=>{p||(m.target.style.backgroundColor="var(--bg-primary)",m.target.style.borderColor="var(--border)")},children:[e.jsx("span",{children:p?"✓":"○"}),"Custom Only"]}),e.jsxs("button",{onClick:d,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:m=>{m.target.style.backgroundColor="var(--bg-hover)",m.target.style.borderColor="var(--purple)"},onMouseLeave:m=>{m.target.style.backgroundColor="var(--bg-primary)",m.target.style.borderColor="var(--border)"},children:[e.jsx("span",{children:"↓"}),"Export"]}),e.jsxs("button",{onClick:()=>document.getElementById("import-file-input").click(),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:m=>{m.target.style.backgroundColor="var(--bg-hover)",m.target.style.borderColor="var(--purple)"},onMouseLeave:m=>{m.target.style.backgroundColor="var(--bg-primary)",m.target.style.borderColor="var(--border)"},children:[e.jsx("span",{children:"↑"}),"Import"]}),e.jsx("input",{id:"import-file-input",type:"file",accept:".csv,.json",onChange:b,style:{display:"none"}})]}),jr=({sortFields:t,onSort:n,type:p,uniqueTiers:d,uniqueTypes:b,selectedTiers:m,selectedTypes:x,showTierDropdown:$,setShowTierDropdown:i,showTypeDropdown:E,setShowTypeDropdown:H,tierFilterRef:W,typeFilterRef:F,handleTierSelect:C,handleTypeSelect:P,isTierFiltered:Z,isTypeFiltered:_,getDropdownStyle:G,costFilter:Q,showCostDropdown:re,setShowCostDropdown:ne,costFilterRef:Te,handleCostFilterSelect:ze,isCostFiltered:Oe})=>{const[se,q]=f.useState(null),Ae=(()=>p==="adversary"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"cost",label:"Cost",hasFilter:!0},{key:"difficulty",label:"Diff"}]:p==="environment"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"}]:[])(),ce=()=>{if(!re)return null;const w=[{value:"all",label:"All"},{value:"auto-grey",label:"Auto Grey"},{value:"auto-hide",label:"Auto Hide"}];return jt.createPortal(e.jsx("div",{className:"filter-dropdown",style:{...de.filterDropdown,...G(Te),maxHeight:"60vh",overflow:"auto"},onMouseDown:U=>U.stopPropagation(),onClick:U=>U.stopPropagation(),children:w.map(U=>{const X=Q===U.value;return e.jsxs("div",{style:{...de.filterOption,...X?de.filterOptionSelected:{}},onClick:()=>ze(U.value),children:[e.jsx("span",{style:de.checkIcon,children:X?e.jsx(ut,{size:16}):e.jsx(pt,{size:16})}),e.jsx("span",{style:de.filterLabel,children:U.label})]},U.value)})}),document.body)},M=(w,U,X,V,je,te,N,ue)=>{if(!je)return null;const ye=()=>{(w==="tier"||w==="type")&&V("clear")};return jt.createPortal(e.jsxs("div",{className:"filter-dropdown",style:{...de.filterDropdown,...G(N),maxHeight:"60vh",overflow:"auto"},onMouseDown:Re=>Re.stopPropagation(),onClick:Re=>Re.stopPropagation(),children:[e.jsxs("div",{style:{...de.filterOption,...X.length===0?de.filterOptionSelected:{}},onClick:ye,children:[e.jsx("span",{style:de.checkIcon,children:X.length===0?e.jsx(ut,{size:16}):e.jsx(pt,{size:16})}),e.jsx("span",{style:de.filterLabel,children:"All"})]}),w==="tier"&&e.jsxs("div",{style:{...de.filterOption,...X.includes("party-tier")?de.filterOptionSelected:{}},onClick:()=>V("party-tier"),children:[e.jsx("span",{style:de.checkIcon,children:X.includes("party-tier")?e.jsx(ut,{size:16}):e.jsx(pt,{size:16})}),e.jsx("span",{style:de.filterLabel,children:"Party Tier"})]}),U.map(Re=>{const Ve=X.includes(Re.toString());return e.jsxs("div",{style:{...de.filterOption,...Ve?de.filterOptionSelected:{}},onClick:()=>V(Re.toString()),children:[e.jsx("span",{style:de.checkIcon,children:Ve?e.jsx(ut,{size:16}):e.jsx(pt,{size:16})}),e.jsx("span",{style:de.filterLabel,children:Re})]},Re)})]}),document.body)};return e.jsx("tr",{style:de.tableHeader,children:Ae.map(w=>e.jsxs("th",{style:{...de.tableHeaderCell,...se===w.key?de.tableHeaderCellHover:{},position:"relative",...w.key==="name"?{width:"auto",minWidth:"0"}:{},...w.key==="tier"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...w.key==="type"?{width:"80px",minWidth:"80px",maxWidth:"80px"}:{},...w.key==="difficulty"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...w.key==="cost"?{width:"50px",minWidth:"50px",maxWidth:"50px"}:{}},onClick:()=>n(w.key),onMouseEnter:()=>q(w.key),onMouseLeave:()=>q(null),children:[w.hasFilter?e.jsxs("div",{style:de.headerWithFilter,children:[e.jsx("span",{style:{cursor:"pointer"},onClick:U=>{U.stopPropagation(),n(w.key)},children:w.label}),e.jsxs("button",{ref:w.key==="tier"?W:w.key==="type"?F:Te,style:{...de.headerFilterIcon,...w.key==="tier"&&Z?de.headerFilterIconActive:{},...w.key==="type"&&_?de.headerFilterIconActive:{},...w.key==="cost"&&Oe?de.headerFilterIconActive:{}},className:"header-filter-icon",onClick:U=>{U.stopPropagation(),w.key==="tier"?(i(!$),H(!1),ne(!1)):w.key==="type"?(H(!E),i(!1),ne(!1)):w.key==="cost"&&(ne(!re),i(!1),H(!1))},children:[e.jsx(tr,{size:14}),w.key==="tier"&&Z||w.key==="type"&&_||w.key==="cost"&&Oe?e.jsx("span",{style:de.filterActiveDot}):null]})]}):w.label,w.key==="tier"&&M("tier",d,m,C,$,i,W),w.key==="type"&&M("type",b,x,P,E,H,F),w.key==="cost"&&ce()]},w.key))})},kr=({item:t,onAdd:n,type:p,onRowClick:d,encounterItems:b=[],pcCount:m=4,playerTier:x=1,remainingBudget:$=0,costFilter:i="auto-grey"})=>{const[E,H]=f.useState(!1),W=()=>{n(t)},F=()=>{if(p!=="adversary")return null;const Z=dt[t.type]||2;let _=0;const G=b.filter(re=>re.type==="adversary"&&re.item.type==="Solo"&&re.quantity>0).reduce((re,ne)=>re+ne.quantity,0),Q=b.filter(re=>re.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(re.item.type)&&re.quantity>0).reduce((re,ne)=>re+ne.quantity,0);return t.type==="Solo"&&G===1&&(_+=2),["Bruiser","Horde","Leader","Solo"].includes(t.type)&&Q===0&&(_+=1),Z+_},P=(()=>{if(p==="adversary"){const Z=F();dt[t.type];const _=Z>$||$<=0;if(i==="auto-hide"&&_)return null;const G=i==="auto-grey"&&_?{opacity:.5,color:"var(--text-secondary)"}:{};return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...de.rowCell,width:"auto",minWidth:"0",textAlign:"left",...G},children:e.jsxs("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:[e.jsx("div",{style:{fontWeight:"600"},children:t.name||t.baseName||""}),t.description&&e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"0.125rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.description})]})}),e.jsx("td",{style:{...de.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...G},children:t.tier}),e.jsx("td",{style:{...de.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center",...G},children:t.type}),e.jsx("td",{style:{...de.rowCell,width:"50px",minWidth:"50px",maxWidth:"50px",textAlign:"center",...G},children:Z}),e.jsx("td",{style:{...de.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...G},children:t.difficulty})]})}else if(p==="environment")return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...de.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:t.name||t.baseName||""}),e.jsx("td",{style:{...de.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:t.tier}),e.jsx("td",{style:{...de.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:t.type}),e.jsx("td",{style:{...de.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:t.difficulty})]});return null})();return P===null?null:e.jsx(e.Fragment,{children:e.jsx("tr",{style:{...de.row,...E?de.rowHover:{}},onClick:()=>{p==="adversary"?W():d&&d(t,p)},onMouseEnter:()=>H(!0),onMouseLeave:()=>H(!1),children:P})})},Vt=({type:t,onAddItem:n,onCancel:p=null,onRowClick:d,encounterItems:b=[],pcCount:m=4,playerTier:x=1,partyControls:$=null,showContainer:i=!0,savedEncounters:E=[],onLoadEncounter:H,onDeleteEncounter:W,activeTab:F="adversaries",selectedCustomAdversaryId:C,onSelectCustomAdversary:P,onTabChange:Z,selectedAdversary:_,onSelectAdversary:G,filterCustom:Q=!1,showCustomToggle:re=!1,onToggleCustom:ne,onExportCustomAdversaries:Te,onImportCustomAdversaries:ze,autoFocus:Oe=!1,hideImportExport:se=!1,onClose:q=null,searchPlaceholder:he="Search"})=>{const{addCustomAdversary:Ae,updateCustomAdversary:ce,customContent:M}=Et(),[w,U]=f.useState(null),[X,V]=f.useState("all"),[je,te]=f.useState(!1),[N,ue]=f.useState({}),ye=f.useRef({}),Re=f.useRef(null),Ve=()=>{try{const A=M.adversaries||[];if(A.length===0){alert("No custom adversaries to export.");return}const be=["name","tier","type","difficulty","threshold_major","threshold_severe","hp_max","stress_max","atk","weapon","range","damage","description","motives"],ke=A.map(Se=>{var oe,We;return[Se.name||"",Se.tier||"",Se.type||"",Se.difficulty||"",((oe=Se.thresholds)==null?void 0:oe.major)||"",((We=Se.thresholds)==null?void 0:We.severe)||"",Se.hpMax||"",Se.stressMax||"",Se.atk||"",Se.weapon||"",Se.range||"",Se.damage||"",Se.description||"",Se.motives||""]}),Le=Se=>{const oe=String(Se);return oe.includes(",")||oe.includes('"')||oe.includes(`
`)?`"${oe.replace(/"/g,'""')}"`:oe},He=[be.join(","),...ke.map(Se=>Se.map(Le).join(","))].join(`
`),Fe=new Blob([He],{type:"text/csv;charset=utf-8;"}),De=URL.createObjectURL(Fe),Ee=document.createElement("a");Ee.href=De,Ee.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(Ee),Ee.click(),document.body.removeChild(Ee),URL.revokeObjectURL(De),console.log(`Exported ${A.length} custom adversaries to CSV`)}catch(A){console.error("Failed to export custom adversaries:",A),alert("Failed to export custom adversaries. Please try again.")}},c=A=>{const be=A.target.files[0];if(!be)return;const ke=be.name.endsWith(".csv"),Le=be.name.endsWith(".json");if(!ke&&!Le){alert("Please upload a CSV or JSON file."),A.target.value="";return}const He=new FileReader;He.onload=Fe=>{try{let De=[];if(ke){const s=Fe.target.result.split(`
`).filter(z=>z.trim());if(s.length<2)throw new Error("CSV file is empty or invalid.");const l=s[0].split(",").map(z=>z.trim().replace(/^"|"$/g,""));for(let z=1;z<s.length;z++){const k=[];let L="",Ce=!1;for(let B=0;B<s[z].length;B++){const ge=s[z][B],we=s[z][B+1];ge==='"'&&Ce&&we==='"'?(L+='"',B++):ge==='"'?Ce=!Ce:ge===","&&!Ce?(k.push(L.trim()),L=""):L+=ge}k.push(L.trim());const ie={name:k[l.indexOf("name")]||"",tier:parseInt(k[l.indexOf("tier")])||1,type:k[l.indexOf("type")]||"Standard",difficulty:parseInt(k[l.indexOf("difficulty")])||11,thresholds:{major:parseInt(k[l.indexOf("threshold_major")])||7,severe:parseInt(k[l.indexOf("threshold_severe")])||12},hpMax:parseInt(k[l.indexOf("hp_max")])||3,stressMax:parseInt(k[l.indexOf("stress_max")])||1,atk:parseInt(k[l.indexOf("atk")])||1,weapon:k[l.indexOf("weapon")]||"",range:k[l.indexOf("range")]||"Melee",damage:k[l.indexOf("damage")]||"",description:k[l.indexOf("description")]||"",motives:k[l.indexOf("motives")]||"",source:"Homebrew"};ie.name&&De.push(ie)}}else if(Le){const $e=JSON.parse(Fe.target.result);if(!$e.customAdversaries||!Array.isArray($e.customAdversaries))throw new Error("Invalid JSON format. Expected customAdversaries array.");De=$e.customAdversaries}const Ee=M.adversaries||[],Se=[...Ee];let oe=0,We=0;De.forEach($e=>{if(Ee.some(l=>l.name===$e.name&&l.source===$e.source))We++;else{const l={...$e,id:`custom-adv-${Date.now()}-${Math.random().toString(36).slice(2,10)}`,hp:0,stress:0};Se.push(l),oe++}}),oe>0?(localStorage.setItem("daggerheart-custom-adversaries",JSON.stringify(Se)),window.location.reload(),alert(`Import successful! Added ${oe} new adversaries${We>0?`, skipped ${We} duplicates`:""}.`)):alert("No new adversaries were added. All imported adversaries already exist.")}catch(De){console.error("Failed to import custom adversaries:",De),alert(`Failed to import custom adversaries: ${De.message}`)}},He.readAsText(be),A.target.value=""},g=()=>{U(null)},y=async(A,be)=>{be?ce(be,A):Ae(A)},h=A=>{N[A]?(W&&W(A),ue(be=>{const ke={...be};return delete ke[A],ke}),ye.current[A]&&(clearTimeout(ye.current[A]),delete ye.current[A])):(ue(be=>({...be,[A]:!0})),ye.current[A]&&clearTimeout(ye.current[A]),ye.current[A]=setTimeout(()=>{ue(be=>{const ke={...be};return delete ke[A],ke}),delete ye.current[A]},3e3))};f.useEffect(()=>()=>{Object.values(ye.current).forEach(A=>{clearTimeout(A)})},[]);const{searchTerm:a,setSearchTerm:v,sortFields:R,handleSort:O,filteredAndSortedData:K,loading:fe,selectedTiers:Ne,selectedTypes:Be,showTierDropdown:Ye,setShowTierDropdown:o,showTypeDropdown:I,setShowTypeDropdown:r,tierFilterRef:T,typeFilterRef:ae,uniqueTiers:D,uniqueTypes:Y,handleTierSelect:u,handleTypeSelect:j,isTierFiltered:S,isTypeFiltered:ee,getDropdownStyle:J}=Cr(t,b,m,x,Q,M),me=(()=>{const A=3*m+2,be=b.reduce((oe,We)=>{if(We.type==="adversary"){const $e=dt[We.item.type]||2;if(We.item.type==="Minion"){const s=Math.ceil(We.quantity/m);return oe+s*$e}else return oe+We.quantity*$e}return oe},0);let ke=0;b.filter(oe=>oe.type==="adversary"&&oe.item.type==="Solo"&&oe.quantity>0).reduce((oe,We)=>oe+We.quantity,0)>=2&&(ke+=mt.twoOrMoreSolos);const He=b.some(oe=>oe.type==="adversary"&&oe.item.type==="Bruiser"&&oe.quantity>0),Fe=b.some(oe=>oe.type==="adversary"&&oe.item.type==="Horde"&&oe.quantity>0),De=b.some(oe=>oe.type==="adversary"&&oe.item.type==="Leader"&&oe.quantity>0),Ee=b.some(oe=>oe.type==="adversary"&&oe.item.type==="Solo"&&oe.quantity>0);return!He&&!Fe&&!De&&!Ee&&(ke+=mt.noBruisersHordesLeadersSolos),A+ke-be})(),xe=A=>{V(A),te(!1)},pe=X!=="all";return fe?e.jsx("div",{style:de.browser,children:e.jsx("div",{style:de.loading,children:"Loading..."})}):e.jsx(e.Fragment,{children:e.jsxs("div",{style:i?de.browserWrapper:de.browserWrapperNoContainer,children:[F==="adversaries"&&e.jsxs(e.Fragment,{children:[e.jsx(Sr,{searchTerm:a,onSearchChange:v,type:t,partyControls:$,autoFocus:Oe,onClose:q,placeholder:he}),!se&&e.jsx(wr,{showCustomToggle:re,onToggleCustom:ne,filterCustom:Q,onExportCustomAdversaries:Ve,onImportCustomAdversaries:c}),e.jsx("div",{className:"browser-content invisible-scrollbar",style:de.browserContent,children:e.jsxs("table",{style:de.browserTable,children:[e.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,backgroundColor:"var(--bg-primary)"},children:e.jsx(jr,{sortFields:R,onSort:O,type:t,uniqueTiers:D,uniqueTypes:Y,selectedTiers:Ne,selectedTypes:Be,showTierDropdown:Ye,setShowTierDropdown:o,showTypeDropdown:I,setShowTypeDropdown:r,tierFilterRef:T,typeFilterRef:ae,handleTierSelect:u,handleTypeSelect:j,isTierFiltered:S,isTypeFiltered:ee,getDropdownStyle:J,costFilter:X,showCostDropdown:je,setShowCostDropdown:te,costFilterRef:Re,handleCostFilterSelect:xe,isCostFiltered:pe})}),e.jsx("tbody",{children:K.map(A=>e.jsx(kr,{item:A,onAdd:n,type:t,onRowClick:d,encounterItems:b,pcCount:m,playerTier:x,remainingBudget:me,costFilter:X},A.id))})]})})]}),F==="encounters"&&e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:E.length===0?e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",textAlign:"center",padding:"2rem 1rem"},children:"No saved encounters yet"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:E.map(A=>e.jsxs("div",{onClick:()=>H&&H(A.id),className:"saved-encounter-card",style:{border:"1px solid var(--border)",borderRadius:"8px",padding:"8px",backgroundColor:"var(--bg-card)",transition:"background-color 0.2s ease",display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsxs("div",{style:{minWidth:"100px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",flexDirection:"column",justifyContent:"center",minHeight:"60px"},children:[e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Tier: ",(()=>{var Le,He,Fe,De;const be=((De=(Fe=(He=(Le=A.encounterItems)==null?void 0:Le.filter(Ee=>Ee.type==="adversary"))==null?void 0:He.map(Ee=>Ee.item.tier))==null?void 0:Fe.filter(Ee=>Ee!=null))==null?void 0:De.sort((Ee,Se)=>Ee-Se))||[];if(be.length===0)return"N/A";if(be.length===1)return be[0];const ke=[...new Set(be)];return ke.length===1?ke[0]:`${Math.min(...ke)}-${Math.max(...ke)}`})()]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Party Size: ",A.partySize||4]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)"},children:["Balance: ",(()=>{const be=A.partySize||4,ke=3*be+2;let Le=0;const He=A.encounterItems||[];He.filter(s=>s.type==="adversary"&&s.item.type==="Solo"&&s.quantity>0).reduce((s,l)=>s+l.quantity,0)>=2&&(Le+=mt.twoOrMoreSolos);const De=He.some(s=>s.type==="adversary"&&s.item.type==="Bruiser"&&s.quantity>0),Ee=He.some(s=>s.type==="adversary"&&s.item.type==="Horde"&&s.quantity>0),Se=He.some(s=>s.type==="adversary"&&s.item.type==="Leader"&&s.quantity>0),oe=He.some(s=>s.type==="adversary"&&s.item.type==="Solo"&&s.quantity>0);!De&&!Ee&&!Se&&!oe&&(Le+=mt.noBruisersHordesLeadersSolos);const We=ke+Le,$e=He.reduce((s,l)=>{if(l.type==="adversary"){const z=dt[l.item.type]||2;if(l.item.type==="Minion"){const k=Math.ceil(l.quantity/be);return s+k*z}else return s+l.quantity*z}return s},0);return $e>We?`+${$e-We}`:$e===We?"0":`-${We-$e}`})()]})]}),e.jsx("div",{style:{minWidth:"120px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",alignItems:"center",minHeight:"60px"},children:e.jsx("div",{style:{fontWeight:"500",color:"var(--text-primary)",fontSize:"0.9rem",wordWrap:"break-word",wordBreak:"break-word",width:"150px",maxWidth:"150px"},children:A.name})}),e.jsx(vr,{encounter:A}),e.jsx("button",{onClick:be=>{be.stopPropagation(),h(A.id)},style:{background:N[A.id]?"var(--danger)":"var(--gray-600)",border:"none",color:"white",padding:"0.4rem 0.8rem",borderRadius:"4px",fontSize:"0.75rem",cursor:"pointer",minWidth:"60px",transition:"background-color 0.2s"},children:"Delete"})]},A.id))})}),F==="create"&&e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"1rem",display:"flex",justifyContent:"center",alignItems:"flex-start",height:"100%",minHeight:0},children:e.jsx("div",{style:{maxWidth:"600px",width:"100%",height:"auto",display:"flex",flexDirection:"column",padding:"0",overflowY:"visible",overflowX:"hidden",minHeight:0},children:e.jsx(Mt,{onSave:y,onRefresh:()=>{},onAddItem:n,editingAdversary:w,onCancelEdit:g,embedded:!1})})}),F==="info"&&e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"2rem"},children:[e.jsxs("div",{style:{marginBottom:"2rem",textAlign:"center"},children:[e.jsx("img",{src:gr,alt:"Daggerheart Community Content Logo",style:{width:"100%",maxWidth:"300px",height:"auto",margin:"0 auto 1.5rem auto",display:"block"},onError:A=>{console.error("Failed to load Daggerheart logo:",A.target.src),A.target.style.display="none"}}),e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",textAlign:"left",maxWidth:"600px",margin:"0 auto"},children:[e.jsx("p",{style:{marginTop:0},children:"This product includes materials from the Daggerheart System Reference Document 1.0, © Critical Role, LLC, under the terms of the Darrington Press Community Gaming (DPCGL) License."}),e.jsxs("p",{children:["More information can be found at ",e.jsx("a",{href:"https://www.daggerheart.com",target:"_blank",rel:"noopener noreferrer",style:{color:"var(--purple)",textDecoration:"underline"},children:"daggerheart.com"})]}),e.jsx("p",{style:{marginBottom:0},children:e.jsx("em",{children:"This project is unofficial and not endorsed by Darrington Press or Critical Role."})})]})]}),e.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto",border:"1px solid var(--border)",borderRadius:"8px",overflow:"hidden"},children:[e.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"1rem 1.5rem",color:"var(--text-primary)",border:"none",background:"var(--bg-secondary)",width:"100%",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"0.875rem",borderBottom:"1px solid var(--border)"},onMouseEnter:A=>{A.target.style.backgroundColor="var(--bg-hover)"},onMouseLeave:A=>{A.target.style.backgroundColor="var(--bg-secondary)"},onClick:A=>{A.stopPropagation(),window.open("https://github.com/Splinter714/Daggerheart","_blank")},children:[e.jsx("span",{children:"View on GitHub"}),e.jsx("span",{children:"→"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem 1.5rem",color:"var(--text-secondary)",background:"var(--bg-secondary)",fontSize:"0.875rem"},children:["Version ","0.4.8 (74bcbfe)"]})]})]})]})})},de={browserWrapper:{display:"flex",flexDirection:"column",background:"var(--bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border)",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserWrapperNoContainer:{display:"flex",flexDirection:"column",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserContent:{flex:1,overflowY:"auto",overflowX:"visible",padding:0,width:"100%",scrollbarWidth:"none",msOverflowStyle:"none",borderRadius:"0 0 8px 8px"},tableHeaderContainer:{flexShrink:0,position:"sticky",top:0,zIndex:15,backgroundColor:"var(--bg-secondary)"},browserTable:{width:"100%",minWidth:"100%",borderCollapse:"collapse",tableLayout:"fixed",background:"var(--bg-primary)",margin:0},browserHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--gray-900)",flexShrink:0,position:"sticky",top:0,zIndex:20},browserTitle:{margin:0,color:"var(--text-primary)",fontSize:"18px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"24px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",marginRight:"12px",transition:"all 0.2s ease"},partyControls:{display:"flex",alignItems:"center",gap:"12px",flexShrink:0},searchInputFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 3px rgba(139, 92, 246, 0.1)"},tableHeader:{background:"var(--gray-900)",borderBottom:"1px solid var(--border)",boxShadow:"0 1px 0 var(--border)",position:"sticky",top:"0",zIndex:10},tableHeaderCell:{backgroundColor:"var(--gray-900)",fontWeight:"700",borderBottom:"1px solid var(--border)",cursor:"pointer",userSelect:"none",minWidth:"100px",whiteSpace:"nowrap",padding:"4px 4px",color:"var(--text-primary)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",boxShadow:"0 1px 0 var(--border)",transition:"background-color 0.2s",position:"sticky",top:"0",zIndex:10},tableHeaderCellHover:{backgroundColor:"var(--bg-hover)"},sortIndicator:{fontSize:"12px",color:"var(--text-secondary)"},tableBody:{flex:1,overflowY:"auto",padding:"8px",backgroundColor:"var(--bg-primary)"},row:{height:"35px",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s ease",cursor:"pointer",backgroundColor:"var(--gray-900)"},rowHover:{backgroundColor:"var(--bg-secondary)"},expandedRow:{backgroundColor:"var(--bg-secondary)"},rowCell:{padding:"4px 4px",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid var(--border)"},rowCellName:{fontWeight:"500",minWidth:"150px"},rowCellCenter:{textAlign:"center",justifyContent:"center",minWidth:"80px"},rowActions:{width:"80px",textAlign:"center",padding:"4px 8px",borderBottom:"1px solid var(--border)"},addButton:{width:"2rem",height:"2rem",border:"1px solid var(--purple)",borderRadius:"var(--radius-sm)",background:"var(--purple)",color:"white",cursor:"pointer",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"500"},expandedContent:{padding:"0",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)"},columnName:{width:"auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",paddingLeft:"8px",textAlign:"left"},columnTier:{width:"80px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnType:{width:"100px",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},columnDifficulty:{width:"40px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnAction:{width:"32px",minWidth:"24px",maxWidth:"24px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"visible",textOverflow:"unset"},loading:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"var(--text-primary)",fontSize:"16px"},mobileBrowser:{width:"95vw",height:"90vh",maxWidth:"none"},mobileSearchInput:{fontSize:"16px"},headerWithFilter:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0px",position:"relative"},headerFilterIcon:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"2px 4px",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",position:"relative",marginLeft:"-2px"},headerFilterIconActive:{color:"var(--purple)"},filterIcon:{fontSize:"12px"},filterActiveDot:{position:"absolute",left:"50%",top:"2px",transform:"translateX(-50%)",width:"4px",height:"4px",borderRadius:"50%",background:"var(--purple)",pointerEvents:"none"},filterDropdown:{position:"fixed",background:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",zIndex:99999,marginTop:"4px",overflow:"hidden",width:"max-content",minWidth:"120px",maxWidth:"200px"},filterOption:{padding:"8px 12px",cursor:"pointer",color:"var(--text-primary)",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background-color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},filterOptionSelected:{backgroundColor:"var(--bg-hover)"},checkIcon:{width:"16px",height:"16px",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"12px"},filterLabel:{flex:1}},Ir=()=>e.jsx("div",{className:"pwa-install-prompt",style:{}}),St=({side:t="left",children:n,className:p="",style:d={}})=>{const b=t==="left",m={flex:1,minWidth:0,background:"var(--bg-primary)",overflowY:"auto",overflowX:b?"auto":"hidden",display:b?"block":"flex",flexDirection:b?"initial":"column",height:"100%",padding:b?"8px 0 8px 0":"0 8px 0 0",...d};return e.jsx("div",{className:p,style:m,children:n})},Ar=t=>3*t+2,Er={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},wt={lessDifficult:-1,twoOrMoreSolos:-2,increasedDamage:-2,lowerTierAdversary:1,noBruisersHordesLeadersSolos:1,moreDangerous:2},Mr=({isOpen:t,onClose:n,onAddAdversary:p,onAddAdversariesBulk:d,onAddEnvironment:b,onDeleteAdversary:m,onDeleteEnvironment:x,onDeleteCountdown:$,adversaries:i=[],environments:E=[],countdowns:H=[],savedEncounters:W=[],onSaveEncounter:F,onLoadEncounter:C,onDeleteEncounter:P})=>{const{partySize:Z,updatePartySize:_,currentEncounterName:G,updateCurrentEncounterName:Q,customContent:re}=Et(),ne=Z,Te=_,[ze,Oe]=f.useState({lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),[se,q]=f.useState([]),[he,Ae]=f.useState(G||"Encounter"),[ce,M]=f.useState("adversaries"),[w,U]=f.useState(null),[X,V]=f.useState(null),[je,te]=f.useState(null),[N,ue]=f.useState(null),[ye,Re]=f.useState(!1);f.useEffect(()=>{t&&!w&&Ae(G||"Encounter")},[t,w,G]);const Ve=()=>X?he!==X.name||JSON.stringify(se)!==JSON.stringify(X.encounterItems)||ne!==X.partySize||JSON.stringify(ze)!==JSON.stringify(X.battlePointsAdjustments):!1,c=()=>{var u;if(se.length>0||(he||"").trim()!=="Encounter")return!0;if(w&&Ve()){if(X){const j=se.length,S=((u=X.encounterItems)==null?void 0:u.length)||0;if(j!==S||(he||"").trim()!==(X.name||""))return!0;const ee=JSON.stringify(ze),J=JSON.stringify(X.battlePointsAdjustments||{});return ee!==J}return!0}return!1},g=({onClick:u,children:j,variant:S="secondary",isConfirmation:ee=!1})=>{const J=S==="danger"||S==="secondary"&&ee,ve=S==="purple";return e.jsx("button",{onClick:u,style:{background:J?"var(--danger)":ve?"var(--purple)":"var(--bg-secondary)",border:ve?"none":"1px solid var(--border)",color:J||ve?"white":"var(--text-primary)",padding:"0.375rem 0.75rem",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s",width:"70px",fontSize:"0.875rem"},children:j})},y=rt.useRef(ne),h=f.useCallback(u=>!u||u.length===0?null:W.find(S=>{var me,xe;if(((me=S.encounterItems)==null?void 0:me.length)!==u.length)return!1;const ee=pe=>{var A;return{type:pe.type,quantity:pe.quantity,item:{name:pe.item.baseName||((A=pe.item.name)==null?void 0:A.replace(/\s+\(\d+\)$/,""))||pe.item.name,type:pe.item.type,tier:pe.item.tier}}},J=(xe=S.encounterItems)==null?void 0:xe.map(ee).sort((pe,A)=>pe.item.name.localeCompare(A.item.name)||pe.item.type.localeCompare(A.item.type)),ve=u.map(ee).sort((pe,A)=>pe.item.name.localeCompare(A.item.name)||pe.item.type.localeCompare(A.item.type));return JSON.stringify(J)===JSON.stringify(ve)})||null,[W]);rt.useEffect(()=>{if(t&&i.length>0&&se.length===0){const u={};i.forEach(ee=>{var ve;const J=ee.baseName||((ve=ee.name)==null?void 0:ve.replace(/\s+\(\d+\)$/,""))||ee.name;u[J]||(u[J]={type:"adversary",item:ee,quantity:0}),u[J].quantity+=1});const j=Object.values(u);q(j);const S=h(j);S&&!w&&(U(S.id),V({name:S.name||"",encounterItems:S.encounterItems||[],partySize:S.partySize||4,battlePointsAdjustments:S.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),Ae(S.name||"Encounter"),Q(S.name||"Encounter"))}else t&&i.length===0&&se.length===0&&q([])},[t,h,w,Q]);const a=rt.useMemo(()=>{let u=0;se.filter(me=>me.type==="adversary"&&me.item.type==="Solo"&&me.quantity>0).reduce((me,xe)=>me+xe.quantity,0)>=2&&(u+=wt.twoOrMoreSolos);const S=se.some(me=>me.type==="adversary"&&me.item.type==="Bruiser"&&me.quantity>0),ee=se.some(me=>me.type==="adversary"&&me.item.type==="Horde"&&me.quantity>0),J=se.some(me=>me.type==="adversary"&&me.item.type==="Leader"&&me.quantity>0),ve=se.some(me=>me.type==="adversary"&&me.item.type==="Solo"&&me.quantity>0);return!S&&!ee&&!J&&!ve&&(u+=wt.noBruisersHordesLeadersSolos),u},[se]),v=Ar(ne),R=Object.entries(ze).filter(([u,j])=>j).reduce((u,[j,S])=>u+wt[j],0),O=v+R+a,K=se.reduce((u,j)=>{if(j.type==="adversary"){const S=Er[j.item.type]||2;return j.item.type==="Minion"?u+Math.ceil(j.quantity/ne)*S:u+S*j.quantity}return u},0);rt.useEffect(()=>{const u=y.current;u!==ne&&(q(j=>j.map(S=>{if(S.type==="adversary"&&S.item.type==="Minion"){const J=Math.ceil(S.quantity/u)*ne;return{...S,quantity:J}}return S})),y.current=ne)},[ne]);const fe=(u,j)=>{const S=se.findIndex(ve=>ve.item.id===u.id&&ve.type===j),ee=u.type==="Minion"?ne:1;let J;S>=0?J=se.map((ve,me)=>me===S?{...ve,quantity:ve.quantity+ee}:ve):J=[...se,{item:u,type:j,quantity:ee}],q(J),Ne(J)},Ne=u=>{const j=i||[],S=[];u.forEach(xe=>{for(let pe=0;pe<xe.quantity;pe++)xe.type==="adversary"&&S.push(xe.item)});const ee={};j.forEach(xe=>{var A;const pe=xe.baseName||((A=xe.name)==null?void 0:A.replace(/\s+\(\d+\)$/,""))||xe.name;ee[pe]||(ee[pe]=[]),ee[pe].push(xe)});const J={};S.forEach(xe=>{var A;const pe=xe.baseName||((A=xe.name)==null?void 0:A.replace(/\s+\(\d+\)$/,""))||xe.name;J[pe]||(J[pe]=[]),J[pe].push(xe)});const ve=[],me=[];Object.keys(J).forEach(xe=>{var be;const pe=((be=ee[xe])==null?void 0:be.length)||0,A=J[xe].length;if(A>pe){const ke=A-pe;for(let Le=0;Le<ke;Le++)ve.push(J[xe][0])}else if(A<pe){const ke=pe-A,He=[...ee[xe]].sort((Fe,De)=>{const Ee=Fe.duplicateNumber||1;return(De.duplicateNumber||1)-Ee});for(let Fe=0;Fe<ke;Fe++)me.push(He[Fe].id)}}),Object.keys(ee).forEach(xe=>{J[xe]||[...ee[xe]].sort((be,ke)=>{const Le=be.duplicateNumber||1;return(ke.duplicateNumber||1)-Le}).forEach(be=>{me.push(be.id)})}),me.forEach(xe=>{m(xe)}),ve.length>0&&d(ve)},Be=(u,j)=>{const S=(()=>{const ee=se.findIndex(J=>J.item.id===u&&J.type===j);if(ee>=0){const J=se[ee];if(J.quantity===0)return se.filter((xe,pe)=>pe!==ee);const ve=J.item.type==="Minion"?ne:1,me=Math.max(0,J.quantity-ve);return se.map((xe,pe)=>pe===ee?{...xe,quantity:me}:xe)}return se})();q(S),Ne(S)},Ye=f.useCallback(()=>{if(se.length===0)return null;const u=(he||"").trim()||"Encounter",j=W.find(S=>{var ve,me;if(S.name!==u||((ve=S.encounterItems)==null?void 0:ve.length)!==se.length)return!1;const ee=JSON.stringify((me=S.encounterItems)==null?void 0:me.sort()),J=JSON.stringify([...se].sort());return ee===J});return(j==null?void 0:j.id)||null},[W,he,se]),o=f.useCallback(()=>{let u=(he||"").trim(),j=w;if(j||(j=Ye()),se.length===0&&(!u||u==="Encounter")&&j){P(j),U(null),V(null);return}const S={name:u,encounterItems:se,partySize:ne,battlePointsAdjustments:ze};if(j){S.id=j;const ee=F(S);U(ee)}else{const ee=F(S);U(ee)}V({name:u,encounterItems:se,partySize:ne,battlePointsAdjustments:ze})},[se,he,ne,ze,w,F,Ye,P]);f.useEffect(()=>{if(w&&Ve()){const u=setTimeout(()=>{o()},2e3);return()=>clearTimeout(u)}else if(!w&&se.length>0&&he&&he.trim()!==""){const u=setTimeout(()=>{o()},2e3);return()=>clearTimeout(u)}},[se,w,he,ze,ne]);const I=()=>{c()&&(q([]),Ae("Encounter"),Q("Encounter"),U(null),V(null),i.forEach(u=>{m(u.id)}),E.forEach(u=>{x(u.id)}),H.forEach(u=>{$(u.id)}))},r=u=>{const j=C(u);if(j){const S=j.encounterItems||[];q(S),Te(j.partySize||4),Oe(j.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),Ae(j.name||""),Q(j.name||""),U(u),V({name:j.name||"",encounterItems:j.encounterItems||[],partySize:j.partySize||4,battlePointsAdjustments:j.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),Ne(S)}},T=u=>{P(u),w===u&&(q([]),Ae("Encounter"),Q("Encounter"),U(null),V(null),i.forEach(j=>{m(j.id)}),E.forEach(j=>{x(j.id)}),H.forEach(j=>{$(j.id)}))},ae=()=>{try{const u={version:"1.0",exportDate:new Date().toISOString(),customAdversaries:re.adversaries||[]},j=JSON.stringify(u,null,2),S=new Blob([j],{type:"application/json"}),ee=URL.createObjectURL(S),J=document.createElement("a");J.href=ee,J.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(J),J.click(),document.body.removeChild(J),URL.revokeObjectURL(ee),console.log("Custom adversaries exported successfully")}catch(u){console.error("Failed to export custom adversaries:",u),alert("Failed to export custom adversaries. Please try again.")}},D=u=>{const j=u.target.files[0];if(!j)return;const S=new FileReader;S.onload=ee=>{try{const J=JSON.parse(ee.target.result);if(!J.customAdversaries||!Array.isArray(J.customAdversaries))throw new Error("Invalid file format. Expected customAdversaries array.");const ve=re.adversaries||[],me=J.customAdversaries,xe=[...ve];let pe=0;me.forEach(A=>{ve.some(ke=>ke.name===A.name&&ke.type===A.type)||(xe.push({...A,id:`custom-${Date.now()}-${Math.random().toString(36).slice(2,10)}`}),pe++)}),updateCustomContent("adversary",null,xe),pe>0?alert(`Successfully imported ${pe} custom adversaries.`):alert("No new adversaries were added. All imported adversaries already exist.")}catch(J){console.error("Failed to import custom adversaries:",J),alert("Failed to import custom adversaries. Please check the file format and try again.")}},S.readAsText(j),u.target.value=""};if(!t)return null;const Y=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://");return e.jsx("div",{onClick:n,className:"encounter-builder-modal",style:{position:"fixed",top:0,left:0,right:0,bottom:Y?"calc(60px + env(safe-area-inset-bottom) + 1rem)":"calc(60px + env(safe-area-inset-bottom))",backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:1e3,display:"flex",alignItems:"flex-start",justifyContent:"center",padding:"12px"},children:e.jsxs("div",{onClick:u=>u.stopPropagation(),style:{backgroundColor:"var(--bg-primary)",border:"2px solid var(--border)",borderRadius:"12px",width:"100%",maxWidth:"1200px",height:"100%",maxHeight:"100%",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"},children:[e.jsxs("div",{className:"encounter-top-bar",style:{flex:"0 0 auto",display:"flex",alignItems:"center",height:"39px",backgroundColor:"var(--bg-primary)",borderBottom:"1px solid var(--border)"},children:[e.jsx("button",{onClick:()=>M("adversaries"),style:{flex:1,background:ce==="adversaries"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:ce==="adversaries"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Builder"}),e.jsx("button",{onClick:()=>M("encounters"),style:{flex:1,background:ce==="encounters"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:ce==="encounters"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Saved Encounters"}),e.jsx("button",{onClick:()=>M("create"),style:{flex:1,background:ce==="create"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:ce==="create"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Create Adversary"}),e.jsx("button",{onClick:()=>M("info"),style:{flex:1,background:ce==="info"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:ce==="info"?"500":"400",transition:"all 0.2s ease",position:"relative"},children:"Info"})]}),e.jsxs("div",{className:"encounter-builder-content",style:{flex:1,display:"flex",overflow:"hidden"},children:[e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",borderTop:"1px solid var(--border)"},children:e.jsx(Vt,{type:"adversary",onAddItem:u=>fe(u,"adversary"),encounterItems:se,pcCount:ne,showContainer:!1,savedEncounters:W,onLoadEncounter:r,onDeleteEncounter:T,activeTab:ce,selectedCustomAdversaryId:je,onSelectCustomAdversary:te,onTabChange:M,selectedAdversary:N,onSelectAdversary:ue,filterCustom:ye,showCustomToggle:!0,onToggleCustom:Re,onExportCustomAdversaries:ae,onImportCustomAdversaries:D})}),ce!=="info"&&e.jsxs("div",{className:"encounter-right-panel",style:{flex:1,borderLeft:"1px solid var(--border)",display:"flex",flexDirection:"column",overflow:"hidden",position:"relative"},children:[N&&e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"var(--bg-primary)",zIndex:10,display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)",flexShrink:0},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:0},children:"Adversary Preview"}),e.jsx("button",{onClick:()=>ue(null),style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease"},onMouseEnter:u=>u.target.style.color="var(--text-primary)",onMouseLeave:u=>u.target.style.color="var(--text-secondary)",title:"Close preview",children:e.jsx(ot,{size:16})})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"0.75rem"},children:e.jsx(ht,{item:{...N,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...N,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}})})]}),(ce==="adversaries"||ce==="encounters")&&e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-primary)",flexShrink:0},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:he,onChange:u=>{Ae(u.target.value),Q(u.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(g,{onClick:I,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:c()?1:.5,cursor:c()?"pointer":"not-allowed"},children:"New"})]})}),(ce==="adversaries"||ce==="encounters")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"encounter-receipt-buttons-vertical",style:{display:"none",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:he,onChange:u=>{Ae(u.target.value),Q(u.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(g,{onClick:I,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:c()?1:.5,cursor:c()?"pointer":"not-allowed"},children:"New"})]})}),e.jsx("div",{className:"receipt-content",style:{padding:"1rem",display:"flex",flexDirection:"column",height:"100%"},children:e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"flex-start",overflowY:"auto",marginBottom:"0.75rem"},children:[e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>Te(Math.max(1,ne-1)),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(ft,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:ne}),e.jsx("button",{onClick:()=>Te(ne+1),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(at,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Party Size"})}),e.jsx("div",{style:{width:"120px",textAlign:"right"}})]}),se.map(u=>{var j;return u.type!=="adversary"?null:e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>Be(u.item.id,u.type),style:{background:u.quantity===0?"var(--danger)":"var(--bg-secondary)",border:u.quantity===0?"none":"1px solid var(--border)",color:u.quantity===0?"white":"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:u.quantity===0?e.jsx(ot,{size:10}):e.jsx(ft,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:u.quantity}),e.jsx("button",{onClick:()=>fe(u.item,u.type),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(at,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:u.item.baseName||((j=u.item.name)==null?void 0:j.replace(/\s+\(\d+\)$/,""))||u.item.name})}),e.jsx("div",{style:{width:"80px",textAlign:"right"},children:e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.8rem"},children:u.item.type})})]},`${u.item.id}-${u.type}`)}),e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Balance"})}),e.jsx("div",{style:{width:"120px",textAlign:"right",display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsx("span",{style:{color:K>O?"var(--danger)":K===O?"var(--purple)":"var(--success)",fontWeight:600},children:K>O?`+${K-O}`:O-K===0?"0":`-${O-K}`})})]})]})})]}),ce==="create"&&e.jsxs("div",{style:{padding:"1.5rem",overflowY:"auto",height:"100%"},children:[e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Creating Adversaries"}),e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsx("p",{children:"Use the form to create custom adversaries for your encounters."}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Adversary Types:"}),e.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Minion (1 BP):"})," Weak enemies in groups"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Standard (2 BP):"})," Average threat level"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Leader (3 BP):"})," Commands others"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Bruiser (4 BP):"})," High HP tank"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Solo (5 BP):"})," Boss-level threat"]})]})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Tips:"}),e.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[e.jsx("li",{children:"Match adversary tier to party level"}),e.jsx("li",{children:"Balance encounter difficulty with Battle Points"}),e.jsx("li",{children:"Mix adversary types for variety"}),e.jsx("li",{children:"Add features that create interesting choices"})]})]})]})]}),ce==="myAdversaries"&&e.jsx("div",{style:{padding:"0.75rem",overflowY:"auto",height:"100%"},children:je?(()=>{var j;const u=(j=re==null?void 0:re.adversaries)==null?void 0:j.find(S=>S.id===je);return u?e.jsx(ht,{item:{...u,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...u,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}}):e.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Adversary not found"})})():e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Adversary Preview"}),e.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Select an adversary to view details"})]})})]})]})]})})},Tr=({browserOpenAtPosition:t,handleCloseBrowser:n,handleOpenBrowser:p,getEntityGroups:d,fear:b,updateFear:m})=>{const x=f.useMemo(()=>({"shift+space":()=>{if(t!==null)n();else{const i=d();p(i.length)}},escape:()=>{t!==null&&n()},"+":()=>{const i=(b==null?void 0:b.value)||0,E=Math.min(12,i+1);m(E)},"=":()=>{const i=(b==null?void 0:b.value)||0,E=Math.min(12,i+1);m(E)},"-":()=>{const i=(b==null?void 0:b.value)||0,E=Math.max(0,i-1);m(E)},_:()=>{const i=(b==null?void 0:b.value)||0,E=Math.max(0,i-1);m(E)}}),[t,n,p,d,b,m]),$=f.useCallback(i=>{if(window.matchMedia("(max-width: 800px)").matches)return;const H=i.key===" "||i.key==="Space"||i.code==="Space";if(i.shiftKey&&H&&!i.ctrlKey&&!i.metaKey&&!i.altKey){if(console.log("[Keyboard] Shift+Space detected, toggling browser"),i.preventDefault(),i.stopPropagation(),i.stopImmediatePropagation(),t!==null)n();else{const G=d();p(G.length)}return}const F=document.activeElement;if(F&&["INPUT","TEXTAREA","SELECT"].includes(F.tagName)){const G=i.key==="Escape",Q=i.shiftKey&&H&&!i.ctrlKey&&!i.metaKey&&!i.altKey;if(!G&&!Q)return}const P=[];(i.ctrlKey||i.metaKey)&&P.push("ctrl"),i.shiftKey&&P.push("shift"),i.altKey&&P.push("alt");let Z=i.key.toLowerCase();Z===" "&&(Z="space"),P.push(Z);const _=P.join("+");if(x[_]){i.preventDefault(),x[_](i);return}if(!i.ctrlKey&&!i.metaKey&&!i.shiftKey&&!i.altKey&&x[Z]){i.preventDefault(),x[Z](i);return}},[x,t,n,p,d]);f.useEffect(()=>(document.addEventListener("keydown",$,!0),()=>{document.removeEventListener("keydown",$,!0)}),[$])},zr=t=>3*t+2,Rr={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},Pt={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1};class Nr extends rt.Component{constructor(n){super(n),this.state={hasError:!1,error:null}}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,p){console.error("ErrorBoundary caught an error:",n,p)}render(){var n;return this.state.hasError?e.jsxs("div",{className:"p-md text-red",children:[e.jsx("h3",{children:"Something went wrong:"}),e.jsx("pre",{children:(n=this.state.error)==null?void 0:n.toString()}),e.jsx("button",{className:"btn-base btn-text",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try again"})]}):this.props.children}}const Wr=()=>{const{adversaries:t,environments:n,countdowns:p,fear:d,savedEncounters:b,partySize:m,customContent:x,updatePartySize:$,updateFear:i,createAdversary:E,createAdversariesBulk:H,updateAdversary:W,deleteAdversary:F,addCustomAdversary:C,updateCustomAdversary:P,createEnvironment:Z,updateEnvironment:_,deleteEnvironment:G,createCountdown:Q,updateCountdown:re,deleteCountdown:ne,advanceCountdown:Te,saveEncounter:ze,loadEncounter:Oe,deleteEncounter:se}=Et(),q=m||4,[he,Ae]=f.useState(!1),[ce,M]=f.useState(!1);f.useState(!1),f.useState(!1),f.useState(!0);const[w,U]=f.useState(null),[X,V]=f.useState(null),[je,te]=f.useState(null),[N,ue]=f.useState(!1),[ye,Re]=f.useState("adversaries"),[Ve,c]=f.useState(null),[g,y]=f.useState(0),[h,a]=f.useState(0),[v,R]=f.useState(!1);f.useState(new Set);const[O,K]=f.useState(new Set),[fe,Ne]=f.useState(null),[Be,Ye]=f.useState(!1),o=f.useRef(null),I=f.useRef(q);f.useEffect(()=>{const s=I.current;if(s!==q&&s>0){const l={};t.forEach(z=>{var L;const k=z.baseName||((L=z.name)==null?void 0:L.replace(/\s+\(\d+\)$/,""))||z.name;l[k]||(l[k]={type:"adversary",baseName:k,instances:[]}),l[k].instances.push(z)}),Object.values(l).forEach(z=>{if(z.type==="adversary"&&z.instances.length>0){const k=z.instances[0];if(k.type==="Minion"){const L=z.instances.length,ie=Math.ceil(L/s)*q;if(ie!==L)if(ie>L){const B=ie-L,ge=Array(B).fill(null).map(()=>({...k}));H(ge)}else{const B=L-ie;z.instances.slice(-B).forEach(we=>{F(we.id)})}}}}),I.current=q}else(s===0||I.current===0)&&(I.current=q)},[q]),f.useEffect(()=>{const s=()=>{const z=window.matchMedia("(max-width: 800px)");Ae(z.matches)};s();const l=window.matchMedia("(max-width: 800px)");return l.addEventListener("change",s),()=>l.removeEventListener("change",s)},[]);const r=12,T=s=>s===1?200:350,ae=s=>{if(s<=0)return{visibleColumns:1,columnWidth:T(1)};const l=r*2;let z=s-l,k=0,L={visibleColumns:1,columnWidth:z};for(let Ce=0;Ce<5;Ce++){const ie=z-k;let B={visibleColumns:1,columnWidth:ie};for(let le=1;le<=5;le++){const Ie=(le-1)*r,_e=(ie-Ie)/le;_e>=T(le)&&le*_e+Ie<=ie&&(B={visibleColumns:le,columnWidth:_e})}B.visibleColumns*B.columnWidth+(B.visibleColumns-1)*r>ie&&(B={visibleColumns:1,columnWidth:ie});const we=B.columnWidth+r;if(Math.abs(we-k)<.1)return B;k=we,L=B}return L},{visibleColumns:D,columnWidth:Y}=ae(g);f.useEffect(()=>{const s=()=>{y(window.innerWidth)};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]);const u=f.useCallback(()=>{M(!1)},[]),j=f.useCallback(s=>{let l=!1;if(o.current){const z=o.current,k=z.scrollLeft,L=z.scrollWidth-z.clientWidth;l=Math.abs(k-L)<1,l&&(z._wasAtMaxScrollOnBrowserOpen=!0)}V(s)},[]);f.useEffect(()=>{X!==null&&o.current&&o.current._wasAtMaxScrollOnBrowserOpen&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(o.current){const z=o.current,k=z.scrollWidth-z.clientWidth;z.scrollLeft=k,z._wasAtMaxScrollOnBrowserOpen=!1}})})},[X,Y,r]);const S=f.useCallback(()=>{V(null),Re("adversaries")},[]),ee=f.useCallback((s,l=500,z="unknown")=>{if(console.log("[HORIZONTAL_SCROLL] smoothScrollTo called:",{targetScrollLeft:s,duration:l,reason:z,timestamp:performance.now()}),!o.current){console.log("[HORIZONTAL_SCROLL] No container ref, aborting");return}const k=o.current,L=k.scrollLeft,Ce=s-L;if(console.log("[HORIZONTAL_SCROLL] Scroll params:",{startScrollLeft:L,targetScrollLeft:s,distance:Ce,containerWidth:k.clientWidth,scrollWidth:k.scrollWidth}),Math.abs(Ce)<1){console.log("[HORIZONTAL_SCROLL] Distance too small, skipping animation");return}k._horizontalScrollAnimationId&&(console.log("[HORIZONTAL_SCROLL] Canceling existing animation"),cancelAnimationFrame(k._horizontalScrollAnimationId),k._horizontalScrollAnimationId=null);const B=window.getComputedStyle(k).scrollSnapType!=="none",ge=B?"x mandatory":null;console.log("[HORIZONTAL_SCROLL] Scroll-snap state:",{hasScrollSnap:B,originalScrollSnapType:ge}),B&&(k.style.scrollSnapType="none");const we=performance.now();console.log("[HORIZONTAL_SCROLL] Starting animation at:",we);const le=Ie=>{const _e=Ie-we,Xe=Math.min(_e/l,1),Pe=1-Xe,Ge=1-Pe*Pe*Pe;if(k){const Me=L+Ce*Ge;k.scrollLeft=Me}Xe<1?k._horizontalScrollAnimationId=requestAnimationFrame(le):(console.log("[HORIZONTAL_SCROLL] Animation complete, final scrollLeft:",k.scrollLeft),k&&(k.scrollLeft=s,k._horizontalScrollAnimationId=null))};return k._horizontalScrollAnimationId=requestAnimationFrame(le),()=>{animationId&&cancelAnimationFrame(animationId),B&&k&&(k.style.scrollSnapType=ge||"")}},[]),J=f.useCallback(()=>{const s={};return t.forEach(l=>{var k;const z=l.baseName||((k=l.name)==null?void 0:k.replace(/\s+\(\d+\)$/,""))||l.name;s[z]||(s[z]={type:"adversary",baseName:z,instances:[]}),s[z].instances.push(l)}),p.forEach(l=>{s[`countdown-${l.id}`]={type:"countdown",baseName:l.name,instances:[l]}}),Object.values(s)},[t,p]),ve=J();Tr({browserOpenAtPosition:X,handleCloseBrowser:S,handleOpenBrowser:j,getEntityGroups:J,fear:d,updateFear:i});const me=f.useCallback(s=>{var Ie,_e,Xe;const l=s.baseName||((Ie=s.name)==null?void 0:Ie.replace(/\s+\(\d+\)$/,""))||s.name,k=!ve.find(Pe=>Pe.baseName===l&&Pe.type==="adversary"),L=s.type==="Minion",Ce=L?q:1,ie=performance.now(),B=((_e=o.current)==null?void 0:_e.scrollWidth)??0,ge=((Xe=o.current)==null?void 0:Xe.scrollLeft)??0,we=o.current;let le=!1;if(we&&k&&window.getComputedStyle(we).scrollSnapType!=="none"&&(we.style.scrollSnapType="none",le=!0,console.log("[ADVERSARY_ADD] Disabled scroll-snap before adding adversary to prevent auto-scroll")),console.log("[ADVERSARY_ADD] handleAddAdversaryFromBrowser called:",{baseName:l,isNewAdversary:k,isMinion:L,instancesToAdd:Ce,timestamp:ie,currentScroll:ge,scrollWidth:B,scrollSnapDisabled:le}),L&&Ce>1){const Pe=Array(Ce).fill(null).map(()=>({...s}));H(Pe)}else E(s);if(U("adversary"),k){const Pe=`adversary-${l}`;K(Ge=>new Set(Ge).add(Pe)),setTimeout(()=>{K(Ge=>{const Me=new Set(Ge);return Me.delete(Pe),Me})},10)}setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!o.current)return;const Pe=o.current;if(!(Pe.scrollWidth<=Pe.clientWidth))if(k){const Ge=Pe.scrollWidth;setTimeout(()=>{if(!o.current)return;const Me=o.current;if(Me.scrollWidth!==Ge)requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!o.current)return;const Ke=o.current,Je=Ke.scrollWidth-Ke.clientWidth,Ue=Ke.scrollLeft,Ze=Je-ge,ct=Ke.scrollWidth>B;console.log("[HORIZONTAL_SCROLL] New adversary added, scrollWidth stabilized:",{maxScroll:Je,scrollWidth:Ke.scrollWidth,clientWidth:Ke.clientWidth,scrollWidthBeforeAdd:B,scrollLeftBeforeAdd:ge,currentScroll:Ue,scrollChanged:Ue!==ge,scrollWidthIncreased:ct,distance:Ze}),ct&&Math.abs(Ze)<1?ee(Je+10,500,"new-adversary"):Math.abs(Ze)>1&&ee(Je,500,"new-adversary")})});else{const Ke=Me.scrollWidth-Me.clientWidth,Je=Me.scrollLeft,Ue=Ke-ge,Ze=Me.scrollWidth>B;console.log("[HORIZONTAL_SCROLL] New adversary added, scrollWidth stable:",{maxScroll:Ke,scrollWidth:Me.scrollWidth,clientWidth:Me.clientWidth,scrollWidthBeforeAdd:B,scrollLeftBeforeAdd:ge,currentScroll:Je,scrollChanged:Je!==ge,scrollWidthIncreased:Ze,distance:Ue}),Ze&&Math.abs(Ue)<1?ee(Ke+10,500,"new-adversary"):Math.abs(Ue)>1&&ee(Ke,500,"new-adversary")}},10)}else{const Me=J().findIndex(Qe=>Qe.baseName===l&&Qe.type==="adversary");if(Me>=0){const Qe=o.current,Ke=Qe.scrollLeft,Je=Qe.clientWidth,Ue=X!==null?Je-(Y+r):Je,Ze=Me*(Y+r),ct=Ze+Y+r,Tt=10;Ze>=Ke-Tt&&ct<=Ke+Ue+Tt||ee(Ze,500)}}})})},50)},[E,ve,Y,r,ee,J,X]),xe=f.useCallback(()=>{const l="Standard",z=lt(1,l),k={name:"",baseName:"",tier:1,type:l,description:"",motives:"",difficulty:z.difficulty,thresholds:z.thresholds,hpMax:z.hpMax,stressMax:z.stressMax,atk:z.atk,weapon:"",range:z.range,damage:z.damage,experience:[],features:[],source:"Homebrew",hp:0,stress:0,isVisible:!0};E(k),setTimeout(()=>{const L=J();for(const Ce of L)if(Ce.type==="adversary"){const ie=Ce.instances.find(B=>B.source==="Homebrew"&&(!B.baseName||B.baseName.trim()===""||B.baseName==="Unknown"));if(ie&&!je){te(ie.id),requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(o.current){o.current;const B=L.findIndex(ge=>ge.instances.some(we=>we.id===ie.id));if(B>=0){const ge=B*(Y+r);ee(ge,600,"new-custom-adversary")}}})});break}}},100)},[E,J,Y,r,ee,je]),pe=f.useCallback(s=>{te(s),ue(!1)},[]),A=f.useCallback(()=>{te(null),ue(!1)},[]),be=f.useCallback(async(s,l)=>{var z,k;if(l){const L=t.find(ie=>ie.id===l);if((L==null?void 0:L.source)==="Homebrew"||(L==null?void 0:L.isCustom)){const ie=L==null?void 0:L.customContentId,B=L==null?void 0:L.baseName,ge=ie?(z=x==null?void 0:x.adversaries)==null?void 0:z.find(we=>we.id===ie):(k=x==null?void 0:x.adversaries)==null?void 0:k.find(we=>we.baseName===B&&(we.source==="Homebrew"||we.isCustom));if(ge){const we={...s,name:s.baseName||s.name};P(ge.id,we);const le=s.baseName||(L==null?void 0:L.baseName);t.forEach(Ie=>{(Ie.customContentId===ie||Ie.baseName===le&&(Ie.source==="Homebrew"||Ie.isCustom))&&W(Ie.id,{...s,customContentId:ge.id})})}else{const we={...s,name:s.baseName||s.name},le=C(we),Ie=s.baseName||(L==null?void 0:L.baseName);t.forEach(_e=>{_e.baseName===Ie&&(_e.source==="Homebrew"||_e.isCustom)&&W(_e.id,{...s,customContentId:le})})}}else{const ie=L==null?void 0:L.baseName,B=t.filter(le=>{const Ie=le.baseName===ie,_e=!le.source||le.source!=="Homebrew"&&!le.isCustom;return Ie&&_e});console.log("[SAVE_AS] Found stock instances to replace:",{originalBaseName:ie,stockInstancesCount:B.length,stockInstanceIds:B.map(le=>le.id)});const ge={...s,name:s.baseName||s.name},we=C(ge);B.forEach(le=>{console.log("[SAVE_AS] Deleting stock instance:",le.id,le.name),F(le.id)}),setTimeout(()=>{const le=B.map(()=>({...s,source:"Homebrew",isCustom:!0,customContentId:we,hp:0,stress:0}));le.length>0&&(console.log("[SAVE_AS] Creating",le.length,"custom instances to replace stock ones"),H(le))},0)}te(null)}else if(je){const L={...s,name:s.baseName||s.name},Ce=C(L),ie=E({...s,source:"Homebrew",isCustom:!0,customContentId:Ce});return te(null),ie}else{const L={...s,name:s.baseName||s.name},Ce=C(L),ie=E({...s,source:"Homebrew",isCustom:!0,customContentId:Ce});return ue(!1),ie}},[je,t,x,E,W,C,P]),Le=f.useCallback(()=>{const s={};return t.forEach(l=>{var k;const z=l.baseName||((k=l.name)==null?void 0:k.replace(/\s+\(\d+\)$/,""))||l.name;s[z]||(s[z]={type:"adversary",item:l,quantity:0}),s[z].quantity+=1}),Object.values(s)},[t])(),He=zr(q),Fe=Le.filter(s=>s.item.type==="Solo"&&s.quantity>0).reduce((s,l)=>s+l.quantity,0),De=Le.some(s=>s.item.type&&["Bruiser","Horde","Leader","Solo"].includes(s.item.type)&&s.quantity>0);let Ee=0;Fe>=2&&(Ee+=Pt.twoOrMoreSolos),De||(Ee+=Pt.noBruisersHordesLeadersSolos);const Se=He+Ee,oe=Le.reduce((s,l)=>{if(l.type==="adversary"){const z=Rr[l.item.type]||2;return l.item.type==="Minion"?s+Math.ceil(l.quantity/q)*z:s+z*l.quantity}return s},0),We=f.useRef(null),$e=f.useCallback(s=>{a(s.target.scrollLeft),We.current&&clearTimeout(We.current),We.current=setTimeout(()=>{const l=s.target;l&&l.style.scrollSnapType==="none"&&(l.style.scrollSnapType="x mandatory")},150)},[]);return f.useCallback(()=>{R(!0)},[]),f.useCallback(()=>{setTimeout(()=>R(!1),100)},[]),ve.length,e.jsxs("div",{className:"app",onClick:s=>{s.target,s.currentTarget},children:[e.jsx(dr,{position:"top",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",width:"100%",justifyContent:"space-between",padding:"0 1rem"},children:[e.jsx(it,{type:"fear",value:(d==null?void 0:d.value)||0,maxValue:12,onChange:i,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0}),e.jsx("button",{onClick:()=>{X!==null?S():j(ve.length)},title:X!==null?"Close Browser":"Add Adversaries",style:{width:"36px",height:"36px",padding:0,backgroundColor:X!==null?"var(--purple)":"transparent",border:"1px solid var(--border)",borderRadius:"50%",color:X!==null?"white":"var(--text-primary)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",flexShrink:0},onMouseEnter:s=>{X===null&&(s.target.style.borderColor="var(--purple)",s.target.style.backgroundColor="var(--bg-secondary)")},onMouseLeave:s=>{X===null&&(s.target.style.borderColor="var(--border)",s.target.style.backgroundColor="transparent")},children:e.jsx(at,{size:18})})]})}),e.jsxs("div",{className:"main-content",style:{position:"relative",width:"100%"},children:[X!==null&&e.jsx("div",{style:{position:"absolute",top:`${r}px`,right:`${r}px`,bottom:`${r}px`,width:`${Y}px`,zIndex:100,overflow:"visible"},children:e.jsx(It,{tabContent:e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:xe,style:{padding:"0.375rem 0.75rem",backgroundColor:"var(--purple)",border:"none",color:"white",borderRadius:"4px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",transition:"opacity 0.2s ease"},onMouseEnter:s=>{s.target.style.opacity="0.9"},onMouseLeave:s=>{s.target.style.opacity="1"},children:[e.jsx(at,{size:16}),e.jsx("span",{children:"Add Custom"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:"500"},children:"Party Size:"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",border:"1px solid var(--border)",borderRadius:"4px",padding:"0.125rem 0.25rem",backgroundColor:"var(--bg-secondary)"},children:[e.jsx("button",{onClick:()=>$(Math.max(1,q-1)),style:{background:"transparent",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:"0",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem"},onMouseEnter:s=>{s.target.style.color="var(--purple)"},onMouseLeave:s=>{s.target.style.color="var(--text-primary)"},children:e.jsx(ft,{size:12})}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:"500",minWidth:"1.5rem",textAlign:"center"},children:q}),e.jsx("button",{onClick:()=>$(q+1),style:{background:"transparent",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:"0",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem"},onMouseEnter:s=>{s.target.style.color="var(--purple)"},onMouseLeave:s=>{s.target.style.color="var(--text-primary)"},children:e.jsx(at,{size:12})})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:"500"},children:"Balance:"}),e.jsx("span",{style:{color:oe>Se?"var(--danger)":oe===Se?"var(--purple)":"var(--success)",fontWeight:600,fontSize:"0.875rem"},children:oe>Se?`+${oe-Se}`:Se-oe===0?"0":`-${Se-oe}`})]}),S&&e.jsx("button",{onClick:S,style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease",flexShrink:0},onMouseEnter:s=>s.target.style.color="var(--text-primary)",onMouseLeave:s=>s.target.style.color="var(--text-secondary)",title:"Close browser",children:e.jsx(ot,{size:16})})]}),showTab:!0,tabBackgroundColor:"var(--bg-primary)",tabBorderColor:"var(--border)",tabJustifyContent:"space-between",containerBackgroundColor:"var(--bg-primary)",containerBorderColor:"var(--border)",containerBorderRadius:"8px",containerBoxShadow:"-4px 0 12px rgba(0, 0, 0, 0.3)",containerOverflow:"hidden",reserveTabSpace:!0,containerStyle:{height:"100%"},children:e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,display:"flex",flexDirection:"column",width:"100%",minWidth:0},children:e.jsx(Vt,{type:"adversary",onAddItem:me,showContainer:!1,activeTab:ye,onTabChange:Re,pcCount:q,savedEncounters:b,onLoadEncounter:Oe,onDeleteEncounter:se,selectedCustomAdversaryId:Ve,onSelectCustomAdversary:c,autoFocus:!0,hideImportExport:!0,onClose:S,searchPlaceholder:"Search adversaries"})})})}),e.jsxs("div",{ref:o,className:"dashboard-scroll-container",style:{display:"flex",flexDirection:"row",overflowX:"auto",overflowY:"hidden",padding:`0 ${r}px 0 0`,scrollSnapType:"x mandatory",height:"100%",width:"100%"},onScroll:$e,children:[ve.length===0?null:(()=>{const s=[];if(ve.forEach((l,z)=>{var L,Ce,ie;if(fe&&fe.baseName===l.baseName&&l.type==="adversary"){s.push(e.jsx(St,{style:{width:Be?"0px":`${Y+r}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:Be?"0px":`${r}px`,paddingRight:"0",paddingTop:Be?"0px":`${r}px`,paddingBottom:Be?"0px":`${r}px`,scrollSnapAlign:"none",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"100%",opacity:0,transition:"width 0.3s ease, padding-left 0.3s ease, padding-top 0.3s ease, padding-bottom 0.3s ease"}},`spacer-${fe.baseName}`));return}s.push(e.jsx(St,{style:{width:`${Y+r}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:`${r}px`,paddingRight:"0",paddingTop:`${l.type==="adversary"?r+52:r}px`,paddingBottom:`${r}px`,scrollSnapAlign:"start",overflow:l.type==="adversary"?"visible":"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"auto",opacity:O.has(`${l.type}-${l.baseName}`)?0:1,transition:(O.has(`${l.type}-${l.baseName}`),"opacity 0.2s ease")},children:e.jsx(ht,{type:l.type,item:{...l.instances[0],name:((L=l.instances[0])==null?void 0:L.name)||l.baseName,hp:0,stress:0,isDead:!1},mode:"expanded",instances:l.instances,showCustomCreator:l.type==="adversary"&&je&&l.instances.some(B=>B.id===je),onSaveCustomAdversary:l.type==="adversary"&&je&&l.instances.some(B=>B.id===je)?be:void 0,onCancelEdit:l.type==="adversary"&&je&&l.instances.some(B=>B.id===je)?A:void 0,isStockAdversary:l.type==="adversary"&&je&&l.instances.some(B=>B.id===je)?!((Ce=l.instances[0])!=null&&Ce.source)||((ie=l.instances[0])==null?void 0:ie.source)!=="Homebrew":!1,onApplyDamage:l.type==="adversary"?(B,ge,we,le)=>{const Ie=l.instances.find(_e=>_e.id===B);Ie&&W(B,{hp:Math.min(Ie.hpMax||1,(Ie.hp||0)+ge)})}:void 0,onApplyHealing:l.type==="adversary"?(B,ge,we)=>{const le=l.instances.find(Ie=>Ie.id===B);le&&W(B,{hp:Math.max(0,(le.hp||0)-ge)})}:void 0,onApplyStressChange:l.type==="adversary"?(B,ge)=>{var we,le;return W(B,{stress:Math.max(0,Math.min(((we=l.instances.find(Ie=>Ie.id===B))==null?void 0:we.stressMax)||6,(((le=l.instances.find(Ie=>Ie.id===B))==null?void 0:le.stress)||0)+ge))})}:void 0,onUpdate:l.type==="adversary"?W:l.type==="environment"?_:re,adversaries:t,showAddRemoveButtons:X!==null&&l.type==="adversary",onEdit:l.type==="adversary"?B=>pe(B):void 0,onAddInstance:l.type==="adversary"?B=>{const ge=B.type==="Minion",we=ge?q:1;if(ge&&we>1){const le=Array(we).fill(null).map(()=>({...B}));H(le)}else E(B);setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(o.current){const le=o.current,Ie=le.scrollLeft,_e=le.clientWidth,Xe=X!==null?_e-(Y+r):_e,Ge=J().findIndex(Me=>Me.baseName===l.baseName&&Me.type==="adversary");if(Ge>=0){const Me=Ge*(Y+r),Qe=Me+Y+r,Ke=10;Me>=Ie-Ke&&Qe<=Ie+Xe+Ke||ee(Me,500)}}})})},50)}:void 0,onRemoveInstance:l.type==="adversary"?B=>{const ge=l.instances[0],le=(ge==null?void 0:ge.type)==="Minion"?q:1,Ie=l.instances.sort((Pe,Ge)=>{const Me=Pe.duplicateNumber||1;return(Ge.duplicateNumber||1)-Me}),Xe=Math.max(0,Ie.length-le)===0;if(Ie.length>0){const Pe=Ie.slice(0,le);if(Xe){const Ge=ve.findIndex(Me=>Me.baseName===l.baseName&&Me.type==="adversary");Ne({baseName:l.baseName,groupIndex:Ge}),Ye(!1),requestAnimationFrame(()=>{requestAnimationFrame(()=>{Pe.forEach(Me=>{F(Me.id)}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{Ye(!0),setTimeout(()=>{Ne(null),Ye(!1)},300)})})})})}else Pe.forEach(Ge=>{F(Ge.id)})}}:void 0})},`${l.type}-${l.baseName}`))}),fe&&!s.some(l=>(l==null?void 0:l.key)===`spacer-${fe.baseName}`)){const l=Math.min(fe.groupIndex,s.length);s.splice(l,0,e.jsx(St,{style:{width:Be?"0px":`${Y+r}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:Be?"0px":`${r}px`,paddingRight:"0",paddingTop:Be?"0px":`${r}px`,paddingBottom:Be?"0px":`${r}px`,scrollSnapAlign:"none",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"100%",opacity:0,transition:"width 0.3s ease, padding-left 0.3s ease, padding-top 0.3s ease, padding-bottom 0.3s ease"}},`spacer-${fe.baseName}`))}return s})(),X!==null&&e.jsx("div",{style:{width:`${Y+r}px`,flexShrink:0,flexGrow:0,flex:"none",height:"100%"}})]})]}),e.jsx(Mr,{isOpen:ce,onClose:u,onAddAdversary:s=>{E(s),U("adversary")},onAddAdversariesBulk:s=>{H(s),U("adversary")},onAddEnvironment:s=>{Z(s),U("environment")},onDeleteAdversary:F,onDeleteEnvironment:G,onDeleteCountdown:ne,adversaries:t,environments:n,countdowns:p,savedEncounters:b,onSaveEncounter:ze,onLoadEncounter:Oe,onDeleteEncounter:se}),e.jsx(Ir,{})]})},Lr=()=>e.jsx(Nr,{children:e.jsx(Wr,{})});kt.createRoot(document.getElementById("root")).render(e.jsx(rt.StrictMode,{children:e.jsx(lr,{children:e.jsx(Lr,{})})}));
