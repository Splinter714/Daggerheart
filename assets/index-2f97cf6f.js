import{r as w,a as de,R as te}from"./dndkit-57209f9c.js";import{F as Te,f as Be,a as Le,b as De,c as he}from"./fa-b4bcccb0.js";import{D as Z,A as Ce,C as Me,T as Re,S as Ne,M as Pe,X as pe,E as He,H as ae,L as Fe,a as Oe,b as $e,F as qe,c as re,d as ne,e as ge,P as me}from"./lucide-7a0c9f84.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))v(x);new MutationObserver(x=>{for(const d of x)if(d.type==="childList")for(const g of d.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&v(g)}).observe(document,{childList:!0,subtree:!0});function p(x){const d={};return x.integrity&&(d.integrity=x.integrity),x.referrerPolicy&&(d.referrerPolicy=x.referrerPolicy),x.crossOrigin==="use-credentials"?d.credentials="include":x.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function v(x){if(x.ep)return;x.ep=!0;const d=p(x);fetch(x.href,d)}})();var Se={exports:{}},ie={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ve=w,_e=Symbol.for("react.element"),Ge=Symbol.for("react.fragment"),Xe=Object.prototype.hasOwnProperty,Ye=Ve.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ue={key:!0,ref:!0,__self:!0,__source:!0};function ke(t,s,p){var v,x={},d=null,g=null;p!==void 0&&(d=""+p),s.key!==void 0&&(d=""+s.key),s.ref!==void 0&&(g=s.ref);for(v in s)Xe.call(s,v)&&!Ue.hasOwnProperty(v)&&(x[v]=s[v]);if(t&&t.defaultProps)for(v in s=t.defaultProps,s)x[v]===void 0&&(x[v]=s[v]);return{$$typeof:_e,type:t,key:d,ref:g,props:x,_owner:Ye.current}}ie.Fragment=Ge;ie.jsx=ke;ie.jsxs=ke;Se.exports=ie;var e=Se.exports,ce={},fe=de;ce.createRoot=fe.createRoot,ce.hydrateRoot=fe.hydrateRoot;function se(t){const s=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return t?`${t}-${s}`:s}const Ee=w.createContext();function Ke(t){if(typeof localStorage>"u")return null;try{const s=localStorage.getItem(t);return s==null?null:JSON.parse(s)}catch{return null}}function Je(t,s){if(!(typeof localStorage>"u"))try{localStorage.setItem(t,JSON.stringify(s))}catch{}}const Qe=({children:t})=>{const[s,p]=w.useState({fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[]}),[v,x]=w.useState(!1);w.useEffect(()=>{var i,o,n;const a=Ke("daggerheart-game-state");if(a)try{(((i=a.adversaries)==null?void 0:i.length)>0||((o=a.environments)==null?void 0:o.length)>0||((n=a.countdowns)==null?void 0:n.length)>0)&&p(a)}catch(r){console.error("Failed to load saved state:",r)}x(!0)},[]),w.useEffect(()=>{Je("daggerheart-game-state",s)},[s]);const d=a=>{p(i=>({...i,fear:{...i.fear,value:a}}))},g=()=>{p(a=>({...a,fear:{...a.fear,visible:!a.fear.visible}}))},u=w.useRef(s);w.useEffect(()=>{u.current=s},[s]);const I={gameState:s,isLoaded:v,updateFear:d,toggleFearVisibility:g,createCountdown:a=>{const i={id:se("countdown"),name:a.name||"Countdown",max:parseInt(a.max)||1,value:0,visible:!0,type:a.type||"standard",loop:a.loop||"none",source:a.source||"campaign"};p(o=>({...o,countdowns:[...o.countdowns,i]}))},updateCountdown:(a,i)=>{p(o=>({...o,countdowns:o.countdowns.map(n=>n.id===a?{...n,...i}:n)}))},deleteCountdown:a=>{p(i=>({...i,countdowns:i.countdowns.filter(o=>o.id!==a)}))},advanceCountdown:(a,i)=>{p(o=>({...o,countdowns:o.countdowns.map(n=>{if(n.id!==a)return n;let r=i;if(n.loop==="loop")r>n.max?r=(r-1)%n.max+1:r<0&&(r=n.max);else if(n.loop==="increasing"){if(r>n.max)return{...n,max:n.max+1,value:1};if(r<0)return{...n,max:Math.max(1,n.max-1),value:1};r=Math.max(0,r)}else if(n.loop==="decreasing"){if(r>n.max)return{...n,max:Math.max(1,n.max-1),value:1};if(r<0)return{...n,max:n.max+1,value:1};r=Math.min(n.max,r)}else r=Math.max(0,Math.min(r,n.max));return{...n,value:r}})}))},incrementCountdown:(a,i=1)=>{p(o=>({...o,countdowns:o.countdowns.map(n=>{if(n.id!==a)return n;let r=n.value+i;if(n.loop==="loop")r>n.max&&(r=(r-1)%n.max+1);else if(n.loop==="increasing"){if(r>n.max)return{...n,max:n.max+1,value:1}}else if(n.loop==="decreasing"){if(r>n.max)return{...n,max:Math.max(1,n.max-1),value:1}}else r=Math.min(r,n.max);return{...n,value:r}})}))},decrementCountdown:a=>{p(i=>({...i,countdowns:i.countdowns.map(o=>{if(o.id!==a)return o;let n=o.value-1;if(o.loop==="loop")n<0&&(n=o.max);else if(o.loop==="increasing"){if(n<0)return{...o,max:Math.max(1,o.max-1),value:o.max};n=Math.max(0,n)}else if(o.loop==="decreasing"){if(n<0)return{...o,max:o.max+1,value:1}}else n=Math.max(0,n);return{...o,value:n}})}))},reorderCountdowns:a=>{p(i=>{const[o,n]=a,r=[...i.countdowns],[f]=r.splice(o,1);return r.splice(n,0,f),{...i,countdowns:r}})},createAdversary:a=>{var m;const i=se("adv"),o=s.adversaries||[],n=a.baseName||((m=a.name)==null?void 0:m.replace(/\s+\(\d+\)$/,""))||a.name||"Unknown",r=o.filter(C=>C.baseName===n);let f=1;if(r.length===0)f=1;else{const C=r.map(V=>V.duplicateNumber||1);let W=1;for(;C.includes(W);)W++;f=W}const c={...a,id:i,baseName:n,duplicateNumber:f,name:`${n} (${f})`,hp:0,stress:0,isVisible:!0};p(C=>({...C,adversaries:[...C.adversaries,c]}))},createAdversariesBulk:a=>{const i=[],o={};a.forEach(n=>{var _;const r=n.baseName||((_=n.name)==null?void 0:_.replace(/\s+\(\d+\)$/,""))||n.name||"Unknown",m=(s.adversaries||[]).filter(H=>H.baseName===r).length,C=o[r]||0,W=m+C+1;o[r]=C+1;const V={...n,id:se("adv"),baseName:r,duplicateNumber:W,name:`${r} (${W})`,hp:0,stress:0,isVisible:!0};i.push(V)}),p(n=>({...n,adversaries:[...n.adversaries,...i]}))},updateAdversary:(a,i)=>{p(o=>({...o,adversaries:o.adversaries.map(n=>{if(n.id===a){const r={...n,...i};if(i.baseName!==void 0){const f=i.baseName,c=r.duplicateNumber||1;r.name=c===1?f:`${f} (${c})`}return r}return n})}))},deleteAdversary:a=>{p(i=>({...i,adversaries:i.adversaries.filter(o=>o.id!==a)}))},reorderAdversaries:a=>{p(i=>{const[o,n]=a,r=[...i.adversaries],[f]=r.splice(o,1);return r.splice(n,0,f),{...i,adversaries:r}})},bulkReorderAdversaries:a=>{p(i=>({...i,adversaries:a}))},createEnvironment:a=>{const i=se("env"),n=(s.environments||[]).filter(c=>c.name.replace(/\s+\(\d+\)$/,"")===a.name);let r=a.name||"Unknown";if(n.length===0)r=a.name;else if(n.length===1){const c=n[0],m=c.name.replace(/\s+\(\d+\)$/,""),C=s.environments.map(W=>W.id===c.id?{...W,name:`${m} (1)`}:W);p(W=>({...W,environments:C})),r=`${a.name} (2)`}else{const c=n.map(C=>{const W=C.name.match(/\((\d+)\)$/);return W?parseInt(W[1]):null}).filter(C=>C!==null);let m=1;for(;c.includes(m);)m++;r=`${a.name} (${m})`}const f={...a,id:i,name:r,isVisible:!0};p(c=>({...c,environments:[...c.environments,f]}))},updateEnvironment:(a,i)=>{p(o=>({...o,environments:o.environments.map(n=>n.id===a?{...n,...i}:n)}))},deleteEnvironment:a=>{p(i=>({...i,environments:i.environments.filter(o=>o.id!==a)}))},reorderEnvironments:a=>{p(i=>{const[o,n]=a,r=[...i.environments],[f]=r.splice(o,1);return r.splice(n,0,f),{...i,environments:r}})}};return e.jsx(Ee.Provider,{value:I,children:t})},Ze=()=>{const t=w.useContext(Ee);if(!t)return console.warn("useGameState: Context not available yet, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],updateFear:()=>{},toggleFearVisibility:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{gameState:s,...p}=t;if(!s)return console.warn("useGameState: gameState not available, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],updateFear:()=>{},toggleFearVisibility:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{fear:v,countdowns:x,adversaries:d,environments:g}=s;return{gameState:s,fear:v,countdowns:x,adversaries:d,environments:g,...p,hasCountdowns:x.length>0,hasAdversaries:d.length>0,hasEnvironments:g.length>0,getCountdownById:u=>x.find(y=>y.id===u),getAdversaryById:u=>d.find(y=>y.id===u),getEnvironmentById:u=>g.find(y=>y.id===u)}},ye={fear:{icon:Be,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"0.125rem",maxWidth:"none"},pipStyle:{fontSize:"var(--text-lg)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0,imageRendering:"crisp-edges"},filledColor:"var(--purple)",emptyColor:"var(--gray-dark)",tooltipTitle:"Click anywhere in header to adjust fear:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease fear by 1"},{text:"Right of boundary:",description:"Click to increase fear by 1"}]},hp:{icon:Le,maxValue:20,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stress:{icon:De,maxValue:12,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},countdown:{icon:he,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust countdown:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease countdown by 1"},{text:"Right of boundary:",description:"Click to increase countdown by 1"}]},hpDots:{maxValue:20,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--red)",borderColor:"var(--red)",boxShadow:"0 0 4px rgba(239, 68, 68, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stressDots:{maxValue:12,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--purple)",borderColor:"var(--purple)",boxShadow:"0 0 4px rgba(139, 92, 246, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},adversaryHP:{icon:Z,maxValue:20,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust HP:",tooltipInstructions:[{text:"Filled pip:",description:"Click to heal (reduce damage)"},{text:"Empty pip:",description:"Click to take damage"}]},adversaryStress:{icon:Ce,maxValue:12,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust stress:",tooltipInstructions:[{text:"Filled pip:",description:"Click to reduce stress"},{text:"Empty pip:",description:"Click to increase stress"}]},countdownDistributed:{icon:he,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Countdown progress:",tooltipInstructions:[{text:"Progress:",description:"Current countdown value"}]}},et=({type:t="fear",value:s=0,maxValue:p,onChange:v,size:x="lg",showTooltip:d=!0,containerStyle:g={},pipStyle:u={},countdownType:y=null,distributedGroups:B=null,onPipClick:E=null,enableBoundaryClick:k=!1,clickContainerWidth:N="auto",centerPips:S=!0})=>{const[j,O]=w.useState(!1),T=ye[t]||ye.fear,M=p||T.maxValue,A=Math.max(0,Math.min(M,s));let F=T.filledColor;t==="countdown"&&y&&(["progress","dynamic-progress","simple-hope"].includes(y)?F="var(--gold)":["consequence","dynamic-consequence","simple-fear"].includes(y)?F="var(--purple)":["long-term","standard"].includes(y)&&(F="var(--text-secondary)"));const b=(I,a)=>{if(E)E(I,a);else if(v){const i=I+1;v(i)}},$=I=>{if(!k||!v||E)return;I.currentTarget.getBoundingClientRect();const a=I.currentTarget.querySelector(".pip-container");if(!a)return;const i=a.getBoundingClientRect(),o=I.clientX-i.left;if(o<0){A>0&&v(A-1);return}if(o>i.width){A<M&&v(A+1);return}const n=i.width,r=n*.05,f=n-2*r,c=o-r,m=A/M,C=f*m;c<C?A>0&&v(A-1):A<M&&v(A+1)},L=(()=>{if(!B||t!=="countdownDistributed")return[{start:0,end:M,groupIndex:0}];let I=0;return B.map((a,i)=>{const o={start:I,end:I+a,groupIndex:i};return I+=a,o})})(),R=()=>e.jsxs(e.Fragment,{children:[L.map(I=>e.jsx(te.Fragment,{children:[...Array(I.end-I.start)].map((a,i)=>{const o=I.start+i,n=o<A;if(T.isDots)return e.jsx("div",{style:{...T.pipStyle,...n?T.filledStyle:T.emptyStyle,...u,cursor:v||E?"pointer":"default"},onClick:k?void 0:()=>b(o,n),title:`${o+1} of ${M}`},o);{const r=T.icon,f=r&&typeof r=="object"&&r.iconName,c=n?F:T.emptyColor;return e.jsx("span",{className:`fear-pip ${n?"filled":"empty"}`,style:{...T.pipStyle,color:c,cursor:v||E?"pointer":"default",...u},onClick:k?void 0:()=>b(o,n),title:`${o+1} of ${M}`,children:f?e.jsx(Te,{icon:r,size:x}):e.jsx(r,{size:16})},o)}})},I.groupIndex)),d&&e.jsx("div",{style:{position:"relative",cursor:"help",pointerEvents:"none"},children:e.jsxs("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:j?"translateX(-50%) translateY(-5px)":"translateX(-50%)",background:"rgba(15, 23, 42, 0.95)",border:"1px solid var(--gray)",borderRadius:"var(--radius-md)",padding:"var(--space-md)",minWidth:"250px",zIndex:1e3,opacity:j?1:0,visibility:j?"visible":"hidden",transition:"all 0.2s ease",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.5)"},children:[e.jsx("div",{style:{fontWeight:600,color:"var(--gray-200)",marginBottom:"0.75rem",fontSize:"var(--text-sm)"},children:T.tooltipTitle}),T.tooltipInstructions.map((I,a)=>e.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.8rem",color:"var(--gray-300)",lineHeight:1.4},children:[e.jsx("strong",{style:{color:"var(--gray-200)"},children:I.text})," ",I.description]},a))]})})]});return e.jsx("div",{style:{width:N,height:"100%",cursor:v||E?"pointer":"default",touchAction:"manipulation",userSelect:"none",display:S?"flex":"block",alignItems:S?"center":"stretch",justifyContent:S?"center":"flex-start",...g},onClick:I=>{I.stopPropagation(),I.preventDefault(),k&&$(I)},onMouseEnter:()=>O(d),onMouseLeave:()=>O(!1),children:e.jsx("div",{className:"pip-container",style:{...T.containerStyle,width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},children:R()})})},tt="/Daggerheart/assets/daggerheart-logo-fe7815ad.svg",rt=({showFlyout:t,onFlyoutChange:s})=>{const[p,v]=w.useState(!1),[x,d]=w.useState(!1),g=t!==void 0?t:p,u=s||v;return w.useEffect(()=>{const y=B=>{B.target.closest(".help-button")||u(!1)};return document.addEventListener("click",y),()=>document.removeEventListener("click",y)},[u]),w.useEffect(()=>{const y=window.matchMedia("(max-width: 800px)"),B=E=>d(E.matches);return d(y.matches),y.addEventListener("change",B),()=>y.removeEventListener("change",B)},[]),e.jsxs("div",{className:"help-button",style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",padding:"0.5rem",color:g?"white":"var(--text-primary)",borderRadius:"50%",cursor:"pointer",transition:"all 0.2s ease",minWidth:"44px",minHeight:"44px",backgroundColor:g?"var(--purple)":"transparent"},onMouseEnter:y=>{g||(y.currentTarget.style.backgroundColor="var(--bg-secondary)")},onMouseLeave:y=>{g||(y.currentTarget.style.backgroundColor="transparent")},onClick:y=>{y.stopPropagation(),u(!g)},title:"Help & Info",children:[e.jsx("div",{style:{width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center",color:"inherit",backgroundColor:"transparent",border:"none",outline:"none"},children:e.jsx(Me,{size:20})}),e.jsxs("div",{style:{position:"absolute",top:"50%",right:"100%",left:"auto",transform:"translateY(-50%)",background:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,opacity:g?1:0,visibility:g?"visible":"hidden",transition:"opacity 0.2s ease, visibility 0.2s ease, transform 0.2s ease",pointerEvents:g?"auto":"none",minWidth:"280px",maxWidth:x?"calc(100vw - 2rem)":"320px",marginRight:"0.5rem"},children:[e.jsxs("div",{style:{padding:"0.75rem",borderTop:"1px solid rgba(255, 255, 255, 0.1)",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",background:"var(--bg-primary)",maxWidth:"280px"},children:[e.jsx("img",{src:tt,alt:"Daggerheart Community Content Logo",style:{width:"100%",maxWidth:"200px",height:"auto",margin:"0 auto 0.75rem auto",display:"block"},onError:y=>{console.error("Failed to load Daggerheart logo:",y.target.src),y.target.style.display="none";const B=document.createElement("div");B.style.cssText="text-align: center; margin-bottom: 0.75rem; font-size: 1.5rem; font-weight: bold; color: var(--purple);",B.textContent="⚔️ DAGGERHEART ⚔️",y.target.parentNode.insertBefore(B,y.target)},onLoad:()=>{}}),e.jsxs("div",{style:{fontSize:"0.7rem",lineHeight:1.3,color:"var(--text-secondary)",textAlign:"left",wordWrap:"break-word",overflowWrap:"break-word"},children:[e.jsx("p",{children:"This product includes materials from the Daggerheart System Reference Document 1.0, © Critical Role, LLC, under the terms of the Darrington Press Community Gaming (DPCGL) License."}),e.jsxs("p",{children:["More information can be found at ",e.jsx("a",{href:"https://www.daggerheart.com",target:"_blank",rel:"noopener noreferrer",children:"daggerheart.com"})]}),e.jsx("p",{children:e.jsx("em",{children:"This project is unofficial and not endorsed by Darrington Press or Critical Role."})})]})]}),e.jsx("button",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"0.25rem 1rem",color:"var(--text-primary)",border:"none",background:"none",width:"100%",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"0.875rem",minHeight:"32px",borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},onMouseEnter:y=>{y.target.style.backgroundColor="var(--gray-dark)"},onMouseLeave:y=>{y.target.style.backgroundColor="transparent"},onClick:y=>{y.stopPropagation(),u(!1),window.open("https://github.com/Splinter714/Daggerheart","_blank")},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.25rem"},children:e.jsx("span",{children:"GitHub"})})}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"0.25rem 1rem",color:"var(--text-secondary)",border:"none",background:"none",width:"100%",textAlign:"left",cursor:"default",fontSize:"0.875rem",minHeight:"32px"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.25rem"},children:e.jsxs("span",{children:["Version ","0.3.6 (9a4d39a)"]})})})]})]})},nt=({adversaries:t,environments:s,countdowns:p,deleteAdversary:v,deleteEnvironment:x,deleteCountdown:d,isClearMode:g,setIsClearMode:u,showFlyout:y,onFlyoutChange:B})=>{const[E,k]=w.useState(!1),N=y!==void 0?y:E,S=B||k,j=((t==null?void 0:t.length)||0)>0||((s==null?void 0:s.length)||0)>0||((p==null?void 0:p.length)||0)>0,O=(t||[]).some(b=>(b.hp||0)>=(b.hpMax||1));w.useEffect(()=>{const b=$=>{$.target.closest(".delete-clear-container")||(S(!1),g&&u(!1))};return document.addEventListener("click",b),()=>document.removeEventListener("click",b)},[g,S]),w.useEffect(()=>{g&&!j&&(u(!1),S(!1))},[g,j,u,S]);const T={position:"absolute",top:"50%",right:"100%",left:"auto",transform:"translateY(-50%)",backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",padding:"0.5rem",minWidth:"200px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,display:N?"block":"none",marginRight:"0.5rem"},M={background:g||N?"var(--red)":"none",border:"none",color:g||N?"white":j?"var(--text-primary)":"var(--text-secondary)",cursor:j?"pointer":"not-allowed",padding:"0.5rem",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s",opacity:j?1:.5,minWidth:"44px",minHeight:"44px"},A={background:"none",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:"0.5rem",borderRadius:"var(--radius-sm)",width:"100%",textAlign:"left",display:"flex",alignItems:"center",gap:"0.5rem",transition:"background-color 0.2s"},F={backgroundColor:"var(--bg-hover)"};return e.jsxs("div",{className:"delete-clear-container",style:{position:"relative"},children:[e.jsx("button",{style:M,onClick:b=>{b.stopPropagation(),j&&(g?(u(!1),S(!1)):(u(!0),S(!0)))},title:j?g?"Clear Items":"Enter Clear Mode":"Nothing to clear",children:e.jsx(Re,{size:20})}),e.jsxs("div",{style:T,children:[t&&t.length>0&&e.jsxs("button",{style:A,onMouseEnter:b=>Object.assign(b.target.style,F),onMouseLeave:b=>Object.assign(b.target.style,A),onClick:b=>{b.stopPropagation(),k(!1),t.forEach($=>v($.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Adversaries"})]}),t&&t.length>0&&O&&e.jsxs("button",{style:A,onMouseEnter:b=>Object.assign(b.target.style,F),onMouseLeave:b=>Object.assign(b.target.style,A),onClick:b=>{b.stopPropagation(),k(!1),t.filter(l=>(l.hp||0)>=(l.hpMax||1)).forEach(l=>v(l.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"Dead Adversaries"})]}),s&&s.length>0&&e.jsxs("button",{style:A,onMouseEnter:b=>Object.assign(b.target.style,F),onMouseLeave:b=>Object.assign(b.target.style,A),onClick:b=>{b.stopPropagation(),k(!1),s.forEach($=>x($.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Environments"})]}),p&&p.length>0&&e.jsxs("button",{style:A,onMouseEnter:b=>Object.assign(b.target.style,F),onMouseLeave:b=>Object.assign(b.target.style,A),onClick:b=>{b.stopPropagation(),k(!1),p.forEach($=>d($.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Countdowns"})]})]})]})},st=({adversaries:t,environments:s,countdowns:p,deleteAdversary:v,deleteEnvironment:x,deleteCountdown:d,isClearMode:g,setIsClearMode:u,sortAdversaries:y,onOpenDatabase:B})=>{const[E,k]=w.useState(!1),[N,S]=w.useState(!1),[j,O]=w.useState(!1);w.useEffect(()=>{const l=L=>{L.target.closest(".floating-menu-container")||(k(!1),S(!1),O(!1),g&&u(!1))};return document.addEventListener("click",l),()=>document.removeEventListener("click",l)},[g,u]),w.useEffect(()=>{E||(S(!1),O(!1),g&&u(!1))},[E,g,u]);const T=l=>{S(l),l&&(O(!1),g&&u(!1))},M=l=>{O(l),l&&S(!1)},F={position:"fixed",bottom:window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://")?"calc(60px + env(safe-area-inset-bottom) + 2rem)":"calc(60px + env(safe-area-inset-bottom) + 1rem)",right:"1rem",zIndex:1100,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",pointerEvents:"none",width:"56px",height:"56px"},b={width:"56px",height:"56px",borderRadius:"50%",background:E?"var(--red)":"var(--bg-secondary)",border:"2px solid var(--border)",color:E?"white":"var(--text-primary)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"all 0.3s ease",pointerEvents:"auto"},$=(l,L)=>{const i=135+l*135/(L-1),o=70,n=i*Math.PI/180,r=Math.cos(n)*o,f=Math.sin(n)*o;return{width:"48px",height:"48px",borderRadius:"50%",background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.2)",transition:"all 0.3s ease",position:"absolute",pointerEvents:"auto",transform:E?`translate(${r}px, ${f}px)`:"translate(0px, 0px)",opacity:E?1:0,visibility:E?"visible":"hidden"}};return e.jsxs("div",{className:"floating-menu-container",style:F,children:[e.jsxs("div",{style:{position:"absolute",top:"0",left:"0",width:"56px",height:"56px",pointerEvents:"none"},children:[e.jsx("div",{style:$(0,4),children:e.jsx("button",{onClick:l=>{l.stopPropagation(),B("adversaries"),k(!1)},style:{width:"100%",height:"100%",background:"none",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Browse Adversaries",children:e.jsx(Ne,{size:20})})}),e.jsx("div",{style:$(1,4),children:e.jsx("button",{onClick:l=>{l.stopPropagation(),B("environments"),k(!1)},style:{width:"100%",height:"100%",background:"none",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Browse Environments",children:e.jsx(Pe,{size:20})})}),e.jsx("div",{style:$(2,4),children:e.jsx(nt,{adversaries:t,environments:s,countdowns:p,deleteAdversary:v,deleteEnvironment:x,deleteCountdown:d,isClearMode:g,setIsClearMode:u,showFlyout:j,onFlyoutChange:M})}),e.jsx("div",{style:$(3,4),children:e.jsx(rt,{showFlyout:N,onFlyoutChange:T})})]}),e.jsx("button",{style:b,onClick:l=>{l.stopPropagation(),k(!E)},title:E?"Close Menu":"Open Menu",children:E?e.jsx(pe,{size:24}):e.jsx(He,{size:24})})]})},ot=({position:t="top",children:s,onClick:p,className:v="",style:x={}})=>{const d=t==="top",g=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://"),u={background:"var(--bg-primary)",borderTop:d?"none":"1px solid var(--border)",borderBottom:d?"1px solid var(--border)":"none",padding:d?"0.25rem 0":"0.5rem",paddingBottom:d?"0.25rem":g?"calc(0.5rem + env(safe-area-inset-bottom) + 1rem)":"calc(0.5rem + env(safe-area-inset-bottom))",position:d?"relative":"sticky",[d?"top":"bottom"]:0,zIndex:d?10:100,order:d?1:3,flexShrink:0,touchAction:"manipulation",userSelect:"none",display:"flex",flexDirection:d?"column":"row",justifyContent:d?"stretch":"center",alignItems:d?"stretch":"center",gap:d?"0":"1rem",height:d?"auto":"60px",...x};return e.jsx("div",{className:v,style:u,onClick:p,children:s})},ve=({value:t})=>e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"36px",height:"24px"},children:[e.jsx("svg",{width:"32",height:"24",viewBox:"0 0 32 24",fill:"none",stroke:"var(--text-secondary)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",style:{position:"absolute"},children:e.jsx("path",{d:"M2 2h20l4 10-4 10H2l4-10-4-10z"})}),e.jsx("span",{style:{position:"absolute",fontSize:"0.7rem",fontWeight:500,color:"var(--text-primary)",textAlign:"center",zIndex:1,left:"45%",top:"50%",transform:"translate(-50%, -50%)"},children:t})]}),U={transitions:{hoverIn:"all 0.1s ease",hoverOut:"all 0.3s ease"},card:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"8px",cursor:"pointer",transition:"all 0.1s ease",position:"relative"},cardHover:{backgroundColor:"var(--bg-card-hover)"},cardDead:{opacity:.6,backgroundColor:"var(--gray-800)",borderColor:"var(--border)"},cardAtMax:{backgroundColor:"var(--success)",borderColor:"var(--success)"},rowMain:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},rowTitle:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",margin:0},rowMeta:{display:"flex",gap:"8px",alignItems:"center"},badge:{padding:"2px 6px",borderRadius:"3px",fontSize:"10px",fontWeight:"600",textTransform:"uppercase"},typeBadge:{backgroundColor:"var(--purple)",color:"var(--text-primary)"},tierBadge:{backgroundColor:"var(--info)",color:"var(--text-primary)"},damageInputPopup:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,borderRadius:"8px"},damageInputContent:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"8px",padding:"8px",display:"flex",flexDirection:"row",gap:"8px",minWidth:"200px",alignItems:"center",position:"absolute",right:"1rem",top:"50%",transform:"translateY(-50%)"},damageInput:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"4px",padding:"4px 6px",color:"var(--text-primary)",fontSize:"16px",width:"80px",textAlign:"center"},damageIndicators:{display:"flex",gap:"8px",alignItems:"center",justifyContent:"center"},damageDrop:{fontSize:"16px",color:"var(--text-secondary)",cursor:"pointer",transition:"color 0.1s ease"},applyButton:{backgroundColor:"var(--gray-600)",color:"white",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"32px",minHeight:"32px"}},it=(t,s,p,v)=>{const[x,d]=w.useState(!1),[g,u]=w.useState("");w.useEffect(()=>{if(x){const S=j=>{j.target.closest(".damage-input-popup")||(d(!1),u(""))};return document.addEventListener("click",S),()=>document.removeEventListener("click",S)}},[x]);const y=S=>{S.stopPropagation(),S.preventDefault();const j=t.hp||0,O=t.hpMax||1,T=S.currentTarget.getBoundingClientRect(),M=S.clientX-T.left,A=T.width/O;Math.floor(M/A)<j?p&&p(t.id,1,t.hp):s&&s(t.id,1,t.hp,t.hpMax)},B=S=>{S.stopPropagation(),S.preventDefault();const j=t.stress||0,O=t.stressMax||1,T=S.currentTarget.getBoundingClientRect(),M=S.clientX-T.left,A=T.width/O;Math.floor(M/A)<j?v&&v(t.id,-1,t.stress,t.stressMax):v&&v(t.id,1,t.stress,t.stressMax)},E=S=>{S.stopPropagation(),(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")&&(d(!0),u(t.type==="Minion"?"1":""))},k=()=>{const S=parseInt(g);if(S>0){if(t.type==="Minion")s&&s(t.id,S,t.hp,t.hpMax);else{let j=0;S>=t.thresholds.severe?j=3:S>=t.thresholds.major?j=2:S>=1&&(j=1),s&&s(t.id,j,t.hp,t.hpMax)}d(!1),u("")}};return{showDamageInput:x,damageValue:g,setDamageValue:u,setShowDamageInput:d,handleHpClick:y,handleStressClick:B,handleDifficultyClick:E,applyDamage:k,handleKeyDown:S=>{S.key==="Enter"?k():S.key==="Escape"&&(d(!1),u(""))}}},Ie=({item:t,type:s,mode:p="expanded",onClick:v,onDelete:x,onApplyDamage:d,onApplyHealing:g,onApplyStressChange:u,onUpdate:y,adversaries:B=[],isSelected:E=!1,isEditMode:k=!1,instances:N=[],isEmbedded:S=!1})=>{const j=it(t,d,g,u);(s==="adversary"||s==="adversaries")&&j.handleDifficultyClick;const[O,T]=w.useState(!1),M=()=>{T(!0)},A=()=>{T(!1)},F=(i=!1)=>{let o={...U.card};if(E?o.transition="none":o.transition=O?U.transitions.hoverIn:U.transitions.hoverOut,i){const{marginTop:n,...r}=o;o=r}return(O&&p!=="expanded"||E)&&(o={...o,...U.cardHover}),s==="adversary"&&(t.hp||0)>=(t.hpMax||1)&&(o={...o,...U.cardDead}),s==="countdown"&&(t.value||0)>=t.max&&(o={...o,...U.cardAtMax}),o},b=()=>{if(S)return"";let i="border rounded-lg";return(O&&p!=="expanded"||E)&&(i+=" border-hover"),i},$=()=>{var i;if(s==="adversary"||s==="adversaries"){const o=t.baseName||((i=t.name)==null?void 0:i.replace(/\s+\(\d+\)$/,""))||"",n=t.duplicateNumber||1,r=[...B];return B.some(m=>m.id===t.id)||r.push(t),r.filter(m=>m.baseName===o).length>1?`${o} (${n})`:o}return t.name},l=()=>{const i=[];return t.type&&i.push(e.jsx("span",{style:{...U.badge,...U.typeBadge},children:t.type},"type")),s==="environment"&&t.tier&&i.push(e.jsxs("span",{style:{...U.badge,...U.tierBadge},children:["Tier ",t.tier]},"tier")),i},L=()=>s!=="adversary"||!j.showDamageInput||!(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")?null:e.jsx("div",{className:"damage-input-popup",style:U.damageInputPopup,onClick:i=>{i.stopPropagation(),i.target===i.currentTarget&&(s==="adversary"||s==="adversaries")&&(j.setShowDamageInput(!1),j.setDamageValue(""))},children:e.jsxs("div",{className:"border rounded-lg",style:{...U.damageInputContent,borderColor:"var(--border)"},onClick:i=>i.stopPropagation(),children:[e.jsx("input",{type:"number",inputMode:"numeric",enterKeyHint:"done",placeholder:"dmg",min:(t.type==="Minion","0"),value:s==="adversary"||s==="adversaries"?j.damageValue:"",onChange:i=>{(s==="adversary"||s==="adversaries")&&j.setDamageValue(i.target.value)},onKeyDown:s==="adversary"||s==="adversaries"?j.handleKeyDown:void 0,className:"border rounded-sm",style:{...U.damageInput,borderColor:"var(--border)"},autoFocus:!0}),e.jsxs("div",{style:U.damageIndicators,children:[t.type==="Minion"?(()=>{var f,c;const i=parseInt(s==="adversary"||s==="adversaries"?j.damageValue:"0")||0,o=(f=t.features)==null?void 0:f.find(m=>{var C;return(C=m.name)==null?void 0:C.startsWith("Minion (")}),n=o?parseInt(((c=o.name.match(/\((\d+)\)/))==null?void 0:c[1])||"1"):1,r=Math.floor(i/n);return i>=n&&r>0?e.jsxs("span",{style:{...U.damageDrop,color:"var(--red)"},title:`${i} damage can defeat ${r+1} minion${r+1!==1?"s":""} (1 + ${r} additional)`,children:["+",r," additional minion(s)"]}):e.jsx("span",{style:U.damageDrop,title:`${i} damage defeats this minion only`,children:"+0 additional minion(s)"})})():[1,2,3].map(i=>{const o=parseInt(s==="adversary"||s==="adversaries"?j.damageValue:"0")||0;let n=!1;return i===1&&o>=1&&(n=!0),i===2&&o>=t.thresholds.major&&(n=!0),i===3&&o>=t.thresholds.severe&&(n=!0),e.jsx("span",{style:{...U.damageDrop,color:n?"var(--red)":"var(--text-secondary)"},onClick:r=>{r.stopPropagation(),(s==="adversary"||s==="adversaries")&&(i===1?j.setDamageValue("1"):i===2?j.setDamageValue(t.thresholds.major.toString()):i===3&&j.setDamageValue(t.thresholds.severe.toString()))},title:`Click to set damage to ${i===1?"1":i===2?t.thresholds.major:t.thresholds.severe}`,children:e.jsx(Z,{size:16})},i)}),e.jsx("button",{style:{...U.applyButton,backgroundColor:"var(--gray-600)"},onClick:i=>{i.stopPropagation(),(s==="adversary"||s==="adversaries")&&(!j.damageValue||parseInt(j.damageValue)<1?(j.setShowDamageInput(!1),j.setDamageValue("")):j.applyDamage())},title:!j.damageValue||parseInt(j.damageValue)<1?"Close damage input":"Apply damage",children:!j.damageValue||parseInt(j.damageValue)<1?e.jsx(pe,{size:16}):e.jsx($e,{size:16})})]})]})}),R=()=>{var n;const i=(t.hp||0)>=(t.hpMax||1),o=p==="edit";return e.jsxs("div",{className:b(),style:{...F(!0),padding:0,minHeight:"400px",opacity:i?.7:1,backgroundColor:i?"var(--gray-900)":F(!0).backgroundColor,borderColor:i?"color-mix(in srgb, var(--gray-600) 40%, transparent)":E?"var(--purple)":O&&p!=="expanded"?"var(--border-hover)":"var(--border)",borderWidth:"2px",display:"flex",flexDirection:"column",position:"relative"},onClick:v,...p!=="expanded"&&{onMouseEnter:M,onMouseLeave:A},children:[i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                45deg,
                transparent,
                transparent 8px,
                var(--gray-600) 1px,
                var(--gray-600) 9px
              )`,pointerEvents:"none",zIndex:9999}}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"var(--text-secondary)",fontSize:"1rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em",zIndex:1e4,pointerEvents:"none",textShadow:"1px 1px 2px rgba(0, 0, 0, 0.5)",backgroundColor:"var(--gray-900)",padding:"0.25rem 0.5rem",borderRadius:"0.5rem",border:"0.5px solid var(--gray-600)"},children:"DEFEATED"})]}),e.jsx("div",{className:"border-b",style:{padding:"8px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative",zIndex:i?1:"auto",borderBottomColor:E?"var(--purple)":"var(--border)"},children:e.jsx("div",{style:{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",zIndex:i?1:"auto"},children:e.jsx("h4",{style:{...U.rowTitle,color:i?"color-mix(in srgb, var(--gray-400) 80%, transparent)":U.rowTitle.color,textAlign:"left",margin:0,fontSize:"1.1rem"},children:((n=t.name)==null?void 0:n.replace(/\s+\(\d+\)$/,""))||t.name})})}),e.jsxs("div",{style:{borderRadius:"0 0 8px 8px"},children:[e.jsx("div",{style:{marginBottom:"1rem",padding:"0 8px 0.75rem 8px",borderBottom:"1px solid var(--border)"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",fontSize:"0.875rem"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px"},children:[e.jsx(ae,{size:32,style:{color:"var(--text-primary)",transform:"rotate(0deg)"}}),e.jsx("span",{style:{position:"absolute",fontSize:"0.75rem",fontWeight:600,color:"var(--text-primary)",textAlign:"center"},children:t.difficulty||"~"})]}),e.jsx("span",{style:{fontSize:"0.875rem",fontWeight:500},children:"Difficulty"})]})}),(t.atk!==void 0||t.weapon||t.damage)&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[t.atk!==void 0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[e.jsx(Fe,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)"}}),e.jsxs("span",{style:{position:"absolute",fontSize:"0.875rem",fontWeight:600,color:"white",pointerEvents:"none"},children:[t.atk>=0?"+":"",t.atk]})]}),t.weapon&&e.jsxs("span",{children:[e.jsxs("strong",{children:[t.weapon,":"]})," ",t.range||"Melee"]}),t.damage&&e.jsxs("span",{children:[e.jsx("strong",{children:"Damage:"})," ",t.damage]})]}),t.experience&&t.experience.length>0&&e.jsxs("div",{children:[e.jsx("strong",{children:"Experience:"})," ",t.experience.map(r=>typeof r=="string"?r:`${r.name} ${r.modifier>=0?"+":""}${r.modifier}`).join(", ")]})]})}),t.features&&t.features.length>0&&e.jsxs("div",{style:{marginBottom:"1rem",padding:"0 8px"},children:[t.features.filter(r=>r.type==="Passive").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px",textAlign:"center",minWidth:"80px"},children:"Passives"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:t.features.filter(r=>r.type==="Passive").map((r,f)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:r.name}),r.description&&e.jsxs("span",{children:[" - ",r.description]})]},f))})]}),t.features.filter(r=>r.type==="Action").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px",textAlign:"center",minWidth:"80px"},children:"Actions"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:t.features.filter(r=>r.type==="Action").map((r,f)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:r.name}),r.description&&e.jsxs("span",{children:[" - ",r.description]})]},f))})]}),t.features.filter(r=>r.type==="Reaction").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px",textAlign:"center",minWidth:"80px"},children:"Reactions"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:t.features.filter(r=>r.type==="Reaction").map((r,f)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:r.name}),r.description&&e.jsxs("span",{children:[" - ",r.description]})]},f))})]})]})]}),t.type!=="Minion"&&t.thresholds&&e.jsx("div",{style:{marginTop:"1rem",padding:"0.75rem 8px 0 8px",borderTop:"1px solid var(--border)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",fontSize:"0.875rem"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"2px",marginTop:"-3px"},children:e.jsx(Z,{size:16,style:{color:"var(--red)"}})}),e.jsx(ve,{value:t.thresholds.major||"7"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"2px",marginTop:"-3px"},children:[e.jsx(Z,{size:16,style:{color:"var(--red)"}}),e.jsx(Z,{size:16,style:{color:"var(--red)"}})]}),e.jsx(ve,{value:t.thresholds.severe||"14"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"2px",marginTop:"-3px"},children:[e.jsx(Z,{size:16,style:{color:"var(--red)"}}),e.jsx(Z,{size:16,style:{color:"var(--red)"}}),e.jsx(Z,{size:16,style:{color:"var(--red)"}})]})]})}),N&&N.length>0&&e.jsx("div",{style:{marginTop:"1rem",borderTop:"1px solid var(--border)"},children:N.map((r,f)=>{const c=(r.hp||0)>=(r.hpMax||1);return e.jsx("div",{children:e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",borderRadius:"4px",padding:"4px",border:"1px solid var(--border)",marginBottom:"4px",display:"flex",justifyContent:"flex-start",alignItems:"center",gap:"8px",opacity:c?.7:1,backgroundColor:c?"var(--gray-900)":"var(--bg-secondary)",borderColor:c?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--border)",position:"relative"},children:[c&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                          45deg,
                          transparent 0px,
                          transparent 8px,
                          var(--gray-600) 9px,
                          var(--gray-600) 9px
                        )`,pointerEvents:"none",zIndex:1,borderRadius:"4px"}}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"var(--text-secondary)",fontSize:"0.75rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em",zIndex:2,backgroundColor:"var(--gray-900)",padding:"0.125rem 0.25rem",borderRadius:"0.25rem",border:"0.5px solid var(--gray-600)"},children:"DEFEATED"})]}),e.jsx("div",{style:{backgroundColor:"var(--bg-secondary)",borderRadius:"6px",border:"1px solid var(--border-hover)",width:"32px",textAlign:"center",flexShrink:0,padding:"2px"},children:e.jsx("span",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)"},children:r.duplicateNumber||1})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"2px"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:m=>{if(m.stopPropagation(),!d||s!=="adversary")return;m.currentTarget.getBoundingClientRect();const C=m.currentTarget.querySelector(".pip-container");if(!C)return;const W=C.getBoundingClientRect(),V=m.clientX-W.left,_=r.hp||0,H=r.hpMax||1;if(V<0){_>0&&g&&g(r.id,1,_);return}if(V>W.width){_<H&&d(r.id,1,_,H);return}const P=W.width,h=P*.05,D=P-2*h,q=V-h,G=_/H,J=D*G;q<J?_>0&&g&&g(r.id,1,_):_<H&&d(r.id,1,_,H)},children:e.jsx("div",{className:"pip-container",style:{display:"flex",gap:"2px",alignItems:"center"},children:Array.from({length:r.hpMax||1},(m,C)=>e.jsx("span",{style:{fontSize:"0.75rem",color:C<(r.hp||0)?"var(--red)":"var(--text-secondary)",transition:"all 0.1s ease"},children:e.jsx(Z,{size:16})},C))})}),r.stressMax>0&&e.jsx("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:m=>{if(m.stopPropagation(),!u||s!=="adversary")return;m.currentTarget.getBoundingClientRect();const C=m.currentTarget.querySelector(".pip-container");if(!C)return;const W=C.getBoundingClientRect(),V=m.clientX-W.left,_=r.stress||0,H=r.stressMax;if(V<0){_>0&&u(r.id,-1);return}if(V>W.width){_<H&&u(r.id,1);return}const P=W.width,h=P*.05,D=P-2*h,q=V-h,G=_/H,J=D*G;q<J?_>0&&u(r.id,-1):_<H&&u(r.id,1)},children:e.jsx("div",{className:"pip-container",style:{display:"flex",gap:"2px",alignItems:"center"},children:Array.from({length:r.stressMax},(m,C)=>e.jsx("span",{style:{fontSize:"0.75rem",color:C<(r.stress||0)?"var(--gold)":"var(--text-secondary)",transition:"all 0.1s ease"},children:e.jsx(Ce,{size:16})},C))})})]})]},r.id)},r.id)})}),t.motives&&e.jsxs("div",{style:{marginTop:"1rem",padding:"0.75rem 8px 0 8px",borderTop:"1px solid var(--border)"},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:"0 0 0.5rem 0"},children:"Motives"}),o?e.jsx("textarea",{style:{width:"100%",minHeight:"80px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-secondary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"vertical",fontFamily:"inherit"},value:t.motives,onChange:r=>{y&&y(t.id,{motives:r.target.value})},placeholder:"Enter adversary motives..."}):e.jsx("p",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",margin:0,whiteSpace:"pre-wrap"},children:t.motives})]}),t.description&&e.jsxs("div",{style:{marginTop:"1rem",padding:"0.75rem 8px 0 8px",borderTop:"1px solid var(--border)"},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:"0 0 0.5rem 0"},children:"Description"}),o?e.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-secondary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"vertical",fontFamily:"inherit"},value:t.description,onChange:r=>{y&&y(t.id,{description:r.target.value})},placeholder:"Enter adversary description..."}):e.jsx("p",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",margin:0,whiteSpace:"pre-wrap"},children:t.description})]}),L()]})},I=()=>{const o=p==="edit";return e.jsxs("div",{className:b(),style:{...F(!0),padding:0,minHeight:"400px",display:"flex",flexDirection:"column",position:"relative"},onClick:v,...p!=="expanded"&&{onMouseEnter:M,onMouseLeave:A},children:[e.jsx("div",{className:"border-b",style:{padding:"8px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.25rem"},children:[e.jsx("h2",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:0},children:t.name}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[t.tier&&e.jsxs("span",{style:{fontSize:"0.75rem",fontWeight:500,color:"var(--text-secondary)",letterSpacing:"0.5px"},children:["Tier ",t.tier]}),t.type&&e.jsx("span",{style:{fontSize:"0.75rem",fontWeight:500,color:"var(--text-secondary)",letterSpacing:"0.5px"},children:t.type})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.difficulty&&e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[e.jsx(ae,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)"}}),e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",fontWeight:700,color:"white",pointerEvents:"none"},children:t.difficulty})]}),!1]})]})}),e.jsxs("div",{style:{flex:1,overflowY:"auto",borderRadius:"0 0 8px 8px"},children:[t.description&&e.jsxs("div",{style:{marginBottom:"1rem",padding:"0 8px 0.75rem 8px",borderBottom:"1px solid var(--border)"},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:"0 0 0.5rem 0"},children:"Description"}),o?e.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-secondary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"vertical",fontFamily:"inherit"},value:t.description,onChange:n=>{y&&y(t.id,{description:n.target.value})},placeholder:"Enter environment description..."}):e.jsx("p",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",margin:0,whiteSpace:"pre-wrap"},children:t.description})]}),t.impulses&&e.jsxs("div",{style:{marginBottom:"1rem",padding:"0 8px 0.75rem 8px",borderBottom:"1px solid var(--border)"},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:"0 0 0.5rem 0"},children:"Impulses"}),e.jsx("p",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",margin:0,whiteSpace:"pre-wrap"},children:t.impulses})]}),e.jsxs("div",{style:{marginBottom:"1rem",padding:"0 8px 0.75rem 8px",borderBottom:"1px solid var(--border)"},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:"0 0 0.5rem 0"},children:"Core Stats"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",fontSize:"0.875rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap",fontSize:"0.875rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px"},children:[e.jsx(ae,{size:32,style:{color:"var(--text-primary)",transform:"rotate(0deg)"}}),e.jsx("span",{style:{position:"absolute",fontSize:"0.75rem",fontWeight:600,color:"var(--text-primary)",textAlign:"center"},children:t.difficulty||"~"})]}),e.jsx("span",{style:{fontSize:"0.875rem",fontWeight:500},children:"Difficulty"})]}),e.jsxs("span",{children:[e.jsx("strong",{children:"Type:"})," ",t.type]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx("span",{children:e.jsx("strong",{children:"Tier:"})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[e.jsx(Oe,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)"}}),e.jsx("span",{style:{position:"absolute",fontSize:"0.875rem",fontWeight:600,color:"white",pointerEvents:"none"},children:t.tier})]})]})]}),t.potentialAdversaries&&t.potentialAdversaries.length>0&&e.jsxs("div",{children:[e.jsx("strong",{children:"Potential Adversaries:"}),e.jsx("div",{style:{marginTop:"0.25rem",display:"flex",flexDirection:"column",gap:"0.125rem"},children:t.potentialAdversaries.map((n,r)=>e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",marginLeft:"0.5rem"},children:["• ",n]},r))})]})]})]}),t.features&&t.features.length>0&&e.jsxs("div",{style:{marginBottom:"1rem",padding:"0 8px"},children:[t.features.filter(n=>n.type==="Passive").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px",textAlign:"center",minWidth:"80px"},children:"Passives"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:t.features.filter(n=>n.type==="Passive").map((n,r)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("div",{style:{fontWeight:600,color:"white",marginBottom:"0.25rem"},children:n.name}),e.jsx("div",{style:{marginBottom:"0.25rem"},children:n.description}),n.details&&n.details.length>0&&e.jsxs("div",{style:{marginLeft:"0.5rem"},children:[e.jsx("strong",{children:"Details:"}),e.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:n.details.map((f,c)=>e.jsx("li",{children:f},c))})]}),n.prompts&&n.prompts.length>0&&e.jsxs("div",{style:{marginLeft:"0.5rem"},children:[e.jsx("strong",{children:"Prompts:"}),e.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:n.prompts.map((f,c)=>e.jsxs("li",{style:{fontStyle:"italic"},children:['"',f,'"']},c))})]})]},r))})]}),t.features.filter(n=>n.type==="Action").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px",textAlign:"center",minWidth:"80px"},children:"Actions"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:t.features.filter(n=>n.type==="Action").map((n,r)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("div",{style:{fontWeight:600,color:"white",marginBottom:"0.25rem"},children:n.name}),e.jsx("div",{style:{marginBottom:"0.25rem"},children:n.description}),n.details&&n.details.length>0&&e.jsxs("div",{style:{marginLeft:"0.5rem"},children:[e.jsx("strong",{children:"Details:"}),e.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:n.details.map((f,c)=>e.jsx("li",{children:f},c))})]}),n.prompts&&n.prompts.length>0&&e.jsxs("div",{style:{marginLeft:"0.5rem"},children:[e.jsx("strong",{children:"Prompts:"}),e.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:n.prompts.map((f,c)=>e.jsxs("li",{style:{fontStyle:"italic"},children:['"',f,'"']},c))})]})]},r))})]}),t.features.filter(n=>n.type==="Reaction").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px",textAlign:"center",minWidth:"80px"},children:"Reactions"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:t.features.filter(n=>n.type==="Reaction").map((n,r)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("div",{style:{fontWeight:600,color:"white",marginBottom:"0.25rem"},children:n.name}),e.jsx("div",{style:{marginBottom:"0.25rem"},children:n.description}),n.details&&n.details.length>0&&e.jsxs("div",{style:{marginLeft:"0.5rem"},children:[e.jsx("strong",{children:"Details:"}),e.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:n.details.map((f,c)=>e.jsx("li",{children:f},c))})]}),n.prompts&&n.prompts.length>0&&e.jsxs("div",{style:{marginLeft:"0.5rem"},children:[e.jsx("strong",{children:"Prompts:"}),e.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:n.prompts.map((f,c)=>e.jsxs("li",{style:{fontStyle:"italic"},children:['"',f,'"']},c))})]})]},r))})]})]}),N&&N.length>0&&e.jsx("div",{style:{marginTop:"1rem",borderTop:"1px solid var(--border)"},children:N.map((n,r)=>{const f=(n.hp||0)>=(n.hpMax||1);return e.jsx("div",{children:e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",borderRadius:"4px",padding:"8px",border:"1px solid var(--border)",marginBottom:"4px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"8px",opacity:f?.7:1,backgroundColor:f?"var(--gray-900)":"var(--bg-secondary)",borderColor:f?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--border)",position:"relative"},children:[f&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                            45deg,
                            transparent 0px,
                            transparent 8px,
                            var(--gray-600) 9px,
                            var(--gray-600) 9px
                          )`,pointerEvents:"none",zIndex:1,borderRadius:"4px"}}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"var(--text-secondary)",fontSize:"0.75rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em",zIndex:2,backgroundColor:"var(--gray-900)",padding:"0.125rem 0.25rem",borderRadius:"0.25rem",border:"0.5px solid var(--gray-600)"},children:"DEFEATED"})]}),e.jsx("div",{style:{backgroundColor:"var(--bg-secondary)",borderRadius:"3px",padding:"2px 6px",border:"1px solid var(--border)",minWidth:"24px",textAlign:"center"},children:e.jsx("span",{style:{fontSize:"0.75rem",fontWeight:600,color:"var(--text-primary)"},children:n.duplicateNumber||1})}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:1},children:e.jsxs("span",{style:{fontSize:"0.75rem",fontWeight:500,color:"var(--text-secondary)"},children:["Instance ",r+1]})})]},n.id)},n.id)})})]})]})};return(p==="expanded"||p==="edit")&&(s==="adversary"||s==="adversaries")?R():(p==="expanded"||p==="edit")&&(s==="environment"||s==="environments")?I():s==="adversary"||s==="adversaries"||s==="environment"||s==="environments"?null:e.jsxs("div",{className:b(),style:F(!0),children:[e.jsxs("div",{style:U.rowMain,children:[e.jsx("h4",{style:U.rowTitle,children:$()}),e.jsx("div",{style:U.rowMeta,children:l()})]}),e.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"12px",margin:0},children:["Expanded view coming soon for ",s]})]})},at="modulepreload",lt=function(t){return"/Daggerheart/"+t},be={},je=function(s,p,v){if(!p||p.length===0)return s();const x=document.getElementsByTagName("link");return Promise.all(p.map(d=>{if(d=lt(d),d in be)return;be[d]=!0;const g=d.endsWith(".css"),u=g?'[rel="stylesheet"]':"";if(!!v)for(let E=x.length-1;E>=0;E--){const k=x[E];if(k.href===d&&(!g||k.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${u}`))return;const B=document.createElement("link");if(B.rel=g?"stylesheet":at,g||(B.as="script",B.crossOrigin=""),B.href=d,document.head.appendChild(B),g)return new Promise((E,k)=>{B.addEventListener("load",E),B.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${d}`)))})})).then(()=>s()).catch(d=>{const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=d,window.dispatchEvent(g),!g.defaultPrevented)throw d})},oe={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},we={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1,lowerTierAdversary:1};let We={adversaries:[]},Ae={environments:[]};const dt=async()=>{try{const t=await je(()=>import("./adversaries-77db5e43.js"),[]);We=(t==null?void 0:t.default)||t}catch(t){console.warn("Failed to load adversaries.json:",t)}try{const t=await je(()=>import("./environments-5ca1c1e1.js"),[]);Ae=(t==null?void 0:t.default)||t}catch(t){console.warn("Failed to load environments.json:",t)}},ct=(t,s=[],p=4,v=1)=>{const[x,d]=w.useState(""),[g,u]=w.useState([{field:"tier",direction:"asc"},{field:"name",direction:"asc"}]),[y,B]=w.useState([]),[E,k]=w.useState(!0),[N,S]=w.useState([]),[j,O]=w.useState([]),[T,M]=w.useState(!1),[A,F]=w.useState(!1),b=w.useRef(null),$=w.useRef(null);w.useEffect(()=>{(async()=>{await dt(),k(!1);let m=[];t==="adversary"?m=We.adversaries||[]:t==="environment"&&(m=Ae.environments||[]),B(m)})()},[t]);const l=c=>{const m=y.map(C=>C[c]).filter(Boolean);return[...new Set(m)].sort((C,W)=>typeof C=="number"&&typeof W=="number"?C-W:String(C).localeCompare(String(W)))},L=l("tier"),R=l("type"),I=w.useMemo(()=>{let c=y.filter(m=>{var _,H;const C=m.name.toLowerCase().includes(x.toLowerCase())||((_=m.type)==null?void 0:_.toLowerCase().includes(x.toLowerCase()))||((H=m.description)==null?void 0:H.toLowerCase().includes(x.toLowerCase())),W=N.length===0||(N.includes("party-tier")?m.tier===v:N.includes(m.tier.toString())),V=j.length===0||j.includes(m.type);return C&&W&&V});return c.sort((m,C)=>{for(const W of g){const{field:V,direction:_}=W;let H=m[V],P=C[V];if(V==="tier")H=parseInt(H)||0,P=parseInt(P)||0;else if(V==="cost"){const h=D=>{if(t!=="adversary")return 0;const q=oe[D.type]||2;let G=0;const J=s.filter(X=>X.type==="adversary"&&X.item.type==="Solo"&&X.quantity>0).reduce((X,Q)=>X+Q.quantity,0),K=s.filter(X=>X.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(X.item.type)&&X.quantity>0).reduce((X,Q)=>X+Q.quantity,0);return D.type==="Solo"&&J===1&&(G+=2),["Bruiser","Horde","Leader","Solo"].includes(D.type)&&K===0&&(G+=1),q+G};H=h(m),P=h(C)}else if(V==="difficulty"){const h=parseInt(H),D=parseInt(P);!isNaN(h)&&!isNaN(D)?(H=h,P=D):!isNaN(h)&&isNaN(D)?(H=h,P=999):isNaN(h)&&!isNaN(D)?(H=999,P=D):(H=String(H||"").toLowerCase(),P=String(P||"").toLowerCase())}else typeof H=="string"&&typeof P=="string"?(H=H.toLowerCase(),P=P.toLowerCase()):(H=String(H||"").toLowerCase(),P=String(P||"").toLowerCase());if(_==="asc"){if(H>P)return 1;if(H<P)return-1}else{if(H<P)return 1;if(H>P)return-1}}return 0}),c},[y,x,g,N,j,s,p,v]),a=c=>{u(m=>{const C=m.findIndex(W=>W.field===c);if(C>=0)if(C===0){const W=[...m];return W[0]={...W[0],direction:W[0].direction==="asc"?"desc":"asc"},W}else{const W=[...m];return W.splice(C,1)[0],[{field:c,direction:"asc"},...W]}else return[{field:c,direction:"asc"},...m]})},i=c=>{S(c==="clear"?[]:c==="party-tier"?["party-tier"]:m=>m.includes(c)?m.filter(C=>C!==c):[...m,c])},o=c=>{O(c==="clear"?[]:m=>m.includes(c)?m.filter(C=>C!==c):[...m,c])},n=N.length>0,r=j.length>0;return w.useEffect(()=>{const c=C=>{const W=C.target.closest(".filter-dropdown"),V=C.target.closest(".header-filter-icon");W||V||(M(!1),F(!1))},m=C=>{C.key==="Escape"&&(M(!1),F(!1))};return document.addEventListener("pointerdown",c,!0),document.addEventListener("mousedown",c,!0),document.addEventListener("touchstart",c,!0),document.addEventListener("click",c,!0),document.addEventListener("keydown",m,!0),()=>{document.removeEventListener("pointerdown",c,!0),document.removeEventListener("mousedown",c,!0),document.removeEventListener("touchstart",c,!0),document.removeEventListener("click",c,!0),document.removeEventListener("keydown",m,!0)}},[M,F]),{searchTerm:x,setSearchTerm:d,sortFields:g,handleSort:a,filteredAndSortedData:I,loading:E,selectedTiers:N,selectedTypes:j,showTierDropdown:T,setShowTierDropdown:M,showTypeDropdown:A,setShowTypeDropdown:F,tierFilterRef:b,typeFilterRef:$,uniqueTiers:L,uniqueTypes:R,handleTierSelect:i,handleTypeSelect:o,isTierFiltered:n,isTypeFiltered:r,getDropdownStyle:c=>{if(!c.current)return{};const m=c.current.getBoundingClientRect();return{position:"fixed",top:m.bottom+4,left:m.left-100,zIndex:99999}}}},pt=({searchTerm:t,onSearchChange:s,type:p,partyControls:v})=>e.jsxs("div",{style:z.browserHeader,children:[e.jsx("input",{type:"text",placeholder:"Search",value:t,onChange:x=>s(x.target.value),style:z.searchInput}),v&&e.jsx("div",{style:z.partyControls,children:v})]}),xt=({sortFields:t,onSort:s,type:p,uniqueTiers:v,uniqueTypes:x,selectedTiers:d,selectedTypes:g,showTierDropdown:u,setShowTierDropdown:y,showTypeDropdown:B,setShowTypeDropdown:E,tierFilterRef:k,typeFilterRef:N,handleTierSelect:S,handleTypeSelect:j,isTierFiltered:O,isTypeFiltered:T,getDropdownStyle:M,costFilter:A,showCostDropdown:F,setShowCostDropdown:b,costFilterRef:$,handleCostFilterSelect:l,isCostFiltered:L})=>{const[R,I]=w.useState(null),i=(()=>p==="adversary"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"cost",label:"Cost",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:p==="environment"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:[])(),o=()=>{if(!F)return null;const r=[{value:"all",label:"All"},{value:"auto-grey",label:"Auto Grey"},{value:"auto-hide",label:"Auto Hide"}];return de.createPortal(e.jsx("div",{className:"filter-dropdown",style:{...z.filterDropdown,...M($),maxHeight:"60vh",overflow:"auto"},onMouseDown:f=>f.stopPropagation(),onClick:f=>f.stopPropagation(),children:r.map(f=>{const c=A===f.value;return e.jsxs("div",{style:{...z.filterOption,...c?z.filterOptionSelected:{}},onClick:()=>l(f.value),children:[e.jsx("span",{style:z.checkIcon,children:c?e.jsx(re,{size:16}):e.jsx(ne,{size:16})}),e.jsx("span",{style:z.filterLabel,children:f.label})]},f.value)})}),document.body)},n=(r,f,c,m,C,W,V,_)=>{if(!C)return null;const H=()=>{(r==="tier"||r==="type")&&m("clear")};return de.createPortal(e.jsxs("div",{className:"filter-dropdown",style:{...z.filterDropdown,...M(V),maxHeight:"60vh",overflow:"auto"},onMouseDown:P=>P.stopPropagation(),onClick:P=>P.stopPropagation(),children:[e.jsxs("div",{style:{...z.filterOption,...c.length===0?z.filterOptionSelected:{}},onClick:H,children:[e.jsx("span",{style:z.checkIcon,children:c.length===0?e.jsx(re,{size:16}):e.jsx(ne,{size:16})}),e.jsx("span",{style:z.filterLabel,children:"All"})]}),r==="tier"&&e.jsxs("div",{style:{...z.filterOption,...c.includes("party-tier")?z.filterOptionSelected:{}},onClick:()=>m("party-tier"),children:[e.jsx("span",{style:z.checkIcon,children:c.includes("party-tier")?e.jsx(re,{size:16}):e.jsx(ne,{size:16})}),e.jsx("span",{style:z.filterLabel,children:"Party Tier"})]}),f.map(P=>{const h=c.includes(P.toString());return e.jsxs("div",{style:{...z.filterOption,...h?z.filterOptionSelected:{}},onClick:()=>m(P.toString()),children:[e.jsx("span",{style:z.checkIcon,children:h?e.jsx(re,{size:16}):e.jsx(ne,{size:16})}),e.jsx("span",{style:z.filterLabel,children:P})]},P)})]}),document.body)};return e.jsx("tr",{style:z.tableHeader,children:i.map(r=>e.jsxs("th",{style:{...z.tableHeaderCell,...R===r.key?z.tableHeaderCellHover:{},position:"relative",...r.key==="name"?{width:"auto",minWidth:"0"}:{},...r.key==="tier"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...r.key==="type"?{width:"80px",minWidth:"80px",maxWidth:"80px"}:{},...r.key==="difficulty"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...r.key==="cost"?{width:"50px",minWidth:"50px",maxWidth:"50px"}:{},...r.key==="action"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{}},onClick:()=>s(r.key),onMouseEnter:()=>I(r.key),onMouseLeave:()=>I(null),children:[r.hasFilter?e.jsxs("div",{style:z.headerWithFilter,children:[e.jsx("span",{style:{cursor:"pointer"},onClick:f=>{f.stopPropagation(),s(r.key)},children:r.label}),e.jsxs("button",{ref:r.key==="tier"?k:r.key==="type"?N:$,style:{...z.headerFilterIcon,...r.key==="tier"&&O?z.headerFilterIconActive:{},...r.key==="type"&&T?z.headerFilterIconActive:{},...r.key==="cost"&&L?z.headerFilterIconActive:{}},className:"header-filter-icon",onClick:f=>{f.stopPropagation(),r.key==="tier"?(y(!u),E(!1),b(!1)):r.key==="type"?(E(!B),y(!1),b(!1)):r.key==="cost"&&(b(!F),y(!1),E(!1))},children:[e.jsx(qe,{size:14}),r.key==="tier"&&O||r.key==="type"&&T||r.key==="cost"&&L?e.jsx("span",{style:z.filterActiveDot}):null]})]}):r.label,r.key==="tier"&&n("tier",v,d,S,u,y,k),r.key==="type"&&n("type",x,g,j,B,E,N),r.key==="cost"&&o()]},r.key))})},ut=({item:t,onAdd:s,type:p,onRowClick:v,encounterItems:x=[],pcCount:d=4,playerTier:g=1,remainingBudget:u=0,costFilter:y="auto-grey",onAdversaryClick:B})=>{const[E,k]=w.useState(!1),N=()=>{s(t)},S=()=>{if(p!=="adversary")return null;const T=oe[t.type]||2;let M=0;const A=x.filter(b=>b.type==="adversary"&&b.item.type==="Solo"&&b.quantity>0).reduce((b,$)=>b+$.quantity,0),F=x.filter(b=>b.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(b.item.type)&&b.quantity>0).reduce((b,$)=>b+$.quantity,0);return t.type==="Solo"&&A===1&&(M+=2),["Bruiser","Horde","Leader","Solo"].includes(t.type)&&F===0&&(M+=1),T+M},O=(()=>{if(p==="adversary"){const T=S();oe[t.type];const M=T>u||u<=0;if(y==="auto-hide"&&M)return null;const A=y==="auto-grey"&&M?{opacity:.5,color:"var(--text-secondary)"}:{};return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...z.rowCell,width:"auto",minWidth:"0",textAlign:"left",...A},children:e.jsxs("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:[e.jsx("div",{style:{fontWeight:"600"},children:t.name}),t.description&&e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"0.125rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.description})]})}),e.jsx("td",{style:{...z.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...A},children:t.tier}),e.jsx("td",{style:{...z.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center",...A},children:t.type}),e.jsx("td",{style:{...z.rowCell,width:"50px",minWidth:"50px",maxWidth:"50px",textAlign:"center",...A},children:T}),e.jsx("td",{style:{...z.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...A},children:t.difficulty})]})}else if(p==="environment")return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...z.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:t.name}),e.jsx("td",{style:{...z.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:t.tier}),e.jsx("td",{style:{...z.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:t.type}),e.jsx("td",{style:{...z.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:t.difficulty})]});return null})();return O===null?null:e.jsx(e.Fragment,{children:e.jsxs("tr",{style:{...z.row,...E?z.rowHover:{}},onClick:()=>{p==="adversary"&&B?B(t):v&&v(t,p)},onMouseEnter:()=>k(!0),onMouseLeave:()=>k(!1),children:[O,e.jsx("td",{style:{width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",boxSizing:"border-box",overflow:"visible",textOverflow:"unset",whiteSpace:"nowrap"},children:e.jsx("button",{style:z.addButton,onClick:T=>{T.stopPropagation(),N()},onMouseEnter:T=>{T.target.style.background="var(--bg-secondary)"},onMouseLeave:T=>{T.target.style.background="var(--purple)"},children:"+"})})]})})},ht=({type:t,onAddItem:s,onCancel:p,onRowClick:v,encounterItems:x=[],pcCount:d=4,playerTier:g=1,partyControls:u=null,showContainer:y=!0})=>{const[B,E]=w.useState("all"),[k,N]=w.useState(!1),[S,j]=w.useState(null),O=w.useRef(null),{searchTerm:T,setSearchTerm:M,sortFields:A,handleSort:F,filteredAndSortedData:b,loading:$,selectedTiers:l,selectedTypes:L,showTierDropdown:R,setShowTierDropdown:I,showTypeDropdown:a,setShowTypeDropdown:i,tierFilterRef:o,typeFilterRef:n,uniqueTiers:r,uniqueTypes:f,handleTierSelect:c,handleTypeSelect:m,isTierFiltered:C,isTypeFiltered:W,getDropdownStyle:V}=ct(t,x,d,g),H=(()=>{const D=3*d+2,q=x.reduce((Y,ee)=>{if(ee.type==="adversary"){const ue=oe[ee.item.type]||2;if(ee.item.type==="Minion"){const ze=Math.ceil(ee.quantity/d);return Y+ze*ue}else return Y+ee.quantity*ue}return Y},0);let G=0;x.filter(Y=>Y.type==="adversary"&&Y.item.type==="Solo"&&Y.quantity>0).reduce((Y,ee)=>Y+ee.quantity,0)>=2&&(G+=we.twoOrMoreSolos);const K=x.some(Y=>Y.type==="adversary"&&Y.item.type==="Bruiser"&&Y.quantity>0),X=x.some(Y=>Y.type==="adversary"&&Y.item.type==="Horde"&&Y.quantity>0),Q=x.some(Y=>Y.type==="adversary"&&Y.item.type==="Leader"&&Y.quantity>0),xe=x.some(Y=>Y.type==="adversary"&&Y.item.type==="Solo"&&Y.quantity>0);return!K&&!X&&!Q&&!xe&&(G+=we.noBruisersHordesLeadersSolos),D+G-q})(),P=D=>{E(D),N(!1)},h=B!=="all";return $?e.jsx("div",{style:z.browser,children:e.jsx("div",{style:z.loading,children:"Loading..."})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:y?z.browserWrapper:z.browserWrapperNoContainer,children:[e.jsx(pt,{searchTerm:T,onSearchChange:M,type:t,partyControls:u}),e.jsx("div",{className:"browser-content invisible-scrollbar",style:z.browserContent,children:e.jsxs("table",{style:z.browserTable,children:[e.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,backgroundColor:"var(--bg-primary)"},children:e.jsx(xt,{sortFields:A,onSort:F,type:t,uniqueTiers:r,uniqueTypes:f,selectedTiers:l,selectedTypes:L,showTierDropdown:R,setShowTierDropdown:I,showTypeDropdown:a,setShowTypeDropdown:i,tierFilterRef:o,typeFilterRef:n,handleTierSelect:c,handleTypeSelect:m,isTierFiltered:C,isTypeFiltered:W,getDropdownStyle:V,costFilter:B,showCostDropdown:k,setShowCostDropdown:N,costFilterRef:O,handleCostFilterSelect:P,isCostFiltered:h})}),e.jsx("tbody",{children:b.map(D=>e.jsx(ut,{item:D,onAdd:s,type:t,onRowClick:v,encounterItems:x,pcCount:d,playerTier:g,remainingBudget:H,costFilter:B,onAdversaryClick:q=>{t==="adversary"&&j(q)}},D.id))})]})})]}),S&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:2e3,display:"flex",alignItems:"center",justifyContent:"center",padding:"2rem"},onClick:()=>j(null),children:e.jsx("div",{style:{maxWidth:"600px",width:"90vw",maxHeight:"80vh",overflowY:"auto"},onClick:D=>D.stopPropagation(),children:e.jsx(Ie,{item:S,type:"adversary",mode:"expanded",onClose:()=>j(null)})})})]})},z={browserWrapper:{display:"flex",flexDirection:"column",background:"var(--bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border)",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserWrapperNoContainer:{display:"flex",flexDirection:"column",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserContent:{flex:1,overflowY:"auto",overflowX:"visible",padding:0,width:"100%",scrollbarWidth:"none",msOverflowStyle:"none"},tableHeaderContainer:{flexShrink:0,position:"sticky",top:0,zIndex:15,backgroundColor:"var(--bg-secondary)"},browserTable:{width:"100%",minWidth:"100%",borderCollapse:"collapse",tableLayout:"fixed",background:"var(--bg-primary)",margin:0},browserHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--gray-900)",flexShrink:0,position:"sticky",top:0,zIndex:20},browserTitle:{margin:0,color:"var(--text-primary)",fontSize:"18px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"24px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",marginRight:"12px",transition:"all 0.2s ease"},partyControls:{display:"flex",alignItems:"center",gap:"12px",flexShrink:0},searchInputFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 3px rgba(139, 92, 246, 0.1)"},tableHeader:{background:"var(--gray-900)",borderBottom:"1px solid var(--border)",boxShadow:"0 1px 0 var(--border)",position:"sticky",top:"0",zIndex:10},tableHeaderCell:{backgroundColor:"var(--gray-900)",fontWeight:"700",borderBottom:"1px solid var(--border)",cursor:"pointer",userSelect:"none",minWidth:"100px",whiteSpace:"nowrap",padding:"4px 4px",color:"var(--text-primary)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",boxShadow:"0 1px 0 var(--border)",transition:"background-color 0.2s",position:"sticky",top:"0",zIndex:10},tableHeaderCellHover:{backgroundColor:"var(--bg-hover)"},sortIndicator:{fontSize:"12px",color:"var(--text-secondary)"},tableBody:{flex:1,overflowY:"auto",padding:"8px",backgroundColor:"var(--bg-primary)"},row:{height:"35px",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s ease",cursor:"pointer",backgroundColor:"var(--gray-900)"},rowHover:{backgroundColor:"var(--bg-secondary)"},expandedRow:{backgroundColor:"var(--bg-secondary)"},rowCell:{padding:"4px 4px",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid var(--border)"},rowCellName:{fontWeight:"500",minWidth:"150px"},rowCellCenter:{textAlign:"center",justifyContent:"center",minWidth:"80px"},rowActions:{width:"80px",textAlign:"center",padding:"4px 8px",borderBottom:"1px solid var(--border)"},addButton:{width:"2rem",height:"2rem",border:"1px solid var(--purple)",borderRadius:"var(--radius-sm)",background:"var(--purple)",color:"white",cursor:"pointer",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"500"},expandedContent:{padding:"0",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)"},columnName:{width:"auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",paddingLeft:"8px",textAlign:"left"},columnTier:{width:"80px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnType:{width:"100px",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},columnDifficulty:{width:"40px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnAction:{width:"32px",minWidth:"24px",maxWidth:"24px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"visible",textOverflow:"unset"},loading:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"var(--text-primary)",fontSize:"16px"},mobileBrowser:{width:"95vw",height:"90vh",maxWidth:"none"},mobileSearchInput:{fontSize:"16px"},headerWithFilter:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0px",position:"relative"},headerFilterIcon:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"2px 4px",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",position:"relative",marginLeft:"-2px"},headerFilterIconActive:{color:"var(--purple)"},filterIcon:{fontSize:"12px"},filterActiveDot:{position:"absolute",left:"50%",top:"2px",transform:"translateX(-50%)",width:"4px",height:"4px",borderRadius:"50%",background:"var(--purple)",pointerEvents:"none"},filterDropdown:{position:"fixed",background:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",zIndex:99999,marginTop:"4px",overflow:"hidden",width:"max-content",minWidth:"120px",maxWidth:"200px"},filterOption:{padding:"8px 12px",cursor:"pointer",color:"var(--text-primary)",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background-color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},filterOptionSelected:{backgroundColor:"var(--bg-hover)"},checkIcon:{width:"16px",height:"16px",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"12px"},filterLabel:{flex:1}},gt=()=>e.jsx("div",{className:"pwa-install-prompt",style:{}}),mt=({side:t="left",children:s,className:p="",style:v={}})=>{const x=t==="left",d={flex:1,minWidth:0,background:"var(--bg-primary)",overflowY:"auto",overflowX:x?"auto":"hidden",display:x?"block":"flex",flexDirection:x?"initial":"column",height:"100%",padding:x?"8px 0 8px 0":"0 8px 0 0",...v};return e.jsx("div",{className:p,style:d,children:s})},ft=t=>3*t+2,yt={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},le={lessDifficult:-1,twoOrMoreSolos:-2,increasedDamage:-2,lowerTierAdversary:1,noBruisersHordesLeadersSolos:1,moreDangerous:2},vt=({isOpen:t,onClose:s,onAddAdversary:p,onAddAdversariesBulk:v,onAddEnvironment:x,adversaries:d=[],environments:g=[]})=>{const[u,y]=w.useState(4),[B,E]=w.useState({lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),[k,N]=w.useState([]),S=te.useRef(u);te.useEffect(()=>{if(t&&d.length>0){const l={};d.forEach(R=>{var a;const I=R.baseName||((a=R.name)==null?void 0:a.replace(/\s+\(\d+\)$/,""))||R.name;l[I]||(l[I]={type:"adversary",item:R,quantity:0}),l[I].quantity+=1});const L=Object.values(l);N(L)}else t&&d.length===0&&N([])},[t,d]);const j=te.useMemo(()=>{let l=0;k.filter(o=>o.type==="adversary"&&o.item.type==="Solo"&&o.quantity>0).reduce((o,n)=>o+n.quantity,0)>=2&&(l+=le.twoOrMoreSolos);const R=k.some(o=>o.type==="adversary"&&o.item.type==="Bruiser"&&o.quantity>0),I=k.some(o=>o.type==="adversary"&&o.item.type==="Horde"&&o.quantity>0),a=k.some(o=>o.type==="adversary"&&o.item.type==="Leader"&&o.quantity>0),i=k.some(o=>o.type==="adversary"&&o.item.type==="Solo"&&o.quantity>0);return!R&&!I&&!a&&!i&&(l+=le.noBruisersHordesLeadersSolos),l},[k]),O=ft(u),T=Object.entries(B).filter(([l,L])=>L).reduce((l,[L,R])=>l+le[L],0),M=O+T+j,A=k.reduce((l,L)=>{if(L.type==="adversary"){const R=yt[L.item.type]||2;return L.item.type==="Minion"?l+Math.ceil(L.quantity/u)*R:l+R*L.quantity}return l},0);te.useEffect(()=>{const l=S.current;l!==u&&(N(L=>L.map(R=>{if(R.type==="adversary"&&R.item.type==="Minion"){const a=Math.ceil(R.quantity/l)*u;return{...R,quantity:a}}return R})),S.current=u)},[u]);const F=(l,L)=>{const R=k.findIndex(a=>a.item.id===l.id&&a.type===L),I=l.type==="Minion"?u:1;R>=0?N(a=>a.map((i,o)=>o===R?{...i,quantity:i.quantity+I}:i)):N(a=>[...a,{item:l,type:L,quantity:I}])},b=(l,L)=>{N(R=>{const I=R.findIndex(a=>a.item.id===l&&a.type===L);if(I>=0){const a=R[I],i=a.item.type==="Minion"?u:1;return a.quantity>0?R.map((o,n)=>n===I?{...o,quantity:Math.max(0,o.quantity-i)}:o):R.filter((o,n)=>n!==I)}return R})},$=()=>{const l=[];k.forEach(L=>{for(let R=0;R<L.quantity;R++)L.type==="adversary"&&l.push(L.item)}),l.length>0&&v(l),N([]),s()};return t?e.jsx("div",{onClick:s,className:"encounter-builder-modal",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:1e3,display:"flex",alignItems:"flex-start",justifyContent:"center",padding:"12px"},children:e.jsx("div",{onClick:l=>l.stopPropagation(),style:{backgroundColor:"var(--bg-primary)",border:"2px solid var(--border)",borderRadius:"12px",width:"100%",maxWidth:"1200px",height:"calc(100vh - 24px)",maxHeight:"800px",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"},children:e.jsxs("div",{className:"encounter-builder-content",style:{display:"flex",flex:1,overflow:"hidden"},children:[e.jsx("div",{className:"encounter-browser-panel",style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:e.jsx(ht,{type:"adversary",onAddItem:l=>F(l,"adversary"),onCancel:s,encounterItems:k,pcCount:u,showContainer:!1})}),e.jsx("div",{className:"encounter-receipt-panel",style:{width:"350px",borderLeft:"1px solid var(--border)",display:"flex",flexDirection:"column"},children:e.jsxs("div",{className:"receipt-content",style:{padding:"1rem",height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"flex-start",overflowY:"auto",marginBottom:"0.75rem"},children:[k.map(l=>{var L;return l.type!=="adversary"?null:e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>b(l.item.id,l.type),style:{background:l.quantity===0?"var(--danger)":"var(--bg-secondary)",border:l.quantity===0?"none":"1px solid var(--border)",color:l.quantity===0?"white":"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:l.quantity===0?e.jsx(pe,{size:10}):e.jsx(ge,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:l.quantity}),e.jsx("button",{onClick:()=>F(l.item,l.type),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(me,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:l.item.baseName||((L=l.item.name)==null?void 0:L.replace(/\s+\(\d+\)$/,""))||l.item.name})}),e.jsx("div",{style:{width:"80px",textAlign:"right"},children:e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.8rem"},children:l.item.type})})]},`${l.item.id}-${l.type}`)}),e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>y(Math.max(1,u-1)),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(ge,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:u}),e.jsx("button",{onClick:()=>y(u+1),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(me,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Party Size"})}),e.jsx("div",{style:{width:"80px",textAlign:"right"},children:e.jsxs("span",{style:{color:A>M?"var(--danger)":A===M?"var(--purple)":"var(--text-primary)",fontWeight:600},children:[A,"/",M]})})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"0.5rem",padding:"0.75rem 0 0 0",borderTop:"1px solid var(--border)",marginTop:"0.5rem",flexShrink:0},children:[e.jsx("button",{onClick:s,style:{background:"var(--bg-primary)",border:"1px solid var(--border)",color:"var(--text-primary)",padding:"0.5rem 1rem",borderRadius:"6px",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:l=>l.target.style.backgroundColor="var(--bg-hover)",onMouseLeave:l=>l.target.style.backgroundColor="var(--bg-primary)",children:"Cancel"}),e.jsx("button",{onClick:$,disabled:k.length===0,style:{background:k.length===0?"var(--gray-600)":"var(--purple)",border:"none",color:"white",padding:"0.5rem 1rem",borderRadius:"6px",cursor:k.length===0?"not-allowed":"pointer",transition:"all 0.2s",opacity:k.length===0?.6:1},onMouseEnter:l=>{k.length>0&&(l.target.style.backgroundColor="var(--purple-dark)")},onMouseLeave:l=>{k.length>0&&(l.target.style.backgroundColor="var(--purple)")},children:"Create Encounter"})]})]})})]})})}):null};class bt extends te.Component{constructor(s){super(s),this.state={hasError:!1,error:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,p){console.error("ErrorBoundary caught an error:",s,p)}render(){var s;return this.state.hasError?e.jsxs("div",{className:"p-md text-red",children:[e.jsx("h3",{children:"Something went wrong:"}),e.jsx("pre",{children:(s=this.state.error)==null?void 0:s.toString()}),e.jsx("button",{className:"btn-base btn-text",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try again"})]}):this.props.children}}const jt=()=>{const{adversaries:t,environments:s,countdowns:p,fear:v,updateFear:x,createAdversary:d,createAdversariesBulk:g,updateAdversary:u,deleteAdversary:y,createEnvironment:B,updateEnvironment:E,deleteEnvironment:k,createCountdown:N,updateCountdown:S,deleteCountdown:j,advanceCountdown:O}=Ze(),[T,M]=w.useState(!1),[A,F]=w.useState(!1);w.useState(!1);const[b,$]=w.useState(!1);w.useState(!0);const[l,L]=w.useState(null),[R,I]=w.useState(0),[a,i]=w.useState(0),[o,n]=w.useState(!1);w.useEffect(()=>{const h=()=>{const q=window.matchMedia("(max-width: 800px)");M(q.matches)};h();const D=window.matchMedia("(max-width: 800px)");return D.addEventListener("change",h),()=>D.removeEventListener("change",h)},[]);const r=12,f=h=>h===1?200:350,c=h=>{if(h<=0)return{visibleColumns:1,columnWidth:f(1)};const D=r*2,q=h-D;let G={visibleColumns:1,columnWidth:q};for(let K=1;K<=5;K++){const X=(K-1)*r,Q=(q-X)/K;Q>=f(K)&&K*Q+X<=q&&(G={visibleColumns:K,columnWidth:Q})}return G.visibleColumns*G.columnWidth+(G.visibleColumns-1)*r>q&&(G={visibleColumns:1,columnWidth:q}),G},{visibleColumns:m,columnWidth:C}=c(R);w.useEffect(()=>{const h=()=>{I(window.innerWidth)};return h(),window.addEventListener("resize",h),()=>window.removeEventListener("resize",h)},[]);const W=()=>{F(!0)},V=w.useCallback(()=>{F(!1)},[]),_=w.useCallback(h=>{i(h.target.scrollLeft)},[]);w.useCallback(()=>{n(!0)},[]),w.useCallback(()=>{setTimeout(()=>n(!1),100)},[]);const P=(()=>{const h={};return t.forEach(D=>{var G;const q=D.baseName||((G=D.name)==null?void 0:G.replace(/\s+\(\d+\)$/,""))||D.name;h[q]||(h[q]={type:"adversary",baseName:q,instances:[]}),h[q].instances.push(D)}),s.forEach(D=>{h[D.name]||(h[D.name]={type:"environment",baseName:D.name,instances:[]}),h[D.name].instances.push(D)}),p.forEach(D=>{h[`countdown-${D.id}`]={type:"countdown",baseName:D.name,instances:[D]}}),Object.values(h)})();return P.length,e.jsxs("div",{className:"app",onClick:h=>{h.target,h.currentTarget},children:[e.jsx(st,{adversaries:t,environments:s,countdowns:p,deleteAdversary:y,deleteEnvironment:k,deleteCountdown:j,isClearMode:b,setIsClearMode:$,sortAdversaries:()=>{},onOpenDatabase:W}),e.jsx("div",{className:"main-content",style:{position:"relative",width:"100%"},children:e.jsx("div",{className:"dashboard-scroll-container",style:{display:"flex",flexDirection:"row",overflowX:"auto",overflowY:"hidden",padding:`0 ${r}px`,scrollSnapType:"x mandatory",height:"100%",width:"100%"},onScroll:_,children:P.length===0?e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",width:"100%",padding:"2rem"},children:e.jsx("button",{onClick:W,style:{backgroundColor:"transparent",color:"var(--text-secondary)",border:"2px dashed var(--border)",borderRadius:"var(--radius-md)",padding:"1rem 2rem",fontSize:"1rem",fontWeight:"500",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:h=>{h.target.style.borderColor="var(--purple)",h.target.style.color="var(--purple)"},onMouseLeave:h=>{h.target.style.borderColor="var(--border)",h.target.style.color="var(--text-secondary)"},children:"Create Encounter"})}):P.map((h,D)=>e.jsx(mt,{className:"invisible-scrollbar",style:{width:`${C+r}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:`${r}px`,paddingRight:"0",paddingTop:`${r}px`,paddingBottom:`${r}px`,scrollSnapAlign:"start",overflowY:"auto",overflowX:"hidden"},children:e.jsx(Ie,{type:h.type,item:{...h.instances[0],name:h.baseName,hp:0,stress:0,isDead:!1},mode:"expanded",instances:h.instances,onApplyDamage:h.type==="adversary"?(q,G,J,K)=>{const X=h.instances.find(Q=>Q.id===q);X&&u(q,{hp:Math.min(X.hpMax||1,(X.hp||0)+G)})}:void 0,onApplyHealing:h.type==="adversary"?(q,G,J)=>{const K=h.instances.find(X=>X.id===q);K&&u(q,{hp:Math.max(0,(K.hp||0)-G)})}:void 0,onApplyStressChange:h.type==="adversary"?(q,G)=>{var J,K;return u(q,{stress:Math.max(0,Math.min(((J=h.instances.find(X=>X.id===q))==null?void 0:J.stressMax)||6,(((K=h.instances.find(X=>X.id===q))==null?void 0:K.stress)||0)+G))})}:void 0,onUpdate:h.type==="adversary"?u:h.type==="environment"?E:S,adversaries:t})},`${h.type}-${h.baseName}`))})}),e.jsx(ot,{position:"bottom",children:e.jsx(et,{type:"fear",value:(v==null?void 0:v.value)||0,maxValue:12,onChange:x,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0})}),e.jsx(vt,{isOpen:A,onClose:V,onAddAdversary:h=>{d(h),L("adversary")},onAddAdversariesBulk:h=>{g(h),L("adversary")},onAddEnvironment:h=>{B(h),L("environment")},adversaries:t,environments:s}),e.jsx(gt,{})]})},wt=()=>e.jsx(bt,{children:e.jsx(jt,{})});ce.createRoot(document.getElementById("root")).render(e.jsx(te.StrictMode,{children:e.jsx(Qe,{children:e.jsx(wt,{})})}));
