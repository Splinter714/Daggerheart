import{r as f,a as ct,R as Ve}from"./dndkit-57209f9c.js";import{F as Lt,f as Nt,a as Bt,b as Dt,c as gt}from"./fa-b4bcccb0.js";import{D as It,A as Pt,C as Ht,X as Je,M as pt,P as Xe,a as Ot,H as Ft,L as $t,b as _t,F as qt,S as Qe,c as Ue}from"./lucide-9f8be461.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))d(w);new MutationObserver(w=>{for(const p of w)if(p.type==="childList")for(const v of p.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&d(v)}).observe(document,{childList:!0,subtree:!0});function c(w){const p={};return w.integrity&&(p.integrity=w.integrity),w.referrerPolicy&&(p.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?p.credentials="include":w.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function d(w){if(w.ep)return;w.ep=!0;const p=c(w);fetch(w.href,p)}})();var At={exports:{}},st={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vt=f,Gt=Symbol.for("react.element"),Yt=Symbol.for("react.fragment"),Jt=Object.prototype.hasOwnProperty,Xt=Vt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Kt={key:!0,ref:!0,__self:!0,__source:!0};function Et(t,o,c){var d,w={},p=null,v=null;c!==void 0&&(p=""+c),o.key!==void 0&&(p=""+o.key),o.ref!==void 0&&(v=o.ref);for(d in o)Jt.call(o,d)&&!Kt.hasOwnProperty(d)&&(w[d]=o[d]);if(t&&t.defaultProps)for(d in o=t.defaultProps,o)w[d]===void 0&&(w[d]=o[d]);return{$$typeof:Gt,type:t,key:p,ref:v,props:w,_owner:Xt.current}}st.Fragment=Yt;st.jsx=Et;st.jsxs=Et;At.exports=st;var e=At.exports,ut={},yt=ct;ut.createRoot=yt.createRoot,ut.hydrateRoot=yt.hydrateRoot;function _e(t){const o=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return t?`${t}-${o}`:o}const Mt=f.createContext();function ot(t){if(typeof localStorage>"u")return null;try{const o=localStorage.getItem(t);return o==null?null:JSON.parse(o)}catch{return null}}function qe(t,o){if(!(typeof localStorage>"u"))try{localStorage.setItem(t,JSON.stringify(o))}catch{}}const Zt=({children:t})=>{const[o,c]=f.useState({fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],currentEncounterName:"Encounter"}),[d,w]=f.useState(!1),[p,v]=f.useState({adversaries:[],environments:[]});f.useEffect(()=>{var a,h,R,L;const l=ot("daggerheart-game-state");if(l)try{(((a=l.adversaries)==null?void 0:a.length)>0||((h=l.environments)==null?void 0:h.length)>0||((R=l.countdowns)==null?void 0:R.length)>0||((L=l.savedEncounters)==null?void 0:L.length)>0)&&c(l)}catch(ie){console.error("Failed to load saved state:",ie)}const n=ot("daggerheart-custom-adversaries")||[],r=ot("daggerheart-custom-environments")||[];v({adversaries:n,environments:r}),w(!0)},[]),f.useEffect(()=>{qe("daggerheart-game-state",o)},[o]);const W=l=>{c(n=>({...n,fear:{...n.fear,value:l}}))},g=()=>{c(l=>({...l,fear:{...l.fear,visible:!l.fear.visible}}))},M=l=>{c(n=>({...n,partySize:Math.max(1,l)}))},H=l=>{c(n=>({...n,currentEncounterName:l||"Encounter"}))},B=l=>{if(l.id)return c(n=>({...n,savedEncounters:(n.savedEncounters||[]).map(r=>r.id===l.id?{...r,name:l.name||r.name,encounterItems:l.encounterItems||r.encounterItems,partySize:l.partySize||r.partySize,battlePointsAdjustments:l.battlePointsAdjustments||r.battlePointsAdjustments,updatedAt:new Date().toISOString()}:r)})),l.id;{const n={id:_e("encounter"),name:l.name||"Encounter",createdAt:new Date().toISOString(),encounterItems:l.encounterItems||[],partySize:l.partySize||4,battlePointsAdjustments:l.battlePointsAdjustments||{}};return c(r=>({...r,savedEncounters:[...r.savedEncounters||[],n]})),n.id}},T=l=>(o.savedEncounters||[]).find(r=>r.id===l),b=l=>{const n={id:_e("encounter"),name:l.name||`Encounter ${Date.now()}`,createdAt:new Date().toISOString(),encounterItems:l.encounterItems||[],partySize:l.partySize||4,battlePointsAdjustments:l.battlePointsAdjustments||{}};return c(r=>({...r,savedEncounters:[...r.savedEncounters||[],n]})),n.id},V=l=>{c(n=>({...n,savedEncounters:(n.savedEncounters||[]).filter(r=>r.id!==l)}))},me=f.useRef(o);f.useEffect(()=>{me.current=o},[o]);const Ce={gameState:o,isLoaded:d,customContent:p,updateFear:W,toggleFearVisibility:g,updatePartySize:M,updateCurrentEncounterName:H,saveEncounter:B,saveEncounterAs:b,loadEncounter:T,deleteEncounter:V,createCountdown:l=>{const n={id:_e("countdown"),name:l.name||"Countdown",max:parseInt(l.max)||1,value:0,visible:!0,type:l.type||"standard",loop:l.loop||"none",source:l.source||"campaign"};c(r=>({...r,countdowns:[...r.countdowns,n]}))},updateCountdown:(l,n)=>{c(r=>({...r,countdowns:r.countdowns.map(a=>a.id===l?{...a,...n}:a)}))},deleteCountdown:l=>{c(n=>({...n,countdowns:n.countdowns.filter(r=>r.id!==l)}))},advanceCountdown:(l,n)=>{c(r=>({...r,countdowns:r.countdowns.map(a=>{if(a.id!==l)return a;let h=n;if(a.loop==="loop")h>a.max?h=(h-1)%a.max+1:h<0&&(h=a.max);else if(a.loop==="increasing"){if(h>a.max)return{...a,max:a.max+1,value:1};if(h<0)return{...a,max:Math.max(1,a.max-1),value:1};h=Math.max(0,h)}else if(a.loop==="decreasing"){if(h>a.max)return{...a,max:Math.max(1,a.max-1),value:1};if(h<0)return{...a,max:a.max+1,value:1};h=Math.min(a.max,h)}else h=Math.max(0,Math.min(h,a.max));return{...a,value:h}})}))},incrementCountdown:(l,n=1)=>{c(r=>({...r,countdowns:r.countdowns.map(a=>{if(a.id!==l)return a;let h=a.value+n;if(a.loop==="loop")h>a.max&&(h=(h-1)%a.max+1);else if(a.loop==="increasing"){if(h>a.max)return{...a,max:a.max+1,value:1}}else if(a.loop==="decreasing"){if(h>a.max)return{...a,max:Math.max(1,a.max-1),value:1}}else h=Math.min(h,a.max);return{...a,value:h}})}))},decrementCountdown:l=>{c(n=>({...n,countdowns:n.countdowns.map(r=>{if(r.id!==l)return r;let a=r.value-1;if(r.loop==="loop")a<0&&(a=r.max);else if(r.loop==="increasing"){if(a<0)return{...r,max:Math.max(1,r.max-1),value:r.max};a=Math.max(0,a)}else if(r.loop==="decreasing"){if(a<0)return{...r,max:r.max+1,value:1}}else a=Math.max(0,a);return{...r,value:a}})}))},reorderCountdowns:l=>{c(n=>{const[r,a]=l,h=[...n.countdowns],[R]=h.splice(r,1);return h.splice(a,0,R),{...n,countdowns:h}})},createAdversary:l=>{var ie;const n=_e("adv"),r=o.adversaries||[],a=l.baseName||((ie=l.name)==null?void 0:ie.replace(/\s+\(\d+\)$/,""))||l.name||"Unknown",h=r.filter(be=>be.baseName===a);let R=1;if(h.length===0)R=1;else{const be=h.map(s=>s.duplicateNumber||1);let ze=1;for(;be.includes(ze);)ze++;R=ze}const L={...l,id:n,baseName:a,duplicateNumber:R,name:`${a} (${R})`,hp:0,stress:0,isVisible:!0};c(be=>({...be,adversaries:[...be.adversaries,L]}))},createAdversariesBulk:l=>{const n=[],r={};l.forEach(a=>{var k;const h=a.baseName||((k=a.name)==null?void 0:k.replace(/\s+\(\d+\)$/,""))||a.name||"Unknown",ie=(o.adversaries||[]).filter(i=>i.baseName===h).length,be=r[h]||0,ze=ie+be+1;r[h]=be+1;const s={...a,id:_e("adv"),baseName:h,duplicateNumber:ze,name:`${h} (${ze})`,hp:0,stress:0,isVisible:!0};n.push(s)}),c(a=>({...a,adversaries:[...a.adversaries,...n]}))},updateAdversary:(l,n)=>{c(r=>({...r,adversaries:r.adversaries.map(a=>{if(a.id===l){const h={...a,...n};if(n.baseName!==void 0){const R=n.baseName,L=h.duplicateNumber||1;h.name=L===1?R:`${R} (${L})`}return h}return a})}))},deleteAdversary:l=>{c(n=>({...n,adversaries:n.adversaries.filter(r=>r.id!==l)}))},clearAllAdversaries:()=>{c(l=>({...l,adversaries:[]}))},reorderAdversaries:l=>{c(n=>{const[r,a]=l,h=[...n.adversaries],[R]=h.splice(r,1);return h.splice(a,0,R),{...n,adversaries:h}})},bulkReorderAdversaries:l=>{c(n=>({...n,adversaries:l}))},createEnvironment:l=>{const n=_e("env"),a=(o.environments||[]).filter(L=>L.name.replace(/\s+\(\d+\)$/,"")===l.name);let h=l.name||"Unknown";if(a.length===0)h=l.name;else if(a.length===1){const L=a[0],ie=L.name.replace(/\s+\(\d+\)$/,""),be=o.environments.map(ze=>ze.id===L.id?{...ze,name:`${ie} (1)`}:ze);c(ze=>({...ze,environments:be})),h=`${l.name} (2)`}else{const L=a.map(be=>{const ze=be.name.match(/\((\d+)\)$/);return ze?parseInt(ze[1]):null}).filter(be=>be!==null);let ie=1;for(;L.includes(ie);)ie++;h=`${l.name} (${ie})`}const R={...l,id:n,name:h,isVisible:!0};c(L=>({...L,environments:[...L.environments,R]}))},updateEnvironment:(l,n)=>{c(r=>({...r,environments:r.environments.map(a=>a.id===l?{...a,...n}:a)}))},deleteEnvironment:l=>{c(n=>({...n,environments:n.environments.filter(r=>r.id!==l)}))},reorderEnvironments:l=>{c(n=>{const[r,a]=l,h=[...n.environments],[R]=h.splice(r,1);return h.splice(a,0,R),{...n,environments:h}})},addCustomAdversary:l=>{const n={...l,id:_e("custom-adv"),source:l.source||"Homebrew",isCustom:!0};return v(r=>({...r,adversaries:[...r.adversaries,n]})),qe("daggerheart-custom-adversaries",[...p.adversaries,n]),n.id},addCustomEnvironment:l=>{const n={...l,id:_e("custom-env"),source:l.source||"Homebrew",isCustom:!0};return v(r=>({...r,environments:[...r.environments,n]})),qe("daggerheart-custom-environments",[...p.environments,n]),n.id},updateCustomAdversary:(l,n)=>{v(a=>({...a,adversaries:a.adversaries.map(h=>h.id===l?{...h,...n}:h)}));const r=p.adversaries.map(a=>a.id===l?{...a,...n}:a);qe("daggerheart-custom-adversaries",r)},updateCustomEnvironment:(l,n)=>{v(a=>({...a,environments:a.environments.map(h=>h.id===l?{...h,...n}:h)}));const r=p.environments.map(a=>a.id===l?{...a,...n}:a);qe("daggerheart-custom-environments",r)},deleteCustomAdversary:l=>{v(r=>({...r,adversaries:r.adversaries.filter(a=>a.id!==l)}));const n=p.adversaries.filter(r=>r.id!==l);qe("daggerheart-custom-adversaries",n)},deleteCustomEnvironment:l=>{v(r=>({...r,environments:r.environments.filter(a=>a.id!==l)}));const n=p.environments.filter(r=>r.id!==l);qe("daggerheart-custom-environments",n)}};return e.jsx(Mt.Provider,{value:Ce,children:t})},ht=()=>{const t=f.useContext(Mt);if(!t)return console.warn("useGameState: Context not available yet, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{gameState:o,customContent:c,...d}=t;if(!o)return console.warn("useGameState: gameState not available, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],customContent:{adversaries:[],environments:[]},updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},addCustomAdversary:()=>{},addCustomEnvironment:()=>{},updateCustomAdversary:()=>{},updateCustomEnvironment:()=>{},deleteCustomAdversary:()=>{},deleteCustomEnvironment:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{fear:w,countdowns:p,adversaries:v,environments:W,partySize:g,savedEncounters:M}=o;return{gameState:o,fear:w,countdowns:p,adversaries:v,environments:W,partySize:g,savedEncounters:M,customContent:c,...d,hasCountdowns:p.length>0,hasAdversaries:v.length>0,hasEnvironments:W.length>0,getCountdownById:H=>p.find(B=>B.id===H),getAdversaryById:H=>v.find(B=>B.id===H),getEnvironmentById:H=>W.find(B=>B.id===H)}},vt={fear:{icon:Nt,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"0.125rem",maxWidth:"none"},pipStyle:{fontSize:"var(--text-lg)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0,imageRendering:"crisp-edges"},filledColor:"var(--purple)",emptyColor:"var(--gray-dark)",tooltipTitle:"Click anywhere in header to adjust fear:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease fear by 1"},{text:"Right of boundary:",description:"Click to increase fear by 1"}]},hp:{icon:Bt,maxValue:20,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stress:{icon:Dt,maxValue:12,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},countdown:{icon:gt,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust countdown:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease countdown by 1"},{text:"Right of boundary:",description:"Click to increase countdown by 1"}]},hpDots:{maxValue:20,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--red)",borderColor:"var(--red)",boxShadow:"0 0 4px rgba(239, 68, 68, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stressDots:{maxValue:12,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--purple)",borderColor:"var(--purple)",boxShadow:"0 0 4px rgba(139, 92, 246, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},adversaryHP:{icon:It,maxValue:20,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust HP:",tooltipInstructions:[{text:"Filled pip:",description:"Click to heal (reduce damage)"},{text:"Empty pip:",description:"Click to take damage"}]},adversaryStress:{icon:Pt,maxValue:12,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust stress:",tooltipInstructions:[{text:"Filled pip:",description:"Click to reduce stress"},{text:"Empty pip:",description:"Click to increase stress"}]},countdownDistributed:{icon:gt,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Countdown progress:",tooltipInstructions:[{text:"Progress:",description:"Current countdown value"}]}},Ye=({type:t="fear",value:o=0,maxValue:c,onChange:d,size:w="lg",showTooltip:p=!0,containerStyle:v={},pipStyle:W={},countdownType:g=null,distributedGroups:M=null,onPipClick:H=null,enableBoundaryClick:B=!1,clickContainerWidth:T="auto",centerPips:b=!0})=>{const[V,me]=f.useState(!1),D=vt[t]||vt.fear,$=c||D.maxValue,O=Math.max(0,Math.min($,o));let we=D.filledColor;t==="countdown"&&g&&(["progress","dynamic-progress","simple-hope"].includes(g)?we="var(--gold)":["consequence","dynamic-consequence","simple-fear"].includes(g)?we="var(--purple)":["long-term","standard"].includes(g)&&(we="var(--text-secondary)"));const _=(se,xe)=>{if(H)H(se,xe);else if(d){const ge=se+1;d(ge)}},Ie=se=>{if(!B||!d||H)return;se.currentTarget.getBoundingClientRect();const xe=se.currentTarget.querySelector(".pip-container");if(!xe)return;const ge=xe.getBoundingClientRect(),m=se.clientX-ge.left;if(m<0){O>0&&d(O-1);return}if(m>ge.width){O<$&&d(O+1);return}const Z=ge.width,S=Z*.05,de=Z-2*S,ee=m-S,fe=O/$,Q=de*fe;ee<Q?O>0&&d(O-1):O<$&&d(O+1)},Be=(()=>{if(!M||t!=="countdownDistributed")return[{start:0,end:$,groupIndex:0}];let se=0;return M.map((xe,ge)=>{const m={start:se,end:se+xe,groupIndex:ge};return se+=xe,m})})(),te=()=>e.jsxs(e.Fragment,{children:[Be.map(se=>e.jsx(Ve.Fragment,{children:[...Array(se.end-se.start)].map((xe,ge)=>{const m=se.start+ge,Z=m<O;if(D.isDots)return e.jsx("div",{style:{...D.pipStyle,...Z?D.filledStyle:D.emptyStyle,...W,cursor:d||H?"pointer":"default"},onClick:B?void 0:()=>_(m,Z),title:`${m+1} of ${$}`},m);{const S=D.icon,de=S&&typeof S=="object"&&S.iconName,ee=Z?we:D.emptyColor;return e.jsx("span",{className:`fear-pip ${Z?"filled":"empty"}`,style:{...D.pipStyle,color:ee,cursor:d||H?"pointer":"default",...W},onClick:B?void 0:()=>_(m,Z),title:`${m+1} of ${$}`,children:de?e.jsx(Lt,{icon:S,size:w}):e.jsx(S,{size:w==="lg"?18:16})},m)}})},se.groupIndex)),p&&e.jsx("div",{style:{position:"relative",cursor:"help",pointerEvents:"none"},children:e.jsxs("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:V?"translateX(-50%) translateY(-5px)":"translateX(-50%)",background:"rgba(15, 23, 42, 0.95)",border:"1px solid var(--gray)",borderRadius:"var(--radius-md)",padding:"var(--space-md)",minWidth:"250px",zIndex:1e3,opacity:V?1:0,visibility:V?"visible":"hidden",transition:"all 0.2s ease",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.5)"},children:[e.jsx("div",{style:{fontWeight:600,color:"var(--gray-200)",marginBottom:"0.75rem",fontSize:"var(--text-sm)"},children:D.tooltipTitle}),D.tooltipInstructions.map((se,xe)=>e.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.8rem",color:"var(--gray-300)",lineHeight:1.4},children:[e.jsx("strong",{style:{color:"var(--gray-200)"},children:se.text})," ",se.description]},xe))]})})]});return e.jsx("div",{style:{width:T,height:"100%",cursor:d||H?"pointer":"default",touchAction:"manipulation",userSelect:"none",display:b?"flex":"block",alignItems:b?"center":"stretch",justifyContent:b?"center":"flex-start",...v},onClick:se=>{se.stopPropagation(),se.preventDefault(),B&&Ie(se)},onMouseEnter:()=>me(p),onMouseLeave:()=>me(!1),children:e.jsx("div",{className:"pip-container",style:{...D.containerStyle,width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},children:te()})})},Qt=({position:t="top",children:o,onClick:c,className:d="",style:w={}})=>{const p=t==="top",v=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://"),W={background:"var(--bg-primary)",borderTop:p?"none":"1px solid var(--border)",borderBottom:p?"1px solid var(--border)":"none",padding:p?"0.25rem 0":"0.5rem",paddingBottom:p?"0.25rem":v?"calc(0.5rem + env(safe-area-inset-bottom) + 1rem)":"calc(0.5rem + env(safe-area-inset-bottom))",position:p?"relative":"sticky",[p?"top":"bottom"]:0,zIndex:p?10:100,order:p?1:3,flexShrink:0,touchAction:"manipulation",userSelect:"none",display:"flex",flexDirection:p?"column":"row",justifyContent:p?"stretch":"center",alignItems:p?"stretch":"center",gap:p?"0":"1rem",height:p?"auto":"60px",...w};return e.jsx("div",{className:d,style:W,onClick:c,children:o})},at=52,zt=({tabContent:t,children:o,containerStyle:c={},tabStyle:d={},showTab:w=!0,tabBackgroundColor:p="var(--bg-primary)",tabBorderColor:v="var(--border)",tabJustifyContent:W="center",containerBackgroundColor:g,containerBorderColor:M,containerBorderRadius:H="8px",containerBoxShadow:B,containerOverflow:T="hidden",reserveTabSpace:b=!1,style:V={},...me})=>{const D={display:"flex",flexDirection:"column",position:"relative",height:"100%",width:"100%",borderRadius:H,overflow:T};g&&(D.backgroundColor=g),M&&(D.border=`2px solid ${M}`),B&&(D.boxShadow=B);const $={position:"relative",overflow:"visible",height:"100%",width:"100%",display:"flex",flexDirection:"column",boxSizing:"border-box"},O=b?"0":`-${at}px`,we=b&&w&&t?`${at}px`:"0";return e.jsxs("div",{style:{...$,...V},...me,children:[w&&t&&e.jsx("div",{style:{position:"absolute",top:O,left:"7px",right:"7px",width:"calc(100% - 14px)",display:"flex",alignItems:"center",gap:"0.5rem",justifyContent:W,flexShrink:0,zIndex:0,padding:"0.5rem 0.75rem",paddingBottom:"calc(0.5rem + 4px)",minHeight:`${at}px`,backgroundColor:p,border:`1.5px solid ${v}`,borderBottom:"none",borderRadius:"8px 8px 0 0",boxSizing:"border-box",marginBottom:"-4px",...d},children:t}),e.jsx("div",{style:{...D,...c,zIndex:1,marginTop:we},children:o})]})},bt=({value:t})=>e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"44px",height:"32px",zIndex:3},children:[e.jsx("svg",{width:"40",height:"32",viewBox:"0 0 40 32",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",style:{position:"absolute",zIndex:1},children:e.jsx("path",{d:"M2 2h28l6 14-6 14H2l6-14-6-14z"})}),e.jsx("span",{style:{position:"absolute",fontSize:"0.8rem",fontWeight:500,color:"var(--text-primary)",textAlign:"center",zIndex:2,left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:t})]}),Ut=({type:t,tier:o,isEditMode:c,onUpdate:d,itemId:w})=>{const v=(B=>{if(!B)return 0;const b=document.createElement("canvas").getContext("2d");return b.font="600 11px system-ui, -apple-system, sans-serif",b.measureText(B.toUpperCase()).width})(t),W=4,g=18,M=Math.max(50,v+W+g),H=M+15;return c?e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",gap:"8px",height:"32px"},children:[e.jsxs("select",{value:t||"",onChange:B=>{d&&d(w,{type:B.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",outline:"none",borderRadius:"4px",padding:"4px 8px",width:"95px",height:"24px"},children:[e.jsx("option",{value:"Standard",children:"Standard"}),e.jsx("option",{value:"Solo",children:"Solo"}),e.jsx("option",{value:"Bruiser",children:"Bruiser"}),e.jsx("option",{value:"Horde",children:"Horde"}),e.jsx("option",{value:"Minion",children:"Minion"}),e.jsx("option",{value:"Ranged",children:"Ranged"}),e.jsx("option",{value:"Leader",children:"Leader"}),e.jsx("option",{value:"Skulk",children:"Skulk"}),e.jsx("option",{value:"Social",children:"Social"}),e.jsx("option",{value:"Support",children:"Support"})]}),e.jsxs("div",{style:{position:"relative",width:"24px",height:"24px"},children:[e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",width:"20px",height:"20px",backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",borderRadius:"2px"}}),e.jsx("input",{type:"text",value:o||"",onChange:B=>{const T=B.target.value.replace(/[^1-4]/g,"");T.length<=1&&d&&d(w,{tier:T===""?"":parseInt(T)})},onKeyDown:B=>{if(B.key==="ArrowUp"){B.preventDefault();const T=parseInt(o)||1;d&&d(w,{tier:Math.min(T+1,4)})}else if(B.key==="ArrowDown"){B.preventDefault();const T=parseInt(o)||1;d&&d(w,{tier:Math.max(T-1,1)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"transparent",border:"none",color:"var(--text-primary)",fontSize:"0.8rem",fontWeight:600,width:"24px",height:"24px",textAlign:"center",outline:"none",zIndex:1},maxLength:"1"})]})]}):e.jsxs("div",{style:{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"center",height:"32px",width:`${H}px`},children:[e.jsxs("svg",{width:H,height:"32",viewBox:`0 0 ${H} 32`,style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1},children:[e.jsx("rect",{x:"1",y:"6",width:M-1,height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4",ry:"4"}),e.jsx("rect",{x:M-10,y:"6",width:"20",height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"2",ry:"2",transform:`rotate(45 ${M-1} 16)`})]}),e.jsx("span",{style:{position:"absolute",top:"50%",left:"4px",transform:"translateY(-50%)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",color:"var(--text-primary)",zIndex:2,pointerEvents:"none"},children:t}),e.jsx("span",{style:{position:"absolute",top:"50%",left:`${M-.5}px`,transform:"translate(-50%, -50%)",fontSize:"0.8rem",fontWeight:600,color:"white",zIndex:2,pointerEvents:"none",textAlign:"center",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",width:"20px",height:"20px"},children:o})]})},it=({feature:t,featureType:o,item:c,onUpdate:d,handleFeatureDeleteClick:w,deleteConfirmations:p,getFeatureKey:v})=>{var B,T;const W=()=>{try{const V=[...(c==null?void 0:c.features)||[]],me=V.filter($=>$.type===o),D=me.findIndex($=>$===t);if(D>0&&D<me.length){const $=me[D],O=me[D-1];if($&&O){const we=V.findIndex(Ie=>Ie===$),_=V.findIndex(Ie=>Ie===O);we>=0&&_>=0&&(V[we]=O,V[_]=$,d&&d(c.id,{features:V}))}}}catch(b){console.error(`Error in ${o.toLowerCase()} up button:`,b)}},g=()=>{try{const V=[...(c==null?void 0:c.features)||[]],me=V.filter($=>$.type===o),D=me.findIndex($=>$===t);if(D<me.length-1&&D>=0){const $=me[D],O=me[D+1];if($&&O){const we=V.findIndex(Ie=>Ie===$),_=V.findIndex(Ie=>Ie===O);we>=0&&_>=0&&(V[we]=O,V[_]=$,d&&d(c.id,{features:V}))}}}catch(b){console.error(`Error in ${o.toLowerCase()} down button:`,b)}},M=b=>b.type===o,H=b=>b.type===o&&b.name.trim();return e.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",alignSelf:"stretch"},children:[e.jsx("button",{onClick:W,disabled:(c.features||[]).filter(M).findIndex(b=>b===t)===0,tabIndex:"-1",style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(c.features||[]).filter(H).length>=2&&(c.features||[]).filter(M).findIndex(b=>b===t)!==0&&t.name.trim()?"white":"var(--text-secondary)",cursor:(c.features||[]).filter(H).length>=2&&(c.features||[]).filter(M).findIndex(b=>b===t)!==0&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↑"}),e.jsx("button",{onClick:()=>w(t),disabled:!t.name.trim()&&!t.description.trim(),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:p[v(t)]?"var(--danger)":"var(--gray-700)",color:!t.name.trim()&&!t.description.trim()?"var(--text-secondary)":"white",cursor:!t.name.trim()&&!t.description.trim()?"not-allowed":"pointer",opacity:!t.name.trim()&&!t.description.trim()?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"×"}),e.jsx("button",{onClick:g,disabled:(c.features||[]).filter(M).findIndex(b=>b===t)===(c.features||[]).filter(M).length-1,style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(c.features||[]).filter(H).length>=2&&(c.features||[]).filter(M).findIndex(b=>b===t)<(c.features||[]).filter(M).length-1&&((B=(c.features||[]).filter(M)[(c.features||[]).filter(M).findIndex(b=>b===t)+1])!=null&&B.name.trim())&&t.name.trim()?"white":"var(--text-secondary)",cursor:(c.features||[]).filter(H).length>=2&&(c.features||[]).filter(M).findIndex(b=>b===t)<(c.features||[]).filter(M).length-1&&((T=(c.features||[]).filter(M)[(c.features||[]).filter(M).findIndex(b=>b===t)+1])!=null&&T.name.trim())&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↓"})]})},Pe={transitions:{hoverIn:"all 0.1s ease",hoverOut:"all 0.3s ease"},card:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"8px",cursor:"pointer",transition:"all 0.1s ease",position:"relative",border:"none"},cardHover:{backgroundColor:"var(--bg-card-hover)"},cardDead:{opacity:.6,backgroundColor:"var(--gray-800)",borderColor:"var(--border)"},cardAtMax:{backgroundColor:"var(--success)",borderColor:"var(--success)"},rowMain:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},rowTitle:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",margin:0},rowMeta:{display:"flex",gap:"8px",alignItems:"center"},badge:{padding:"2px 6px",borderRadius:"3px",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},typeBadge:{backgroundColor:"var(--purple)",color:"var(--text-primary)"},tierBadge:{backgroundColor:"var(--info)",color:"var(--text-primary)"},damageInputPopup:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,borderRadius:"8px"},damageInputContent:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"8px",padding:"8px",display:"flex",flexDirection:"row",gap:"8px",minWidth:"200px",alignItems:"center",position:"absolute",right:"1rem",top:"50%",transform:"translateY(-50%)"},damageInput:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"4px",padding:"4px 6px",color:"var(--text-primary)",fontSize:"16px",width:"80px",textAlign:"center"},damageIndicators:{display:"flex",gap:"8px",alignItems:"center",justifyContent:"center"},damageDrop:{fontSize:"16px",color:"var(--text-secondary)",cursor:"pointer",transition:"color 0.1s ease"},applyButton:{backgroundColor:"var(--gray-600)",color:"white",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"32px",minHeight:"32px"}},er=(t,o,c,d)=>{const[w,p]=f.useState(!1),[v,W]=f.useState("");f.useEffect(()=>{if(w){const b=V=>{V.target.closest(".damage-input-popup")||(p(!1),W(""))};return document.addEventListener("click",b),()=>document.removeEventListener("click",b)}},[w]);const g=b=>{b.stopPropagation(),b.preventDefault();const V=t.hp||0,me=t.hpMax||1,D=b.currentTarget.getBoundingClientRect(),$=b.clientX-D.left,O=D.width/me;Math.floor($/O)<V?c&&c(t.id,1,t.hp):o&&o(t.id,1,t.hp,t.hpMax)},M=b=>{b.stopPropagation(),b.preventDefault();const V=t.stress||0,me=t.stressMax||1,D=b.currentTarget.getBoundingClientRect(),$=b.clientX-D.left,O=D.width/me;Math.floor($/O)<V?d&&d(t.id,-1,t.stress,t.stressMax):d&&d(t.id,1,t.stress,t.stressMax)},H=b=>{b.stopPropagation(),(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")&&(p(!0),W(t.type==="Minion"?"1":""))},B=()=>{const b=parseInt(v);if(b>0){if(t.type==="Minion")o&&o(t.id,b,t.hp,t.hpMax);else{let V=0;b>=t.thresholds.severe?V=3:b>=t.thresholds.major?V=2:b>=1&&(V=1),o&&o(t.id,V,t.hp,t.hpMax)}p(!1),W("")}};return{showDamageInput:w,damageValue:v,setDamageValue:W,setShowDamageInput:p,handleHpClick:g,handleStressClick:M,handleDifficultyClick:H,applyDamage:B,handleKeyDown:b=>{b.key==="Enter"?B():b.key==="Escape"&&(p(!1),W(""))}}},nt=({item:t,type:o,mode:c="expanded",onClick:d,onDelete:w,onApplyDamage:p,onApplyHealing:v,onApplyStressChange:W,onUpdate:g,adversaries:M=[],isSelected:H=!1,isEditMode:B=!1,instances:T=[],isEmbedded:b=!1,showAddRemoveButtons:V=!1,onAddInstance:me=null,onRemoveInstance:D=null,onEdit:$=null,showCustomCreator:O=!1,onSaveCustomAdversary:we=null,onCancelEdit:_=null,isStockAdversary:Ie=!1})=>{const Re=f.useRef(null),Be=f.useRef(T.length),te=f.useRef(null),se=f.useRef(null),xe=f.useRef(null);f.useEffect(()=>{const n=Re.current;if(!n)return;const r=()=>{te.current=n.scrollHeight,se.current=n.scrollTop};n.addEventListener("scroll",r,{passive:!0});const a=setInterval(r,100);return()=>{n.removeEventListener("scroll",r),clearInterval(a)}},[]),f.useEffect(()=>()=>{Re.current&&(te.current=Re.current.scrollHeight,se.current=Re.current.scrollTop)},[T.length,T]);const[ge,m]=f.useState({});f.useLayoutEffect(()=>{const n=T.length,r=Be.current;if(n!==r&&Re.current){const a=te.current,h=se.current;if(!a||h===null){Be.current=n;return}const R=Re.current,L=R.scrollHeight,ie=R.clientHeight;if(!(n<r)){if(n>r){const be=L-ie,ze=R.scrollTop,s=be-ze;if(Math.abs(s)>.5){xe.current&&(cancelAnimationFrame(xe.current),xe.current=null);const k=400,i=performance.now(),j=G=>{if(!R){xe.current=null;return}const A=G-i,J=Math.min(A/k,1),Se=1-J,Me=1-Se*Se*Se,ve=ze+s*Me;R.scrollTop=ve,J<1?xe.current=requestAnimationFrame(j):(R.scrollTop=be,xe.current=null)};xe.current=requestAnimationFrame(j)}}}Be.current=n}else Be.current=n},[T.length,T]);const Z=n=>{const a=(t.features||[]).filter(h=>h.type===n.type).findIndex(h=>h===n);return`${n.type}-${a}-${n.name||"blank"}`},S=(n,r)=>`experience-${r}-${typeof n=="string"?n:n.name||"blank"}`,de=n=>{const r=Z(n);if(ge[r]){const a=t.features.filter(h=>h!==n);g&&g(t.id,{features:a}),m(h=>{const R={...h};return delete R[r],R})}else m(a=>({...a,[r]:!0})),setTimeout(()=>{m(a=>{const h={...a};return delete h[r],h})},3e3)},ee=(n,r)=>{const a=S(n,r);if(ge[a]){const h=[...t.experience||[]];h.splice(r,1),g&&g(t.id,{experience:h}),m(R=>{const L={...R};return delete L[a],L})}else m(h=>({...h,[a]:!0})),setTimeout(()=>{m(h=>{const R={...h};return delete R[a],R})},3e3)},fe=er(t,p,v,W);(o==="adversary"||o==="adversaries")&&fe.handleDifficultyClick;const Q=(n=!1)=>{let r={...Pe.card};if(H?r.transition="none":r.transition=Pe.transitions.hoverOut,n){const{marginTop:a,...h}=r;r=h}return H&&(r={...r,...Pe.cardHover}),o==="adversary"&&(t.hp||0)>=(t.hpMax||1)&&(r={...r,...Pe.cardDead}),r},oe=()=>{if(b)return"";let n="border rounded-lg";return H&&(n+=" border-hover"),n},ye=()=>{var n;if(o==="adversary"||o==="adversaries"){const r=t.baseName||((n=t.name)==null?void 0:n.replace(/\s+\(\d+\)$/,""))||"",a=t.duplicateNumber||1,h=[...M];return M.some(ie=>ie.id===t.id)||h.push(t),h.filter(ie=>ie.baseName===r).length>1?`${r} (${a})`:r}return t.name},Ae=()=>{const n=[];return t.type&&n.push(e.jsx("span",{style:{...Pe.badge,...Pe.typeBadge},children:t.type},"type")),n},Te=()=>o!=="adversary"||!fe.showDamageInput||!(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")?null:e.jsx("div",{className:"damage-input-popup",style:Pe.damageInputPopup,onClick:n=>{n.stopPropagation(),n.target===n.currentTarget&&(o==="adversary"||o==="adversaries")&&(fe.setShowDamageInput(!1),fe.setDamageValue(""))},children:e.jsxs("div",{className:"border rounded-lg",style:{...Pe.damageInputContent,borderColor:"var(--border)"},onClick:n=>n.stopPropagation(),children:[e.jsx("input",{type:"number",inputMode:"numeric",enterKeyHint:"done",placeholder:"dmg",min:(t.type==="Minion","0"),value:o==="adversary"||o==="adversaries"?fe.damageValue:"",onChange:n=>{(o==="adversary"||o==="adversaries")&&fe.setDamageValue(n.target.value)},onKeyDown:o==="adversary"||o==="adversaries"?fe.handleKeyDown:void 0,className:"border rounded-sm",style:{...Pe.damageInput,borderColor:"var(--border)"},autoFocus:!0}),e.jsxs("div",{style:Pe.damageIndicators,children:[t.type==="Minion"?(()=>{var R,L;const n=parseInt(o==="adversary"||o==="adversaries"?fe.damageValue:"0")||0,r=(R=t.features)==null?void 0:R.find(ie=>{var be;return(be=ie.name)==null?void 0:be.startsWith("Minion (")}),a=r?parseInt(((L=r.name.match(/\((\d+)\)/))==null?void 0:L[1])||"1"):1,h=Math.floor(n/a);return n>=a&&h>0?e.jsxs("span",{style:{...Pe.damageDrop,color:"var(--red)"},title:`${n} damage can defeat ${h+1} minion${h+1!==1?"s":""} (1 + ${h} additional)`,children:["+",h," additional minion(s)"]}):e.jsx("span",{style:Pe.damageDrop,title:`${n} damage defeats this minion only`,children:"+0 additional minion(s)"})})():[1,2,3].map(n=>{const r=parseInt(o==="adversary"||o==="adversaries"?fe.damageValue:"0")||0;let a=!1;return n===1&&r>=1&&(a=!0),n===2&&r>=t.thresholds.major&&(a=!0),n===3&&r>=t.thresholds.severe&&(a=!0),e.jsx("span",{style:{...Pe.damageDrop,color:a?"var(--red)":"var(--text-secondary)"},onClick:h=>{h.stopPropagation(),(o==="adversary"||o==="adversaries")&&(n===1?fe.setDamageValue("1"):n===2?fe.setDamageValue(t.thresholds.major.toString()):n===3&&fe.setDamageValue(t.thresholds.severe.toString()))},title:`Click to set damage to ${n===1?"1":n===2?t.thresholds.major:t.thresholds.severe}`,children:e.jsx(It,{size:16})},n)}),e.jsx("button",{style:{...Pe.applyButton,backgroundColor:"var(--gray-600)"},onClick:n=>{n.stopPropagation(),(o==="adversary"||o==="adversaries")&&(!fe.damageValue||parseInt(fe.damageValue)<1?(fe.setShowDamageInput(!1),fe.setDamageValue("")):fe.applyDamage())},title:!fe.damageValue||parseInt(fe.damageValue)<1?"Close damage input":"Apply damage",children:!fe.damageValue||parseInt(fe.damageValue)<1?e.jsx(Je,{size:16}):e.jsx(_t,{size:16})})]})]})}),Le=()=>{var R,L,ie,be,ze;const n=(t.hp||0)>=(t.hpMax||1),r=Ce==="edit"||O,a=V&&o==="adversary"||O&&o==="adversary",h=a?O?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:s=>{s.stopPropagation(),we&&(we(t,t.id),_&&_())},style:{background:"var(--purple)",border:"1px solid var(--purple)",color:"white",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:s=>{s.target.style.opacity="0.9"},onMouseLeave:s=>{s.target.style.opacity="1"},title:"Save",children:[e.jsx(Ht,{size:16}),e.jsx("span",{children:"Save"})]}),_&&e.jsxs("button",{onClick:s=>{s.stopPropagation(),_()},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:s=>{s.target.style.backgroundColor="var(--bg-hover)",s.target.style.borderColor="var(--purple)"},onMouseLeave:s=>{s.target.style.backgroundColor="var(--bg-secondary)",s.target.style.borderColor="var(--border)"},title:"Cancel",children:[e.jsx(Je,{size:16}),e.jsx("span",{children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:s=>{s.stopPropagation(),D&&D(t.id)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease"},onMouseEnter:s=>{s.target.style.backgroundColor="var(--bg-hover)",s.target.style.borderColor="var(--purple)"},onMouseLeave:s=>{s.target.style.backgroundColor="var(--bg-secondary)",s.target.style.borderColor="var(--border)"},title:"Remove one",children:e.jsx(pt,{size:16})}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"1rem",fontWeight:"500",minWidth:"24px",textAlign:"center"},children:T.length}),e.jsx("button",{onClick:s=>{s.stopPropagation(),me&&me(t)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease"},onMouseEnter:s=>{s.target.style.backgroundColor="var(--purple)",s.target.style.borderColor="var(--purple)",s.target.style.color="white"},onMouseLeave:s=>{s.target.style.backgroundColor="var(--bg-secondary)",s.target.style.borderColor="var(--border)",s.target.style.color="var(--text-primary)"},title:"Add another",children:e.jsx(Xe,{size:16})}),$&&e.jsx("button",{onClick:s=>{s.stopPropagation(),$(t.id)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease",marginLeft:"0.25rem"},onMouseEnter:s=>{s.target.style.backgroundColor="var(--purple)",s.target.style.borderColor="var(--purple)",s.target.style.color="white"},onMouseLeave:s=>{s.target.style.backgroundColor="var(--bg-secondary)",s.target.style.borderColor="var(--border)",s.target.style.color="var(--text-primary)"},title:"Edit",children:e.jsx(Ot,{size:16})})]}):null;return e.jsx(zt,{tabContent:h,showTab:a,tabBorderColor:H?"var(--purple)":"var(--border)",containerBackgroundColor:n?"var(--gray-900)":Q(!0).backgroundColor,containerBorderColor:n?"color-mix(in srgb, var(--gray-600) 40%, transparent)":H?"var(--purple)":"var(--border)",containerBorderRadius:"8px",containerOverflow:"hidden",containerStyle:{padding:0,opacity:n?.7:1,height:"auto",maxHeight:a?"calc(100vh - 120px)":"calc(100vh - 68px)",minHeight:0},children:e.jsxs("div",{className:oe(),style:{...Q(!0),padding:0,display:"flex",flexDirection:"column",position:"relative",height:"100%",minHeight:0,border:"none",borderRadius:0},onClick:d,children:[n&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                  45deg,
                  transparent,
                  transparent 8px,
                  var(--gray-600) 1px,
                  var(--gray-600) 9px
                )`,pointerEvents:"none",zIndex:9999}})}),e.jsx("div",{className:"border-b",style:{padding:"8px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative",zIndex:n?1:"auto",borderBottomColor:H?"var(--purple)":"var(--border)"},children:e.jsx("div",{style:{display:"flex",flexDirection:"column",position:"relative",zIndex:n?1:"auto",padding:"2px",gap:0},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",minHeight:"40px"},children:[r?e.jsx("input",{type:"text",value:t.name||"",onChange:s=>{g&&g(t.id,{name:s.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"4px",color:"var(--text-primary)",fontSize:"1.1rem",fontWeight:"600",padding:"0.5rem",width:"100%",maxWidth:"300px",paddingRight:"0.625rem"},placeholder:"Name"}):e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flex:1},children:e.jsx("h4",{style:{...Pe.rowTitle,color:n?"color-mix(in srgb, var(--gray-400) 80%, transparent)":Pe.rowTitle.color,textAlign:"left",margin:0,fontSize:"1.1rem",paddingRight:"6px",flex:1},children:((R=t.name)==null?void 0:R.replace(/\s+\(\d+\)$/,""))||t.name})}),(t.type||t.tier||r)&&e.jsx(Ut,{type:t.type,tier:t.tier,isEditMode:r,onUpdate:g,itemId:t.id})]})})}),e.jsxs("div",{ref:Re,style:{borderRadius:"0 0 8px 8px",flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0},className:"invisible-scrollbar",children:[(t.motives||r)&&e.jsx("div",{style:{padding:"0.5rem 8px",textAlign:"center"},children:r?e.jsx("input",{type:"text",value:t.motives||"",onChange:s=>g&&g(t.id,{motives:s.target.value}),placeholder:"Motives...",style:{width:"100%",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}):e.jsxs("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,textAlign:"center"},children:[t.motives,t.motives&&!t.motives.endsWith(".")?".":""]})}),(t.difficulty||t.atk!==void 0||t.thresholds&&t.type!=="Minion"||t.experience&&t.experience.length>0||r)&&e.jsxs("div",{style:{padding:"0.5rem 8px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[(t.difficulty||r)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[e.jsx(Ft,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(0deg)"}}),r?e.jsx("input",{type:"text",value:t.difficulty||"",onChange:s=>{const k=s.target.value.replace(/[^0-9]/g,"");k.length<=2&&g&&g(t.id,{difficulty:parseInt(k)||0})},onKeyDown:s=>{if(s.key==="ArrowUp"){s.preventDefault();const k=parseInt(t.difficulty)||0;g&&g(t.id,{difficulty:Math.min(k+1,99)})}else if(s.key==="ArrowDown"){s.preventDefault();const k=parseInt(t.difficulty)||0;g&&g(t.id,{difficulty:Math.max(k-1,0)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"2"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:t.difficulty})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Difficulty"})]}),(t.atk!==void 0||r)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[e.jsx($t,{size:38,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(45deg)"}}),r?e.jsx("input",{type:"text",value:(()=>{const s=typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0;return s>=0?`+${s}`:s.toString()})(),onChange:s=>{const k=s.target.value.replace(/[^0-9+\-]/g,"");if(k.length<=4){const i=parseInt(k.replace(/[^0-9\-]/g,""))||0;g&&g(t.id,{atk:i})}},onKeyDown:s=>{if(s.key==="ArrowUp"){s.preventDefault();const i=(typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0)+1;g&&g(t.id,{atk:i})}else if(s.key==="ArrowDown"){s.preventDefault();const i=(typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0)-1;g&&g(t.id,{atk:i})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"3"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:(()=>{const s=typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk;return s>=0?`+${s}`:s})()})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Attack"})]})]}),e.jsx("div",{style:{paddingTop:"0"},children:r?e.jsx("div",{style:{display:"flex",flexDirection:"column",marginTop:"-0.25rem"},children:(()=>{const s=t.experience||[],k=s.length===0?[{name:"",modifier:1}]:s;return k.map((i,j)=>{var G,A,J,Se,Me,ve,y,z,F,re,X,je,pe,ue,ne,C,ce,ke,x,u,q,N,le,K,I;return e.jsxs("div",{style:{position:"relative",marginBottom:"0.5rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("input",{type:"text",value:typeof i=="object"&&i.modifier>=1?`+${i.modifier}`:"+1",onChange:P=>{const U=[...t.experience||[]],E=parseInt(P.target.value.replace(/[^0-9+-]/g,""))||1,Y=Math.max(1,E);U[j]={name:typeof i=="string"?i:i.name||"",modifier:Y},g&&g(t.id,{experience:U})},onKeyDown:P=>{if(P.key==="ArrowUp"){P.preventDefault();const U=[...t.experience||[]],E=typeof i=="object"?Math.max(1,i.modifier):1;U[j]={name:typeof i=="string"?i:i.name||"",modifier:E+1},g&&g(t.id,{experience:U})}else if(P.key==="ArrowDown"){P.preventDefault();const U=[...t.experience||[]],E=typeof i=="object"?Math.max(1,i.modifier):1;U[j]={name:typeof i=="string"?i:i.name||"",modifier:Math.max(1,E-1)},g&&g(t.id,{experience:U})}},style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)",textAlign:"center",outline:"none"}})}),e.jsxs("div",{style:{marginLeft:"32px",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:typeof i=="string"?i:i.name||"",onChange:P=>{const U=[...t.experience||[]],E=typeof i=="object"?i.modifier:1;U[j]={name:P.target.value,modifier:E};const Y=U[U.length-1];Y&&Y.name.trim()&&U.push({name:"",modifier:1}),g&&g(t.id,{experience:U})},placeholder:"Experience name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsxs("div",{style:{display:"flex",gap:"0.125rem"},children:[e.jsx("button",{onClick:()=>{var Ee,he;const P=[...t.experience||[]],U=typeof i=="string"?i.trim():(Ee=i.name)==null?void 0:Ee.trim(),E=P[j-1],Y=typeof E=="string"?E.trim():(he=E.name)==null?void 0:he.trim();j>0&&j<P.length&&U&&Y&&(P[j]=E,P[j-1]=i,g&&g(t.id,{experience:P}))},disabled:j===0||!(typeof i=="string"?i.trim():(G=i.name)!=null&&G.trim())||!(typeof k[j-1]=="string"?k[j-1].trim():(A=k[j-1].name)!=null&&A.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:j===0||!(typeof i=="string"?i.trim():(J=i.name)!=null&&J.trim())||!(typeof k[j-1]=="string"?k[j-1].trim():(Se=k[j-1].name)!=null&&Se.trim())?"var(--gray-800)":"var(--gray-700)",color:j===0||!(typeof i=="string"?i.trim():(Me=i.name)!=null&&Me.trim())||!(typeof k[j-1]=="string"?k[j-1].trim():(ve=k[j-1].name)!=null&&ve.trim())?"var(--text-secondary)":"white",cursor:j===0||!(typeof i=="string"?i.trim():(y=i.name)!=null&&y.trim())||!(typeof k[j-1]=="string"?k[j-1].trim():(z=k[j-1].name)!=null&&z.trim())?"not-allowed":"pointer",opacity:j===0||!(typeof i=="string"?i.trim():(F=i.name)!=null&&F.trim())||!(typeof k[j-1]=="string"?k[j-1].trim():(re=k[j-1].name)!=null&&re.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move up",children:"↑"}),e.jsx("button",{onClick:()=>{var Ee,he;const P=[...t.experience||[]],U=typeof i=="string"?i.trim():(Ee=i.name)==null?void 0:Ee.trim(),E=P[j+1],Y=typeof E=="string"?E.trim():(he=E.name)==null?void 0:he.trim();j<P.length-1&&j>=0&&U&&Y&&(P[j]=E,P[j+1]=i,g&&g(t.id,{experience:P}))},disabled:j===k.length-1||!(typeof i=="string"?i.trim():(X=i.name)!=null&&X.trim())||!(typeof k[j+1]=="string"?k[j+1].trim():(je=k[j+1].name)!=null&&je.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:j===k.length-1||!(typeof i=="string"?i.trim():(pe=i.name)!=null&&pe.trim())||!(typeof k[j+1]=="string"?k[j+1].trim():(ue=k[j+1].name)!=null&&ue.trim())?"var(--gray-800)":"var(--gray-700)",color:j===k.length-1||!(typeof i=="string"?i.trim():(ne=i.name)!=null&&ne.trim())||!(typeof k[j+1]=="string"?k[j+1].trim():(C=k[j+1].name)!=null&&C.trim())?"var(--text-secondary)":"white",cursor:j===k.length-1||!(typeof i=="string"?i.trim():(ce=i.name)!=null&&ce.trim())||!(typeof k[j+1]=="string"?k[j+1].trim():(ke=k[j+1].name)!=null&&ke.trim())?"not-allowed":"pointer",opacity:j===k.length-1||!(typeof i=="string"?i.trim():(x=i.name)!=null&&x.trim())||!(typeof k[j+1]=="string"?k[j+1].trim():(u=k[j+1].name)!=null&&u.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move down",children:"↓"}),e.jsx("button",{onClick:()=>ee(i,j),disabled:!(typeof i=="string"?i.trim():(q=i.name)!=null&&q.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:ge[S(i,j)]?"var(--danger)":(typeof i=="string"?i.trim():(N=i.name)!=null&&N.trim())?"var(--gray-700)":"var(--gray-800)",color:(typeof i=="string"?i.trim():(le=i.name)!=null&&le.trim())?"white":"var(--text-secondary)",cursor:(typeof i=="string"?i.trim():(K=i.name)!=null&&K.trim())?"pointer":"not-allowed",opacity:(typeof i=="string"?i.trim():(I=i.name)!=null&&I.trim())?1:.5,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:ge[S(i,j)]?"Click again to confirm delete":"Delete experience",children:"×"})]})]})]},j)})})()}):e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:t.experience&&t.experience.length>0?t.experience.map((s,k)=>{if(typeof s=="string"){const i=s.match(/^(.+?)\s*([+-]?\d+)$/);if(i){const[,j,G]=i;return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:G})})}),e.jsx("span",{style:{marginLeft:"32px"},children:j})]},k)}else return e.jsx("div",{style:{marginBottom:"0.25rem"},children:s},k)}else return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:e.jsxs("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:[s.modifier>=0?"+":"",s.modifier]})})}),e.jsx("span",{style:{marginLeft:"32px"},children:s.name})]},k)}):null})})]}),(t.features&&t.features.length>0||r)&&e.jsxs("div",{style:{padding:"0 8px 8px 8px"},children:[(t.atk!==void 0&&t.weapon||r)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Standard Attack"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:r?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",marginTop:"0.75rem",marginBottom:"0.75rem"},children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[e.jsx("input",{type:"text",value:t.weapon||"",onChange:s=>g&&g(t.id,{weapon:s.target.value}),placeholder:"Standard attack name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}}),e.jsxs("select",{value:t.range||"",onChange:s=>g&&g(t.id,{range:s.target.value}),style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",appearance:"none",backgroundImage:`url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",backgroundSize:"1rem",paddingRight:"2rem"},children:[e.jsx("option",{value:""}),e.jsx("option",{value:"Melee",children:"Melee"}),e.jsx("option",{value:"Very Close",children:"Very Close"}),e.jsx("option",{value:"Close",children:"Close"}),e.jsx("option",{value:"Far",children:"Far"}),e.jsx("option",{value:"Very Far",children:"Very Far"})]}),e.jsx("input",{type:"text",value:t.damage||"",onChange:s=>g&&g(t.id,{damage:s.target.value}),placeholder:"Damage (e.g., 1d6+2)",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}})]})}):t.atk!==void 0&&t.weapon&&e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:t.weapon}),e.jsxs("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:["Make an attack against a target within ",t.range||"Melee"," range. On a success, deal ",t.damage||"damage varies","."]})]})})]}),(t.features.filter(s=>s.type==="Action").length>0||r)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Actions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const s=t.features.filter(i=>i.type==="Action");return(r&&s.length===0?[{type:"Action",name:"",description:""}]:s).map((i,j)=>r?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:i.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false","data-lpignore":"true","data-form-type":"other",name:`feature-name-${i.type.toLowerCase()}`,onChange:G=>{const A=[...t.features||[]],J=A.findIndex(ve=>ve.type==="Action"&&ve===i);J>=0?A[J]={...A[J],name:G.target.value}:A.push({type:"Action",name:G.target.value,description:i.description||""});const Se=A.filter(ve=>ve.type==="Action"),Me=Se[Se.length-1];Me&&Me.name.trim()&&A.push({type:"Action",name:"",description:""}),g&&g(t.id,{features:A})},placeholder:"Action name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:i.description||"",onChange:G=>{const A=[...t.features||[]],J=A.findIndex(ve=>ve.type==="Action"&&ve===i);J>=0?A[J]={...A[J],description:G.target.value}:A.push({type:"Action",name:i.name||"",description:G.target.value});const Se=A.filter(ve=>ve.type==="Action"),Me=Se[Se.length-1];Me&&Me.name.trim()&&A.push({type:"Action",name:"",description:""}),g&&g(t.id,{features:A})},onInput:G=>{const A=G.target.offsetHeight;G.target.style.height="auto";const J=G.target.scrollHeight,Se=J>A?J:A;G.target.style.height=Se+"px"},placeholder:"Action description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(it,{feature:i,featureType:"Action",item:t,onUpdate:g,handleFeatureDeleteClick:de,deleteConfirmations:ge,getFeatureKey:Z})]},j):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:i.name}),i.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:i.description})]},j))})()})]}),(t.features.filter(s=>s.type==="Passive").length>0||r)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Passives"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const s=t.features.filter(i=>i.type==="Passive");return(r&&s.length===0?[{type:"Passive",name:"",description:""}]:s).map((i,j)=>r?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:i.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:G=>{const A=[...t.features||[]],J=A.findIndex(ve=>ve.type==="Passive"&&ve===i);J>=0?A[J]={...A[J],name:G.target.value}:A.push({type:"Passive",name:G.target.value,description:i.description||""});const Se=A.filter(ve=>ve.type==="Passive"),Me=Se[Se.length-1];Me&&Me.name.trim()&&A.push({type:"Passive",name:"",description:""}),g&&g(t.id,{features:A})},placeholder:"Passive name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:i.description||"",onChange:G=>{const A=[...t.features||[]],J=A.findIndex(ve=>ve.type==="Passive"&&ve===i);J>=0?A[J]={...A[J],description:G.target.value}:A.push({type:"Passive",name:i.name||"",description:G.target.value});const Se=A.filter(ve=>ve.type==="Passive"),Me=Se[Se.length-1];Me&&Me.name.trim()&&A.push({type:"Passive",name:"",description:""}),g&&g(t.id,{features:A})},onInput:G=>{const A=G.target.offsetHeight;G.target.style.height="auto";const J=G.target.scrollHeight,Se=J>A?J:A;G.target.style.height=Se+"px"},placeholder:"Passive description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(it,{feature:i,featureType:"Passive",item:t,onUpdate:g,handleFeatureDeleteClick:de,deleteConfirmations:ge,getFeatureKey:Z})]},j):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:i.name}),i.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:i.description})]},j))})()})]}),(t.features.filter(s=>s.type==="Reaction").length>0||r)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Reactions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const s=t.features.filter(i=>i.type==="Reaction");return(r&&s.length===0?[{type:"Reaction",name:"",description:""}]:s).map((i,j)=>r?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:i.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:G=>{const A=[...t.features||[]],J=A.findIndex(ve=>ve.type==="Reaction"&&ve===i);J>=0?A[J]={...A[J],name:G.target.value}:A.push({type:"Reaction",name:G.target.value,description:i.description||""});const Se=A.filter(ve=>ve.type==="Reaction"),Me=Se[Se.length-1];Me&&Me.name.trim()&&A.push({type:"Reaction",name:"",description:""}),g&&g(t.id,{features:A})},placeholder:"Reaction name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:i.description||"",onChange:G=>{const A=[...t.features||[]],J=A.findIndex(ve=>ve.type==="Reaction"&&ve===i);J>=0?A[J]={...A[J],description:G.target.value}:A.push({type:"Reaction",name:i.name||"",description:G.target.value});const Se=A.filter(ve=>ve.type==="Reaction"),Me=Se[Se.length-1];Me&&Me.name.trim()&&A.push({type:"Reaction",name:"",description:""}),g&&g(t.id,{features:A})},onInput:G=>{const A=G.target.offsetHeight;G.target.style.height="auto";const J=G.target.scrollHeight,Se=J>A?J:A;G.target.style.height=Se+"px"},placeholder:"Reaction description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(it,{feature:i,featureType:"Reaction",item:t,onUpdate:g,handleFeatureDeleteClick:de,deleteConfirmations:ge,getFeatureKey:Z})]},j):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:i.name}),i.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:i.description})]},j))})()})]})]}),(T&&T.length>0||t.type!=="Minion"&&(t.thresholds||r))&&e.jsxs("div",{style:{padding:"0 8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Status"})]}),r?e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border)"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"number",value:t.hpMax||"",onChange:s=>{const k=parseInt(s.target.value)||1;g&&g(t.id,{hpMax:k})},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),e.jsx(Ye,{type:"adversaryHP",value:0,maxValue:t.hpMax||1,showTooltip:!1}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:"HP"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"number",value:t.stressMax||"",onChange:s=>{const k=parseInt(s.target.value)||1;g&&g(t.id,{stressMax:k})},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),e.jsx(Ye,{type:"adversaryStress",value:0,maxValue:t.stressMax||1,showTooltip:!1}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:"Stress"})]})]})})}):T&&T.length>0&&T.map((s,k)=>{const i=(s.hp||0)>=(s.hpMax||1);return e.jsx("div",{"data-instance-id":s.id,style:{marginBottom:"0.5rem"},children:e.jsxs("div",{style:{backgroundColor:i?"var(--gray-900)":"var(--bg-primary)",borderRadius:"6px",padding:"0.25rem 0.5rem",border:"1px solid",borderColor:i?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",display:"flex",justifyContent:"flex-start",alignItems:"center",gap:"0.5rem",opacity:i?.7:1,position:"relative",transition:"all 0.2s ease",minHeight:"40px"},children:[i&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                          45deg,
                          transparent 0px,
                          transparent 8px,
                          var(--gray-600) 9px,
                          var(--gray-600) 9px
                        )`,pointerEvents:"none",zIndex:1,borderRadius:"4px"}})}),e.jsx("div",{style:{backgroundColor:i?"var(--gray-900)":"var(--bg-card)",border:"1px solid",borderColor:i?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",borderRadius:"50%",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",flexShrink:0,opacity:i?.5:1},children:e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:i?"var(--gray-400)":"var(--text-primary)"},children:s.duplicateNumber||1})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.125rem"},children:[e.jsx("div",{style:{opacity:i?.3:1},children:e.jsx(Ye,{type:"adversaryHP",value:s.hp||0,maxValue:s.hpMax||1,onPipClick:(j,G)=>{if(p&&o==="adversary"){const A=s.hp||0,J=s.hpMax||1;G?v&&v(s.id,1,A):A<J&&p(s.id,1,A,J)}},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})}),s.stressMax>0&&e.jsx("div",{style:{opacity:i?.3:1},children:e.jsx(Ye,{type:"adversaryStress",value:s.stress||0,maxValue:s.stressMax,onPipClick:(j,G)=>{W&&o==="adversary"&&(G?W(s.id,-1):W(s.id,1))},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})})]})]},s.id)},s.id)}),t.type!=="Minion"&&(t.thresholds||r)&&e.jsx("div",{style:{display:"flex",justifyContent:"center",paddingTop:"1px",marginTop:"0.5rem",marginBottom:"0.5rem"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",position:"relative"},children:e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",height:"36px"},children:[e.jsx("svg",{width:"300",height:"36",viewBox:"0 0 300 36",style:{position:"absolute",zIndex:1},children:e.jsx("rect",{x:"20",y:"6",width:"260",height:"24",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4"})}),e.jsx("div",{style:{position:"relative",zIndex:2,display:"flex",alignItems:"center",gap:"0.5rem"},children:r?e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",fontSize:"0.8rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),e.jsx("input",{type:"number",min:"1",max:"99",value:((L=t.thresholds)==null?void 0:L.major)||"",onChange:s=>{const k=s.target.value;(k===""||parseInt(k)>=1&&parseInt(k)<=99)&&g&&g(t.id,{thresholds:{...t.thresholds,major:k===""?null:parseInt(k)}})},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),e.jsx("input",{type:"number",min:"1",max:"99",value:((ie=t.thresholds)==null?void 0:ie.severe)||"",onChange:s=>{const k=s.target.value;(k===""||parseInt(k)>=1&&parseInt(k)<=99)&&g&&g(t.id,{thresholds:{...t.thresholds,severe:k===""?null:parseInt(k)}})},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),e.jsx(bt,{value:((be=t.thresholds)==null?void 0:be.major)||7}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),e.jsx(bt,{value:((ze=t.thresholds)==null?void 0:ze.severe)||14}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]})})]})})})]}),(r||c==="expanded"&&t.description&&t.description.trim())&&e.jsxs("div",{style:{padding:"0 8px",textAlign:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Description"})]}),r?e.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-primary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"none",overflow:"hidden",fontFamily:"inherit",marginTop:"0.75rem",marginBottom:"0.75rem"},value:t.description,onChange:s=>{s.target.style.height="auto",s.target.style.height=s.target.scrollHeight+"px",g&&g(t.id,{description:s.target.value})},placeholder:"Description..."}):e.jsx("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,whiteSpace:"pre-wrap",padding:"0.5rem 0"},children:t.description})]})]}),Te()]})})},Ce=O?"edit":c;return(Ce==="expanded"||Ce==="edit")&&(o==="adversary"||o==="adversaries")?Le():o==="adversary"||o==="adversaries"?null:e.jsxs("div",{className:oe(),style:Q(!0),children:[e.jsxs("div",{style:Pe.rowMain,children:[e.jsx("h4",{style:Pe.rowTitle,children:ye()}),e.jsx("div",{style:Pe.rowMeta,children:Ae()})]}),e.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"12px",margin:0},children:["Expanded view coming soon for ",o]})]})},tr="modulepreload",rr=function(t){return"/Daggerheart/"+t},wt={},Ge=function(o,c,d){if(!c||c.length===0)return o();const w=document.getElementsByTagName("link");return Promise.all(c.map(p=>{if(p=rr(p),p in wt)return;wt[p]=!0;const v=p.endsWith(".css"),W=v?'[rel="stylesheet"]':"";if(!!d)for(let H=w.length-1;H>=0;H--){const B=w[H];if(B.href===p&&(!v||B.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${p}"]${W}`))return;const M=document.createElement("link");if(M.rel=v?"stylesheet":tr,v||(M.as="script",M.crossOrigin=""),M.href=p,document.head.appendChild(M),v)return new Promise((H,B)=>{M.addEventListener("load",H),M.addEventListener("error",()=>B(new Error(`Unable to preload CSS for ${p}`)))})})).then(()=>o()).catch(p=>{const v=new Event("vite:preloadError",{cancelable:!0});if(v.payload=p,window.dispatchEvent(v),!v.defaultPrevented)throw p})},nr="/Daggerheart/assets/daggerheart-logo-fe7815ad.svg",Ct={Minion:{difficulty:t=>[9,12,15,18][t-1],thresholds:t=>({major:0,severe:0}),hpMax:t=>1,stressMax:t=>1,atk:t=>[-1,0,1,2][t-1],damage:t=>["2","5","8","11"][t-1],range:"Melee"},Standard:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[7,10,20,25][t-1],severe:[12,20,32,45][t-1]}),hpMax:t=>[4,5,6,7][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[1,2,3,4][t-1],damage:t=>["1d8+1","2d8+2","3d8+3","4d8+4"][t-1],range:"Melee"},Bruiser:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[8,14,22,38][t-1],severe:[15,28,40,70][t-1]}),hpMax:t=>[6,7,8,9][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[-1,0,1,2][t-1],damage:t=>["1d12+2","2d12+4","3d12+6","4d12+8"][t-1],range:"Melee"},Horde:{difficulty:t=>[10,13,16,19][t-1],thresholds:t=>({major:[7,10,20,25][t-1],severe:[12,20,32,45][t-1]}),hpMax:t=>[5,6,7,8][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[-1,0,1,2][t-1],damage:t=>["1d8+2","2d8+4","3d8+6","4d8+8"][t-1],range:"Melee"},Leader:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[7,13,21,35][t-1],severe:[14,26,38,65][t-1]}),hpMax:t=>[5,6,7,8][t-1],stressMax:t=>[5,5,6,6][t-1],atk:t=>[2,4,6,8][t-1],damage:t=>["1d10+2","2d10+4","3d10+6","4d10+8"][t-1],range:"Melee"},Ranged:{difficulty:t=>[10,13,16,19][t-1],thresholds:t=>({major:[4,8,18,22][t-1],severe:[7,16,30,42][t-1]}),hpMax:t=>[3,4,5,6][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d8+2","2d8+4","3d8+6","4d8+8"][t-1],range:"Close"},Skulk:{difficulty:t=>[12,15,18,21][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,5,6,7][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d6+2","2d6+4","3d6+6","4d6+8"][t-1],range:"Melee"},Solo:{difficulty:t=>[12,15,18,21][t-1],thresholds:t=>({major:[7,13,21,35][t-1],severe:[14,26,38,65][t-1]}),hpMax:t=>[8,9,10,11][t-1],stressMax:t=>[5,5,6,6][t-1],atk:t=>[3,5,7,9][t-1],damage:t=>["1d10+3","2d10+6","3d10+9","4d10+12"][t-1],range:"Melee"},Support:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,4,5,5][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d4+2","2d4+4","3d4+6","4d4+8"][t-1],range:"Melee"},Social:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,4,5,5][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d4+2","2d4+4","3d4+6","4d4+8"][t-1],range:"Melee"}},et=(t,o)=>{const c=Ct[o]||Ct.Standard;return{difficulty:c.difficulty(t),thresholds:c.thresholds(t),hpMax:c.hpMax(t),stressMax:c.stressMax(t),atk:c.atk(t),damage:c.damage(t),range:c.range}};let Tt={adversaries:[]},St=!1;const sr=()=>({customAdversaries:JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]")}),or=async()=>{if(St)return;let t={adversaries:[]},o={adversaries:[]};try{const d=await Ge(()=>import("./adversaries-9c8932de.js"),[]);t=(d==null?void 0:d.default)||d}catch(d){console.warn("Failed to load adversaries.json:",d)}try{const d=await Ge(()=>import("./playtest-adversaries-4a099c10.js"),[]);o=(d==null?void 0:d.default)||d}catch(d){console.warn("Failed to load playtest-adversaries.json:",d)}const{customAdversaries:c}=sr();Tt={...t,adversaries:[...t.adversaries||[],...o.adversaries||[],...c]},St=!0},Rt=f.forwardRef(({onSave:t,onRefresh:o,onAddItem:c,editingAdversary:d,onCancelEdit:w,isStockAdversary:p=!1,autoFocus:v=!1,allAdversaries:W=[],embedded:g=!1,hideEmbeddedButtons:M=!1},H)=>{const B=f.useRef(null),[T,b]=f.useState(()=>{const m=et(1,"Standard");return{name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:m.difficulty,thresholds:m.thresholds,hpMax:m.hpMax,stressMax:m.stressMax,atk:m.atk,weapon:"",range:m.range,damage:m.damage,experience:[],features:[]}}),[V,me]=f.useState(!1),[D,$]=f.useState(!1),[O,we]=f.useState([]),[_,Ie]=f.useState(!1),[Re,Be]=f.useState([]);f.useEffect(()=>{(async()=>{await or(),W.length>0?Be(W):Be(Tt.adversaries||[])})()},[W]),f.useEffect(()=>{v&&B.current&&setTimeout(()=>{var m;(m=B.current)==null||m.focus()},100)},[v]),f.useEffect(()=>{if(d)b({name:d.name||"",tier:d.tier||1,type:d.type||"Standard",description:d.description||"",motives:d.motives||"",difficulty:d.difficulty||11,thresholds:d.thresholds||{major:7,severe:12},hpMax:d.hpMax||3,stressMax:d.stressMax||1,atk:d.atk||1,weapon:d.weapon||"",range:d.range||"Melee",damage:d.damage||"",experience:d.experience||[],features:d.features||[]}),$(!1);else{const m=et(1,"Standard");b({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:m.difficulty,thresholds:m.thresholds,hpMax:m.hpMax,stressMax:m.stressMax,atk:m.atk,weapon:"",range:m.range,damage:m.damage,experience:[],features:[]}),$(!1)}},[d]),f.useEffect(()=>{if(!d&&!D){const m=et(T.tier,T.type);b(Z=>({...Z,difficulty:m.difficulty,thresholds:m.thresholds,hpMax:m.hpMax,stressMax:m.stressMax,atk:m.atk,range:m.range,damage:m.damage}))}},[T.tier,T.type,d,D]);const te=m=>{if(b(Z=>({...Z,name:m})),m.trim().length>0){const Z=Re.filter(S=>{var ee;return(((ee=S.name)==null?void 0:ee.replace(/\s+\(\d+\)$/,""))||S.name||"").toLowerCase().includes(m.toLowerCase())}).slice(0,5);we(Z),Ie(Z.length>0)}else we([]),Ie(!1)},se=async()=>{if(!T.name.trim()){alert("Please enter a name for the adversary");return}me(!0);try{const m={...T,hp:d?d.hp:0,stress:d?d.stress:0,source:"Homebrew"};if(d)p?(await t(m),alert("Custom adversary created successfully!")):(m.id=d.id,await t(m,d.id),alert("Adversary updated successfully!")),w&&w();else{await t(m),o&&await o();const Z=et(1,"Standard");b({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:Z.difficulty,thresholds:Z.thresholds,hpMax:Z.hpMax,stressMax:Z.stressMax,atk:Z.atk,weapon:"",range:Z.range,damage:Z.damage,experience:[],features:[]}),$(!1),alert("Custom adversary created successfully!")}}catch(m){console.error("Error saving adversary:",m),alert("Error saving adversary. Please try again.")}finally{me(!1)}};f.useImperativeHandle(H,()=>({handleSave:se,isSaving:V,canSave:T.name.trim().length>0}));const xe={...T,id:"new-adversary",hp:0,stress:0,source:"Homebrew"},ge=()=>V?d?p?"Creating...":"Saving...":"Creating...":d?p?"Save As Custom":"Save":"Create";return e.jsxs(e.Fragment,{children:[!g&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h2",{style:{color:"var(--text-primary)",fontSize:"1.5rem",fontWeight:"600",margin:0},children:d?p?"Edit Adversary (Save As Custom)":"Edit Custom Adversary":"Create Custom Adversary"}),e.jsx("button",{onClick:se,disabled:V||!T.name.trim(),style:{padding:"0.75rem 1.5rem",backgroundColor:V||!T.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"8px",cursor:V||!T.name.trim()?"not-allowed":"pointer",fontSize:"1rem",fontWeight:"600",opacity:V||!T.name.trim()?.6:1},children:ge()})]}),g&&!M&&e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",marginBottom:"0.5rem",padding:"0.5rem",borderBottom:"1px solid var(--border)"},children:[e.jsx("button",{onClick:se,disabled:V||!T.name.trim(),style:{padding:"0.5rem 1rem",backgroundColor:V||!T.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"6px",cursor:V||!T.name.trim()?"not-allowed":"pointer",fontSize:"0.875rem",fontWeight:"600",opacity:V||!T.name.trim()?.6:1,marginRight:"0.5rem"},children:ge()}),w&&e.jsx("button",{onClick:w,style:{padding:"0.5rem 1rem",backgroundColor:"transparent",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"6px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600"},children:"Cancel"})]}),!d&&e.jsxs("div",{style:{marginBottom:"1rem",position:"relative"},children:[e.jsx("input",{ref:B,type:"text",value:T.name,onChange:m=>{const Z=m.target.value;b(S=>({...S,name:Z})),te(Z)},placeholder:"Adversary name",style:{width:"100%",padding:"0.75rem",border:"1px solid var(--border)",borderRadius:"8px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"1rem",outline:"none"}}),_&&O.length>0&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"0 0 8px 8px",borderTop:"none",maxHeight:"200px",overflowY:"auto",zIndex:1e3,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)"},children:O.map((m,Z)=>{var de;const S=m.baseName||((de=m.name)==null?void 0:de.replace(/\s+\(\d+\)$/,""))||m.name;return e.jsxs("div",{onClick:()=>{b(ee=>({...ee,name:S,tier:m.tier||ee.tier,type:m.type||ee.type,difficulty:m.difficulty||ee.difficulty,thresholds:m.thresholds||ee.thresholds,hpMax:m.hpMax||ee.hpMax,stressMax:m.stressMax||ee.stressMax,atk:m.atk||ee.atk,range:m.range||ee.range,damage:m.damage||ee.damage})),Ie(!1),$(!0),B.current&&B.current.blur()},style:{padding:"0.75rem",cursor:"pointer",borderBottom:Z<O.length-1?"1px solid var(--border)":"none",transition:"background-color 0.2s"},onMouseEnter:ee=>{ee.target.style.backgroundColor="var(--bg-secondary)"},onMouseLeave:ee=>{ee.target.style.backgroundColor="transparent"},onMouseDown:ee=>ee.preventDefault(),children:[e.jsx("div",{style:{fontWeight:"600"},children:S}),e.jsxs("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",marginTop:"2px"},children:[m.type," • Tier ",m.tier]})]},Z)})})]}),e.jsx(nt,{item:xe,type:"adversary",mode:"edit",onUpdate:(m,Z)=>{b(S=>({...S,...Z}))}})]})});Rt.displayName="CustomAdversaryCreator";const ar=(t,o)=>{const[c,d]=f.useState("max-content"),w=f.useCallback(()=>{if(!o.current||t<=3)return"max-content";const p=o.current.offsetWidth,W=Math.floor(p/120);return W<=1?"max-content":t===4?"max-content max-content":t===5||t===6?W>=2?"max-content max-content":"max-content":t===7?W>=3?"max-content max-content max-content":W>=2?"max-content max-content":"max-content":"repeat(auto-fit, minmax(80px, max-content))"},[t,o]);return f.useEffect(()=>{const p=w();d(p);const v=new ResizeObserver(()=>{const W=w();d(W)});return o.current&&v.observe(o.current),()=>{v.disconnect()}},[w]),c},ir=({encounter:t})=>{var w,p;const o=f.useRef(null),c=((w=t.encounterItems)==null?void 0:w.length)||0,d=ar(c,o);return e.jsx("div",{ref:o,className:"saved-encounter-adversary-list",style:{flex:1,fontSize:"0.8rem",color:"var(--text-secondary)",lineHeight:"1.3",display:"grid",gridTemplateColumns:d,gap:"0.25rem 1rem",gridAutoRows:"min-content"},children:((p=t.encounterItems)==null?void 0:p.length)>0?t.encounterItems.map((v,W)=>{var M;const g=v.item.baseName||((M=v.item.name)==null?void 0:M.replace(/\s+\(\d+\)$/,""))||v.item.name;return e.jsxs("div",{style:{marginBottom:"0.125rem"},children:[v.quantity,"x ",g]},W)}):e.jsx("div",{children:"No adversaries"})})},Ke={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},tt={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1,lowerTierAdversary:1};let rt={adversaries:[]},mt={environments:[]},ft=!1;const lr=()=>{const t=JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]"),o=JSON.parse(localStorage.getItem("daggerheart-custom-environments")||"[]");return{customAdversaries:t,customEnvironments:o}},jt=async()=>{if(ft)return;let t={adversaries:[]},o={environments:[]},c={adversaries:[]},d={environments:[]};try{const v=await Ge(()=>import("./adversaries-9c8932de.js"),[]);t=(v==null?void 0:v.default)||v}catch(v){console.warn("Failed to load adversaries.json:",v)}try{const v=await Ge(()=>import("./environments-c340637c.js"),[]);o=(v==null?void 0:v.default)||v}catch(v){console.warn("Failed to load environments.json:",v)}try{const v=await Ge(()=>import("./playtest-adversaries-4a099c10.js"),[]);c=(v==null?void 0:v.default)||v}catch(v){console.warn("Failed to load playtest-adversaries.json:",v)}try{const v=await Ge(()=>import("./playtest-environments-d9cdffb6.js"),[]);d=(v==null?void 0:v.default)||v}catch(v){console.warn("Failed to load playtest-environments.json:",v)}const{customAdversaries:w,customEnvironments:p}=lr();rt={...t,adversaries:[...t.adversaries||[],...c.adversaries||[],...w]},mt={...o,environments:[...o.environments||[],...d.environments||[],...p]},ft=!0},dr=(t,o=[],c=4,d=1,w=!1)=>{const[p,v]=f.useState(""),[W,g]=f.useState([{field:"tier",direction:"asc"},{field:"name",direction:"asc"}]),[M,H]=f.useState([]),[B,T]=f.useState(!0),[b,V]=f.useState([]),[me,D]=f.useState([]),[$,O]=f.useState(!1),[we,_]=f.useState(!1),Ie=f.useRef(null),Re=f.useRef(null);f.useEffect(()=>{(async()=>{await jt(),T(!1);let oe=[];t==="adversary"?oe=rt.adversaries||[]:t==="environment"&&(oe=mt.environments||[]),H(oe)})()},[t]);const Be=Q=>{const oe=M.map(ye=>ye[Q]).filter(Boolean);return[...new Set(oe)].sort((ye,Ae)=>typeof ye=="number"&&typeof Ae=="number"?ye-Ae:String(ye).localeCompare(String(Ae)))},te=f.useCallback(async()=>{ft=!1,await jt();let Q=[];t==="adversary"?w?Q=(rt.adversaries||[]).filter(oe=>{var ye;return oe.source==="Homebrew"||((ye=oe.id)==null?void 0:ye.startsWith("custom-"))}):Q=rt.adversaries||[]:t==="environment"&&(Q=mt.environments||[]),H(Q)},[t,w]);f.useEffect(()=>{te()},[w,te]);const se=Be("tier"),xe=Be("type"),ge=f.useMemo(()=>{let Q=M.filter(oe=>{var Le,Ce;const ye=oe.name.toLowerCase().includes(p.toLowerCase())||((Le=oe.type)==null?void 0:Le.toLowerCase().includes(p.toLowerCase()))||((Ce=oe.description)==null?void 0:Ce.toLowerCase().includes(p.toLowerCase())),Ae=b.length===0||(b.includes("party-tier")?oe.tier===d:b.includes(oe.tier.toString())),Te=me.length===0||me.includes(oe.type);return ye&&Ae&&Te});return Q.sort((oe,ye)=>{for(const Ae of W){const{field:Te,direction:Le}=Ae;let Ce=oe[Te],l=ye[Te];if(Te==="tier")Ce=parseInt(Ce)||0,l=parseInt(l)||0;else if(Te==="cost"){const n=r=>{if(t!=="adversary")return 0;const a=Ke[r.type]||2;let h=0;const R=o.filter(ie=>ie.type==="adversary"&&ie.item.type==="Solo"&&ie.quantity>0).reduce((ie,be)=>ie+be.quantity,0),L=o.filter(ie=>ie.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(ie.item.type)&&ie.quantity>0).reduce((ie,be)=>ie+be.quantity,0);return r.type==="Solo"&&R===1&&(h+=2),["Bruiser","Horde","Leader","Solo"].includes(r.type)&&L===0&&(h+=1),a+h};Ce=n(oe),l=n(ye)}else if(Te==="difficulty"){const n=parseInt(Ce),r=parseInt(l);!isNaN(n)&&!isNaN(r)?(Ce=n,l=r):!isNaN(n)&&isNaN(r)?(Ce=n,l=999):isNaN(n)&&!isNaN(r)?(Ce=999,l=r):(Ce=String(Ce||"").toLowerCase(),l=String(l||"").toLowerCase())}else typeof Ce=="string"&&typeof l=="string"?(Ce=Ce.toLowerCase(),l=l.toLowerCase()):(Ce=String(Ce||"").toLowerCase(),l=String(l||"").toLowerCase());if(Le==="asc"){if(Ce>l)return 1;if(Ce<l)return-1}else{if(Ce<l)return 1;if(Ce>l)return-1}}return 0}),Q},[M,p,W,b,me,o,c,d]),m=Q=>{g(oe=>{const ye=oe.findIndex(Ae=>Ae.field===Q);if(ye>=0)if(ye===0){const Ae=[...oe];return Ae[0]={...Ae[0],direction:Ae[0].direction==="asc"?"desc":"asc"},Ae}else{const Ae=[...oe];return Ae.splice(ye,1)[0],[{field:Q,direction:"asc"},...Ae]}else return[{field:Q,direction:"asc"},...oe]})},Z=Q=>{V(Q==="clear"?[]:Q==="party-tier"?["party-tier"]:oe=>oe.includes(Q)?oe.filter(ye=>ye!==Q):[...oe,Q])},S=Q=>{D(Q==="clear"?[]:oe=>oe.includes(Q)?oe.filter(ye=>ye!==Q):[...oe,Q])},de=b.length>0,ee=me.length>0;return f.useEffect(()=>{const Q=ye=>{const Ae=ye.target.closest(".filter-dropdown"),Te=ye.target.closest(".header-filter-icon");Ae||Te||(O(!1),_(!1))},oe=ye=>{ye.key==="Escape"&&(O(!1),_(!1))};return document.addEventListener("pointerdown",Q,!0),document.addEventListener("mousedown",Q,!0),document.addEventListener("touchstart",Q,!0),document.addEventListener("click",Q,!0),document.addEventListener("keydown",oe,!0),()=>{document.removeEventListener("pointerdown",Q,!0),document.removeEventListener("mousedown",Q,!0),document.removeEventListener("touchstart",Q,!0),document.removeEventListener("click",Q,!0),document.removeEventListener("keydown",oe,!0)}},[O,_]),{searchTerm:p,setSearchTerm:v,sortFields:W,handleSort:m,filteredAndSortedData:ge,loading:B,refreshData:te,selectedTiers:b,selectedTypes:me,showTierDropdown:$,setShowTierDropdown:O,showTypeDropdown:we,setShowTypeDropdown:_,tierFilterRef:Ie,typeFilterRef:Re,uniqueTiers:se,uniqueTypes:xe,handleTierSelect:Z,handleTypeSelect:S,isTierFiltered:de,isTypeFiltered:ee,getDropdownStyle:Q=>{if(!Q.current)return{};const oe=Q.current.getBoundingClientRect();return{position:"fixed",top:oe.bottom+4,left:oe.left-100,zIndex:99999}}}},cr=({searchTerm:t,onSearchChange:o,type:c,partyControls:d,showCustomToggle:w=!1,onToggleCustom:p,filterCustom:v=!1,onExportCustomAdversaries:W,onImportCustomAdversaries:g,autoFocus:M=!1,onClose:H=null,placeholder:B="Search"})=>{const T=f.useRef(null);return f.useEffect(()=>{M&&T.current&&setTimeout(()=>{var b;(b=T.current)==null||b.focus()},100)},[M]),e.jsxs("div",{style:ae.browserHeader,children:[e.jsx("div",{style:{display:"flex",alignItems:"center",flex:1,gap:"0.5rem"},children:e.jsx("input",{ref:T,type:"text",placeholder:B,value:t,onChange:b=>o(b.target.value),style:{...ae.searchInput,flex:1,marginRight:0}})}),d&&e.jsx("div",{style:ae.partyControls,children:d})]})},pr=({showCustomToggle:t=!1,onToggleCustom:o,filterCustom:c=!1,onExportCustomAdversaries:d,onImportCustomAdversaries:w})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)",flexShrink:0},children:[t&&e.jsxs("button",{onClick:()=>o&&o(!c),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:c?"var(--purple)":"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:c?"white":"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:p=>{c||(p.target.style.backgroundColor="var(--bg-hover)",p.target.style.borderColor="var(--purple)")},onMouseLeave:p=>{c||(p.target.style.backgroundColor="var(--bg-primary)",p.target.style.borderColor="var(--border)")},children:[e.jsx("span",{children:c?"✓":"○"}),"Custom Only"]}),e.jsxs("button",{onClick:d,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:p=>{p.target.style.backgroundColor="var(--bg-hover)",p.target.style.borderColor="var(--purple)"},onMouseLeave:p=>{p.target.style.backgroundColor="var(--bg-primary)",p.target.style.borderColor="var(--border)"},children:[e.jsx("span",{children:"↓"}),"Export"]}),e.jsxs("button",{onClick:()=>document.getElementById("import-file-input").click(),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:p=>{p.target.style.backgroundColor="var(--bg-hover)",p.target.style.borderColor="var(--purple)"},onMouseLeave:p=>{p.target.style.backgroundColor="var(--bg-primary)",p.target.style.borderColor="var(--border)"},children:[e.jsx("span",{children:"↑"}),"Import"]}),e.jsx("input",{id:"import-file-input",type:"file",accept:".csv,.json",onChange:w,style:{display:"none"}})]}),ur=({sortFields:t,onSort:o,type:c,uniqueTiers:d,uniqueTypes:w,selectedTiers:p,selectedTypes:v,showTierDropdown:W,setShowTierDropdown:g,showTypeDropdown:M,setShowTypeDropdown:H,tierFilterRef:B,typeFilterRef:T,handleTierSelect:b,handleTypeSelect:V,isTierFiltered:me,isTypeFiltered:D,getDropdownStyle:$,costFilter:O,showCostDropdown:we,setShowCostDropdown:_,costFilterRef:Ie,handleCostFilterSelect:Re,isCostFiltered:Be})=>{const[te,se]=f.useState(null),ge=(()=>c==="adversary"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"cost",label:"Cost",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:c==="environment"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:[])(),m=()=>{if(!we)return null;const S=[{value:"all",label:"All"},{value:"auto-grey",label:"Auto Grey"},{value:"auto-hide",label:"Auto Hide"}];return ct.createPortal(e.jsx("div",{className:"filter-dropdown",style:{...ae.filterDropdown,...$(Ie),maxHeight:"60vh",overflow:"auto"},onMouseDown:de=>de.stopPropagation(),onClick:de=>de.stopPropagation(),children:S.map(de=>{const ee=O===de.value;return e.jsxs("div",{style:{...ae.filterOption,...ee?ae.filterOptionSelected:{}},onClick:()=>Re(de.value),children:[e.jsx("span",{style:ae.checkIcon,children:ee?e.jsx(Qe,{size:16}):e.jsx(Ue,{size:16})}),e.jsx("span",{style:ae.filterLabel,children:de.label})]},de.value)})}),document.body)},Z=(S,de,ee,fe,Q,oe,ye,Ae)=>{if(!Q)return null;const Te=()=>{(S==="tier"||S==="type")&&fe("clear")};return ct.createPortal(e.jsxs("div",{className:"filter-dropdown",style:{...ae.filterDropdown,...$(ye),maxHeight:"60vh",overflow:"auto"},onMouseDown:Le=>Le.stopPropagation(),onClick:Le=>Le.stopPropagation(),children:[e.jsxs("div",{style:{...ae.filterOption,...ee.length===0?ae.filterOptionSelected:{}},onClick:Te,children:[e.jsx("span",{style:ae.checkIcon,children:ee.length===0?e.jsx(Qe,{size:16}):e.jsx(Ue,{size:16})}),e.jsx("span",{style:ae.filterLabel,children:"All"})]}),S==="tier"&&e.jsxs("div",{style:{...ae.filterOption,...ee.includes("party-tier")?ae.filterOptionSelected:{}},onClick:()=>fe("party-tier"),children:[e.jsx("span",{style:ae.checkIcon,children:ee.includes("party-tier")?e.jsx(Qe,{size:16}):e.jsx(Ue,{size:16})}),e.jsx("span",{style:ae.filterLabel,children:"Party Tier"})]}),de.map(Le=>{const Ce=ee.includes(Le.toString());return e.jsxs("div",{style:{...ae.filterOption,...Ce?ae.filterOptionSelected:{}},onClick:()=>fe(Le.toString()),children:[e.jsx("span",{style:ae.checkIcon,children:Ce?e.jsx(Qe,{size:16}):e.jsx(Ue,{size:16})}),e.jsx("span",{style:ae.filterLabel,children:Le})]},Le)})]}),document.body)};return e.jsx("tr",{style:ae.tableHeader,children:ge.map(S=>e.jsxs("th",{style:{...ae.tableHeaderCell,...te===S.key?ae.tableHeaderCellHover:{},position:"relative",...S.key==="name"?{width:"auto",minWidth:"0"}:{},...S.key==="tier"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...S.key==="type"?{width:"80px",minWidth:"80px",maxWidth:"80px"}:{},...S.key==="difficulty"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...S.key==="cost"?{width:"50px",minWidth:"50px",maxWidth:"50px"}:{},...S.key==="action"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{}},onClick:()=>o(S.key),onMouseEnter:()=>se(S.key),onMouseLeave:()=>se(null),children:[S.hasFilter?e.jsxs("div",{style:ae.headerWithFilter,children:[e.jsx("span",{style:{cursor:"pointer"},onClick:de=>{de.stopPropagation(),o(S.key)},children:S.label}),e.jsxs("button",{ref:S.key==="tier"?B:S.key==="type"?T:Ie,style:{...ae.headerFilterIcon,...S.key==="tier"&&me?ae.headerFilterIconActive:{},...S.key==="type"&&D?ae.headerFilterIconActive:{},...S.key==="cost"&&Be?ae.headerFilterIconActive:{}},className:"header-filter-icon",onClick:de=>{de.stopPropagation(),S.key==="tier"?(g(!W),H(!1),_(!1)):S.key==="type"?(H(!M),g(!1),_(!1)):S.key==="cost"&&(_(!we),g(!1),H(!1))},children:[e.jsx(qt,{size:14}),S.key==="tier"&&me||S.key==="type"&&D||S.key==="cost"&&Be?e.jsx("span",{style:ae.filterActiveDot}):null]})]}):S.label,S.key==="tier"&&Z("tier",d,p,b,W,g,B),S.key==="type"&&Z("type",w,v,V,M,H,T),S.key==="cost"&&m()]},S.key))})},mr=({item:t,onAdd:o,type:c,onRowClick:d,encounterItems:w=[],pcCount:p=4,playerTier:v=1,remainingBudget:W=0,costFilter:g="auto-grey",onAdversaryClick:M})=>{const[H,B]=f.useState(!1),T=()=>{o(t)},b=()=>{if(c!=="adversary")return null;const D=Ke[t.type]||2;let $=0;const O=w.filter(_=>_.type==="adversary"&&_.item.type==="Solo"&&_.quantity>0).reduce((_,Ie)=>_+Ie.quantity,0),we=w.filter(_=>_.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(_.item.type)&&_.quantity>0).reduce((_,Ie)=>_+Ie.quantity,0);return t.type==="Solo"&&O===1&&($+=2),["Bruiser","Horde","Leader","Solo"].includes(t.type)&&we===0&&($+=1),D+$},me=(()=>{if(c==="adversary"){const D=b();Ke[t.type];const $=D>W||W<=0;if(g==="auto-hide"&&$)return null;const O=g==="auto-grey"&&$?{opacity:.5,color:"var(--text-secondary)"}:{};return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...ae.rowCell,width:"auto",minWidth:"0",textAlign:"left",...O},children:e.jsxs("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:[e.jsx("div",{style:{fontWeight:"600"},children:t.name}),t.description&&e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"0.125rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.description})]})}),e.jsx("td",{style:{...ae.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...O},children:t.tier}),e.jsx("td",{style:{...ae.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center",...O},children:t.type}),e.jsx("td",{style:{...ae.rowCell,width:"50px",minWidth:"50px",maxWidth:"50px",textAlign:"center",...O},children:D}),e.jsx("td",{style:{...ae.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...O},children:t.difficulty})]})}else if(c==="environment")return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...ae.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:t.name}),e.jsx("td",{style:{...ae.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:t.tier}),e.jsx("td",{style:{...ae.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:t.type}),e.jsx("td",{style:{...ae.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:t.difficulty})]});return null})();return me===null?null:e.jsx(e.Fragment,{children:e.jsxs("tr",{style:{...ae.row,...H?ae.rowHover:{}},onClick:()=>{c==="adversary"&&M?M(t):d&&d(t,c)},onMouseEnter:()=>B(!0),onMouseLeave:()=>B(!1),children:[me,e.jsx("td",{style:{width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",boxSizing:"border-box",overflow:"visible",textOverflow:"unset",whiteSpace:"nowrap"},children:e.jsx("button",{style:ae.addButton,onClick:D=>{D.stopPropagation(),T()},onMouseEnter:D=>{D.target.style.background="var(--bg-secondary)"},onMouseLeave:D=>{D.target.style.background="var(--purple)"},children:"+"})})]})})},Wt=({type:t,onAddItem:o,onCancel:c=null,onRowClick:d,encounterItems:w=[],pcCount:p=4,playerTier:v=1,partyControls:W=null,showContainer:g=!0,savedEncounters:M=[],onLoadEncounter:H,onDeleteEncounter:B,activeTab:T="adversaries",selectedCustomAdversaryId:b,onSelectCustomAdversary:V,onTabChange:me,selectedAdversary:D,onSelectAdversary:$,filterCustom:O=!1,showCustomToggle:we=!1,onToggleCustom:_,onExportCustomAdversaries:Ie,onImportCustomAdversaries:Re,autoFocus:Be=!1,hideImportExport:te=!1,onClose:se=null,searchPlaceholder:xe="Search"})=>{const{addCustomAdversary:ge,updateCustomAdversary:m,customContent:Z}=ht(),[S,de]=f.useState(null),[ee,fe]=f.useState("all"),[Q,oe]=f.useState(!1),[ye,Ae]=f.useState({}),Te=f.useRef({}),Le=f.useRef(null),Ce=()=>{try{const C=Z.adversaries||[];if(C.length===0){alert("No custom adversaries to export.");return}const ce=["name","tier","type","difficulty","threshold_major","threshold_severe","hp_max","stress_max","atk","weapon","range","damage","description","motives"],ke=C.map(K=>{var I,P;return[K.name||"",K.tier||"",K.type||"",K.difficulty||"",((I=K.thresholds)==null?void 0:I.major)||"",((P=K.thresholds)==null?void 0:P.severe)||"",K.hpMax||"",K.stressMax||"",K.atk||"",K.weapon||"",K.range||"",K.damage||"",K.description||"",K.motives||""]}),x=K=>{const I=String(K);return I.includes(",")||I.includes('"')||I.includes(`
`)?`"${I.replace(/"/g,'""')}"`:I},u=[ce.join(","),...ke.map(K=>K.map(x).join(","))].join(`
`),q=new Blob([u],{type:"text/csv;charset=utf-8;"}),N=URL.createObjectURL(q),le=document.createElement("a");le.href=N,le.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(le),le.click(),document.body.removeChild(le),URL.revokeObjectURL(N),console.log(`Exported ${C.length} custom adversaries to CSV`)}catch(C){console.error("Failed to export custom adversaries:",C),alert("Failed to export custom adversaries. Please try again.")}},l=C=>{const ce=C.target.files[0];if(!ce)return;const ke=ce.name.endsWith(".csv"),x=ce.name.endsWith(".json");if(!ke&&!x){alert("Please upload a CSV or JSON file."),C.target.value="";return}const u=new FileReader;u.onload=q=>{try{let N=[];if(ke){const E=q.target.result.split(`
`).filter(Ee=>Ee.trim());if(E.length<2)throw new Error("CSV file is empty or invalid.");const Y=E[0].split(",").map(Ee=>Ee.trim().replace(/^"|"$/g,""));for(let Ee=1;Ee<E.length;Ee++){const he=[];let De="",We=!1;for(let Ne=0;Ne<E[Ee].length;Ne++){const He=E[Ee][Ne],Fe=E[Ee][Ne+1];He==='"'&&We&&Fe==='"'?(De+='"',Ne++):He==='"'?We=!We:He===","&&!We?(he.push(De.trim()),De=""):De+=He}he.push(De.trim());const Oe={name:he[Y.indexOf("name")]||"",tier:parseInt(he[Y.indexOf("tier")])||1,type:he[Y.indexOf("type")]||"Standard",difficulty:parseInt(he[Y.indexOf("difficulty")])||11,thresholds:{major:parseInt(he[Y.indexOf("threshold_major")])||7,severe:parseInt(he[Y.indexOf("threshold_severe")])||12},hpMax:parseInt(he[Y.indexOf("hp_max")])||3,stressMax:parseInt(he[Y.indexOf("stress_max")])||1,atk:parseInt(he[Y.indexOf("atk")])||1,weapon:he[Y.indexOf("weapon")]||"",range:he[Y.indexOf("range")]||"Melee",damage:he[Y.indexOf("damage")]||"",description:he[Y.indexOf("description")]||"",motives:he[Y.indexOf("motives")]||"",source:"Homebrew"};Oe.name&&N.push(Oe)}}else if(x){const U=JSON.parse(q.target.result);if(!U.customAdversaries||!Array.isArray(U.customAdversaries))throw new Error("Invalid JSON format. Expected customAdversaries array.");N=U.customAdversaries}const le=Z.adversaries||[],K=[...le];let I=0,P=0;N.forEach(U=>{if(le.some(Y=>Y.name===U.name&&Y.source===U.source))P++;else{const Y={...U,id:`custom-adv-${Date.now()}-${Math.random().toString(36).slice(2,10)}`,hp:0,stress:0};K.push(Y),I++}}),I>0?(localStorage.setItem("daggerheart-custom-adversaries",JSON.stringify(K)),window.location.reload(),alert(`Import successful! Added ${I} new adversaries${P>0?`, skipped ${P} duplicates`:""}.`)):alert("No new adversaries were added. All imported adversaries already exist.")}catch(N){console.error("Failed to import custom adversaries:",N),alert(`Failed to import custom adversaries: ${N.message}`)}},u.readAsText(ce),C.target.value=""},n=()=>{de(null)},r=async(C,ce)=>{ce?m(ce,C):ge(C)},a=C=>{ye[C]?(B&&B(C),Ae(ce=>{const ke={...ce};return delete ke[C],ke}),Te.current[C]&&(clearTimeout(Te.current[C]),delete Te.current[C])):(Ae(ce=>({...ce,[C]:!0})),Te.current[C]&&clearTimeout(Te.current[C]),Te.current[C]=setTimeout(()=>{Ae(ce=>{const ke={...ce};return delete ke[C],ke}),delete Te.current[C]},3e3))};f.useEffect(()=>()=>{Object.values(Te.current).forEach(C=>{clearTimeout(C)})},[]);const{searchTerm:h,setSearchTerm:R,sortFields:L,handleSort:ie,filteredAndSortedData:be,loading:ze,selectedTiers:s,selectedTypes:k,showTierDropdown:i,setShowTierDropdown:j,showTypeDropdown:G,setShowTypeDropdown:A,tierFilterRef:J,typeFilterRef:Se,uniqueTiers:Me,uniqueTypes:ve,handleTierSelect:y,handleTypeSelect:z,isTierFiltered:F,isTypeFiltered:re,getDropdownStyle:X}=dr(t,w,p,v,O),pe=(()=>{const C=3*p+2,ce=w.reduce((I,P)=>{if(P.type==="adversary"){const U=Ke[P.item.type]||2;if(P.item.type==="Minion"){const E=Math.ceil(P.quantity/p);return I+E*U}else return I+P.quantity*U}return I},0);let ke=0;w.filter(I=>I.type==="adversary"&&I.item.type==="Solo"&&I.quantity>0).reduce((I,P)=>I+P.quantity,0)>=2&&(ke+=tt.twoOrMoreSolos);const u=w.some(I=>I.type==="adversary"&&I.item.type==="Bruiser"&&I.quantity>0),q=w.some(I=>I.type==="adversary"&&I.item.type==="Horde"&&I.quantity>0),N=w.some(I=>I.type==="adversary"&&I.item.type==="Leader"&&I.quantity>0),le=w.some(I=>I.type==="adversary"&&I.item.type==="Solo"&&I.quantity>0);return!u&&!q&&!N&&!le&&(ke+=tt.noBruisersHordesLeadersSolos),C+ke-ce})(),ue=C=>{fe(C),oe(!1)},ne=ee!=="all";return ze?e.jsx("div",{style:ae.browser,children:e.jsx("div",{style:ae.loading,children:"Loading..."})}):e.jsx(e.Fragment,{children:e.jsxs("div",{style:g?ae.browserWrapper:ae.browserWrapperNoContainer,children:[T==="adversaries"&&e.jsxs(e.Fragment,{children:[e.jsx(cr,{searchTerm:h,onSearchChange:R,type:t,partyControls:W,autoFocus:Be,onClose:se,placeholder:xe}),!te&&e.jsx(pr,{showCustomToggle:we,onToggleCustom:_,filterCustom:O,onExportCustomAdversaries:Ce,onImportCustomAdversaries:l}),e.jsx("div",{className:"browser-content invisible-scrollbar",style:ae.browserContent,children:e.jsxs("table",{style:ae.browserTable,children:[e.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,backgroundColor:"var(--bg-primary)"},children:e.jsx(ur,{sortFields:L,onSort:ie,type:t,uniqueTiers:Me,uniqueTypes:ve,selectedTiers:s,selectedTypes:k,showTierDropdown:i,setShowTierDropdown:j,showTypeDropdown:G,setShowTypeDropdown:A,tierFilterRef:J,typeFilterRef:Se,handleTierSelect:y,handleTypeSelect:z,isTierFiltered:F,isTypeFiltered:re,getDropdownStyle:X,costFilter:ee,showCostDropdown:Q,setShowCostDropdown:oe,costFilterRef:Le,handleCostFilterSelect:ue,isCostFiltered:ne})}),e.jsx("tbody",{children:be.map(C=>e.jsx(mr,{item:C,onAdd:o,type:t,onRowClick:d,encounterItems:w,pcCount:p,playerTier:v,remainingBudget:pe,costFilter:ee,onAdversaryClick:ce=>{t==="adversary"&&(D&&D.id===ce.id?$&&$(null):$&&$(ce))}},C.id))})]})})]}),T==="encounters"&&e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:M.length===0?e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",textAlign:"center",padding:"2rem 1rem"},children:"No saved encounters yet"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:M.map(C=>e.jsxs("div",{onClick:()=>H&&H(C.id),className:"saved-encounter-card",style:{border:"1px solid var(--border)",borderRadius:"8px",padding:"8px",backgroundColor:"var(--bg-card)",transition:"background-color 0.2s ease",display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsxs("div",{style:{minWidth:"100px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",flexDirection:"column",justifyContent:"center",minHeight:"60px"},children:[e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Tier: ",(()=>{var x,u,q,N;const ce=((N=(q=(u=(x=C.encounterItems)==null?void 0:x.filter(le=>le.type==="adversary"))==null?void 0:u.map(le=>le.item.tier))==null?void 0:q.filter(le=>le!=null))==null?void 0:N.sort((le,K)=>le-K))||[];if(ce.length===0)return"N/A";if(ce.length===1)return ce[0];const ke=[...new Set(ce)];return ke.length===1?ke[0]:`${Math.min(...ke)}-${Math.max(...ke)}`})()]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Party Size: ",C.partySize||4]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)"},children:["Balance: ",(()=>{const ce=C.partySize||4,ke=3*ce+2;let x=0;const u=C.encounterItems||[];u.filter(E=>E.type==="adversary"&&E.item.type==="Solo"&&E.quantity>0).reduce((E,Y)=>E+Y.quantity,0)>=2&&(x+=tt.twoOrMoreSolos);const N=u.some(E=>E.type==="adversary"&&E.item.type==="Bruiser"&&E.quantity>0),le=u.some(E=>E.type==="adversary"&&E.item.type==="Horde"&&E.quantity>0),K=u.some(E=>E.type==="adversary"&&E.item.type==="Leader"&&E.quantity>0),I=u.some(E=>E.type==="adversary"&&E.item.type==="Solo"&&E.quantity>0);!N&&!le&&!K&&!I&&(x+=tt.noBruisersHordesLeadersSolos);const P=ke+x,U=u.reduce((E,Y)=>{if(Y.type==="adversary"){const Ee=Ke[Y.item.type]||2;if(Y.item.type==="Minion"){const he=Math.ceil(Y.quantity/ce);return E+he*Ee}else return E+Y.quantity*Ee}return E},0);return U>P?`+${U-P}`:U===P?"0":`-${P-U}`})()]})]}),e.jsx("div",{style:{minWidth:"120px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",alignItems:"center",minHeight:"60px"},children:e.jsx("div",{style:{fontWeight:"500",color:"var(--text-primary)",fontSize:"0.9rem",wordWrap:"break-word",wordBreak:"break-word",width:"150px",maxWidth:"150px"},children:C.name})}),e.jsx(ir,{encounter:C}),e.jsx("button",{onClick:ce=>{ce.stopPropagation(),a(C.id)},style:{background:ye[C.id]?"var(--danger)":"var(--gray-600)",border:"none",color:"white",padding:"0.4rem 0.8rem",borderRadius:"4px",fontSize:"0.75rem",cursor:"pointer",minWidth:"60px",transition:"background-color 0.2s"},children:"Delete"})]},C.id))})}),T==="create"&&e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"1rem",display:"flex",justifyContent:"center",alignItems:"flex-start",height:"100%",minHeight:0},children:e.jsx("div",{style:{maxWidth:"600px",width:"100%",height:"auto",display:"flex",flexDirection:"column",padding:"0",overflowY:"visible",overflowX:"hidden",minHeight:0},children:e.jsx(Rt,{onSave:r,onRefresh:()=>{},onAddItem:o,editingAdversary:S,onCancelEdit:n,embedded:!1})})}),T==="info"&&e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"2rem"},children:[e.jsxs("div",{style:{marginBottom:"2rem",textAlign:"center"},children:[e.jsx("img",{src:nr,alt:"Daggerheart Community Content Logo",style:{width:"100%",maxWidth:"300px",height:"auto",margin:"0 auto 1.5rem auto",display:"block"},onError:C=>{console.error("Failed to load Daggerheart logo:",C.target.src),C.target.style.display="none"}}),e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",textAlign:"left",maxWidth:"600px",margin:"0 auto"},children:[e.jsx("p",{style:{marginTop:0},children:"This product includes materials from the Daggerheart System Reference Document 1.0, © Critical Role, LLC, under the terms of the Darrington Press Community Gaming (DPCGL) License."}),e.jsxs("p",{children:["More information can be found at ",e.jsx("a",{href:"https://www.daggerheart.com",target:"_blank",rel:"noopener noreferrer",style:{color:"var(--purple)",textDecoration:"underline"},children:"daggerheart.com"})]}),e.jsx("p",{style:{marginBottom:0},children:e.jsx("em",{children:"This project is unofficial and not endorsed by Darrington Press or Critical Role."})})]})]}),e.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto",border:"1px solid var(--border)",borderRadius:"8px",overflow:"hidden"},children:[e.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"1rem 1.5rem",color:"var(--text-primary)",border:"none",background:"var(--bg-secondary)",width:"100%",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"0.875rem",borderBottom:"1px solid var(--border)"},onMouseEnter:C=>{C.target.style.backgroundColor="var(--bg-hover)"},onMouseLeave:C=>{C.target.style.backgroundColor="var(--bg-secondary)"},onClick:C=>{C.stopPropagation(),window.open("https://github.com/Splinter714/Daggerheart","_blank")},children:[e.jsx("span",{children:"View on GitHub"}),e.jsx("span",{children:"→"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem 1.5rem",color:"var(--text-secondary)",background:"var(--bg-secondary)",fontSize:"0.875rem"},children:["Version ","0.4.5 (8c0728b)"]})]})]})]})})},ae={browserWrapper:{display:"flex",flexDirection:"column",background:"var(--bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border)",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserWrapperNoContainer:{display:"flex",flexDirection:"column",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserContent:{flex:1,overflowY:"auto",overflowX:"visible",padding:0,width:"100%",scrollbarWidth:"none",msOverflowStyle:"none",borderRadius:"0 0 8px 8px"},tableHeaderContainer:{flexShrink:0,position:"sticky",top:0,zIndex:15,backgroundColor:"var(--bg-secondary)"},browserTable:{width:"100%",minWidth:"100%",borderCollapse:"collapse",tableLayout:"fixed",background:"var(--bg-primary)",margin:0},browserHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--gray-900)",flexShrink:0,position:"sticky",top:0,zIndex:20},browserTitle:{margin:0,color:"var(--text-primary)",fontSize:"18px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"24px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",marginRight:"12px",transition:"all 0.2s ease"},partyControls:{display:"flex",alignItems:"center",gap:"12px",flexShrink:0},searchInputFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 3px rgba(139, 92, 246, 0.1)"},tableHeader:{background:"var(--gray-900)",borderBottom:"1px solid var(--border)",boxShadow:"0 1px 0 var(--border)",position:"sticky",top:"0",zIndex:10},tableHeaderCell:{backgroundColor:"var(--gray-900)",fontWeight:"700",borderBottom:"1px solid var(--border)",cursor:"pointer",userSelect:"none",minWidth:"100px",whiteSpace:"nowrap",padding:"4px 4px",color:"var(--text-primary)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",boxShadow:"0 1px 0 var(--border)",transition:"background-color 0.2s",position:"sticky",top:"0",zIndex:10},tableHeaderCellHover:{backgroundColor:"var(--bg-hover)"},sortIndicator:{fontSize:"12px",color:"var(--text-secondary)"},tableBody:{flex:1,overflowY:"auto",padding:"8px",backgroundColor:"var(--bg-primary)"},row:{height:"35px",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s ease",cursor:"pointer",backgroundColor:"var(--gray-900)"},rowHover:{backgroundColor:"var(--bg-secondary)"},expandedRow:{backgroundColor:"var(--bg-secondary)"},rowCell:{padding:"4px 4px",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid var(--border)"},rowCellName:{fontWeight:"500",minWidth:"150px"},rowCellCenter:{textAlign:"center",justifyContent:"center",minWidth:"80px"},rowActions:{width:"80px",textAlign:"center",padding:"4px 8px",borderBottom:"1px solid var(--border)"},addButton:{width:"2rem",height:"2rem",border:"1px solid var(--purple)",borderRadius:"var(--radius-sm)",background:"var(--purple)",color:"white",cursor:"pointer",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"500"},expandedContent:{padding:"0",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)"},columnName:{width:"auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",paddingLeft:"8px",textAlign:"left"},columnTier:{width:"80px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnType:{width:"100px",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},columnDifficulty:{width:"40px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnAction:{width:"32px",minWidth:"24px",maxWidth:"24px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"visible",textOverflow:"unset"},loading:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"var(--text-primary)",fontSize:"16px"},mobileBrowser:{width:"95vw",height:"90vh",maxWidth:"none"},mobileSearchInput:{fontSize:"16px"},headerWithFilter:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0px",position:"relative"},headerFilterIcon:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"2px 4px",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",position:"relative",marginLeft:"-2px"},headerFilterIconActive:{color:"var(--purple)"},filterIcon:{fontSize:"12px"},filterActiveDot:{position:"absolute",left:"50%",top:"2px",transform:"translateX(-50%)",width:"4px",height:"4px",borderRadius:"50%",background:"var(--purple)",pointerEvents:"none"},filterDropdown:{position:"fixed",background:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",zIndex:99999,marginTop:"4px",overflow:"hidden",width:"max-content",minWidth:"120px",maxWidth:"200px"},filterOption:{padding:"8px 12px",cursor:"pointer",color:"var(--text-primary)",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background-color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},filterOptionSelected:{backgroundColor:"var(--bg-hover)"},checkIcon:{width:"16px",height:"16px",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"12px"},filterLabel:{flex:1}},fr=()=>e.jsx("div",{className:"pwa-install-prompt",style:{}}),lt=({side:t="left",children:o,className:c="",style:d={}})=>{const w=t==="left",p={flex:1,minWidth:0,background:"var(--bg-primary)",overflowY:"auto",overflowX:w?"auto":"hidden",display:w?"block":"flex",flexDirection:w?"initial":"column",height:"100%",padding:w?"8px 0 8px 0":"0 8px 0 0",...d};return e.jsx("div",{className:c,style:p,children:o})},hr=t=>3*t+2,xr={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},dt={lessDifficult:-1,twoOrMoreSolos:-2,increasedDamage:-2,lowerTierAdversary:1,noBruisersHordesLeadersSolos:1,moreDangerous:2},gr=({isOpen:t,onClose:o,onAddAdversary:c,onAddAdversariesBulk:d,onAddEnvironment:w,onDeleteAdversary:p,onDeleteEnvironment:v,onDeleteCountdown:W,adversaries:g=[],environments:M=[],countdowns:H=[],savedEncounters:B=[],onSaveEncounter:T,onLoadEncounter:b,onDeleteEncounter:V})=>{const{partySize:me,updatePartySize:D,currentEncounterName:$,updateCurrentEncounterName:O,customContent:we}=ht(),_=me,Ie=D,[Re,Be]=f.useState({lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),[te,se]=f.useState([]),[xe,ge]=f.useState($||"Encounter"),[m,Z]=f.useState("adversaries"),[S,de]=f.useState(null),[ee,fe]=f.useState(null),[Q,oe]=f.useState(null),[ye,Ae]=f.useState(null),[Te,Le]=f.useState(!1);f.useEffect(()=>{t&&!S&&ge($||"Encounter")},[t,S,$]);const Ce=()=>ee?xe!==ee.name||JSON.stringify(te)!==JSON.stringify(ee.encounterItems)||_!==ee.partySize||JSON.stringify(Re)!==JSON.stringify(ee.battlePointsAdjustments):!1,l=()=>{var y;if(te.length>0||(xe||"").trim()!=="Encounter")return!0;if(S&&Ce()){if(ee){const z=te.length,F=((y=ee.encounterItems)==null?void 0:y.length)||0;if(z!==F||(xe||"").trim()!==(ee.name||""))return!0;const re=JSON.stringify(Re),X=JSON.stringify(ee.battlePointsAdjustments||{});return re!==X}return!0}return!1},n=({onClick:y,children:z,variant:F="secondary",isConfirmation:re=!1})=>{const X=F==="danger"||F==="secondary"&&re,je=F==="purple";return e.jsx("button",{onClick:y,style:{background:X?"var(--danger)":je?"var(--purple)":"var(--bg-secondary)",border:je?"none":"1px solid var(--border)",color:X||je?"white":"var(--text-primary)",padding:"0.375rem 0.75rem",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s",width:"70px",fontSize:"0.875rem"},children:z})},r=Ve.useRef(_),a=f.useCallback(y=>!y||y.length===0?null:B.find(F=>{var pe,ue;if(((pe=F.encounterItems)==null?void 0:pe.length)!==y.length)return!1;const re=ne=>{var C;return{type:ne.type,quantity:ne.quantity,item:{name:ne.item.baseName||((C=ne.item.name)==null?void 0:C.replace(/\s+\(\d+\)$/,""))||ne.item.name,type:ne.item.type,tier:ne.item.tier}}},X=(ue=F.encounterItems)==null?void 0:ue.map(re).sort((ne,C)=>ne.item.name.localeCompare(C.item.name)||ne.item.type.localeCompare(C.item.type)),je=y.map(re).sort((ne,C)=>ne.item.name.localeCompare(C.item.name)||ne.item.type.localeCompare(C.item.type));return JSON.stringify(X)===JSON.stringify(je)})||null,[B]);Ve.useEffect(()=>{if(t&&g.length>0&&te.length===0){const y={};g.forEach(re=>{var je;const X=re.baseName||((je=re.name)==null?void 0:je.replace(/\s+\(\d+\)$/,""))||re.name;y[X]||(y[X]={type:"adversary",item:re,quantity:0}),y[X].quantity+=1});const z=Object.values(y);se(z);const F=a(z);F&&!S&&(de(F.id),fe({name:F.name||"",encounterItems:F.encounterItems||[],partySize:F.partySize||4,battlePointsAdjustments:F.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),ge(F.name||"Encounter"),O(F.name||"Encounter"))}else t&&g.length===0&&te.length===0&&se([])},[t,a,S,O]);const h=Ve.useMemo(()=>{let y=0;te.filter(pe=>pe.type==="adversary"&&pe.item.type==="Solo"&&pe.quantity>0).reduce((pe,ue)=>pe+ue.quantity,0)>=2&&(y+=dt.twoOrMoreSolos);const F=te.some(pe=>pe.type==="adversary"&&pe.item.type==="Bruiser"&&pe.quantity>0),re=te.some(pe=>pe.type==="adversary"&&pe.item.type==="Horde"&&pe.quantity>0),X=te.some(pe=>pe.type==="adversary"&&pe.item.type==="Leader"&&pe.quantity>0),je=te.some(pe=>pe.type==="adversary"&&pe.item.type==="Solo"&&pe.quantity>0);return!F&&!re&&!X&&!je&&(y+=dt.noBruisersHordesLeadersSolos),y},[te]),R=hr(_),L=Object.entries(Re).filter(([y,z])=>z).reduce((y,[z,F])=>y+dt[z],0),ie=R+L+h,be=te.reduce((y,z)=>{if(z.type==="adversary"){const F=xr[z.item.type]||2;return z.item.type==="Minion"?y+Math.ceil(z.quantity/_)*F:y+F*z.quantity}return y},0);Ve.useEffect(()=>{const y=r.current;y!==_&&(se(z=>z.map(F=>{if(F.type==="adversary"&&F.item.type==="Minion"){const X=Math.ceil(F.quantity/y)*_;return{...F,quantity:X}}return F})),r.current=_)},[_]);const ze=(y,z)=>{const F=te.findIndex(je=>je.item.id===y.id&&je.type===z),re=y.type==="Minion"?_:1;let X;F>=0?X=te.map((je,pe)=>pe===F?{...je,quantity:je.quantity+re}:je):X=[...te,{item:y,type:z,quantity:re}],se(X),s(X)},s=y=>{const z=g||[],F=[];y.forEach(ue=>{for(let ne=0;ne<ue.quantity;ne++)ue.type==="adversary"&&F.push(ue.item)});const re={};z.forEach(ue=>{var C;const ne=ue.baseName||((C=ue.name)==null?void 0:C.replace(/\s+\(\d+\)$/,""))||ue.name;re[ne]||(re[ne]=[]),re[ne].push(ue)});const X={};F.forEach(ue=>{var C;const ne=ue.baseName||((C=ue.name)==null?void 0:C.replace(/\s+\(\d+\)$/,""))||ue.name;X[ne]||(X[ne]=[]),X[ne].push(ue)});const je=[],pe=[];Object.keys(X).forEach(ue=>{var ce;const ne=((ce=re[ue])==null?void 0:ce.length)||0,C=X[ue].length;if(C>ne){const ke=C-ne;for(let x=0;x<ke;x++)je.push(X[ue][0])}else if(C<ne){const ke=ne-C,u=[...re[ue]].sort((q,N)=>{const le=q.duplicateNumber||1;return(N.duplicateNumber||1)-le});for(let q=0;q<ke;q++)pe.push(u[q].id)}}),Object.keys(re).forEach(ue=>{X[ue]||[...re[ue]].sort((ce,ke)=>{const x=ce.duplicateNumber||1;return(ke.duplicateNumber||1)-x}).forEach(ce=>{pe.push(ce.id)})}),pe.forEach(ue=>{p(ue)}),je.length>0&&d(je)},k=(y,z)=>{const F=(()=>{const re=te.findIndex(X=>X.item.id===y&&X.type===z);if(re>=0){const X=te[re];if(X.quantity===0)return te.filter((ue,ne)=>ne!==re);const je=X.item.type==="Minion"?_:1,pe=Math.max(0,X.quantity-je);return te.map((ue,ne)=>ne===re?{...ue,quantity:pe}:ue)}return te})();se(F),s(F)},i=f.useCallback(()=>{if(te.length===0)return null;const y=(xe||"").trim()||"Encounter",z=B.find(F=>{var je,pe;if(F.name!==y||((je=F.encounterItems)==null?void 0:je.length)!==te.length)return!1;const re=JSON.stringify((pe=F.encounterItems)==null?void 0:pe.sort()),X=JSON.stringify([...te].sort());return re===X});return(z==null?void 0:z.id)||null},[B,xe,te]),j=f.useCallback(()=>{let y=(xe||"").trim(),z=S;if(z||(z=i()),te.length===0&&(!y||y==="Encounter")&&z){V(z),de(null),fe(null);return}const F={name:y,encounterItems:te,partySize:_,battlePointsAdjustments:Re};if(z){F.id=z;const re=T(F);de(re)}else{const re=T(F);de(re)}fe({name:y,encounterItems:te,partySize:_,battlePointsAdjustments:Re})},[te,xe,_,Re,S,T,i,V]);f.useEffect(()=>{if(S&&Ce()){const y=setTimeout(()=>{j()},2e3);return()=>clearTimeout(y)}else if(!S&&te.length>0&&xe&&xe.trim()!==""){const y=setTimeout(()=>{j()},2e3);return()=>clearTimeout(y)}},[te,S,xe,Re,_]);const G=()=>{l()&&(se([]),ge("Encounter"),O("Encounter"),de(null),fe(null),g.forEach(y=>{p(y.id)}),M.forEach(y=>{v(y.id)}),H.forEach(y=>{W(y.id)}))},A=y=>{const z=b(y);if(z){const F=z.encounterItems||[];se(F),Ie(z.partySize||4),Be(z.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),ge(z.name||""),O(z.name||""),de(y),fe({name:z.name||"",encounterItems:z.encounterItems||[],partySize:z.partySize||4,battlePointsAdjustments:z.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),s(F)}},J=y=>{V(y),S===y&&(se([]),ge("Encounter"),O("Encounter"),de(null),fe(null),g.forEach(z=>{p(z.id)}),M.forEach(z=>{v(z.id)}),H.forEach(z=>{W(z.id)}))},Se=()=>{try{const y={version:"1.0",exportDate:new Date().toISOString(),customAdversaries:we.adversaries||[]},z=JSON.stringify(y,null,2),F=new Blob([z],{type:"application/json"}),re=URL.createObjectURL(F),X=document.createElement("a");X.href=re,X.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(X),X.click(),document.body.removeChild(X),URL.revokeObjectURL(re),console.log("Custom adversaries exported successfully")}catch(y){console.error("Failed to export custom adversaries:",y),alert("Failed to export custom adversaries. Please try again.")}},Me=y=>{const z=y.target.files[0];if(!z)return;const F=new FileReader;F.onload=re=>{try{const X=JSON.parse(re.target.result);if(!X.customAdversaries||!Array.isArray(X.customAdversaries))throw new Error("Invalid file format. Expected customAdversaries array.");const je=we.adversaries||[],pe=X.customAdversaries,ue=[...je];let ne=0;pe.forEach(C=>{je.some(ke=>ke.name===C.name&&ke.type===C.type)||(ue.push({...C,id:`custom-${Date.now()}-${Math.random().toString(36).slice(2,10)}`}),ne++)}),updateCustomContent("adversary",null,ue),ne>0?alert(`Successfully imported ${ne} custom adversaries.`):alert("No new adversaries were added. All imported adversaries already exist.")}catch(X){console.error("Failed to import custom adversaries:",X),alert("Failed to import custom adversaries. Please check the file format and try again.")}},F.readAsText(z),y.target.value=""};if(!t)return null;const ve=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://");return e.jsx("div",{onClick:o,className:"encounter-builder-modal",style:{position:"fixed",top:0,left:0,right:0,bottom:ve?"calc(60px + env(safe-area-inset-bottom) + 1rem)":"calc(60px + env(safe-area-inset-bottom))",backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:1e3,display:"flex",alignItems:"flex-start",justifyContent:"center",padding:"12px"},children:e.jsxs("div",{onClick:y=>y.stopPropagation(),style:{backgroundColor:"var(--bg-primary)",border:"2px solid var(--border)",borderRadius:"12px",width:"100%",maxWidth:"1200px",height:"100%",maxHeight:"100%",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"},children:[e.jsxs("div",{className:"encounter-top-bar",style:{flex:"0 0 auto",display:"flex",alignItems:"center",height:"39px",backgroundColor:"var(--bg-primary)",borderBottom:"1px solid var(--border)"},children:[e.jsx("button",{onClick:()=>Z("adversaries"),style:{flex:1,background:m==="adversaries"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:m==="adversaries"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Builder"}),e.jsx("button",{onClick:()=>Z("encounters"),style:{flex:1,background:m==="encounters"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:m==="encounters"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Saved Encounters"}),e.jsx("button",{onClick:()=>Z("create"),style:{flex:1,background:m==="create"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:m==="create"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Create Adversary"}),e.jsx("button",{onClick:()=>Z("info"),style:{flex:1,background:m==="info"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:m==="info"?"500":"400",transition:"all 0.2s ease",position:"relative"},children:"Info"})]}),e.jsxs("div",{className:"encounter-builder-content",style:{flex:1,display:"flex",overflow:"hidden"},children:[e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",borderTop:"1px solid var(--border)"},children:e.jsx(Wt,{type:"adversary",onAddItem:y=>ze(y,"adversary"),encounterItems:te,pcCount:_,showContainer:!1,savedEncounters:B,onLoadEncounter:A,onDeleteEncounter:J,activeTab:m,selectedCustomAdversaryId:Q,onSelectCustomAdversary:oe,onTabChange:Z,selectedAdversary:ye,onSelectAdversary:Ae,filterCustom:Te,showCustomToggle:!0,onToggleCustom:Le,onExportCustomAdversaries:Se,onImportCustomAdversaries:Me})}),m!=="info"&&e.jsxs("div",{className:"encounter-right-panel",style:{flex:1,borderLeft:"1px solid var(--border)",display:"flex",flexDirection:"column",overflow:"hidden",position:"relative"},children:[ye&&e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"var(--bg-primary)",zIndex:10,display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)",flexShrink:0},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:0},children:"Adversary Preview"}),e.jsx("button",{onClick:()=>Ae(null),style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease"},onMouseEnter:y=>y.target.style.color="var(--text-primary)",onMouseLeave:y=>y.target.style.color="var(--text-secondary)",title:"Close preview",children:e.jsx(Je,{size:16})})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"0.75rem"},children:e.jsx(nt,{item:{...ye,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...ye,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}})})]}),(m==="adversaries"||m==="encounters")&&e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-primary)",flexShrink:0},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:xe,onChange:y=>{ge(y.target.value),O(y.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(n,{onClick:G,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:l()?1:.5,cursor:l()?"pointer":"not-allowed"},children:"New"})]})}),(m==="adversaries"||m==="encounters")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"encounter-receipt-buttons-vertical",style:{display:"none",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:xe,onChange:y=>{ge(y.target.value),O(y.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(n,{onClick:G,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:l()?1:.5,cursor:l()?"pointer":"not-allowed"},children:"New"})]})}),e.jsx("div",{className:"receipt-content",style:{padding:"1rem",display:"flex",flexDirection:"column",height:"100%"},children:e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"flex-start",overflowY:"auto",marginBottom:"0.75rem"},children:[e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>Ie(Math.max(1,_-1)),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(pt,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:_}),e.jsx("button",{onClick:()=>Ie(_+1),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(Xe,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Party Size"})}),e.jsx("div",{style:{width:"120px",textAlign:"right"}})]}),te.map(y=>{var z;return y.type!=="adversary"?null:e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>k(y.item.id,y.type),style:{background:y.quantity===0?"var(--danger)":"var(--bg-secondary)",border:y.quantity===0?"none":"1px solid var(--border)",color:y.quantity===0?"white":"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:y.quantity===0?e.jsx(Je,{size:10}):e.jsx(pt,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:y.quantity}),e.jsx("button",{onClick:()=>ze(y.item,y.type),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(Xe,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:y.item.baseName||((z=y.item.name)==null?void 0:z.replace(/\s+\(\d+\)$/,""))||y.item.name})}),e.jsx("div",{style:{width:"80px",textAlign:"right"},children:e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.8rem"},children:y.item.type})})]},`${y.item.id}-${y.type}`)}),e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Balance"})}),e.jsx("div",{style:{width:"120px",textAlign:"right",display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsx("span",{style:{color:be>ie?"var(--danger)":be===ie?"var(--purple)":"var(--success)",fontWeight:600},children:be>ie?`+${be-ie}`:ie-be===0?"0":`-${ie-be}`})})]})]})})]}),m==="create"&&e.jsxs("div",{style:{padding:"1.5rem",overflowY:"auto",height:"100%"},children:[e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Creating Adversaries"}),e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsx("p",{children:"Use the form to create custom adversaries for your encounters."}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Adversary Types:"}),e.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Minion (1 BP):"})," Weak enemies in groups"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Standard (2 BP):"})," Average threat level"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Leader (3 BP):"})," Commands others"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Bruiser (4 BP):"})," High HP tank"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Solo (5 BP):"})," Boss-level threat"]})]})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Tips:"}),e.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[e.jsx("li",{children:"Match adversary tier to party level"}),e.jsx("li",{children:"Balance encounter difficulty with Battle Points"}),e.jsx("li",{children:"Mix adversary types for variety"}),e.jsx("li",{children:"Add features that create interesting choices"})]})]})]})]}),m==="myAdversaries"&&e.jsx("div",{style:{padding:"0.75rem",overflowY:"auto",height:"100%"},children:Q?(()=>{var z;const y=(z=we==null?void 0:we.adversaries)==null?void 0:z.find(F=>F.id===Q);return y?e.jsx(nt,{item:{...y,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...y,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}}):e.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Adversary not found"})})():e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Adversary Preview"}),e.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Select an adversary to view details"})]})})]})]})]})})},yr=t=>3*t+2,vr={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},kt={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1};class br extends Ve.Component{constructor(o){super(o),this.state={hasError:!1,error:null}}static getDerivedStateFromError(o){return{hasError:!0,error:o}}componentDidCatch(o,c){console.error("ErrorBoundary caught an error:",o,c)}render(){var o;return this.state.hasError?e.jsxs("div",{className:"p-md text-red",children:[e.jsx("h3",{children:"Something went wrong:"}),e.jsx("pre",{children:(o=this.state.error)==null?void 0:o.toString()}),e.jsx("button",{className:"btn-base btn-text",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try again"})]}):this.props.children}}const wr=()=>{const{adversaries:t,environments:o,countdowns:c,fear:d,savedEncounters:w,partySize:p,updateFear:v,createAdversary:W,createAdversariesBulk:g,updateAdversary:M,deleteAdversary:H,createEnvironment:B,updateEnvironment:T,deleteEnvironment:b,createCountdown:V,updateCountdown:me,deleteCountdown:D,advanceCountdown:$,saveEncounter:O,loadEncounter:we,deleteEncounter:_}=ht(),Ie=p||4,[Re,Be]=f.useState(!1),[te,se]=f.useState(!1);f.useState(!1),f.useState(!1),f.useState(!0);const[xe,ge]=f.useState(null),[m,Z]=f.useState(null),[S,de]=f.useState(null),[ee,fe]=f.useState(!1),[Q,oe]=f.useState(0),[ye,Ae]=f.useState(0),[Te,Le]=f.useState(!1);f.useState(new Set);const[Ce,l]=f.useState(new Set),[n,r]=f.useState(null),[a,h]=f.useState(!1),R=f.useRef(null);f.useEffect(()=>{const x=()=>{const q=window.matchMedia("(max-width: 800px)");Be(q.matches)};x();const u=window.matchMedia("(max-width: 800px)");return u.addEventListener("change",x),()=>u.removeEventListener("change",x)},[]);const L=12,ie=x=>x===1?200:350,be=x=>{if(x<=0)return{visibleColumns:1,columnWidth:ie(1)};const u=L*2,q=x-u;let N={visibleColumns:1,columnWidth:q};for(let K=1;K<=5;K++){const I=(K-1)*L,P=(q-I)/K;P>=ie(K)&&K*P+I<=q&&(N={visibleColumns:K,columnWidth:P})}return N.visibleColumns*N.columnWidth+(N.visibleColumns-1)*L>q&&(N={visibleColumns:1,columnWidth:q}),N},{visibleColumns:ze,columnWidth:s}=be(Q);f.useEffect(()=>{const x=()=>{oe(window.innerWidth)};return x(),window.addEventListener("resize",x),()=>window.removeEventListener("resize",x)},[]);const k=f.useCallback(()=>{se(!1)},[]),i=f.useCallback(x=>{let u=!1;if(R.current){const q=R.current,N=q.scrollLeft,le=q.scrollWidth-q.clientWidth;u=Math.abs(N-le)<1,u&&(q._wasAtMaxScrollOnBrowserOpen=!0)}Z(x)},[]);f.useEffect(()=>{m!==null&&R.current&&R.current._wasAtMaxScrollOnBrowserOpen&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(R.current){const q=R.current,N=q.scrollWidth-q.clientWidth;q.scrollLeft=N,q._wasAtMaxScrollOnBrowserOpen=!1}})})},[m,s,L]);const j=f.useCallback(()=>{Z(null)},[]),G=f.useCallback((x,u=500,q="unknown")=>{if(console.log("[HORIZONTAL_SCROLL] smoothScrollTo called:",{targetScrollLeft:x,duration:u,reason:q,timestamp:performance.now()}),!R.current){console.log("[HORIZONTAL_SCROLL] No container ref, aborting");return}const N=R.current,le=N.scrollLeft,K=x-le;if(console.log("[HORIZONTAL_SCROLL] Scroll params:",{startScrollLeft:le,targetScrollLeft:x,distance:K,containerWidth:N.clientWidth,scrollWidth:N.scrollWidth}),Math.abs(K)<1){console.log("[HORIZONTAL_SCROLL] Distance too small, skipping animation");return}N._horizontalScrollAnimationId&&(console.log("[HORIZONTAL_SCROLL] Canceling existing animation"),cancelAnimationFrame(N._horizontalScrollAnimationId),N._horizontalScrollAnimationId=null);const P=window.getComputedStyle(N).scrollSnapType!=="none",U=P?"x mandatory":null;console.log("[HORIZONTAL_SCROLL] Scroll-snap state:",{hasScrollSnap:P,originalScrollSnapType:U}),P&&(N.style.scrollSnapType="none");const E=performance.now();console.log("[HORIZONTAL_SCROLL] Starting animation at:",E);const Y=Ee=>{const he=Ee-E,De=Math.min(he/u,1),We=1-De,Oe=1-We*We*We;if(N){const Ne=le+K*Oe;N.scrollLeft=Ne}De<1?N._horizontalScrollAnimationId=requestAnimationFrame(Y):(console.log("[HORIZONTAL_SCROLL] Animation complete, final scrollLeft:",N.scrollLeft),N&&(N.scrollLeft=x,N._horizontalScrollAnimationId=null))};return N._horizontalScrollAnimationId=requestAnimationFrame(Y),()=>{animationId&&cancelAnimationFrame(animationId),P&&N&&(N.style.scrollSnapType=U||"")}},[]),A=f.useCallback(()=>{const x={};return t.forEach(u=>{var N;const q=u.baseName||((N=u.name)==null?void 0:N.replace(/\s+\(\d+\)$/,""))||u.name;x[q]||(x[q]={type:"adversary",baseName:q,instances:[]}),x[q].instances.push(u)}),c.forEach(u=>{x[`countdown-${u.id}`]={type:"countdown",baseName:u.name,instances:[u]}}),Object.values(x)},[t,c]),J=A(),Se=f.useCallback(x=>{var E,Y,Ee;const u=x.baseName||((E=x.name)==null?void 0:E.replace(/\s+\(\d+\)$/,""))||x.name,N=!J.find(he=>he.baseName===u&&he.type==="adversary"),le=performance.now(),K=((Y=R.current)==null?void 0:Y.scrollWidth)??0,I=((Ee=R.current)==null?void 0:Ee.scrollLeft)??0,P=R.current;let U=!1;if(P&&N&&window.getComputedStyle(P).scrollSnapType!=="none"&&(P.style.scrollSnapType="none",U=!0,console.log("[ADVERSARY_ADD] Disabled scroll-snap before adding adversary to prevent auto-scroll")),console.log("[ADVERSARY_ADD] handleAddAdversaryFromBrowser called:",{baseName:u,isNewAdversary:N,timestamp:le,currentScroll:I,scrollWidth:K,scrollSnapDisabled:U}),W(x),ge("adversary"),N){const he=`adversary-${u}`;l(De=>new Set(De).add(he)),setTimeout(()=>{l(De=>{const We=new Set(De);return We.delete(he),We})},10)}setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!R.current)return;const he=R.current;if(!(he.scrollWidth<=he.clientWidth))if(N){const De=he.scrollWidth;setTimeout(()=>{if(!R.current)return;const We=R.current;if(We.scrollWidth!==De)requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!R.current)return;const Ne=R.current,He=Ne.scrollWidth-Ne.clientWidth,Fe=Ne.scrollLeft,$e=He-I,Ze=Ne.scrollWidth>K;console.log("[HORIZONTAL_SCROLL] New adversary added, scrollWidth stabilized:",{maxScroll:He,scrollWidth:Ne.scrollWidth,clientWidth:Ne.clientWidth,scrollWidthBeforeAdd:K,scrollLeftBeforeAdd:I,currentScroll:Fe,scrollChanged:Fe!==I,scrollWidthIncreased:Ze,distance:$e}),Ze&&Math.abs($e)<1?G(He+10,500,"new-adversary"):Math.abs($e)>1&&G(He,500,"new-adversary")})});else{const Ne=We.scrollWidth-We.clientWidth,He=We.scrollLeft,Fe=Ne-I,$e=We.scrollWidth>K;console.log("[HORIZONTAL_SCROLL] New adversary added, scrollWidth stable:",{maxScroll:Ne,scrollWidth:We.scrollWidth,clientWidth:We.clientWidth,scrollWidthBeforeAdd:K,scrollLeftBeforeAdd:I,currentScroll:He,scrollChanged:He!==I,scrollWidthIncreased:$e,distance:Fe}),$e&&Math.abs(Fe)<1?G(Ne+10,500,"new-adversary"):Math.abs(Fe)>1&&G(Ne,500,"new-adversary")}},10)}else{const We=A().findIndex(Oe=>Oe.baseName===u&&Oe.type==="adversary");if(We>=0){const Oe=R.current,Ne=Oe.scrollLeft,He=Oe.clientWidth,Fe=m!==null?He-(s+L):He,$e=We*(s+L),Ze=$e+s+L,xt=10;$e>=Ne-xt&&Ze<=Ne+Fe+xt||G($e,500)}}})})},50)},[W,J,s,L,G,A,m]),Me=f.useCallback(()=>{W({name:"",baseName:"",tier:1,type:"Standard",description:"",motives:"",difficulty:11,thresholds:{major:7,severe:12},hpMax:3,stressMax:1,atk:1,weapon:"",range:"Melee",damage:"",experience:[],features:[],source:"Homebrew",hp:0,stress:0,isVisible:!0}),setTimeout(()=>{const u=A();for(const q of u)if(q.type==="adversary"){const N=q.instances.find(le=>le.source==="Homebrew"&&(!le.baseName||le.baseName.trim()===""||le.baseName==="Unknown"));if(N&&!S){de(N.id),requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(R.current){R.current;const le=u.findIndex(K=>K.instances.some(I=>I.id===N.id));if(le>=0){const K=le*(s+L);G(K,600,"new-custom-adversary")}}})});break}}},100)},[W,A,s,L,G,S]),ve=f.useCallback(x=>{de(x),fe(!1)},[]),y=f.useCallback(()=>{de(null),fe(!1)},[]),z=f.useCallback(async(x,u)=>{if(u)M(u,x),de(null);else if(S){const q=W({...x,id:void 0});return de(null),q}else{const q=W({...x,id:void 0});return fe(!1),q}},[S,W,M]),re=f.useCallback(()=>{const x={};return t.forEach(u=>{var N;const q=u.baseName||((N=u.name)==null?void 0:N.replace(/\s+\(\d+\)$/,""))||u.name;x[q]||(x[q]={type:"adversary",item:u,quantity:0}),x[q].quantity+=1}),Object.values(x)},[t])(),X=yr(Ie),je=re.filter(x=>x.item.type==="Solo"&&x.quantity>0).reduce((x,u)=>x+u.quantity,0),pe=re.some(x=>x.item.type&&["Bruiser","Horde","Leader","Solo"].includes(x.item.type)&&x.quantity>0);let ue=0;je>=2&&(ue+=kt.twoOrMoreSolos),pe||(ue+=kt.noBruisersHordesLeadersSolos);const ne=X+ue,C=re.reduce((x,u)=>{if(u.type==="adversary"){const q=vr[u.item.type]||2;return u.item.type==="Minion"?x+Math.ceil(u.quantity/Ie)*q:x+q*u.quantity}return x},0),ce=f.useRef(null),ke=f.useCallback(x=>{Ae(x.target.scrollLeft),ce.current&&clearTimeout(ce.current),ce.current=setTimeout(()=>{const u=x.target;u&&u.style.scrollSnapType==="none"&&(u.style.scrollSnapType="x mandatory")},150)},[]);return f.useCallback(()=>{Le(!0)},[]),f.useCallback(()=>{setTimeout(()=>Le(!1),100)},[]),J.length,e.jsxs("div",{className:"app",onClick:x=>{x.target,x.currentTarget},children:[e.jsx(Qt,{position:"top",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",width:"100%",justifyContent:"space-between",padding:"0 1rem"},children:[e.jsx(Ye,{type:"fear",value:(d==null?void 0:d.value)||0,maxValue:12,onChange:v,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0}),e.jsx("button",{onClick:()=>{m!==null?j():i(J.length)},title:m!==null?"Close Browser":"Add Adversaries",style:{width:"36px",height:"36px",padding:0,backgroundColor:m!==null?"var(--purple)":"transparent",border:"1px solid var(--border)",borderRadius:"50%",color:m!==null?"white":"var(--text-primary)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",flexShrink:0},onMouseEnter:x=>{m===null&&(x.target.style.borderColor="var(--purple)",x.target.style.backgroundColor="var(--bg-secondary)")},onMouseLeave:x=>{m===null&&(x.target.style.borderColor="var(--border)",x.target.style.backgroundColor="transparent")},children:e.jsx(Xe,{size:18})})]})}),e.jsxs("div",{className:"main-content",style:{position:"relative",width:"100%"},children:[m!==null&&e.jsx("div",{style:{position:"absolute",top:`${L}px`,right:`${L}px`,bottom:`${L}px`,width:`${s}px`,zIndex:100,overflow:"visible"},children:e.jsx(zt,{tabContent:e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:Me,style:{padding:"0.375rem 0.75rem",backgroundColor:"var(--purple)",border:"none",color:"white",borderRadius:"4px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",transition:"opacity 0.2s ease"},onMouseEnter:x=>{x.target.style.opacity="0.9"},onMouseLeave:x=>{x.target.style.opacity="1"},children:[e.jsx(Xe,{size:16}),e.jsx("span",{children:"Add Custom"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:"500"},children:"Balance:"}),e.jsx("span",{style:{color:C>ne?"var(--danger)":C===ne?"var(--purple)":"var(--success)",fontWeight:600,fontSize:"0.875rem"},children:C>ne?`+${C-ne}`:ne-C===0?"0":`-${ne-C}`})]}),j&&e.jsx("button",{onClick:j,style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease",flexShrink:0},onMouseEnter:x=>x.target.style.color="var(--text-primary)",onMouseLeave:x=>x.target.style.color="var(--text-secondary)",title:"Close browser",children:e.jsx(Je,{size:16})})]}),showTab:!0,tabBackgroundColor:"var(--bg-primary)",tabBorderColor:"var(--border)",tabJustifyContent:"space-between",containerBackgroundColor:"var(--bg-primary)",containerBorderColor:"var(--border)",containerBorderRadius:"8px",containerBoxShadow:"-4px 0 12px rgba(0, 0, 0, 0.3)",containerOverflow:"hidden",reserveTabSpace:!0,containerStyle:{height:"100%"},children:e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,display:"flex",flexDirection:"column",width:"100%",minWidth:0},children:e.jsx(Wt,{type:"adversary",onAddItem:Se,showContainer:!1,activeTab:"adversaries",autoFocus:!0,hideImportExport:!0,onClose:j,searchPlaceholder:"Search adversaries"})})})}),e.jsxs("div",{ref:R,className:"dashboard-scroll-container",style:{display:"flex",flexDirection:"row",overflowX:"auto",overflowY:"hidden",padding:`0 ${L}px 0 0`,scrollSnapType:"x mandatory",height:"100%",width:"100%"},onScroll:ke,children:[J.length===0?null:(()=>{const x=[];if(J.forEach((u,q)=>{var le,K;if(n&&n.baseName===u.baseName&&u.type==="adversary"){x.push(e.jsx(lt,{style:{width:a?"0px":`${s+L}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:a?"0px":`${L}px`,paddingRight:"0",paddingTop:a?"0px":`${L}px`,paddingBottom:a?"0px":`${L}px`,scrollSnapAlign:"none",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"100%",opacity:0,transition:"width 0.3s ease, padding-left 0.3s ease, padding-top 0.3s ease, padding-bottom 0.3s ease"}},`spacer-${n.baseName}`));return}x.push(e.jsx(lt,{style:{width:`${s+L}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:`${L}px`,paddingRight:"0",paddingTop:`${m!==null&&u.type==="adversary"?L+52:L}px`,paddingBottom:`${L}px`,scrollSnapAlign:"start",overflow:m!==null&&u.type==="adversary"?"visible":"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"auto",opacity:Ce.has(`${u.type}-${u.baseName}`)?0:1,transition:(Ce.has(`${u.type}-${u.baseName}`),"opacity 0.2s ease")},children:e.jsx(nt,{type:u.type,item:{...u.instances[0],name:u.baseName,hp:0,stress:0,isDead:!1},mode:"expanded",instances:u.instances,showCustomCreator:u.type==="adversary"&&S&&u.instances.some(I=>I.id===S),onSaveCustomAdversary:u.type==="adversary"&&S&&u.instances.some(I=>I.id===S)?z:void 0,onCancelEdit:u.type==="adversary"&&S&&u.instances.some(I=>I.id===S)?y:void 0,isStockAdversary:u.type==="adversary"&&S&&u.instances.some(I=>I.id===S)?!((le=u.instances[0])!=null&&le.source)||((K=u.instances[0])==null?void 0:K.source)!=="Homebrew":!1,onApplyDamage:u.type==="adversary"?(I,P,U,E)=>{const Y=u.instances.find(Ee=>Ee.id===I);Y&&M(I,{hp:Math.min(Y.hpMax||1,(Y.hp||0)+P)})}:void 0,onApplyHealing:u.type==="adversary"?(I,P,U)=>{const E=u.instances.find(Y=>Y.id===I);E&&M(I,{hp:Math.max(0,(E.hp||0)-P)})}:void 0,onApplyStressChange:u.type==="adversary"?(I,P)=>{var U,E;return M(I,{stress:Math.max(0,Math.min(((U=u.instances.find(Y=>Y.id===I))==null?void 0:U.stressMax)||6,(((E=u.instances.find(Y=>Y.id===I))==null?void 0:E.stress)||0)+P))})}:void 0,onUpdate:u.type==="adversary"?M:u.type==="environment"?T:me,adversaries:t,showAddRemoveButtons:m!==null&&u.type==="adversary",onEdit:u.type==="adversary"?I=>ve(I):void 0,onAddInstance:u.type==="adversary"?I=>{W(I),setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(R.current){const P=R.current,U=P.scrollLeft,E=P.clientWidth,Y=m!==null?E-(s+L):E,he=A().findIndex(De=>De.baseName===u.baseName&&De.type==="adversary");if(he>=0){const De=he*(s+L),We=De+s+L,Oe=10;De>=U-Oe&&We<=U+Y+Oe||G(De,500)}}})})},50)}:void 0,onRemoveInstance:u.type==="adversary"?I=>{const P=u.instances.length===1;J.length>0&&(J[J.length-1].baseName,u.baseName),`${u.type}${u.baseName}`;const U=u.instances.sort((E,Y)=>{const Ee=E.duplicateNumber||1;return(Y.duplicateNumber||1)-Ee});if(U.length>0){const E=U[0];if(P){const Y=J.findIndex(Ee=>Ee.baseName===u.baseName&&Ee.type==="adversary");r({baseName:u.baseName,groupIndex:Y}),h(!1),requestAnimationFrame(()=>{requestAnimationFrame(()=>{H(E.id),requestAnimationFrame(()=>{requestAnimationFrame(()=>{h(!0),setTimeout(()=>{r(null),h(!1)},300)})})})})}else H(E.id)}}:void 0})},`${u.type}-${u.baseName}`))}),n&&!x.some(u=>(u==null?void 0:u.key)===`spacer-${n.baseName}`)){const u=Math.min(n.groupIndex,x.length);x.splice(u,0,e.jsx(lt,{style:{width:a?"0px":`${s+L}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:a?"0px":`${L}px`,paddingRight:"0",paddingTop:a?"0px":`${L}px`,paddingBottom:a?"0px":`${L}px`,scrollSnapAlign:"none",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"100%",opacity:0,transition:"width 0.3s ease, padding-left 0.3s ease, padding-top 0.3s ease, padding-bottom 0.3s ease"}},`spacer-${n.baseName}`))}return x})(),m!==null&&e.jsx("div",{style:{width:`${s+L}px`,flexShrink:0,flexGrow:0,flex:"none",height:"100%"}})]})]}),e.jsx(gr,{isOpen:te,onClose:k,onAddAdversary:x=>{W(x),ge("adversary")},onAddAdversariesBulk:x=>{g(x),ge("adversary")},onAddEnvironment:x=>{B(x),ge("environment")},onDeleteAdversary:H,onDeleteEnvironment:b,onDeleteCountdown:D,adversaries:t,environments:o,countdowns:c,savedEncounters:w,onSaveEncounter:O,onLoadEncounter:we,onDeleteEncounter:_}),e.jsx(fr,{})]})},Cr=()=>e.jsx(br,{children:e.jsx(wr,{})});ut.createRoot(document.getElementById("root")).render(e.jsx(Ve.StrictMode,{children:e.jsx(Zt,{children:e.jsx(Cr,{})})}));
