import{r as m,a as ot,R as $e}from"./dndkit-57209f9c.js";import{F as Et,f as Mt,a as Tt,b as zt,c as pt}from"./fa-b4bcccb0.js";import{D as bt,A as Rt,X as Ve,B as Wt,M as at,P as Ge,a as Lt,H as Nt,L as Bt,C as Pt,F as Dt,S as Ke,b as Xe}from"./lucide-d99afd1e.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const v of document.querySelectorAll('link[rel="modulepreload"]'))d(v);new MutationObserver(v=>{for(const p of v)if(p.type==="childList")for(const y of p.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&d(y)}).observe(document,{childList:!0,subtree:!0});function c(v){const p={};return v.integrity&&(p.integrity=v.integrity),v.referrerPolicy&&(p.referrerPolicy=v.referrerPolicy),v.crossOrigin==="use-credentials"?p.credentials="include":v.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function d(v){if(v.ep)return;v.ep=!0;const p=c(v);fetch(v.href,p)}})();var Ct={exports:{}},tt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ht=m,Ot=Symbol.for("react.element"),Ft=Symbol.for("react.fragment"),$t=Object.prototype.hasOwnProperty,_t=Ht.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,qt={key:!0,ref:!0,__self:!0,__source:!0};function wt(t,s,c){var d,v={},p=null,y=null;c!==void 0&&(p=""+c),s.key!==void 0&&(p=""+s.key),s.ref!==void 0&&(y=s.ref);for(d in s)$t.call(s,d)&&!qt.hasOwnProperty(d)&&(v[d]=s[d]);if(t&&t.defaultProps)for(d in s=t.defaultProps,s)v[d]===void 0&&(v[d]=s[d]);return{$$typeof:Ot,type:t,key:p,ref:y,props:v,_owner:_t.current}}tt.Fragment=Ft;tt.jsx=wt;tt.jsxs=wt;Ct.exports=tt;var e=Ct.exports,it={},ut=ot;it.createRoot=ut.createRoot,it.hydrateRoot=ut.hydrateRoot;function Oe(t){const s=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return t?`${t}-${s}`:s}const St=m.createContext();function rt(t){if(typeof localStorage>"u")return null;try{const s=localStorage.getItem(t);return s==null?null:JSON.parse(s)}catch{return null}}function Fe(t,s){if(!(typeof localStorage>"u"))try{localStorage.setItem(t,JSON.stringify(s))}catch{}}const Vt=({children:t})=>{const[s,c]=m.useState({fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],currentEncounterName:"Encounter"}),[d,v]=m.useState(!1),[p,y]=m.useState({adversaries:[],environments:[]});m.useEffect(()=>{var r,n,q,O;const i=rt("daggerheart-game-state");if(i)try{(((r=i.adversaries)==null?void 0:r.length)>0||((n=i.environments)==null?void 0:n.length)>0||((q=i.countdowns)==null?void 0:q.length)>0||((O=i.savedEncounters)==null?void 0:O.length)>0)&&c(i)}catch($){console.error("Failed to load saved state:",$)}const x=rt("daggerheart-custom-adversaries")||[],h=rt("daggerheart-custom-environments")||[];y({adversaries:x,environments:h}),v(!0)},[]),m.useEffect(()=>{Fe("daggerheart-game-state",s)},[s]);const W=i=>{c(x=>({...x,fear:{...x.fear,value:i}}))},f=()=>{c(i=>({...i,fear:{...i.fear,visible:!i.fear.visible}}))},M=i=>{c(x=>({...x,partySize:Math.max(1,i)}))},I=i=>{c(x=>({...x,currentEncounterName:i||"Encounter"}))},P=i=>{if(i.id)return c(x=>({...x,savedEncounters:(x.savedEncounters||[]).map(h=>h.id===i.id?{...h,name:i.name||h.name,encounterItems:i.encounterItems||h.encounterItems,partySize:i.partySize||h.partySize,battlePointsAdjustments:i.battlePointsAdjustments||h.battlePointsAdjustments,updatedAt:new Date().toISOString()}:h)})),i.id;{const x={id:Oe("encounter"),name:i.name||"Encounter",createdAt:new Date().toISOString(),encounterItems:i.encounterItems||[],partySize:i.partySize||4,battlePointsAdjustments:i.battlePointsAdjustments||{}};return c(h=>({...h,savedEncounters:[...h.savedEncounters||[],x]})),x.id}},_=i=>(s.savedEncounters||[]).find(h=>h.id===i),C=i=>{const x={id:Oe("encounter"),name:i.name||`Encounter ${Date.now()}`,createdAt:new Date().toISOString(),encounterItems:i.encounterItems||[],partySize:i.partySize||4,battlePointsAdjustments:i.battlePointsAdjustments||{}};return c(h=>({...h,savedEncounters:[...h.savedEncounters||[],x]})),x.id},ie=i=>{c(x=>({...x,savedEncounters:(x.savedEncounters||[]).filter(h=>h.id!==i)}))},xe=m.useRef(s);m.useEffect(()=>{xe.current=s},[s]);const be={gameState:s,isLoaded:d,customContent:p,updateFear:W,toggleFearVisibility:f,updatePartySize:M,updateCurrentEncounterName:I,saveEncounter:P,saveEncounterAs:C,loadEncounter:_,deleteEncounter:ie,createCountdown:i=>{const x={id:Oe("countdown"),name:i.name||"Countdown",max:parseInt(i.max)||1,value:0,visible:!0,type:i.type||"standard",loop:i.loop||"none",source:i.source||"campaign"};c(h=>({...h,countdowns:[...h.countdowns,x]}))},updateCountdown:(i,x)=>{c(h=>({...h,countdowns:h.countdowns.map(r=>r.id===i?{...r,...x}:r)}))},deleteCountdown:i=>{c(x=>({...x,countdowns:x.countdowns.filter(h=>h.id!==i)}))},advanceCountdown:(i,x)=>{c(h=>({...h,countdowns:h.countdowns.map(r=>{if(r.id!==i)return r;let n=x;if(r.loop==="loop")n>r.max?n=(n-1)%r.max+1:n<0&&(n=r.max);else if(r.loop==="increasing"){if(n>r.max)return{...r,max:r.max+1,value:1};if(n<0)return{...r,max:Math.max(1,r.max-1),value:1};n=Math.max(0,n)}else if(r.loop==="decreasing"){if(n>r.max)return{...r,max:Math.max(1,r.max-1),value:1};if(n<0)return{...r,max:r.max+1,value:1};n=Math.min(r.max,n)}else n=Math.max(0,Math.min(n,r.max));return{...r,value:n}})}))},incrementCountdown:(i,x=1)=>{c(h=>({...h,countdowns:h.countdowns.map(r=>{if(r.id!==i)return r;let n=r.value+x;if(r.loop==="loop")n>r.max&&(n=(n-1)%r.max+1);else if(r.loop==="increasing"){if(n>r.max)return{...r,max:r.max+1,value:1}}else if(r.loop==="decreasing"){if(n>r.max)return{...r,max:Math.max(1,r.max-1),value:1}}else n=Math.min(n,r.max);return{...r,value:n}})}))},decrementCountdown:i=>{c(x=>({...x,countdowns:x.countdowns.map(h=>{if(h.id!==i)return h;let r=h.value-1;if(h.loop==="loop")r<0&&(r=h.max);else if(h.loop==="increasing"){if(r<0)return{...h,max:Math.max(1,h.max-1),value:h.max};r=Math.max(0,r)}else if(h.loop==="decreasing"){if(r<0)return{...h,max:h.max+1,value:1}}else r=Math.max(0,r);return{...h,value:r}})}))},reorderCountdowns:i=>{c(x=>{const[h,r]=i,n=[...x.countdowns],[q]=n.splice(h,1);return n.splice(r,0,q),{...x,countdowns:n}})},createAdversary:i=>{var $;const x=Oe("adv"),h=s.adversaries||[],r=i.baseName||(($=i.name)==null?void 0:$.replace(/\s+\(\d+\)$/,""))||i.name||"Unknown",n=h.filter(U=>U.baseName===r);let q=1;if(n.length===0)q=1;else{const U=n.map(l=>l.duplicateNumber||1);let Ce=1;for(;U.includes(Ce);)Ce++;q=Ce}const O={...i,id:x,baseName:r,duplicateNumber:q,name:`${r} (${q})`,hp:0,stress:0,isVisible:!0};c(U=>({...U,adversaries:[...U.adversaries,O]}))},createAdversariesBulk:i=>{const x=[],h={};i.forEach(r=>{var S;const n=r.baseName||((S=r.name)==null?void 0:S.replace(/\s+\(\d+\)$/,""))||r.name||"Unknown",$=(s.adversaries||[]).filter(o=>o.baseName===n).length,U=h[n]||0,Ce=$+U+1;h[n]=U+1;const l={...r,id:Oe("adv"),baseName:n,duplicateNumber:Ce,name:`${n} (${Ce})`,hp:0,stress:0,isVisible:!0};x.push(l)}),c(r=>({...r,adversaries:[...r.adversaries,...x]}))},updateAdversary:(i,x)=>{c(h=>({...h,adversaries:h.adversaries.map(r=>{if(r.id===i){const n={...r,...x};if(x.baseName!==void 0){const q=x.baseName,O=n.duplicateNumber||1;n.name=O===1?q:`${q} (${O})`}return n}return r})}))},deleteAdversary:i=>{c(x=>({...x,adversaries:x.adversaries.filter(h=>h.id!==i)}))},clearAllAdversaries:()=>{c(i=>({...i,adversaries:[]}))},reorderAdversaries:i=>{c(x=>{const[h,r]=i,n=[...x.adversaries],[q]=n.splice(h,1);return n.splice(r,0,q),{...x,adversaries:n}})},bulkReorderAdversaries:i=>{c(x=>({...x,adversaries:i}))},createEnvironment:i=>{const x=Oe("env"),r=(s.environments||[]).filter(O=>O.name.replace(/\s+\(\d+\)$/,"")===i.name);let n=i.name||"Unknown";if(r.length===0)n=i.name;else if(r.length===1){const O=r[0],$=O.name.replace(/\s+\(\d+\)$/,""),U=s.environments.map(Ce=>Ce.id===O.id?{...Ce,name:`${$} (1)`}:Ce);c(Ce=>({...Ce,environments:U})),n=`${i.name} (2)`}else{const O=r.map(U=>{const Ce=U.name.match(/\((\d+)\)$/);return Ce?parseInt(Ce[1]):null}).filter(U=>U!==null);let $=1;for(;O.includes($);)$++;n=`${i.name} (${$})`}const q={...i,id:x,name:n,isVisible:!0};c(O=>({...O,environments:[...O.environments,q]}))},updateEnvironment:(i,x)=>{c(h=>({...h,environments:h.environments.map(r=>r.id===i?{...r,...x}:r)}))},deleteEnvironment:i=>{c(x=>({...x,environments:x.environments.filter(h=>h.id!==i)}))},reorderEnvironments:i=>{c(x=>{const[h,r]=i,n=[...x.environments],[q]=n.splice(h,1);return n.splice(r,0,q),{...x,environments:n}})},addCustomAdversary:i=>{const x={...i,id:Oe("custom-adv"),source:i.source||"Homebrew",isCustom:!0};return y(h=>({...h,adversaries:[...h.adversaries,x]})),Fe("daggerheart-custom-adversaries",[...p.adversaries,x]),x.id},addCustomEnvironment:i=>{const x={...i,id:Oe("custom-env"),source:i.source||"Homebrew",isCustom:!0};return y(h=>({...h,environments:[...h.environments,x]})),Fe("daggerheart-custom-environments",[...p.environments,x]),x.id},updateCustomAdversary:(i,x)=>{y(r=>({...r,adversaries:r.adversaries.map(n=>n.id===i?{...n,...x}:n)}));const h=p.adversaries.map(r=>r.id===i?{...r,...x}:r);Fe("daggerheart-custom-adversaries",h)},updateCustomEnvironment:(i,x)=>{y(r=>({...r,environments:r.environments.map(n=>n.id===i?{...n,...x}:n)}));const h=p.environments.map(r=>r.id===i?{...r,...x}:r);Fe("daggerheart-custom-environments",h)},deleteCustomAdversary:i=>{y(h=>({...h,adversaries:h.adversaries.filter(r=>r.id!==i)}));const x=p.adversaries.filter(h=>h.id!==i);Fe("daggerheart-custom-adversaries",x)},deleteCustomEnvironment:i=>{y(h=>({...h,environments:h.environments.filter(r=>r.id!==i)}));const x=p.environments.filter(h=>h.id!==i);Fe("daggerheart-custom-environments",x)}};return e.jsx(St.Provider,{value:be,children:t})},ct=()=>{const t=m.useContext(St);if(!t)return console.warn("useGameState: Context not available yet, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{gameState:s,customContent:c,...d}=t;if(!s)return console.warn("useGameState: gameState not available, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],customContent:{adversaries:[],environments:[]},updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},addCustomAdversary:()=>{},addCustomEnvironment:()=>{},updateCustomAdversary:()=>{},updateCustomEnvironment:()=>{},deleteCustomAdversary:()=>{},deleteCustomEnvironment:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{fear:v,countdowns:p,adversaries:y,environments:W,partySize:f,savedEncounters:M}=s;return{gameState:s,fear:v,countdowns:p,adversaries:y,environments:W,partySize:f,savedEncounters:M,customContent:c,...d,hasCountdowns:p.length>0,hasAdversaries:y.length>0,hasEnvironments:W.length>0,getCountdownById:I=>p.find(P=>P.id===I),getAdversaryById:I=>y.find(P=>P.id===I),getEnvironmentById:I=>W.find(P=>P.id===I)}},mt={fear:{icon:Mt,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"0.125rem",maxWidth:"none"},pipStyle:{fontSize:"var(--text-lg)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0,imageRendering:"crisp-edges"},filledColor:"var(--purple)",emptyColor:"var(--gray-dark)",tooltipTitle:"Click anywhere in header to adjust fear:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease fear by 1"},{text:"Right of boundary:",description:"Click to increase fear by 1"}]},hp:{icon:Tt,maxValue:20,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stress:{icon:zt,maxValue:12,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},countdown:{icon:pt,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust countdown:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease countdown by 1"},{text:"Right of boundary:",description:"Click to increase countdown by 1"}]},hpDots:{maxValue:20,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--red)",borderColor:"var(--red)",boxShadow:"0 0 4px rgba(239, 68, 68, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stressDots:{maxValue:12,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--purple)",borderColor:"var(--purple)",boxShadow:"0 0 4px rgba(139, 92, 246, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},adversaryHP:{icon:bt,maxValue:20,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust HP:",tooltipInstructions:[{text:"Filled pip:",description:"Click to heal (reduce damage)"},{text:"Empty pip:",description:"Click to take damage"}]},adversaryStress:{icon:Rt,maxValue:12,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust stress:",tooltipInstructions:[{text:"Filled pip:",description:"Click to reduce stress"},{text:"Empty pip:",description:"Click to increase stress"}]},countdownDistributed:{icon:pt,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Countdown progress:",tooltipInstructions:[{text:"Progress:",description:"Current countdown value"}]}},qe=({type:t="fear",value:s=0,maxValue:c,onChange:d,size:v="lg",showTooltip:p=!0,containerStyle:y={},pipStyle:W={},countdownType:f=null,distributedGroups:M=null,onPipClick:I=null,enableBoundaryClick:P=!1,clickContainerWidth:_="auto",centerPips:C=!0})=>{const[ie,xe]=m.useState(!1),G=mt[t]||mt.fear,Z=c||G.maxValue,te=Math.max(0,Math.min(Z,s));let ve=G.filledColor;t==="countdown"&&f&&(["progress","dynamic-progress","simple-hope"].includes(f)?ve="var(--gold)":["consequence","dynamic-consequence","simple-fear"].includes(f)?ve="var(--purple)":["long-term","standard"].includes(f)&&(ve="var(--text-secondary)"));const Q=(le,de)=>{if(I)I(le,de);else if(d){const g=le+1;d(g)}},Ae=le=>{if(!P||!d||I)return;le.currentTarget.getBoundingClientRect();const de=le.currentTarget.querySelector(".pip-container");if(!de)return;const g=de.getBoundingClientRect(),E=le.clientX-g.left;if(E<0){te>0&&d(te-1);return}if(E>g.width){te<Z&&d(te+1);return}const ge=g.width,w=ge*.05,D=ge-2*w,Se=E-w,Re=te/Z,ne=D*Re;Se<ne?te>0&&d(te-1):te<Z&&d(te+1)},Le=(()=>{if(!M||t!=="countdownDistributed")return[{start:0,end:Z,groupIndex:0}];let le=0;return M.map((de,g)=>{const E={start:le,end:le+de,groupIndex:g};return le+=de,E})})(),re=()=>e.jsxs(e.Fragment,{children:[Le.map(le=>e.jsx($e.Fragment,{children:[...Array(le.end-le.start)].map((de,g)=>{const E=le.start+g,ge=E<te;if(G.isDots)return e.jsx("div",{style:{...G.pipStyle,...ge?G.filledStyle:G.emptyStyle,...W,cursor:d||I?"pointer":"default"},onClick:P?void 0:()=>Q(E,ge),title:`${E+1} of ${Z}`},E);{const w=G.icon,D=w&&typeof w=="object"&&w.iconName,Se=ge?ve:G.emptyColor;return e.jsx("span",{className:`fear-pip ${ge?"filled":"empty"}`,style:{...G.pipStyle,color:Se,cursor:d||I?"pointer":"default",...W},onClick:P?void 0:()=>Q(E,ge),title:`${E+1} of ${Z}`,children:D?e.jsx(Et,{icon:w,size:v}):e.jsx(w,{size:v==="lg"?18:16})},E)}})},le.groupIndex)),p&&e.jsx("div",{style:{position:"relative",cursor:"help",pointerEvents:"none"},children:e.jsxs("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:ie?"translateX(-50%) translateY(-5px)":"translateX(-50%)",background:"rgba(15, 23, 42, 0.95)",border:"1px solid var(--gray)",borderRadius:"var(--radius-md)",padding:"var(--space-md)",minWidth:"250px",zIndex:1e3,opacity:ie?1:0,visibility:ie?"visible":"hidden",transition:"all 0.2s ease",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.5)"},children:[e.jsx("div",{style:{fontWeight:600,color:"var(--gray-200)",marginBottom:"0.75rem",fontSize:"var(--text-sm)"},children:G.tooltipTitle}),G.tooltipInstructions.map((le,de)=>e.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.8rem",color:"var(--gray-300)",lineHeight:1.4},children:[e.jsx("strong",{style:{color:"var(--gray-200)"},children:le.text})," ",le.description]},de))]})})]});return e.jsx("div",{style:{width:_,height:"100%",cursor:d||I?"pointer":"default",touchAction:"manipulation",userSelect:"none",display:C?"flex":"block",alignItems:C?"center":"stretch",justifyContent:C?"center":"flex-start",...y},onClick:le=>{le.stopPropagation(),le.preventDefault(),P&&Ae(le)},onMouseEnter:()=>xe(p),onMouseLeave:()=>xe(!1),children:e.jsx("div",{className:"pip-container",style:{...G.containerStyle,width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},children:re()})})},Gt=({onToggle:t,isOpen:s})=>{const d={position:"fixed",bottom:window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://")?"calc(60px + env(safe-area-inset-bottom) + 2rem)":"calc(60px + env(safe-area-inset-bottom) + 1rem)",right:"1rem",zIndex:1100,width:"56px",height:"56px",borderRadius:"50%",background:s?"var(--red)":"var(--bg-secondary)",border:"2px solid var(--border)",color:s?"white":"var(--text-primary)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"all 0.2s ease"};return e.jsx("button",{onClick:t,style:d,title:s?"Close Encounter Builder":"Open Encounter Builder",onMouseEnter:v=>{s||(v.currentTarget.style.background="var(--purple)",v.currentTarget.style.color="white")},onMouseLeave:v=>{s||(v.currentTarget.style.background="var(--bg-secondary)",v.currentTarget.style.color="var(--text-primary)")},children:s?e.jsx(Ve,{size:24}):e.jsx(Wt,{size:24})})},Yt=({position:t="top",children:s,onClick:c,className:d="",style:v={}})=>{const p=t==="top",y=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://"),W={background:"var(--bg-primary)",borderTop:p?"none":"1px solid var(--border)",borderBottom:p?"1px solid var(--border)":"none",padding:p?"0.25rem 0":"0.5rem",paddingBottom:p?"0.25rem":y?"calc(0.5rem + env(safe-area-inset-bottom) + 1rem)":"calc(0.5rem + env(safe-area-inset-bottom))",position:p?"relative":"sticky",[p?"top":"bottom"]:0,zIndex:p?10:100,order:p?1:3,flexShrink:0,touchAction:"manipulation",userSelect:"none",display:"flex",flexDirection:p?"column":"row",justifyContent:p?"stretch":"center",alignItems:p?"stretch":"center",gap:p?"0":"1rem",height:p?"auto":"60px",...v};return e.jsx("div",{className:d,style:W,onClick:c,children:s})},Jt="modulepreload",Kt=function(t){return"/Daggerheart/"+t},ft={},_e=function(s,c,d){if(!c||c.length===0)return s();const v=document.getElementsByTagName("link");return Promise.all(c.map(p=>{if(p=Kt(p),p in ft)return;ft[p]=!0;const y=p.endsWith(".css"),W=y?'[rel="stylesheet"]':"";if(!!d)for(let I=v.length-1;I>=0;I--){const P=v[I];if(P.href===p&&(!y||P.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${p}"]${W}`))return;const M=document.createElement("link");if(M.rel=y?"stylesheet":Jt,y||(M.as="script",M.crossOrigin=""),M.href=p,document.head.appendChild(M),y)return new Promise((I,P)=>{M.addEventListener("load",I),M.addEventListener("error",()=>P(new Error(`Unable to preload CSS for ${p}`)))})})).then(()=>s()).catch(p=>{const y=new Event("vite:preloadError",{cancelable:!0});if(y.payload=p,window.dispatchEvent(y),!y.defaultPrevented)throw p})},ht={Minion:{difficulty:t=>[9,12,15,18][t-1],thresholds:t=>({major:0,severe:0}),hpMax:t=>1,stressMax:t=>1,atk:t=>[-1,0,1,2][t-1],damage:t=>["2","5","8","11"][t-1],range:"Melee"},Standard:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[7,10,20,25][t-1],severe:[12,20,32,45][t-1]}),hpMax:t=>[4,5,6,7][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[1,2,3,4][t-1],damage:t=>["1d8+1","2d8+2","3d8+3","4d8+4"][t-1],range:"Melee"},Bruiser:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[8,14,22,38][t-1],severe:[15,28,40,70][t-1]}),hpMax:t=>[6,7,8,9][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[-1,0,1,2][t-1],damage:t=>["1d12+2","2d12+4","3d12+6","4d12+8"][t-1],range:"Melee"},Horde:{difficulty:t=>[10,13,16,19][t-1],thresholds:t=>({major:[7,10,20,25][t-1],severe:[12,20,32,45][t-1]}),hpMax:t=>[5,6,7,8][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[-1,0,1,2][t-1],damage:t=>["1d8+2","2d8+4","3d8+6","4d8+8"][t-1],range:"Melee"},Leader:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[7,13,21,35][t-1],severe:[14,26,38,65][t-1]}),hpMax:t=>[5,6,7,8][t-1],stressMax:t=>[5,5,6,6][t-1],atk:t=>[2,4,6,8][t-1],damage:t=>["1d10+2","2d10+4","3d10+6","4d10+8"][t-1],range:"Melee"},Ranged:{difficulty:t=>[10,13,16,19][t-1],thresholds:t=>({major:[4,8,18,22][t-1],severe:[7,16,30,42][t-1]}),hpMax:t=>[3,4,5,6][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d8+2","2d8+4","3d8+6","4d8+8"][t-1],range:"Close"},Skulk:{difficulty:t=>[12,15,18,21][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,5,6,7][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d6+2","2d6+4","3d6+6","4d6+8"][t-1],range:"Melee"},Solo:{difficulty:t=>[12,15,18,21][t-1],thresholds:t=>({major:[7,13,21,35][t-1],severe:[14,26,38,65][t-1]}),hpMax:t=>[8,9,10,11][t-1],stressMax:t=>[5,5,6,6][t-1],atk:t=>[3,5,7,9][t-1],damage:t=>["1d10+3","2d10+6","3d10+9","4d10+12"][t-1],range:"Melee"},Support:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,4,5,5][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d4+2","2d4+4","3d4+6","4d4+8"][t-1],range:"Melee"},Social:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,4,5,5][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d4+2","2d4+4","3d4+6","4d4+8"][t-1],range:"Melee"}},Ze=(t,s)=>{const c=ht[s]||ht.Standard;return{difficulty:c.difficulty(t),thresholds:c.thresholds(t),hpMax:c.hpMax(t),stressMax:c.stressMax(t),atk:c.atk(t),damage:c.damage(t),range:c.range}};let jt={adversaries:[]},xt=!1;const Xt=()=>({customAdversaries:JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]")}),Zt=async()=>{if(xt)return;let t={adversaries:[]},s={adversaries:[]};try{const d=await _e(()=>import("./adversaries-9c8932de.js"),[]);t=(d==null?void 0:d.default)||d}catch(d){console.warn("Failed to load adversaries.json:",d)}try{const d=await _e(()=>import("./playtest-adversaries-4a099c10.js"),[]);s=(d==null?void 0:d.default)||d}catch(d){console.warn("Failed to load playtest-adversaries.json:",d)}const{customAdversaries:c}=Xt();jt={...t,adversaries:[...t.adversaries||[],...s.adversaries||[],...c]},xt=!0},kt=({onSave:t,onRefresh:s,onAddItem:c,editingAdversary:d,onCancelEdit:v,isStockAdversary:p=!1,autoFocus:y=!1,allAdversaries:W=[],embedded:f=!1})=>{const M=m.useRef(null),[I,P]=m.useState(()=>{const g=Ze(1,"Standard");return{name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:g.difficulty,thresholds:g.thresholds,hpMax:g.hpMax,stressMax:g.stressMax,atk:g.atk,weapon:"",range:g.range,damage:g.damage,experience:[],features:[]}}),[_,C]=m.useState(!1),[ie,xe]=m.useState(!1),[G,Z]=m.useState([]),[te,ve]=m.useState(!1),[Q,Ae]=m.useState([]);m.useEffect(()=>{(async()=>{await Zt(),W.length>0?Ae(W):Ae(jt.adversaries||[])})()},[W]),m.useEffect(()=>{y&&M.current&&setTimeout(()=>{var g;(g=M.current)==null||g.focus()},100)},[y]),m.useEffect(()=>{if(d)P({name:d.name||"",tier:d.tier||1,type:d.type||"Standard",description:d.description||"",motives:d.motives||"",difficulty:d.difficulty||11,thresholds:d.thresholds||{major:7,severe:12},hpMax:d.hpMax||3,stressMax:d.stressMax||1,atk:d.atk||1,weapon:d.weapon||"",range:d.range||"Melee",damage:d.damage||"",experience:d.experience||[],features:d.features||[]}),xe(!1);else{const g=Ze(1,"Standard");P({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:g.difficulty,thresholds:g.thresholds,hpMax:g.hpMax,stressMax:g.stressMax,atk:g.atk,weapon:"",range:g.range,damage:g.damage,experience:[],features:[]}),xe(!1)}},[d]),m.useEffect(()=>{if(!d&&!ie){const g=Ze(I.tier,I.type);P(E=>({...E,difficulty:g.difficulty,thresholds:g.thresholds,hpMax:g.hpMax,stressMax:g.stressMax,atk:g.atk,range:g.range,damage:g.damage}))}},[I.tier,I.type,d,ie]);const ze=g=>{if(P(E=>({...E,name:g})),g.trim().length>0){const E=Q.filter(ge=>{var D;return(((D=ge.name)==null?void 0:D.replace(/\s+\(\d+\)$/,""))||ge.name||"").toLowerCase().includes(g.toLowerCase())}).slice(0,5);Z(E),ve(E.length>0)}else Z([]),ve(!1)},Le=g=>{var ge,w;const E=((ge=g.name)==null?void 0:ge.replace(/\s+\(\d+\)$/,""))||g.name||"";P(D=>({...D,name:E,tier:g.tier||D.tier,type:g.type||D.type,description:g.description||D.description,motives:g.motives||D.motives,difficulty:g.difficulty||D.difficulty,thresholds:g.thresholds||D.thresholds,hpMax:g.hpMax||D.hpMax,stressMax:g.stressMax||D.stressMax,atk:g.atk!==void 0?g.atk:D.atk,weapon:g.weapon||D.weapon,range:g.range||D.range,damage:g.damage||D.damage,experience:g.experience||D.experience,features:g.features?[...g.features]:D.features})),xe(!0),Z([]),ve(!1),(w=M.current)==null||w.focus()},re=async()=>{if(!I.name.trim()){alert("Please enter a name for the adversary");return}C(!0);try{const g={...I,hp:d?d.hp:0,stress:d?d.stress:0,source:"Homebrew"};if(d)p?(await t(g),alert("Custom adversary created successfully!")):(g.id=d.id,await t(g,d.id),alert("Adversary updated successfully!")),v&&v();else{await t(g),s&&await s();const E=Ze(1,"Standard");P({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:E.difficulty,thresholds:E.thresholds,hpMax:E.hpMax,stressMax:E.stressMax,atk:E.atk,weapon:"",range:E.range,damage:E.damage,experience:[],features:[]}),xe(!1),alert("Custom adversary created successfully!")}}catch(g){console.error("Error saving adversary:",g),alert("Error saving adversary. Please try again.")}finally{C(!1)}},le={...I,id:"new-adversary",hp:0,stress:0,source:"Homebrew"},de=()=>_?d?p?"Creating...":"Saving...":"Creating...":d?p?"Save As Custom":"Save":"Create";return e.jsx("div",{style:{flex:1,overflowY:"auto",padding:f?"0.5rem":"1rem",display:"flex",justifyContent:"center",alignItems:"flex-start",height:"100%"},children:e.jsxs("div",{style:{maxWidth:f?"100%":"600px",width:"100%"},children:[!f&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h2",{style:{color:"var(--text-primary)",fontSize:"1.5rem",fontWeight:"600",margin:0},children:d?p?"Edit Adversary (Save As Custom)":"Edit Custom Adversary":"Create Custom Adversary"}),e.jsx("button",{onClick:re,disabled:_||!I.name.trim(),style:{padding:"0.75rem 1.5rem",backgroundColor:_||!I.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"8px",cursor:_||!I.name.trim()?"not-allowed":"pointer",fontSize:"1rem",fontWeight:"600",opacity:_||!I.name.trim()?.6:1},children:de()})]}),f&&e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",marginBottom:"0.5rem",padding:"0.5rem",borderBottom:"1px solid var(--border)"},children:[e.jsx("button",{onClick:re,disabled:_||!I.name.trim(),style:{padding:"0.5rem 1rem",backgroundColor:_||!I.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"6px",cursor:_||!I.name.trim()?"not-allowed":"pointer",fontSize:"0.875rem",fontWeight:"600",opacity:_||!I.name.trim()?.6:1,marginRight:"0.5rem"},children:de()}),v&&e.jsx("button",{onClick:v,style:{padding:"0.5rem 1rem",backgroundColor:"transparent",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"6px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600"},children:"Cancel"})]}),!d&&e.jsxs("div",{style:{position:"relative",marginBottom:"1rem"},children:[e.jsx("input",{ref:M,type:"text",value:I.name,onChange:g=>ze(g.target.value),placeholder:"Type adversary name to pull stats, or enter type/tier manually",style:{width:"100%",padding:"0.75rem",fontSize:"1rem",border:"1px solid var(--border)",borderRadius:"8px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",outline:"none"},onBlur:()=>{setTimeout(()=>ve(!1),200)}}),te&&G.length>0&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"var(--bg-card)",border:"1px solid var(--border)",borderRadius:"8px",marginTop:"4px",maxHeight:"200px",overflowY:"auto",zIndex:1e3,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)"},children:G.map((g,E)=>{var w;const ge=((w=g.name)==null?void 0:w.replace(/\s+\(\d+\)$/,""))||g.name||"Unknown";return e.jsxs("div",{onClick:()=>Le(g),style:{padding:"0.75rem",cursor:"pointer",borderBottom:E<G.length-1?"1px solid var(--border)":"none",color:"var(--text-primary)"},onMouseDown:D=>D.preventDefault(),children:[e.jsx("div",{style:{fontWeight:"600"},children:ge}),e.jsxs("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",marginTop:"2px"},children:[g.type," • Tier ",g.tier]})]},g.id||E)})})]}),e.jsx(et,{item:le,type:"adversary",mode:"edit",onUpdate:(g,E)=>{P(ge=>({...ge,...E}))}})]})})},gt=({value:t})=>e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"44px",height:"32px",zIndex:3},children:[e.jsx("svg",{width:"40",height:"32",viewBox:"0 0 40 32",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",style:{position:"absolute",zIndex:1},children:e.jsx("path",{d:"M2 2h28l6 14-6 14H2l6-14-6-14z"})}),e.jsx("span",{style:{position:"absolute",fontSize:"0.8rem",fontWeight:500,color:"var(--text-primary)",textAlign:"center",zIndex:2,left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:t})]}),Qt=({type:t,tier:s,isEditMode:c,onUpdate:d,itemId:v})=>{const y=(P=>{if(!P)return 0;const C=document.createElement("canvas").getContext("2d");return C.font="600 11px system-ui, -apple-system, sans-serif",C.measureText(P.toUpperCase()).width})(t),W=4,f=18,M=Math.max(50,y+W+f),I=M+15;return c?e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",gap:"8px",height:"32px"},children:[e.jsxs("select",{value:t||"",onChange:P=>{d&&d(v,{type:P.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",outline:"none",borderRadius:"4px",padding:"4px 8px",width:"95px",height:"24px"},children:[e.jsx("option",{value:"Standard",children:"Standard"}),e.jsx("option",{value:"Solo",children:"Solo"}),e.jsx("option",{value:"Bruiser",children:"Bruiser"}),e.jsx("option",{value:"Horde",children:"Horde"}),e.jsx("option",{value:"Minion",children:"Minion"}),e.jsx("option",{value:"Ranged",children:"Ranged"}),e.jsx("option",{value:"Leader",children:"Leader"}),e.jsx("option",{value:"Skulk",children:"Skulk"}),e.jsx("option",{value:"Social",children:"Social"}),e.jsx("option",{value:"Support",children:"Support"})]}),e.jsxs("div",{style:{position:"relative",width:"24px",height:"24px"},children:[e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",width:"20px",height:"20px",backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",borderRadius:"2px"}}),e.jsx("input",{type:"text",value:s||"",onChange:P=>{const _=P.target.value.replace(/[^1-4]/g,"");_.length<=1&&d&&d(v,{tier:_===""?"":parseInt(_)})},onKeyDown:P=>{if(P.key==="ArrowUp"){P.preventDefault();const _=parseInt(s)||1;d&&d(v,{tier:Math.min(_+1,4)})}else if(P.key==="ArrowDown"){P.preventDefault();const _=parseInt(s)||1;d&&d(v,{tier:Math.max(_-1,1)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"transparent",border:"none",color:"var(--text-primary)",fontSize:"0.8rem",fontWeight:600,width:"24px",height:"24px",textAlign:"center",outline:"none",zIndex:1},maxLength:"1"})]})]}):e.jsxs("div",{style:{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"center",height:"32px",width:`${I}px`},children:[e.jsxs("svg",{width:I,height:"32",viewBox:`0 0 ${I} 32`,style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1},children:[e.jsx("rect",{x:"1",y:"6",width:M-1,height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4",ry:"4"}),e.jsx("rect",{x:M-10,y:"6",width:"20",height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"2",ry:"2",transform:`rotate(45 ${M-1} 16)`})]}),e.jsx("span",{style:{position:"absolute",top:"50%",left:"4px",transform:"translateY(-50%)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",color:"var(--text-primary)",zIndex:2,pointerEvents:"none"},children:t}),e.jsx("span",{style:{position:"absolute",top:"50%",left:`${M-.5}px`,transform:"translate(-50%, -50%)",fontSize:"0.8rem",fontWeight:600,color:"white",zIndex:2,pointerEvents:"none",textAlign:"center",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",width:"20px",height:"20px"},children:s})]})},nt=({feature:t,featureType:s,item:c,onUpdate:d,handleFeatureDeleteClick:v,deleteConfirmations:p,getFeatureKey:y})=>{var P,_;const W=()=>{try{const ie=[...(c==null?void 0:c.features)||[]],xe=ie.filter(Z=>Z.type===s),G=xe.findIndex(Z=>Z===t);if(G>0&&G<xe.length){const Z=xe[G],te=xe[G-1];if(Z&&te){const ve=ie.findIndex(Ae=>Ae===Z),Q=ie.findIndex(Ae=>Ae===te);ve>=0&&Q>=0&&(ie[ve]=te,ie[Q]=Z,d&&d(c.id,{features:ie}))}}}catch(C){console.error(`Error in ${s.toLowerCase()} up button:`,C)}},f=()=>{try{const ie=[...(c==null?void 0:c.features)||[]],xe=ie.filter(Z=>Z.type===s),G=xe.findIndex(Z=>Z===t);if(G<xe.length-1&&G>=0){const Z=xe[G],te=xe[G+1];if(Z&&te){const ve=ie.findIndex(Ae=>Ae===Z),Q=ie.findIndex(Ae=>Ae===te);ve>=0&&Q>=0&&(ie[ve]=te,ie[Q]=Z,d&&d(c.id,{features:ie}))}}}catch(C){console.error(`Error in ${s.toLowerCase()} down button:`,C)}},M=C=>C.type===s,I=C=>C.type===s&&C.name.trim();return e.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",alignSelf:"stretch"},children:[e.jsx("button",{onClick:W,disabled:(c.features||[]).filter(M).findIndex(C=>C===t)===0,tabIndex:"-1",style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(c.features||[]).filter(I).length>=2&&(c.features||[]).filter(M).findIndex(C=>C===t)!==0&&t.name.trim()?"white":"var(--text-secondary)",cursor:(c.features||[]).filter(I).length>=2&&(c.features||[]).filter(M).findIndex(C=>C===t)!==0&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↑"}),e.jsx("button",{onClick:()=>v(t),disabled:!t.name.trim()&&!t.description.trim(),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:p[y(t)]?"var(--danger)":"var(--gray-700)",color:!t.name.trim()&&!t.description.trim()?"var(--text-secondary)":"white",cursor:!t.name.trim()&&!t.description.trim()?"not-allowed":"pointer",opacity:!t.name.trim()&&!t.description.trim()?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"×"}),e.jsx("button",{onClick:f,disabled:(c.features||[]).filter(M).findIndex(C=>C===t)===(c.features||[]).filter(M).length-1,style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(c.features||[]).filter(I).length>=2&&(c.features||[]).filter(M).findIndex(C=>C===t)<(c.features||[]).filter(M).length-1&&((P=(c.features||[]).filter(M)[(c.features||[]).filter(M).findIndex(C=>C===t)+1])!=null&&P.name.trim())&&t.name.trim()?"white":"var(--text-secondary)",cursor:(c.features||[]).filter(I).length>=2&&(c.features||[]).filter(M).findIndex(C=>C===t)<(c.features||[]).filter(M).length-1&&((_=(c.features||[]).filter(M)[(c.features||[]).filter(M).findIndex(C=>C===t)+1])!=null&&_.name.trim())&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↓"})]})},Ne={transitions:{hoverIn:"all 0.1s ease",hoverOut:"all 0.3s ease"},card:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"8px",cursor:"pointer",transition:"all 0.1s ease",position:"relative"},cardHover:{backgroundColor:"var(--bg-card-hover)"},cardDead:{opacity:.6,backgroundColor:"var(--gray-800)",borderColor:"var(--border)"},cardAtMax:{backgroundColor:"var(--success)",borderColor:"var(--success)"},rowMain:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},rowTitle:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",margin:0},rowMeta:{display:"flex",gap:"8px",alignItems:"center"},badge:{padding:"2px 6px",borderRadius:"3px",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},typeBadge:{backgroundColor:"var(--purple)",color:"var(--text-primary)"},tierBadge:{backgroundColor:"var(--info)",color:"var(--text-primary)"},damageInputPopup:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,borderRadius:"8px"},damageInputContent:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"8px",padding:"8px",display:"flex",flexDirection:"row",gap:"8px",minWidth:"200px",alignItems:"center",position:"absolute",right:"1rem",top:"50%",transform:"translateY(-50%)"},damageInput:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"4px",padding:"4px 6px",color:"var(--text-primary)",fontSize:"16px",width:"80px",textAlign:"center"},damageIndicators:{display:"flex",gap:"8px",alignItems:"center",justifyContent:"center"},damageDrop:{fontSize:"16px",color:"var(--text-secondary)",cursor:"pointer",transition:"color 0.1s ease"},applyButton:{backgroundColor:"var(--gray-600)",color:"white",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"32px",minHeight:"32px"}},Ut=(t,s,c,d)=>{const[v,p]=m.useState(!1),[y,W]=m.useState("");m.useEffect(()=>{if(v){const C=ie=>{ie.target.closest(".damage-input-popup")||(p(!1),W(""))};return document.addEventListener("click",C),()=>document.removeEventListener("click",C)}},[v]);const f=C=>{C.stopPropagation(),C.preventDefault();const ie=t.hp||0,xe=t.hpMax||1,G=C.currentTarget.getBoundingClientRect(),Z=C.clientX-G.left,te=G.width/xe;Math.floor(Z/te)<ie?c&&c(t.id,1,t.hp):s&&s(t.id,1,t.hp,t.hpMax)},M=C=>{C.stopPropagation(),C.preventDefault();const ie=t.stress||0,xe=t.stressMax||1,G=C.currentTarget.getBoundingClientRect(),Z=C.clientX-G.left,te=G.width/xe;Math.floor(Z/te)<ie?d&&d(t.id,-1,t.stress,t.stressMax):d&&d(t.id,1,t.stress,t.stressMax)},I=C=>{C.stopPropagation(),(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")&&(p(!0),W(t.type==="Minion"?"1":""))},P=()=>{const C=parseInt(y);if(C>0){if(t.type==="Minion")s&&s(t.id,C,t.hp,t.hpMax);else{let ie=0;C>=t.thresholds.severe?ie=3:C>=t.thresholds.major?ie=2:C>=1&&(ie=1),s&&s(t.id,ie,t.hp,t.hpMax)}p(!1),W("")}};return{showDamageInput:v,damageValue:y,setDamageValue:W,setShowDamageInput:p,handleHpClick:f,handleStressClick:M,handleDifficultyClick:I,applyDamage:P,handleKeyDown:C=>{C.key==="Enter"?P():C.key==="Escape"&&(p(!1),W(""))}}},et=({item:t,type:s,mode:c="expanded",onClick:d,onDelete:v,onApplyDamage:p,onApplyHealing:y,onApplyStressChange:W,onUpdate:f,adversaries:M=[],isSelected:I=!1,isEditMode:P=!1,instances:_=[],isEmbedded:C=!1,showAddRemoveButtons:ie=!1,onAddInstance:xe=null,onRemoveInstance:G=null,onEdit:Z=null,showCustomCreator:te=!1,onSaveCustomAdversary:ve=null,onCancelEdit:Q=null,isStockAdversary:Ae=!1})=>{const ze=m.useRef(null),Le=m.useRef(_.length),re=m.useRef(null),le=m.useRef(null),de=m.useRef(null),g=m.useRef(null),[E,ge]=m.useState(0);m.useEffect(()=>{const r=ze.current;if(!r)return;const n=()=>{re.current=r.scrollHeight,le.current=r.scrollTop};r.addEventListener("scroll",n,{passive:!0});const q=setInterval(n,100);return()=>{r.removeEventListener("scroll",n),clearInterval(q)}},[]),m.useEffect(()=>()=>{ze.current&&(re.current=ze.current.scrollHeight,le.current=ze.current.scrollTop)},[_.length,_]);const[w,D]=m.useState({});m.useLayoutEffect(()=>{const r=_.length,n=Le.current;if(r!==n&&ze.current){const q=re.current,O=le.current;if(!q||O===null){Le.current=r;return}const $=ze.current,U=$.scrollHeight,Ce=$.clientHeight;if(r<n){const l=q-Ce;if(O>=l-10&&U>Ce){de.current&&(cancelAnimationFrame(de.current),de.current=null);const o=E,J=q-o-U;ge(o+J),requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!$)return;$.scrollTop=O,$.offsetHeight;const k=U-Ce,K=$.scrollTop,we=k-K;if(Math.abs(we)>.5){const he=performance.now(),u=K,A=F=>{if(!$){de.current=null;return}const se=F-he,X=Math.min(se/400,1),ye=1-X,me=1-ye*ye*ye,ue=k,oe=ue-u,b=u+oe*me;$.scrollTop=b,X<1?de.current=requestAnimationFrame(A):($.scrollTop=ue,de.current=null,ge(0))};de.current=requestAnimationFrame(A)}else ge(0)})})}}else if(r>n){const l=U-Ce,S=$.scrollTop,o=l-S;if(Math.abs(o)>.5){de.current&&(cancelAnimationFrame(de.current),de.current=null);const j=400,J=performance.now(),k=K=>{if(!$){de.current=null;return}const we=K-J,Me=Math.min(we/j,1),he=1-Me,u=1-he*he*he,A=S+o*u;$.scrollTop=A,Me<1?de.current=requestAnimationFrame(k):($.scrollTop=l,de.current=null)};de.current=requestAnimationFrame(k)}}Le.current=r}else Le.current=r},[_.length,_]);const Se=r=>{const q=(t.features||[]).filter(O=>O.type===r.type).findIndex(O=>O===r);return`${r.type}-${q}-${r.name||"blank"}`},Re=(r,n)=>`experience-${n}-${typeof r=="string"?r:r.name||"blank"}`,ne=r=>{const n=Se(r);if(w[n]){const q=t.features.filter(O=>O!==r);f&&f(t.id,{features:q}),D(O=>{const $={...O};return delete $[n],$})}else D(q=>({...q,[n]:!0})),setTimeout(()=>{D(q=>{const O={...q};return delete O[n],O})},3e3)},ce=(r,n)=>{const q=Re(r,n);if(w[q]){const O=[...t.experience||[]];O.splice(n,1),f&&f(t.id,{experience:O}),D($=>{const U={...$};return delete U[q],U})}else D(O=>({...O,[q]:!0})),setTimeout(()=>{D(O=>{const $={...O};return delete $[q],$})},3e3)},Y=Ut(t,p,y,W);(s==="adversary"||s==="adversaries")&&Y.handleDifficultyClick;const je=(r=!1)=>{let n={...Ne.card};if(I?n.transition="none":n.transition=Ne.transitions.hoverOut,r){const{marginTop:q,...O}=n;n=O}return I&&(n={...n,...Ne.cardHover}),s==="adversary"&&(t.hp||0)>=(t.hpMax||1)&&(n={...n,...Ne.cardDead}),n},Te=()=>{if(C)return"";let r="border rounded-lg";return I&&(r+=" border-hover"),r},We=()=>{var r;if(s==="adversary"||s==="adversaries"){const n=t.baseName||((r=t.name)==null?void 0:r.replace(/\s+\(\d+\)$/,""))||"",q=t.duplicateNumber||1,O=[...M];return M.some(Ce=>Ce.id===t.id)||O.push(t),O.filter(Ce=>Ce.baseName===n).length>1?`${n} (${q})`:n}return t.name},be=()=>{const r=[];return t.type&&r.push(e.jsx("span",{style:{...Ne.badge,...Ne.typeBadge},children:t.type},"type")),r},i=()=>s!=="adversary"||!Y.showDamageInput||!(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")?null:e.jsx("div",{className:"damage-input-popup",style:Ne.damageInputPopup,onClick:r=>{r.stopPropagation(),r.target===r.currentTarget&&(s==="adversary"||s==="adversaries")&&(Y.setShowDamageInput(!1),Y.setDamageValue(""))},children:e.jsxs("div",{className:"border rounded-lg",style:{...Ne.damageInputContent,borderColor:"var(--border)"},onClick:r=>r.stopPropagation(),children:[e.jsx("input",{type:"number",inputMode:"numeric",enterKeyHint:"done",placeholder:"dmg",min:(t.type==="Minion","0"),value:s==="adversary"||s==="adversaries"?Y.damageValue:"",onChange:r=>{(s==="adversary"||s==="adversaries")&&Y.setDamageValue(r.target.value)},onKeyDown:s==="adversary"||s==="adversaries"?Y.handleKeyDown:void 0,className:"border rounded-sm",style:{...Ne.damageInput,borderColor:"var(--border)"},autoFocus:!0}),e.jsxs("div",{style:Ne.damageIndicators,children:[t.type==="Minion"?(()=>{var $,U;const r=parseInt(s==="adversary"||s==="adversaries"?Y.damageValue:"0")||0,n=($=t.features)==null?void 0:$.find(Ce=>{var l;return(l=Ce.name)==null?void 0:l.startsWith("Minion (")}),q=n?parseInt(((U=n.name.match(/\((\d+)\)/))==null?void 0:U[1])||"1"):1,O=Math.floor(r/q);return r>=q&&O>0?e.jsxs("span",{style:{...Ne.damageDrop,color:"var(--red)"},title:`${r} damage can defeat ${O+1} minion${O+1!==1?"s":""} (1 + ${O} additional)`,children:["+",O," additional minion(s)"]}):e.jsx("span",{style:Ne.damageDrop,title:`${r} damage defeats this minion only`,children:"+0 additional minion(s)"})})():[1,2,3].map(r=>{const n=parseInt(s==="adversary"||s==="adversaries"?Y.damageValue:"0")||0;let q=!1;return r===1&&n>=1&&(q=!0),r===2&&n>=t.thresholds.major&&(q=!0),r===3&&n>=t.thresholds.severe&&(q=!0),e.jsx("span",{style:{...Ne.damageDrop,color:q?"var(--red)":"var(--text-secondary)"},onClick:O=>{O.stopPropagation(),(s==="adversary"||s==="adversaries")&&(r===1?Y.setDamageValue("1"):r===2?Y.setDamageValue(t.thresholds.major.toString()):r===3&&Y.setDamageValue(t.thresholds.severe.toString()))},title:`Click to set damage to ${r===1?"1":r===2?t.thresholds.major:t.thresholds.severe}`,children:e.jsx(bt,{size:16})},r)}),e.jsx("button",{style:{...Ne.applyButton,backgroundColor:"var(--gray-600)"},onClick:r=>{r.stopPropagation(),(s==="adversary"||s==="adversaries")&&(!Y.damageValue||parseInt(Y.damageValue)<1?(Y.setShowDamageInput(!1),Y.setDamageValue("")):Y.applyDamage())},title:!Y.damageValue||parseInt(Y.damageValue)<1?"Close damage input":"Apply damage",children:!Y.damageValue||parseInt(Y.damageValue)<1?e.jsx(Ve,{size:16}):e.jsx(Pt,{size:16})})]})]})}),x=()=>{var q,O,$,U,Ce;const r=(t.hp||0)>=(t.hpMax||1),n=c==="edit";return e.jsxs("div",{className:Te(),style:{...je(!0),padding:0,opacity:r?.7:1,backgroundColor:r?"var(--gray-900)":je(!0).backgroundColor,borderColor:r?"color-mix(in srgb, var(--gray-600) 40%, transparent)":I?"var(--purple)":"var(--border)",borderWidth:"2px",display:"flex",flexDirection:"column",position:"relative",height:"auto",minHeight:0,overflow:"hidden"},onClick:d,children:[r&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                45deg,
                transparent,
                transparent 8px,
                var(--gray-600) 1px,
                var(--gray-600) 9px
              )`,pointerEvents:"none",zIndex:9999}})}),e.jsx("div",{className:"border-b",style:{padding:"8px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative",zIndex:r?1:"auto",borderBottomColor:I?"var(--purple)":"var(--border)"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",position:"relative",zIndex:r?1:"auto",padding:"2px",minHeight:"40px"},children:[n?e.jsx("input",{type:"text",value:t.name||"",onChange:l=>{f&&f(t.id,{name:l.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"4px",color:"var(--text-primary)",fontSize:"1.1rem",fontWeight:"600",padding:"0.5rem",width:"100%",maxWidth:"300px",paddingRight:"0.625rem"},placeholder:"Name"}):e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flex:1},children:[e.jsx("h4",{style:{...Ne.rowTitle,color:r?"color-mix(in srgb, var(--gray-400) 80%, transparent)":Ne.rowTitle.color,textAlign:"left",margin:0,fontSize:"1.1rem",paddingRight:"6px",flex:1},children:((q=t.name)==null?void 0:q.replace(/\s+\(\d+\)$/,""))||t.name}),ie&&s==="adversary"&&!n&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",flexShrink:0},children:[e.jsx("button",{onClick:l=>{l.stopPropagation(),G&&G(t.id)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"20px",height:"20px",fontSize:"0.7rem",transition:"all 0.2s ease"},onMouseEnter:l=>{l.target.style.backgroundColor="var(--bg-hover)",l.target.style.borderColor="var(--purple)"},onMouseLeave:l=>{l.target.style.backgroundColor="var(--bg-secondary)",l.target.style.borderColor="var(--border)"},title:"Remove one",children:e.jsx(at,{size:12})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.875rem",minWidth:"20px",textAlign:"center"},children:_.length}),e.jsx("button",{onClick:l=>{l.stopPropagation(),xe&&xe(t)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"20px",height:"20px",fontSize:"0.7rem",transition:"all 0.2s ease"},onMouseEnter:l=>{l.target.style.backgroundColor="var(--purple)",l.target.style.borderColor="var(--purple)",l.target.style.color="white"},onMouseLeave:l=>{l.target.style.backgroundColor="var(--bg-secondary)",l.target.style.borderColor="var(--border)",l.target.style.color="var(--text-primary)"},title:"Add another",children:e.jsx(Ge,{size:12})}),Z&&e.jsx("button",{onClick:l=>{l.stopPropagation(),Z(t.id)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"20px",height:"20px",fontSize:"0.7rem",transition:"all 0.2s ease",marginLeft:"0.25rem"},onMouseEnter:l=>{l.target.style.backgroundColor="var(--purple)",l.target.style.borderColor="var(--purple)",l.target.style.color="white"},onMouseLeave:l=>{l.target.style.backgroundColor="var(--bg-secondary)",l.target.style.borderColor="var(--border)",l.target.style.color="var(--text-primary)"},title:"Edit",children:e.jsx(Lt,{size:12})})]})]}),(t.type||t.tier||n)&&e.jsx(Qt,{type:t.type,tier:t.tier,isEditMode:n,onUpdate:f,itemId:t.id})]})}),e.jsxs("div",{ref:ze,style:{borderRadius:"0 0 8px 8px",flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0},className:"invisible-scrollbar",children:[(t.motives||n)&&e.jsx("div",{style:{padding:"0.5rem 8px",textAlign:"center"},children:n?e.jsx("input",{type:"text",value:t.motives||"",onChange:l=>f&&f(t.id,{motives:l.target.value}),placeholder:"Motives...",style:{width:"100%",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}):e.jsxs("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,textAlign:"center"},children:[t.motives,t.motives&&!t.motives.endsWith(".")?".":""]})}),(t.difficulty||t.atk!==void 0||t.thresholds&&t.type!=="Minion"||t.experience&&t.experience.length>0||n)&&e.jsxs("div",{style:{padding:"0.5rem 8px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[(t.difficulty||n)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[e.jsx(Nt,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(0deg)"}}),n?e.jsx("input",{type:"text",value:t.difficulty||"",onChange:l=>{const S=l.target.value.replace(/[^0-9]/g,"");S.length<=2&&f&&f(t.id,{difficulty:parseInt(S)||0})},onKeyDown:l=>{if(l.key==="ArrowUp"){l.preventDefault();const S=parseInt(t.difficulty)||0;f&&f(t.id,{difficulty:Math.min(S+1,99)})}else if(l.key==="ArrowDown"){l.preventDefault();const S=parseInt(t.difficulty)||0;f&&f(t.id,{difficulty:Math.max(S-1,0)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"2"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:t.difficulty})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Difficulty"})]}),(t.atk!==void 0||n)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[e.jsx(Bt,{size:38,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(45deg)"}}),n?e.jsx("input",{type:"text",value:(()=>{const l=typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0;return l>=0?`+${l}`:l.toString()})(),onChange:l=>{const S=l.target.value.replace(/[^0-9+\-]/g,"");if(S.length<=4){const o=parseInt(S.replace(/[^0-9\-]/g,""))||0;f&&f(t.id,{atk:o})}},onKeyDown:l=>{if(l.key==="ArrowUp"){l.preventDefault();const o=(typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0)+1;f&&f(t.id,{atk:o})}else if(l.key==="ArrowDown"){l.preventDefault();const o=(typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0)-1;f&&f(t.id,{atk:o})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"3"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:(()=>{const l=typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk;return l>=0?`+${l}`:l})()})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Attack"})]})]}),e.jsx("div",{style:{paddingTop:"0"},children:n?e.jsx("div",{style:{display:"flex",flexDirection:"column",marginTop:"-0.25rem"},children:(()=>{const l=t.experience||[],S=l.length===0?[{name:"",modifier:1}]:l;return S.map((o,j)=>{var J,k,K,we,Me,he,u,A,F,se,X,ye,me,ue,oe,b,fe,ke,a,L,ae,B,H,T,R;return e.jsxs("div",{style:{position:"relative",marginBottom:"0.5rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("input",{type:"text",value:typeof o=="object"&&o.modifier>=1?`+${o.modifier}`:"+1",onChange:N=>{const V=[...t.experience||[]],z=parseInt(N.target.value.replace(/[^0-9+-]/g,""))||1,ee=Math.max(1,z);V[j]={name:typeof o=="string"?o:o.name||"",modifier:ee},f&&f(t.id,{experience:V})},onKeyDown:N=>{if(N.key==="ArrowUp"){N.preventDefault();const V=[...t.experience||[]],z=typeof o=="object"?Math.max(1,o.modifier):1;V[j]={name:typeof o=="string"?o:o.name||"",modifier:z+1},f&&f(t.id,{experience:V})}else if(N.key==="ArrowDown"){N.preventDefault();const V=[...t.experience||[]],z=typeof o=="object"?Math.max(1,o.modifier):1;V[j]={name:typeof o=="string"?o:o.name||"",modifier:Math.max(1,z-1)},f&&f(t.id,{experience:V})}},style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)",textAlign:"center",outline:"none"}})}),e.jsxs("div",{style:{marginLeft:"32px",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:typeof o=="string"?o:o.name||"",onChange:N=>{const V=[...t.experience||[]],z=typeof o=="object"?o.modifier:1;V[j]={name:N.target.value,modifier:z};const ee=V[V.length-1];ee&&ee.name.trim()&&V.push({name:"",modifier:1}),f&&f(t.id,{experience:V})},placeholder:"Experience name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsxs("div",{style:{display:"flex",gap:"0.125rem"},children:[e.jsx("button",{onClick:()=>{var Ie,Ee;const N=[...t.experience||[]],V=typeof o=="string"?o.trim():(Ie=o.name)==null?void 0:Ie.trim(),z=N[j-1],ee=typeof z=="string"?z.trim():(Ee=z.name)==null?void 0:Ee.trim();j>0&&j<N.length&&V&&ee&&(N[j]=z,N[j-1]=o,f&&f(t.id,{experience:N}))},disabled:j===0||!(typeof o=="string"?o.trim():(J=o.name)!=null&&J.trim())||!(typeof S[j-1]=="string"?S[j-1].trim():(k=S[j-1].name)!=null&&k.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:j===0||!(typeof o=="string"?o.trim():(K=o.name)!=null&&K.trim())||!(typeof S[j-1]=="string"?S[j-1].trim():(we=S[j-1].name)!=null&&we.trim())?"var(--gray-800)":"var(--gray-700)",color:j===0||!(typeof o=="string"?o.trim():(Me=o.name)!=null&&Me.trim())||!(typeof S[j-1]=="string"?S[j-1].trim():(he=S[j-1].name)!=null&&he.trim())?"var(--text-secondary)":"white",cursor:j===0||!(typeof o=="string"?o.trim():(u=o.name)!=null&&u.trim())||!(typeof S[j-1]=="string"?S[j-1].trim():(A=S[j-1].name)!=null&&A.trim())?"not-allowed":"pointer",opacity:j===0||!(typeof o=="string"?o.trim():(F=o.name)!=null&&F.trim())||!(typeof S[j-1]=="string"?S[j-1].trim():(se=S[j-1].name)!=null&&se.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move up",children:"↑"}),e.jsx("button",{onClick:()=>{var Ie,Ee;const N=[...t.experience||[]],V=typeof o=="string"?o.trim():(Ie=o.name)==null?void 0:Ie.trim(),z=N[j+1],ee=typeof z=="string"?z.trim():(Ee=z.name)==null?void 0:Ee.trim();j<N.length-1&&j>=0&&V&&ee&&(N[j]=z,N[j+1]=o,f&&f(t.id,{experience:N}))},disabled:j===S.length-1||!(typeof o=="string"?o.trim():(X=o.name)!=null&&X.trim())||!(typeof S[j+1]=="string"?S[j+1].trim():(ye=S[j+1].name)!=null&&ye.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:j===S.length-1||!(typeof o=="string"?o.trim():(me=o.name)!=null&&me.trim())||!(typeof S[j+1]=="string"?S[j+1].trim():(ue=S[j+1].name)!=null&&ue.trim())?"var(--gray-800)":"var(--gray-700)",color:j===S.length-1||!(typeof o=="string"?o.trim():(oe=o.name)!=null&&oe.trim())||!(typeof S[j+1]=="string"?S[j+1].trim():(b=S[j+1].name)!=null&&b.trim())?"var(--text-secondary)":"white",cursor:j===S.length-1||!(typeof o=="string"?o.trim():(fe=o.name)!=null&&fe.trim())||!(typeof S[j+1]=="string"?S[j+1].trim():(ke=S[j+1].name)!=null&&ke.trim())?"not-allowed":"pointer",opacity:j===S.length-1||!(typeof o=="string"?o.trim():(a=o.name)!=null&&a.trim())||!(typeof S[j+1]=="string"?S[j+1].trim():(L=S[j+1].name)!=null&&L.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move down",children:"↓"}),e.jsx("button",{onClick:()=>ce(o,j),disabled:!(typeof o=="string"?o.trim():(ae=o.name)!=null&&ae.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:w[Re(o,j)]?"var(--danger)":(typeof o=="string"?o.trim():(B=o.name)!=null&&B.trim())?"var(--gray-700)":"var(--gray-800)",color:(typeof o=="string"?o.trim():(H=o.name)!=null&&H.trim())?"white":"var(--text-secondary)",cursor:(typeof o=="string"?o.trim():(T=o.name)!=null&&T.trim())?"pointer":"not-allowed",opacity:(typeof o=="string"?o.trim():(R=o.name)!=null&&R.trim())?1:.5,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:w[Re(o,j)]?"Click again to confirm delete":"Delete experience",children:"×"})]})]})]},j)})})()}):e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:t.experience&&t.experience.length>0?t.experience.map((l,S)=>{if(typeof l=="string"){const o=l.match(/^(.+?)\s*([+-]?\d+)$/);if(o){const[,j,J]=o;return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:J})})}),e.jsx("span",{style:{marginLeft:"32px"},children:j})]},S)}else return e.jsx("div",{style:{marginBottom:"0.25rem"},children:l},S)}else return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:e.jsxs("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:[l.modifier>=0?"+":"",l.modifier]})})}),e.jsx("span",{style:{marginLeft:"32px"},children:l.name})]},S)}):null})})]}),(t.features&&t.features.length>0||n)&&e.jsxs("div",{style:{padding:"0 8px 8px 8px"},children:[(t.atk!==void 0&&t.weapon||n)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Standard Attack"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:n?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",marginTop:"0.75rem",marginBottom:"0.75rem"},children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[e.jsx("input",{type:"text",value:t.weapon||"",onChange:l=>f&&f(t.id,{weapon:l.target.value}),placeholder:"Standard attack name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}}),e.jsxs("select",{value:t.range||"",onChange:l=>f&&f(t.id,{range:l.target.value}),style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",appearance:"none",backgroundImage:`url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",backgroundSize:"1rem",paddingRight:"2rem"},children:[e.jsx("option",{value:""}),e.jsx("option",{value:"Melee",children:"Melee"}),e.jsx("option",{value:"Very Close",children:"Very Close"}),e.jsx("option",{value:"Close",children:"Close"}),e.jsx("option",{value:"Far",children:"Far"}),e.jsx("option",{value:"Very Far",children:"Very Far"})]}),e.jsx("input",{type:"text",value:t.damage||"",onChange:l=>f&&f(t.id,{damage:l.target.value}),placeholder:"Damage (e.g., 1d6+2)",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}})]})}):t.atk!==void 0&&t.weapon&&e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:t.weapon}),e.jsxs("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:["Make an attack against a target within ",t.range||"Melee"," range. On a success, deal ",t.damage||"damage varies","."]})]})})]}),(t.features.filter(l=>l.type==="Action").length>0||n)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Actions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const l=t.features.filter(o=>o.type==="Action");return(n&&l.length===0?[{type:"Action",name:"",description:""}]:l).map((o,j)=>n?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:o.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false","data-lpignore":"true","data-form-type":"other",name:`feature-name-${o.type.toLowerCase()}`,onChange:J=>{const k=[...t.features||[]],K=k.findIndex(he=>he.type==="Action"&&he===o);K>=0?k[K]={...k[K],name:J.target.value}:k.push({type:"Action",name:J.target.value,description:o.description||""});const we=k.filter(he=>he.type==="Action"),Me=we[we.length-1];Me&&Me.name.trim()&&k.push({type:"Action",name:"",description:""}),f&&f(t.id,{features:k})},placeholder:"Action name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:o.description||"",onChange:J=>{const k=[...t.features||[]],K=k.findIndex(he=>he.type==="Action"&&he===o);K>=0?k[K]={...k[K],description:J.target.value}:k.push({type:"Action",name:o.name||"",description:J.target.value});const we=k.filter(he=>he.type==="Action"),Me=we[we.length-1];Me&&Me.name.trim()&&k.push({type:"Action",name:"",description:""}),f&&f(t.id,{features:k})},onInput:J=>{const k=J.target.offsetHeight;J.target.style.height="auto";const K=J.target.scrollHeight,we=K>k?K:k;J.target.style.height=we+"px"},placeholder:"Action description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(nt,{feature:o,featureType:"Action",item:t,onUpdate:f,handleFeatureDeleteClick:ne,deleteConfirmations:w,getFeatureKey:Se})]},j):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:o.name}),o.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:o.description})]},j))})()})]}),(t.features.filter(l=>l.type==="Passive").length>0||n)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Passives"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const l=t.features.filter(o=>o.type==="Passive");return(n&&l.length===0?[{type:"Passive",name:"",description:""}]:l).map((o,j)=>n?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:o.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:J=>{const k=[...t.features||[]],K=k.findIndex(he=>he.type==="Passive"&&he===o);K>=0?k[K]={...k[K],name:J.target.value}:k.push({type:"Passive",name:J.target.value,description:o.description||""});const we=k.filter(he=>he.type==="Passive"),Me=we[we.length-1];Me&&Me.name.trim()&&k.push({type:"Passive",name:"",description:""}),f&&f(t.id,{features:k})},placeholder:"Passive name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:o.description||"",onChange:J=>{const k=[...t.features||[]],K=k.findIndex(he=>he.type==="Passive"&&he===o);K>=0?k[K]={...k[K],description:J.target.value}:k.push({type:"Passive",name:o.name||"",description:J.target.value});const we=k.filter(he=>he.type==="Passive"),Me=we[we.length-1];Me&&Me.name.trim()&&k.push({type:"Passive",name:"",description:""}),f&&f(t.id,{features:k})},onInput:J=>{const k=J.target.offsetHeight;J.target.style.height="auto";const K=J.target.scrollHeight,we=K>k?K:k;J.target.style.height=we+"px"},placeholder:"Passive description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(nt,{feature:o,featureType:"Passive",item:t,onUpdate:f,handleFeatureDeleteClick:ne,deleteConfirmations:w,getFeatureKey:Se})]},j):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:o.name}),o.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:o.description})]},j))})()})]}),(t.features.filter(l=>l.type==="Reaction").length>0||n)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Reactions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const l=t.features.filter(o=>o.type==="Reaction");return(n&&l.length===0?[{type:"Reaction",name:"",description:""}]:l).map((o,j)=>n?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:o.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:J=>{const k=[...t.features||[]],K=k.findIndex(he=>he.type==="Reaction"&&he===o);K>=0?k[K]={...k[K],name:J.target.value}:k.push({type:"Reaction",name:J.target.value,description:o.description||""});const we=k.filter(he=>he.type==="Reaction"),Me=we[we.length-1];Me&&Me.name.trim()&&k.push({type:"Reaction",name:"",description:""}),f&&f(t.id,{features:k})},placeholder:"Reaction name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:o.description||"",onChange:J=>{const k=[...t.features||[]],K=k.findIndex(he=>he.type==="Reaction"&&he===o);K>=0?k[K]={...k[K],description:J.target.value}:k.push({type:"Reaction",name:o.name||"",description:J.target.value});const we=k.filter(he=>he.type==="Reaction"),Me=we[we.length-1];Me&&Me.name.trim()&&k.push({type:"Reaction",name:"",description:""}),f&&f(t.id,{features:k})},onInput:J=>{const k=J.target.offsetHeight;J.target.style.height="auto";const K=J.target.scrollHeight,we=K>k?K:k;J.target.style.height=we+"px"},placeholder:"Reaction description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(nt,{feature:o,featureType:"Reaction",item:t,onUpdate:f,handleFeatureDeleteClick:ne,deleteConfirmations:w,getFeatureKey:Se})]},j):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:o.name}),o.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:o.description})]},j))})()})]})]}),(_&&_.length>0||t.type!=="Minion"&&(t.thresholds||n))&&e.jsxs("div",{style:{padding:"0 8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Status"})]}),n?e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border)"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"number",value:t.hpMax||"",onChange:l=>{const S=parseInt(l.target.value)||1;f&&f(t.id,{hpMax:S})},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),e.jsx(qe,{type:"adversaryHP",value:0,maxValue:t.hpMax||1,showTooltip:!1}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:"HP"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"number",value:t.stressMax||"",onChange:l=>{const S=parseInt(l.target.value)||1;f&&f(t.id,{stressMax:S})},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),e.jsx(qe,{type:"adversaryStress",value:0,maxValue:t.stressMax||1,showTooltip:!1}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:"Stress"})]})]})})}):_&&_.length>0&&_.map((l,S)=>{const o=(l.hp||0)>=(l.hpMax||1);return e.jsx("div",{"data-instance-id":l.id,style:{marginBottom:"0.5rem"},children:e.jsxs("div",{style:{backgroundColor:o?"var(--gray-900)":"var(--bg-primary)",borderRadius:"6px",padding:"0.25rem 0.5rem",border:"1px solid",borderColor:o?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",display:"flex",justifyContent:"flex-start",alignItems:"center",gap:"0.5rem",opacity:o?.7:1,position:"relative",transition:"all 0.2s ease",minHeight:"40px"},children:[o&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                          45deg,
                          transparent 0px,
                          transparent 8px,
                          var(--gray-600) 9px,
                          var(--gray-600) 9px
                        )`,pointerEvents:"none",zIndex:1,borderRadius:"4px"}})}),e.jsx("div",{style:{backgroundColor:o?"var(--gray-900)":"var(--bg-card)",border:"1px solid",borderColor:o?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",borderRadius:"50%",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",flexShrink:0,opacity:o?.5:1},children:e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:o?"var(--gray-400)":"var(--text-primary)"},children:l.duplicateNumber||1})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.125rem"},children:[e.jsx("div",{style:{opacity:o?.3:1},children:e.jsx(qe,{type:"adversaryHP",value:l.hp||0,maxValue:l.hpMax||1,onPipClick:(j,J)=>{if(p&&s==="adversary"){const k=l.hp||0,K=l.hpMax||1;J?y&&y(l.id,1,k):k<K&&p(l.id,1,k,K)}},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})}),l.stressMax>0&&e.jsx("div",{style:{opacity:o?.3:1},children:e.jsx(qe,{type:"adversaryStress",value:l.stress||0,maxValue:l.stressMax,onPipClick:(j,J)=>{W&&s==="adversary"&&(J?W(l.id,-1):W(l.id,1))},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})})]})]},l.id)},l.id)}),t.type!=="Minion"&&(t.thresholds||n)&&e.jsx("div",{style:{display:"flex",justifyContent:"center",paddingTop:"1px",marginTop:"0.5rem",marginBottom:"0.5rem"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",position:"relative"},children:e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",height:"36px"},children:[e.jsx("svg",{width:"300",height:"36",viewBox:"0 0 300 36",style:{position:"absolute",zIndex:1},children:e.jsx("rect",{x:"20",y:"6",width:"260",height:"24",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4"})}),e.jsx("div",{style:{position:"relative",zIndex:2,display:"flex",alignItems:"center",gap:"0.5rem"},children:n?e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",fontSize:"0.8rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),e.jsx("input",{type:"number",min:"1",max:"99",value:((O=t.thresholds)==null?void 0:O.major)||"",onChange:l=>{const S=l.target.value;(S===""||parseInt(S)>=1&&parseInt(S)<=99)&&f&&f(t.id,{thresholds:{...t.thresholds,major:S===""?null:parseInt(S)}})},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),e.jsx("input",{type:"number",min:"1",max:"99",value:(($=t.thresholds)==null?void 0:$.severe)||"",onChange:l=>{const S=l.target.value;(S===""||parseInt(S)>=1&&parseInt(S)<=99)&&f&&f(t.id,{thresholds:{...t.thresholds,severe:S===""?null:parseInt(S)}})},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),e.jsx(gt,{value:((U=t.thresholds)==null?void 0:U.major)||7}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),e.jsx(gt,{value:((Ce=t.thresholds)==null?void 0:Ce.severe)||14}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]})})]})})})]}),(n||c==="expanded"&&t.description&&t.description.trim())&&e.jsxs("div",{style:{padding:"0 8px",textAlign:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Description"})]}),n?e.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-primary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"none",overflow:"hidden",fontFamily:"inherit",marginTop:"0.75rem",marginBottom:"0.75rem"},value:t.description,onChange:l=>{l.target.style.height="auto",l.target.style.height=l.target.scrollHeight+"px",f&&f(t.id,{description:l.target.value})},placeholder:"Description..."}):e.jsx("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,whiteSpace:"pre-wrap",padding:"0.5rem 0"},children:t.description})]}),E>0&&e.jsx("div",{ref:g,style:{height:E,width:"100%",flexShrink:0}})]}),i()]})};return te&&(s==="adversary"||s==="adversaries")?e.jsx("div",{className:Te(),style:{...je(!0),padding:0,display:"flex",flexDirection:"column",position:"relative",height:"auto",overflow:"hidden"},children:e.jsx(kt,{onSave:ve||(()=>{}),onRefresh:()=>{},editingAdversary:t,onCancelEdit:Q||(()=>{}),isStockAdversary:Ae,autoFocus:!0,allAdversaries:[],embedded:!0})}):(c==="expanded"||c==="edit")&&(s==="adversary"||s==="adversaries")?x():s==="adversary"||s==="adversaries"?null:e.jsxs("div",{className:Te(),style:je(!0),children:[e.jsxs("div",{style:Ne.rowMain,children:[e.jsx("h4",{style:Ne.rowTitle,children:We()}),e.jsx("div",{style:Ne.rowMeta,children:be()})]}),e.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"12px",margin:0},children:["Expanded view coming soon for ",s]})]})},er="/Daggerheart/assets/daggerheart-logo-fe7815ad.svg",tr=(t,s)=>{const[c,d]=m.useState("max-content"),v=m.useCallback(()=>{if(!s.current||t<=3)return"max-content";const p=s.current.offsetWidth,W=Math.floor(p/120);return W<=1?"max-content":t===4?"max-content max-content":t===5||t===6?W>=2?"max-content max-content":"max-content":t===7?W>=3?"max-content max-content max-content":W>=2?"max-content max-content":"max-content":"repeat(auto-fit, minmax(80px, max-content))"},[t,s]);return m.useEffect(()=>{const p=v();d(p);const y=new ResizeObserver(()=>{const W=v();d(W)});return s.current&&y.observe(s.current),()=>{y.disconnect()}},[v]),c},rr=({encounter:t})=>{var v,p;const s=m.useRef(null),c=((v=t.encounterItems)==null?void 0:v.length)||0,d=tr(c,s);return e.jsx("div",{ref:s,className:"saved-encounter-adversary-list",style:{flex:1,fontSize:"0.8rem",color:"var(--text-secondary)",lineHeight:"1.3",display:"grid",gridTemplateColumns:d,gap:"0.25rem 1rem",gridAutoRows:"min-content"},children:((p=t.encounterItems)==null?void 0:p.length)>0?t.encounterItems.map((y,W)=>{var M;const f=y.item.baseName||((M=y.item.name)==null?void 0:M.replace(/\s+\(\d+\)$/,""))||y.item.name;return e.jsxs("div",{style:{marginBottom:"0.125rem"},children:[y.quantity,"x ",f]},W)}):e.jsx("div",{children:"No adversaries"})})},Ye={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},Qe={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1,lowerTierAdversary:1};let Ue={adversaries:[]},lt={environments:[]},dt=!1;const nr=()=>{const t=JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]"),s=JSON.parse(localStorage.getItem("daggerheart-custom-environments")||"[]");return{customAdversaries:t,customEnvironments:s}},yt=async()=>{if(dt)return;let t={adversaries:[]},s={environments:[]},c={adversaries:[]},d={environments:[]};try{const y=await _e(()=>import("./adversaries-9c8932de.js"),[]);t=(y==null?void 0:y.default)||y}catch(y){console.warn("Failed to load adversaries.json:",y)}try{const y=await _e(()=>import("./environments-c340637c.js"),[]);s=(y==null?void 0:y.default)||y}catch(y){console.warn("Failed to load environments.json:",y)}try{const y=await _e(()=>import("./playtest-adversaries-4a099c10.js"),[]);c=(y==null?void 0:y.default)||y}catch(y){console.warn("Failed to load playtest-adversaries.json:",y)}try{const y=await _e(()=>import("./playtest-environments-d9cdffb6.js"),[]);d=(y==null?void 0:y.default)||y}catch(y){console.warn("Failed to load playtest-environments.json:",y)}const{customAdversaries:v,customEnvironments:p}=nr();Ue={...t,adversaries:[...t.adversaries||[],...c.adversaries||[],...v]},lt={...s,environments:[...s.environments||[],...d.environments||[],...p]},dt=!0},sr=(t,s=[],c=4,d=1,v=!1)=>{const[p,y]=m.useState(""),[W,f]=m.useState([{field:"tier",direction:"asc"},{field:"name",direction:"asc"}]),[M,I]=m.useState([]),[P,_]=m.useState(!0),[C,ie]=m.useState([]),[xe,G]=m.useState([]),[Z,te]=m.useState(!1),[ve,Q]=m.useState(!1),Ae=m.useRef(null),ze=m.useRef(null);m.useEffect(()=>{(async()=>{await yt(),_(!1);let ce=[];t==="adversary"?ce=Ue.adversaries||[]:t==="environment"&&(ce=lt.environments||[]),I(ce)})()},[t]);const Le=ne=>{const ce=M.map(Y=>Y[ne]).filter(Boolean);return[...new Set(ce)].sort((Y,je)=>typeof Y=="number"&&typeof je=="number"?Y-je:String(Y).localeCompare(String(je)))},re=m.useCallback(async()=>{dt=!1,await yt();let ne=[];t==="adversary"?v?ne=(Ue.adversaries||[]).filter(ce=>{var Y;return ce.source==="Homebrew"||((Y=ce.id)==null?void 0:Y.startsWith("custom-"))}):ne=Ue.adversaries||[]:t==="environment"&&(ne=lt.environments||[]),I(ne)},[t,v]);m.useEffect(()=>{re()},[v,re]);const le=Le("tier"),de=Le("type"),g=m.useMemo(()=>{let ne=M.filter(ce=>{var We,be;const Y=ce.name.toLowerCase().includes(p.toLowerCase())||((We=ce.type)==null?void 0:We.toLowerCase().includes(p.toLowerCase()))||((be=ce.description)==null?void 0:be.toLowerCase().includes(p.toLowerCase())),je=C.length===0||(C.includes("party-tier")?ce.tier===d:C.includes(ce.tier.toString())),Te=xe.length===0||xe.includes(ce.type);return Y&&je&&Te});return ne.sort((ce,Y)=>{for(const je of W){const{field:Te,direction:We}=je;let be=ce[Te],i=Y[Te];if(Te==="tier")be=parseInt(be)||0,i=parseInt(i)||0;else if(Te==="cost"){const x=h=>{if(t!=="adversary")return 0;const r=Ye[h.type]||2;let n=0;const q=s.filter($=>$.type==="adversary"&&$.item.type==="Solo"&&$.quantity>0).reduce(($,U)=>$+U.quantity,0),O=s.filter($=>$.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes($.item.type)&&$.quantity>0).reduce(($,U)=>$+U.quantity,0);return h.type==="Solo"&&q===1&&(n+=2),["Bruiser","Horde","Leader","Solo"].includes(h.type)&&O===0&&(n+=1),r+n};be=x(ce),i=x(Y)}else if(Te==="difficulty"){const x=parseInt(be),h=parseInt(i);!isNaN(x)&&!isNaN(h)?(be=x,i=h):!isNaN(x)&&isNaN(h)?(be=x,i=999):isNaN(x)&&!isNaN(h)?(be=999,i=h):(be=String(be||"").toLowerCase(),i=String(i||"").toLowerCase())}else typeof be=="string"&&typeof i=="string"?(be=be.toLowerCase(),i=i.toLowerCase()):(be=String(be||"").toLowerCase(),i=String(i||"").toLowerCase());if(We==="asc"){if(be>i)return 1;if(be<i)return-1}else{if(be<i)return 1;if(be>i)return-1}}return 0}),ne},[M,p,W,C,xe,s,c,d]),E=ne=>{f(ce=>{const Y=ce.findIndex(je=>je.field===ne);if(Y>=0)if(Y===0){const je=[...ce];return je[0]={...je[0],direction:je[0].direction==="asc"?"desc":"asc"},je}else{const je=[...ce];return je.splice(Y,1)[0],[{field:ne,direction:"asc"},...je]}else return[{field:ne,direction:"asc"},...ce]})},ge=ne=>{ie(ne==="clear"?[]:ne==="party-tier"?["party-tier"]:ce=>ce.includes(ne)?ce.filter(Y=>Y!==ne):[...ce,ne])},w=ne=>{G(ne==="clear"?[]:ce=>ce.includes(ne)?ce.filter(Y=>Y!==ne):[...ce,ne])},D=C.length>0,Se=xe.length>0;return m.useEffect(()=>{const ne=Y=>{const je=Y.target.closest(".filter-dropdown"),Te=Y.target.closest(".header-filter-icon");je||Te||(te(!1),Q(!1))},ce=Y=>{Y.key==="Escape"&&(te(!1),Q(!1))};return document.addEventListener("pointerdown",ne,!0),document.addEventListener("mousedown",ne,!0),document.addEventListener("touchstart",ne,!0),document.addEventListener("click",ne,!0),document.addEventListener("keydown",ce,!0),()=>{document.removeEventListener("pointerdown",ne,!0),document.removeEventListener("mousedown",ne,!0),document.removeEventListener("touchstart",ne,!0),document.removeEventListener("click",ne,!0),document.removeEventListener("keydown",ce,!0)}},[te,Q]),{searchTerm:p,setSearchTerm:y,sortFields:W,handleSort:E,filteredAndSortedData:g,loading:P,refreshData:re,selectedTiers:C,selectedTypes:xe,showTierDropdown:Z,setShowTierDropdown:te,showTypeDropdown:ve,setShowTypeDropdown:Q,tierFilterRef:Ae,typeFilterRef:ze,uniqueTiers:le,uniqueTypes:de,handleTierSelect:ge,handleTypeSelect:w,isTierFiltered:D,isTypeFiltered:Se,getDropdownStyle:ne=>{if(!ne.current)return{};const ce=ne.current.getBoundingClientRect();return{position:"fixed",top:ce.bottom+4,left:ce.left-100,zIndex:99999}}}},or=({searchTerm:t,onSearchChange:s,type:c,partyControls:d,showCustomToggle:v=!1,onToggleCustom:p,filterCustom:y=!1,onExportCustomAdversaries:W,onImportCustomAdversaries:f,autoFocus:M=!1,onClose:I=null,placeholder:P="Search"})=>{const _=m.useRef(null);return m.useEffect(()=>{M&&_.current&&setTimeout(()=>{var C;(C=_.current)==null||C.focus()},100)},[M]),e.jsxs("div",{style:pe.browserHeader,children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",flex:1,gap:"0.5rem"},children:[e.jsx("input",{ref:_,type:"text",placeholder:P,value:t,onChange:C=>s(C.target.value),style:{...pe.searchInput,flex:1,marginRight:0}}),I&&e.jsx("button",{onClick:I,style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease",flexShrink:0},onMouseEnter:C=>C.target.style.color="var(--text-primary)",onMouseLeave:C=>C.target.style.color="var(--text-secondary)",title:"Close browser",children:e.jsx(Ve,{size:16})})]}),d&&e.jsx("div",{style:pe.partyControls,children:d})]})},ar=({showCustomToggle:t=!1,onToggleCustom:s,filterCustom:c=!1,onExportCustomAdversaries:d,onImportCustomAdversaries:v})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)",flexShrink:0},children:[t&&e.jsxs("button",{onClick:()=>s&&s(!c),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:c?"var(--purple)":"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:c?"white":"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:p=>{c||(p.target.style.backgroundColor="var(--bg-hover)",p.target.style.borderColor="var(--purple)")},onMouseLeave:p=>{c||(p.target.style.backgroundColor="var(--bg-primary)",p.target.style.borderColor="var(--border)")},children:[e.jsx("span",{children:c?"✓":"○"}),"Custom Only"]}),e.jsxs("button",{onClick:d,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:p=>{p.target.style.backgroundColor="var(--bg-hover)",p.target.style.borderColor="var(--purple)"},onMouseLeave:p=>{p.target.style.backgroundColor="var(--bg-primary)",p.target.style.borderColor="var(--border)"},children:[e.jsx("span",{children:"↓"}),"Export"]}),e.jsxs("button",{onClick:()=>document.getElementById("import-file-input").click(),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:p=>{p.target.style.backgroundColor="var(--bg-hover)",p.target.style.borderColor="var(--purple)"},onMouseLeave:p=>{p.target.style.backgroundColor="var(--bg-primary)",p.target.style.borderColor="var(--border)"},children:[e.jsx("span",{children:"↑"}),"Import"]}),e.jsx("input",{id:"import-file-input",type:"file",accept:".csv,.json",onChange:v,style:{display:"none"}})]}),ir=({sortFields:t,onSort:s,type:c,uniqueTiers:d,uniqueTypes:v,selectedTiers:p,selectedTypes:y,showTierDropdown:W,setShowTierDropdown:f,showTypeDropdown:M,setShowTypeDropdown:I,tierFilterRef:P,typeFilterRef:_,handleTierSelect:C,handleTypeSelect:ie,isTierFiltered:xe,isTypeFiltered:G,getDropdownStyle:Z,costFilter:te,showCostDropdown:ve,setShowCostDropdown:Q,costFilterRef:Ae,handleCostFilterSelect:ze,isCostFiltered:Le})=>{const[re,le]=m.useState(null),g=(()=>c==="adversary"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"cost",label:"Cost",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:c==="environment"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:[])(),E=()=>{if(!ve)return null;const w=[{value:"all",label:"All"},{value:"auto-grey",label:"Auto Grey"},{value:"auto-hide",label:"Auto Hide"}];return ot.createPortal(e.jsx("div",{className:"filter-dropdown",style:{...pe.filterDropdown,...Z(Ae),maxHeight:"60vh",overflow:"auto"},onMouseDown:D=>D.stopPropagation(),onClick:D=>D.stopPropagation(),children:w.map(D=>{const Se=te===D.value;return e.jsxs("div",{style:{...pe.filterOption,...Se?pe.filterOptionSelected:{}},onClick:()=>ze(D.value),children:[e.jsx("span",{style:pe.checkIcon,children:Se?e.jsx(Ke,{size:16}):e.jsx(Xe,{size:16})}),e.jsx("span",{style:pe.filterLabel,children:D.label})]},D.value)})}),document.body)},ge=(w,D,Se,Re,ne,ce,Y,je)=>{if(!ne)return null;const Te=()=>{(w==="tier"||w==="type")&&Re("clear")};return ot.createPortal(e.jsxs("div",{className:"filter-dropdown",style:{...pe.filterDropdown,...Z(Y),maxHeight:"60vh",overflow:"auto"},onMouseDown:We=>We.stopPropagation(),onClick:We=>We.stopPropagation(),children:[e.jsxs("div",{style:{...pe.filterOption,...Se.length===0?pe.filterOptionSelected:{}},onClick:Te,children:[e.jsx("span",{style:pe.checkIcon,children:Se.length===0?e.jsx(Ke,{size:16}):e.jsx(Xe,{size:16})}),e.jsx("span",{style:pe.filterLabel,children:"All"})]}),w==="tier"&&e.jsxs("div",{style:{...pe.filterOption,...Se.includes("party-tier")?pe.filterOptionSelected:{}},onClick:()=>Re("party-tier"),children:[e.jsx("span",{style:pe.checkIcon,children:Se.includes("party-tier")?e.jsx(Ke,{size:16}):e.jsx(Xe,{size:16})}),e.jsx("span",{style:pe.filterLabel,children:"Party Tier"})]}),D.map(We=>{const be=Se.includes(We.toString());return e.jsxs("div",{style:{...pe.filterOption,...be?pe.filterOptionSelected:{}},onClick:()=>Re(We.toString()),children:[e.jsx("span",{style:pe.checkIcon,children:be?e.jsx(Ke,{size:16}):e.jsx(Xe,{size:16})}),e.jsx("span",{style:pe.filterLabel,children:We})]},We)})]}),document.body)};return e.jsx("tr",{style:pe.tableHeader,children:g.map(w=>e.jsxs("th",{style:{...pe.tableHeaderCell,...re===w.key?pe.tableHeaderCellHover:{},position:"relative",...w.key==="name"?{width:"auto",minWidth:"0"}:{},...w.key==="tier"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...w.key==="type"?{width:"80px",minWidth:"80px",maxWidth:"80px"}:{},...w.key==="difficulty"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...w.key==="cost"?{width:"50px",minWidth:"50px",maxWidth:"50px"}:{},...w.key==="action"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{}},onClick:()=>s(w.key),onMouseEnter:()=>le(w.key),onMouseLeave:()=>le(null),children:[w.hasFilter?e.jsxs("div",{style:pe.headerWithFilter,children:[e.jsx("span",{style:{cursor:"pointer"},onClick:D=>{D.stopPropagation(),s(w.key)},children:w.label}),e.jsxs("button",{ref:w.key==="tier"?P:w.key==="type"?_:Ae,style:{...pe.headerFilterIcon,...w.key==="tier"&&xe?pe.headerFilterIconActive:{},...w.key==="type"&&G?pe.headerFilterIconActive:{},...w.key==="cost"&&Le?pe.headerFilterIconActive:{}},className:"header-filter-icon",onClick:D=>{D.stopPropagation(),w.key==="tier"?(f(!W),I(!1),Q(!1)):w.key==="type"?(I(!M),f(!1),Q(!1)):w.key==="cost"&&(Q(!ve),f(!1),I(!1))},children:[e.jsx(Dt,{size:14}),w.key==="tier"&&xe||w.key==="type"&&G||w.key==="cost"&&Le?e.jsx("span",{style:pe.filterActiveDot}):null]})]}):w.label,w.key==="tier"&&ge("tier",d,p,C,W,f,P),w.key==="type"&&ge("type",v,y,ie,M,I,_),w.key==="cost"&&E()]},w.key))})},lr=({item:t,onAdd:s,type:c,onRowClick:d,encounterItems:v=[],pcCount:p=4,playerTier:y=1,remainingBudget:W=0,costFilter:f="auto-grey",onAdversaryClick:M})=>{const[I,P]=m.useState(!1),_=()=>{s(t)},C=()=>{if(c!=="adversary")return null;const G=Ye[t.type]||2;let Z=0;const te=v.filter(Q=>Q.type==="adversary"&&Q.item.type==="Solo"&&Q.quantity>0).reduce((Q,Ae)=>Q+Ae.quantity,0),ve=v.filter(Q=>Q.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(Q.item.type)&&Q.quantity>0).reduce((Q,Ae)=>Q+Ae.quantity,0);return t.type==="Solo"&&te===1&&(Z+=2),["Bruiser","Horde","Leader","Solo"].includes(t.type)&&ve===0&&(Z+=1),G+Z},xe=(()=>{if(c==="adversary"){const G=C();Ye[t.type];const Z=G>W||W<=0;if(f==="auto-hide"&&Z)return null;const te=f==="auto-grey"&&Z?{opacity:.5,color:"var(--text-secondary)"}:{};return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...pe.rowCell,width:"auto",minWidth:"0",textAlign:"left",...te},children:e.jsxs("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:[e.jsx("div",{style:{fontWeight:"600"},children:t.name}),t.description&&e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"0.125rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.description})]})}),e.jsx("td",{style:{...pe.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...te},children:t.tier}),e.jsx("td",{style:{...pe.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center",...te},children:t.type}),e.jsx("td",{style:{...pe.rowCell,width:"50px",minWidth:"50px",maxWidth:"50px",textAlign:"center",...te},children:G}),e.jsx("td",{style:{...pe.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...te},children:t.difficulty})]})}else if(c==="environment")return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...pe.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:t.name}),e.jsx("td",{style:{...pe.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:t.tier}),e.jsx("td",{style:{...pe.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:t.type}),e.jsx("td",{style:{...pe.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:t.difficulty})]});return null})();return xe===null?null:e.jsx(e.Fragment,{children:e.jsxs("tr",{style:{...pe.row,...I?pe.rowHover:{}},onClick:()=>{c==="adversary"&&M?M(t):d&&d(t,c)},onMouseEnter:()=>P(!0),onMouseLeave:()=>P(!1),children:[xe,e.jsx("td",{style:{width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",boxSizing:"border-box",overflow:"visible",textOverflow:"unset",whiteSpace:"nowrap"},children:e.jsx("button",{style:pe.addButton,onClick:G=>{G.stopPropagation(),_()},onMouseEnter:G=>{G.target.style.background="var(--bg-secondary)"},onMouseLeave:G=>{G.target.style.background="var(--purple)"},children:"+"})})]})})},It=({type:t,onAddItem:s,onCancel:c=null,onRowClick:d,encounterItems:v=[],pcCount:p=4,playerTier:y=1,partyControls:W=null,showContainer:f=!0,savedEncounters:M=[],onLoadEncounter:I,onDeleteEncounter:P,activeTab:_="adversaries",selectedCustomAdversaryId:C,onSelectCustomAdversary:ie,onTabChange:xe,selectedAdversary:G,onSelectAdversary:Z,filterCustom:te=!1,showCustomToggle:ve=!1,onToggleCustom:Q,onExportCustomAdversaries:Ae,onImportCustomAdversaries:ze,autoFocus:Le=!1,hideImportExport:re=!1,onClose:le=null,searchPlaceholder:de="Search"})=>{const{addCustomAdversary:g,updateCustomAdversary:E,customContent:ge}=ct(),[w,D]=m.useState(null),[Se,Re]=m.useState("all"),[ne,ce]=m.useState(!1),[Y,je]=m.useState({}),Te=m.useRef({}),We=m.useRef(null),be=()=>{try{const b=ge.adversaries||[];if(b.length===0){alert("No custom adversaries to export.");return}const fe=["name","tier","type","difficulty","threshold_major","threshold_severe","hp_max","stress_max","atk","weapon","range","damage","description","motives"],ke=b.map(T=>{var R,N;return[T.name||"",T.tier||"",T.type||"",T.difficulty||"",((R=T.thresholds)==null?void 0:R.major)||"",((N=T.thresholds)==null?void 0:N.severe)||"",T.hpMax||"",T.stressMax||"",T.atk||"",T.weapon||"",T.range||"",T.damage||"",T.description||"",T.motives||""]}),a=T=>{const R=String(T);return R.includes(",")||R.includes('"')||R.includes(`
`)?`"${R.replace(/"/g,'""')}"`:R},L=[fe.join(","),...ke.map(T=>T.map(a).join(","))].join(`
`),ae=new Blob([L],{type:"text/csv;charset=utf-8;"}),B=URL.createObjectURL(ae),H=document.createElement("a");H.href=B,H.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(H),H.click(),document.body.removeChild(H),URL.revokeObjectURL(B),console.log(`Exported ${b.length} custom adversaries to CSV`)}catch(b){console.error("Failed to export custom adversaries:",b),alert("Failed to export custom adversaries. Please try again.")}},i=b=>{const fe=b.target.files[0];if(!fe)return;const ke=fe.name.endsWith(".csv"),a=fe.name.endsWith(".json");if(!ke&&!a){alert("Please upload a CSV or JSON file."),b.target.value="";return}const L=new FileReader;L.onload=ae=>{try{let B=[];if(ke){const z=ae.target.result.split(`
`).filter(Ie=>Ie.trim());if(z.length<2)throw new Error("CSV file is empty or invalid.");const ee=z[0].split(",").map(Ie=>Ie.trim().replace(/^"|"$/g,""));for(let Ie=1;Ie<z.length;Ie++){const Ee=[];let Pe="",Be=!1;for(let He=0;He<z[Ie].length;He++){const Je=z[Ie][He],At=z[Ie][He+1];Je==='"'&&Be&&At==='"'?(Pe+='"',He++):Je==='"'?Be=!Be:Je===","&&!Be?(Ee.push(Pe.trim()),Pe=""):Pe+=Je}Ee.push(Pe.trim());const De={name:Ee[ee.indexOf("name")]||"",tier:parseInt(Ee[ee.indexOf("tier")])||1,type:Ee[ee.indexOf("type")]||"Standard",difficulty:parseInt(Ee[ee.indexOf("difficulty")])||11,thresholds:{major:parseInt(Ee[ee.indexOf("threshold_major")])||7,severe:parseInt(Ee[ee.indexOf("threshold_severe")])||12},hpMax:parseInt(Ee[ee.indexOf("hp_max")])||3,stressMax:parseInt(Ee[ee.indexOf("stress_max")])||1,atk:parseInt(Ee[ee.indexOf("atk")])||1,weapon:Ee[ee.indexOf("weapon")]||"",range:Ee[ee.indexOf("range")]||"Melee",damage:Ee[ee.indexOf("damage")]||"",description:Ee[ee.indexOf("description")]||"",motives:Ee[ee.indexOf("motives")]||"",source:"Homebrew"};De.name&&B.push(De)}}else if(a){const V=JSON.parse(ae.target.result);if(!V.customAdversaries||!Array.isArray(V.customAdversaries))throw new Error("Invalid JSON format. Expected customAdversaries array.");B=V.customAdversaries}const H=ge.adversaries||[],T=[...H];let R=0,N=0;B.forEach(V=>{if(H.some(ee=>ee.name===V.name&&ee.source===V.source))N++;else{const ee={...V,id:`custom-adv-${Date.now()}-${Math.random().toString(36).slice(2,10)}`,hp:0,stress:0};T.push(ee),R++}}),R>0?(localStorage.setItem("daggerheart-custom-adversaries",JSON.stringify(T)),window.location.reload(),alert(`Import successful! Added ${R} new adversaries${N>0?`, skipped ${N} duplicates`:""}.`)):alert("No new adversaries were added. All imported adversaries already exist.")}catch(B){console.error("Failed to import custom adversaries:",B),alert(`Failed to import custom adversaries: ${B.message}`)}},L.readAsText(fe),b.target.value=""},x=()=>{D(null)},h=async(b,fe)=>{fe?E(fe,b):g(b)},r=b=>{Y[b]?(P&&P(b),je(fe=>{const ke={...fe};return delete ke[b],ke}),Te.current[b]&&(clearTimeout(Te.current[b]),delete Te.current[b])):(je(fe=>({...fe,[b]:!0})),Te.current[b]&&clearTimeout(Te.current[b]),Te.current[b]=setTimeout(()=>{je(fe=>{const ke={...fe};return delete ke[b],ke}),delete Te.current[b]},3e3))};m.useEffect(()=>()=>{Object.values(Te.current).forEach(b=>{clearTimeout(b)})},[]);const{searchTerm:n,setSearchTerm:q,sortFields:O,handleSort:$,filteredAndSortedData:U,loading:Ce,selectedTiers:l,selectedTypes:S,showTierDropdown:o,setShowTierDropdown:j,showTypeDropdown:J,setShowTypeDropdown:k,tierFilterRef:K,typeFilterRef:we,uniqueTiers:Me,uniqueTypes:he,handleTierSelect:u,handleTypeSelect:A,isTierFiltered:F,isTypeFiltered:se,getDropdownStyle:X}=sr(t,v,p,y,te),me=(()=>{const b=3*p+2,fe=v.reduce((R,N)=>{if(N.type==="adversary"){const V=Ye[N.item.type]||2;if(N.item.type==="Minion"){const z=Math.ceil(N.quantity/p);return R+z*V}else return R+N.quantity*V}return R},0);let ke=0;v.filter(R=>R.type==="adversary"&&R.item.type==="Solo"&&R.quantity>0).reduce((R,N)=>R+N.quantity,0)>=2&&(ke+=Qe.twoOrMoreSolos);const L=v.some(R=>R.type==="adversary"&&R.item.type==="Bruiser"&&R.quantity>0),ae=v.some(R=>R.type==="adversary"&&R.item.type==="Horde"&&R.quantity>0),B=v.some(R=>R.type==="adversary"&&R.item.type==="Leader"&&R.quantity>0),H=v.some(R=>R.type==="adversary"&&R.item.type==="Solo"&&R.quantity>0);return!L&&!ae&&!B&&!H&&(ke+=Qe.noBruisersHordesLeadersSolos),b+ke-fe})(),ue=b=>{Re(b),ce(!1)},oe=Se!=="all";return Ce?e.jsx("div",{style:pe.browser,children:e.jsx("div",{style:pe.loading,children:"Loading..."})}):e.jsx(e.Fragment,{children:e.jsxs("div",{style:f?pe.browserWrapper:pe.browserWrapperNoContainer,children:[_==="adversaries"&&e.jsxs(e.Fragment,{children:[e.jsx(or,{searchTerm:n,onSearchChange:q,type:t,partyControls:W,autoFocus:Le,onClose:le,placeholder:de}),!re&&e.jsx(ar,{showCustomToggle:ve,onToggleCustom:Q,filterCustom:te,onExportCustomAdversaries:be,onImportCustomAdversaries:i}),e.jsx("div",{className:"browser-content invisible-scrollbar",style:pe.browserContent,children:e.jsxs("table",{style:pe.browserTable,children:[e.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,backgroundColor:"var(--bg-primary)"},children:e.jsx(ir,{sortFields:O,onSort:$,type:t,uniqueTiers:Me,uniqueTypes:he,selectedTiers:l,selectedTypes:S,showTierDropdown:o,setShowTierDropdown:j,showTypeDropdown:J,setShowTypeDropdown:k,tierFilterRef:K,typeFilterRef:we,handleTierSelect:u,handleTypeSelect:A,isTierFiltered:F,isTypeFiltered:se,getDropdownStyle:X,costFilter:Se,showCostDropdown:ne,setShowCostDropdown:ce,costFilterRef:We,handleCostFilterSelect:ue,isCostFiltered:oe})}),e.jsx("tbody",{children:U.map(b=>e.jsx(lr,{item:b,onAdd:s,type:t,onRowClick:d,encounterItems:v,pcCount:p,playerTier:y,remainingBudget:me,costFilter:Se,onAdversaryClick:fe=>{t==="adversary"&&(G&&G.id===fe.id?Z&&Z(null):Z&&Z(fe))}},b.id))})]})})]}),_==="encounters"&&e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:M.length===0?e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",textAlign:"center",padding:"2rem 1rem"},children:"No saved encounters yet"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:M.map(b=>e.jsxs("div",{onClick:()=>I&&I(b.id),className:"saved-encounter-card",style:{border:"1px solid var(--border)",borderRadius:"8px",padding:"8px",backgroundColor:"var(--bg-card)",transition:"background-color 0.2s ease",display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsxs("div",{style:{minWidth:"100px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",flexDirection:"column",justifyContent:"center",minHeight:"60px"},children:[e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Tier: ",(()=>{var a,L,ae,B;const fe=((B=(ae=(L=(a=b.encounterItems)==null?void 0:a.filter(H=>H.type==="adversary"))==null?void 0:L.map(H=>H.item.tier))==null?void 0:ae.filter(H=>H!=null))==null?void 0:B.sort((H,T)=>H-T))||[];if(fe.length===0)return"N/A";if(fe.length===1)return fe[0];const ke=[...new Set(fe)];return ke.length===1?ke[0]:`${Math.min(...ke)}-${Math.max(...ke)}`})()]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Party Size: ",b.partySize||4]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)"},children:["Balance: ",(()=>{const fe=b.partySize||4,ke=3*fe+2;let a=0;const L=b.encounterItems||[];L.filter(z=>z.type==="adversary"&&z.item.type==="Solo"&&z.quantity>0).reduce((z,ee)=>z+ee.quantity,0)>=2&&(a+=Qe.twoOrMoreSolos);const B=L.some(z=>z.type==="adversary"&&z.item.type==="Bruiser"&&z.quantity>0),H=L.some(z=>z.type==="adversary"&&z.item.type==="Horde"&&z.quantity>0),T=L.some(z=>z.type==="adversary"&&z.item.type==="Leader"&&z.quantity>0),R=L.some(z=>z.type==="adversary"&&z.item.type==="Solo"&&z.quantity>0);!B&&!H&&!T&&!R&&(a+=Qe.noBruisersHordesLeadersSolos);const N=ke+a,V=L.reduce((z,ee)=>{if(ee.type==="adversary"){const Ie=Ye[ee.item.type]||2;if(ee.item.type==="Minion"){const Ee=Math.ceil(ee.quantity/fe);return z+Ee*Ie}else return z+ee.quantity*Ie}return z},0);return V>N?`+${V-N}`:V===N?"0":`-${N-V}`})()]})]}),e.jsx("div",{style:{minWidth:"120px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",alignItems:"center",minHeight:"60px"},children:e.jsx("div",{style:{fontWeight:"500",color:"var(--text-primary)",fontSize:"0.9rem",wordWrap:"break-word",wordBreak:"break-word",width:"150px",maxWidth:"150px"},children:b.name})}),e.jsx(rr,{encounter:b}),e.jsx("button",{onClick:fe=>{fe.stopPropagation(),r(b.id)},style:{background:Y[b.id]?"var(--danger)":"var(--gray-600)",border:"none",color:"white",padding:"0.4rem 0.8rem",borderRadius:"4px",fontSize:"0.75rem",cursor:"pointer",minWidth:"60px",transition:"background-color 0.2s"},children:"Delete"})]},b.id))})}),_==="create"&&e.jsx(kt,{onSave:h,onRefresh:()=>{},onAddItem:s,editingAdversary:w,onCancelEdit:x}),_==="info"&&e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"2rem"},children:[e.jsxs("div",{style:{marginBottom:"2rem",textAlign:"center"},children:[e.jsx("img",{src:er,alt:"Daggerheart Community Content Logo",style:{width:"100%",maxWidth:"300px",height:"auto",margin:"0 auto 1.5rem auto",display:"block"},onError:b=>{console.error("Failed to load Daggerheart logo:",b.target.src),b.target.style.display="none"}}),e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",textAlign:"left",maxWidth:"600px",margin:"0 auto"},children:[e.jsx("p",{style:{marginTop:0},children:"This product includes materials from the Daggerheart System Reference Document 1.0, © Critical Role, LLC, under the terms of the Darrington Press Community Gaming (DPCGL) License."}),e.jsxs("p",{children:["More information can be found at ",e.jsx("a",{href:"https://www.daggerheart.com",target:"_blank",rel:"noopener noreferrer",style:{color:"var(--purple)",textDecoration:"underline"},children:"daggerheart.com"})]}),e.jsx("p",{style:{marginBottom:0},children:e.jsx("em",{children:"This project is unofficial and not endorsed by Darrington Press or Critical Role."})})]})]}),e.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto",border:"1px solid var(--border)",borderRadius:"8px",overflow:"hidden"},children:[e.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"1rem 1.5rem",color:"var(--text-primary)",border:"none",background:"var(--bg-secondary)",width:"100%",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"0.875rem",borderBottom:"1px solid var(--border)"},onMouseEnter:b=>{b.target.style.backgroundColor="var(--bg-hover)"},onMouseLeave:b=>{b.target.style.backgroundColor="var(--bg-secondary)"},onClick:b=>{b.stopPropagation(),window.open("https://github.com/Splinter714/Daggerheart","_blank")},children:[e.jsx("span",{children:"View on GitHub"}),e.jsx("span",{children:"→"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem 1.5rem",color:"var(--text-secondary)",background:"var(--bg-secondary)",fontSize:"0.875rem"},children:["Version ","0.4.2 (a540ff3)"]})]})]})]})})},pe={browserWrapper:{display:"flex",flexDirection:"column",background:"var(--bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border)",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserWrapperNoContainer:{display:"flex",flexDirection:"column",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserContent:{flex:1,overflowY:"auto",overflowX:"visible",padding:0,width:"100%",scrollbarWidth:"none",msOverflowStyle:"none"},tableHeaderContainer:{flexShrink:0,position:"sticky",top:0,zIndex:15,backgroundColor:"var(--bg-secondary)"},browserTable:{width:"100%",minWidth:"100%",borderCollapse:"collapse",tableLayout:"fixed",background:"var(--bg-primary)",margin:0},browserHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--gray-900)",flexShrink:0,position:"sticky",top:0,zIndex:20},browserTitle:{margin:0,color:"var(--text-primary)",fontSize:"18px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"24px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",marginRight:"12px",transition:"all 0.2s ease"},partyControls:{display:"flex",alignItems:"center",gap:"12px",flexShrink:0},searchInputFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 3px rgba(139, 92, 246, 0.1)"},tableHeader:{background:"var(--gray-900)",borderBottom:"1px solid var(--border)",boxShadow:"0 1px 0 var(--border)",position:"sticky",top:"0",zIndex:10},tableHeaderCell:{backgroundColor:"var(--gray-900)",fontWeight:"700",borderBottom:"1px solid var(--border)",cursor:"pointer",userSelect:"none",minWidth:"100px",whiteSpace:"nowrap",padding:"4px 4px",color:"var(--text-primary)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",boxShadow:"0 1px 0 var(--border)",transition:"background-color 0.2s",position:"sticky",top:"0",zIndex:10},tableHeaderCellHover:{backgroundColor:"var(--bg-hover)"},sortIndicator:{fontSize:"12px",color:"var(--text-secondary)"},tableBody:{flex:1,overflowY:"auto",padding:"8px",backgroundColor:"var(--bg-primary)"},row:{height:"35px",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s ease",cursor:"pointer",backgroundColor:"var(--gray-900)"},rowHover:{backgroundColor:"var(--bg-secondary)"},expandedRow:{backgroundColor:"var(--bg-secondary)"},rowCell:{padding:"4px 4px",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid var(--border)"},rowCellName:{fontWeight:"500",minWidth:"150px"},rowCellCenter:{textAlign:"center",justifyContent:"center",minWidth:"80px"},rowActions:{width:"80px",textAlign:"center",padding:"4px 8px",borderBottom:"1px solid var(--border)"},addButton:{width:"2rem",height:"2rem",border:"1px solid var(--purple)",borderRadius:"var(--radius-sm)",background:"var(--purple)",color:"white",cursor:"pointer",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"500"},expandedContent:{padding:"0",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)"},columnName:{width:"auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",paddingLeft:"8px",textAlign:"left"},columnTier:{width:"80px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnType:{width:"100px",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},columnDifficulty:{width:"40px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnAction:{width:"32px",minWidth:"24px",maxWidth:"24px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"visible",textOverflow:"unset"},loading:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"var(--text-primary)",fontSize:"16px"},mobileBrowser:{width:"95vw",height:"90vh",maxWidth:"none"},mobileSearchInput:{fontSize:"16px"},headerWithFilter:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0px",position:"relative"},headerFilterIcon:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"2px 4px",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",position:"relative",marginLeft:"-2px"},headerFilterIconActive:{color:"var(--purple)"},filterIcon:{fontSize:"12px"},filterActiveDot:{position:"absolute",left:"50%",top:"2px",transform:"translateX(-50%)",width:"4px",height:"4px",borderRadius:"50%",background:"var(--purple)",pointerEvents:"none"},filterDropdown:{position:"fixed",background:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",zIndex:99999,marginTop:"4px",overflow:"hidden",width:"max-content",minWidth:"120px",maxWidth:"200px"},filterOption:{padding:"8px 12px",cursor:"pointer",color:"var(--text-primary)",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background-color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},filterOptionSelected:{backgroundColor:"var(--bg-hover)"},checkIcon:{width:"16px",height:"16px",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"12px"},filterLabel:{flex:1}},dr=()=>e.jsx("div",{className:"pwa-install-prompt",style:{}}),cr=({side:t="left",children:s,className:c="",style:d={}})=>{const v=t==="left",p={flex:1,minWidth:0,background:"var(--bg-primary)",overflowY:"auto",overflowX:v?"auto":"hidden",display:v?"block":"flex",flexDirection:v?"initial":"column",height:"100%",padding:v?"8px 0 8px 0":"0 8px 0 0",...d};return e.jsx("div",{className:c,style:p,children:s})},pr=t=>3*t+2,ur={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},st={lessDifficult:-1,twoOrMoreSolos:-2,increasedDamage:-2,lowerTierAdversary:1,noBruisersHordesLeadersSolos:1,moreDangerous:2},mr=({isOpen:t,onClose:s,onAddAdversary:c,onAddAdversariesBulk:d,onAddEnvironment:v,onDeleteAdversary:p,onDeleteEnvironment:y,onDeleteCountdown:W,adversaries:f=[],environments:M=[],countdowns:I=[],savedEncounters:P=[],onSaveEncounter:_,onLoadEncounter:C,onDeleteEncounter:ie})=>{const{partySize:xe,updatePartySize:G,currentEncounterName:Z,updateCurrentEncounterName:te,customContent:ve}=ct(),Q=xe,Ae=G,[ze,Le]=m.useState({lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),[re,le]=m.useState([]),[de,g]=m.useState(Z||"Encounter"),[E,ge]=m.useState("adversaries"),[w,D]=m.useState(null),[Se,Re]=m.useState(null),[ne,ce]=m.useState(null),[Y,je]=m.useState(null),[Te,We]=m.useState(!1);m.useEffect(()=>{t&&!w&&g(Z||"Encounter")},[t,w,Z]);const be=()=>Se?de!==Se.name||JSON.stringify(re)!==JSON.stringify(Se.encounterItems)||Q!==Se.partySize||JSON.stringify(ze)!==JSON.stringify(Se.battlePointsAdjustments):!1,i=()=>{var u;if(re.length>0||(de||"").trim()!=="Encounter")return!0;if(w&&be()){if(Se){const A=re.length,F=((u=Se.encounterItems)==null?void 0:u.length)||0;if(A!==F||(de||"").trim()!==(Se.name||""))return!0;const se=JSON.stringify(ze),X=JSON.stringify(Se.battlePointsAdjustments||{});return se!==X}return!0}return!1},x=({onClick:u,children:A,variant:F="secondary",isConfirmation:se=!1})=>{const X=F==="danger"||F==="secondary"&&se,ye=F==="purple";return e.jsx("button",{onClick:u,style:{background:X?"var(--danger)":ye?"var(--purple)":"var(--bg-secondary)",border:ye?"none":"1px solid var(--border)",color:X||ye?"white":"var(--text-primary)",padding:"0.375rem 0.75rem",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s",width:"70px",fontSize:"0.875rem"},children:A})},h=$e.useRef(Q),r=m.useCallback(u=>!u||u.length===0?null:P.find(F=>{var me,ue;if(((me=F.encounterItems)==null?void 0:me.length)!==u.length)return!1;const se=oe=>{var b;return{type:oe.type,quantity:oe.quantity,item:{name:oe.item.baseName||((b=oe.item.name)==null?void 0:b.replace(/\s+\(\d+\)$/,""))||oe.item.name,type:oe.item.type,tier:oe.item.tier}}},X=(ue=F.encounterItems)==null?void 0:ue.map(se).sort((oe,b)=>oe.item.name.localeCompare(b.item.name)||oe.item.type.localeCompare(b.item.type)),ye=u.map(se).sort((oe,b)=>oe.item.name.localeCompare(b.item.name)||oe.item.type.localeCompare(b.item.type));return JSON.stringify(X)===JSON.stringify(ye)})||null,[P]);$e.useEffect(()=>{if(t&&f.length>0&&re.length===0){const u={};f.forEach(se=>{var ye;const X=se.baseName||((ye=se.name)==null?void 0:ye.replace(/\s+\(\d+\)$/,""))||se.name;u[X]||(u[X]={type:"adversary",item:se,quantity:0}),u[X].quantity+=1});const A=Object.values(u);le(A);const F=r(A);F&&!w&&(D(F.id),Re({name:F.name||"",encounterItems:F.encounterItems||[],partySize:F.partySize||4,battlePointsAdjustments:F.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),g(F.name||"Encounter"),te(F.name||"Encounter"))}else t&&f.length===0&&re.length===0&&le([])},[t,r,w,te]);const n=$e.useMemo(()=>{let u=0;re.filter(me=>me.type==="adversary"&&me.item.type==="Solo"&&me.quantity>0).reduce((me,ue)=>me+ue.quantity,0)>=2&&(u+=st.twoOrMoreSolos);const F=re.some(me=>me.type==="adversary"&&me.item.type==="Bruiser"&&me.quantity>0),se=re.some(me=>me.type==="adversary"&&me.item.type==="Horde"&&me.quantity>0),X=re.some(me=>me.type==="adversary"&&me.item.type==="Leader"&&me.quantity>0),ye=re.some(me=>me.type==="adversary"&&me.item.type==="Solo"&&me.quantity>0);return!F&&!se&&!X&&!ye&&(u+=st.noBruisersHordesLeadersSolos),u},[re]),q=pr(Q),O=Object.entries(ze).filter(([u,A])=>A).reduce((u,[A,F])=>u+st[A],0),$=q+O+n,U=re.reduce((u,A)=>{if(A.type==="adversary"){const F=ur[A.item.type]||2;return A.item.type==="Minion"?u+Math.ceil(A.quantity/Q)*F:u+F*A.quantity}return u},0);$e.useEffect(()=>{const u=h.current;u!==Q&&(le(A=>A.map(F=>{if(F.type==="adversary"&&F.item.type==="Minion"){const X=Math.ceil(F.quantity/u)*Q;return{...F,quantity:X}}return F})),h.current=Q)},[Q]);const Ce=(u,A)=>{const F=re.findIndex(ye=>ye.item.id===u.id&&ye.type===A),se=u.type==="Minion"?Q:1;let X;F>=0?X=re.map((ye,me)=>me===F?{...ye,quantity:ye.quantity+se}:ye):X=[...re,{item:u,type:A,quantity:se}],le(X),l(X)},l=u=>{const A=f||[],F=[];u.forEach(ue=>{for(let oe=0;oe<ue.quantity;oe++)ue.type==="adversary"&&F.push(ue.item)});const se={};A.forEach(ue=>{var b;const oe=ue.baseName||((b=ue.name)==null?void 0:b.replace(/\s+\(\d+\)$/,""))||ue.name;se[oe]||(se[oe]=[]),se[oe].push(ue)});const X={};F.forEach(ue=>{var b;const oe=ue.baseName||((b=ue.name)==null?void 0:b.replace(/\s+\(\d+\)$/,""))||ue.name;X[oe]||(X[oe]=[]),X[oe].push(ue)});const ye=[],me=[];Object.keys(X).forEach(ue=>{var fe;const oe=((fe=se[ue])==null?void 0:fe.length)||0,b=X[ue].length;if(b>oe){const ke=b-oe;for(let a=0;a<ke;a++)ye.push(X[ue][0])}else if(b<oe){const ke=oe-b,L=[...se[ue]].sort((ae,B)=>{const H=ae.duplicateNumber||1;return(B.duplicateNumber||1)-H});for(let ae=0;ae<ke;ae++)me.push(L[ae].id)}}),Object.keys(se).forEach(ue=>{X[ue]||[...se[ue]].sort((fe,ke)=>{const a=fe.duplicateNumber||1;return(ke.duplicateNumber||1)-a}).forEach(fe=>{me.push(fe.id)})}),me.forEach(ue=>{p(ue)}),ye.length>0&&d(ye)},S=(u,A)=>{const F=(()=>{const se=re.findIndex(X=>X.item.id===u&&X.type===A);if(se>=0){const X=re[se];if(X.quantity===0)return re.filter((ue,oe)=>oe!==se);const ye=X.item.type==="Minion"?Q:1,me=Math.max(0,X.quantity-ye);return re.map((ue,oe)=>oe===se?{...ue,quantity:me}:ue)}return re})();le(F),l(F)},o=m.useCallback(()=>{if(re.length===0)return null;const u=(de||"").trim()||"Encounter",A=P.find(F=>{var ye,me;if(F.name!==u||((ye=F.encounterItems)==null?void 0:ye.length)!==re.length)return!1;const se=JSON.stringify((me=F.encounterItems)==null?void 0:me.sort()),X=JSON.stringify([...re].sort());return se===X});return(A==null?void 0:A.id)||null},[P,de,re]),j=m.useCallback(()=>{let u=(de||"").trim(),A=w;if(A||(A=o()),re.length===0&&(!u||u==="Encounter")&&A){ie(A),D(null),Re(null);return}const F={name:u,encounterItems:re,partySize:Q,battlePointsAdjustments:ze};if(A){F.id=A;const se=_(F);D(se)}else{const se=_(F);D(se)}Re({name:u,encounterItems:re,partySize:Q,battlePointsAdjustments:ze})},[re,de,Q,ze,w,_,o,ie]);m.useEffect(()=>{if(w&&be()){const u=setTimeout(()=>{j()},2e3);return()=>clearTimeout(u)}else if(!w&&re.length>0&&de&&de.trim()!==""){const u=setTimeout(()=>{j()},2e3);return()=>clearTimeout(u)}},[re,w,de,ze,Q]);const J=()=>{i()&&(le([]),g("Encounter"),te("Encounter"),D(null),Re(null),f.forEach(u=>{p(u.id)}),M.forEach(u=>{y(u.id)}),I.forEach(u=>{W(u.id)}))},k=u=>{const A=C(u);if(A){const F=A.encounterItems||[];le(F),Ae(A.partySize||4),Le(A.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),g(A.name||""),te(A.name||""),D(u),Re({name:A.name||"",encounterItems:A.encounterItems||[],partySize:A.partySize||4,battlePointsAdjustments:A.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),l(F)}},K=u=>{ie(u),w===u&&(le([]),g("Encounter"),te("Encounter"),D(null),Re(null),f.forEach(A=>{p(A.id)}),M.forEach(A=>{y(A.id)}),I.forEach(A=>{W(A.id)}))},we=()=>{try{const u={version:"1.0",exportDate:new Date().toISOString(),customAdversaries:ve.adversaries||[]},A=JSON.stringify(u,null,2),F=new Blob([A],{type:"application/json"}),se=URL.createObjectURL(F),X=document.createElement("a");X.href=se,X.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(X),X.click(),document.body.removeChild(X),URL.revokeObjectURL(se),console.log("Custom adversaries exported successfully")}catch(u){console.error("Failed to export custom adversaries:",u),alert("Failed to export custom adversaries. Please try again.")}},Me=u=>{const A=u.target.files[0];if(!A)return;const F=new FileReader;F.onload=se=>{try{const X=JSON.parse(se.target.result);if(!X.customAdversaries||!Array.isArray(X.customAdversaries))throw new Error("Invalid file format. Expected customAdversaries array.");const ye=ve.adversaries||[],me=X.customAdversaries,ue=[...ye];let oe=0;me.forEach(b=>{ye.some(ke=>ke.name===b.name&&ke.type===b.type)||(ue.push({...b,id:`custom-${Date.now()}-${Math.random().toString(36).slice(2,10)}`}),oe++)}),updateCustomContent("adversary",null,ue),oe>0?alert(`Successfully imported ${oe} custom adversaries.`):alert("No new adversaries were added. All imported adversaries already exist.")}catch(X){console.error("Failed to import custom adversaries:",X),alert("Failed to import custom adversaries. Please check the file format and try again.")}},F.readAsText(A),u.target.value=""};if(!t)return null;const he=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://");return e.jsx("div",{onClick:s,className:"encounter-builder-modal",style:{position:"fixed",top:0,left:0,right:0,bottom:he?"calc(60px + env(safe-area-inset-bottom) + 1rem)":"calc(60px + env(safe-area-inset-bottom))",backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:1e3,display:"flex",alignItems:"flex-start",justifyContent:"center",padding:"12px"},children:e.jsxs("div",{onClick:u=>u.stopPropagation(),style:{backgroundColor:"var(--bg-primary)",border:"2px solid var(--border)",borderRadius:"12px",width:"100%",maxWidth:"1200px",height:"100%",maxHeight:"100%",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"},children:[e.jsxs("div",{className:"encounter-top-bar",style:{flex:"0 0 auto",display:"flex",alignItems:"center",height:"39px",backgroundColor:"var(--bg-primary)",borderBottom:"1px solid var(--border)"},children:[e.jsx("button",{onClick:()=>ge("adversaries"),style:{flex:1,background:E==="adversaries"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:E==="adversaries"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Builder"}),e.jsx("button",{onClick:()=>ge("encounters"),style:{flex:1,background:E==="encounters"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:E==="encounters"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Saved Encounters"}),e.jsx("button",{onClick:()=>ge("create"),style:{flex:1,background:E==="create"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:E==="create"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Create Adversary"}),e.jsx("button",{onClick:()=>ge("info"),style:{flex:1,background:E==="info"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:E==="info"?"500":"400",transition:"all 0.2s ease",position:"relative"},children:"Info"})]}),e.jsxs("div",{className:"encounter-builder-content",style:{flex:1,display:"flex",overflow:"hidden"},children:[e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",borderTop:"1px solid var(--border)"},children:e.jsx(It,{type:"adversary",onAddItem:u=>Ce(u,"adversary"),encounterItems:re,pcCount:Q,showContainer:!1,savedEncounters:P,onLoadEncounter:k,onDeleteEncounter:K,activeTab:E,selectedCustomAdversaryId:ne,onSelectCustomAdversary:ce,onTabChange:ge,selectedAdversary:Y,onSelectAdversary:je,filterCustom:Te,showCustomToggle:!0,onToggleCustom:We,onExportCustomAdversaries:we,onImportCustomAdversaries:Me})}),E!=="info"&&e.jsxs("div",{className:"encounter-right-panel",style:{flex:1,borderLeft:"1px solid var(--border)",display:"flex",flexDirection:"column",overflow:"hidden",position:"relative"},children:[Y&&e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"var(--bg-primary)",zIndex:10,display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)",flexShrink:0},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:0},children:"Adversary Preview"}),e.jsx("button",{onClick:()=>je(null),style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease"},onMouseEnter:u=>u.target.style.color="var(--text-primary)",onMouseLeave:u=>u.target.style.color="var(--text-secondary)",title:"Close preview",children:e.jsx(Ve,{size:16})})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"0.75rem"},children:e.jsx(et,{item:{...Y,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...Y,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}})})]}),(E==="adversaries"||E==="encounters")&&e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-primary)",flexShrink:0},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:de,onChange:u=>{g(u.target.value),te(u.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(x,{onClick:J,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:i()?1:.5,cursor:i()?"pointer":"not-allowed"},children:"New"})]})}),(E==="adversaries"||E==="encounters")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"encounter-receipt-buttons-vertical",style:{display:"none",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:de,onChange:u=>{g(u.target.value),te(u.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(x,{onClick:J,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:i()?1:.5,cursor:i()?"pointer":"not-allowed"},children:"New"})]})}),e.jsx("div",{className:"receipt-content",style:{padding:"1rem",display:"flex",flexDirection:"column",height:"100%"},children:e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"flex-start",overflowY:"auto",marginBottom:"0.75rem"},children:[e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>Ae(Math.max(1,Q-1)),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(at,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:Q}),e.jsx("button",{onClick:()=>Ae(Q+1),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(Ge,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Party Size"})}),e.jsx("div",{style:{width:"120px",textAlign:"right"}})]}),re.map(u=>{var A;return u.type!=="adversary"?null:e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>S(u.item.id,u.type),style:{background:u.quantity===0?"var(--danger)":"var(--bg-secondary)",border:u.quantity===0?"none":"1px solid var(--border)",color:u.quantity===0?"white":"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:u.quantity===0?e.jsx(Ve,{size:10}):e.jsx(at,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:u.quantity}),e.jsx("button",{onClick:()=>Ce(u.item,u.type),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(Ge,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:u.item.baseName||((A=u.item.name)==null?void 0:A.replace(/\s+\(\d+\)$/,""))||u.item.name})}),e.jsx("div",{style:{width:"80px",textAlign:"right"},children:e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.8rem"},children:u.item.type})})]},`${u.item.id}-${u.type}`)}),e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Balance"})}),e.jsx("div",{style:{width:"120px",textAlign:"right",display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsx("span",{style:{color:U>$?"var(--danger)":U===$?"var(--purple)":"var(--success)",fontWeight:600},children:U>$?`+${U-$}`:$-U===0?"0":`-${$-U}`})})]})]})})]}),E==="create"&&e.jsxs("div",{style:{padding:"1.5rem",overflowY:"auto",height:"100%"},children:[e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Creating Adversaries"}),e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsx("p",{children:"Use the form to create custom adversaries for your encounters."}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Adversary Types:"}),e.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Minion (1 BP):"})," Weak enemies in groups"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Standard (2 BP):"})," Average threat level"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Leader (3 BP):"})," Commands others"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Bruiser (4 BP):"})," High HP tank"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Solo (5 BP):"})," Boss-level threat"]})]})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Tips:"}),e.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[e.jsx("li",{children:"Match adversary tier to party level"}),e.jsx("li",{children:"Balance encounter difficulty with Battle Points"}),e.jsx("li",{children:"Mix adversary types for variety"}),e.jsx("li",{children:"Add features that create interesting choices"})]})]})]})]}),E==="myAdversaries"&&e.jsx("div",{style:{padding:"0.75rem",overflowY:"auto",height:"100%"},children:ne?(()=>{var A;const u=(A=ve==null?void 0:ve.adversaries)==null?void 0:A.find(F=>F.id===ne);return u?e.jsx(et,{item:{...u,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...u,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}}):e.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Adversary not found"})})():e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Adversary Preview"}),e.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Select an adversary to view details"})]})})]})]})]})})},fr=t=>3*t+2,hr={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},vt={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1};class xr extends $e.Component{constructor(s){super(s),this.state={hasError:!1,error:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,c){console.error("ErrorBoundary caught an error:",s,c)}render(){var s;return this.state.hasError?e.jsxs("div",{className:"p-md text-red",children:[e.jsx("h3",{children:"Something went wrong:"}),e.jsx("pre",{children:(s=this.state.error)==null?void 0:s.toString()}),e.jsx("button",{className:"btn-base btn-text",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try again"})]}):this.props.children}}const gr=()=>{const{adversaries:t,environments:s,countdowns:c,fear:d,savedEncounters:v,partySize:p,updateFear:y,createAdversary:W,createAdversariesBulk:f,updateAdversary:M,deleteAdversary:I,createEnvironment:P,updateEnvironment:_,deleteEnvironment:C,createCountdown:ie,updateCountdown:xe,deleteCountdown:G,advanceCountdown:Z,saveEncounter:te,loadEncounter:ve,deleteEncounter:Q}=ct(),Ae=p||4,[ze,Le]=m.useState(!1),[re,le]=m.useState(!1);m.useState(!1),m.useState(!1),m.useState(!0);const[de,g]=m.useState(null),[E,ge]=m.useState(null),[w,D]=m.useState(null),[Se,Re]=m.useState(!1),[ne,ce]=m.useState(0),[Y,je]=m.useState(0),[Te,We]=m.useState(!1),[be,i]=m.useState(new Set),[x,h]=m.useState(new Set),r=m.useRef(null);m.useEffect(()=>{const a=()=>{const ae=window.matchMedia("(max-width: 800px)");Le(ae.matches)};a();const L=window.matchMedia("(max-width: 800px)");return L.addEventListener("change",a),()=>L.removeEventListener("change",a)},[]);const n=12,q=a=>a===1?200:350,O=a=>{if(a<=0)return{visibleColumns:1,columnWidth:q(1)};const L=n*2,ae=a-L;let B={visibleColumns:1,columnWidth:ae};for(let T=1;T<=5;T++){const R=(T-1)*n,N=(ae-R)/T;N>=q(T)&&T*N+R<=ae&&(B={visibleColumns:T,columnWidth:N})}return B.visibleColumns*B.columnWidth+(B.visibleColumns-1)*n>ae&&(B={visibleColumns:1,columnWidth:ae}),B},{visibleColumns:$,columnWidth:U}=O(ne);m.useEffect(()=>{const a=()=>{ce(window.innerWidth)};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]);const Ce=()=>{le(!0)},l=()=>{le(!re)},S=m.useCallback(()=>{le(!1)},[]),o=m.useCallback(a=>{ge(a)},[]),j=m.useCallback(()=>{ge(null)},[]),J=m.useCallback((a,L=600,ae="unknown")=>{if(console.log("[HORIZONTAL_SCROLL] smoothScrollTo called:",{targetScrollLeft:a,duration:L,reason:ae,timestamp:performance.now()}),!r.current){console.log("[HORIZONTAL_SCROLL] No container ref, aborting");return}const B=r.current,H=B.scrollLeft,T=a-H;if(console.log("[HORIZONTAL_SCROLL] Scroll params:",{startScrollLeft:H,targetScrollLeft:a,distance:T,containerWidth:B.clientWidth,scrollWidth:B.scrollWidth}),Math.abs(T)<1){console.log("[HORIZONTAL_SCROLL] Distance too small, skipping animation");return}B._horizontalScrollAnimationId&&(console.log("[HORIZONTAL_SCROLL] Canceling existing animation"),cancelAnimationFrame(B._horizontalScrollAnimationId),B._horizontalScrollAnimationId=null);const N=window.getComputedStyle(B).scrollSnapType!=="none",V=N?"x mandatory":null;console.log("[HORIZONTAL_SCROLL] Scroll-snap state:",{hasScrollSnap:N,originalScrollSnapType:V}),N&&(B.style.scrollSnapType="none");const z=performance.now();console.log("[HORIZONTAL_SCROLL] Starting animation at:",z);const ee=Ie=>{const Ee=Ie-z,Pe=Math.min(Ee/L,1),Be=1-Pe,De=1-Be*Be*Be;if(B){const He=H+T*De;B.scrollLeft=He}Pe<1?B._horizontalScrollAnimationId=requestAnimationFrame(ee):(console.log("[HORIZONTAL_SCROLL] Animation complete, final scrollLeft:",B.scrollLeft),B&&(B.scrollLeft=a,B._horizontalScrollAnimationId=null),V&&setTimeout(()=>{B&&(B.style.scrollSnapType=V,B.offsetHeight,console.log("[HORIZONTAL_SCROLL] Scroll-snap re-enabled"))},50))};return B._horizontalScrollAnimationId=requestAnimationFrame(ee),()=>{animationId&&cancelAnimationFrame(animationId),N&&B&&(B.style.scrollSnapType=V||"")}},[]),k=m.useCallback(()=>{const a={};return t.forEach(L=>{var B;const ae=L.baseName||((B=L.name)==null?void 0:B.replace(/\s+\(\d+\)$/,""))||L.name;a[ae]||(a[ae]={type:"adversary",baseName:ae,instances:[]}),a[ae].instances.push(L)}),c.forEach(L=>{a[`countdown-${L.id}`]={type:"countdown",baseName:L.name,instances:[L]}}),Object.values(a)},[t,c]),K=k(),we=m.useCallback(a=>{var H;const L=a.baseName||((H=a.name)==null?void 0:H.replace(/\s+\(\d+\)$/,""))||a.name,B=!K.find(T=>T.baseName===L&&T.type==="adversary");if(W(a),g("adversary"),B){const T=`adversary-${L}`;h(R=>new Set(R).add(T)),setTimeout(()=>{h(R=>{const N=new Set(R);return N.delete(T),N})},10)}setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!r.current)return;const T=r.current;if(!(T.scrollWidth<=T.clientWidth))if(B){const R=T.scrollWidth-T.clientWidth;console.log("[HORIZONTAL_SCROLL] New adversary added, calculating maxScroll:",{maxScroll:R,scrollWidth:T.scrollWidth,clientWidth:T.clientWidth}),setTimeout(()=>{console.log("[HORIZONTAL_SCROLL] Calling smoothScrollTo for new adversary, maxScroll:",R),J(R,600,"new-adversary")},10)}else{const N=k().findIndex(V=>V.baseName===L&&V.type==="adversary");if(N>=0){const V=r.current,z=V.scrollLeft,ee=V.clientWidth,Ie=N*(U+n),Ee=Ie+U+n,Pe=E!==null?U+n:0,Be=ee-Pe,De=10;Ie>=z-De&&Ee<=z+Be+De||J(Ie,600)}}})})},50)},[W,K,U,n,J,k,E]),Me=m.useCallback(()=>{W({name:"",baseName:"",tier:1,type:"Standard",description:"",motives:"",difficulty:11,thresholds:{major:7,severe:12},hpMax:3,stressMax:1,atk:1,weapon:"",range:"Melee",damage:"",experience:[],features:[],source:"Homebrew",hp:0,stress:0,isVisible:!0}),setTimeout(()=>{const L=k();for(const ae of L)if(ae.type==="adversary"){const B=ae.instances.find(H=>H.source==="Homebrew"&&(!H.baseName||H.baseName.trim()===""||H.baseName==="Unknown"));if(B&&!w){D(B.id),requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(r.current){r.current;const H=L.findIndex(T=>T.instances.some(R=>R.id===B.id));if(H>=0){const T=H*(U+n);J(T,600,"new-custom-adversary")}}})});break}}},100)},[W,k,U,n,J,w]),he=m.useCallback(a=>{D(a),Re(!1)},[]),u=m.useCallback(()=>{D(null),Re(!1)},[]),A=m.useCallback(async(a,L)=>{if(L)M(L,a),D(null);else if(w){const ae=W({...a,id:void 0});return D(null),ae}else{const ae=W({...a,id:void 0});return Re(!1),ae}},[w,W,M]),se=m.useCallback(()=>{const a={};return t.forEach(L=>{var B;const ae=L.baseName||((B=L.name)==null?void 0:B.replace(/\s+\(\d+\)$/,""))||L.name;a[ae]||(a[ae]={type:"adversary",item:L,quantity:0}),a[ae].quantity+=1}),Object.values(a)},[t])(),X=fr(Ae),ye=se.filter(a=>a.item.type==="Solo"&&a.quantity>0).reduce((a,L)=>a+L.quantity,0),me=se.some(a=>a.item.type&&["Bruiser","Horde","Leader","Solo"].includes(a.item.type)&&a.quantity>0);let ue=0;ye>=2&&(ue+=vt.twoOrMoreSolos),me||(ue+=vt.noBruisersHordesLeadersSolos);const oe=X+ue,b=se.reduce((a,L)=>{if(L.type==="adversary"){const ae=hr[L.item.type]||2;return L.item.type==="Minion"?a+Math.ceil(L.quantity/Ae)*ae:a+ae*L.quantity}return a},0),fe=m.useRef(null),ke=m.useCallback(a=>{je(a.target.scrollLeft),fe.current&&clearTimeout(fe.current),fe.current=setTimeout(()=>{const L=a.target;L&&L.style.scrollSnapType==="none"&&(L.style.scrollSnapType="x mandatory")},150)},[]);return m.useCallback(()=>{We(!0)},[]),m.useCallback(()=>{setTimeout(()=>We(!1),100)},[]),K.length,e.jsxs("div",{className:"app",onClick:a=>{a.target,a.currentTarget},children:[e.jsx(Yt,{position:"top",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",width:"100%",justifyContent:"space-between",padding:"0 1rem"},children:[e.jsx(qe,{type:"fear",value:(d==null?void 0:d.value)||0,maxValue:12,onChange:y,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0}),e.jsxs("button",{onClick:()=>{E!==null?j():o(K.length)},style:{padding:"0.5rem 1rem",backgroundColor:E!==null?"var(--purple)":"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:E!==null?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.875rem",fontWeight:"500",display:"flex",alignItems:"center",gap:"0.5rem",transition:"all 0.2s ease",flexShrink:0},onMouseEnter:a=>{E===null&&(a.target.style.borderColor="var(--purple)",a.target.style.backgroundColor="var(--bg-hover)")},onMouseLeave:a=>{E===null&&(a.target.style.borderColor="var(--border)",a.target.style.backgroundColor="var(--bg-secondary)")},children:[e.jsx(Ge,{size:16}),e.jsx("span",{children:"Add Adversaries"})]})]})}),e.jsx(Gt,{onToggle:l,isOpen:re}),e.jsxs("div",{className:"main-content",style:{position:"relative",width:"100%"},children:[E!==null&&e.jsxs("div",{style:{position:"absolute",top:`${n}px`,right:`${n}px`,bottom:`${n}px`,width:`${U}px`,backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",zIndex:100,display:"flex",flexDirection:"column",boxShadow:"-4px 0 12px rgba(0, 0, 0, 0.3)",overflow:"hidden"},children:[e.jsxs("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,display:"flex",flexDirection:"column"},children:[e.jsx("div",{style:{padding:"0.75rem",borderBottom:"1px solid var(--border)",display:"flex",justifyContent:"center"},children:e.jsxs("button",{onClick:Me,style:{padding:"0.5rem 1rem",backgroundColor:"var(--purple)",border:"none",color:"white",borderRadius:"8px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",transition:"opacity 0.2s ease"},onMouseEnter:a=>{a.target.style.opacity="0.9"},onMouseLeave:a=>{a.target.style.opacity="1"},children:[e.jsx(Ge,{size:16}),e.jsx("span",{children:"Add Custom"})]})}),e.jsx(It,{type:"adversary",onAddItem:we,showContainer:!1,activeTab:"adversaries",autoFocus:!0,hideImportExport:!0,onClose:j,searchPlaceholder:"Search adversaries"})]}),e.jsxs("div",{style:{flexShrink:0,borderTop:"1px solid var(--border)",backgroundColor:"var(--bg-primary)",padding:"0.75rem",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem",fontWeight:"500"},children:"Balance"}),e.jsx("span",{style:{color:b>oe?"var(--danger)":b===oe?"var(--purple)":"var(--success)",fontWeight:600,fontSize:"0.9rem"},children:b>oe?`+${b-oe}`:oe-b===0?"0":`-${oe-b}`})]})]}),e.jsx("div",{ref:r,className:"dashboard-scroll-container",style:{display:"flex",flexDirection:"row",overflowX:"auto",overflowY:"hidden",padding:`0 ${n}px 0 0`,paddingRight:E!==null?`${U+n*2}px`:`${n}px`,scrollSnapType:"x mandatory",height:"100%",width:"100%"},onScroll:ke,children:K.length===0?e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",width:"100%",padding:"2rem"},children:e.jsx("button",{onClick:Ce,style:{backgroundColor:"transparent",color:"var(--text-secondary)",border:"2px dashed var(--border)",borderRadius:"var(--radius-md)",padding:"1rem 2rem",fontSize:"1rem",fontWeight:"500",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:a=>{a.target.style.borderColor="var(--purple)",a.target.style.color="var(--purple)"},onMouseLeave:a=>{a.target.style.borderColor="var(--border)",a.target.style.color="var(--text-secondary)"},children:"Create Encounter"})}):K.map((a,L)=>{var ae,B;return e.jsx(cr,{style:{width:`${U+n}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:`${n}px`,paddingRight:"0",paddingTop:`${n}px`,paddingBottom:`${n}px`,scrollSnapAlign:"start",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"auto",opacity:be.has(`${a.type}-${a.baseName}`)||x.has(`${a.type}-${a.baseName}`)?0:1,transition:(be.has(`${a.type}-${a.baseName}`)||x.has(`${a.type}-${a.baseName}`),"opacity 0.4s ease")},children:e.jsx(et,{type:a.type,item:{...a.instances[0],name:a.baseName,hp:0,stress:0,isDead:!1},mode:"expanded",instances:a.instances,showCustomCreator:a.type==="adversary"&&w&&a.instances.some(H=>H.id===w),onSaveCustomAdversary:a.type==="adversary"&&w&&a.instances.some(H=>H.id===w)?A:void 0,onCancelEdit:a.type==="adversary"&&w&&a.instances.some(H=>H.id===w)?u:void 0,isStockAdversary:a.type==="adversary"&&w&&a.instances.some(H=>H.id===w)?!((ae=a.instances[0])!=null&&ae.source)||((B=a.instances[0])==null?void 0:B.source)!=="Homebrew":!1,onApplyDamage:a.type==="adversary"?(H,T,R,N)=>{const V=a.instances.find(z=>z.id===H);V&&M(H,{hp:Math.min(V.hpMax||1,(V.hp||0)+T)})}:void 0,onApplyHealing:a.type==="adversary"?(H,T,R)=>{const N=a.instances.find(V=>V.id===H);N&&M(H,{hp:Math.max(0,(N.hp||0)-T)})}:void 0,onApplyStressChange:a.type==="adversary"?(H,T)=>{var R,N;return M(H,{stress:Math.max(0,Math.min(((R=a.instances.find(V=>V.id===H))==null?void 0:R.stressMax)||6,(((N=a.instances.find(V=>V.id===H))==null?void 0:N.stress)||0)+T))})}:void 0,onUpdate:a.type==="adversary"?M:a.type==="environment"?_:xe,adversaries:t,showAddRemoveButtons:E!==null&&a.type==="adversary",onEdit:a.type==="adversary"?H=>he(H):void 0,onAddInstance:a.type==="adversary"?H=>{W(H),setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(r.current){const T=r.current,R=T.scrollLeft,N=T.clientWidth,z=k().findIndex(ee=>ee.baseName===a.baseName&&ee.type==="adversary");if(z>=0){const ee=z*(U+n),Ie=ee+U+n,Ee=E!==null?U+n:0,Pe=N-Ee,Be=10;ee>=R-Be&&Ie<=R+Pe+Be||J(ee,600)}}})})},50)}:void 0,onRemoveInstance:a.type==="adversary"?H=>{const T=a.instances.length===1,R=K.length>0&&K[K.length-1].baseName===a.baseName,N=`${a.type}-${a.baseName}`,V=a.instances.sort((z,ee)=>{const Ie=z.duplicateNumber||1;return(ee.duplicateNumber||1)-Ie});if(V.length>0){const z=V[0];T?(i(ee=>new Set(ee).add(N)),R&&K.length>1&&setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(r.current){const ee=r.current.scrollLeft,Ie=Math.max(0,ee-(U+n));J(Ie,500,"remove-rightmost-card")}})})},100),setTimeout(()=>{I(z.id),i(ee=>{const Ie=new Set(ee);return Ie.delete(N),Ie})},400)):I(z.id)}}:void 0})},`${a.type}-${a.baseName}`)})})]}),e.jsx(mr,{isOpen:re,onClose:S,onAddAdversary:a=>{W(a),g("adversary")},onAddAdversariesBulk:a=>{f(a),g("adversary")},onAddEnvironment:a=>{P(a),g("environment")},onDeleteAdversary:I,onDeleteEnvironment:C,onDeleteCountdown:G,adversaries:t,environments:s,countdowns:c,savedEncounters:v,onSaveEncounter:te,onLoadEncounter:ve,onDeleteEncounter:Q}),e.jsx(dr,{})]})},yr=()=>e.jsx(xr,{children:e.jsx(gr,{})});it.createRoot(document.getElementById("root")).render(e.jsx($e.StrictMode,{children:e.jsx(Vt,{children:e.jsx(yr,{})})}));
