import{r as f,a as ct,R as Ve}from"./dndkit-57209f9c.js";import{F as Lt,f as Nt,a as Bt,b as Dt,c as gt}from"./fa-b4bcccb0.js";import{D as It,A as Pt,C as Ht,X as Xe,M as pt,P as Ke,a as Ot,H as Ft,L as $t,b as _t,F as qt,S as Ue,c as et}from"./lucide-9f8be461.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const S of document.querySelectorAll('link[rel="modulepreload"]'))l(S);new MutationObserver(S=>{for(const p of S)if(p.type==="childList")for(const b of p.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&l(b)}).observe(document,{childList:!0,subtree:!0});function c(S){const p={};return S.integrity&&(p.integrity=S.integrity),S.referrerPolicy&&(p.referrerPolicy=S.referrerPolicy),S.crossOrigin==="use-credentials"?p.credentials="include":S.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function l(S){if(S.ep)return;S.ep=!0;const p=c(S);fetch(S.href,p)}})();var At={exports:{}},st={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vt=f,Gt=Symbol.for("react.element"),Yt=Symbol.for("react.fragment"),Jt=Object.prototype.hasOwnProperty,Xt=Vt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Kt={key:!0,ref:!0,__self:!0,__source:!0};function Et(t,s,c){var l,S={},p=null,b=null;c!==void 0&&(p=""+c),s.key!==void 0&&(p=""+s.key),s.ref!==void 0&&(b=s.ref);for(l in s)Jt.call(s,l)&&!Kt.hasOwnProperty(l)&&(S[l]=s[l]);if(t&&t.defaultProps)for(l in s=t.defaultProps,s)S[l]===void 0&&(S[l]=s[l]);return{$$typeof:Gt,type:t,key:p,ref:b,props:S,_owner:Xt.current}}st.Fragment=Yt;st.jsx=Et;st.jsxs=Et;At.exports=st;var e=At.exports,ut={},yt=ct;ut.createRoot=yt.createRoot,ut.hydrateRoot=yt.hydrateRoot;function _e(t){const s=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return t?`${t}-${s}`:s}const Mt=f.createContext();function ot(t){if(typeof localStorage>"u")return null;try{const s=localStorage.getItem(t);return s==null?null:JSON.parse(s)}catch{return null}}function qe(t,s){if(!(typeof localStorage>"u"))try{localStorage.setItem(t,JSON.stringify(s))}catch{}}const Zt=({children:t})=>{const[s,c]=f.useState({fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],currentEncounterName:"Encounter"}),[l,S]=f.useState(!1),[p,b]=f.useState({adversaries:[],environments:[]});f.useEffect(()=>{var r,n,I,C;const i=ot("daggerheart-game-state");if(i)try{(((r=i.adversaries)==null?void 0:r.length)>0||((n=i.environments)==null?void 0:n.length)>0||((I=i.countdowns)==null?void 0:I.length)>0||((C=i.savedEncounters)==null?void 0:C.length)>0)&&c(i)}catch(X){console.error("Failed to load saved state:",X)}const g=ot("daggerheart-custom-adversaries")||[],y=ot("daggerheart-custom-environments")||[];b({adversaries:g,environments:y}),S(!0)},[]),f.useEffect(()=>{qe("daggerheart-game-state",s)},[s]);const W=i=>{c(g=>({...g,fear:{...g.fear,value:i}}))},x=()=>{c(i=>({...i,fear:{...i.fear,visible:!i.fear.visible}}))},z=i=>{c(g=>({...g,partySize:Math.max(1,i)}))},$=i=>{c(g=>({...g,currentEncounterName:i||"Encounter"}))},N=i=>{if(i.id)return c(g=>({...g,savedEncounters:(g.savedEncounters||[]).map(y=>y.id===i.id?{...y,name:i.name||y.name,encounterItems:i.encounterItems||y.encounterItems,partySize:i.partySize||y.partySize,battlePointsAdjustments:i.battlePointsAdjustments||y.battlePointsAdjustments,updatedAt:new Date().toISOString()}:y)})),i.id;{const g={id:_e("encounter"),name:i.name||"Encounter",createdAt:new Date().toISOString(),encounterItems:i.encounterItems||[],partySize:i.partySize||4,battlePointsAdjustments:i.battlePointsAdjustments||{}};return c(y=>({...y,savedEncounters:[...y.savedEncounters||[],g]})),g.id}},T=i=>(s.savedEncounters||[]).find(y=>y.id===i),w=i=>{const g={id:_e("encounter"),name:i.name||`Encounter ${Date.now()}`,createdAt:new Date().toISOString(),encounterItems:i.encounterItems||[],partySize:i.partySize||4,battlePointsAdjustments:i.battlePointsAdjustments||{}};return c(y=>({...y,savedEncounters:[...y.savedEncounters||[],g]})),g.id},Y=i=>{c(g=>({...g,savedEncounters:(g.savedEncounters||[]).filter(y=>y.id!==i)}))},me=f.useRef(s);f.useEffect(()=>{me.current=s},[s]);const Ce={gameState:s,isLoaded:l,customContent:p,updateFear:W,toggleFearVisibility:x,updatePartySize:z,updateCurrentEncounterName:$,saveEncounter:N,saveEncounterAs:w,loadEncounter:T,deleteEncounter:Y,createCountdown:i=>{const g={id:_e("countdown"),name:i.name||"Countdown",max:parseInt(i.max)||1,value:0,visible:!0,type:i.type||"standard",loop:i.loop||"none",source:i.source||"campaign"};c(y=>({...y,countdowns:[...y.countdowns,g]}))},updateCountdown:(i,g)=>{c(y=>({...y,countdowns:y.countdowns.map(r=>r.id===i?{...r,...g}:r)}))},deleteCountdown:i=>{c(g=>({...g,countdowns:g.countdowns.filter(y=>y.id!==i)}))},advanceCountdown:(i,g)=>{c(y=>({...y,countdowns:y.countdowns.map(r=>{if(r.id!==i)return r;let n=g;if(r.loop==="loop")n>r.max?n=(n-1)%r.max+1:n<0&&(n=r.max);else if(r.loop==="increasing"){if(n>r.max)return{...r,max:r.max+1,value:1};if(n<0)return{...r,max:Math.max(1,r.max-1),value:1};n=Math.max(0,n)}else if(r.loop==="decreasing"){if(n>r.max)return{...r,max:Math.max(1,r.max-1),value:1};if(n<0)return{...r,max:r.max+1,value:1};n=Math.min(r.max,n)}else n=Math.max(0,Math.min(n,r.max));return{...r,value:n}})}))},incrementCountdown:(i,g=1)=>{c(y=>({...y,countdowns:y.countdowns.map(r=>{if(r.id!==i)return r;let n=r.value+g;if(r.loop==="loop")n>r.max&&(n=(n-1)%r.max+1);else if(r.loop==="increasing"){if(n>r.max)return{...r,max:r.max+1,value:1}}else if(r.loop==="decreasing"){if(n>r.max)return{...r,max:Math.max(1,r.max-1),value:1}}else n=Math.min(n,r.max);return{...r,value:n}})}))},decrementCountdown:i=>{c(g=>({...g,countdowns:g.countdowns.map(y=>{if(y.id!==i)return y;let r=y.value-1;if(y.loop==="loop")r<0&&(r=y.max);else if(y.loop==="increasing"){if(r<0)return{...y,max:Math.max(1,y.max-1),value:y.max};r=Math.max(0,r)}else if(y.loop==="decreasing"){if(r<0)return{...y,max:y.max+1,value:1}}else r=Math.max(0,r);return{...y,value:r}})}))},reorderCountdowns:i=>{c(g=>{const[y,r]=i,n=[...g.countdowns],[I]=n.splice(y,1);return n.splice(r,0,I),{...g,countdowns:n}})},createAdversary:i=>{var X;const g=_e("adv"),y=s.adversaries||[],r=i.baseName||((X=i.name)==null?void 0:X.replace(/\s+\(\d+\)$/,""))||i.name||"Unknown",n=y.filter(he=>he.baseName===r);let I=1;if(n.length===0)I=1;else{const he=n.map(Ae=>Ae.duplicateNumber||1);let je=1;for(;he.includes(je);)je++;I=je}const C={...i,id:g,baseName:r,duplicateNumber:I,name:`${r} (${I})`,hp:0,stress:0,isVisible:!0};c(he=>({...he,adversaries:[...he.adversaries,C]}))},createAdversariesBulk:i=>{const g=[],y={};i.forEach(r=>{var Oe;const n=r.baseName||((Oe=r.name)==null?void 0:Oe.replace(/\s+\(\d+\)$/,""))||r.name||"Unknown",X=(s.adversaries||[]).filter(a=>a.baseName===n).length,he=y[n]||0,je=X+he+1;y[n]=he+1;const Ae={...r,id:_e("adv"),baseName:n,duplicateNumber:je,name:`${n} (${je})`,hp:0,stress:0,isVisible:!0};g.push(Ae)}),c(r=>({...r,adversaries:[...r.adversaries,...g]}))},updateAdversary:(i,g)=>{c(y=>({...y,adversaries:y.adversaries.map(r=>{if(r.id===i){const n={...r,...g};if(g.baseName!==void 0){const I=g.baseName,C=n.duplicateNumber||1;n.name=C===1?I:`${I} (${C})`}return n}return r})}))},deleteAdversary:i=>{c(g=>({...g,adversaries:g.adversaries.filter(y=>y.id!==i)}))},clearAllAdversaries:()=>{c(i=>({...i,adversaries:[]}))},reorderAdversaries:i=>{c(g=>{const[y,r]=i,n=[...g.adversaries],[I]=n.splice(y,1);return n.splice(r,0,I),{...g,adversaries:n}})},bulkReorderAdversaries:i=>{c(g=>({...g,adversaries:i}))},createEnvironment:i=>{const g=_e("env"),r=(s.environments||[]).filter(C=>C.name.replace(/\s+\(\d+\)$/,"")===i.name);let n=i.name||"Unknown";if(r.length===0)n=i.name;else if(r.length===1){const C=r[0],X=C.name.replace(/\s+\(\d+\)$/,""),he=s.environments.map(je=>je.id===C.id?{...je,name:`${X} (1)`}:je);c(je=>({...je,environments:he})),n=`${i.name} (2)`}else{const C=r.map(he=>{const je=he.name.match(/\((\d+)\)$/);return je?parseInt(je[1]):null}).filter(he=>he!==null);let X=1;for(;C.includes(X);)X++;n=`${i.name} (${X})`}const I={...i,id:g,name:n,isVisible:!0};c(C=>({...C,environments:[...C.environments,I]}))},updateEnvironment:(i,g)=>{c(y=>({...y,environments:y.environments.map(r=>r.id===i?{...r,...g}:r)}))},deleteEnvironment:i=>{c(g=>({...g,environments:g.environments.filter(y=>y.id!==i)}))},reorderEnvironments:i=>{c(g=>{const[y,r]=i,n=[...g.environments],[I]=n.splice(y,1);return n.splice(r,0,I),{...g,environments:n}})},addCustomAdversary:i=>{const g={...i,id:_e("custom-adv"),source:i.source||"Homebrew",isCustom:!0};return b(y=>({...y,adversaries:[...y.adversaries,g]})),qe("daggerheart-custom-adversaries",[...p.adversaries,g]),g.id},addCustomEnvironment:i=>{const g={...i,id:_e("custom-env"),source:i.source||"Homebrew",isCustom:!0};return b(y=>({...y,environments:[...y.environments,g]})),qe("daggerheart-custom-environments",[...p.environments,g]),g.id},updateCustomAdversary:(i,g)=>{b(r=>({...r,adversaries:r.adversaries.map(n=>n.id===i?{...n,...g}:n)}));const y=p.adversaries.map(r=>r.id===i?{...r,...g}:r);qe("daggerheart-custom-adversaries",y)},updateCustomEnvironment:(i,g)=>{b(r=>({...r,environments:r.environments.map(n=>n.id===i?{...n,...g}:n)}));const y=p.environments.map(r=>r.id===i?{...r,...g}:r);qe("daggerheart-custom-environments",y)},deleteCustomAdversary:i=>{b(y=>({...y,adversaries:y.adversaries.filter(r=>r.id!==i)}));const g=p.adversaries.filter(y=>y.id!==i);qe("daggerheart-custom-adversaries",g)},deleteCustomEnvironment:i=>{b(y=>({...y,environments:y.environments.filter(r=>r.id!==i)}));const g=p.environments.filter(y=>y.id!==i);qe("daggerheart-custom-environments",g)}};return e.jsx(Mt.Provider,{value:Ce,children:t})},ht=()=>{const t=f.useContext(Mt);if(!t)return console.warn("useGameState: Context not available yet, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{gameState:s,customContent:c,...l}=t;if(!s)return console.warn("useGameState: gameState not available, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],customContent:{adversaries:[],environments:[]},updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},addCustomAdversary:()=>{},addCustomEnvironment:()=>{},updateCustomAdversary:()=>{},updateCustomEnvironment:()=>{},deleteCustomAdversary:()=>{},deleteCustomEnvironment:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{fear:S,countdowns:p,adversaries:b,environments:W,partySize:x,savedEncounters:z}=s;return{gameState:s,fear:S,countdowns:p,adversaries:b,environments:W,partySize:x,savedEncounters:z,customContent:c,...l,hasCountdowns:p.length>0,hasAdversaries:b.length>0,hasEnvironments:W.length>0,getCountdownById:$=>p.find(N=>N.id===$),getAdversaryById:$=>b.find(N=>N.id===$),getEnvironmentById:$=>W.find(N=>N.id===$)}},vt={fear:{icon:Nt,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"0.125rem",maxWidth:"none"},pipStyle:{fontSize:"var(--text-lg)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0,imageRendering:"crisp-edges"},filledColor:"var(--purple)",emptyColor:"var(--gray-dark)",tooltipTitle:"Click anywhere in header to adjust fear:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease fear by 1"},{text:"Right of boundary:",description:"Click to increase fear by 1"}]},hp:{icon:Bt,maxValue:20,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stress:{icon:Dt,maxValue:12,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},countdown:{icon:gt,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust countdown:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease countdown by 1"},{text:"Right of boundary:",description:"Click to increase countdown by 1"}]},hpDots:{maxValue:20,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--red)",borderColor:"var(--red)",boxShadow:"0 0 4px rgba(239, 68, 68, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stressDots:{maxValue:12,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--purple)",borderColor:"var(--purple)",boxShadow:"0 0 4px rgba(139, 92, 246, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},adversaryHP:{icon:It,maxValue:20,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust HP:",tooltipInstructions:[{text:"Filled pip:",description:"Click to heal (reduce damage)"},{text:"Empty pip:",description:"Click to take damage"}]},adversaryStress:{icon:Pt,maxValue:12,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust stress:",tooltipInstructions:[{text:"Filled pip:",description:"Click to reduce stress"},{text:"Empty pip:",description:"Click to increase stress"}]},countdownDistributed:{icon:gt,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Countdown progress:",tooltipInstructions:[{text:"Progress:",description:"Current countdown value"}]}},Ye=({type:t="fear",value:s=0,maxValue:c,onChange:l,size:S="lg",showTooltip:p=!0,containerStyle:b={},pipStyle:W={},countdownType:x=null,distributedGroups:z=null,onPipClick:$=null,enableBoundaryClick:N=!1,clickContainerWidth:T="auto",centerPips:w=!0})=>{const[Y,me]=f.useState(!1),H=vt[t]||vt.fear,V=c||H.maxValue,O=Math.max(0,Math.min(V,s));let be=H.filledColor;t==="countdown"&&x&&(["progress","dynamic-progress","simple-hope"].includes(x)?be="var(--gold)":["consequence","dynamic-consequence","simple-fear"].includes(x)?be="var(--purple)":["long-term","standard"].includes(x)&&(be="var(--text-secondary)"));const G=(ae,ye)=>{if($)$(ae,ye);else if(l){const we=ae+1;l(we)}},Me=ae=>{if(!N||!l||$)return;ae.currentTarget.getBoundingClientRect();const ye=ae.currentTarget.querySelector(".pip-container");if(!ye)return;const we=ye.getBoundingClientRect(),m=ae.clientX-we.left;if(m<0){O>0&&l(O-1);return}if(m>we.width){O<V&&l(O+1);return}const Z=we.width,k=Z*.05,de=Z-2*k,J=m-k,We=O/V,re=de*We;J<re?O>0&&l(O-1):O<V&&l(O+1)},Be=(()=>{if(!z||t!=="countdownDistributed")return[{start:0,end:V,groupIndex:0}];let ae=0;return z.map((ye,we)=>{const m={start:ae,end:ae+ye,groupIndex:we};return ae+=ye,m})})(),ne=()=>e.jsxs(e.Fragment,{children:[Be.map(ae=>e.jsx(Ve.Fragment,{children:[...Array(ae.end-ae.start)].map((ye,we)=>{const m=ae.start+we,Z=m<O;if(H.isDots)return e.jsx("div",{style:{...H.pipStyle,...Z?H.filledStyle:H.emptyStyle,...W,cursor:l||$?"pointer":"default"},onClick:N?void 0:()=>G(m,Z),title:`${m+1} of ${V}`},m);{const k=H.icon,de=k&&typeof k=="object"&&k.iconName,J=Z?be:H.emptyColor;return e.jsx("span",{className:`fear-pip ${Z?"filled":"empty"}`,style:{...H.pipStyle,color:J,cursor:l||$?"pointer":"default",...W},onClick:N?void 0:()=>G(m,Z),title:`${m+1} of ${V}`,children:de?e.jsx(Lt,{icon:k,size:S}):e.jsx(k,{size:S==="lg"?18:16})},m)}})},ae.groupIndex)),p&&e.jsx("div",{style:{position:"relative",cursor:"help",pointerEvents:"none"},children:e.jsxs("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:Y?"translateX(-50%) translateY(-5px)":"translateX(-50%)",background:"rgba(15, 23, 42, 0.95)",border:"1px solid var(--gray)",borderRadius:"var(--radius-md)",padding:"var(--space-md)",minWidth:"250px",zIndex:1e3,opacity:Y?1:0,visibility:Y?"visible":"hidden",transition:"all 0.2s ease",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.5)"},children:[e.jsx("div",{style:{fontWeight:600,color:"var(--gray-200)",marginBottom:"0.75rem",fontSize:"var(--text-sm)"},children:H.tooltipTitle}),H.tooltipInstructions.map((ae,ye)=>e.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.8rem",color:"var(--gray-300)",lineHeight:1.4},children:[e.jsx("strong",{style:{color:"var(--gray-200)"},children:ae.text})," ",ae.description]},ye))]})})]});return e.jsx("div",{style:{width:T,height:"100%",cursor:l||$?"pointer":"default",touchAction:"manipulation",userSelect:"none",display:w?"flex":"block",alignItems:w?"center":"stretch",justifyContent:w?"center":"flex-start",...b},onClick:ae=>{ae.stopPropagation(),ae.preventDefault(),N&&Me(ae)},onMouseEnter:()=>me(p),onMouseLeave:()=>me(!1),children:e.jsx("div",{className:"pip-container",style:{...H.containerStyle,width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},children:ne()})})},Qt=({position:t="top",children:s,onClick:c,className:l="",style:S={}})=>{const p=t==="top",b=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://"),W={background:"var(--bg-primary)",borderTop:p?"none":"1px solid var(--border)",borderBottom:p?"1px solid var(--border)":"none",padding:p?"0.25rem 0":"0.5rem",paddingBottom:p?"0.25rem":b?"calc(0.5rem + env(safe-area-inset-bottom) + 1rem)":"calc(0.5rem + env(safe-area-inset-bottom))",position:p?"relative":"sticky",[p?"top":"bottom"]:0,zIndex:p?10:100,order:p?1:3,flexShrink:0,touchAction:"manipulation",userSelect:"none",display:"flex",flexDirection:p?"column":"row",justifyContent:p?"stretch":"center",alignItems:p?"stretch":"center",gap:p?"0":"1rem",height:p?"auto":"60px",...S};return e.jsx("div",{className:l,style:W,onClick:c,children:s})},at=52,zt=({tabContent:t,children:s,containerStyle:c={},tabStyle:l={},showTab:S=!0,tabBackgroundColor:p="var(--bg-primary)",tabBorderColor:b="var(--border)",tabJustifyContent:W="center",containerBackgroundColor:x,containerBorderColor:z,containerBorderRadius:$="8px",containerBoxShadow:N,containerOverflow:T="hidden",reserveTabSpace:w=!1,style:Y={},...me})=>{const H={display:"flex",flexDirection:"column",position:"relative",height:"100%",width:"100%",borderRadius:$,overflow:T};x&&(H.backgroundColor=x),z&&(H.border=`2px solid ${z}`),N&&(H.boxShadow=N);const V={position:"relative",overflow:"visible",height:"100%",width:"100%",display:"flex",flexDirection:"column",boxSizing:"border-box"},O=w?"0":`-${at}px`,be=w&&S&&t?`${at}px`:"0";return e.jsxs("div",{style:{...V,...Y},...me,children:[S&&t&&e.jsx("div",{style:{position:"absolute",top:O,left:"7px",right:"7px",width:"calc(100% - 14px)",display:"flex",alignItems:"center",gap:"0.5rem",justifyContent:W,flexShrink:0,zIndex:0,padding:"0.5rem 0.75rem",paddingBottom:"calc(0.5rem + 4px)",minHeight:`${at}px`,backgroundColor:p,border:`1.5px solid ${b}`,borderBottom:"none",borderRadius:"8px 8px 0 0",boxSizing:"border-box",marginBottom:"-4px",...l},children:t}),e.jsx("div",{style:{...H,...c,zIndex:1,marginTop:be},children:s})]})},bt=({value:t})=>e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"44px",height:"32px",zIndex:3},children:[e.jsx("svg",{width:"40",height:"32",viewBox:"0 0 40 32",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",style:{position:"absolute",zIndex:1},children:e.jsx("path",{d:"M2 2h28l6 14-6 14H2l6-14-6-14z"})}),e.jsx("span",{style:{position:"absolute",fontSize:"0.8rem",fontWeight:500,color:"var(--text-primary)",textAlign:"center",zIndex:2,left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:t})]}),Ut=({type:t,tier:s,isEditMode:c,onUpdate:l,itemId:S})=>{const b=(N=>{if(!N)return 0;const w=document.createElement("canvas").getContext("2d");return w.font="600 11px system-ui, -apple-system, sans-serif",w.measureText(N.toUpperCase()).width})(t),W=4,x=18,z=Math.max(50,b+W+x),$=z+15;return c?e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",gap:"8px",height:"32px"},children:[e.jsxs("select",{value:t||"",onChange:N=>{l&&l(S,{type:N.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",outline:"none",borderRadius:"4px",padding:"4px 8px",width:"95px",height:"24px"},children:[e.jsx("option",{value:"Standard",children:"Standard"}),e.jsx("option",{value:"Solo",children:"Solo"}),e.jsx("option",{value:"Bruiser",children:"Bruiser"}),e.jsx("option",{value:"Horde",children:"Horde"}),e.jsx("option",{value:"Minion",children:"Minion"}),e.jsx("option",{value:"Ranged",children:"Ranged"}),e.jsx("option",{value:"Leader",children:"Leader"}),e.jsx("option",{value:"Skulk",children:"Skulk"}),e.jsx("option",{value:"Social",children:"Social"}),e.jsx("option",{value:"Support",children:"Support"})]}),e.jsxs("div",{style:{position:"relative",width:"24px",height:"24px"},children:[e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",width:"20px",height:"20px",backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",borderRadius:"2px"}}),e.jsx("input",{type:"text",value:s||"",onChange:N=>{const T=N.target.value.replace(/[^1-4]/g,"");T.length<=1&&l&&l(S,{tier:T===""?"":parseInt(T)})},onKeyDown:N=>{if(N.key==="ArrowUp"){N.preventDefault();const T=parseInt(s)||1;l&&l(S,{tier:Math.min(T+1,4)})}else if(N.key==="ArrowDown"){N.preventDefault();const T=parseInt(s)||1;l&&l(S,{tier:Math.max(T-1,1)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"transparent",border:"none",color:"var(--text-primary)",fontSize:"0.8rem",fontWeight:600,width:"24px",height:"24px",textAlign:"center",outline:"none",zIndex:1},maxLength:"1"})]})]}):e.jsxs("div",{style:{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"center",height:"32px",width:`${$}px`},children:[e.jsxs("svg",{width:$,height:"32",viewBox:`0 0 ${$} 32`,style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1},children:[e.jsx("rect",{x:"1",y:"6",width:z-1,height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4",ry:"4"}),e.jsx("rect",{x:z-10,y:"6",width:"20",height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"2",ry:"2",transform:`rotate(45 ${z-1} 16)`})]}),e.jsx("span",{style:{position:"absolute",top:"50%",left:"4px",transform:"translateY(-50%)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",color:"var(--text-primary)",zIndex:2,pointerEvents:"none"},children:t}),e.jsx("span",{style:{position:"absolute",top:"50%",left:`${z-.5}px`,transform:"translate(-50%, -50%)",fontSize:"0.8rem",fontWeight:600,color:"white",zIndex:2,pointerEvents:"none",textAlign:"center",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",width:"20px",height:"20px"},children:s})]})},it=({feature:t,featureType:s,item:c,onUpdate:l,handleFeatureDeleteClick:S,deleteConfirmations:p,getFeatureKey:b})=>{var N,T;const W=()=>{try{const Y=[...(c==null?void 0:c.features)||[]],me=Y.filter(V=>V.type===s),H=me.findIndex(V=>V===t);if(H>0&&H<me.length){const V=me[H],O=me[H-1];if(V&&O){const be=Y.findIndex(Me=>Me===V),G=Y.findIndex(Me=>Me===O);be>=0&&G>=0&&(Y[be]=O,Y[G]=V,l&&l(c.id,{features:Y}))}}}catch(w){console.error(`Error in ${s.toLowerCase()} up button:`,w)}},x=()=>{try{const Y=[...(c==null?void 0:c.features)||[]],me=Y.filter(V=>V.type===s),H=me.findIndex(V=>V===t);if(H<me.length-1&&H>=0){const V=me[H],O=me[H+1];if(V&&O){const be=Y.findIndex(Me=>Me===V),G=Y.findIndex(Me=>Me===O);be>=0&&G>=0&&(Y[be]=O,Y[G]=V,l&&l(c.id,{features:Y}))}}}catch(w){console.error(`Error in ${s.toLowerCase()} down button:`,w)}},z=w=>w.type===s,$=w=>w.type===s&&w.name.trim();return e.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",alignSelf:"stretch"},children:[e.jsx("button",{onClick:W,disabled:(c.features||[]).filter(z).findIndex(w=>w===t)===0,tabIndex:"-1",style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(c.features||[]).filter($).length>=2&&(c.features||[]).filter(z).findIndex(w=>w===t)!==0&&t.name.trim()?"white":"var(--text-secondary)",cursor:(c.features||[]).filter($).length>=2&&(c.features||[]).filter(z).findIndex(w=>w===t)!==0&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↑"}),e.jsx("button",{onClick:()=>S(t),disabled:!t.name.trim()&&!t.description.trim(),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:p[b(t)]?"var(--danger)":"var(--gray-700)",color:!t.name.trim()&&!t.description.trim()?"var(--text-secondary)":"white",cursor:!t.name.trim()&&!t.description.trim()?"not-allowed":"pointer",opacity:!t.name.trim()&&!t.description.trim()?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"×"}),e.jsx("button",{onClick:x,disabled:(c.features||[]).filter(z).findIndex(w=>w===t)===(c.features||[]).filter(z).length-1,style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(c.features||[]).filter($).length>=2&&(c.features||[]).filter(z).findIndex(w=>w===t)<(c.features||[]).filter(z).length-1&&((N=(c.features||[]).filter(z)[(c.features||[]).filter(z).findIndex(w=>w===t)+1])!=null&&N.name.trim())&&t.name.trim()?"white":"var(--text-secondary)",cursor:(c.features||[]).filter($).length>=2&&(c.features||[]).filter(z).findIndex(w=>w===t)<(c.features||[]).filter(z).length-1&&((T=(c.features||[]).filter(z)[(c.features||[]).filter(z).findIndex(w=>w===t)+1])!=null&&T.name.trim())&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↓"})]})},De={transitions:{hoverIn:"all 0.1s ease",hoverOut:"all 0.3s ease"},card:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"8px",cursor:"pointer",transition:"all 0.1s ease",position:"relative",border:"none"},cardHover:{backgroundColor:"var(--bg-card-hover)"},cardDead:{opacity:.6,backgroundColor:"var(--gray-800)",borderColor:"var(--border)"},cardAtMax:{backgroundColor:"var(--success)",borderColor:"var(--success)"},rowMain:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},rowTitle:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",margin:0},rowMeta:{display:"flex",gap:"8px",alignItems:"center"},badge:{padding:"2px 6px",borderRadius:"3px",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},typeBadge:{backgroundColor:"var(--purple)",color:"var(--text-primary)"},tierBadge:{backgroundColor:"var(--info)",color:"var(--text-primary)"},damageInputPopup:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,borderRadius:"8px"},damageInputContent:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"8px",padding:"8px",display:"flex",flexDirection:"row",gap:"8px",minWidth:"200px",alignItems:"center",position:"absolute",right:"1rem",top:"50%",transform:"translateY(-50%)"},damageInput:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"4px",padding:"4px 6px",color:"var(--text-primary)",fontSize:"16px",width:"80px",textAlign:"center"},damageIndicators:{display:"flex",gap:"8px",alignItems:"center",justifyContent:"center"},damageDrop:{fontSize:"16px",color:"var(--text-secondary)",cursor:"pointer",transition:"color 0.1s ease"},applyButton:{backgroundColor:"var(--gray-600)",color:"white",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"32px",minHeight:"32px"}},er=(t,s,c,l)=>{const[S,p]=f.useState(!1),[b,W]=f.useState("");f.useEffect(()=>{if(S){const w=Y=>{Y.target.closest(".damage-input-popup")||(p(!1),W(""))};return document.addEventListener("click",w),()=>document.removeEventListener("click",w)}},[S]);const x=w=>{w.stopPropagation(),w.preventDefault();const Y=t.hp||0,me=t.hpMax||1,H=w.currentTarget.getBoundingClientRect(),V=w.clientX-H.left,O=H.width/me;Math.floor(V/O)<Y?c&&c(t.id,1,t.hp):s&&s(t.id,1,t.hp,t.hpMax)},z=w=>{w.stopPropagation(),w.preventDefault();const Y=t.stress||0,me=t.stressMax||1,H=w.currentTarget.getBoundingClientRect(),V=w.clientX-H.left,O=H.width/me;Math.floor(V/O)<Y?l&&l(t.id,-1,t.stress,t.stressMax):l&&l(t.id,1,t.stress,t.stressMax)},$=w=>{w.stopPropagation(),(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")&&(p(!0),W(t.type==="Minion"?"1":""))},N=()=>{const w=parseInt(b);if(w>0){if(t.type==="Minion")s&&s(t.id,w,t.hp,t.hpMax);else{let Y=0;w>=t.thresholds.severe?Y=3:w>=t.thresholds.major?Y=2:w>=1&&(Y=1),s&&s(t.id,Y,t.hp,t.hpMax)}p(!1),W("")}};return{showDamageInput:S,damageValue:b,setDamageValue:W,setShowDamageInput:p,handleHpClick:x,handleStressClick:z,handleDifficultyClick:$,applyDamage:N,handleKeyDown:w=>{w.key==="Enter"?N():w.key==="Escape"&&(p(!1),W(""))}}},nt=({item:t,type:s,mode:c="expanded",onClick:l,onDelete:S,onApplyDamage:p,onApplyHealing:b,onApplyStressChange:W,onUpdate:x,adversaries:z=[],isSelected:$=!1,isEditMode:N=!1,instances:T=[],isEmbedded:w=!1,showAddRemoveButtons:Y=!1,onAddInstance:me=null,onRemoveInstance:H=null,onEdit:V=null,showCustomCreator:O=!1,onSaveCustomAdversary:be=null,onCancelEdit:G=null,isStockAdversary:Me=!1})=>{const Re=f.useRef(null),Be=f.useRef(T.length),ne=f.useRef(null),ae=f.useRef(null),ye=f.useRef(null),we=f.useRef(null);f.useEffect(()=>{const r=Re.current;if(!r)return;const n=()=>{ne.current=r.scrollHeight,ae.current=r.scrollTop};r.addEventListener("scroll",n,{passive:!0});const I=setInterval(n,100);return()=>{r.removeEventListener("scroll",n),clearInterval(I)}},[]),f.useEffect(()=>()=>{Re.current&&(ne.current=Re.current.scrollHeight,ae.current=Re.current.scrollTop)},[T.length,T]);const[m,Z]=f.useState({});f.useEffect(()=>{if(O&&we.current){const r=setTimeout(()=>{var n,I;(n=we.current)==null||n.focus(),(I=we.current)==null||I.select()},650);return()=>clearTimeout(r)}},[O]),f.useLayoutEffect(()=>{const r=T.length,n=Be.current;if(r!==n&&Re.current){const I=ne.current,C=ae.current;if(!I||C===null){Be.current=r;return}const X=Re.current,he=X.scrollHeight,je=X.clientHeight;if(!(r<n)){if(r>n){const Ae=he-je,Oe=X.scrollTop,a=Ae-Oe;if(Math.abs(a)>.5){ye.current&&(cancelAnimationFrame(ye.current),ye.current=null);const E=400,o=performance.now(),A=K=>{if(!X){ye.current=null;return}const R=K-o,le=Math.min(R/E,1),Se=1-le,d=1-Se*Se*Se,v=Oe+a*d;X.scrollTop=v,le<1?ye.current=requestAnimationFrame(A):(X.scrollTop=Ae,ye.current=null)};ye.current=requestAnimationFrame(A)}}}Be.current=r}else Be.current=r},[T.length,T]);const k=r=>{const I=(t.features||[]).filter(C=>C.type===r.type).findIndex(C=>C===r);return`${r.type}-${I}-${r.name||"blank"}`},de=(r,n)=>`experience-${n}-${typeof r=="string"?r:r.name||"blank"}`,J=r=>!r||!Array.isArray(r)?[]:r.filter(n=>{if(typeof n=="string")return n.trim().length>0;const I=n.name||"",C=n.modifier||0;return I.trim().length>0||C>0}),We=r=>{const n=k(r);if(m[n]){const I=t.features.filter(C=>C!==r);x&&x(t.id,{features:I}),Z(C=>{const X={...C};return delete X[n],X})}else Z(I=>({...I,[n]:!0})),setTimeout(()=>{Z(I=>{const C={...I};return delete C[n],C})},3e3)},re=(r,n)=>{const I=de(r,n);if(m[I]){const C=[...t.experience||[]];C.splice(n,1);const X=J(C);x&&x(t.id,{experience:X}),Z(he=>{const je={...he};return delete je[I],je})}else Z(C=>({...C,[I]:!0})),setTimeout(()=>{Z(C=>{const X={...C};return delete X[I],X})},3e3)},L=er(t,p,b,W);(s==="adversary"||s==="adversaries")&&L.handleDifficultyClick;const fe=(r=!1)=>{let n={...De.card};if($?n.transition="none":n.transition=De.transitions.hoverOut,r){const{marginTop:I,...C}=n;n=C}return $&&(n={...n,...De.cardHover}),s==="adversary"&&(t.hp||0)>=(t.hpMax||1)&&(n={...n,...De.cardDead}),n},Ee=()=>{if(w)return"";let r="border rounded-lg";return $&&(r+=" border-hover"),r},Te=()=>{var r;if(s==="adversary"||s==="adversaries"){const n=t.baseName||((r=t.name)==null?void 0:r.replace(/\s+\(\d+\)$/,""))||"",I=t.duplicateNumber||1,C=[...z];return z.some(je=>je.id===t.id)||C.push(t),C.filter(je=>je.baseName===n).length>1?`${n} (${I})`:n}return t.name},Ne=()=>{const r=[];return t.type&&r.push(e.jsx("span",{style:{...De.badge,...De.typeBadge},children:t.type},"type")),r},Ce=()=>s!=="adversary"||!L.showDamageInput||!(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")?null:e.jsx("div",{className:"damage-input-popup",style:De.damageInputPopup,onClick:r=>{r.stopPropagation(),r.target===r.currentTarget&&(s==="adversary"||s==="adversaries")&&(L.setShowDamageInput(!1),L.setDamageValue(""))},children:e.jsxs("div",{className:"border rounded-lg",style:{...De.damageInputContent,borderColor:"var(--border)"},onClick:r=>r.stopPropagation(),children:[e.jsx("input",{type:"number",inputMode:"numeric",enterKeyHint:"done",placeholder:"dmg",min:(t.type==="Minion","0"),value:s==="adversary"||s==="adversaries"?L.damageValue:"",onChange:r=>{(s==="adversary"||s==="adversaries")&&L.setDamageValue(r.target.value)},onKeyDown:s==="adversary"||s==="adversaries"?L.handleKeyDown:void 0,className:"border rounded-sm",style:{...De.damageInput,borderColor:"var(--border)"},autoFocus:!0}),e.jsxs("div",{style:De.damageIndicators,children:[t.type==="Minion"?(()=>{var X,he;const r=parseInt(s==="adversary"||s==="adversaries"?L.damageValue:"0")||0,n=(X=t.features)==null?void 0:X.find(je=>{var Ae;return(Ae=je.name)==null?void 0:Ae.startsWith("Minion (")}),I=n?parseInt(((he=n.name.match(/\((\d+)\)/))==null?void 0:he[1])||"1"):1,C=Math.floor(r/I);return r>=I&&C>0?e.jsxs("span",{style:{...De.damageDrop,color:"var(--red)"},title:`${r} damage can defeat ${C+1} minion${C+1!==1?"s":""} (1 + ${C} additional)`,children:["+",C," additional minion(s)"]}):e.jsx("span",{style:De.damageDrop,title:`${r} damage defeats this minion only`,children:"+0 additional minion(s)"})})():[1,2,3].map(r=>{const n=parseInt(s==="adversary"||s==="adversaries"?L.damageValue:"0")||0;let I=!1;return r===1&&n>=1&&(I=!0),r===2&&n>=t.thresholds.major&&(I=!0),r===3&&n>=t.thresholds.severe&&(I=!0),e.jsx("span",{style:{...De.damageDrop,color:I?"var(--red)":"var(--text-secondary)"},onClick:C=>{C.stopPropagation(),(s==="adversary"||s==="adversaries")&&(r===1?L.setDamageValue("1"):r===2?L.setDamageValue(t.thresholds.major.toString()):r===3&&L.setDamageValue(t.thresholds.severe.toString()))},title:`Click to set damage to ${r===1?"1":r===2?t.thresholds.major:t.thresholds.severe}`,children:e.jsx(It,{size:16})},r)}),e.jsx("button",{style:{...De.applyButton,backgroundColor:"var(--gray-600)"},onClick:r=>{r.stopPropagation(),(s==="adversary"||s==="adversaries")&&(!L.damageValue||parseInt(L.damageValue)<1?(L.setShowDamageInput(!1),L.setDamageValue("")):L.applyDamage())},title:!L.damageValue||parseInt(L.damageValue)<1?"Close damage input":"Apply damage",children:!L.damageValue||parseInt(L.damageValue)<1?e.jsx(Xe,{size:16}):e.jsx(_t,{size:16})})]})]})}),i=()=>{var X,he,je,Ae,Oe;const r=(t.hp||0)>=(t.hpMax||1),n=g==="edit"||O,I=Y&&s==="adversary"||O&&s==="adversary",C=I?O?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:a=>{a.stopPropagation(),be&&(be(t,t.id),G&&G())},style:{background:"var(--purple)",border:"1px solid var(--purple)",color:"white",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:a=>{a.target.style.opacity="0.9"},onMouseLeave:a=>{a.target.style.opacity="1"},title:"Save",children:[e.jsx(Ht,{size:16}),e.jsx("span",{children:"Save"})]}),G&&e.jsxs("button",{onClick:a=>{a.stopPropagation(),G()},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:a=>{a.target.style.backgroundColor="var(--bg-hover)",a.target.style.borderColor="var(--purple)"},onMouseLeave:a=>{a.target.style.backgroundColor="var(--bg-secondary)",a.target.style.borderColor="var(--border)"},title:"Cancel",children:[e.jsx(Xe,{size:16}),e.jsx("span",{children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),H&&H(t.id)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease"},onMouseEnter:a=>{a.target.style.backgroundColor="var(--bg-hover)",a.target.style.borderColor="var(--purple)"},onMouseLeave:a=>{a.target.style.backgroundColor="var(--bg-secondary)",a.target.style.borderColor="var(--border)"},title:"Remove one",children:e.jsx(pt,{size:16})}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"1rem",fontWeight:"500",minWidth:"24px",textAlign:"center"},children:T.length}),e.jsx("button",{onClick:a=>{a.stopPropagation(),me&&me(t)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease"},onMouseEnter:a=>{a.target.style.backgroundColor="var(--purple)",a.target.style.borderColor="var(--purple)",a.target.style.color="white"},onMouseLeave:a=>{a.target.style.backgroundColor="var(--bg-secondary)",a.target.style.borderColor="var(--border)",a.target.style.color="var(--text-primary)"},title:"Add another",children:e.jsx(Ke,{size:16})}),V&&e.jsx("button",{onClick:a=>{a.stopPropagation(),V(t.id)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease",marginLeft:"0.25rem"},onMouseEnter:a=>{a.target.style.backgroundColor="var(--purple)",a.target.style.borderColor="var(--purple)",a.target.style.color="white"},onMouseLeave:a=>{a.target.style.backgroundColor="var(--bg-secondary)",a.target.style.borderColor="var(--border)",a.target.style.color="var(--text-primary)"},title:"Edit",children:e.jsx(Ot,{size:16})})]}):null;return e.jsx(zt,{tabContent:C,showTab:I,tabBorderColor:$?"var(--purple)":"var(--border)",containerBackgroundColor:r?"var(--gray-900)":fe(!0).backgroundColor,containerBorderColor:r?"color-mix(in srgb, var(--gray-600) 40%, transparent)":$?"var(--purple)":"var(--border)",containerBorderRadius:"8px",containerOverflow:"hidden",containerStyle:{padding:0,opacity:r?.7:1,height:"auto",maxHeight:I?"calc(100vh - 120px)":"calc(100vh - 68px)",minHeight:0},children:e.jsxs("div",{className:Ee(),style:{...fe(!0),padding:0,display:"flex",flexDirection:"column",position:"relative",height:"100%",minHeight:0,border:"none",borderRadius:0},onClick:l,children:[r&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                  45deg,
                  transparent,
                  transparent 8px,
                  var(--gray-600) 1px,
                  var(--gray-600) 9px
                )`,pointerEvents:"none",zIndex:9999}})}),e.jsx("div",{className:"border-b",style:{padding:"8px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative",zIndex:r?1:"auto",borderBottomColor:$?"var(--purple)":"var(--border)"},children:e.jsx("div",{style:{display:"flex",flexDirection:"column",position:"relative",zIndex:r?1:"auto",padding:"2px",gap:0},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",minHeight:"40px"},children:[n?e.jsx("input",{ref:we,type:"text",value:t.name||"",onChange:a=>{x&&t.id&&x(t.id,{name:a.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"4px",color:"var(--text-primary)",fontSize:"1.1rem",fontWeight:"600",padding:"0.5rem",width:"100%",maxWidth:"300px",paddingRight:"0.625rem"},placeholder:"Name"}):e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flex:1},children:e.jsx("h4",{style:{...De.rowTitle,color:r?"color-mix(in srgb, var(--gray-400) 80%, transparent)":De.rowTitle.color,textAlign:"left",margin:0,fontSize:"1.1rem",paddingRight:"6px",flex:1},children:((X=t.name)==null?void 0:X.replace(/\s+\(\d+\)$/,""))||t.name})}),(t.type||t.tier||n)&&e.jsx(Ut,{type:t.type,tier:t.tier,isEditMode:n,onUpdate:x,itemId:t.id})]})})}),e.jsxs("div",{ref:Re,style:{borderRadius:"0 0 8px 8px",flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0},className:"invisible-scrollbar",children:[(t.motives||n)&&e.jsx("div",{style:{padding:"0.5rem 8px",textAlign:"center"},children:n?e.jsx("input",{type:"text",value:t.motives||"",onChange:a=>x&&x(t.id,{motives:a.target.value}),placeholder:"Motives...",style:{width:"100%",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}):e.jsxs("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,textAlign:"center"},children:[t.motives,t.motives&&!t.motives.endsWith(".")?".":""]})}),(t.difficulty||t.atk!==void 0||t.thresholds&&t.type!=="Minion"||t.experience&&t.experience.length>0||n)&&e.jsxs("div",{style:{padding:"0.5rem 8px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[(t.difficulty||n)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[e.jsx(Ft,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(0deg)"}}),n?e.jsx("input",{type:"text",value:t.difficulty||"",onChange:a=>{const E=a.target.value.replace(/[^0-9]/g,"");E.length<=2&&x&&x(t.id,{difficulty:parseInt(E)||0})},onKeyDown:a=>{if(a.key==="ArrowUp"){a.preventDefault();const E=parseInt(t.difficulty)||0;x&&x(t.id,{difficulty:Math.min(E+1,99)})}else if(a.key==="ArrowDown"){a.preventDefault();const E=parseInt(t.difficulty)||0;x&&x(t.id,{difficulty:Math.max(E-1,0)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"2"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:t.difficulty})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Difficulty"})]}),(t.atk!==void 0||n)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[e.jsx($t,{size:38,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(45deg)"}}),n?e.jsx("input",{type:"text",value:(()=>{const a=typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0;return a>=0?`+${a}`:a.toString()})(),onChange:a=>{const E=a.target.value.replace(/[^0-9+\-]/g,"");if(E.length<=4){const o=parseInt(E.replace(/[^0-9\-]/g,""))||0;x&&x(t.id,{atk:o})}},onKeyDown:a=>{if(a.key==="ArrowUp"){a.preventDefault();const o=(typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0)+1;x&&x(t.id,{atk:o})}else if(a.key==="ArrowDown"){a.preventDefault();const o=(typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0)-1;x&&x(t.id,{atk:o})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"3"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:(()=>{const a=typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk;return a>=0?`+${a}`:a})()})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Attack"})]})]}),e.jsx("div",{style:{paddingTop:"0"},children:n?e.jsx("div",{style:{display:"flex",flexDirection:"column",marginTop:"-0.25rem"},children:(()=>{const a=t.experience||[],E=a.length===0?[{name:"",modifier:0}]:a;return E.map((o,A)=>{var K,R,le,Se,d,v,_,se,Q,ke,pe,ue,oe,j,ce,Ie,h,u,D,P,xe,U,q,B,ge;return e.jsxs("div",{style:{position:"relative",marginBottom:"0.5rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("input",{type:"text",value:typeof o=="object"&&o.modifier>0?`+${o.modifier}`:"",onChange:M=>{const F=[...t.experience||[]],te=M.target.value.replace(/[^0-9+-]/g,""),ee=te===""||te==="+"?0:parseInt(te)||0,ze=Math.max(0,ee);F[A]={name:typeof o=="string"?o:o.name||"",modifier:ze};const ve=J(F);x&&x(t.id,{experience:ve})},onKeyDown:M=>{if(M.key==="ArrowUp"){M.preventDefault();const F=[...t.experience||[]],te=typeof o=="object"&&o.modifier||0;F[A]={name:typeof o=="string"?o:o.name||"",modifier:te+1};const ee=J(F);x&&x(t.id,{experience:ee})}else if(M.key==="ArrowDown"){M.preventDefault();const F=[...t.experience||[]],te=typeof o=="object"&&o.modifier||0;F[A]={name:typeof o=="string"?o:o.name||"",modifier:Math.max(0,te-1)};const ee=J(F);x&&x(t.id,{experience:ee})}},style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)",textAlign:"center",outline:"none"}})}),e.jsxs("div",{style:{marginLeft:"32px",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:typeof o=="string"?o:o.name||"",onChange:M=>{var ve;const F=[...t.experience||[]],te=typeof o=="object"&&o.modifier||0;F[A]={name:M.target.value,modifier:te};let ee=J(F);const ze=ee[ee.length-1];ze&&(typeof ze=="string"?ze.trim():(ve=ze.name)!=null&&ve.trim())&&ee.push({name:"",modifier:0}),x&&x(t.id,{experience:ee})},placeholder:"Experience name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsxs("div",{style:{display:"flex",gap:"0.125rem"},children:[e.jsx("button",{onClick:()=>{var ze,ve;const M=[...t.experience||[]],F=typeof o=="string"?o.trim():(ze=o.name)==null?void 0:ze.trim(),te=M[A-1],ee=typeof te=="string"?te.trim():(ve=te.name)==null?void 0:ve.trim();if(A>0&&A<M.length&&F&&ee){M[A]=te,M[A-1]=o;const Pe=J(M);x&&x(t.id,{experience:Pe})}},disabled:A===0||!(typeof o=="string"?o.trim():(K=o.name)!=null&&K.trim())||!(typeof E[A-1]=="string"?E[A-1].trim():(R=E[A-1].name)!=null&&R.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:A===0||!(typeof o=="string"?o.trim():(le=o.name)!=null&&le.trim())||!(typeof E[A-1]=="string"?E[A-1].trim():(Se=E[A-1].name)!=null&&Se.trim())?"var(--gray-800)":"var(--gray-700)",color:A===0||!(typeof o=="string"?o.trim():(d=o.name)!=null&&d.trim())||!(typeof E[A-1]=="string"?E[A-1].trim():(v=E[A-1].name)!=null&&v.trim())?"var(--text-secondary)":"white",cursor:A===0||!(typeof o=="string"?o.trim():(_=o.name)!=null&&_.trim())||!(typeof E[A-1]=="string"?E[A-1].trim():(se=E[A-1].name)!=null&&se.trim())?"not-allowed":"pointer",opacity:A===0||!(typeof o=="string"?o.trim():(Q=o.name)!=null&&Q.trim())||!(typeof E[A-1]=="string"?E[A-1].trim():(ke=E[A-1].name)!=null&&ke.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move up",children:"↑"}),e.jsx("button",{onClick:()=>{var ze,ve;const M=[...t.experience||[]],F=typeof o=="string"?o.trim():(ze=o.name)==null?void 0:ze.trim(),te=M[A+1],ee=typeof te=="string"?te.trim():(ve=te.name)==null?void 0:ve.trim();if(A<M.length-1&&A>=0&&F&&ee){M[A]=te,M[A+1]=o;const Pe=J(M);x&&x(t.id,{experience:Pe})}},disabled:A===E.length-1||!(typeof o=="string"?o.trim():(pe=o.name)!=null&&pe.trim())||!(typeof E[A+1]=="string"?E[A+1].trim():(ue=E[A+1].name)!=null&&ue.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:A===E.length-1||!(typeof o=="string"?o.trim():(oe=o.name)!=null&&oe.trim())||!(typeof E[A+1]=="string"?E[A+1].trim():(j=E[A+1].name)!=null&&j.trim())?"var(--gray-800)":"var(--gray-700)",color:A===E.length-1||!(typeof o=="string"?o.trim():(ce=o.name)!=null&&ce.trim())||!(typeof E[A+1]=="string"?E[A+1].trim():(Ie=E[A+1].name)!=null&&Ie.trim())?"var(--text-secondary)":"white",cursor:A===E.length-1||!(typeof o=="string"?o.trim():(h=o.name)!=null&&h.trim())||!(typeof E[A+1]=="string"?E[A+1].trim():(u=E[A+1].name)!=null&&u.trim())?"not-allowed":"pointer",opacity:A===E.length-1||!(typeof o=="string"?o.trim():(D=o.name)!=null&&D.trim())||!(typeof E[A+1]=="string"?E[A+1].trim():(P=E[A+1].name)!=null&&P.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move down",children:"↓"}),e.jsx("button",{onClick:()=>re(o,A),disabled:!(typeof o=="string"?o.trim():(xe=o.name)!=null&&xe.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:m[de(o,A)]?"var(--danger)":(typeof o=="string"?o.trim():(U=o.name)!=null&&U.trim())?"var(--gray-700)":"var(--gray-800)",color:(typeof o=="string"?o.trim():(q=o.name)!=null&&q.trim())?"white":"var(--text-secondary)",cursor:(typeof o=="string"?o.trim():(B=o.name)!=null&&B.trim())?"pointer":"not-allowed",opacity:(typeof o=="string"?o.trim():(ge=o.name)!=null&&ge.trim())?1:.5,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:m[de(o,A)]?"Click again to confirm delete":"Delete experience",children:"×"})]})]})]},A)})})()}):e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:t.experience&&t.experience.length>0?t.experience.map((a,E)=>{if(typeof a=="string"){const o=a.match(/^(.+?)\s*([+-]?\d+)$/);if(o){const[,A,K]=o;return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:K})})}),e.jsx("span",{style:{marginLeft:"32px"},children:A})]},E)}else return e.jsx("div",{style:{marginBottom:"0.25rem"},children:a},E)}else return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:e.jsxs("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:[a.modifier>=0?"+":"",a.modifier]})})}),e.jsx("span",{style:{marginLeft:"32px"},children:a.name})]},E)}):null})})]}),(t.features&&t.features.length>0||n)&&e.jsxs("div",{style:{padding:"0 8px 8px 8px"},children:[(t.atk!==void 0&&t.weapon||n)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Standard Attack"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:n?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",marginTop:"0.75rem",marginBottom:"0.75rem"},children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[e.jsx("input",{type:"text",value:t.weapon||"",onChange:a=>x&&x(t.id,{weapon:a.target.value}),placeholder:"Standard attack name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}}),e.jsxs("select",{value:t.range||"",onChange:a=>x&&x(t.id,{range:a.target.value}),style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",appearance:"none",backgroundImage:`url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",backgroundSize:"1rem",paddingRight:"2rem"},children:[e.jsx("option",{value:""}),e.jsx("option",{value:"Melee",children:"Melee"}),e.jsx("option",{value:"Very Close",children:"Very Close"}),e.jsx("option",{value:"Close",children:"Close"}),e.jsx("option",{value:"Far",children:"Far"}),e.jsx("option",{value:"Very Far",children:"Very Far"})]}),e.jsx("input",{type:"text",value:t.damage||"",onChange:a=>x&&x(t.id,{damage:a.target.value}),placeholder:"Damage (e.g., 1d6+2)",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}})]})}):t.atk!==void 0&&t.weapon&&e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:t.weapon}),e.jsxs("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:["Make an attack against a target within ",t.range||"Melee"," range. On a success, deal ",t.damage||"damage varies","."]})]})})]}),(t.features.filter(a=>a.type==="Action").length>0||n)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Actions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const a=t.features.filter(o=>o.type==="Action");return(n&&a.length===0?[{type:"Action",name:"",description:""}]:a).map((o,A)=>n?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:o.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false","data-lpignore":"true","data-form-type":"other",name:`feature-name-${o.type.toLowerCase()}`,onChange:K=>{const R=[...t.features||[]],le=R.findIndex(v=>v.type==="Action"&&v===o);le>=0?R[le]={...R[le],name:K.target.value}:R.push({type:"Action",name:K.target.value,description:o.description||""});const Se=R.filter(v=>v.type==="Action"),d=Se[Se.length-1];d&&d.name.trim()&&R.push({type:"Action",name:"",description:""}),x&&x(t.id,{features:R})},placeholder:"Action name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:o.description||"",onChange:K=>{const R=[...t.features||[]],le=R.findIndex(v=>v.type==="Action"&&v===o);le>=0?R[le]={...R[le],description:K.target.value}:R.push({type:"Action",name:o.name||"",description:K.target.value});const Se=R.filter(v=>v.type==="Action"),d=Se[Se.length-1];d&&d.name.trim()&&R.push({type:"Action",name:"",description:""}),x&&x(t.id,{features:R})},onInput:K=>{const R=K.target.offsetHeight;K.target.style.height="auto";const le=K.target.scrollHeight,Se=le>R?le:R;K.target.style.height=Se+"px"},placeholder:"Action description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(it,{feature:o,featureType:"Action",item:t,onUpdate:x,handleFeatureDeleteClick:We,deleteConfirmations:m,getFeatureKey:k})]},A):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:o.name}),o.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:o.description})]},A))})()})]}),(t.features.filter(a=>a.type==="Passive").length>0||n)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Passives"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const a=t.features.filter(o=>o.type==="Passive");return(n&&a.length===0?[{type:"Passive",name:"",description:""}]:a).map((o,A)=>n?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:o.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:K=>{const R=[...t.features||[]],le=R.findIndex(v=>v.type==="Passive"&&v===o);le>=0?R[le]={...R[le],name:K.target.value}:R.push({type:"Passive",name:K.target.value,description:o.description||""});const Se=R.filter(v=>v.type==="Passive"),d=Se[Se.length-1];d&&d.name.trim()&&R.push({type:"Passive",name:"",description:""}),x&&x(t.id,{features:R})},placeholder:"Passive name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:o.description||"",onChange:K=>{const R=[...t.features||[]],le=R.findIndex(v=>v.type==="Passive"&&v===o);le>=0?R[le]={...R[le],description:K.target.value}:R.push({type:"Passive",name:o.name||"",description:K.target.value});const Se=R.filter(v=>v.type==="Passive"),d=Se[Se.length-1];d&&d.name.trim()&&R.push({type:"Passive",name:"",description:""}),x&&x(t.id,{features:R})},onInput:K=>{const R=K.target.offsetHeight;K.target.style.height="auto";const le=K.target.scrollHeight,Se=le>R?le:R;K.target.style.height=Se+"px"},placeholder:"Passive description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(it,{feature:o,featureType:"Passive",item:t,onUpdate:x,handleFeatureDeleteClick:We,deleteConfirmations:m,getFeatureKey:k})]},A):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:o.name}),o.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:o.description})]},A))})()})]}),(t.features.filter(a=>a.type==="Reaction").length>0||n)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Reactions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const a=t.features.filter(o=>o.type==="Reaction");return(n&&a.length===0?[{type:"Reaction",name:"",description:""}]:a).map((o,A)=>n?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:o.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:K=>{const R=[...t.features||[]],le=R.findIndex(v=>v.type==="Reaction"&&v===o);le>=0?R[le]={...R[le],name:K.target.value}:R.push({type:"Reaction",name:K.target.value,description:o.description||""});const Se=R.filter(v=>v.type==="Reaction"),d=Se[Se.length-1];d&&d.name.trim()&&R.push({type:"Reaction",name:"",description:""}),x&&x(t.id,{features:R})},placeholder:"Reaction name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:o.description||"",onChange:K=>{const R=[...t.features||[]],le=R.findIndex(v=>v.type==="Reaction"&&v===o);le>=0?R[le]={...R[le],description:K.target.value}:R.push({type:"Reaction",name:o.name||"",description:K.target.value});const Se=R.filter(v=>v.type==="Reaction"),d=Se[Se.length-1];d&&d.name.trim()&&R.push({type:"Reaction",name:"",description:""}),x&&x(t.id,{features:R})},onInput:K=>{const R=K.target.offsetHeight;K.target.style.height="auto";const le=K.target.scrollHeight,Se=le>R?le:R;K.target.style.height=Se+"px"},placeholder:"Reaction description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(it,{feature:o,featureType:"Reaction",item:t,onUpdate:x,handleFeatureDeleteClick:We,deleteConfirmations:m,getFeatureKey:k})]},A):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:o.name}),o.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:o.description})]},A))})()})]})]}),(T&&T.length>0||t.type!=="Minion"&&(t.thresholds||n))&&e.jsxs("div",{style:{padding:"0 8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Status"})]}),n?e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border)"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"number",value:t.hpMax||"",onChange:a=>{const E=parseInt(a.target.value)||1;x&&x(t.id,{hpMax:E})},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),e.jsx(Ye,{type:"adversaryHP",value:0,maxValue:t.hpMax||1,showTooltip:!1}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:"HP"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"number",value:t.stressMax||"",onChange:a=>{const E=parseInt(a.target.value)||1;x&&x(t.id,{stressMax:E})},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),e.jsx(Ye,{type:"adversaryStress",value:0,maxValue:t.stressMax||1,showTooltip:!1}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:"Stress"})]})]})})}):T&&T.length>0&&T.map((a,E)=>{const o=(a.hp||0)>=(a.hpMax||1);return e.jsx("div",{"data-instance-id":a.id,style:{marginBottom:"0.5rem"},children:e.jsxs("div",{style:{backgroundColor:o?"var(--gray-900)":"var(--bg-primary)",borderRadius:"6px",padding:"0.25rem 0.5rem",border:"1px solid",borderColor:o?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",display:"flex",justifyContent:"flex-start",alignItems:"center",gap:"0.5rem",opacity:o?.7:1,position:"relative",transition:"all 0.2s ease",minHeight:"40px"},children:[o&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                          45deg,
                          transparent 0px,
                          transparent 8px,
                          var(--gray-600) 9px,
                          var(--gray-600) 9px
                        )`,pointerEvents:"none",zIndex:1,borderRadius:"4px"}})}),e.jsx("div",{style:{backgroundColor:o?"var(--gray-900)":"var(--bg-card)",border:"1px solid",borderColor:o?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",borderRadius:"50%",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",flexShrink:0,opacity:o?.5:1},children:e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:o?"var(--gray-400)":"var(--text-primary)"},children:a.duplicateNumber||1})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.125rem"},children:[e.jsx("div",{style:{opacity:o?.3:1},children:e.jsx(Ye,{type:"adversaryHP",value:a.hp||0,maxValue:a.hpMax||1,onPipClick:(A,K)=>{if(p&&s==="adversary"){const R=a.hp||0,le=a.hpMax||1;K?b&&b(a.id,1,R):R<le&&p(a.id,1,R,le)}},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})}),a.stressMax>0&&e.jsx("div",{style:{opacity:o?.3:1},children:e.jsx(Ye,{type:"adversaryStress",value:a.stress||0,maxValue:a.stressMax,onPipClick:(A,K)=>{W&&s==="adversary"&&(K?W(a.id,-1):W(a.id,1))},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})})]})]},a.id)},a.id)}),t.type!=="Minion"&&(t.thresholds||n)&&e.jsx("div",{style:{display:"flex",justifyContent:"center",paddingTop:"1px",marginTop:"0.5rem",marginBottom:"0.5rem"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",position:"relative"},children:e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",height:"36px"},children:[e.jsx("svg",{width:"300",height:"36",viewBox:"0 0 300 36",style:{position:"absolute",zIndex:1},children:e.jsx("rect",{x:"20",y:"6",width:"260",height:"24",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4"})}),e.jsx("div",{style:{position:"relative",zIndex:2,display:"flex",alignItems:"center",gap:"0.5rem"},children:n?e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",fontSize:"0.8rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),e.jsx("input",{type:"number",min:"1",max:"99",value:((he=t.thresholds)==null?void 0:he.major)||"",onChange:a=>{const E=a.target.value;(E===""||parseInt(E)>=1&&parseInt(E)<=99)&&x&&x(t.id,{thresholds:{...t.thresholds,major:E===""?null:parseInt(E)}})},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),e.jsx("input",{type:"number",min:"1",max:"99",value:((je=t.thresholds)==null?void 0:je.severe)||"",onChange:a=>{const E=a.target.value;(E===""||parseInt(E)>=1&&parseInt(E)<=99)&&x&&x(t.id,{thresholds:{...t.thresholds,severe:E===""?null:parseInt(E)}})},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),e.jsx(bt,{value:((Ae=t.thresholds)==null?void 0:Ae.major)||7}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),e.jsx(bt,{value:((Oe=t.thresholds)==null?void 0:Oe.severe)||14}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]})})]})})})]}),(n||c==="expanded"&&t.description&&t.description.trim())&&e.jsxs("div",{style:{padding:"0 8px",textAlign:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Description"})]}),n?e.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-primary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"none",overflow:"hidden",fontFamily:"inherit",marginTop:"0.75rem",marginBottom:"0.75rem"},value:t.description,onChange:a=>{a.target.style.height="auto",a.target.style.height=a.target.scrollHeight+"px",x&&x(t.id,{description:a.target.value})},placeholder:"Description..."}):e.jsx("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,whiteSpace:"pre-wrap",padding:"0.5rem 0"},children:t.description})]})]}),Ce()]})})},g=O?"edit":c;return(g==="expanded"||g==="edit")&&(s==="adversary"||s==="adversaries")?i():s==="adversary"||s==="adversaries"?null:e.jsxs("div",{className:Ee(),style:fe(!0),children:[e.jsxs("div",{style:De.rowMain,children:[e.jsx("h4",{style:De.rowTitle,children:Te()}),e.jsx("div",{style:De.rowMeta,children:Ne()})]}),e.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"12px",margin:0},children:["Expanded view coming soon for ",s]})]})},tr="modulepreload",rr=function(t){return"/Daggerheart/"+t},wt={},Ge=function(s,c,l){if(!c||c.length===0)return s();const S=document.getElementsByTagName("link");return Promise.all(c.map(p=>{if(p=rr(p),p in wt)return;wt[p]=!0;const b=p.endsWith(".css"),W=b?'[rel="stylesheet"]':"";if(!!l)for(let $=S.length-1;$>=0;$--){const N=S[$];if(N.href===p&&(!b||N.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${p}"]${W}`))return;const z=document.createElement("link");if(z.rel=b?"stylesheet":tr,b||(z.as="script",z.crossOrigin=""),z.href=p,document.head.appendChild(z),b)return new Promise(($,N)=>{z.addEventListener("load",$),z.addEventListener("error",()=>N(new Error(`Unable to preload CSS for ${p}`)))})})).then(()=>s()).catch(p=>{const b=new Event("vite:preloadError",{cancelable:!0});if(b.payload=p,window.dispatchEvent(b),!b.defaultPrevented)throw p})},nr="/Daggerheart/assets/daggerheart-logo-fe7815ad.svg",Ct={Minion:{difficulty:t=>[9,12,15,18][t-1],thresholds:t=>({major:0,severe:0}),hpMax:t=>1,stressMax:t=>1,atk:t=>[-1,0,1,2][t-1],damage:t=>["2","5","8","11"][t-1],range:"Melee"},Standard:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[7,10,20,25][t-1],severe:[12,20,32,45][t-1]}),hpMax:t=>[4,5,6,7][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[1,2,3,4][t-1],damage:t=>["1d8+1","2d8+2","3d8+3","4d8+4"][t-1],range:"Melee"},Bruiser:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[8,14,22,38][t-1],severe:[15,28,40,70][t-1]}),hpMax:t=>[6,7,8,9][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[-1,0,1,2][t-1],damage:t=>["1d12+2","2d12+4","3d12+6","4d12+8"][t-1],range:"Melee"},Horde:{difficulty:t=>[10,13,16,19][t-1],thresholds:t=>({major:[7,10,20,25][t-1],severe:[12,20,32,45][t-1]}),hpMax:t=>[5,6,7,8][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[-1,0,1,2][t-1],damage:t=>["1d8+2","2d8+4","3d8+6","4d8+8"][t-1],range:"Melee"},Leader:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[7,13,21,35][t-1],severe:[14,26,38,65][t-1]}),hpMax:t=>[5,6,7,8][t-1],stressMax:t=>[5,5,6,6][t-1],atk:t=>[2,4,6,8][t-1],damage:t=>["1d10+2","2d10+4","3d10+6","4d10+8"][t-1],range:"Melee"},Ranged:{difficulty:t=>[10,13,16,19][t-1],thresholds:t=>({major:[4,8,18,22][t-1],severe:[7,16,30,42][t-1]}),hpMax:t=>[3,4,5,6][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d8+2","2d8+4","3d8+6","4d8+8"][t-1],range:"Close"},Skulk:{difficulty:t=>[12,15,18,21][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,5,6,7][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d6+2","2d6+4","3d6+6","4d6+8"][t-1],range:"Melee"},Solo:{difficulty:t=>[12,15,18,21][t-1],thresholds:t=>({major:[7,13,21,35][t-1],severe:[14,26,38,65][t-1]}),hpMax:t=>[8,9,10,11][t-1],stressMax:t=>[5,5,6,6][t-1],atk:t=>[3,5,7,9][t-1],damage:t=>["1d10+3","2d10+6","3d10+9","4d10+12"][t-1],range:"Melee"},Support:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,4,5,5][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d4+2","2d4+4","3d4+6","4d4+8"][t-1],range:"Melee"},Social:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,4,5,5][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d4+2","2d4+4","3d4+6","4d4+8"][t-1],range:"Melee"}},Je=(t,s)=>{const c=Ct[s]||Ct.Standard;return{difficulty:c.difficulty(t),thresholds:c.thresholds(t),hpMax:c.hpMax(t),stressMax:c.stressMax(t),atk:c.atk(t),damage:c.damage(t),range:c.range}};let Tt={adversaries:[]},St=!1;const sr=()=>({customAdversaries:JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]")}),or=async()=>{if(St)return;let t={adversaries:[]},s={adversaries:[]};try{const l=await Ge(()=>import("./adversaries-9c8932de.js"),[]);t=(l==null?void 0:l.default)||l}catch(l){console.warn("Failed to load adversaries.json:",l)}try{const l=await Ge(()=>import("./playtest-adversaries-4a099c10.js"),[]);s=(l==null?void 0:l.default)||l}catch(l){console.warn("Failed to load playtest-adversaries.json:",l)}const{customAdversaries:c}=sr();Tt={...t,adversaries:[...t.adversaries||[],...s.adversaries||[],...c]},St=!0},Rt=f.forwardRef(({onSave:t,onRefresh:s,onAddItem:c,editingAdversary:l,onCancelEdit:S,isStockAdversary:p=!1,autoFocus:b=!1,allAdversaries:W=[],embedded:x=!1,hideEmbeddedButtons:z=!1},$)=>{const N=f.useRef(null),[T,w]=f.useState(()=>{const m=Je(1,"Standard");return{name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:m.difficulty,thresholds:m.thresholds,hpMax:m.hpMax,stressMax:m.stressMax,atk:m.atk,weapon:"",range:m.range,damage:m.damage,experience:[],features:[]}}),[Y,me]=f.useState(!1),[H,V]=f.useState(!1),[O,be]=f.useState([]),[G,Me]=f.useState(!1),[Re,Be]=f.useState([]);f.useEffect(()=>{(async()=>{await or(),W.length>0?Be(W):Be(Tt.adversaries||[])})()},[W]),f.useEffect(()=>{b&&N.current&&setTimeout(()=>{var m;(m=N.current)==null||m.focus()},100)},[b]),f.useEffect(()=>{if(l)w({name:l.name||"",tier:l.tier||1,type:l.type||"Standard",description:l.description||"",motives:l.motives||"",difficulty:l.difficulty||11,thresholds:l.thresholds||{major:7,severe:12},hpMax:l.hpMax||3,stressMax:l.stressMax||1,atk:l.atk||1,weapon:l.weapon||"",range:l.range||"Melee",damage:l.damage||"",experience:l.experience||[],features:l.features||[]}),V(!1);else{const m=Je(1,"Standard");w({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:m.difficulty,thresholds:m.thresholds,hpMax:m.hpMax,stressMax:m.stressMax,atk:m.atk,weapon:"",range:m.range,damage:m.damage,experience:[],features:[]}),V(!1)}},[l]),f.useEffect(()=>{if(!l&&!H){const m=Je(T.tier,T.type);w(Z=>({...Z,difficulty:m.difficulty,thresholds:m.thresholds,hpMax:m.hpMax,stressMax:m.stressMax,atk:m.atk,range:m.range,damage:m.damage}))}},[T.tier,T.type,l,H]);const ne=m=>{if(w(Z=>({...Z,name:m})),m.trim().length>0){const Z=Re.filter(k=>{var J;return(((J=k.name)==null?void 0:J.replace(/\s+\(\d+\)$/,""))||k.name||"").toLowerCase().includes(m.toLowerCase())}).slice(0,5);be(Z),Me(Z.length>0)}else be([]),Me(!1)},ae=async()=>{if(!T.name.trim()){alert("Please enter a name for the adversary");return}me(!0);try{const m={...T,hp:l?l.hp:0,stress:l?l.stress:0,source:"Homebrew"};if(l)p?(await t(m),alert("Custom adversary created successfully!")):(m.id=l.id,await t(m,l.id),alert("Adversary updated successfully!")),S&&S();else{await t(m),s&&await s();const Z=Je(1,"Standard");w({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:Z.difficulty,thresholds:Z.thresholds,hpMax:Z.hpMax,stressMax:Z.stressMax,atk:Z.atk,weapon:"",range:Z.range,damage:Z.damage,experience:[],features:[]}),V(!1),alert("Custom adversary created successfully!")}}catch(m){console.error("Error saving adversary:",m),alert("Error saving adversary. Please try again.")}finally{me(!1)}};f.useImperativeHandle($,()=>({handleSave:ae,isSaving:Y,canSave:T.name.trim().length>0}));const ye={...T,id:"new-adversary",hp:0,stress:0,source:"Homebrew"},we=()=>Y?l?p?"Creating...":"Saving...":"Creating...":l?p?"Save As Custom":"Save":"Create";return e.jsxs(e.Fragment,{children:[!x&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h2",{style:{color:"var(--text-primary)",fontSize:"1.5rem",fontWeight:"600",margin:0},children:l?p?"Edit Adversary (Save As Custom)":"Edit Custom Adversary":"Create Custom Adversary"}),e.jsx("button",{onClick:ae,disabled:Y||!T.name.trim(),style:{padding:"0.75rem 1.5rem",backgroundColor:Y||!T.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"8px",cursor:Y||!T.name.trim()?"not-allowed":"pointer",fontSize:"1rem",fontWeight:"600",opacity:Y||!T.name.trim()?.6:1},children:we()})]}),x&&!z&&e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",marginBottom:"0.5rem",padding:"0.5rem",borderBottom:"1px solid var(--border)"},children:[e.jsx("button",{onClick:ae,disabled:Y||!T.name.trim(),style:{padding:"0.5rem 1rem",backgroundColor:Y||!T.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"6px",cursor:Y||!T.name.trim()?"not-allowed":"pointer",fontSize:"0.875rem",fontWeight:"600",opacity:Y||!T.name.trim()?.6:1,marginRight:"0.5rem"},children:we()}),S&&e.jsx("button",{onClick:S,style:{padding:"0.5rem 1rem",backgroundColor:"transparent",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"6px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600"},children:"Cancel"})]}),!l&&e.jsxs("div",{style:{marginBottom:"1rem",position:"relative"},children:[e.jsx("input",{ref:N,type:"text",value:T.name,onChange:m=>{const Z=m.target.value;w(k=>({...k,name:Z})),ne(Z)},placeholder:"Adversary name",style:{width:"100%",padding:"0.75rem",border:"1px solid var(--border)",borderRadius:"8px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"1rem",outline:"none"}}),G&&O.length>0&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"0 0 8px 8px",borderTop:"none",maxHeight:"200px",overflowY:"auto",zIndex:1e3,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)"},children:O.map((m,Z)=>{var de;const k=m.baseName||((de=m.name)==null?void 0:de.replace(/\s+\(\d+\)$/,""))||m.name;return e.jsxs("div",{onClick:()=>{w(J=>({...J,name:k,tier:m.tier||J.tier,type:m.type||J.type,difficulty:m.difficulty||J.difficulty,thresholds:m.thresholds||J.thresholds,hpMax:m.hpMax||J.hpMax,stressMax:m.stressMax||J.stressMax,atk:m.atk||J.atk,range:m.range||J.range,damage:m.damage||J.damage})),Me(!1),V(!0),N.current&&N.current.blur()},style:{padding:"0.75rem",cursor:"pointer",borderBottom:Z<O.length-1?"1px solid var(--border)":"none",transition:"background-color 0.2s"},onMouseEnter:J=>{J.target.style.backgroundColor="var(--bg-secondary)"},onMouseLeave:J=>{J.target.style.backgroundColor="transparent"},onMouseDown:J=>J.preventDefault(),children:[e.jsx("div",{style:{fontWeight:"600"},children:k}),e.jsxs("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",marginTop:"2px"},children:[m.type," • Tier ",m.tier]})]},Z)})})]}),e.jsx(nt,{item:ye,type:"adversary",mode:"edit",onUpdate:(m,Z)=>{w(k=>({...k,...Z}))}})]})});Rt.displayName="CustomAdversaryCreator";const ar=(t,s)=>{const[c,l]=f.useState("max-content"),S=f.useCallback(()=>{if(!s.current||t<=3)return"max-content";const p=s.current.offsetWidth,W=Math.floor(p/120);return W<=1?"max-content":t===4?"max-content max-content":t===5||t===6?W>=2?"max-content max-content":"max-content":t===7?W>=3?"max-content max-content max-content":W>=2?"max-content max-content":"max-content":"repeat(auto-fit, minmax(80px, max-content))"},[t,s]);return f.useEffect(()=>{const p=S();l(p);const b=new ResizeObserver(()=>{const W=S();l(W)});return s.current&&b.observe(s.current),()=>{b.disconnect()}},[S]),c},ir=({encounter:t})=>{var S,p;const s=f.useRef(null),c=((S=t.encounterItems)==null?void 0:S.length)||0,l=ar(c,s);return e.jsx("div",{ref:s,className:"saved-encounter-adversary-list",style:{flex:1,fontSize:"0.8rem",color:"var(--text-secondary)",lineHeight:"1.3",display:"grid",gridTemplateColumns:l,gap:"0.25rem 1rem",gridAutoRows:"min-content"},children:((p=t.encounterItems)==null?void 0:p.length)>0?t.encounterItems.map((b,W)=>{var z;const x=b.item.baseName||((z=b.item.name)==null?void 0:z.replace(/\s+\(\d+\)$/,""))||b.item.name;return e.jsxs("div",{style:{marginBottom:"0.125rem"},children:[b.quantity,"x ",x]},W)}):e.jsx("div",{children:"No adversaries"})})},Ze={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},tt={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1,lowerTierAdversary:1};let rt={adversaries:[]},mt={environments:[]},ft=!1;const lr=()=>{const t=JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]"),s=JSON.parse(localStorage.getItem("daggerheart-custom-environments")||"[]");return{customAdversaries:t,customEnvironments:s}},jt=async()=>{if(ft)return;let t={adversaries:[]},s={environments:[]},c={adversaries:[]},l={environments:[]};try{const b=await Ge(()=>import("./adversaries-9c8932de.js"),[]);t=(b==null?void 0:b.default)||b}catch(b){console.warn("Failed to load adversaries.json:",b)}try{const b=await Ge(()=>import("./environments-c340637c.js"),[]);s=(b==null?void 0:b.default)||b}catch(b){console.warn("Failed to load environments.json:",b)}try{const b=await Ge(()=>import("./playtest-adversaries-4a099c10.js"),[]);c=(b==null?void 0:b.default)||b}catch(b){console.warn("Failed to load playtest-adversaries.json:",b)}try{const b=await Ge(()=>import("./playtest-environments-d9cdffb6.js"),[]);l=(b==null?void 0:b.default)||b}catch(b){console.warn("Failed to load playtest-environments.json:",b)}const{customAdversaries:S,customEnvironments:p}=lr();rt={...t,adversaries:[...t.adversaries||[],...c.adversaries||[],...S]},mt={...s,environments:[...s.environments||[],...l.environments||[],...p]},ft=!0},dr=(t,s=[],c=4,l=1,S=!1)=>{const[p,b]=f.useState(""),[W,x]=f.useState([{field:"tier",direction:"asc"},{field:"name",direction:"asc"}]),[z,$]=f.useState([]),[N,T]=f.useState(!0),[w,Y]=f.useState([]),[me,H]=f.useState([]),[V,O]=f.useState(!1),[be,G]=f.useState(!1),Me=f.useRef(null),Re=f.useRef(null);f.useEffect(()=>{(async()=>{await jt(),T(!1);let L=[];t==="adversary"?L=rt.adversaries||[]:t==="environment"&&(L=mt.environments||[]),$(L)})()},[t]);const Be=re=>{const L=z.map(fe=>fe[re]).filter(Boolean);return[...new Set(L)].sort((fe,Ee)=>typeof fe=="number"&&typeof Ee=="number"?fe-Ee:String(fe).localeCompare(String(Ee)))},ne=f.useCallback(async()=>{ft=!1,await jt();let re=[];t==="adversary"?S?re=(rt.adversaries||[]).filter(L=>{var fe;return L.source==="Homebrew"||((fe=L.id)==null?void 0:fe.startsWith("custom-"))}):re=rt.adversaries||[]:t==="environment"&&(re=mt.environments||[]),$(re)},[t,S]);f.useEffect(()=>{ne()},[S,ne]);const ae=Be("tier"),ye=Be("type"),we=f.useMemo(()=>{let re=z.filter(L=>{var Ne,Ce;const fe=L.name.toLowerCase().includes(p.toLowerCase())||((Ne=L.type)==null?void 0:Ne.toLowerCase().includes(p.toLowerCase()))||((Ce=L.description)==null?void 0:Ce.toLowerCase().includes(p.toLowerCase())),Ee=w.length===0||(w.includes("party-tier")?L.tier===l:w.includes(L.tier.toString())),Te=me.length===0||me.includes(L.type);return fe&&Ee&&Te});return re.sort((L,fe)=>{for(const Ee of W){const{field:Te,direction:Ne}=Ee;let Ce=L[Te],i=fe[Te];if(Te==="tier")Ce=parseInt(Ce)||0,i=parseInt(i)||0;else if(Te==="cost"){const g=y=>{if(t!=="adversary")return 0;const r=Ze[y.type]||2;let n=0;const I=s.filter(X=>X.type==="adversary"&&X.item.type==="Solo"&&X.quantity>0).reduce((X,he)=>X+he.quantity,0),C=s.filter(X=>X.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(X.item.type)&&X.quantity>0).reduce((X,he)=>X+he.quantity,0);return y.type==="Solo"&&I===1&&(n+=2),["Bruiser","Horde","Leader","Solo"].includes(y.type)&&C===0&&(n+=1),r+n};Ce=g(L),i=g(fe)}else if(Te==="difficulty"){const g=parseInt(Ce),y=parseInt(i);!isNaN(g)&&!isNaN(y)?(Ce=g,i=y):!isNaN(g)&&isNaN(y)?(Ce=g,i=999):isNaN(g)&&!isNaN(y)?(Ce=999,i=y):(Ce=String(Ce||"").toLowerCase(),i=String(i||"").toLowerCase())}else typeof Ce=="string"&&typeof i=="string"?(Ce=Ce.toLowerCase(),i=i.toLowerCase()):(Ce=String(Ce||"").toLowerCase(),i=String(i||"").toLowerCase());if(Ne==="asc"){if(Ce>i)return 1;if(Ce<i)return-1}else{if(Ce<i)return 1;if(Ce>i)return-1}}return 0}),re},[z,p,W,w,me,s,c,l]),m=re=>{x(L=>{const fe=L.findIndex(Ee=>Ee.field===re);if(fe>=0)if(fe===0){const Ee=[...L];return Ee[0]={...Ee[0],direction:Ee[0].direction==="asc"?"desc":"asc"},Ee}else{const Ee=[...L];return Ee.splice(fe,1)[0],[{field:re,direction:"asc"},...Ee]}else return[{field:re,direction:"asc"},...L]})},Z=re=>{Y(re==="clear"?[]:re==="party-tier"?["party-tier"]:L=>L.includes(re)?L.filter(fe=>fe!==re):[...L,re])},k=re=>{H(re==="clear"?[]:L=>L.includes(re)?L.filter(fe=>fe!==re):[...L,re])},de=w.length>0,J=me.length>0;return f.useEffect(()=>{const re=fe=>{const Ee=fe.target.closest(".filter-dropdown"),Te=fe.target.closest(".header-filter-icon");Ee||Te||(O(!1),G(!1))},L=fe=>{fe.key==="Escape"&&(O(!1),G(!1))};return document.addEventListener("pointerdown",re,!0),document.addEventListener("mousedown",re,!0),document.addEventListener("touchstart",re,!0),document.addEventListener("click",re,!0),document.addEventListener("keydown",L,!0),()=>{document.removeEventListener("pointerdown",re,!0),document.removeEventListener("mousedown",re,!0),document.removeEventListener("touchstart",re,!0),document.removeEventListener("click",re,!0),document.removeEventListener("keydown",L,!0)}},[O,G]),{searchTerm:p,setSearchTerm:b,sortFields:W,handleSort:m,filteredAndSortedData:we,loading:N,refreshData:ne,selectedTiers:w,selectedTypes:me,showTierDropdown:V,setShowTierDropdown:O,showTypeDropdown:be,setShowTypeDropdown:G,tierFilterRef:Me,typeFilterRef:Re,uniqueTiers:ae,uniqueTypes:ye,handleTierSelect:Z,handleTypeSelect:k,isTierFiltered:de,isTypeFiltered:J,getDropdownStyle:re=>{if(!re.current)return{};const L=re.current.getBoundingClientRect();return{position:"fixed",top:L.bottom+4,left:L.left-100,zIndex:99999}}}},cr=({searchTerm:t,onSearchChange:s,type:c,partyControls:l,showCustomToggle:S=!1,onToggleCustom:p,filterCustom:b=!1,onExportCustomAdversaries:W,onImportCustomAdversaries:x,autoFocus:z=!1,onClose:$=null,placeholder:N="Search"})=>{const T=f.useRef(null);return f.useEffect(()=>{z&&T.current&&setTimeout(()=>{var w;(w=T.current)==null||w.focus()},100)},[z]),e.jsxs("div",{style:ie.browserHeader,children:[e.jsx("div",{style:{display:"flex",alignItems:"center",flex:1,gap:"0.5rem"},children:e.jsx("input",{ref:T,type:"text",placeholder:N,value:t,onChange:w=>s(w.target.value),style:{...ie.searchInput,flex:1,marginRight:0}})}),l&&e.jsx("div",{style:ie.partyControls,children:l})]})},pr=({showCustomToggle:t=!1,onToggleCustom:s,filterCustom:c=!1,onExportCustomAdversaries:l,onImportCustomAdversaries:S})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)",flexShrink:0},children:[t&&e.jsxs("button",{onClick:()=>s&&s(!c),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:c?"var(--purple)":"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:c?"white":"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:p=>{c||(p.target.style.backgroundColor="var(--bg-hover)",p.target.style.borderColor="var(--purple)")},onMouseLeave:p=>{c||(p.target.style.backgroundColor="var(--bg-primary)",p.target.style.borderColor="var(--border)")},children:[e.jsx("span",{children:c?"✓":"○"}),"Custom Only"]}),e.jsxs("button",{onClick:l,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:p=>{p.target.style.backgroundColor="var(--bg-hover)",p.target.style.borderColor="var(--purple)"},onMouseLeave:p=>{p.target.style.backgroundColor="var(--bg-primary)",p.target.style.borderColor="var(--border)"},children:[e.jsx("span",{children:"↓"}),"Export"]}),e.jsxs("button",{onClick:()=>document.getElementById("import-file-input").click(),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:p=>{p.target.style.backgroundColor="var(--bg-hover)",p.target.style.borderColor="var(--purple)"},onMouseLeave:p=>{p.target.style.backgroundColor="var(--bg-primary)",p.target.style.borderColor="var(--border)"},children:[e.jsx("span",{children:"↑"}),"Import"]}),e.jsx("input",{id:"import-file-input",type:"file",accept:".csv,.json",onChange:S,style:{display:"none"}})]}),ur=({sortFields:t,onSort:s,type:c,uniqueTiers:l,uniqueTypes:S,selectedTiers:p,selectedTypes:b,showTierDropdown:W,setShowTierDropdown:x,showTypeDropdown:z,setShowTypeDropdown:$,tierFilterRef:N,typeFilterRef:T,handleTierSelect:w,handleTypeSelect:Y,isTierFiltered:me,isTypeFiltered:H,getDropdownStyle:V,costFilter:O,showCostDropdown:be,setShowCostDropdown:G,costFilterRef:Me,handleCostFilterSelect:Re,isCostFiltered:Be})=>{const[ne,ae]=f.useState(null),we=(()=>c==="adversary"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"cost",label:"Cost",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:c==="environment"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:[])(),m=()=>{if(!be)return null;const k=[{value:"all",label:"All"},{value:"auto-grey",label:"Auto Grey"},{value:"auto-hide",label:"Auto Hide"}];return ct.createPortal(e.jsx("div",{className:"filter-dropdown",style:{...ie.filterDropdown,...V(Me),maxHeight:"60vh",overflow:"auto"},onMouseDown:de=>de.stopPropagation(),onClick:de=>de.stopPropagation(),children:k.map(de=>{const J=O===de.value;return e.jsxs("div",{style:{...ie.filterOption,...J?ie.filterOptionSelected:{}},onClick:()=>Re(de.value),children:[e.jsx("span",{style:ie.checkIcon,children:J?e.jsx(Ue,{size:16}):e.jsx(et,{size:16})}),e.jsx("span",{style:ie.filterLabel,children:de.label})]},de.value)})}),document.body)},Z=(k,de,J,We,re,L,fe,Ee)=>{if(!re)return null;const Te=()=>{(k==="tier"||k==="type")&&We("clear")};return ct.createPortal(e.jsxs("div",{className:"filter-dropdown",style:{...ie.filterDropdown,...V(fe),maxHeight:"60vh",overflow:"auto"},onMouseDown:Ne=>Ne.stopPropagation(),onClick:Ne=>Ne.stopPropagation(),children:[e.jsxs("div",{style:{...ie.filterOption,...J.length===0?ie.filterOptionSelected:{}},onClick:Te,children:[e.jsx("span",{style:ie.checkIcon,children:J.length===0?e.jsx(Ue,{size:16}):e.jsx(et,{size:16})}),e.jsx("span",{style:ie.filterLabel,children:"All"})]}),k==="tier"&&e.jsxs("div",{style:{...ie.filterOption,...J.includes("party-tier")?ie.filterOptionSelected:{}},onClick:()=>We("party-tier"),children:[e.jsx("span",{style:ie.checkIcon,children:J.includes("party-tier")?e.jsx(Ue,{size:16}):e.jsx(et,{size:16})}),e.jsx("span",{style:ie.filterLabel,children:"Party Tier"})]}),de.map(Ne=>{const Ce=J.includes(Ne.toString());return e.jsxs("div",{style:{...ie.filterOption,...Ce?ie.filterOptionSelected:{}},onClick:()=>We(Ne.toString()),children:[e.jsx("span",{style:ie.checkIcon,children:Ce?e.jsx(Ue,{size:16}):e.jsx(et,{size:16})}),e.jsx("span",{style:ie.filterLabel,children:Ne})]},Ne)})]}),document.body)};return e.jsx("tr",{style:ie.tableHeader,children:we.map(k=>e.jsxs("th",{style:{...ie.tableHeaderCell,...ne===k.key?ie.tableHeaderCellHover:{},position:"relative",...k.key==="name"?{width:"auto",minWidth:"0"}:{},...k.key==="tier"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...k.key==="type"?{width:"80px",minWidth:"80px",maxWidth:"80px"}:{},...k.key==="difficulty"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...k.key==="cost"?{width:"50px",minWidth:"50px",maxWidth:"50px"}:{},...k.key==="action"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{}},onClick:()=>s(k.key),onMouseEnter:()=>ae(k.key),onMouseLeave:()=>ae(null),children:[k.hasFilter?e.jsxs("div",{style:ie.headerWithFilter,children:[e.jsx("span",{style:{cursor:"pointer"},onClick:de=>{de.stopPropagation(),s(k.key)},children:k.label}),e.jsxs("button",{ref:k.key==="tier"?N:k.key==="type"?T:Me,style:{...ie.headerFilterIcon,...k.key==="tier"&&me?ie.headerFilterIconActive:{},...k.key==="type"&&H?ie.headerFilterIconActive:{},...k.key==="cost"&&Be?ie.headerFilterIconActive:{}},className:"header-filter-icon",onClick:de=>{de.stopPropagation(),k.key==="tier"?(x(!W),$(!1),G(!1)):k.key==="type"?($(!z),x(!1),G(!1)):k.key==="cost"&&(G(!be),x(!1),$(!1))},children:[e.jsx(qt,{size:14}),k.key==="tier"&&me||k.key==="type"&&H||k.key==="cost"&&Be?e.jsx("span",{style:ie.filterActiveDot}):null]})]}):k.label,k.key==="tier"&&Z("tier",l,p,w,W,x,N),k.key==="type"&&Z("type",S,b,Y,z,$,T),k.key==="cost"&&m()]},k.key))})},mr=({item:t,onAdd:s,type:c,onRowClick:l,encounterItems:S=[],pcCount:p=4,playerTier:b=1,remainingBudget:W=0,costFilter:x="auto-grey",onAdversaryClick:z})=>{const[$,N]=f.useState(!1),T=()=>{s(t)},w=()=>{if(c!=="adversary")return null;const H=Ze[t.type]||2;let V=0;const O=S.filter(G=>G.type==="adversary"&&G.item.type==="Solo"&&G.quantity>0).reduce((G,Me)=>G+Me.quantity,0),be=S.filter(G=>G.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(G.item.type)&&G.quantity>0).reduce((G,Me)=>G+Me.quantity,0);return t.type==="Solo"&&O===1&&(V+=2),["Bruiser","Horde","Leader","Solo"].includes(t.type)&&be===0&&(V+=1),H+V},me=(()=>{if(c==="adversary"){const H=w();Ze[t.type];const V=H>W||W<=0;if(x==="auto-hide"&&V)return null;const O=x==="auto-grey"&&V?{opacity:.5,color:"var(--text-secondary)"}:{};return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...ie.rowCell,width:"auto",minWidth:"0",textAlign:"left",...O},children:e.jsxs("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:[e.jsx("div",{style:{fontWeight:"600"},children:t.name}),t.description&&e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"0.125rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.description})]})}),e.jsx("td",{style:{...ie.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...O},children:t.tier}),e.jsx("td",{style:{...ie.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center",...O},children:t.type}),e.jsx("td",{style:{...ie.rowCell,width:"50px",minWidth:"50px",maxWidth:"50px",textAlign:"center",...O},children:H}),e.jsx("td",{style:{...ie.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...O},children:t.difficulty})]})}else if(c==="environment")return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...ie.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:t.name}),e.jsx("td",{style:{...ie.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:t.tier}),e.jsx("td",{style:{...ie.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:t.type}),e.jsx("td",{style:{...ie.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:t.difficulty})]});return null})();return me===null?null:e.jsx(e.Fragment,{children:e.jsxs("tr",{style:{...ie.row,...$?ie.rowHover:{}},onClick:()=>{c==="adversary"&&z?z(t):l&&l(t,c)},onMouseEnter:()=>N(!0),onMouseLeave:()=>N(!1),children:[me,e.jsx("td",{style:{width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",boxSizing:"border-box",overflow:"visible",textOverflow:"unset",whiteSpace:"nowrap"},children:e.jsx("button",{style:ie.addButton,onClick:H=>{H.stopPropagation(),T()},onMouseEnter:H=>{H.target.style.background="var(--bg-secondary)"},onMouseLeave:H=>{H.target.style.background="var(--purple)"},children:"+"})})]})})},Wt=({type:t,onAddItem:s,onCancel:c=null,onRowClick:l,encounterItems:S=[],pcCount:p=4,playerTier:b=1,partyControls:W=null,showContainer:x=!0,savedEncounters:z=[],onLoadEncounter:$,onDeleteEncounter:N,activeTab:T="adversaries",selectedCustomAdversaryId:w,onSelectCustomAdversary:Y,onTabChange:me,selectedAdversary:H,onSelectAdversary:V,filterCustom:O=!1,showCustomToggle:be=!1,onToggleCustom:G,onExportCustomAdversaries:Me,onImportCustomAdversaries:Re,autoFocus:Be=!1,hideImportExport:ne=!1,onClose:ae=null,searchPlaceholder:ye="Search"})=>{const{addCustomAdversary:we,updateCustomAdversary:m,customContent:Z}=ht(),[k,de]=f.useState(null),[J,We]=f.useState("all"),[re,L]=f.useState(!1),[fe,Ee]=f.useState({}),Te=f.useRef({}),Ne=f.useRef(null),Ce=()=>{try{const j=Z.adversaries||[];if(j.length===0){alert("No custom adversaries to export.");return}const ce=["name","tier","type","difficulty","threshold_major","threshold_severe","hp_max","stress_max","atk","weapon","range","damage","description","motives"],Ie=j.map(U=>{var q,B;return[U.name||"",U.tier||"",U.type||"",U.difficulty||"",((q=U.thresholds)==null?void 0:q.major)||"",((B=U.thresholds)==null?void 0:B.severe)||"",U.hpMax||"",U.stressMax||"",U.atk||"",U.weapon||"",U.range||"",U.damage||"",U.description||"",U.motives||""]}),h=U=>{const q=String(U);return q.includes(",")||q.includes('"')||q.includes(`
`)?`"${q.replace(/"/g,'""')}"`:q},u=[ce.join(","),...Ie.map(U=>U.map(h).join(","))].join(`
`),D=new Blob([u],{type:"text/csv;charset=utf-8;"}),P=URL.createObjectURL(D),xe=document.createElement("a");xe.href=P,xe.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(xe),xe.click(),document.body.removeChild(xe),URL.revokeObjectURL(P),console.log(`Exported ${j.length} custom adversaries to CSV`)}catch(j){console.error("Failed to export custom adversaries:",j),alert("Failed to export custom adversaries. Please try again.")}},i=j=>{const ce=j.target.files[0];if(!ce)return;const Ie=ce.name.endsWith(".csv"),h=ce.name.endsWith(".json");if(!Ie&&!h){alert("Please upload a CSV or JSON file."),j.target.value="";return}const u=new FileReader;u.onload=D=>{try{let P=[];if(Ie){const M=D.target.result.split(`
`).filter(te=>te.trim());if(M.length<2)throw new Error("CSV file is empty or invalid.");const F=M[0].split(",").map(te=>te.trim().replace(/^"|"$/g,""));for(let te=1;te<M.length;te++){const ee=[];let ze="",ve=!1;for(let Le=0;Le<M[te].length;Le++){const He=M[te][Le],Fe=M[te][Le+1];He==='"'&&ve&&Fe==='"'?(ze+='"',Le++):He==='"'?ve=!ve:He===","&&!ve?(ee.push(ze.trim()),ze=""):ze+=He}ee.push(ze.trim());const Pe={name:ee[F.indexOf("name")]||"",tier:parseInt(ee[F.indexOf("tier")])||1,type:ee[F.indexOf("type")]||"Standard",difficulty:parseInt(ee[F.indexOf("difficulty")])||11,thresholds:{major:parseInt(ee[F.indexOf("threshold_major")])||7,severe:parseInt(ee[F.indexOf("threshold_severe")])||12},hpMax:parseInt(ee[F.indexOf("hp_max")])||3,stressMax:parseInt(ee[F.indexOf("stress_max")])||1,atk:parseInt(ee[F.indexOf("atk")])||1,weapon:ee[F.indexOf("weapon")]||"",range:ee[F.indexOf("range")]||"Melee",damage:ee[F.indexOf("damage")]||"",description:ee[F.indexOf("description")]||"",motives:ee[F.indexOf("motives")]||"",source:"Homebrew"};Pe.name&&P.push(Pe)}}else if(h){const ge=JSON.parse(D.target.result);if(!ge.customAdversaries||!Array.isArray(ge.customAdversaries))throw new Error("Invalid JSON format. Expected customAdversaries array.");P=ge.customAdversaries}const xe=Z.adversaries||[],U=[...xe];let q=0,B=0;P.forEach(ge=>{if(xe.some(F=>F.name===ge.name&&F.source===ge.source))B++;else{const F={...ge,id:`custom-adv-${Date.now()}-${Math.random().toString(36).slice(2,10)}`,hp:0,stress:0};U.push(F),q++}}),q>0?(localStorage.setItem("daggerheart-custom-adversaries",JSON.stringify(U)),window.location.reload(),alert(`Import successful! Added ${q} new adversaries${B>0?`, skipped ${B} duplicates`:""}.`)):alert("No new adversaries were added. All imported adversaries already exist.")}catch(P){console.error("Failed to import custom adversaries:",P),alert(`Failed to import custom adversaries: ${P.message}`)}},u.readAsText(ce),j.target.value=""},g=()=>{de(null)},y=async(j,ce)=>{ce?m(ce,j):we(j)},r=j=>{fe[j]?(N&&N(j),Ee(ce=>{const Ie={...ce};return delete Ie[j],Ie}),Te.current[j]&&(clearTimeout(Te.current[j]),delete Te.current[j])):(Ee(ce=>({...ce,[j]:!0})),Te.current[j]&&clearTimeout(Te.current[j]),Te.current[j]=setTimeout(()=>{Ee(ce=>{const Ie={...ce};return delete Ie[j],Ie}),delete Te.current[j]},3e3))};f.useEffect(()=>()=>{Object.values(Te.current).forEach(j=>{clearTimeout(j)})},[]);const{searchTerm:n,setSearchTerm:I,sortFields:C,handleSort:X,filteredAndSortedData:he,loading:je,selectedTiers:Ae,selectedTypes:Oe,showTierDropdown:a,setShowTierDropdown:E,showTypeDropdown:o,setShowTypeDropdown:A,tierFilterRef:K,typeFilterRef:R,uniqueTiers:le,uniqueTypes:Se,handleTierSelect:d,handleTypeSelect:v,isTierFiltered:_,isTypeFiltered:se,getDropdownStyle:Q}=dr(t,S,p,b,O),pe=(()=>{const j=3*p+2,ce=S.reduce((q,B)=>{if(B.type==="adversary"){const ge=Ze[B.item.type]||2;if(B.item.type==="Minion"){const M=Math.ceil(B.quantity/p);return q+M*ge}else return q+B.quantity*ge}return q},0);let Ie=0;S.filter(q=>q.type==="adversary"&&q.item.type==="Solo"&&q.quantity>0).reduce((q,B)=>q+B.quantity,0)>=2&&(Ie+=tt.twoOrMoreSolos);const u=S.some(q=>q.type==="adversary"&&q.item.type==="Bruiser"&&q.quantity>0),D=S.some(q=>q.type==="adversary"&&q.item.type==="Horde"&&q.quantity>0),P=S.some(q=>q.type==="adversary"&&q.item.type==="Leader"&&q.quantity>0),xe=S.some(q=>q.type==="adversary"&&q.item.type==="Solo"&&q.quantity>0);return!u&&!D&&!P&&!xe&&(Ie+=tt.noBruisersHordesLeadersSolos),j+Ie-ce})(),ue=j=>{We(j),L(!1)},oe=J!=="all";return je?e.jsx("div",{style:ie.browser,children:e.jsx("div",{style:ie.loading,children:"Loading..."})}):e.jsx(e.Fragment,{children:e.jsxs("div",{style:x?ie.browserWrapper:ie.browserWrapperNoContainer,children:[T==="adversaries"&&e.jsxs(e.Fragment,{children:[e.jsx(cr,{searchTerm:n,onSearchChange:I,type:t,partyControls:W,autoFocus:Be,onClose:ae,placeholder:ye}),!ne&&e.jsx(pr,{showCustomToggle:be,onToggleCustom:G,filterCustom:O,onExportCustomAdversaries:Ce,onImportCustomAdversaries:i}),e.jsx("div",{className:"browser-content invisible-scrollbar",style:ie.browserContent,children:e.jsxs("table",{style:ie.browserTable,children:[e.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,backgroundColor:"var(--bg-primary)"},children:e.jsx(ur,{sortFields:C,onSort:X,type:t,uniqueTiers:le,uniqueTypes:Se,selectedTiers:Ae,selectedTypes:Oe,showTierDropdown:a,setShowTierDropdown:E,showTypeDropdown:o,setShowTypeDropdown:A,tierFilterRef:K,typeFilterRef:R,handleTierSelect:d,handleTypeSelect:v,isTierFiltered:_,isTypeFiltered:se,getDropdownStyle:Q,costFilter:J,showCostDropdown:re,setShowCostDropdown:L,costFilterRef:Ne,handleCostFilterSelect:ue,isCostFiltered:oe})}),e.jsx("tbody",{children:he.map(j=>e.jsx(mr,{item:j,onAdd:s,type:t,onRowClick:l,encounterItems:S,pcCount:p,playerTier:b,remainingBudget:pe,costFilter:J,onAdversaryClick:ce=>{t==="adversary"&&(H&&H.id===ce.id?V&&V(null):V&&V(ce))}},j.id))})]})})]}),T==="encounters"&&e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:z.length===0?e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",textAlign:"center",padding:"2rem 1rem"},children:"No saved encounters yet"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:z.map(j=>e.jsxs("div",{onClick:()=>$&&$(j.id),className:"saved-encounter-card",style:{border:"1px solid var(--border)",borderRadius:"8px",padding:"8px",backgroundColor:"var(--bg-card)",transition:"background-color 0.2s ease",display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsxs("div",{style:{minWidth:"100px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",flexDirection:"column",justifyContent:"center",minHeight:"60px"},children:[e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Tier: ",(()=>{var h,u,D,P;const ce=((P=(D=(u=(h=j.encounterItems)==null?void 0:h.filter(xe=>xe.type==="adversary"))==null?void 0:u.map(xe=>xe.item.tier))==null?void 0:D.filter(xe=>xe!=null))==null?void 0:P.sort((xe,U)=>xe-U))||[];if(ce.length===0)return"N/A";if(ce.length===1)return ce[0];const Ie=[...new Set(ce)];return Ie.length===1?Ie[0]:`${Math.min(...Ie)}-${Math.max(...Ie)}`})()]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Party Size: ",j.partySize||4]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)"},children:["Balance: ",(()=>{const ce=j.partySize||4,Ie=3*ce+2;let h=0;const u=j.encounterItems||[];u.filter(M=>M.type==="adversary"&&M.item.type==="Solo"&&M.quantity>0).reduce((M,F)=>M+F.quantity,0)>=2&&(h+=tt.twoOrMoreSolos);const P=u.some(M=>M.type==="adversary"&&M.item.type==="Bruiser"&&M.quantity>0),xe=u.some(M=>M.type==="adversary"&&M.item.type==="Horde"&&M.quantity>0),U=u.some(M=>M.type==="adversary"&&M.item.type==="Leader"&&M.quantity>0),q=u.some(M=>M.type==="adversary"&&M.item.type==="Solo"&&M.quantity>0);!P&&!xe&&!U&&!q&&(h+=tt.noBruisersHordesLeadersSolos);const B=Ie+h,ge=u.reduce((M,F)=>{if(F.type==="adversary"){const te=Ze[F.item.type]||2;if(F.item.type==="Minion"){const ee=Math.ceil(F.quantity/ce);return M+ee*te}else return M+F.quantity*te}return M},0);return ge>B?`+${ge-B}`:ge===B?"0":`-${B-ge}`})()]})]}),e.jsx("div",{style:{minWidth:"120px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",alignItems:"center",minHeight:"60px"},children:e.jsx("div",{style:{fontWeight:"500",color:"var(--text-primary)",fontSize:"0.9rem",wordWrap:"break-word",wordBreak:"break-word",width:"150px",maxWidth:"150px"},children:j.name})}),e.jsx(ir,{encounter:j}),e.jsx("button",{onClick:ce=>{ce.stopPropagation(),r(j.id)},style:{background:fe[j.id]?"var(--danger)":"var(--gray-600)",border:"none",color:"white",padding:"0.4rem 0.8rem",borderRadius:"4px",fontSize:"0.75rem",cursor:"pointer",minWidth:"60px",transition:"background-color 0.2s"},children:"Delete"})]},j.id))})}),T==="create"&&e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"1rem",display:"flex",justifyContent:"center",alignItems:"flex-start",height:"100%",minHeight:0},children:e.jsx("div",{style:{maxWidth:"600px",width:"100%",height:"auto",display:"flex",flexDirection:"column",padding:"0",overflowY:"visible",overflowX:"hidden",minHeight:0},children:e.jsx(Rt,{onSave:y,onRefresh:()=>{},onAddItem:s,editingAdversary:k,onCancelEdit:g,embedded:!1})})}),T==="info"&&e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"2rem"},children:[e.jsxs("div",{style:{marginBottom:"2rem",textAlign:"center"},children:[e.jsx("img",{src:nr,alt:"Daggerheart Community Content Logo",style:{width:"100%",maxWidth:"300px",height:"auto",margin:"0 auto 1.5rem auto",display:"block"},onError:j=>{console.error("Failed to load Daggerheart logo:",j.target.src),j.target.style.display="none"}}),e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",textAlign:"left",maxWidth:"600px",margin:"0 auto"},children:[e.jsx("p",{style:{marginTop:0},children:"This product includes materials from the Daggerheart System Reference Document 1.0, © Critical Role, LLC, under the terms of the Darrington Press Community Gaming (DPCGL) License."}),e.jsxs("p",{children:["More information can be found at ",e.jsx("a",{href:"https://www.daggerheart.com",target:"_blank",rel:"noopener noreferrer",style:{color:"var(--purple)",textDecoration:"underline"},children:"daggerheart.com"})]}),e.jsx("p",{style:{marginBottom:0},children:e.jsx("em",{children:"This project is unofficial and not endorsed by Darrington Press or Critical Role."})})]})]}),e.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto",border:"1px solid var(--border)",borderRadius:"8px",overflow:"hidden"},children:[e.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"1rem 1.5rem",color:"var(--text-primary)",border:"none",background:"var(--bg-secondary)",width:"100%",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"0.875rem",borderBottom:"1px solid var(--border)"},onMouseEnter:j=>{j.target.style.backgroundColor="var(--bg-hover)"},onMouseLeave:j=>{j.target.style.backgroundColor="var(--bg-secondary)"},onClick:j=>{j.stopPropagation(),window.open("https://github.com/Splinter714/Daggerheart","_blank")},children:[e.jsx("span",{children:"View on GitHub"}),e.jsx("span",{children:"→"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem 1.5rem",color:"var(--text-secondary)",background:"var(--bg-secondary)",fontSize:"0.875rem"},children:["Version ","0.4.6 (2a14296)"]})]})]})]})})},ie={browserWrapper:{display:"flex",flexDirection:"column",background:"var(--bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border)",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserWrapperNoContainer:{display:"flex",flexDirection:"column",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserContent:{flex:1,overflowY:"auto",overflowX:"visible",padding:0,width:"100%",scrollbarWidth:"none",msOverflowStyle:"none",borderRadius:"0 0 8px 8px"},tableHeaderContainer:{flexShrink:0,position:"sticky",top:0,zIndex:15,backgroundColor:"var(--bg-secondary)"},browserTable:{width:"100%",minWidth:"100%",borderCollapse:"collapse",tableLayout:"fixed",background:"var(--bg-primary)",margin:0},browserHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--gray-900)",flexShrink:0,position:"sticky",top:0,zIndex:20},browserTitle:{margin:0,color:"var(--text-primary)",fontSize:"18px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"24px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",marginRight:"12px",transition:"all 0.2s ease"},partyControls:{display:"flex",alignItems:"center",gap:"12px",flexShrink:0},searchInputFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 3px rgba(139, 92, 246, 0.1)"},tableHeader:{background:"var(--gray-900)",borderBottom:"1px solid var(--border)",boxShadow:"0 1px 0 var(--border)",position:"sticky",top:"0",zIndex:10},tableHeaderCell:{backgroundColor:"var(--gray-900)",fontWeight:"700",borderBottom:"1px solid var(--border)",cursor:"pointer",userSelect:"none",minWidth:"100px",whiteSpace:"nowrap",padding:"4px 4px",color:"var(--text-primary)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",boxShadow:"0 1px 0 var(--border)",transition:"background-color 0.2s",position:"sticky",top:"0",zIndex:10},tableHeaderCellHover:{backgroundColor:"var(--bg-hover)"},sortIndicator:{fontSize:"12px",color:"var(--text-secondary)"},tableBody:{flex:1,overflowY:"auto",padding:"8px",backgroundColor:"var(--bg-primary)"},row:{height:"35px",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s ease",cursor:"pointer",backgroundColor:"var(--gray-900)"},rowHover:{backgroundColor:"var(--bg-secondary)"},expandedRow:{backgroundColor:"var(--bg-secondary)"},rowCell:{padding:"4px 4px",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid var(--border)"},rowCellName:{fontWeight:"500",minWidth:"150px"},rowCellCenter:{textAlign:"center",justifyContent:"center",minWidth:"80px"},rowActions:{width:"80px",textAlign:"center",padding:"4px 8px",borderBottom:"1px solid var(--border)"},addButton:{width:"2rem",height:"2rem",border:"1px solid var(--purple)",borderRadius:"var(--radius-sm)",background:"var(--purple)",color:"white",cursor:"pointer",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"500"},expandedContent:{padding:"0",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)"},columnName:{width:"auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",paddingLeft:"8px",textAlign:"left"},columnTier:{width:"80px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnType:{width:"100px",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},columnDifficulty:{width:"40px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnAction:{width:"32px",minWidth:"24px",maxWidth:"24px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"visible",textOverflow:"unset"},loading:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"var(--text-primary)",fontSize:"16px"},mobileBrowser:{width:"95vw",height:"90vh",maxWidth:"none"},mobileSearchInput:{fontSize:"16px"},headerWithFilter:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0px",position:"relative"},headerFilterIcon:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"2px 4px",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",position:"relative",marginLeft:"-2px"},headerFilterIconActive:{color:"var(--purple)"},filterIcon:{fontSize:"12px"},filterActiveDot:{position:"absolute",left:"50%",top:"2px",transform:"translateX(-50%)",width:"4px",height:"4px",borderRadius:"50%",background:"var(--purple)",pointerEvents:"none"},filterDropdown:{position:"fixed",background:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",zIndex:99999,marginTop:"4px",overflow:"hidden",width:"max-content",minWidth:"120px",maxWidth:"200px"},filterOption:{padding:"8px 12px",cursor:"pointer",color:"var(--text-primary)",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background-color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},filterOptionSelected:{backgroundColor:"var(--bg-hover)"},checkIcon:{width:"16px",height:"16px",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"12px"},filterLabel:{flex:1}},fr=()=>e.jsx("div",{className:"pwa-install-prompt",style:{}}),lt=({side:t="left",children:s,className:c="",style:l={}})=>{const S=t==="left",p={flex:1,minWidth:0,background:"var(--bg-primary)",overflowY:"auto",overflowX:S?"auto":"hidden",display:S?"block":"flex",flexDirection:S?"initial":"column",height:"100%",padding:S?"8px 0 8px 0":"0 8px 0 0",...l};return e.jsx("div",{className:c,style:p,children:s})},hr=t=>3*t+2,xr={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},dt={lessDifficult:-1,twoOrMoreSolos:-2,increasedDamage:-2,lowerTierAdversary:1,noBruisersHordesLeadersSolos:1,moreDangerous:2},gr=({isOpen:t,onClose:s,onAddAdversary:c,onAddAdversariesBulk:l,onAddEnvironment:S,onDeleteAdversary:p,onDeleteEnvironment:b,onDeleteCountdown:W,adversaries:x=[],environments:z=[],countdowns:$=[],savedEncounters:N=[],onSaveEncounter:T,onLoadEncounter:w,onDeleteEncounter:Y})=>{const{partySize:me,updatePartySize:H,currentEncounterName:V,updateCurrentEncounterName:O,customContent:be}=ht(),G=me,Me=H,[Re,Be]=f.useState({lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),[ne,ae]=f.useState([]),[ye,we]=f.useState(V||"Encounter"),[m,Z]=f.useState("adversaries"),[k,de]=f.useState(null),[J,We]=f.useState(null),[re,L]=f.useState(null),[fe,Ee]=f.useState(null),[Te,Ne]=f.useState(!1);f.useEffect(()=>{t&&!k&&we(V||"Encounter")},[t,k,V]);const Ce=()=>J?ye!==J.name||JSON.stringify(ne)!==JSON.stringify(J.encounterItems)||G!==J.partySize||JSON.stringify(Re)!==JSON.stringify(J.battlePointsAdjustments):!1,i=()=>{var d;if(ne.length>0||(ye||"").trim()!=="Encounter")return!0;if(k&&Ce()){if(J){const v=ne.length,_=((d=J.encounterItems)==null?void 0:d.length)||0;if(v!==_||(ye||"").trim()!==(J.name||""))return!0;const se=JSON.stringify(Re),Q=JSON.stringify(J.battlePointsAdjustments||{});return se!==Q}return!0}return!1},g=({onClick:d,children:v,variant:_="secondary",isConfirmation:se=!1})=>{const Q=_==="danger"||_==="secondary"&&se,ke=_==="purple";return e.jsx("button",{onClick:d,style:{background:Q?"var(--danger)":ke?"var(--purple)":"var(--bg-secondary)",border:ke?"none":"1px solid var(--border)",color:Q||ke?"white":"var(--text-primary)",padding:"0.375rem 0.75rem",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s",width:"70px",fontSize:"0.875rem"},children:v})},y=Ve.useRef(G),r=f.useCallback(d=>!d||d.length===0?null:N.find(_=>{var pe,ue;if(((pe=_.encounterItems)==null?void 0:pe.length)!==d.length)return!1;const se=oe=>{var j;return{type:oe.type,quantity:oe.quantity,item:{name:oe.item.baseName||((j=oe.item.name)==null?void 0:j.replace(/\s+\(\d+\)$/,""))||oe.item.name,type:oe.item.type,tier:oe.item.tier}}},Q=(ue=_.encounterItems)==null?void 0:ue.map(se).sort((oe,j)=>oe.item.name.localeCompare(j.item.name)||oe.item.type.localeCompare(j.item.type)),ke=d.map(se).sort((oe,j)=>oe.item.name.localeCompare(j.item.name)||oe.item.type.localeCompare(j.item.type));return JSON.stringify(Q)===JSON.stringify(ke)})||null,[N]);Ve.useEffect(()=>{if(t&&x.length>0&&ne.length===0){const d={};x.forEach(se=>{var ke;const Q=se.baseName||((ke=se.name)==null?void 0:ke.replace(/\s+\(\d+\)$/,""))||se.name;d[Q]||(d[Q]={type:"adversary",item:se,quantity:0}),d[Q].quantity+=1});const v=Object.values(d);ae(v);const _=r(v);_&&!k&&(de(_.id),We({name:_.name||"",encounterItems:_.encounterItems||[],partySize:_.partySize||4,battlePointsAdjustments:_.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),we(_.name||"Encounter"),O(_.name||"Encounter"))}else t&&x.length===0&&ne.length===0&&ae([])},[t,r,k,O]);const n=Ve.useMemo(()=>{let d=0;ne.filter(pe=>pe.type==="adversary"&&pe.item.type==="Solo"&&pe.quantity>0).reduce((pe,ue)=>pe+ue.quantity,0)>=2&&(d+=dt.twoOrMoreSolos);const _=ne.some(pe=>pe.type==="adversary"&&pe.item.type==="Bruiser"&&pe.quantity>0),se=ne.some(pe=>pe.type==="adversary"&&pe.item.type==="Horde"&&pe.quantity>0),Q=ne.some(pe=>pe.type==="adversary"&&pe.item.type==="Leader"&&pe.quantity>0),ke=ne.some(pe=>pe.type==="adversary"&&pe.item.type==="Solo"&&pe.quantity>0);return!_&&!se&&!Q&&!ke&&(d+=dt.noBruisersHordesLeadersSolos),d},[ne]),I=hr(G),C=Object.entries(Re).filter(([d,v])=>v).reduce((d,[v,_])=>d+dt[v],0),X=I+C+n,he=ne.reduce((d,v)=>{if(v.type==="adversary"){const _=xr[v.item.type]||2;return v.item.type==="Minion"?d+Math.ceil(v.quantity/G)*_:d+_*v.quantity}return d},0);Ve.useEffect(()=>{const d=y.current;d!==G&&(ae(v=>v.map(_=>{if(_.type==="adversary"&&_.item.type==="Minion"){const Q=Math.ceil(_.quantity/d)*G;return{..._,quantity:Q}}return _})),y.current=G)},[G]);const je=(d,v)=>{const _=ne.findIndex(ke=>ke.item.id===d.id&&ke.type===v),se=d.type==="Minion"?G:1;let Q;_>=0?Q=ne.map((ke,pe)=>pe===_?{...ke,quantity:ke.quantity+se}:ke):Q=[...ne,{item:d,type:v,quantity:se}],ae(Q),Ae(Q)},Ae=d=>{const v=x||[],_=[];d.forEach(ue=>{for(let oe=0;oe<ue.quantity;oe++)ue.type==="adversary"&&_.push(ue.item)});const se={};v.forEach(ue=>{var j;const oe=ue.baseName||((j=ue.name)==null?void 0:j.replace(/\s+\(\d+\)$/,""))||ue.name;se[oe]||(se[oe]=[]),se[oe].push(ue)});const Q={};_.forEach(ue=>{var j;const oe=ue.baseName||((j=ue.name)==null?void 0:j.replace(/\s+\(\d+\)$/,""))||ue.name;Q[oe]||(Q[oe]=[]),Q[oe].push(ue)});const ke=[],pe=[];Object.keys(Q).forEach(ue=>{var ce;const oe=((ce=se[ue])==null?void 0:ce.length)||0,j=Q[ue].length;if(j>oe){const Ie=j-oe;for(let h=0;h<Ie;h++)ke.push(Q[ue][0])}else if(j<oe){const Ie=oe-j,u=[...se[ue]].sort((D,P)=>{const xe=D.duplicateNumber||1;return(P.duplicateNumber||1)-xe});for(let D=0;D<Ie;D++)pe.push(u[D].id)}}),Object.keys(se).forEach(ue=>{Q[ue]||[...se[ue]].sort((ce,Ie)=>{const h=ce.duplicateNumber||1;return(Ie.duplicateNumber||1)-h}).forEach(ce=>{pe.push(ce.id)})}),pe.forEach(ue=>{p(ue)}),ke.length>0&&l(ke)},Oe=(d,v)=>{const _=(()=>{const se=ne.findIndex(Q=>Q.item.id===d&&Q.type===v);if(se>=0){const Q=ne[se];if(Q.quantity===0)return ne.filter((ue,oe)=>oe!==se);const ke=Q.item.type==="Minion"?G:1,pe=Math.max(0,Q.quantity-ke);return ne.map((ue,oe)=>oe===se?{...ue,quantity:pe}:ue)}return ne})();ae(_),Ae(_)},a=f.useCallback(()=>{if(ne.length===0)return null;const d=(ye||"").trim()||"Encounter",v=N.find(_=>{var ke,pe;if(_.name!==d||((ke=_.encounterItems)==null?void 0:ke.length)!==ne.length)return!1;const se=JSON.stringify((pe=_.encounterItems)==null?void 0:pe.sort()),Q=JSON.stringify([...ne].sort());return se===Q});return(v==null?void 0:v.id)||null},[N,ye,ne]),E=f.useCallback(()=>{let d=(ye||"").trim(),v=k;if(v||(v=a()),ne.length===0&&(!d||d==="Encounter")&&v){Y(v),de(null),We(null);return}const _={name:d,encounterItems:ne,partySize:G,battlePointsAdjustments:Re};if(v){_.id=v;const se=T(_);de(se)}else{const se=T(_);de(se)}We({name:d,encounterItems:ne,partySize:G,battlePointsAdjustments:Re})},[ne,ye,G,Re,k,T,a,Y]);f.useEffect(()=>{if(k&&Ce()){const d=setTimeout(()=>{E()},2e3);return()=>clearTimeout(d)}else if(!k&&ne.length>0&&ye&&ye.trim()!==""){const d=setTimeout(()=>{E()},2e3);return()=>clearTimeout(d)}},[ne,k,ye,Re,G]);const o=()=>{i()&&(ae([]),we("Encounter"),O("Encounter"),de(null),We(null),x.forEach(d=>{p(d.id)}),z.forEach(d=>{b(d.id)}),$.forEach(d=>{W(d.id)}))},A=d=>{const v=w(d);if(v){const _=v.encounterItems||[];ae(_),Me(v.partySize||4),Be(v.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),we(v.name||""),O(v.name||""),de(d),We({name:v.name||"",encounterItems:v.encounterItems||[],partySize:v.partySize||4,battlePointsAdjustments:v.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),Ae(_)}},K=d=>{Y(d),k===d&&(ae([]),we("Encounter"),O("Encounter"),de(null),We(null),x.forEach(v=>{p(v.id)}),z.forEach(v=>{b(v.id)}),$.forEach(v=>{W(v.id)}))},R=()=>{try{const d={version:"1.0",exportDate:new Date().toISOString(),customAdversaries:be.adversaries||[]},v=JSON.stringify(d,null,2),_=new Blob([v],{type:"application/json"}),se=URL.createObjectURL(_),Q=document.createElement("a");Q.href=se,Q.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(Q),Q.click(),document.body.removeChild(Q),URL.revokeObjectURL(se),console.log("Custom adversaries exported successfully")}catch(d){console.error("Failed to export custom adversaries:",d),alert("Failed to export custom adversaries. Please try again.")}},le=d=>{const v=d.target.files[0];if(!v)return;const _=new FileReader;_.onload=se=>{try{const Q=JSON.parse(se.target.result);if(!Q.customAdversaries||!Array.isArray(Q.customAdversaries))throw new Error("Invalid file format. Expected customAdversaries array.");const ke=be.adversaries||[],pe=Q.customAdversaries,ue=[...ke];let oe=0;pe.forEach(j=>{ke.some(Ie=>Ie.name===j.name&&Ie.type===j.type)||(ue.push({...j,id:`custom-${Date.now()}-${Math.random().toString(36).slice(2,10)}`}),oe++)}),updateCustomContent("adversary",null,ue),oe>0?alert(`Successfully imported ${oe} custom adversaries.`):alert("No new adversaries were added. All imported adversaries already exist.")}catch(Q){console.error("Failed to import custom adversaries:",Q),alert("Failed to import custom adversaries. Please check the file format and try again.")}},_.readAsText(v),d.target.value=""};if(!t)return null;const Se=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://");return e.jsx("div",{onClick:s,className:"encounter-builder-modal",style:{position:"fixed",top:0,left:0,right:0,bottom:Se?"calc(60px + env(safe-area-inset-bottom) + 1rem)":"calc(60px + env(safe-area-inset-bottom))",backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:1e3,display:"flex",alignItems:"flex-start",justifyContent:"center",padding:"12px"},children:e.jsxs("div",{onClick:d=>d.stopPropagation(),style:{backgroundColor:"var(--bg-primary)",border:"2px solid var(--border)",borderRadius:"12px",width:"100%",maxWidth:"1200px",height:"100%",maxHeight:"100%",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"},children:[e.jsxs("div",{className:"encounter-top-bar",style:{flex:"0 0 auto",display:"flex",alignItems:"center",height:"39px",backgroundColor:"var(--bg-primary)",borderBottom:"1px solid var(--border)"},children:[e.jsx("button",{onClick:()=>Z("adversaries"),style:{flex:1,background:m==="adversaries"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:m==="adversaries"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Builder"}),e.jsx("button",{onClick:()=>Z("encounters"),style:{flex:1,background:m==="encounters"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:m==="encounters"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Saved Encounters"}),e.jsx("button",{onClick:()=>Z("create"),style:{flex:1,background:m==="create"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:m==="create"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Create Adversary"}),e.jsx("button",{onClick:()=>Z("info"),style:{flex:1,background:m==="info"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:m==="info"?"500":"400",transition:"all 0.2s ease",position:"relative"},children:"Info"})]}),e.jsxs("div",{className:"encounter-builder-content",style:{flex:1,display:"flex",overflow:"hidden"},children:[e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",borderTop:"1px solid var(--border)"},children:e.jsx(Wt,{type:"adversary",onAddItem:d=>je(d,"adversary"),encounterItems:ne,pcCount:G,showContainer:!1,savedEncounters:N,onLoadEncounter:A,onDeleteEncounter:K,activeTab:m,selectedCustomAdversaryId:re,onSelectCustomAdversary:L,onTabChange:Z,selectedAdversary:fe,onSelectAdversary:Ee,filterCustom:Te,showCustomToggle:!0,onToggleCustom:Ne,onExportCustomAdversaries:R,onImportCustomAdversaries:le})}),m!=="info"&&e.jsxs("div",{className:"encounter-right-panel",style:{flex:1,borderLeft:"1px solid var(--border)",display:"flex",flexDirection:"column",overflow:"hidden",position:"relative"},children:[fe&&e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"var(--bg-primary)",zIndex:10,display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)",flexShrink:0},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:0},children:"Adversary Preview"}),e.jsx("button",{onClick:()=>Ee(null),style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease"},onMouseEnter:d=>d.target.style.color="var(--text-primary)",onMouseLeave:d=>d.target.style.color="var(--text-secondary)",title:"Close preview",children:e.jsx(Xe,{size:16})})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"0.75rem"},children:e.jsx(nt,{item:{...fe,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...fe,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}})})]}),(m==="adversaries"||m==="encounters")&&e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-primary)",flexShrink:0},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:ye,onChange:d=>{we(d.target.value),O(d.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(g,{onClick:o,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:i()?1:.5,cursor:i()?"pointer":"not-allowed"},children:"New"})]})}),(m==="adversaries"||m==="encounters")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"encounter-receipt-buttons-vertical",style:{display:"none",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:ye,onChange:d=>{we(d.target.value),O(d.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(g,{onClick:o,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:i()?1:.5,cursor:i()?"pointer":"not-allowed"},children:"New"})]})}),e.jsx("div",{className:"receipt-content",style:{padding:"1rem",display:"flex",flexDirection:"column",height:"100%"},children:e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"flex-start",overflowY:"auto",marginBottom:"0.75rem"},children:[e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>Me(Math.max(1,G-1)),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(pt,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:G}),e.jsx("button",{onClick:()=>Me(G+1),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(Ke,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Party Size"})}),e.jsx("div",{style:{width:"120px",textAlign:"right"}})]}),ne.map(d=>{var v;return d.type!=="adversary"?null:e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>Oe(d.item.id,d.type),style:{background:d.quantity===0?"var(--danger)":"var(--bg-secondary)",border:d.quantity===0?"none":"1px solid var(--border)",color:d.quantity===0?"white":"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:d.quantity===0?e.jsx(Xe,{size:10}):e.jsx(pt,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:d.quantity}),e.jsx("button",{onClick:()=>je(d.item,d.type),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(Ke,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:d.item.baseName||((v=d.item.name)==null?void 0:v.replace(/\s+\(\d+\)$/,""))||d.item.name})}),e.jsx("div",{style:{width:"80px",textAlign:"right"},children:e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.8rem"},children:d.item.type})})]},`${d.item.id}-${d.type}`)}),e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Balance"})}),e.jsx("div",{style:{width:"120px",textAlign:"right",display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsx("span",{style:{color:he>X?"var(--danger)":he===X?"var(--purple)":"var(--success)",fontWeight:600},children:he>X?`+${he-X}`:X-he===0?"0":`-${X-he}`})})]})]})})]}),m==="create"&&e.jsxs("div",{style:{padding:"1.5rem",overflowY:"auto",height:"100%"},children:[e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Creating Adversaries"}),e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsx("p",{children:"Use the form to create custom adversaries for your encounters."}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Adversary Types:"}),e.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Minion (1 BP):"})," Weak enemies in groups"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Standard (2 BP):"})," Average threat level"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Leader (3 BP):"})," Commands others"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Bruiser (4 BP):"})," High HP tank"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Solo (5 BP):"})," Boss-level threat"]})]})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Tips:"}),e.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[e.jsx("li",{children:"Match adversary tier to party level"}),e.jsx("li",{children:"Balance encounter difficulty with Battle Points"}),e.jsx("li",{children:"Mix adversary types for variety"}),e.jsx("li",{children:"Add features that create interesting choices"})]})]})]})]}),m==="myAdversaries"&&e.jsx("div",{style:{padding:"0.75rem",overflowY:"auto",height:"100%"},children:re?(()=>{var v;const d=(v=be==null?void 0:be.adversaries)==null?void 0:v.find(_=>_.id===re);return d?e.jsx(nt,{item:{...d,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...d,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}}):e.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Adversary not found"})})():e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Adversary Preview"}),e.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Select an adversary to view details"})]})})]})]})]})})},yr=t=>3*t+2,vr={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},kt={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1};class br extends Ve.Component{constructor(s){super(s),this.state={hasError:!1,error:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,c){console.error("ErrorBoundary caught an error:",s,c)}render(){var s;return this.state.hasError?e.jsxs("div",{className:"p-md text-red",children:[e.jsx("h3",{children:"Something went wrong:"}),e.jsx("pre",{children:(s=this.state.error)==null?void 0:s.toString()}),e.jsx("button",{className:"btn-base btn-text",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try again"})]}):this.props.children}}const wr=()=>{const{adversaries:t,environments:s,countdowns:c,fear:l,savedEncounters:S,partySize:p,updateFear:b,createAdversary:W,createAdversariesBulk:x,updateAdversary:z,deleteAdversary:$,createEnvironment:N,updateEnvironment:T,deleteEnvironment:w,createCountdown:Y,updateCountdown:me,deleteCountdown:H,advanceCountdown:V,saveEncounter:O,loadEncounter:be,deleteEncounter:G}=ht(),Me=p||4,[Re,Be]=f.useState(!1),[ne,ae]=f.useState(!1);f.useState(!1),f.useState(!1),f.useState(!0);const[ye,we]=f.useState(null),[m,Z]=f.useState(null),[k,de]=f.useState(null),[J,We]=f.useState(!1),[re,L]=f.useState(0),[fe,Ee]=f.useState(0),[Te,Ne]=f.useState(!1);f.useState(new Set);const[Ce,i]=f.useState(new Set),[g,y]=f.useState(null),[r,n]=f.useState(!1),I=f.useRef(null);f.useEffect(()=>{const h=()=>{const D=window.matchMedia("(max-width: 800px)");Be(D.matches)};h();const u=window.matchMedia("(max-width: 800px)");return u.addEventListener("change",h),()=>u.removeEventListener("change",h)},[]);const C=12,X=h=>h===1?200:350,he=h=>{if(h<=0)return{visibleColumns:1,columnWidth:X(1)};const u=C*2,D=h-u;let P={visibleColumns:1,columnWidth:D};for(let U=1;U<=5;U++){const q=(U-1)*C,B=(D-q)/U;B>=X(U)&&U*B+q<=D&&(P={visibleColumns:U,columnWidth:B})}return P.visibleColumns*P.columnWidth+(P.visibleColumns-1)*C>D&&(P={visibleColumns:1,columnWidth:D}),P},{visibleColumns:je,columnWidth:Ae}=he(re);f.useEffect(()=>{const h=()=>{L(window.innerWidth)};return h(),window.addEventListener("resize",h),()=>window.removeEventListener("resize",h)},[]);const Oe=f.useCallback(()=>{ae(!1)},[]),a=f.useCallback(h=>{let u=!1;if(I.current){const D=I.current,P=D.scrollLeft,xe=D.scrollWidth-D.clientWidth;u=Math.abs(P-xe)<1,u&&(D._wasAtMaxScrollOnBrowserOpen=!0)}Z(h)},[]);f.useEffect(()=>{m!==null&&I.current&&I.current._wasAtMaxScrollOnBrowserOpen&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(I.current){const D=I.current,P=D.scrollWidth-D.clientWidth;D.scrollLeft=P,D._wasAtMaxScrollOnBrowserOpen=!1}})})},[m,Ae,C]);const E=f.useCallback(()=>{Z(null)},[]),o=f.useCallback((h,u=500,D="unknown")=>{if(console.log("[HORIZONTAL_SCROLL] smoothScrollTo called:",{targetScrollLeft:h,duration:u,reason:D,timestamp:performance.now()}),!I.current){console.log("[HORIZONTAL_SCROLL] No container ref, aborting");return}const P=I.current,xe=P.scrollLeft,U=h-xe;if(console.log("[HORIZONTAL_SCROLL] Scroll params:",{startScrollLeft:xe,targetScrollLeft:h,distance:U,containerWidth:P.clientWidth,scrollWidth:P.scrollWidth}),Math.abs(U)<1){console.log("[HORIZONTAL_SCROLL] Distance too small, skipping animation");return}P._horizontalScrollAnimationId&&(console.log("[HORIZONTAL_SCROLL] Canceling existing animation"),cancelAnimationFrame(P._horizontalScrollAnimationId),P._horizontalScrollAnimationId=null);const B=window.getComputedStyle(P).scrollSnapType!=="none",ge=B?"x mandatory":null;console.log("[HORIZONTAL_SCROLL] Scroll-snap state:",{hasScrollSnap:B,originalScrollSnapType:ge}),B&&(P.style.scrollSnapType="none");const M=performance.now();console.log("[HORIZONTAL_SCROLL] Starting animation at:",M);const F=te=>{const ee=te-M,ze=Math.min(ee/u,1),ve=1-ze,Pe=1-ve*ve*ve;if(P){const Le=xe+U*Pe;P.scrollLeft=Le}ze<1?P._horizontalScrollAnimationId=requestAnimationFrame(F):(console.log("[HORIZONTAL_SCROLL] Animation complete, final scrollLeft:",P.scrollLeft),P&&(P.scrollLeft=h,P._horizontalScrollAnimationId=null))};return P._horizontalScrollAnimationId=requestAnimationFrame(F),()=>{animationId&&cancelAnimationFrame(animationId),B&&P&&(P.style.scrollSnapType=ge||"")}},[]),A=f.useCallback(()=>{const h={};return t.forEach(u=>{var P;const D=u.baseName||((P=u.name)==null?void 0:P.replace(/\s+\(\d+\)$/,""))||u.name;h[D]||(h[D]={type:"adversary",baseName:D,instances:[]}),h[D].instances.push(u)}),c.forEach(u=>{h[`countdown-${u.id}`]={type:"countdown",baseName:u.name,instances:[u]}}),Object.values(h)},[t,c]),K=A(),R=f.useCallback(h=>{var M,F,te;const u=h.baseName||((M=h.name)==null?void 0:M.replace(/\s+\(\d+\)$/,""))||h.name,P=!K.find(ee=>ee.baseName===u&&ee.type==="adversary"),xe=performance.now(),U=((F=I.current)==null?void 0:F.scrollWidth)??0,q=((te=I.current)==null?void 0:te.scrollLeft)??0,B=I.current;let ge=!1;if(B&&P&&window.getComputedStyle(B).scrollSnapType!=="none"&&(B.style.scrollSnapType="none",ge=!0,console.log("[ADVERSARY_ADD] Disabled scroll-snap before adding adversary to prevent auto-scroll")),console.log("[ADVERSARY_ADD] handleAddAdversaryFromBrowser called:",{baseName:u,isNewAdversary:P,timestamp:xe,currentScroll:q,scrollWidth:U,scrollSnapDisabled:ge}),W(h),we("adversary"),P){const ee=`adversary-${u}`;i(ze=>new Set(ze).add(ee)),setTimeout(()=>{i(ze=>{const ve=new Set(ze);return ve.delete(ee),ve})},10)}setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!I.current)return;const ee=I.current;if(!(ee.scrollWidth<=ee.clientWidth))if(P){const ze=ee.scrollWidth;setTimeout(()=>{if(!I.current)return;const ve=I.current;if(ve.scrollWidth!==ze)requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!I.current)return;const Le=I.current,He=Le.scrollWidth-Le.clientWidth,Fe=Le.scrollLeft,$e=He-q,Qe=Le.scrollWidth>U;console.log("[HORIZONTAL_SCROLL] New adversary added, scrollWidth stabilized:",{maxScroll:He,scrollWidth:Le.scrollWidth,clientWidth:Le.clientWidth,scrollWidthBeforeAdd:U,scrollLeftBeforeAdd:q,currentScroll:Fe,scrollChanged:Fe!==q,scrollWidthIncreased:Qe,distance:$e}),Qe&&Math.abs($e)<1?o(He+10,500,"new-adversary"):Math.abs($e)>1&&o(He,500,"new-adversary")})});else{const Le=ve.scrollWidth-ve.clientWidth,He=ve.scrollLeft,Fe=Le-q,$e=ve.scrollWidth>U;console.log("[HORIZONTAL_SCROLL] New adversary added, scrollWidth stable:",{maxScroll:Le,scrollWidth:ve.scrollWidth,clientWidth:ve.clientWidth,scrollWidthBeforeAdd:U,scrollLeftBeforeAdd:q,currentScroll:He,scrollChanged:He!==q,scrollWidthIncreased:$e,distance:Fe}),$e&&Math.abs(Fe)<1?o(Le+10,500,"new-adversary"):Math.abs(Fe)>1&&o(Le,500,"new-adversary")}},10)}else{const ve=A().findIndex(Pe=>Pe.baseName===u&&Pe.type==="adversary");if(ve>=0){const Pe=I.current,Le=Pe.scrollLeft,He=Pe.clientWidth,Fe=m!==null?He-(Ae+C):He,$e=ve*(Ae+C),Qe=$e+Ae+C,xt=10;$e>=Le-xt&&Qe<=Le+Fe+xt||o($e,500)}}})})},50)},[W,K,Ae,C,o,A,m]),le=f.useCallback(()=>{const u="Standard",D=Je(1,u),P={name:"",baseName:"",tier:1,type:u,description:"",motives:"",difficulty:D.difficulty,thresholds:D.thresholds,hpMax:D.hpMax,stressMax:D.stressMax,atk:D.atk,weapon:"",range:D.range,damage:D.damage,experience:[],features:[],source:"Homebrew",hp:0,stress:0,isVisible:!0};W(P),setTimeout(()=>{const xe=A();for(const U of xe)if(U.type==="adversary"){const q=U.instances.find(B=>B.source==="Homebrew"&&(!B.baseName||B.baseName.trim()===""||B.baseName==="Unknown"));if(q&&!k){de(q.id),requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(I.current){I.current;const B=xe.findIndex(ge=>ge.instances.some(M=>M.id===q.id));if(B>=0){const ge=B*(Ae+C);o(ge,600,"new-custom-adversary")}}})});break}}},100)},[W,A,Ae,C,o,k]),Se=f.useCallback(h=>{de(h),We(!1)},[]),d=f.useCallback(()=>{de(null),We(!1)},[]),v=f.useCallback(async(h,u)=>{if(u)z(u,h),de(null);else if(k){const D=W({...h,id:void 0});return de(null),D}else{const D=W({...h,id:void 0});return We(!1),D}},[k,W,z]),se=f.useCallback(()=>{const h={};return t.forEach(u=>{var P;const D=u.baseName||((P=u.name)==null?void 0:P.replace(/\s+\(\d+\)$/,""))||u.name;h[D]||(h[D]={type:"adversary",item:u,quantity:0}),h[D].quantity+=1}),Object.values(h)},[t])(),Q=yr(Me),ke=se.filter(h=>h.item.type==="Solo"&&h.quantity>0).reduce((h,u)=>h+u.quantity,0),pe=se.some(h=>h.item.type&&["Bruiser","Horde","Leader","Solo"].includes(h.item.type)&&h.quantity>0);let ue=0;ke>=2&&(ue+=kt.twoOrMoreSolos),pe||(ue+=kt.noBruisersHordesLeadersSolos);const oe=Q+ue,j=se.reduce((h,u)=>{if(u.type==="adversary"){const D=vr[u.item.type]||2;return u.item.type==="Minion"?h+Math.ceil(u.quantity/Me)*D:h+D*u.quantity}return h},0),ce=f.useRef(null),Ie=f.useCallback(h=>{Ee(h.target.scrollLeft),ce.current&&clearTimeout(ce.current),ce.current=setTimeout(()=>{const u=h.target;u&&u.style.scrollSnapType==="none"&&(u.style.scrollSnapType="x mandatory")},150)},[]);return f.useCallback(()=>{Ne(!0)},[]),f.useCallback(()=>{setTimeout(()=>Ne(!1),100)},[]),K.length,e.jsxs("div",{className:"app",onClick:h=>{h.target,h.currentTarget},children:[e.jsx(Qt,{position:"top",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",width:"100%",justifyContent:"space-between",padding:"0 1rem"},children:[e.jsx(Ye,{type:"fear",value:(l==null?void 0:l.value)||0,maxValue:12,onChange:b,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0}),e.jsx("button",{onClick:()=>{m!==null?E():a(K.length)},title:m!==null?"Close Browser":"Add Adversaries",style:{width:"36px",height:"36px",padding:0,backgroundColor:m!==null?"var(--purple)":"transparent",border:"1px solid var(--border)",borderRadius:"50%",color:m!==null?"white":"var(--text-primary)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",flexShrink:0},onMouseEnter:h=>{m===null&&(h.target.style.borderColor="var(--purple)",h.target.style.backgroundColor="var(--bg-secondary)")},onMouseLeave:h=>{m===null&&(h.target.style.borderColor="var(--border)",h.target.style.backgroundColor="transparent")},children:e.jsx(Ke,{size:18})})]})}),e.jsxs("div",{className:"main-content",style:{position:"relative",width:"100%"},children:[m!==null&&e.jsx("div",{style:{position:"absolute",top:`${C}px`,right:`${C}px`,bottom:`${C}px`,width:`${Ae}px`,zIndex:100,overflow:"visible"},children:e.jsx(zt,{tabContent:e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:le,style:{padding:"0.375rem 0.75rem",backgroundColor:"var(--purple)",border:"none",color:"white",borderRadius:"4px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",transition:"opacity 0.2s ease"},onMouseEnter:h=>{h.target.style.opacity="0.9"},onMouseLeave:h=>{h.target.style.opacity="1"},children:[e.jsx(Ke,{size:16}),e.jsx("span",{children:"Add Custom"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:"500"},children:"Balance:"}),e.jsx("span",{style:{color:j>oe?"var(--danger)":j===oe?"var(--purple)":"var(--success)",fontWeight:600,fontSize:"0.875rem"},children:j>oe?`+${j-oe}`:oe-j===0?"0":`-${oe-j}`})]}),E&&e.jsx("button",{onClick:E,style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease",flexShrink:0},onMouseEnter:h=>h.target.style.color="var(--text-primary)",onMouseLeave:h=>h.target.style.color="var(--text-secondary)",title:"Close browser",children:e.jsx(Xe,{size:16})})]}),showTab:!0,tabBackgroundColor:"var(--bg-primary)",tabBorderColor:"var(--border)",tabJustifyContent:"space-between",containerBackgroundColor:"var(--bg-primary)",containerBorderColor:"var(--border)",containerBorderRadius:"8px",containerBoxShadow:"-4px 0 12px rgba(0, 0, 0, 0.3)",containerOverflow:"hidden",reserveTabSpace:!0,containerStyle:{height:"100%"},children:e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,display:"flex",flexDirection:"column",width:"100%",minWidth:0},children:e.jsx(Wt,{type:"adversary",onAddItem:R,showContainer:!1,activeTab:"adversaries",autoFocus:!0,hideImportExport:!0,onClose:E,searchPlaceholder:"Search adversaries"})})})}),e.jsxs("div",{ref:I,className:"dashboard-scroll-container",style:{display:"flex",flexDirection:"row",overflowX:"auto",overflowY:"hidden",padding:`0 ${C}px 0 0`,scrollSnapType:"x mandatory",height:"100%",width:"100%"},onScroll:Ie,children:[K.length===0?null:(()=>{const h=[];if(K.forEach((u,D)=>{var xe,U,q;if(g&&g.baseName===u.baseName&&u.type==="adversary"){h.push(e.jsx(lt,{style:{width:r?"0px":`${Ae+C}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:r?"0px":`${C}px`,paddingRight:"0",paddingTop:r?"0px":`${C}px`,paddingBottom:r?"0px":`${C}px`,scrollSnapAlign:"none",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"100%",opacity:0,transition:"width 0.3s ease, padding-left 0.3s ease, padding-top 0.3s ease, padding-bottom 0.3s ease"}},`spacer-${g.baseName}`));return}h.push(e.jsx(lt,{style:{width:`${Ae+C}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:`${C}px`,paddingRight:"0",paddingTop:`${m!==null&&u.type==="adversary"?C+52:C}px`,paddingBottom:`${C}px`,scrollSnapAlign:"start",overflow:m!==null&&u.type==="adversary"?"visible":"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"auto",opacity:Ce.has(`${u.type}-${u.baseName}`)?0:1,transition:(Ce.has(`${u.type}-${u.baseName}`),"opacity 0.2s ease")},children:e.jsx(nt,{type:u.type,item:{...u.instances[0],name:((xe=u.instances[0])==null?void 0:xe.name)||u.baseName,hp:0,stress:0,isDead:!1},mode:"expanded",instances:u.instances,showCustomCreator:u.type==="adversary"&&k&&u.instances.some(B=>B.id===k),onSaveCustomAdversary:u.type==="adversary"&&k&&u.instances.some(B=>B.id===k)?v:void 0,onCancelEdit:u.type==="adversary"&&k&&u.instances.some(B=>B.id===k)?d:void 0,isStockAdversary:u.type==="adversary"&&k&&u.instances.some(B=>B.id===k)?!((U=u.instances[0])!=null&&U.source)||((q=u.instances[0])==null?void 0:q.source)!=="Homebrew":!1,onApplyDamage:u.type==="adversary"?(B,ge,M,F)=>{const te=u.instances.find(ee=>ee.id===B);te&&z(B,{hp:Math.min(te.hpMax||1,(te.hp||0)+ge)})}:void 0,onApplyHealing:u.type==="adversary"?(B,ge,M)=>{const F=u.instances.find(te=>te.id===B);F&&z(B,{hp:Math.max(0,(F.hp||0)-ge)})}:void 0,onApplyStressChange:u.type==="adversary"?(B,ge)=>{var M,F;return z(B,{stress:Math.max(0,Math.min(((M=u.instances.find(te=>te.id===B))==null?void 0:M.stressMax)||6,(((F=u.instances.find(te=>te.id===B))==null?void 0:F.stress)||0)+ge))})}:void 0,onUpdate:u.type==="adversary"?z:u.type==="environment"?T:me,adversaries:t,showAddRemoveButtons:m!==null&&u.type==="adversary",onEdit:u.type==="adversary"?B=>Se(B):void 0,onAddInstance:u.type==="adversary"?B=>{W(B),setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(I.current){const ge=I.current,M=ge.scrollLeft,F=ge.clientWidth,te=m!==null?F-(Ae+C):F,ze=A().findIndex(ve=>ve.baseName===u.baseName&&ve.type==="adversary");if(ze>=0){const ve=ze*(Ae+C),Pe=ve+Ae+C,Le=10;ve>=M-Le&&Pe<=M+te+Le||o(ve,500)}}})})},50)}:void 0,onRemoveInstance:u.type==="adversary"?B=>{const ge=u.instances.length===1;K.length>0&&(K[K.length-1].baseName,u.baseName),`${u.type}${u.baseName}`;const M=u.instances.sort((F,te)=>{const ee=F.duplicateNumber||1;return(te.duplicateNumber||1)-ee});if(M.length>0){const F=M[0];if(ge){const te=K.findIndex(ee=>ee.baseName===u.baseName&&ee.type==="adversary");y({baseName:u.baseName,groupIndex:te}),n(!1),requestAnimationFrame(()=>{requestAnimationFrame(()=>{$(F.id),requestAnimationFrame(()=>{requestAnimationFrame(()=>{n(!0),setTimeout(()=>{y(null),n(!1)},300)})})})})}else $(F.id)}}:void 0})},`${u.type}-${u.baseName}`))}),g&&!h.some(u=>(u==null?void 0:u.key)===`spacer-${g.baseName}`)){const u=Math.min(g.groupIndex,h.length);h.splice(u,0,e.jsx(lt,{style:{width:r?"0px":`${Ae+C}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:r?"0px":`${C}px`,paddingRight:"0",paddingTop:r?"0px":`${C}px`,paddingBottom:r?"0px":`${C}px`,scrollSnapAlign:"none",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"100%",opacity:0,transition:"width 0.3s ease, padding-left 0.3s ease, padding-top 0.3s ease, padding-bottom 0.3s ease"}},`spacer-${g.baseName}`))}return h})(),m!==null&&e.jsx("div",{style:{width:`${Ae+C}px`,flexShrink:0,flexGrow:0,flex:"none",height:"100%"}})]})]}),e.jsx(gr,{isOpen:ne,onClose:Oe,onAddAdversary:h=>{W(h),we("adversary")},onAddAdversariesBulk:h=>{x(h),we("adversary")},onAddEnvironment:h=>{N(h),we("environment")},onDeleteAdversary:$,onDeleteEnvironment:w,onDeleteCountdown:H,adversaries:t,environments:s,countdowns:c,savedEncounters:S,onSaveEncounter:O,onLoadEncounter:be,onDeleteEncounter:G}),e.jsx(fr,{})]})},Cr=()=>e.jsx(br,{children:e.jsx(wr,{})});ut.createRoot(document.getElementById("root")).render(e.jsx(Ve.StrictMode,{children:e.jsx(Zt,{children:e.jsx(Cr,{})})}));
