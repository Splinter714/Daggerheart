import{r as b,a as ye,R as oe}from"./dndkit-57209f9c.js";import{F as De,f as Me,a as We,b as ze,c as le}from"./fa-b4bcccb0.js";import{D as re,A as ve,H as Q,C as Ae,M as Te,P as te,a as Le,T as Be,X as Re,E as He,F as Ne,S as de,b as ce}from"./lucide-af619837.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))h(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&h(l)}).observe(document,{childList:!0,subtree:!0});function u(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function h(n){if(n.ep)return;n.ep=!0;const o=u(n);fetch(n.href,o)}})();var be={exports:{}},Z={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Pe=b,Fe=Symbol.for("react.element"),Oe=Symbol.for("react.fragment"),$e=Object.prototype.hasOwnProperty,Ve=Pe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,_e={key:!0,ref:!0,__self:!0,__source:!0};function je(r,t,u){var h,n={},o=null,l=null;u!==void 0&&(o=""+u),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(l=t.ref);for(h in t)$e.call(t,h)&&!_e.hasOwnProperty(h)&&(n[h]=t[h]);if(r&&r.defaultProps)for(h in t=r.defaultProps,t)n[h]===void 0&&(n[h]=t[h]);return{$$typeof:Fe,type:r,key:o,ref:l,props:n,_owner:Ve.current}}Z.Fragment=Oe;Z.jsx=je;Z.jsxs=je;be.exports=Z;var e=be.exports,ne={},pe=ye;ne.createRoot=pe.createRoot,ne.hydrateRoot=pe.hydrateRoot;const ue={fear:{icon:Me,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"0.125rem",maxWidth:"none"},pipStyle:{fontSize:"var(--text-lg)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0,imageRendering:"crisp-edges"},filledColor:"var(--purple)",emptyColor:"var(--gray-dark)",tooltipTitle:"Click anywhere in header to adjust fear:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease fear by 1"},{text:"Right of boundary:",description:"Click to increase fear by 1"}]},hp:{icon:We,maxValue:20,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stress:{icon:ze,maxValue:12,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},countdown:{icon:le,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust countdown:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease countdown by 1"},{text:"Right of boundary:",description:"Click to increase countdown by 1"}]},hpDots:{maxValue:20,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--red)",borderColor:"var(--red)",boxShadow:"0 0 4px rgba(239, 68, 68, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stressDots:{maxValue:12,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--purple)",borderColor:"var(--purple)",boxShadow:"0 0 4px rgba(139, 92, 246, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},adversaryHP:{icon:re,maxValue:20,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust HP:",tooltipInstructions:[{text:"Filled pip:",description:"Click to heal (reduce damage)"},{text:"Empty pip:",description:"Click to take damage"}]},adversaryStress:{icon:ve,maxValue:12,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust stress:",tooltipInstructions:[{text:"Filled pip:",description:"Click to reduce stress"},{text:"Empty pip:",description:"Click to increase stress"}]},countdownDistributed:{icon:le,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Countdown progress:",tooltipInstructions:[{text:"Progress:",description:"Current countdown value"}]}},K=({type:r="fear",value:t=0,maxValue:u,onChange:h,size:n="lg",showTooltip:o=!0,containerStyle:l={},pipStyle:d={},countdownType:a=null,distributedGroups:x=null,onPipClick:c=null,enableBoundaryClick:s=!1,clickContainerWidth:f="auto",centerPips:m=!0})=>{const[v,S]=b.useState(!1),i=ue[r]||ue.fear,I=u||i.maxValue,w=Math.max(0,Math.min(I,t));let D=i.filledColor;r==="countdown"&&a&&(["progress","dynamic-progress","simple-hope"].includes(a)?D="var(--gold)":["consequence","dynamic-consequence","simple-fear"].includes(a)?D="var(--purple)":["long-term","standard"].includes(a)&&(D="var(--text-secondary)"));const z=(T,L)=>{if(c)c(T,L);else if(h){const $=T+1;h($)}},N=T=>{if(!s||!h||c)return;T.currentTarget.getBoundingClientRect();const L=T.currentTarget.querySelector(".pip-container");if(!L)return;const $=L.getBoundingClientRect(),P=T.clientX-$.left;if(P<0){w>0&&h(w-1);return}if(P>$.width){w<I&&h(w+1);return}const V=$.width,_=V*.05,W=V-2*_,C=P-_,k=w/I,p=W*k;C<p?w>0&&h(w-1):w<I&&h(w+1)},M=(()=>{if(!x||r!=="countdownDistributed")return[{start:0,end:I,groupIndex:0}];let T=0;return x.map((L,$)=>{const P={start:T,end:T+L,groupIndex:$};return T+=L,P})})(),O=()=>e.jsxs(e.Fragment,{children:[M.map(T=>e.jsx(oe.Fragment,{children:[...Array(T.end-T.start)].map((L,$)=>{const P=T.start+$,V=P<w;if(i.isDots)return e.jsx("div",{style:{...i.pipStyle,...V?i.filledStyle:i.emptyStyle,...d,cursor:h||c?"pointer":"default"},onClick:s?void 0:()=>z(P,V),title:`${P+1} of ${I}`},P);{const _=i.icon,W=_&&typeof _=="object"&&_.iconName,C=V?D:i.emptyColor;return e.jsx("span",{className:`fear-pip ${V?"filled":"empty"}`,style:{...i.pipStyle,color:C,cursor:h||c?"pointer":"default",...d},onClick:s?void 0:()=>z(P,V),title:`${P+1} of ${I}`,children:W?e.jsx(De,{icon:_,size:n}):e.jsx(_,{size:16})},P)}})},T.groupIndex)),o&&e.jsx("div",{style:{position:"relative",cursor:"help",pointerEvents:"none"},children:e.jsxs("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:v?"translateX(-50%) translateY(-5px)":"translateX(-50%)",background:"rgba(15, 23, 42, 0.95)",border:"1px solid var(--gray)",borderRadius:"var(--radius-md)",padding:"var(--space-md)",minWidth:"250px",zIndex:1e3,opacity:v?1:0,visibility:v?"visible":"hidden",transition:"all 0.2s ease",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.5)"},children:[e.jsx("div",{style:{fontWeight:600,color:"var(--gray-200)",marginBottom:"0.75rem",fontSize:"var(--text-sm)"},children:i.tooltipTitle}),i.tooltipInstructions.map((T,L)=>e.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.8rem",color:"var(--gray-300)",lineHeight:1.4},children:[e.jsx("strong",{style:{color:"var(--gray-200)"},children:T.text})," ",T.description]},L))]})})]});return e.jsx("div",{style:{width:f,height:"100%",cursor:h||c?"pointer":"default",touchAction:"manipulation",userSelect:"none",display:m?"flex":"block",alignItems:m?"center":"stretch",justifyContent:m?"center":"flex-start",...l},onClick:T=>{T.stopPropagation(),T.preventDefault(),s&&N(T)},onMouseEnter:()=>S(o),onMouseLeave:()=>S(!1),children:e.jsx("div",{className:"pip-container",style:{...i.containerStyle,width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},children:O()})})};function ae(r){const t=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return r?`${r}-${t}`:t}const Ye=(r,t)=>({createAdversary:l=>{const d=ae("adv"),a=r().adversaries||[],x=l.name||"Unknown",c=a.filter(m=>m.baseName===x);let s=1;if(c.length===0)s=1;else{const m=c.map(S=>S.duplicateNumber||1);let v=1;for(;m.includes(v);)v++;s=v}const f={...l,id:d,baseName:x,duplicateNumber:s,name:`${x} (${s})`,hp:0,stress:0,isVisible:!0};t(m=>({...m,adversaries:[...m.adversaries,f]}))},updateAdversary:(l,d)=>{t(a=>({...a,adversaries:a.adversaries.map(x=>{if(x.id===l){const c={...x,...d};if(d.baseName!==void 0){const s=d.baseName,f=c.duplicateNumber||1;c.name=f===1?s:`${s} (${f})`}return c}return x})}))},deleteAdversary:l=>{t(d=>({...d,adversaries:d.adversaries.filter(a=>a.id!==l)}))},reorderAdversaries:l=>{t(d=>{const[a,x]=l,c=[...d.adversaries],[s]=c.splice(a,1);return c.splice(x,0,s),{...d,adversaries:c}})}}),qe=r=>({createCountdown:a=>{const x={id:ae("countdown"),name:a.name||"Countdown",max:parseInt(a.max)||1,value:0,visible:!0,type:a.type||"standard",loop:a.loop||"none",source:a.source||"campaign"};r(c=>({...c,countdowns:[...c.countdowns,x]}))},updateCountdown:(a,x)=>{r(c=>({...c,countdowns:c.countdowns.map(s=>s.id===a?{...s,...x}:s)}))},deleteCountdown:a=>{r(x=>({...x,countdowns:x.countdowns.filter(c=>c.id!==a)}))},advanceCountdown:(a,x)=>{r(c=>({...c,countdowns:c.countdowns.map(s=>{if(s.id!==a)return s;let f=x;if(s.loop==="loop")f>s.max?f=(f-1)%s.max+1:f<0&&(f=s.max);else if(s.loop==="increasing"){if(f>s.max)return{...s,max:s.max+1,value:1};if(f<0)return{...s,max:Math.max(1,s.max-1),value:1};f=Math.max(0,f)}else if(s.loop==="decreasing"){if(f>s.max)return{...s,max:Math.max(1,s.max-1),value:1};if(f<0)return{...s,max:s.max+1,value:1};f=Math.min(s.max,f)}else f=Math.max(0,Math.min(f,s.max));return{...s,value:f}})}))},incrementCountdown:(a,x=1)=>{r(c=>({...c,countdowns:c.countdowns.map(s=>{if(s.id!==a)return s;let f=s.value+x;if(s.loop==="loop")f>s.max&&(f=(f-1)%s.max+1);else if(s.loop==="increasing"){if(f>s.max)return{...s,max:s.max+1,value:1}}else if(s.loop==="decreasing"){if(f>s.max)return{...s,max:Math.max(1,s.max-1),value:1}}else f=Math.min(f,s.max);return{...s,value:f}})}))},decrementCountdown:a=>{r(x=>({...x,countdowns:x.countdowns.map(c=>{if(c.id!==a)return c;let s=c.value-1;if(c.loop==="loop")s<0&&(s=c.max);else if(c.loop==="increasing"){if(s<0)return{...c,max:Math.max(1,c.max-1),value:c.max};s=Math.max(0,s)}else if(c.loop==="decreasing"){if(s<0)return{...c,max:c.max+1,value:1}}else s=Math.max(0,s);return{...c,value:s}})}))},reorderCountdowns:a=>{r(x=>{const[c,s]=a,f=[...x.countdowns],[m]=f.splice(c,1);return f.splice(s,0,m),{...x,countdowns:f}})}}),Xe=(r,t)=>({createEnvironment:l=>{const d=ae("env"),x=(r().environments||[]).filter(f=>f.name.replace(/\s+\(\d+\)$/,"")===l.name);let c=l.name||"Unknown";if(x.length===0)c=l.name;else if(x.length===1){const f=x[0],m=f.name.replace(/\s+\(\d+\)$/,""),v=r().environments.map(S=>S.id===f.id?{...S,name:`${m} (1)`}:S);t(S=>({...S,environments:v})),c=`${l.name} (2)`}else{const f=x.map(v=>{const S=v.name.match(/\((\d+)\)$/);return S?parseInt(S[1]):null}).filter(v=>v!==null);let m=1;for(;f.includes(m);)m++;c=`${l.name} (${m})`}const s={...l,id:d,name:c,isVisible:!0};t(f=>({...f,environments:[...f.environments,s]}))},updateEnvironment:(l,d)=>{t(a=>({...a,environments:a.environments.map(x=>x.id===l?{...x,...d}:x)}))},deleteEnvironment:l=>{t(d=>({...d,environments:d.environments.filter(a=>a.id!==l)}))},reorderEnvironments:l=>{t(d=>{const[a,x]=l,c=[...d.environments],[s]=c.splice(a,1);return c.splice(x,0,s),{...d,environments:c}})}});function Ge(r,t){const u=(r==null?void 0:r.type)||"standard";if(u==="standard")return 1;if(u==="progress"||u==="dynamic-progress")switch(t){case"success-hope":return 2;case"success-fear":return 1;case"critical-success":return 3;default:return 0}if(u==="consequence"||u==="dynamic-consequence")switch(t){case"success-fear":return 1;case"failure-hope":return 2;case"failure-fear":return 3;default:return 0}return u==="simple-fear"?t==="simple-fear"||t==="success-fear"||t==="failure-fear"?1:0:u==="simple-hope"&&(t==="simple-hope"||t==="success-hope"||t==="failure-hope"||t==="critical-success")?1:0}function Ke(r){return((r==null?void 0:r.type)||"standard")==="standard"?1:0}function Ue({adversaries:r,updateAdversary:t,deleteAdversary:u,selectedItem:h,setSelectedItem:n}){const o=b.useCallback((a,x,c,s)=>{var I,w;const f=r.find(D=>D.id===a);if(!f)return;const m=f.type==="Minion",v=(I=f.features)==null?void 0:I.find(D=>{var z;return(z=D.name)==null?void 0:z.startsWith("Minion (")}),S=v?parseInt(((w=v.name.match(/\((\d+)\)/))==null?void 0:w[1])||"1"):1;if(m){u(a);const D=Math.floor(x/S);if(D>0){const z=r.filter(N=>N.type==="Minion"&&N.id!==a&&N.name===f.name);for(let N=0;N<Math.min(D,z.length);N++)u(z[N].id)}return}const i=Math.min(c+x,s);h&&h.id===a&&n(D=>({...D,hp:i})),t(a,{hp:i})},[r,t,u,h,n]),l=b.useCallback((a,x,c)=>{const s=Math.max(0,c-x);h&&h.id===a&&n(f=>({...f,hp:s})),t(a,{hp:s})},[t,h,n]),d=b.useCallback((a,x,c,s)=>{const f=r.find(S=>S.id===a);if(!f)return;let m=c+x,v=f.hp||0;if(m>s){const S=m-s;m=s,v=Math.min(f.hpMax||0,v+S)}m=Math.max(0,m),h&&h.id===a&&n(S=>({...S,stress:m,hp:v})),t(a,{stress:m,hp:v})},[r,t,h,n]);return{handleAdversaryDamage:o,handleAdversaryHealing:l,handleAdversaryStressChange:d}}const B={transitions:{hoverIn:"all 0.1s ease",hoverOut:"all 0.3s ease",colorIn:"color 0.1s ease",colorOut:"color 0.3s ease",backgroundIn:"background-color 0.1s ease",backgroundOut:"background-color 0.3s ease"},card:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"12px",cursor:"pointer",transition:"all 0.1s ease",position:"relative"},cardHover:{backgroundColor:"var(--bg-card-hover)"},cardDead:{opacity:.6,backgroundColor:"var(--gray-800)",borderColor:"var(--border)"},cardAtMax:{backgroundColor:"var(--success)",borderColor:"var(--success)"},rowMain:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},rowTitle:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",margin:0},rowMeta:{display:"flex",gap:"8px",alignItems:"center"},cardActions:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px"},controlButtons:{display:"flex",gap:"8px",alignItems:"center"},pipSymbols:{display:"flex",gap:"4px",alignItems:"center",cursor:"pointer",padding:"2px"},pipSymbol:{fontSize:"16px",transition:"color 0.1s ease"},pipGroup:{display:"flex",gap:"4px",marginBottom:"4px"},badge:{padding:"2px 6px",borderRadius:"3px",fontSize:"10px",fontWeight:"600",textTransform:"uppercase"},typeBadge:{backgroundColor:"var(--purple)",color:"var(--text-primary)"},difficultyBadge:{backgroundColor:"var(--gray-500)",color:"var(--text-primary)",cursor:"pointer",transition:"background-color 0.1s ease"},tierBadge:{backgroundColor:"var(--info)",color:"var(--text-primary)"},inputBase:{padding:"8px",borderColor:"var(--gray-500)",backgroundColor:"var(--gray-900)",color:"var(--text-primary)",fontSize:"14px",transition:"all 0.2s ease"},inputBaseFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 2px rgba(79, 70, 229, 0.1)"},inputBaseDisabled:{opacity:.6,cursor:"not-allowed"},button:{backgroundColor:"var(--danger)",color:"var(--text-primary)",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease"},incrementButton:{backgroundColor:"var(--success)",color:"var(--text-primary)",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease"},decrementButton:{backgroundColor:"var(--warning)",color:"var(--text-primary)",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease"},damageInputPopup:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,borderRadius:"8px"},damageInputContent:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"8px",padding:"8px",display:"flex",flexDirection:"row",gap:"8px",minWidth:"200px",alignItems:"center"},damageInput:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"4px",padding:"4px 6px",color:"var(--text-primary)",fontSize:"12px",width:"80px",textAlign:"center"},damageIndicators:{display:"flex",gap:"8px",alignItems:"center",justifyContent:"center"},damageDrop:{fontSize:"16px",color:"var(--text-secondary)",cursor:"pointer",transition:"color 0.1s ease"},applyButton:{backgroundColor:"var(--gray-600)",color:"white",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"32px",minHeight:"32px"}},Je=(r,t,u,h)=>{const[n,o]=b.useState(!1),[l,d]=b.useState("");b.useEffect(()=>{if(n){const m=v=>{v.target.closest(".damage-input-popup")||(o(!1),d(""))};return document.addEventListener("click",m),()=>document.removeEventListener("click",m)}},[n]);const a=m=>{m.stopPropagation(),m.preventDefault();const v=r.hp||0,S=r.hpMax||1,i=m.currentTarget.getBoundingClientRect(),I=m.clientX-i.left,w=i.width/S;Math.floor(I/w)<v?u&&u(r.id,1,r.hp):t&&t(r.id,1,r.hp,r.hpMax)},x=m=>{m.stopPropagation(),m.preventDefault();const v=r.stress||0,S=r.stressMax||1,i=m.currentTarget.getBoundingClientRect(),I=m.clientX-i.left,w=i.width/S;Math.floor(I/w)<v?h&&h(r.id,-1,r.stress,r.stressMax):h&&h(r.id,1,r.stress,r.stressMax)},c=m=>{m.stopPropagation(),(r.thresholds&&r.thresholds.major&&r.thresholds.severe||r.type==="Minion")&&(o(!0),d(r.type==="Minion"?"1":""))},s=()=>{const m=parseInt(l);if(m>0){if(r.type==="Minion")t&&t(r.id,m,r.hp,r.hpMax);else{let v=0;m>=r.thresholds.severe?v=3:m>=r.thresholds.major?v=2:m>=1&&(v=1),t&&t(r.id,v,r.hp,r.hpMax)}o(!1),d("")}};return{showDamageInput:n,damageValue:l,setDamageValue:d,setShowDamageInput:o,handleHpClick:a,handleStressClick:x,handleDifficultyClick:c,applyDamage:s,handleKeyDown:m=>{m.key==="Enter"?s():m.key==="Escape"&&(o(!1),d(""))}}},Qe=(r,t,u)=>({renderDistributedPips:()=>{const n=r.max,o=[];for(let l=0;l<n;l+=5){const d=Math.min(5,n-l);o.push(d)}return o.map((l,d)=>e.jsx("div",{style:B.pipGroup,children:Array.from({length:l},(a,x)=>{const c=d*5+x;return e.jsx("span",{style:{...B.pipSymbol,color:c<(r.value||0)?"var(--red)":"var(--text-secondary)"},title:`${c+1} of ${r.max}`,children:c<(r.value||0)?"●":"○"},c)})},d))}}),U=({item:r,type:t,mode:u="compact",onClick:h,onDelete:n,onApplyDamage:o,onApplyHealing:l,onApplyStressChange:d,onUpdate:a,onIncrement:x,onDecrement:c,dragAttributes:s,dragListeners:f,adversaries:m=[],isSelected:v=!1,isEditMode:S=!1})=>{const i=Je(r,o,l,d),I=Qe(r);(t==="adversary"||t==="adversaries")&&i.handleDifficultyClick;const[w,D]=b.useState(!1),z=()=>{D(!0)},N=()=>{D(!1)},H=(p=!1)=>{let g={...B.card};if(v?g.transition="none":g.transition=w?B.transitions.hoverIn:B.transitions.hoverOut,p){const{marginTop:y,...j}=g;g=j}return(w&&u!=="expanded"||v)&&(g={...g,...B.cardHover}),t==="adversary"&&(r.hp||0)>=(r.hpMax||1)&&(g={...g,...B.cardDead}),t==="countdown"&&(r.value||0)>=r.max&&(g={...g,...B.cardAtMax}),g},M=()=>{let p="border rounded-lg";return(w&&u!=="expanded"||v)&&(p+=" border-hover"),p},O=()=>{var p,g;if(t==="adversary"||t==="adversaries"){const y=r.baseName||((p=r.name)==null?void 0:p.replace(/\s+\(\d+\)$/,""))||"",j=r.duplicateNumber||((g=r.name)!=null&&g.match(/\((\d+)\)$/)?parseInt(r.name.match(/\((\d+)\)$/)[1]):1),E=[...m];return m.some(q=>q.id===r.id)||E.push(r),E.filter(q=>q.baseName===y).length>1?`${y} (${j})`:y}return r.name},T=()=>{const p=[];return r.type&&p.push(e.jsx("span",{style:{...B.badge,...B.typeBadge},children:r.type},"type")),t==="environment"&&r.tier&&p.push(e.jsxs("span",{style:{...B.badge,...B.tierBadge},children:["Tier ",r.tier]},"tier")),p},L=()=>e.jsxs("div",{style:B.cardActions,children:[e.jsxs("div",{style:B.controlButtons,children:[e.jsx("div",{style:{display:"flex",alignItems:"center"},children:e.jsx("div",{style:{display:"flex",gap:"0.25rem",alignItems:"center",cursor:"pointer",padding:"0.125rem",borderRadius:"0.5rem",transition:"all 0.2s ease"},onClick:t==="adversary"||t==="adversaries"?i.handleHpClick:void 0,onMouseEnter:p=>p.target.style.background="var(--gray-800)",onMouseLeave:p=>p.target.style.background="transparent",children:Array.from({length:r.hpMax||1},(p,g)=>e.jsx("span",{style:{fontSize:"1rem",transition:"color 0.1s ease",cursor:"pointer",color:g<(r.hp||0)?"var(--red)":"var(--text-secondary)"},title:g<(r.hp||0)?"Click to heal (reduce damage)":"Click to take damage",children:e.jsx(re,{size:16})},g))})}),r.stressMax>0&&e.jsx("div",{style:{display:"flex",alignItems:"center"},children:e.jsx("div",{style:{display:"flex",gap:"0.25rem",alignItems:"center",cursor:"pointer",padding:"0.125rem",borderRadius:"0.5rem",transition:"all 0.2s ease"},onClick:t==="adversary"||t==="adversaries"?i.handleStressClick:void 0,onMouseEnter:p=>p.target.style.background="var(--gray-800)",onMouseLeave:p=>p.target.style.background="transparent",children:Array.from({length:r.stressMax},(p,g)=>e.jsx("span",{style:{fontSize:"1rem",transition:"color 0.1s ease",cursor:"pointer",color:g<(r.stress||0)?"var(--gold)":"var(--text-secondary)"},title:g<(r.stress||0)?"Click to reduce stress":"Click to increase stress",children:e.jsx(ve,{size:16})},g))})}),r.difficulty&&e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:e.jsx("div",{onClick:t==="adversary"||t==="adversaries"?i.handleDifficultyClick:void 0,style:{cursor:r.thresholds&&r.thresholds.major&&r.thresholds.severe||r.type==="Minion"?"pointer":"default"},title:r.thresholds&&r.thresholds.major&&r.thresholds.severe?`Click to enter damage (thresholds: ${r.thresholds.major}/${r.thresholds.severe})`:r.type==="Minion"?"Click to enter damage (minion mechanics)":"",children:e.jsx("div",{className:"border rounded-sm",style:{display:"flex",alignItems:"center",gap:"0.25rem",background:"var(--gray-900)",borderColor:"var(--border)",padding:"0.25rem 0.5rem",transition:"all 0.2s ease"},onMouseEnter:p=>p.target.style.background="var(--gray-800)",onMouseLeave:p=>p.target.style.background="var(--gray-900)",children:e.jsx("span",{style:{fontSize:"0.875rem",fontWeight:600,color:"var(--text-primary)"},children:r.difficulty})})})})]}),e.jsx("div",{style:{display:"flex",alignItems:"center"},children:!1})]}),$=()=>null,P=()=>e.jsxs(e.Fragment,{children:[e.jsx("button",{style:B.decrementButton,onClick:p=>{p.stopPropagation(),p.preventDefault(),c&&c(r.id)},title:"Decrease progress",children:e.jsx(Te,{size:16})}),e.jsx("button",{style:B.incrementButton,onClick:p=>{p.stopPropagation(),p.preventDefault(),x&&x(r.id)},title:r.value>=r.max?r.loop&&r.loop!=="none"?"Loop countdown":"Countdown at max":"Increase progress",children:r.value>=r.max?r.loop&&r.loop!=="none"?"⟳":e.jsx(te,{size:16}):e.jsx(te,{size:16})})]}),V=()=>{switch(t){case"adversary":return L();case"environment":return $();case"countdown":return P();default:return null}},_=()=>t==="countdown"?e.jsx("div",{style:B.pipSymbols,children:t==="countdown"?I.renderDistributedPips():null}):null,W=()=>t!=="adversary"||!i.showDamageInput||!(r.thresholds&&r.thresholds.major&&r.thresholds.severe||r.type==="Minion")?null:e.jsx("div",{className:"damage-input-popup",style:B.damageInputPopup,onClick:p=>{p.stopPropagation(),p.target===p.currentTarget&&(t==="adversary"||t==="adversaries")&&(i.setShowDamageInput(!1),i.setDamageValue(""))},children:e.jsxs("div",{className:"border rounded-lg",style:{...B.damageInputContent,borderColor:"var(--border)"},onClick:p=>p.stopPropagation(),children:[e.jsx("input",{type:"number",inputMode:"numeric",enterKeyHint:"done",placeholder:"dmg",min:(r.type==="Minion","0"),value:t==="adversary"||t==="adversaries"?i.damageValue:"",onChange:p=>{(t==="adversary"||t==="adversaries")&&i.setDamageValue(p.target.value)},onKeyDown:t==="adversary"||t==="adversaries"?i.handleKeyDown:void 0,className:"border rounded-sm",style:{...B.damageInput,borderColor:"var(--border)"},autoFocus:!0}),e.jsxs("div",{style:B.damageIndicators,children:[r.type==="Minion"?(()=>{var E,A;const p=parseInt(t==="adversary"||t==="adversaries"?i.damageValue:"0")||0,g=(E=r.features)==null?void 0:E.find(X=>{var q;return(q=X.name)==null?void 0:q.startsWith("Minion (")}),y=g?parseInt(((A=g.name.match(/\((\d+)\)/))==null?void 0:A[1])||"1"):1,j=Math.floor(p/y);return p>=y&&j>0?e.jsxs("span",{style:{...B.damageDrop,color:"var(--red)"},title:`${p} damage can defeat ${j+1} minion${j+1!==1?"s":""} (1 + ${j} additional)`,children:["+",j," additional minion(s)"]}):e.jsx("span",{style:B.damageDrop,title:`${p} damage defeats this minion only`,children:"+0 additional minion(s)"})})():[1,2,3].map(p=>{const g=parseInt(t==="adversary"||t==="adversaries"?i.damageValue:"0")||0;let y=!1;return p===1&&g>=1&&(y=!0),p===2&&g>=r.thresholds.major&&(y=!0),p===3&&g>=r.thresholds.severe&&(y=!0),e.jsx("span",{style:{...B.damageDrop,color:y?"var(--red)":"var(--text-secondary)"},onClick:j=>{j.stopPropagation(),(t==="adversary"||t==="adversaries")&&(p===1?i.setDamageValue("1"):p===2?i.setDamageValue(r.thresholds.major.toString()):p===3&&i.setDamageValue(r.thresholds.severe.toString()))},title:`Click to set damage to ${p===1?"1":p===2?r.thresholds.major:r.thresholds.severe}`,children:e.jsx(re,{size:16})},p)}),e.jsx("button",{style:{...B.applyButton,backgroundColor:(!i.damageValue||parseInt(i.damageValue)<1,"var(--gray-600)")},onClick:p=>{p.stopPropagation(),(t==="adversary"||t==="adversaries")&&i.applyDamage()},title:"Apply damage",disabled:!i.damageValue||parseInt(i.damageValue)<1,children:e.jsx(Ae,{size:16})})]})]})}),C=()=>{const g=(r.hp||0)>=(r.hpMax||1),y=u==="edit";return e.jsxs("div",{className:M(),style:{...H(!0),padding:0,minHeight:"400px",opacity:g?.7:1,backgroundColor:g?"var(--gray-900)":H(!0).backgroundColor,borderColor:g?"color-mix(in srgb, var(--gray-600) 40%, transparent)":v?"var(--purple)":w&&u!=="expanded"?"var(--border-hover)":"var(--border)",borderWidth:"2px",display:"flex",flexDirection:"column",position:"relative"},...s,...f,onClick:h,...u!=="expanded"&&{onMouseEnter:z,onMouseLeave:N},children:[g&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                45deg,
                transparent,
                transparent 8px,
                var(--gray-600) 1px,
                var(--gray-600) 9px
              )`,pointerEvents:"none",zIndex:9999}}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"var(--text-secondary)",fontSize:"1rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em",zIndex:1e4,pointerEvents:"none",textShadow:"1px 1px 2px rgba(0, 0, 0, 0.5)",backgroundColor:"var(--gray-900)",padding:"0.25rem 0.5rem",borderRadius:"0.5rem",border:"0.5px solid var(--gray-600)"},children:"DEFEATED"})]}),e.jsx("div",{className:"border-b",style:{padding:"12px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative",zIndex:g?1:"auto",borderBottomColor:v?"var(--purple)":"var(--border)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",position:"relative",zIndex:g?1:"auto"},children:[e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.25rem",flex:"1 1 0%",minWidth:0},children:e.jsx("h4",{style:{...B.rowTitle,color:g?"color-mix(in srgb, var(--gray-400) 80%, transparent)":B.rowTitle.color},children:O()})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flex:"0 0 auto",minWidth:"fit-content"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.125rem",alignItems:"flex-end"},children:[e.jsx(K,{type:"adversaryHP",value:r.hp||0,maxValue:r.hpMax||1,onChange:j=>{const E=r.hp||0;j>E?o&&o(r.id,j-E,r.hp,r.hpMax):j<E&&l&&l(r.id,E-j,r.hp)},containerStyle:{cursor:"pointer",padding:"0.0625rem",borderRadius:"0.125rem",transition:"all 0.2s ease"},pipStyle:{fontSize:"0.75rem"},showTooltip:!1,enableBoundaryClick:!0}),r.stressMax>0&&e.jsx(K,{type:"adversaryStress",value:r.stress||0,maxValue:r.stressMax,onChange:j=>{const E=r.stress||0,A=j-E;d&&d(r.id,A,r.stress)},containerStyle:{cursor:"pointer",padding:"0.0625rem",borderRadius:"0.125rem",transition:"all 0.2s ease"},pipStyle:{fontSize:"0.75rem"},showTooltip:!1,enableBoundaryClick:!0})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem"},children:[r.type&&e.jsx("span",{style:{fontSize:"0.625rem",fontWeight:500,color:g?"color-mix(in srgb, var(--gray-400) 80%, transparent)":"var(--text-secondary)",letterSpacing:"0.5px",textAlign:"center",lineHeight:1},children:r.type}),r.difficulty&&e.jsxs("div",{onClick:i.handleDifficultyClick,style:{cursor:r.thresholds&&r.thresholds.major&&r.thresholds.severe||r.type==="Minion"?"pointer":"default",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},title:r.thresholds&&r.thresholds.major&&r.thresholds.severe?`Click to enter damage (thresholds: ${r.thresholds.major}/${r.thresholds.severe})`:r.type==="Minion"?"Click to enter damage (minion mechanics)":"",children:[e.jsx(Q,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(30deg)"}}),e.jsx("span",{style:{position:"absolute",fontSize:"0.75rem",fontWeight:600,color:"white",pointerEvents:"none"},children:r.difficulty})]})]}),!1]})]})}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"12px",borderRadius:"0 0 8px 8px",position:"relative",zIndex:g?1:"auto"},children:[(r.tier||r.type)&&e.jsx("div",{style:{marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--border)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[r.tier&&e.jsxs("span",{style:{fontSize:"0.875rem",fontWeight:500,color:g?"color-mix(in srgb, var(--gray-400) 80%, transparent)":"var(--text-secondary)",letterSpacing:"0.5px",padding:"0.25rem 0.5rem",backgroundColor:"var(--gray-800)",borderRadius:"0.25rem",border:"1px solid var(--border)"},children:["Tier ",r.tier]}),r.type&&e.jsx("span",{style:{fontSize:"0.875rem",fontWeight:500,color:g?"color-mix(in srgb, var(--gray-400) 80%, transparent)":"var(--text-secondary)",letterSpacing:"0.5px",padding:"0.25rem 0.5rem",backgroundColor:"var(--gray-800)",borderRadius:"0.25rem",border:"1px solid var(--border)"},children:r.type})]})}),r.description&&e.jsxs("div",{style:{marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--border)"},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:"0 0 0.5rem 0"},children:"Description"}),y?e.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-secondary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"vertical",fontFamily:"inherit"},value:r.description,onChange:j=>{a&&a(r.id,{description:j.target.value})},placeholder:"Enter adversary description..."}):e.jsx("p",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",margin:0,whiteSpace:"pre-wrap"},children:r.description})]}),r.motives&&e.jsxs("div",{style:{marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--border)"},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:"0 0 0.5rem 0"},children:"Motives"}),y?e.jsx("textarea",{style:{width:"100%",minHeight:"80px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-secondary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"vertical",fontFamily:"inherit"},value:r.motives,onChange:j=>{a&&a(r.id,{motives:j.target.value})},placeholder:"Enter adversary motives..."}):e.jsx("p",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",margin:0,whiteSpace:"pre-wrap"},children:r.motives})]}),e.jsx("div",{style:{marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--border)"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",fontSize:"0.875rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[e.jsxs("span",{children:[e.jsx("strong",{children:"Difficulty:"})," ",r.difficulty]}),r.thresholds&&e.jsxs("span",{children:[e.jsx("strong",{children:"Thresholds:"})," ",r.thresholds.major,"/",r.thresholds.severe]}),e.jsxs("span",{children:[e.jsx("strong",{children:"HP:"})," ",r.hpMax]}),r.stressMax>0&&e.jsxs("span",{children:[e.jsx("strong",{children:"Stress:"})," ",r.stressMax]})]}),(r.atk!==void 0||r.weapon||r.damage)&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[r.atk!==void 0&&e.jsxs("span",{children:[e.jsx("strong",{children:"ATK:"})," ",r.atk>=0?"+":"",r.atk]}),r.weapon&&e.jsxs("span",{children:[e.jsxs("strong",{children:[r.weapon,":"]})," ",r.range||"Melee"]}),r.damage&&e.jsxs("span",{children:[e.jsx("strong",{children:"Damage:"})," ",r.damage]})]}),r.experience&&r.experience.length>0&&e.jsxs("div",{children:[e.jsx("strong",{children:"Experience:"})," ",r.experience.map(j=>typeof j=="string"?j:`${j.name} ${j.modifier>=0?"+":""}${j.modifier}`).join(", ")]})]})}),r.features&&r.features.length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[r.features.filter(j=>j.type==="Passive").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Passives"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:r.features.filter(j=>j.type==="Passive").map((j,E)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:j.name}),j.description&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:" - "}),e.jsx("span",{children:j.description})]})]},E))})]}),r.features.filter(j=>j.type==="Action").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Actions"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:r.features.filter(j=>j.type==="Action").map((j,E)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:j.name}),j.description&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:" - "}),e.jsx("span",{children:j.description})]})]},E))})]}),r.features.filter(j=>j.type==="Reaction").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Reactions"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:r.features.filter(j=>j.type==="Reaction").map((j,E)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:j.name}),j.description&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:" - "}),e.jsx("span",{children:j.description})]})]},E))})]})]})]}),W()]})},k=()=>{const g=u==="edit";return e.jsxs("div",{className:M(),style:{...H(!0),padding:0,minHeight:"400px",display:"flex",flexDirection:"column",position:"relative"},...s,...f,onClick:h,...u!=="expanded"&&{onMouseEnter:z,onMouseLeave:N},children:[e.jsx("div",{className:"border-b",style:{padding:"12px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.25rem"},children:[e.jsx("h2",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:0},children:r.name}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[r.tier&&e.jsxs("span",{style:{fontSize:"0.75rem",fontWeight:500,color:"var(--text-secondary)",letterSpacing:"0.5px"},children:["Tier ",r.tier]}),r.type&&e.jsx("span",{style:{fontSize:"0.75rem",fontWeight:500,color:"var(--text-secondary)",letterSpacing:"0.5px"},children:r.type})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[r.difficulty&&e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[e.jsx(Q,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)"}}),e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",fontWeight:700,color:"white",pointerEvents:"none"},children:r.difficulty})]}),!1]})]})}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"12px",borderRadius:"0 0 8px 8px"},children:[r.description&&e.jsxs("div",{style:{marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--border)"},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:"0 0 0.5rem 0"},children:"Description"}),g?e.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-secondary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"vertical",fontFamily:"inherit"},value:r.description,onChange:y=>{a&&a(r.id,{description:y.target.value})},placeholder:"Enter environment description..."}):e.jsx("p",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",margin:0,whiteSpace:"pre-wrap"},children:r.description})]}),r.impulses&&e.jsxs("div",{style:{marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--border)"},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:"0 0 0.5rem 0"},children:"Impulses"}),e.jsx("p",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",margin:0,whiteSpace:"pre-wrap"},children:r.impulses})]}),e.jsxs("div",{style:{marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--border)"},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:"0 0 0.5rem 0"},children:"Core Stats"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",fontSize:"0.875rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[e.jsxs("span",{children:[e.jsx("strong",{children:"Difficulty:"})," ",r.difficulty||"~"]}),e.jsxs("span",{children:[e.jsx("strong",{children:"Type:"})," ",r.type]}),e.jsxs("span",{children:[e.jsx("strong",{children:"Tier:"})," ",r.tier]})]}),r.potentialAdversaries&&r.potentialAdversaries.length>0&&e.jsxs("div",{children:[e.jsx("strong",{children:"Potential Adversaries:"}),e.jsx("div",{style:{marginTop:"0.25rem",display:"flex",flexDirection:"column",gap:"0.125rem"},children:r.potentialAdversaries.map((y,j)=>e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",marginLeft:"0.5rem"},children:["• ",y]},j))})]})]})]}),r.features&&r.features.length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[r.features.filter(y=>y.type==="Passive").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Passives"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:r.features.filter(y=>y.type==="Passive").map((y,j)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("div",{style:{fontWeight:600,color:"white",marginBottom:"0.25rem"},children:y.name}),e.jsx("div",{style:{marginBottom:"0.25rem"},children:y.description}),y.details&&y.details.length>0&&e.jsxs("div",{style:{marginLeft:"0.5rem"},children:[e.jsx("strong",{children:"Details:"}),e.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:y.details.map((E,A)=>e.jsx("li",{children:E},A))})]}),y.prompts&&y.prompts.length>0&&e.jsxs("div",{style:{marginLeft:"0.5rem"},children:[e.jsx("strong",{children:"Prompts:"}),e.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:y.prompts.map((E,A)=>e.jsxs("li",{style:{fontStyle:"italic"},children:['"',E,'"']},A))})]})]},j))})]}),r.features.filter(y=>y.type==="Action").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Actions"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:r.features.filter(y=>y.type==="Action").map((y,j)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("div",{style:{fontWeight:600,color:"white",marginBottom:"0.25rem"},children:y.name}),e.jsx("div",{style:{marginBottom:"0.25rem"},children:y.description}),y.details&&y.details.length>0&&e.jsxs("div",{style:{marginLeft:"0.5rem"},children:[e.jsx("strong",{children:"Details:"}),e.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:y.details.map((E,A)=>e.jsx("li",{children:E},A))})]}),y.prompts&&y.prompts.length>0&&e.jsxs("div",{style:{marginLeft:"0.5rem"},children:[e.jsx("strong",{children:"Prompts:"}),e.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:y.prompts.map((E,A)=>e.jsxs("li",{style:{fontStyle:"italic"},children:['"',E,'"']},A))})]})]},j))})]}),r.features.filter(y=>y.type==="Reaction").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Reactions"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:r.features.filter(y=>y.type==="Reaction").map((y,j)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("div",{style:{fontWeight:600,color:"white",marginBottom:"0.25rem"},children:y.name}),e.jsx("div",{style:{marginBottom:"0.25rem"},children:y.description}),y.details&&y.details.length>0&&e.jsxs("div",{style:{marginLeft:"0.5rem"},children:[e.jsx("strong",{children:"Details:"}),e.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:y.details.map((E,A)=>e.jsx("li",{children:E},A))})]}),y.prompts&&y.prompts.length>0&&e.jsxs("div",{style:{marginLeft:"0.5rem"},children:[e.jsx("strong",{children:"Prompts:"}),e.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:y.prompts.map((E,A)=>e.jsxs("li",{style:{fontStyle:"italic"},children:['"',E,'"']},A))})]})]},j))})]})]})]})]})};if((u==="expanded"||u==="edit")&&(t==="adversary"||t==="adversaries"))return C();if((u==="expanded"||u==="edit")&&(t==="environment"||t==="environments"))return k();if(u!=="compact"&&!(t==="adversary"||t==="adversaries"||t==="environment"||t==="environments"))return e.jsxs("div",{className:M(),style:H(!0),children:[e.jsxs("div",{style:B.rowMain,children:[e.jsx("h4",{style:B.rowTitle,children:O()}),e.jsx("div",{style:B.rowMeta,children:T()})]}),e.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"12px",margin:0},children:["Expanded view coming soon for ",t]})]});if(t==="adversary"||t==="adversaries"){const g=(r.hp||0)>=(r.hpMax||1);return e.jsxs("div",{className:M(),style:{...H(),opacity:g?.7:1,backgroundColor:g?"var(--gray-900)":H().backgroundColor,borderColor:g?"color-mix(in srgb, var(--gray-600) 40%, transparent)":v?"var(--purple)":w&&u!=="expanded"?"var(--border-hover)":"var(--border)",paddingLeft:"0.75rem",position:"relative"},onClick:h,...u!=="expanded"&&{onMouseEnter:z,onMouseLeave:N},...s,...f,children:[g&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                45deg,
                transparent,
                transparent 8px,
                var(--gray-600) 1px,
                var(--gray-600) 9px
              )`,pointerEvents:"none",zIndex:9999}}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"var(--text-secondary)",fontSize:"1rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em",zIndex:1e4,pointerEvents:"none",textShadow:"1px 1px 2px rgba(0, 0, 0, 0.5)",backgroundColor:"var(--gray-900)",padding:"0.25rem 0.5rem",borderRadius:"0.5rem",border:"0.5px solid var(--gray-600)"},children:"DEFEATED"})]}),!1,e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",position:"relative",zIndex:g?1:"auto"},children:[e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.25rem",flex:"1 1 0%",minWidth:0},children:e.jsx("h4",{style:{...B.rowTitle,color:g?"color-mix(in srgb, var(--gray-400) 80%, transparent)":B.rowTitle.color},children:O()})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flex:"0 0 auto",minWidth:"fit-content"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.125rem",alignItems:"flex-end"},children:[e.jsx(K,{type:"adversaryHP",value:r.hp||0,maxValue:r.hpMax||1,onChange:y=>{const j=r.hp||0;y>j?o&&o(r.id,y-j,r.hp,r.hpMax):y<j&&l&&l(r.id,j-y,r.hp)},containerStyle:{cursor:"pointer",padding:"0.0625rem",borderRadius:"0.125rem",transition:"all 0.2s ease"},pipStyle:{fontSize:"0.75rem"},showTooltip:!1,enableBoundaryClick:!0}),r.stressMax>0&&e.jsx(K,{type:"adversaryStress",value:r.stress||0,maxValue:r.stressMax,onChange:y=>{const j=r.stress||0,E=y-j;d&&d(r.id,E,r.stress)},containerStyle:{cursor:"pointer",padding:"0.0625rem",borderRadius:"0.125rem",transition:"all 0.2s ease"},pipStyle:{fontSize:"0.75rem"},showTooltip:!1,enableBoundaryClick:!0})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem"},children:[r.type&&e.jsx("span",{style:{fontSize:"0.625rem",fontWeight:500,color:g?"color-mix(in srgb, var(--gray-400) 80%, transparent)":"var(--text-secondary)",letterSpacing:"0.5px",textAlign:"center",lineHeight:1},children:r.type}),r.difficulty&&e.jsxs("div",{onClick:i.handleDifficultyClick,style:{cursor:r.thresholds&&r.thresholds.major&&r.thresholds.severe||r.type==="Minion"?"pointer":"default",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},title:r.thresholds&&r.thresholds.major&&r.thresholds.severe?`Click to enter damage (thresholds: ${r.thresholds.major}/${r.thresholds.severe})`:r.type==="Minion"?"Click to enter damage (minion mechanics)":"",children:[e.jsx(Q,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(30deg)"}}),e.jsx("span",{style:{position:"absolute",fontSize:"0.75rem",fontWeight:600,color:"white",pointerEvents:"none"},children:r.difficulty})]})]}),console.log("Delete button check:",{onDelete:!!n,isEditMode:S,shouldShow:n&&S}),n&&S&&e.jsx("button",{className:"border rounded-sm",style:{background:"var(--red)",borderColor:"var(--red)",padding:"0.25rem",minWidth:"1.5rem",height:"1.5rem",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.1s ease",color:"white",fontSize:"1rem"},onClick:y=>{y.stopPropagation(),y.preventDefault(),n&&n(r.id)},onMouseEnter:y=>y.target.style.background="var(--red-dark)",onMouseLeave:y=>y.target.style.background="var(--red)",title:"Delete item",children:"×"})]})]}),W()]})}return t==="environment"||t==="environments"?e.jsxs("div",{className:M(),style:{...H(),paddingLeft:"0.75rem",position:"relative"},onClick:h,...u!=="expanded"&&{onMouseEnter:z,onMouseLeave:N},...s,...f,children:[!1,e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"0.5rem",position:"relative"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.25rem"},children:[e.jsx("h4",{style:B.rowTitle,children:O()}),r.type&&e.jsx("span",{style:{fontSize:"0.75rem",fontWeight:500,color:"var(--text-secondary)",letterSpacing:"0.5px"},children:r.type})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[r.difficulty&&e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[e.jsx(Q,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)"}}),e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",fontWeight:700,color:"white",pointerEvents:"none"},children:r.difficulty})]}),r.type&&e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.125rem"},children:e.jsx("span",{style:{fontSize:"0.625rem",fontWeight:500,color:isDead?"color-mix(in srgb, var(--gray-400) 80%, transparent)":"var(--text-secondary)",letterSpacing:"0.5px",textAlign:"center",lineHeight:1},children:r.type})}),console.log("Delete button check:",{onDelete:!!n,isEditMode:S,shouldShow:n&&S}),n&&S&&e.jsx("button",{className:"border rounded-sm",style:{background:"var(--red)",borderColor:"var(--red)",padding:"0.25rem",minWidth:"1.5rem",height:"1.5rem",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.1s ease",color:"white",fontSize:"1rem"},onClick:g=>{g.stopPropagation(),g.preventDefault(),n&&n(r.id)},onMouseEnter:g=>g.target.style.background="var(--red-dark)",onMouseLeave:g=>g.target.style.background="var(--red)",title:"Delete environment",children:"×"})]})]})]}):e.jsxs("div",{className:M(),style:H(),onClick:h,onMouseEnter:()=>D(!0),onMouseLeave:()=>D(!1),...s,...f,children:[e.jsxs("div",{style:B.rowMain,children:[e.jsx("h4",{style:B.rowTitle,children:O()}),e.jsx("div",{style:B.rowMeta,children:T()})]}),_(),e.jsxs("div",{style:B.cardActions,children:[e.jsx("div",{style:B.controlButtons,children:V()}),e.jsx("div",{style:{display:"flex",alignItems:"center"},children:!1})]}),W()]})},we=b.createContext();function se(r){if(typeof localStorage>"u")return null;try{const t=localStorage.getItem(r);return t==null?null:JSON.parse(t)}catch{return null}}function Ce(r,t){if(!(typeof localStorage>"u"))try{localStorage.setItem(r,JSON.stringify(t))}catch{}}const Se=({children:r})=>{const[t,u]=b.useState({fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[]});b.useEffect(()=>{var $,P,V;const L=se("daggerheart-game-state");if(L)try{((($=L.adversaries)==null?void 0:$.length)>0||((P=L.environments)==null?void 0:P.length)>0||((V=L.countdowns)==null?void 0:V.length)>0)&&u(L)}catch(_){console.error("Failed to load saved state:",_)}},[]),b.useEffect(()=>{Ce("daggerheart-game-state",t)},[t]);const h=L=>{u($=>({...$,fear:{...$.fear,value:L}}))},n=()=>{u(L=>({...L,fear:{...L.fear,visible:!L.fear.visible}}))},o=b.useRef(t);b.useEffect(()=>{o.current=t},[t]);const l=()=>o.current,d=qe(u),a=Ye(l,u),x=Xe(l,u),{createCountdown:c,updateCountdown:s,deleteCountdown:f,advanceCountdown:m,incrementCountdown:v,decrementCountdown:S,reorderCountdowns:i}=d,{createAdversary:I,updateAdversary:w,deleteAdversary:D,reorderAdversaries:z}=a,{createEnvironment:N,updateEnvironment:H,deleteEnvironment:M,reorderEnvironments:O}=x,T={gameState:t,updateFear:h,toggleFearVisibility:n,createCountdown:c,updateCountdown:s,deleteCountdown:f,advanceCountdown:m,incrementCountdown:v,decrementCountdown:S,reorderCountdowns:i,createAdversary:I,updateAdversary:w,deleteAdversary:D,reorderAdversaries:z,createEnvironment:N,updateEnvironment:H,deleteEnvironment:M,reorderEnvironments:O};return e.jsx(we.Provider,{value:T,children:r})},ke=()=>{const r=b.useContext(we);if(!r)return console.warn("useGameState: Context not available yet, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],updateFear:()=>{},toggleFearVisibility:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{gameState:t,...u}=r;if(!t)return console.warn("useGameState: gameState not available, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],updateFear:()=>{},toggleFearVisibility:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{fear:h,countdowns:n,adversaries:o,environments:l}=t;return{gameState:t,fear:h,countdowns:n,adversaries:o,environments:l,...u,hasCountdowns:n.length>0,hasAdversaries:o.length>0,hasEnvironments:l.length>0,getCountdownById:d=>n.find(a=>a.id===d),getAdversaryById:d=>o.find(a=>a.id===d),getEnvironmentById:d=>l.find(a=>a.id===d)}},Ze=(r,t)=>{const[u,h]=b.useState(()=>{const n=se(r);return n??t});return b.useEffect(()=>{const n=se(r);h(n??t)},[r]),b.useEffect(()=>{Ce(r,u)},[r,u]),[u,h]},er="/Daggerheart/assets/daggerheart-logo-fe7815ad.svg",rr=()=>{const[r,t]=b.useState(!1),[u,h]=b.useState(!1);return b.useEffect(()=>{const n=o=>{o.target.closest(".help-button")||t(!1)};return document.addEventListener("click",n),()=>document.removeEventListener("click",n)},[]),b.useEffect(()=>{const n=window.matchMedia("(max-width: 800px)"),o=l=>h(l.matches);return h(n.matches),n.addEventListener("change",o),()=>n.removeEventListener("change",o)},[]),e.jsxs("div",{className:"help-button",style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",padding:"0.5rem",color:r?"white":"var(--text-primary)",borderRadius:"50%",cursor:"pointer",transition:"all 0.2s ease",minWidth:"44px",minHeight:"44px",backgroundColor:r?"var(--purple)":"transparent"},onMouseEnter:n=>{r||(n.currentTarget.style.backgroundColor="var(--bg-secondary)")},onMouseLeave:n=>{r||(n.currentTarget.style.backgroundColor="transparent")},onClick:n=>{n.stopPropagation(),t(!r)},title:"Help & Info",children:[e.jsx("div",{style:{width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center",color:"inherit",backgroundColor:"transparent",border:"none",outline:"none"},children:e.jsx(Le,{size:20})}),e.jsxs("div",{style:{position:"absolute",top:"50%",right:"100%",left:"auto",transform:"translateY(-50%)",background:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,opacity:r?1:0,visibility:r?"visible":"hidden",transition:"opacity 0.2s ease, visibility 0.2s ease, transform 0.2s ease",pointerEvents:r?"auto":"none",minWidth:"280px",maxWidth:u?"calc(100vw - 2rem)":"320px",marginRight:"0.5rem"},children:[e.jsxs("div",{style:{padding:"0.75rem",borderTop:"1px solid rgba(255, 255, 255, 0.1)",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",background:"var(--bg-primary)",maxWidth:"280px"},children:[e.jsx("img",{src:er,alt:"Daggerheart Community Content Logo",style:{width:"100%",maxWidth:"200px",height:"auto",margin:"0 auto 0.75rem auto",display:"block"},onError:n=>{console.error("Failed to load Daggerheart logo:",n.target.src),n.target.style.display="none";const o=document.createElement("div");o.style.cssText="text-align: center; margin-bottom: 0.75rem; font-size: 1.5rem; font-weight: bold; color: var(--purple);",o.textContent="⚔️ DAGGERHEART ⚔️",n.target.parentNode.insertBefore(o,n.target)},onLoad:()=>{}}),e.jsxs("div",{style:{fontSize:"0.7rem",lineHeight:1.3,color:"var(--text-secondary)",textAlign:"left",wordWrap:"break-word",overflowWrap:"break-word"},children:[e.jsx("p",{children:"This product includes materials from the Daggerheart System Reference Document 1.0, © Critical Role, LLC, under the terms of the Darrington Press Community Gaming (DPCGL) License."}),e.jsxs("p",{children:["More information can be found at ",e.jsx("a",{href:"https://www.daggerheart.com",target:"_blank",rel:"noopener noreferrer",children:"daggerheart.com"})]}),e.jsx("p",{children:e.jsx("em",{children:"This project is unofficial and not endorsed by Darrington Press or Critical Role."})})]})]}),e.jsx("button",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"0.25rem 1rem",color:"var(--text-primary)",border:"none",background:"none",width:"100%",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"0.875rem",minHeight:"32px",borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},onMouseEnter:n=>{n.target.style.backgroundColor="var(--gray-dark)"},onMouseLeave:n=>{n.target.style.backgroundColor="transparent"},onClick:n=>{n.stopPropagation(),t(!1),window.open("https://github.com/Splinter714/Daggerheart","_blank")},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.25rem"},children:e.jsx("span",{children:"GitHub"})})}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"0.25rem 1rem",color:"var(--text-secondary)",border:"none",background:"none",width:"100%",textAlign:"left",cursor:"default",fontSize:"0.875rem",minHeight:"32px"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.25rem"},children:e.jsxs("span",{children:["Version ","0.2.23 (a96835f)"]})})})]})]})},tr=({adversaries:r,environments:t,countdowns:u,deleteAdversary:h,deleteEnvironment:n,deleteCountdown:o,isClearMode:l,setIsClearMode:d})=>{const[a,x]=b.useState(!1),c=((r==null?void 0:r.length)||0)>0||((t==null?void 0:t.length)||0)>0||((u==null?void 0:u.length)||0)>0,s=(r||[]).some(i=>(i.hp||0)>=(i.hpMax||1));b.useEffect(()=>{const i=I=>{I.target.closest(".delete-clear-container")||(x(!1),l&&d(!1))};return document.addEventListener("click",i),()=>document.removeEventListener("click",i)},[l]),b.useEffect(()=>{l&&!c&&(d(!1),x(!1))},[l,c,d]);const f={position:"absolute",top:"50%",right:"100%",left:"auto",transform:"translateY(-50%)",backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",padding:"0.5rem",minWidth:"200px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,display:a?"block":"none",marginRight:"0.5rem"},m={background:l||a?"var(--red)":"none",border:"none",color:l||a?"white":c?"var(--text-primary)":"var(--text-secondary)",cursor:c?"pointer":"not-allowed",padding:"0.5rem",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s",opacity:c?1:.5,minWidth:"44px",minHeight:"44px"},v={background:"none",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:"0.5rem",borderRadius:"var(--radius-sm)",width:"100%",textAlign:"left",display:"flex",alignItems:"center",gap:"0.5rem",transition:"background-color 0.2s"},S={backgroundColor:"var(--bg-hover)"};return e.jsxs("div",{className:"delete-clear-container",style:{position:"relative"},children:[e.jsx("button",{style:m,onClick:i=>{i.stopPropagation(),c&&(l?(d(!1),x(!1)):(d(!0),x(!0)))},title:c?l?"Clear Items":"Enter Clear Mode":"Nothing to clear",children:e.jsx(Be,{size:20})}),e.jsxs("div",{style:f,children:[r&&r.length>0&&e.jsxs("button",{style:v,onMouseEnter:i=>Object.assign(i.target.style,S),onMouseLeave:i=>Object.assign(i.target.style,v),onClick:i=>{i.stopPropagation(),x(!1),r.forEach(I=>h(I.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Adversaries"})]}),r&&r.length>0&&s&&e.jsxs("button",{style:v,onMouseEnter:i=>Object.assign(i.target.style,S),onMouseLeave:i=>Object.assign(i.target.style,v),onClick:i=>{i.stopPropagation(),x(!1),r.filter(w=>(w.hp||0)>=(w.hpMax||1)).forEach(w=>h(w.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"Dead Adversaries"})]}),t&&t.length>0&&e.jsxs("button",{style:v,onMouseEnter:i=>Object.assign(i.target.style,S),onMouseLeave:i=>Object.assign(i.target.style,v),onClick:i=>{i.stopPropagation(),x(!1),t.forEach(I=>n(I.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Environments"})]}),u&&u.length>0&&e.jsxs("button",{style:v,onMouseEnter:i=>Object.assign(i.target.style,S),onMouseLeave:i=>Object.assign(i.target.style,v),onClick:i=>{i.stopPropagation(),x(!1),u.forEach(I=>o(I.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Countdowns"})]})]})]})},nr=({adversaries:r,environments:t,countdowns:u,deleteAdversary:h,deleteEnvironment:n,deleteCountdown:o,isClearMode:l,setIsClearMode:d})=>{const[a,x]=b.useState(!1),[c,s]=b.useState(!1),[f,m]=b.useState(!1);b.useEffect(()=>{const D=z=>{z.target.closest(".floating-menu-container")||(x(!1),s(!1),m(!1))};return document.addEventListener("click",D),()=>document.removeEventListener("click",D)},[]);const S={position:"fixed",bottom:window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://")?"calc(60px + env(safe-area-inset-bottom) + 2rem)":"calc(60px + env(safe-area-inset-bottom) + 1rem)",right:"1rem",zIndex:1e3,display:"flex",flexDirection:"column",alignItems:"center",gap:"0.5rem",pointerEvents:"none"},i={width:"56px",height:"56px",borderRadius:"50%",background:a?"var(--red)":"var(--bg-secondary)",border:"1px solid var(--border)",color:a?"white":"var(--text-primary)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"all 0.3s ease",pointerEvents:"auto"},I={display:"flex",flexDirection:"column",gap:"0.5rem",opacity:a?1:0,visibility:a?"visible":"hidden",transform:a?"translateY(0)":"translateY(10px)",transition:"all 0.3s ease",pointerEvents:a?"auto":"none"},w={width:"48px",height:"48px",borderRadius:"50%",background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.2)",transition:"all 0.2s ease",position:"relative",pointerEvents:"auto"};return e.jsxs("div",{className:"floating-menu-container",style:S,children:[e.jsxs("div",{style:I,children:[e.jsx("div",{style:w,children:e.jsx(rr,{})}),e.jsx("div",{style:w,children:e.jsx(tr,{adversaries:r,environments:t,countdowns:u,deleteAdversary:h,deleteEnvironment:n,deleteCountdown:o,isClearMode:l,setIsClearMode:d})})]}),e.jsx("button",{style:i,onClick:D=>{D.stopPropagation(),x(!a)},title:a?"Close Menu":"Open Menu",children:a?e.jsx(Re,{size:24}):e.jsx(He,{size:24})})]})},he=({position:r="top",children:t,onClick:u,className:h="",style:n={}})=>{const o=r==="top",l=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://"),d={background:"var(--bg-primary)",borderTop:o?"none":"1px solid var(--border)",borderBottom:o?"1px solid var(--border)":"none",padding:o?"0.25rem 0":"0.5rem",paddingBottom:o?"0.25rem":l?"calc(0.5rem + env(safe-area-inset-bottom) + 1rem)":"calc(0.5rem + env(safe-area-inset-bottom))",position:"sticky",[o?"top":"bottom"]:0,zIndex:o?10:100,order:o?1:3,flexShrink:0,touchAction:"manipulation",userSelect:"none",display:"flex",flexDirection:o?"column":"row",justifyContent:o?"stretch":"center",alignItems:o?"stretch":"center",gap:o?"0":"1rem",height:o?"auto":"60px",...n};return e.jsx("div",{className:h,style:d,onClick:u,children:t})},xe=({side:r="left",children:t,className:u="",style:h={}})=>{const n=r==="left",o={flex:1,minWidth:0,background:"var(--bg-primary)",overflowY:"auto",overflowX:n?"auto":"hidden",display:n?"block":"flex",flexDirection:n?"initial":"column",height:"100%",padding:n?"1rem 0 1rem 0":"1rem 1rem 1rem 0",...h};return e.jsx("div",{className:u,style:o,children:t})},sr=({items:r,onDelete:t,onEdit:u,onToggleVisibility:h,onReorder:n,onItemSelect:o,selectedItem:l,selectedType:d,onApplyDamage:a,onApplyHealing:x,onApplyStressChange:c,onIncrement:s,onDecrement:f,isEditMode:m,isClearMode:v,elementType:S,adversaries:i=[]})=>{if(!r||r.length===0)return null;const I=w=>{const D=l&&l.id===w.id&&d===S;console.log("Card selection check:",{itemId:w.id,selectedItemId:l==null?void 0:l.id,selectedType:d,elementType:S,isSelected:D});const z={item:w,mode:"compact",onClick:()=>o(w,S),onDelete:v?t:void 0,dragAttributes:m?{draggable:!0}:null,dragListeners:m?{onDragStart:N=>{N.dataTransfer.setData("text/plain",w.id)}}:null,adversaries:i,isSelected:D,isEditMode:m||v};switch(S){case"adversaries":return e.jsx(U,{...z,type:"adversary",onApplyDamage:a,onApplyHealing:x,onApplyStressChange:c},w.id);case"environments":return e.jsx(U,{...z,type:"environment",onEdit:u},w.id);case"countdowns":return e.jsx(U,{...z,type:"countdown",onIncrement:s,onDecrement:f},w.id);default:return null}};return e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:r.map(I)})},or=({onItemSelect:r,selectedItem:t,selectedType:u,onOpenDatabase:h,isEditMode:n,isClearMode:o,showLongTermCountdowns:l,fear:d,updateFear:a,handleRollOutcome:x,handleActionRoll:c,setShowLongTermCountdowns:s,lastAddedItemType:f})=>{console.log("GameBoard received props:",{selectedItem:t,selectedType:u});const{adversaries:m,environments:v,updateAdversary:S,deleteAdversary:i,reorderAdversaries:I,updateEnvironment:w,deleteEnvironment:D,reorderEnvironments:z,countdowns:N,createCountdown:H,deleteCountdown:M,reorderCountdowns:O,incrementCountdown:T,decrementCountdown:L}=ke();b.useState({adversary:!1,environment:!1,campaign:!1});const[$,P]=Ze("sectionVisibility",{countdowns:!1,environments:!1,adversaries:!1});b.useEffect(()=>{f&&(f==="environment"?P(W=>({...W,environments:!0})):f==="adversary"?P(W=>({...W,adversaries:!0})):f==="countdown"&&P(W=>({...W,countdowns:!0})))},[f,P]);const V=(W,C)=>{},_=(W,C)=>{C==="environment"?D(W):C==="adversary"?i(W):C==="countdown"&&M(W),t&&t.id===W&&r(null,null)};return e.jsx("div",{style:{flex:1,overflowY:"auto"},children:e.jsxs("div",{children:[e.jsx(sr,{items:m,onDelete:W=>_(W,"adversary"),onEdit:W=>V(),onToggleVisibility:W=>{const C=m.find(k=>k.id===W);C&&S(W,{isVisible:!C.isVisible})},onReorder:I,onItemSelect:r,selectedItem:t,selectedType:u,onApplyDamage:(W,C,k,p)=>{const g=Math.min(p,k+C);S(W,{hp:g})},onApplyHealing:(W,C,k)=>{if(m.find(g=>g.id===W)){const g=Math.max(0,k-C);S(W,{hp:g})}},onApplyStressChange:(W,C)=>{const k=m.find(p=>p.id===W);if(k){let p=k.stress+C,g=k.hp||0;if(p>k.stressMax){const y=p-k.stressMax;p=k.stressMax,g=Math.min(k.hpMax,g+y)}else p<0&&(p=0);S(W,{stress:p,hp:g})}},isEditMode:n,isClearMode:o,elementType:"adversaries",adversaries:m}),e.jsx("div",{className:"border rounded-lg",style:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"12px",marginTop:"0.5rem",cursor:"pointer",transition:"all 0.1s ease",position:"relative",border:"2px dashed var(--border)",opacity:.8,background:"var(--bg-card)"},onClick:()=>h("adversaries"),onMouseEnter:W=>{W.target.style.opacity="1",W.target.style.borderColor="var(--border-hover)"},onMouseLeave:W=>{W.target.style.opacity="0.8",W.target.style.borderColor="var(--border)"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"0.5rem",position:"relative"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.25rem"},children:[e.jsx("h4",{style:{fontSize:"16px",fontWeight:"600",color:"var(--text-secondary)",margin:0},children:"Add Adversary"}),e.jsx("span",{style:{fontSize:"0.75rem",fontWeight:500,color:"var(--text-secondary)",letterSpacing:"0.5px"},children:"Click to browse"})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",borderRadius:"50%",border:"1px dashed var(--text-secondary)",color:"var(--text-secondary)"},children:e.jsx(te,{size:16})})]})})]})})};function ar({headerSelector:r=".drawer-header",closeThreshold:t=100,snapThreshold:u=30,onClose:h}={}){const[n,o]=b.useState(null),[l,d]=b.useState(null),[a,x]=b.useState(0),[c,s]=b.useState(!1),f=b.useCallback(i=>{var z,N;const I=i.target;if(!(r?I.closest(r):!1))return;const D=((N=(z=i.targetTouches)==null?void 0:z[0])==null?void 0:N.clientY)??0;o(D),d(D),x(0),s(!1)},[r]),m=b.useCallback(i=>{var z,N;if(n==null)return;const I=((N=(z=i.targetTouches)==null?void 0:z[0])==null?void 0:N.clientY)??0,w=I-n,D=6;!c&&Math.abs(w)>D&&s(!0),c&&(i.preventDefault(),i.stopPropagation(),d(I),x(Math.max(0,w)))},[n,c]),v=b.useCallback(i=>{if(n==null||l==null)return;const I=l-n;c?(i.preventDefault(),i.stopPropagation(),I>t?(x(window.innerHeight),typeof h=="function"&&setTimeout(()=>h(),300)):I>u?(x(0),setTimeout(()=>{o(null),d(null),s(!1)},50)):(x(0),o(null),d(null),s(!1))):(x(0),o(null),d(null),s(!1))},[n,l,c,t,u,h]),S=b.useCallback(()=>{x(0),o(null),d(null)},[]);return{drawerOffset:a,setDrawerOffset:x,touchHandlers:{onTouchStart:f,onTouchMove:m,onTouchEnd:v},resetSwipeState:S}}const ir=({isOpen:r,onClose:t,children:u})=>{const{drawerOffset:h,setDrawerOffset:n,touchHandlers:o,resetSwipeState:l}=ar({headerSelector:".drawer-header",closeThreshold:100,snapThreshold:30,onClose:t});return b.useEffect(()=>{r||l()},[r,l]),e.jsxs("div",{className:`mobile-drawer ${r?"open":""}`,children:[e.jsx("div",{className:"drawer-backdrop",onClick:t}),e.jsxs("div",{className:"drawer-content",style:{transform:r?`translateY(${h}px)`:"translateY(100%)",transition:h?"none":"transform 0.25s cubic-bezier(0.4, 0.0, 0.2, 1)"},onTouchStart:d=>{o.onTouchStart(d)},onTouchMove:d=>{o.onTouchMove(d)},onTouchEnd:d=>{o.onTouchEnd(d)},onClick:d=>{d.stopPropagation()},children:[e.jsx("div",{className:"drawer-header",onClick:()=>{n(window.innerHeight),setTimeout(()=>{t()},300)},children:e.jsx("div",{className:"drawer-handle"})}),e.jsx("div",{className:"drawer-body",children:u})]})]})},lr=()=>e.jsx("div",{className:"pwa-install-prompt",style:{}}),dr="modulepreload",cr=function(r){return"/Daggerheart/"+r},ge={},fe=function(t,u,h){if(!u||u.length===0)return t();const n=document.getElementsByTagName("link");return Promise.all(u.map(o=>{if(o=cr(o),o in ge)return;ge[o]=!0;const l=o.endsWith(".css"),d=l?'[rel="stylesheet"]':"";if(!!h)for(let c=n.length-1;c>=0;c--){const s=n[c];if(s.href===o&&(!l||s.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${d}`))return;const x=document.createElement("link");if(x.rel=l?"stylesheet":dr,l||(x.as="script",x.crossOrigin=""),x.href=o,document.head.appendChild(x),l)return new Promise((c,s)=>{x.addEventListener("load",c),x.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>t()).catch(o=>{const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o})};let Ee={adversaries:[]},Ie={environments:[]};const pr=async()=>{try{const r=await fe(()=>import("./adversaries-e62ea4d8.js"),[]);Ee=(r==null?void 0:r.default)||r}catch(r){console.warn("Failed to load adversaries.json:",r)}try{const r=await fe(()=>import("./environments-5ca1c1e1.js"),[]);Ie=(r==null?void 0:r.default)||r}catch(r){console.warn("Failed to load environments.json:",r)}},ur=r=>{const[t,u]=b.useState(""),[h,n]=b.useState([{field:"tier",direction:"asc"},{field:"name",direction:"asc"}]),[o,l]=b.useState(null),[d,a]=b.useState([]),[x,c]=b.useState(!0),[s,f]=b.useState([]),[m,v]=b.useState([]),[S,i]=b.useState(!1),[I,w]=b.useState(!1),D=b.useRef(null),z=b.useRef(null);b.useEffect(()=>{(async()=>{await pr(),c(!1);let k=[];r==="adversary"?k=Ee.adversaries||[]:r==="environment"&&(k=Ie.environments||[]),a(k)})()},[r]);const N=C=>{const k=d.map(p=>p[C]).filter(Boolean);return[...new Set(k)].sort((p,g)=>typeof p=="number"&&typeof g=="number"?p-g:String(p).localeCompare(String(g)))},H=N("tier"),M=N("type"),O=b.useMemo(()=>{let C=d.filter(k=>{var j,E;const p=k.name.toLowerCase().includes(t.toLowerCase())||((j=k.type)==null?void 0:j.toLowerCase().includes(t.toLowerCase()))||((E=k.description)==null?void 0:E.toLowerCase().includes(t.toLowerCase())),g=s.length===0||s.includes(k.tier.toString()),y=m.length===0||m.includes(k.type);return p&&g&&y});return C.sort((k,p)=>{for(const g of h){const{field:y,direction:j}=g;let E=k[y],A=p[y];if(y==="tier")E=parseInt(E)||0,A=parseInt(A)||0;else if(y==="difficulty"){const X=parseInt(E),q=parseInt(A);!isNaN(X)&&!isNaN(q)?(E=X,A=q):!isNaN(X)&&isNaN(q)?(E=X,A=999):isNaN(X)&&!isNaN(q)?(E=999,A=q):(E=String(E||"").toLowerCase(),A=String(A||"").toLowerCase())}else typeof E=="string"&&typeof A=="string"?(E=E.toLowerCase(),A=A.toLowerCase()):(E=String(E||"").toLowerCase(),A=String(A||"").toLowerCase());if(j==="asc"){if(E>A)return 1;if(E<A)return-1}else{if(E<A)return 1;if(E>A)return-1}}return 0}),C},[d,t,h,s,m]),T=C=>{n(k=>{const p=k.findIndex(g=>g.field===C);if(p>=0)if(p===0){const g=[...k];return g[0]={...g[0],direction:g[0].direction==="asc"?"desc":"asc"},g}else{const g=[...k];return g.splice(p,1)[0],[{field:C,direction:"asc"},...g]}else return[{field:C,direction:"asc"},...k]})},L=C=>{l(o===C?null:C)},$=C=>{f(C==="clear"?[]:k=>k.includes(C)?k.filter(p=>p!==C):[...k,C])},P=C=>{v(C==="clear"?[]:k=>k.includes(C)?k.filter(p=>p!==C):[...k,C])},V=s.length>0,_=m.length>0;return b.useEffect(()=>{const C=p=>{const g=p.target.closest(".filter-dropdown"),y=p.target.closest(".header-filter-icon");g||y||(i(!1),w(!1))},k=p=>{p.key==="Escape"&&(i(!1),w(!1))};return document.addEventListener("pointerdown",C,!0),document.addEventListener("mousedown",C,!0),document.addEventListener("touchstart",C,!0),document.addEventListener("click",C,!0),document.addEventListener("keydown",k,!0),()=>{document.removeEventListener("pointerdown",C,!0),document.removeEventListener("mousedown",C,!0),document.removeEventListener("touchstart",C,!0),document.removeEventListener("click",C,!0),document.removeEventListener("keydown",k,!0)}},[i,w]),{searchTerm:t,setSearchTerm:u,sortFields:h,handleSort:T,expandedCard:o,toggleExpanded:L,filteredAndSortedData:O,loading:x,selectedTiers:s,selectedTypes:m,showTierDropdown:S,setShowTierDropdown:i,showTypeDropdown:I,setShowTypeDropdown:w,tierFilterRef:D,typeFilterRef:z,uniqueTiers:H,uniqueTypes:M,handleTierSelect:$,handleTypeSelect:P,isTierFiltered:V,isTypeFiltered:_,getDropdownStyle:C=>{if(!C.current)return{};const k=C.current.getBoundingClientRect();return{position:"fixed",top:k.bottom+4,left:k.left-100,zIndex:99999}}}},hr=({searchTerm:r,onSearchChange:t,type:u})=>e.jsx("div",{style:R.browserHeader,children:e.jsx("input",{type:"text",placeholder:"Search",value:r,onChange:h=>t(h.target.value),style:R.searchInput})}),xr=({sortFields:r,onSort:t,type:u,uniqueTiers:h,uniqueTypes:n,selectedTiers:o,selectedTypes:l,showTierDropdown:d,setShowTierDropdown:a,showTypeDropdown:x,setShowTypeDropdown:c,tierFilterRef:s,typeFilterRef:f,handleTierSelect:m,handleTypeSelect:v,isTierFiltered:S,isTypeFiltered:i,getDropdownStyle:I})=>{const[w,D]=b.useState(null),N=(()=>u==="adversary"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:u==="environment"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:[])(),H=(M,O,T,L,$,P,V,_)=>{if(!$)return null;const W=()=>{(M==="tier"||M==="type")&&L("clear")};return ye.createPortal(e.jsxs("div",{className:"filter-dropdown",style:{...R.filterDropdown,...I(V),maxHeight:"60vh",overflow:"auto"},onMouseDown:C=>C.stopPropagation(),onClick:C=>C.stopPropagation(),children:[e.jsxs("div",{style:{...R.filterOption,...T.length===0?R.filterOptionSelected:{}},onClick:W,children:[e.jsx("span",{style:R.checkIcon,children:T.length===0?e.jsx(de,{size:16}):e.jsx(ce,{size:16})}),e.jsx("span",{style:R.filterLabel,children:"All"})]}),O.map(C=>{const k=T.includes(C.toString());return e.jsxs("div",{style:{...R.filterOption,...k?R.filterOptionSelected:{}},onClick:()=>L(C.toString()),children:[e.jsx("span",{style:R.checkIcon,children:k?e.jsx(de,{size:16}):e.jsx(ce,{size:16})}),e.jsx("span",{style:R.filterLabel,children:C})]},C)})]}),document.body)};return e.jsx("tr",{style:R.tableHeader,children:N.map(M=>e.jsxs("th",{style:{...R.tableHeaderCell,...w===M.key?R.tableHeaderCellHover:{},position:"relative",...M.key==="name"?{width:"auto",minWidth:"0"}:{},...M.key==="tier"?{width:"80px",minWidth:"80px",maxWidth:"80px"}:{},...M.key==="type"?{width:"100px",minWidth:"100px",maxWidth:"100px"}:{},...M.key==="difficulty"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...M.key==="action"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{}},onClick:()=>t(M.key),onMouseEnter:()=>D(M.key),onMouseLeave:()=>D(null),children:[M.hasFilter?e.jsxs("div",{style:R.headerWithFilter,children:[e.jsx("span",{style:{cursor:"pointer"},onClick:O=>{O.stopPropagation(),t(M.key)},children:M.label}),e.jsxs("button",{ref:M.key==="tier"?s:f,style:{...R.headerFilterIcon,...M.key==="tier"&&S?R.headerFilterIconActive:{},...M.key==="type"&&i?R.headerFilterIconActive:{}},className:"header-filter-icon",onClick:O=>{O.stopPropagation(),M.key==="tier"?(a(!d),c(!1)):M.key==="type"&&(c(!x),a(!1))},children:[e.jsx(Ne,{size:14}),M.key==="tier"&&S||M.key==="type"&&i?e.jsx("span",{style:R.filterActiveDot}):null]})]}):M.label,M.key==="tier"&&H("tier",h,o,m,d,a,s),M.key==="type"&&H("type",n,l,v,x,c,f)]},M.key))})},gr=({item:r,isExpanded:t,onToggleExpanded:u,onAdd:h,type:n})=>{const[o,l]=b.useState(!1),d=()=>{h(r)},a=()=>n==="adversary"?e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...R.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:r.name}),e.jsx("td",{style:{...R.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:r.tier}),e.jsx("td",{style:{...R.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:r.type}),e.jsx("td",{style:{...R.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:r.difficulty})]}):n==="environment"?e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...R.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:r.name}),e.jsx("td",{style:{...R.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:r.tier}),e.jsx("td",{style:{...R.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:r.type}),e.jsx("td",{style:{...R.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:r.difficulty})]}):null;return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{style:{...R.row,...o?R.rowHover:{}},onClick:()=>u(r.id),onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),children:[a(),e.jsx("td",{style:{width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",boxSizing:"border-box",overflow:"visible",textOverflow:"unset",whiteSpace:"nowrap"},children:e.jsx("button",{style:R.addButton,onClick:x=>{x.stopPropagation(),d()},onMouseEnter:x=>{x.target.style.background="var(--bg-secondary)"},onMouseLeave:x=>{x.target.style.background="var(--purple)"},children:"+"})})]}),t&&e.jsx("tr",{style:R.expandedRow,children:e.jsx("td",{colSpan:"5",style:R.expandedContent,children:e.jsx(U,{item:r,type:n,mode:"expanded",onClick:()=>{},onDelete:()=>{}})})})]})},me=({type:r,onAddItem:t,onCancel:u})=>{const{searchTerm:h,setSearchTerm:n,sortFields:o,handleSort:l,expandedCard:d,toggleExpanded:a,filteredAndSortedData:x,loading:c,selectedTiers:s,selectedTypes:f,showTierDropdown:m,setShowTierDropdown:v,showTypeDropdown:S,setShowTypeDropdown:i,tierFilterRef:I,typeFilterRef:w,uniqueTiers:D,uniqueTypes:z,handleTierSelect:N,handleTypeSelect:H,isTierFiltered:M,isTypeFiltered:O,getDropdownStyle:T}=ur(r);return c?e.jsx("div",{style:R.browser,children:e.jsx("div",{style:R.loading,children:"Loading..."})}):e.jsxs("div",{style:R.browserWrapper,children:[e.jsx(hr,{searchTerm:h,onSearchChange:n,type:r}),e.jsx("div",{className:"browser-content",style:R.browserContent,children:e.jsxs("table",{style:R.browserTable,children:[e.jsx("thead",{children:e.jsx(xr,{sortFields:o,onSort:l,type:r,uniqueTiers:D,uniqueTypes:z,selectedTiers:s,selectedTypes:f,showTierDropdown:m,setShowTierDropdown:v,showTypeDropdown:S,setShowTypeDropdown:i,tierFilterRef:I,typeFilterRef:w,handleTierSelect:N,handleTypeSelect:H,isTierFiltered:M,isTypeFiltered:O,getDropdownStyle:T})}),e.jsx("tbody",{children:x.map(L=>e.jsx(gr,{item:L,isExpanded:d===L.id,onToggleExpanded:a,onAdd:t,type:r},L.id))})]})})]})},R={browserWrapper:{display:"flex",flexDirection:"column",background:"var(--bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border)",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserContent:{flex:1,overflowY:"auto",overflowX:"visible",padding:0,width:"100%"},tableHeaderContainer:{flexShrink:0,position:"sticky",top:0,zIndex:15,backgroundColor:"var(--bg-secondary)"},browserTable:{width:"100%",minWidth:"100%",borderCollapse:"collapse",tableLayout:"fixed",background:"var(--bg-primary)",margin:0},browserHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--gray-900)",flexShrink:0,position:"sticky",top:0,zIndex:20},browserTitle:{margin:0,color:"var(--text-primary)",fontSize:"18px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"24px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"14px",marginRight:"12px",transition:"all 0.2s ease"},searchInputFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 3px rgba(139, 92, 246, 0.1)"},tableHeader:{background:"var(--gray-900)",borderBottom:"1px solid var(--border)",boxShadow:"0 1px 0 var(--border)",position:"sticky",top:"0",zIndex:10},tableHeaderCell:{backgroundColor:"var(--gray-900)",fontWeight:"700",borderBottom:"1px solid var(--border)",cursor:"pointer",userSelect:"none",minWidth:"100px",whiteSpace:"nowrap",padding:"4px 4px",color:"var(--text-primary)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",boxShadow:"0 1px 0 var(--border)",transition:"background-color 0.2s",position:"sticky",top:"0",zIndex:10},tableHeaderCellHover:{backgroundColor:"var(--bg-hover)"},sortIndicator:{fontSize:"12px",color:"var(--text-secondary)"},tableBody:{flex:1,overflowY:"auto",padding:"8px",backgroundColor:"var(--bg-primary)"},row:{height:"35px",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s ease",cursor:"pointer",backgroundColor:"var(--gray-900)"},rowHover:{backgroundColor:"var(--bg-secondary)"},expandedRow:{backgroundColor:"var(--bg-secondary)"},rowCell:{padding:"4px 4px",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid var(--border)"},rowCellName:{fontWeight:"500",minWidth:"150px"},rowCellCenter:{textAlign:"center",justifyContent:"center",minWidth:"80px"},rowActions:{width:"80px",textAlign:"center",padding:"4px 8px",borderBottom:"1px solid var(--border)"},addButton:{width:"1.5rem",height:"1.5rem",border:"1px solid var(--purple)",borderRadius:"var(--radius-sm)",background:"var(--purple)",color:"white",cursor:"pointer",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"500"},expandedContent:{padding:"0",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)"},columnName:{width:"auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",paddingLeft:"8px",textAlign:"left"},columnTier:{width:"80px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnType:{width:"100px",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},columnDifficulty:{width:"40px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnAction:{width:"24px",minWidth:"24px",maxWidth:"24px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"visible",textOverflow:"unset"},loading:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"var(--text-primary)",fontSize:"16px"},mobileBrowser:{width:"95vw",height:"90vh",maxWidth:"none"},mobileSearchInput:{fontSize:"16px"},headerWithFilter:{display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",position:"relative"},headerFilterIcon:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"2px 4px",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",position:"relative"},headerFilterIconActive:{color:"var(--purple)"},filterIcon:{fontSize:"12px"},filterActiveDot:{position:"absolute",left:"50%",top:"2px",transform:"translateX(-50%)",width:"4px",height:"4px",borderRadius:"50%",background:"var(--purple)",pointerEvents:"none"},filterDropdown:{position:"absolute",top:"100%",left:"0",background:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",zIndex:99999,marginTop:"4px",overflow:"hidden",width:"max-content",minWidth:"120px",maxWidth:"200px"},filterOption:{padding:"8px 12px",cursor:"pointer",color:"var(--text-primary)",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background-color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},filterOptionSelected:{backgroundColor:"var(--bg-hover)"},checkIcon:{width:"16px",height:"16px",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"12px"},filterLabel:{flex:1}};function fr({selectedItem:r,selectedType:t,countdowns:u,adversaries:h,environments:n,setSelectedItem:o,handleCloseRightColumn:l}){b.useEffect(()=>{if(!r||!t)return;let d=!1;t==="adversaries"||t==="adversary"?d=h.some(a=>a.id===r.id):t==="environments"||t==="environment"?d=n.some(a=>a.id===r.id):(t==="countdowns"||t==="countdown")&&(d=u.some(a=>a.id===r.id)),d||l()},[r,t,u,h,n,o,l]),b.useEffect(()=>{if(!r||!t)return;let d=null;t==="adversaries"||t==="adversary"?d=h.find(a=>a.id===r.id):t==="environments"||t==="environment"?d=n.find(a=>a.id===r.id):(t==="countdowns"||t==="countdown")&&(d=u.find(a=>a.id===r.id)),d&&JSON.stringify(d)!==JSON.stringify(r)&&o(d)},[r,t,u,h,n,o])}class mr extends oe.Component{constructor(t){super(t),this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,u){console.error("ErrorBoundary caught an error:",t,u)}render(){var t;return this.state.hasError?e.jsxs("div",{className:"p-md text-red",children:[e.jsx("h3",{children:"Something went wrong:"}),e.jsx("pre",{children:(t=this.state.error)==null?void 0:t.toString()}),e.jsx("button",{className:"btn-base btn-text",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try again"})]}):this.props.children}}const yr=()=>{const{adversaries:r,environments:t,countdowns:u,fear:h,updateFear:n,createAdversary:o,updateAdversary:l,deleteAdversary:d,createEnvironment:a,updateEnvironment:x,deleteEnvironment:c,createCountdown:s,deleteCountdown:f,advanceCountdown:m}=ke(),[v,S]=b.useState(null),[i,I]=b.useState(null),[w,D]=b.useState(null),[z,N]=b.useState("unified"),[H,M]=b.useState(!1),[O,T]=b.useState(!1),[L,$]=b.useState(!1),[P]=b.useState("left"),[V,_]=b.useState(!0);b.useState(!1);const[W,C]=b.useState(null),[k,p]=b.useState(!1),g=(F,Y)=>{b.startTransition(()=>{v&&v.id===F.id&&i===Y&&w==="item"?(S(null),I(null),D(null),H&&p(!1)):(S(F),I(Y),D("item"),H&&p(!0))})},y=(F="unified")=>{let Y=F;F==="adversaries"?Y="adversary":F==="environments"&&(Y="environment"),w==="database"&&z===Y?b.startTransition(()=>{D(null),N("unified"),H&&p(!1)}):b.startTransition(()=>{N(Y),D("database"),H&&p(!0)})},j=F=>{u.forEach(Y=>{const G=Ge(Y,F);if(G>0){const J=Y.value||0;m(Y.id,J+G)}})},E=()=>{u.forEach(F=>{const Y=Ke(F);if(Y>0){const G=F.value||0;m(F.id,G+Y)}})},A=b.useCallback(()=>{D(null),S(null),I(null),H&&p(!1)},[H]);b.useEffect(()=>{const F=()=>{const J=H,ee=window.matchMedia("(max-width: 800px)").matches;M(ee),!J&&ee&&(w==="database"||w==="creator"||w==="item")&&p(!0),J&&!ee&&k&&p(!1)};F();const Y=window.matchMedia("(max-width: 800px)"),G=()=>F();return Y.addEventListener("change",G),()=>Y.removeEventListener("change",G)},[H,w,k]),b.useEffect(()=>(k||H&&v?(document.body.classList.add("mobile-drawer-open"),document.documentElement.classList.add("mobile-drawer-open")):(document.body.classList.remove("mobile-drawer-open"),document.documentElement.classList.remove("mobile-drawer-open")),()=>{document.body.classList.remove("mobile-drawer-open"),document.documentElement.classList.remove("mobile-drawer-open")}),[H,k,v]),fr({selectedItem:v,selectedType:i,countdowns:u,adversaries:r,environments:t,setSelectedItem:S,handleCloseRightColumn:A});const{handleAdversaryDamage:X,handleAdversaryHealing:q,handleAdversaryStressChange:ie}=Ue({adversaries:r,updateAdversary:l,deleteAdversary:d,selectedItem:v,setSelectedItem:S});return e.jsxs("div",{className:"app",onClick:F=>{F.target===F.currentTarget&&A()},children:[!H&&e.jsx(he,{position:"top",style:{display:"flex",alignItems:"center",justifyContent:"center",height:"var(--topbar-height)",touchAction:"manipulation",userSelect:"none"},children:e.jsx(K,{type:"fear",value:(h==null?void 0:h.value)||0,maxValue:12,onChange:n,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0})}),e.jsx(he,{position:"bottom",children:H&&e.jsx(K,{type:"fear",value:(h==null?void 0:h.value)||0,maxValue:12,onChange:n,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0})}),e.jsx(nr,{adversaries:r,environments:t,countdowns:u,deleteAdversary:d,deleteEnvironment:c,deleteCountdown:f,isClearMode:L,setIsClearMode:$}),e.jsxs("div",{className:"main-content",children:[e.jsx(xe,{side:"left",className:`${H&&P==="right"?"mobile-hidden":""}`,children:e.jsx(or,{onItemSelect:g,selectedItem:v,selectedType:i,onOpenDatabase:y,isEditMode:O,onEditModeChange:T,isClearMode:L,showLongTermCountdowns:V,fear:h,updateFear:n,handleRollOutcome:j,handleActionRoll:E,setShowLongTermCountdowns:_,lastAddedItemType:W})}),e.jsxs(xe,{side:"right",className:`${H&&P==="left"?"mobile-hidden":""}`,style:w==="database"?{overflowY:"hidden"}:{},children:[w==="database"&&e.jsx("div",{className:"database-display",children:e.jsx(me,{type:z,onAddItem:F=>{z==="adversary"?(o(F),C("adversary")):z==="environment"&&(a(F),C("environment"))},onCancel:A})}),w==="item"&&v&&e.jsx(U,{type:i,item:v,mode:O?"edit":"expanded",onApplyDamage:X,onApplyHealing:q,onApplyStressChange:ie,onUpdate:i==="adversaries"?l:i==="environments"?x:updateCountdown,adversaries:r}),!w&&e.jsx("div",{})]})]},`mobile-${H}`),H&&e.jsxs(ir,{isOpen:k,onClose:A,children:[w==="database"&&e.jsx("div",{className:"browser-container",children:e.jsx(me,{type:z,onAddItem:F=>{z==="adversary"?(o(F),C("adversary")):z==="environment"&&(a(F),C("environment"))},onCancel:A})}),w==="item"&&v&&e.jsx("div",{className:"expanded-content",children:e.jsx(U,{type:i,item:v,mode:O?"edit":"expanded",onApplyDamage:X,onApplyHealing:q,onApplyStressChange:ie,onUpdate:i==="adversaries"?l:i==="environments"?x:updateCountdown,adversaries:r})})]}),e.jsx(lr,{})]})},vr=()=>e.jsx(mr,{children:e.jsx(Se,{children:e.jsx(yr,{})})});ne.createRoot(document.getElementById("root")).render(e.jsx(oe.StrictMode,{children:e.jsx(Se,{children:e.jsx(vr,{})})}));
