import{r as S,a as Oe,R as Se}from"./dndkit-57209f9c.js";import{F as st,f as at,a as it,b as lt,c as Ge}from"./fa-b4bcccb0.js";import{D as et,A as dt,X as Ne,B as ct,H as pt,L as ut,C as mt,S as xt,a as ht,T as ft,F as gt,b as ze,c as We,M as Ye,P as Xe}from"./lucide-29f8cc59.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))d(f);new MutationObserver(f=>{for(const m of f)if(m.type==="childList")for(const x of m.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&d(x)}).observe(document,{childList:!0,subtree:!0});function p(f){const m={};return f.integrity&&(m.integrity=f.integrity),f.referrerPolicy&&(m.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?m.credentials="include":f.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function d(f){if(f.ep)return;f.ep=!0;const m=p(f);fetch(f.href,m)}})();var tt={exports:{}},De={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yt=S,vt=Symbol.for("react.element"),bt=Symbol.for("react.fragment"),jt=Object.prototype.hasOwnProperty,wt=yt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ct={key:!0,ref:!0,__self:!0,__source:!0};function rt(t,a,p){var d,f={},m=null,x=null;p!==void 0&&(m=""+p),a.key!==void 0&&(m=""+a.key),a.ref!==void 0&&(x=a.ref);for(d in a)jt.call(a,d)&&!Ct.hasOwnProperty(d)&&(f[d]=a[d]);if(t&&t.defaultProps)for(d in a=t.defaultProps,a)f[d]===void 0&&(f[d]=a[d]);return{$$typeof:vt,type:t,key:m,ref:x,props:f,_owner:wt.current}}De.Fragment=bt;De.jsx=rt;De.jsxs=rt;tt.exports=De;var e=tt.exports,qe={},Je=Oe;qe.createRoot=Je.createRoot,qe.hydrateRoot=Je.hydrateRoot;function Ce(t){const a=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return t?`${t}-${a}`:a}const nt=S.createContext();function He(t){if(typeof localStorage>"u")return null;try{const a=localStorage.getItem(t);return a==null?null:JSON.parse(a)}catch{return null}}function ke(t,a){if(!(typeof localStorage>"u"))try{localStorage.setItem(t,JSON.stringify(a))}catch{}}const St=({children:t})=>{const[a,p]=S.useState({fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],currentEncounterName:"Encounter"}),[d,f]=S.useState(!1),[m,x]=S.useState({adversaries:[],environments:[]});S.useEffect(()=>{var n,i,E,N;const r=He("daggerheart-game-state");if(r)try{(((n=r.adversaries)==null?void 0:n.length)>0||((i=r.environments)==null?void 0:i.length)>0||((E=r.countdowns)==null?void 0:E.length)>0||((N=r.savedEncounters)==null?void 0:N.length)>0)&&p(r)}catch(A){console.error("Failed to load saved state:",A)}const s=He("daggerheart-custom-adversaries")||[],o=He("daggerheart-custom-environments")||[];x({adversaries:s,environments:o}),f(!0)},[]),S.useEffect(()=>{ke("daggerheart-game-state",a)},[a]);const z=r=>{p(s=>({...s,fear:{...s.fear,value:r}}))},u=()=>{p(r=>({...r,fear:{...r.fear,visible:!r.fear.visible}}))},T=r=>{p(s=>({...s,partySize:Math.max(1,r)}))},D=r=>{p(s=>({...s,currentEncounterName:r||"Encounter"}))},W=r=>{if(r.id)return p(s=>({...s,savedEncounters:(s.savedEncounters||[]).map(o=>o.id===r.id?{...o,name:r.name||o.name,encounterItems:r.encounterItems||o.encounterItems,partySize:r.partySize||o.partySize,battlePointsAdjustments:r.battlePointsAdjustments||o.battlePointsAdjustments,updatedAt:new Date().toISOString()}:o)})),r.id;{const s={id:Ce("encounter"),name:r.name||"Encounter",createdAt:new Date().toISOString(),encounterItems:r.encounterItems||[],partySize:r.partySize||4,battlePointsAdjustments:r.battlePointsAdjustments||{}};return p(o=>({...o,savedEncounters:[...o.savedEncounters||[],s]})),s.id}},q=r=>(a.savedEncounters||[]).find(o=>o.id===r),j=r=>{const s={id:Ce("encounter"),name:r.name||`Encounter ${Date.now()}`,createdAt:new Date().toISOString(),encounterItems:r.encounterItems||[],partySize:r.partySize||4,battlePointsAdjustments:r.battlePointsAdjustments||{}};return p(o=>({...o,savedEncounters:[...o.savedEncounters||[],s]})),s.id},v=r=>{p(s=>({...s,savedEncounters:(s.savedEncounters||[]).filter(o=>o.id!==r)}))},C=S.useRef(a);S.useEffect(()=>{C.current=a},[a]);const h={gameState:a,isLoaded:d,customContent:m,updateFear:z,toggleFearVisibility:u,updatePartySize:T,updateCurrentEncounterName:D,saveEncounter:W,saveEncounterAs:j,loadEncounter:q,deleteEncounter:v,createCountdown:r=>{const s={id:Ce("countdown"),name:r.name||"Countdown",max:parseInt(r.max)||1,value:0,visible:!0,type:r.type||"standard",loop:r.loop||"none",source:r.source||"campaign"};p(o=>({...o,countdowns:[...o.countdowns,s]}))},updateCountdown:(r,s)=>{p(o=>({...o,countdowns:o.countdowns.map(n=>n.id===r?{...n,...s}:n)}))},deleteCountdown:r=>{p(s=>({...s,countdowns:s.countdowns.filter(o=>o.id!==r)}))},advanceCountdown:(r,s)=>{p(o=>({...o,countdowns:o.countdowns.map(n=>{if(n.id!==r)return n;let i=s;if(n.loop==="loop")i>n.max?i=(i-1)%n.max+1:i<0&&(i=n.max);else if(n.loop==="increasing"){if(i>n.max)return{...n,max:n.max+1,value:1};if(i<0)return{...n,max:Math.max(1,n.max-1),value:1};i=Math.max(0,i)}else if(n.loop==="decreasing"){if(i>n.max)return{...n,max:Math.max(1,n.max-1),value:1};if(i<0)return{...n,max:n.max+1,value:1};i=Math.min(n.max,i)}else i=Math.max(0,Math.min(i,n.max));return{...n,value:i}})}))},incrementCountdown:(r,s=1)=>{p(o=>({...o,countdowns:o.countdowns.map(n=>{if(n.id!==r)return n;let i=n.value+s;if(n.loop==="loop")i>n.max&&(i=(i-1)%n.max+1);else if(n.loop==="increasing"){if(i>n.max)return{...n,max:n.max+1,value:1}}else if(n.loop==="decreasing"){if(i>n.max)return{...n,max:Math.max(1,n.max-1),value:1}}else i=Math.min(i,n.max);return{...n,value:i}})}))},decrementCountdown:r=>{p(s=>({...s,countdowns:s.countdowns.map(o=>{if(o.id!==r)return o;let n=o.value-1;if(o.loop==="loop")n<0&&(n=o.max);else if(o.loop==="increasing"){if(n<0)return{...o,max:Math.max(1,o.max-1),value:o.max};n=Math.max(0,n)}else if(o.loop==="decreasing"){if(n<0)return{...o,max:o.max+1,value:1}}else n=Math.max(0,n);return{...o,value:n}})}))},reorderCountdowns:r=>{p(s=>{const[o,n]=r,i=[...s.countdowns],[E]=i.splice(o,1);return i.splice(n,0,E),{...s,countdowns:i}})},createAdversary:r=>{var A;const s=Ce("adv"),o=a.adversaries||[],n=r.baseName||((A=r.name)==null?void 0:A.replace(/\s+\(\d+\)$/,""))||r.name||"Unknown",i=o.filter(Z=>Z.baseName===n);let E=1;if(i.length===0)E=1;else{const Z=i.map(be=>be.duplicateNumber||1);let le=1;for(;Z.includes(le);)le++;E=le}const N={...r,id:s,baseName:n,duplicateNumber:E,name:`${n} (${E})`,hp:0,stress:0,isVisible:!0};p(Z=>({...Z,adversaries:[...Z.adversaries,N]}))},createAdversariesBulk:r=>{const s=[],o={};r.forEach(n=>{var je;const i=n.baseName||((je=n.name)==null?void 0:je.replace(/\s+\(\d+\)$/,""))||n.name||"Unknown",A=(a.adversaries||[]).filter(we=>we.baseName===i).length,Z=o[i]||0,le=A+Z+1;o[i]=Z+1;const be={...n,id:Ce("adv"),baseName:i,duplicateNumber:le,name:`${i} (${le})`,hp:0,stress:0,isVisible:!0};s.push(be)}),p(n=>({...n,adversaries:[...n.adversaries,...s]}))},updateAdversary:(r,s)=>{p(o=>({...o,adversaries:o.adversaries.map(n=>{if(n.id===r){const i={...n,...s};if(s.baseName!==void 0){const E=s.baseName,N=i.duplicateNumber||1;i.name=N===1?E:`${E} (${N})`}return i}return n})}))},deleteAdversary:r=>{p(s=>({...s,adversaries:s.adversaries.filter(o=>o.id!==r)}))},clearAllAdversaries:()=>{p(r=>({...r,adversaries:[]}))},reorderAdversaries:r=>{p(s=>{const[o,n]=r,i=[...s.adversaries],[E]=i.splice(o,1);return i.splice(n,0,E),{...s,adversaries:i}})},bulkReorderAdversaries:r=>{p(s=>({...s,adversaries:r}))},createEnvironment:r=>{const s=Ce("env"),n=(a.environments||[]).filter(N=>N.name.replace(/\s+\(\d+\)$/,"")===r.name);let i=r.name||"Unknown";if(n.length===0)i=r.name;else if(n.length===1){const N=n[0],A=N.name.replace(/\s+\(\d+\)$/,""),Z=a.environments.map(le=>le.id===N.id?{...le,name:`${A} (1)`}:le);p(le=>({...le,environments:Z})),i=`${r.name} (2)`}else{const N=n.map(Z=>{const le=Z.name.match(/\((\d+)\)$/);return le?parseInt(le[1]):null}).filter(Z=>Z!==null);let A=1;for(;N.includes(A);)A++;i=`${r.name} (${A})`}const E={...r,id:s,name:i,isVisible:!0};p(N=>({...N,environments:[...N.environments,E]}))},updateEnvironment:(r,s)=>{p(o=>({...o,environments:o.environments.map(n=>n.id===r?{...n,...s}:n)}))},deleteEnvironment:r=>{p(s=>({...s,environments:s.environments.filter(o=>o.id!==r)}))},reorderEnvironments:r=>{p(s=>{const[o,n]=r,i=[...s.environments],[E]=i.splice(o,1);return i.splice(n,0,E),{...s,environments:i}})},addCustomAdversary:r=>{const s={...r,id:Ce("custom-adv"),source:r.source||"Homebrew",isCustom:!0};return x(o=>({...o,adversaries:[...o.adversaries,s]})),ke("daggerheart-custom-adversaries",[...m.adversaries,s]),s.id},addCustomEnvironment:r=>{const s={...r,id:Ce("custom-env"),source:r.source||"Homebrew",isCustom:!0};return x(o=>({...o,environments:[...o.environments,s]})),ke("daggerheart-custom-environments",[...m.environments,s]),s.id},updateCustomAdversary:(r,s)=>{x(n=>({...n,adversaries:n.adversaries.map(i=>i.id===r?{...i,...s}:i)}));const o=m.adversaries.map(n=>n.id===r?{...n,...s}:n);ke("daggerheart-custom-adversaries",o)},updateCustomEnvironment:(r,s)=>{x(n=>({...n,environments:n.environments.map(i=>i.id===r?{...i,...s}:i)}));const o=m.environments.map(n=>n.id===r?{...n,...s}:n);ke("daggerheart-custom-environments",o)},deleteCustomAdversary:r=>{x(o=>({...o,adversaries:o.adversaries.filter(n=>n.id!==r)}));const s=m.adversaries.filter(o=>o.id!==r);ke("daggerheart-custom-adversaries",s)},deleteCustomEnvironment:r=>{x(o=>({...o,environments:o.environments.filter(n=>n.id!==r)}));const s=m.environments.filter(o=>o.id!==r);ke("daggerheart-custom-environments",s)}};return e.jsx(nt.Provider,{value:h,children:t})},Le=()=>{const t=S.useContext(nt);if(!t)return console.warn("useGameState: Context not available yet, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{gameState:a,customContent:p,...d}=t;if(!a)return console.warn("useGameState: gameState not available, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],customContent:{adversaries:[],environments:[]},updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},addCustomAdversary:()=>{},addCustomEnvironment:()=>{},updateCustomAdversary:()=>{},updateCustomEnvironment:()=>{},deleteCustomAdversary:()=>{},deleteCustomEnvironment:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{fear:f,countdowns:m,adversaries:x,environments:z,partySize:u,savedEncounters:T}=a;return{gameState:a,fear:f,countdowns:m,adversaries:x,environments:z,partySize:u,savedEncounters:T,customContent:p,...d,hasCountdowns:m.length>0,hasAdversaries:x.length>0,hasEnvironments:z.length>0,getCountdownById:D=>m.find(W=>W.id===D),getAdversaryById:D=>x.find(W=>W.id===D),getEnvironmentById:D=>z.find(W=>W.id===D)}},Ke={fear:{icon:at,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"0.125rem",maxWidth:"none"},pipStyle:{fontSize:"var(--text-lg)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0,imageRendering:"crisp-edges"},filledColor:"var(--purple)",emptyColor:"var(--gray-dark)",tooltipTitle:"Click anywhere in header to adjust fear:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease fear by 1"},{text:"Right of boundary:",description:"Click to increase fear by 1"}]},hp:{icon:it,maxValue:20,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stress:{icon:lt,maxValue:12,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},countdown:{icon:Ge,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust countdown:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease countdown by 1"},{text:"Right of boundary:",description:"Click to increase countdown by 1"}]},hpDots:{maxValue:20,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--red)",borderColor:"var(--red)",boxShadow:"0 0 4px rgba(239, 68, 68, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stressDots:{maxValue:12,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--purple)",borderColor:"var(--purple)",boxShadow:"0 0 4px rgba(139, 92, 246, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},adversaryHP:{icon:et,maxValue:20,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust HP:",tooltipInstructions:[{text:"Filled pip:",description:"Click to heal (reduce damage)"},{text:"Empty pip:",description:"Click to take damage"}]},adversaryStress:{icon:dt,maxValue:12,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust stress:",tooltipInstructions:[{text:"Filled pip:",description:"Click to reduce stress"},{text:"Empty pip:",description:"Click to increase stress"}]},countdownDistributed:{icon:Ge,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Countdown progress:",tooltipInstructions:[{text:"Progress:",description:"Current countdown value"}]}},Ee=({type:t="fear",value:a=0,maxValue:p,onChange:d,size:f="lg",showTooltip:m=!0,containerStyle:x={},pipStyle:z={},countdownType:u=null,distributedGroups:T=null,onPipClick:D=null,enableBoundaryClick:W=!1,clickContainerWidth:q="auto",centerPips:j=!0})=>{const[v,C]=S.useState(!1),b=Ke[t]||Ke.fear,P=p||b.maxValue,F=Math.max(0,Math.min(P,a));let re=b.filledColor;t==="countdown"&&u&&(["progress","dynamic-progress","simple-hope"].includes(u)?re="var(--gold)":["consequence","dynamic-consequence","simple-fear"].includes(u)?re="var(--purple)":["long-term","standard"].includes(u)&&(re="var(--text-secondary)"));const I=(V,U)=>{if(D)D(V,U);else if(d){const ie=V+1;d(ie)}},oe=V=>{if(!W||!d||D)return;V.currentTarget.getBoundingClientRect();const U=V.currentTarget.querySelector(".pip-container");if(!U)return;const ie=U.getBoundingClientRect(),_=V.clientX-ie.left;if(_<0){F>0&&d(F-1);return}if(_>ie.width){F<P&&d(F+1);return}const ce=ie.width,R=ce*.05,ee=ce-2*R,y=_-R,c=F/P,k=ee*c;y<k?F>0&&d(F-1):F<P&&d(F+1)},he=(()=>{if(!T||t!=="countdownDistributed")return[{start:0,end:P,groupIndex:0}];let V=0;return T.map((U,ie)=>{const _={start:V,end:V+U,groupIndex:ie};return V+=U,_})})(),Y=()=>e.jsxs(e.Fragment,{children:[he.map(V=>e.jsx(Se.Fragment,{children:[...Array(V.end-V.start)].map((U,ie)=>{const _=V.start+ie,ce=_<F;if(b.isDots)return e.jsx("div",{style:{...b.pipStyle,...ce?b.filledStyle:b.emptyStyle,...z,cursor:d||D?"pointer":"default"},onClick:W?void 0:()=>I(_,ce),title:`${_+1} of ${P}`},_);{const R=b.icon,ee=R&&typeof R=="object"&&R.iconName,y=ce?re:b.emptyColor;return e.jsx("span",{className:`fear-pip ${ce?"filled":"empty"}`,style:{...b.pipStyle,color:y,cursor:d||D?"pointer":"default",...z},onClick:W?void 0:()=>I(_,ce),title:`${_+1} of ${P}`,children:ee?e.jsx(st,{icon:R,size:f}):e.jsx(R,{size:f==="lg"?18:16})},_)}})},V.groupIndex)),m&&e.jsx("div",{style:{position:"relative",cursor:"help",pointerEvents:"none"},children:e.jsxs("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:v?"translateX(-50%) translateY(-5px)":"translateX(-50%)",background:"rgba(15, 23, 42, 0.95)",border:"1px solid var(--gray)",borderRadius:"var(--radius-md)",padding:"var(--space-md)",minWidth:"250px",zIndex:1e3,opacity:v?1:0,visibility:v?"visible":"hidden",transition:"all 0.2s ease",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.5)"},children:[e.jsx("div",{style:{fontWeight:600,color:"var(--gray-200)",marginBottom:"0.75rem",fontSize:"var(--text-sm)"},children:b.tooltipTitle}),b.tooltipInstructions.map((V,U)=>e.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.8rem",color:"var(--gray-300)",lineHeight:1.4},children:[e.jsx("strong",{style:{color:"var(--gray-200)"},children:V.text})," ",V.description]},U))]})})]});return e.jsx("div",{style:{width:q,height:"100%",cursor:d||D?"pointer":"default",touchAction:"manipulation",userSelect:"none",display:j?"flex":"block",alignItems:j?"center":"stretch",justifyContent:j?"center":"flex-start",...x},onClick:V=>{V.stopPropagation(),V.preventDefault(),W&&oe(V)},onMouseEnter:()=>C(m),onMouseLeave:()=>C(!1),children:e.jsx("div",{className:"pip-container",style:{...b.containerStyle,width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},children:Y()})})},kt=({onToggle:t,isOpen:a})=>{const d={position:"fixed",bottom:window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://")?"calc(60px + env(safe-area-inset-bottom) + 2rem)":"calc(60px + env(safe-area-inset-bottom) + 1rem)",right:"1rem",zIndex:1100,width:"56px",height:"56px",borderRadius:"50%",background:a?"var(--red)":"var(--bg-secondary)",border:"2px solid var(--border)",color:a?"white":"var(--text-primary)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"all 0.2s ease"};return e.jsx("button",{onClick:t,style:d,title:a?"Close Encounter Builder":"Open Encounter Builder",onMouseEnter:f=>{a||(f.currentTarget.style.background="var(--purple)",f.currentTarget.style.color="white")},onMouseLeave:f=>{a||(f.currentTarget.style.background="var(--bg-secondary)",f.currentTarget.style.color="var(--text-primary)")},children:a?e.jsx(Ne,{size:24}):e.jsx(ct,{size:24})})},It=({position:t="top",children:a,onClick:p,className:d="",style:f={}})=>{const m=t==="top",x=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://"),z={background:"var(--bg-primary)",borderTop:m?"none":"1px solid var(--border)",borderBottom:m?"1px solid var(--border)":"none",padding:m?"0.25rem 0":"0.5rem",paddingBottom:m?"0.25rem":x?"calc(0.5rem + env(safe-area-inset-bottom) + 1rem)":"calc(0.5rem + env(safe-area-inset-bottom))",position:m?"relative":"sticky",[m?"top":"bottom"]:0,zIndex:m?10:100,order:m?1:3,flexShrink:0,touchAction:"manipulation",userSelect:"none",display:"flex",flexDirection:m?"column":"row",justifyContent:m?"stretch":"center",alignItems:m?"stretch":"center",gap:m?"0":"1rem",height:m?"auto":"60px",...f};return e.jsx("div",{className:d,style:z,onClick:p,children:a})},Qe=({value:t})=>e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"44px",height:"32px",zIndex:3},children:[e.jsx("svg",{width:"40",height:"32",viewBox:"0 0 40 32",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",style:{position:"absolute",zIndex:1},children:e.jsx("path",{d:"M2 2h28l6 14-6 14H2l6-14-6-14z"})}),e.jsx("span",{style:{position:"absolute",fontSize:"0.8rem",fontWeight:500,color:"var(--text-primary)",textAlign:"center",zIndex:2,left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:t})]}),Et=({type:t,tier:a,isEditMode:p,onUpdate:d,itemId:f})=>{const x=(W=>{if(!W)return 0;const j=document.createElement("canvas").getContext("2d");j.font="600 11px system-ui, -apple-system, sans-serif";const v=j.measureText(W.toUpperCase()).width;return console.log("Text measurement:",{text:W,font:j.font,width:v}),v})(t),z=4,u=18,T=Math.max(50,x+z+u),D=T+15;return p?e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",gap:"8px",height:"32px"},children:[e.jsxs("select",{value:t||"",onChange:W=>{d&&d(f,{type:W.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",outline:"none",borderRadius:"4px",padding:"4px 8px",width:"95px",height:"24px"},children:[e.jsx("option",{value:"Standard",children:"Standard"}),e.jsx("option",{value:"Solo",children:"Solo"}),e.jsx("option",{value:"Bruiser",children:"Bruiser"}),e.jsx("option",{value:"Horde",children:"Horde"}),e.jsx("option",{value:"Minion",children:"Minion"}),e.jsx("option",{value:"Ranged",children:"Ranged"}),e.jsx("option",{value:"Leader",children:"Leader"}),e.jsx("option",{value:"Skulk",children:"Skulk"}),e.jsx("option",{value:"Social",children:"Social"}),e.jsx("option",{value:"Support",children:"Support"})]}),e.jsxs("div",{style:{position:"relative",width:"24px",height:"24px"},children:[e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",width:"20px",height:"20px",backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",borderRadius:"2px"}}),e.jsx("input",{type:"text",value:a||"",onChange:W=>{const q=W.target.value.replace(/[^1-4]/g,"");q.length<=1&&d&&d(f,{tier:q===""?"":parseInt(q)})},onKeyDown:W=>{if(W.key==="ArrowUp"){W.preventDefault();const q=parseInt(a)||1;d&&d(f,{tier:Math.min(q+1,4)})}else if(W.key==="ArrowDown"){W.preventDefault();const q=parseInt(a)||1;d&&d(f,{tier:Math.max(q-1,1)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"transparent",border:"none",color:"var(--text-primary)",fontSize:"0.8rem",fontWeight:600,width:"24px",height:"24px",textAlign:"center",outline:"none",zIndex:1},maxLength:"1"})]})]}):e.jsxs("div",{style:{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"center",height:"32px",width:`${D}px`},children:[e.jsxs("svg",{width:D,height:"32",viewBox:`0 0 ${D} 32`,style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1},children:[e.jsx("rect",{x:"1",y:"6",width:T-1,height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4",ry:"4"}),e.jsx("rect",{x:T-10,y:"6",width:"20",height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"2",ry:"2",transform:`rotate(45 ${T-1} 16)`})]}),e.jsx("span",{style:{position:"absolute",top:"50%",left:"4px",transform:"translateY(-50%)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",color:"var(--text-primary)",zIndex:2,pointerEvents:"none"},children:t}),e.jsx("span",{style:{position:"absolute",top:"50%",left:`${T-.5}px`,transform:"translate(-50%, -50%)",fontSize:"0.8rem",fontWeight:600,color:"white",zIndex:2,pointerEvents:"none",textAlign:"center",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",width:"20px",height:"20px"},children:a})]})},Fe=({feature:t,featureType:a,item:p,onUpdate:d,handleFeatureDeleteClick:f,deleteConfirmations:m,getFeatureKey:x})=>{var W,q;const z=()=>{try{const v=[...(p==null?void 0:p.features)||[]],C=v.filter(P=>P.type===a),b=C.findIndex(P=>P===t);if(b>0&&b<C.length){const P=C[b],F=C[b-1];if(P&&F){const re=v.findIndex(oe=>oe===P),I=v.findIndex(oe=>oe===F);re>=0&&I>=0&&(v[re]=F,v[I]=P,d&&d(p.id,{features:v}))}}}catch(j){console.error(`Error in ${a.toLowerCase()} up button:`,j)}},u=()=>{try{const v=[...(p==null?void 0:p.features)||[]],C=v.filter(P=>P.type===a),b=C.findIndex(P=>P===t);if(b<C.length-1&&b>=0){const P=C[b],F=C[b+1];if(P&&F){const re=v.findIndex(oe=>oe===P),I=v.findIndex(oe=>oe===F);re>=0&&I>=0&&(v[re]=F,v[I]=P,d&&d(p.id,{features:v}))}}}catch(j){console.error(`Error in ${a.toLowerCase()} down button:`,j)}},T=j=>j.type===a,D=j=>j.type===a&&j.name.trim();return e.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",alignSelf:"stretch"},children:[e.jsx("button",{onClick:z,disabled:(p.features||[]).filter(T).findIndex(j=>j===t)===0,tabIndex:"-1",style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(p.features||[]).filter(D).length>=2&&(p.features||[]).filter(T).findIndex(j=>j===t)!==0&&t.name.trim()?"white":"var(--text-secondary)",cursor:(p.features||[]).filter(D).length>=2&&(p.features||[]).filter(T).findIndex(j=>j===t)!==0&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↑"}),e.jsx("button",{onClick:()=>f(t),disabled:!t.name.trim()&&!t.description.trim(),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:m[x(t)]?"var(--danger)":"var(--gray-700)",color:!t.name.trim()&&!t.description.trim()?"var(--text-secondary)":"white",cursor:!t.name.trim()&&!t.description.trim()?"not-allowed":"pointer",opacity:!t.name.trim()&&!t.description.trim()?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"×"}),e.jsx("button",{onClick:u,disabled:(p.features||[]).filter(T).findIndex(j=>j===t)===(p.features||[]).filter(T).length-1,style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(p.features||[]).filter(D).length>=2&&(p.features||[]).filter(T).findIndex(j=>j===t)<(p.features||[]).filter(T).length-1&&((W=(p.features||[]).filter(T)[(p.features||[]).filter(T).findIndex(j=>j===t)+1])!=null&&W.name.trim())&&t.name.trim()?"white":"var(--text-secondary)",cursor:(p.features||[]).filter(D).length>=2&&(p.features||[]).filter(T).findIndex(j=>j===t)<(p.features||[]).filter(T).length-1&&((q=(p.features||[]).filter(T)[(p.features||[]).filter(T).findIndex(j=>j===t)+1])!=null&&q.name.trim())&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↓"})]})},xe={transitions:{hoverIn:"all 0.1s ease",hoverOut:"all 0.3s ease"},card:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"8px",cursor:"pointer",transition:"all 0.1s ease",position:"relative"},cardHover:{backgroundColor:"var(--bg-card-hover)"},cardDead:{opacity:.6,backgroundColor:"var(--gray-800)",borderColor:"var(--border)"},cardAtMax:{backgroundColor:"var(--success)",borderColor:"var(--success)"},rowMain:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},rowTitle:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",margin:0},rowMeta:{display:"flex",gap:"8px",alignItems:"center"},badge:{padding:"2px 6px",borderRadius:"3px",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},typeBadge:{backgroundColor:"var(--purple)",color:"var(--text-primary)"},tierBadge:{backgroundColor:"var(--info)",color:"var(--text-primary)"},damageInputPopup:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,borderRadius:"8px"},damageInputContent:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"8px",padding:"8px",display:"flex",flexDirection:"row",gap:"8px",minWidth:"200px",alignItems:"center",position:"absolute",right:"1rem",top:"50%",transform:"translateY(-50%)"},damageInput:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"4px",padding:"4px 6px",color:"var(--text-primary)",fontSize:"16px",width:"80px",textAlign:"center"},damageIndicators:{display:"flex",gap:"8px",alignItems:"center",justifyContent:"center"},damageDrop:{fontSize:"16px",color:"var(--text-secondary)",cursor:"pointer",transition:"color 0.1s ease"},applyButton:{backgroundColor:"var(--gray-600)",color:"white",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"32px",minHeight:"32px"}},At=(t,a,p,d)=>{const[f,m]=S.useState(!1),[x,z]=S.useState("");S.useEffect(()=>{if(f){const j=v=>{v.target.closest(".damage-input-popup")||(m(!1),z(""))};return document.addEventListener("click",j),()=>document.removeEventListener("click",j)}},[f]);const u=j=>{j.stopPropagation(),j.preventDefault();const v=t.hp||0,C=t.hpMax||1,b=j.currentTarget.getBoundingClientRect(),P=j.clientX-b.left,F=b.width/C;Math.floor(P/F)<v?p&&p(t.id,1,t.hp):a&&a(t.id,1,t.hp,t.hpMax)},T=j=>{j.stopPropagation(),j.preventDefault();const v=t.stress||0,C=t.stressMax||1,b=j.currentTarget.getBoundingClientRect(),P=j.clientX-b.left,F=b.width/C;Math.floor(P/F)<v?d&&d(t.id,-1,t.stress,t.stressMax):d&&d(t.id,1,t.stress,t.stressMax)},D=j=>{j.stopPropagation(),(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")&&(m(!0),z(t.type==="Minion"?"1":""))},W=()=>{const j=parseInt(x);if(j>0){if(t.type==="Minion")a&&a(t.id,j,t.hp,t.hpMax);else{let v=0;j>=t.thresholds.severe?v=3:j>=t.thresholds.major?v=2:j>=1&&(v=1),a&&a(t.id,v,t.hp,t.hpMax)}m(!1),z("")}};return{showDamageInput:f,damageValue:x,setDamageValue:z,setShowDamageInput:m,handleHpClick:u,handleStressClick:T,handleDifficultyClick:D,applyDamage:W,handleKeyDown:j=>{j.key==="Enter"?W():j.key==="Escape"&&(m(!1),z(""))}}},Pe=({item:t,type:a,mode:p="expanded",onClick:d,onDelete:f,onApplyDamage:m,onApplyHealing:x,onApplyStressChange:z,onUpdate:u,adversaries:T=[],isSelected:D=!1,isEditMode:W=!1,instances:q=[],isEmbedded:j=!1})=>{const[v,C]=S.useState({}),b=y=>{const k=(t.features||[]).filter(B=>B.type===y.type).findIndex(B=>B===y);return`${y.type}-${k}-${y.name||"blank"}`},P=(y,c)=>`experience-${c}-${typeof y=="string"?y:y.name||"blank"}`,F=y=>{const c=b(y);if(v[c]){const k=t.features.filter(B=>B!==y);u&&u(t.id,{features:k}),C(B=>{const J={...B};return delete J[c],J})}else C(k=>({...k,[c]:!0})),setTimeout(()=>{C(k=>{const B={...k};return delete B[c],B})},3e3)},re=(y,c)=>{const k=P(y,c);if(v[k]){const B=[...t.experience||[]];B.splice(c,1),u&&u(t.id,{experience:B}),C(J=>{const ae={...J};return delete ae[k],ae})}else C(B=>({...B,[k]:!0})),setTimeout(()=>{C(B=>{const J={...B};return delete J[k],J})},3e3)},I=At(t,m,x,z);(a==="adversary"||a==="adversaries")&&I.handleDifficultyClick;const[oe,ue]=S.useState(!1),he=()=>{ue(!0)},Y=()=>{ue(!1)},V=(y=!1)=>{let c={...xe.card};if(D?c.transition="none":c.transition=oe?xe.transitions.hoverIn:xe.transitions.hoverOut,y){const{marginTop:k,...B}=c;c=B}return(oe&&p!=="expanded"||D)&&(c={...c,...xe.cardHover}),a==="adversary"&&(t.hp||0)>=(t.hpMax||1)&&(c={...c,...xe.cardDead}),c},U=()=>{if(j)return"";let y="border rounded-lg";return(oe&&p!=="expanded"||D)&&(y+=" border-hover"),y},ie=()=>{var y;if(a==="adversary"||a==="adversaries"){const c=t.baseName||((y=t.name)==null?void 0:y.replace(/\s+\(\d+\)$/,""))||"",k=t.duplicateNumber||1,B=[...T];return T.some(pe=>pe.id===t.id)||B.push(t),B.filter(pe=>pe.baseName===c).length>1?`${c} (${k})`:c}return t.name},_=()=>{const y=[];return t.type&&y.push(e.jsx("span",{style:{...xe.badge,...xe.typeBadge},children:t.type},"type")),y},ce=()=>a!=="adversary"||!I.showDamageInput||!(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")?null:e.jsx("div",{className:"damage-input-popup",style:xe.damageInputPopup,onClick:y=>{y.stopPropagation(),y.target===y.currentTarget&&(a==="adversary"||a==="adversaries")&&(I.setShowDamageInput(!1),I.setDamageValue(""))},children:e.jsxs("div",{className:"border rounded-lg",style:{...xe.damageInputContent,borderColor:"var(--border)"},onClick:y=>y.stopPropagation(),children:[e.jsx("input",{type:"number",inputMode:"numeric",enterKeyHint:"done",placeholder:"dmg",min:(t.type==="Minion","0"),value:a==="adversary"||a==="adversaries"?I.damageValue:"",onChange:y=>{(a==="adversary"||a==="adversaries")&&I.setDamageValue(y.target.value)},onKeyDown:a==="adversary"||a==="adversaries"?I.handleKeyDown:void 0,className:"border rounded-sm",style:{...xe.damageInput,borderColor:"var(--border)"},autoFocus:!0}),e.jsxs("div",{style:xe.damageIndicators,children:[t.type==="Minion"?(()=>{var J,ae;const y=parseInt(a==="adversary"||a==="adversaries"?I.damageValue:"0")||0,c=(J=t.features)==null?void 0:J.find(pe=>{var l;return(l=pe.name)==null?void 0:l.startsWith("Minion (")}),k=c?parseInt(((ae=c.name.match(/\((\d+)\)/))==null?void 0:ae[1])||"1"):1,B=Math.floor(y/k);return y>=k&&B>0?e.jsxs("span",{style:{...xe.damageDrop,color:"var(--red)"},title:`${y} damage can defeat ${B+1} minion${B+1!==1?"s":""} (1 + ${B} additional)`,children:["+",B," additional minion(s)"]}):e.jsx("span",{style:xe.damageDrop,title:`${y} damage defeats this minion only`,children:"+0 additional minion(s)"})})():[1,2,3].map(y=>{const c=parseInt(a==="adversary"||a==="adversaries"?I.damageValue:"0")||0;let k=!1;return y===1&&c>=1&&(k=!0),y===2&&c>=t.thresholds.major&&(k=!0),y===3&&c>=t.thresholds.severe&&(k=!0),e.jsx("span",{style:{...xe.damageDrop,color:k?"var(--red)":"var(--text-secondary)"},onClick:B=>{B.stopPropagation(),(a==="adversary"||a==="adversaries")&&(y===1?I.setDamageValue("1"):y===2?I.setDamageValue(t.thresholds.major.toString()):y===3&&I.setDamageValue(t.thresholds.severe.toString()))},title:`Click to set damage to ${y===1?"1":y===2?t.thresholds.major:t.thresholds.severe}`,children:e.jsx(et,{size:16})},y)}),e.jsx("button",{style:{...xe.applyButton,backgroundColor:"var(--gray-600)"},onClick:y=>{y.stopPropagation(),(a==="adversary"||a==="adversaries")&&(!I.damageValue||parseInt(I.damageValue)<1?(I.setShowDamageInput(!1),I.setDamageValue("")):I.applyDamage())},title:!I.damageValue||parseInt(I.damageValue)<1?"Close damage input":"Apply damage",children:!I.damageValue||parseInt(I.damageValue)<1?e.jsx(Ne,{size:16}):e.jsx(mt,{size:16})})]})]})}),R=()=>{var k,B,J,ae,pe;const y=(t.hp||0)>=(t.hpMax||1),c=p==="edit";return console.log("=== EXPANDED ADVERSARY CARD DEBUG ==="),console.log("Item data:",t),console.log("Item ID:",t.id),console.log("Item name:",t.name),console.log("Item type:",t.type),console.log("Item tier:",t.tier),console.log("Item difficulty:",t.difficulty),console.log("Item atk:",t.atk,"Type:",typeof t.atk),console.log("Item hpMax:",t.hpMax),console.log("Item stressMax:",t.stressMax),console.log("Item thresholds:",t.thresholds),console.log("Item experience:",t.experience),console.log("Item features:",t.features),console.log("Item motives:",t.motives),console.log("Item description:",t.description),console.log("Is custom?",t.isCustom||t.source==="Homebrew"),console.log("====================================="),e.jsxs("div",{className:U(),style:{...V(!0),padding:0,minHeight:"400px",opacity:y?.7:1,backgroundColor:y?"var(--gray-900)":V(!0).backgroundColor,borderColor:y?"color-mix(in srgb, var(--gray-600) 40%, transparent)":D?"var(--purple)":oe&&p!=="expanded"?"var(--border-hover)":"var(--border)",borderWidth:"2px",display:"flex",flexDirection:"column",position:"relative"},onClick:d,...p!=="expanded"&&{onMouseEnter:he,onMouseLeave:Y},children:[y&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                45deg,
                transparent,
                transparent 8px,
                var(--gray-600) 1px,
                var(--gray-600) 9px
              )`,pointerEvents:"none",zIndex:9999}})}),e.jsx("div",{className:"border-b",style:{padding:"8px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative",zIndex:y?1:"auto",borderBottomColor:D?"var(--purple)":"var(--border)"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",position:"relative",zIndex:y?1:"auto",padding:"2px",minHeight:"40px"},children:[c?e.jsx("input",{type:"text",value:t.name||"",onChange:l=>{u&&u(t.id,{name:l.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"4px",color:"var(--text-primary)",fontSize:"1.1rem",fontWeight:"600",padding:"0.5rem",width:"100%",maxWidth:"300px",paddingRight:"0.625rem"},placeholder:"Name"}):e.jsx("h4",{style:{...xe.rowTitle,color:y?"color-mix(in srgb, var(--gray-400) 80%, transparent)":xe.rowTitle.color,textAlign:"left",margin:0,fontSize:"1.1rem",paddingRight:"6px"},children:((k=t.name)==null?void 0:k.replace(/\s+\(\d+\)$/,""))||t.name}),(t.type||t.tier||c)&&e.jsx(Et,{type:t.type,tier:t.tier,isEditMode:c,onUpdate:u,itemId:t.id})]})}),e.jsxs("div",{style:{borderRadius:"0 0 8px 8px"},children:[(t.motives||c)&&e.jsx("div",{style:{padding:"0.5rem 8px",textAlign:"center"},children:c?e.jsx("input",{type:"text",value:t.motives||"",onChange:l=>u&&u(t.id,{motives:l.target.value}),placeholder:"Motives...",style:{width:"100%",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}):e.jsxs("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,textAlign:"center"},children:[t.motives,t.motives&&!t.motives.endsWith(".")?".":""]})}),(t.difficulty||t.atk!==void 0||t.thresholds&&t.type!=="Minion"||t.experience&&t.experience.length>0||c)&&e.jsxs("div",{style:{padding:"0.5rem 8px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[(t.difficulty||c)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[e.jsx(pt,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(0deg)"}}),c?e.jsx("input",{type:"text",value:t.difficulty||"",onChange:l=>{const h=l.target.value.replace(/[^0-9]/g,"");h.length<=2&&u&&u(t.id,{difficulty:parseInt(h)||0})},onKeyDown:l=>{if(l.key==="ArrowUp"){l.preventDefault();const h=parseInt(t.difficulty)||0;u&&u(t.id,{difficulty:Math.min(h+1,99)})}else if(l.key==="ArrowDown"){l.preventDefault();const h=parseInt(t.difficulty)||0;u&&u(t.id,{difficulty:Math.max(h-1,0)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"2"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:t.difficulty})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Difficulty"})]}),(t.atk!==void 0||c)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[e.jsx(ut,{size:38,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(45deg)"}}),c?e.jsx("input",{type:"text",value:(()=>{const l=typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0;return l>=0?`+${l}`:l.toString()})(),onChange:l=>{const h=l.target.value.replace(/[^0-9+\-]/g,"");if(h.length<=4){const r=parseInt(h.replace(/[^0-9\-]/g,""))||0;u&&u(t.id,{atk:r})}},onKeyDown:l=>{if(l.key==="ArrowUp"){l.preventDefault();const r=(typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0)+1;u&&u(t.id,{atk:r})}else if(l.key==="ArrowDown"){l.preventDefault();const r=(typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0)-1;u&&u(t.id,{atk:r})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"3"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:(()=>{const l=typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk;return l>=0?`+${l}`:l})()})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Attack"})]})]}),e.jsx("div",{style:{paddingTop:"0"},children:c?e.jsx("div",{style:{display:"flex",flexDirection:"column",marginTop:"-0.25rem"},children:(()=>{const l=t.experience||[],h=l.length===0?[{name:"",modifier:1}]:l;return h.map((r,s)=>{var o,n,i,E,N,A,Z,le,be,je,we,Ie,g,M,H,K,Q,w,L,$,X,te,ge,ye,me;return e.jsxs("div",{style:{position:"relative",marginBottom:"0.5rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("input",{type:"text",value:typeof r=="object"&&r.modifier>=1?`+${r.modifier}`:"+1",onChange:de=>{const O=[...t.experience||[]],se=parseInt(de.target.value.replace(/[^0-9+-]/g,""))||1,fe=Math.max(1,se);O[s]={name:typeof r=="string"?r:r.name||"",modifier:fe},u&&u(t.id,{experience:O})},onKeyDown:de=>{if(de.key==="ArrowUp"){de.preventDefault();const O=[...t.experience||[]],se=typeof r=="object"?Math.max(1,r.modifier):1;O[s]={name:typeof r=="string"?r:r.name||"",modifier:se+1},u&&u(t.id,{experience:O})}else if(de.key==="ArrowDown"){de.preventDefault();const O=[...t.experience||[]],se=typeof r=="object"?Math.max(1,r.modifier):1;O[s]={name:typeof r=="string"?r:r.name||"",modifier:Math.max(1,se-1)},u&&u(t.id,{experience:O})}},style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)",textAlign:"center",outline:"none"}})}),e.jsxs("div",{style:{marginLeft:"32px",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:typeof r=="string"?r:r.name||"",onChange:de=>{const O=[...t.experience||[]],se=typeof r=="object"?r.modifier:1;O[s]={name:de.target.value,modifier:se};const fe=O[O.length-1];fe&&fe.name.trim()&&O.push({name:"",modifier:1}),u&&u(t.id,{experience:O})},placeholder:"Experience name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsxs("div",{style:{display:"flex",gap:"0.125rem"},children:[e.jsx("button",{onClick:()=>{var ne,ve;const de=[...t.experience||[]],O=typeof r=="string"?r.trim():(ne=r.name)==null?void 0:ne.trim(),se=de[s-1],fe=typeof se=="string"?se.trim():(ve=se.name)==null?void 0:ve.trim();s>0&&s<de.length&&O&&fe&&(de[s]=se,de[s-1]=r,u&&u(t.id,{experience:de}))},disabled:s===0||!(typeof r=="string"?r.trim():(o=r.name)!=null&&o.trim())||!(typeof h[s-1]=="string"?h[s-1].trim():(n=h[s-1].name)!=null&&n.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:s===0||!(typeof r=="string"?r.trim():(i=r.name)!=null&&i.trim())||!(typeof h[s-1]=="string"?h[s-1].trim():(E=h[s-1].name)!=null&&E.trim())?"var(--gray-800)":"var(--gray-700)",color:s===0||!(typeof r=="string"?r.trim():(N=r.name)!=null&&N.trim())||!(typeof h[s-1]=="string"?h[s-1].trim():(A=h[s-1].name)!=null&&A.trim())?"var(--text-secondary)":"white",cursor:s===0||!(typeof r=="string"?r.trim():(Z=r.name)!=null&&Z.trim())||!(typeof h[s-1]=="string"?h[s-1].trim():(le=h[s-1].name)!=null&&le.trim())?"not-allowed":"pointer",opacity:s===0||!(typeof r=="string"?r.trim():(be=r.name)!=null&&be.trim())||!(typeof h[s-1]=="string"?h[s-1].trim():(je=h[s-1].name)!=null&&je.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move up",children:"↑"}),e.jsx("button",{onClick:()=>{var ne,ve;const de=[...t.experience||[]],O=typeof r=="string"?r.trim():(ne=r.name)==null?void 0:ne.trim(),se=de[s+1],fe=typeof se=="string"?se.trim():(ve=se.name)==null?void 0:ve.trim();s<de.length-1&&s>=0&&O&&fe&&(de[s]=se,de[s+1]=r,u&&u(t.id,{experience:de}))},disabled:s===h.length-1||!(typeof r=="string"?r.trim():(we=r.name)!=null&&we.trim())||!(typeof h[s+1]=="string"?h[s+1].trim():(Ie=h[s+1].name)!=null&&Ie.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:s===h.length-1||!(typeof r=="string"?r.trim():(g=r.name)!=null&&g.trim())||!(typeof h[s+1]=="string"?h[s+1].trim():(M=h[s+1].name)!=null&&M.trim())?"var(--gray-800)":"var(--gray-700)",color:s===h.length-1||!(typeof r=="string"?r.trim():(H=r.name)!=null&&H.trim())||!(typeof h[s+1]=="string"?h[s+1].trim():(K=h[s+1].name)!=null&&K.trim())?"var(--text-secondary)":"white",cursor:s===h.length-1||!(typeof r=="string"?r.trim():(Q=r.name)!=null&&Q.trim())||!(typeof h[s+1]=="string"?h[s+1].trim():(w=h[s+1].name)!=null&&w.trim())?"not-allowed":"pointer",opacity:s===h.length-1||!(typeof r=="string"?r.trim():(L=r.name)!=null&&L.trim())||!(typeof h[s+1]=="string"?h[s+1].trim():($=h[s+1].name)!=null&&$.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move down",children:"↓"}),e.jsx("button",{onClick:()=>re(r,s),disabled:!(typeof r=="string"?r.trim():(X=r.name)!=null&&X.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:v[P(r,s)]?"var(--danger)":(typeof r=="string"?r.trim():(te=r.name)!=null&&te.trim())?"var(--gray-700)":"var(--gray-800)",color:(typeof r=="string"?r.trim():(ge=r.name)!=null&&ge.trim())?"white":"var(--text-secondary)",cursor:(typeof r=="string"?r.trim():(ye=r.name)!=null&&ye.trim())?"pointer":"not-allowed",opacity:(typeof r=="string"?r.trim():(me=r.name)!=null&&me.trim())?1:.5,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:v[P(r,s)]?"Click again to confirm delete":"Delete experience",children:"×"})]})]})]},s)})})()}):e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:t.experience&&t.experience.length>0?t.experience.map((l,h)=>{if(typeof l=="string"){const r=l.match(/^(.+?)\s*([+-]?\d+)$/);if(r){const[,s,o]=r;return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:o})})}),e.jsx("span",{style:{marginLeft:"32px"},children:s})]},h)}else return e.jsx("div",{style:{marginBottom:"0.25rem"},children:l},h)}else return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:e.jsxs("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:[l.modifier>=0?"+":"",l.modifier]})})}),e.jsx("span",{style:{marginLeft:"32px"},children:l.name})]},h)}):null})})]}),(t.features&&t.features.length>0||c)&&e.jsxs("div",{style:{padding:"0 8px 8px 8px"},children:[(t.atk!==void 0&&t.weapon||c)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Standard Attack"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:c?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",marginTop:"0.75rem",marginBottom:"0.75rem"},children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[e.jsx("input",{type:"text",value:t.weapon||"",onChange:l=>u&&u(t.id,{weapon:l.target.value}),placeholder:"Standard attack name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}}),e.jsxs("select",{value:t.range||"",onChange:l=>u&&u(t.id,{range:l.target.value}),style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",appearance:"none",backgroundImage:`url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",backgroundSize:"1rem",paddingRight:"2rem"},children:[e.jsx("option",{value:""}),e.jsx("option",{value:"Melee",children:"Melee"}),e.jsx("option",{value:"Very Close",children:"Very Close"}),e.jsx("option",{value:"Close",children:"Close"}),e.jsx("option",{value:"Far",children:"Far"}),e.jsx("option",{value:"Very Far",children:"Very Far"})]}),e.jsx("input",{type:"text",value:t.damage||"",onChange:l=>u&&u(t.id,{damage:l.target.value}),placeholder:"Damage (e.g., 1d6+2)",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}})]})}):t.atk!==void 0&&t.weapon&&e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:t.weapon}),e.jsxs("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:["Make an attack against a target within ",t.range||"Melee"," range. On a success, deal ",t.damage||"damage varies","."]})]})})]}),(t.features.filter(l=>l.type==="Action").length>0||c)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Actions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const l=t.features.filter(r=>r.type==="Action");return(c&&l.length===0?[{type:"Action",name:"",description:""}]:l).map((r,s)=>c?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:r.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false","data-lpignore":"true","data-form-type":"other",name:`feature-name-${r.type.toLowerCase()}`,onChange:o=>{const n=[...t.features||[]],i=n.findIndex(A=>A.type==="Action"&&A===r);i>=0?n[i]={...n[i],name:o.target.value}:n.push({type:"Action",name:o.target.value,description:r.description||""});const E=n.filter(A=>A.type==="Action"),N=E[E.length-1];N&&N.name.trim()&&n.push({type:"Action",name:"",description:""}),u&&u(t.id,{features:n})},placeholder:"Action name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:r.description||"",onChange:o=>{const n=[...t.features||[]],i=n.findIndex(A=>A.type==="Action"&&A===r);i>=0?n[i]={...n[i],description:o.target.value}:n.push({type:"Action",name:r.name||"",description:o.target.value});const E=n.filter(A=>A.type==="Action"),N=E[E.length-1];N&&N.name.trim()&&n.push({type:"Action",name:"",description:""}),u&&u(t.id,{features:n})},onInput:o=>{const n=o.target.offsetHeight;o.target.style.height="auto";const i=o.target.scrollHeight,E=i>n?i:n;o.target.style.height=E+"px"},placeholder:"Action description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(Fe,{feature:r,featureType:"Action",item:t,onUpdate:u,handleFeatureDeleteClick:F,deleteConfirmations:v,getFeatureKey:b})]},s):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:r.name}),r.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:r.description})]},s))})()})]}),(t.features.filter(l=>l.type==="Passive").length>0||c)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Passives"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const l=t.features.filter(r=>r.type==="Passive");return(c&&l.length===0?[{type:"Passive",name:"",description:""}]:l).map((r,s)=>c?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:r.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:o=>{const n=[...t.features||[]],i=n.findIndex(A=>A.type==="Passive"&&A===r);i>=0?n[i]={...n[i],name:o.target.value}:n.push({type:"Passive",name:o.target.value,description:r.description||""});const E=n.filter(A=>A.type==="Passive"),N=E[E.length-1];N&&N.name.trim()&&n.push({type:"Passive",name:"",description:""}),u&&u(t.id,{features:n})},placeholder:"Passive name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:r.description||"",onChange:o=>{const n=[...t.features||[]],i=n.findIndex(A=>A.type==="Passive"&&A===r);i>=0?n[i]={...n[i],description:o.target.value}:n.push({type:"Passive",name:r.name||"",description:o.target.value});const E=n.filter(A=>A.type==="Passive"),N=E[E.length-1];N&&N.name.trim()&&n.push({type:"Passive",name:"",description:""}),u&&u(t.id,{features:n})},onInput:o=>{const n=o.target.offsetHeight;o.target.style.height="auto";const i=o.target.scrollHeight,E=i>n?i:n;o.target.style.height=E+"px"},placeholder:"Passive description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(Fe,{feature:r,featureType:"Passive",item:t,onUpdate:u,handleFeatureDeleteClick:F,deleteConfirmations:v,getFeatureKey:b})]},s):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:r.name}),r.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:r.description})]},s))})()})]}),(t.features.filter(l=>l.type==="Reaction").length>0||c)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Reactions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const l=t.features.filter(r=>r.type==="Reaction");return(c&&l.length===0?[{type:"Reaction",name:"",description:""}]:l).map((r,s)=>c?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:r.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:o=>{const n=[...t.features||[]],i=n.findIndex(A=>A.type==="Reaction"&&A===r);i>=0?n[i]={...n[i],name:o.target.value}:n.push({type:"Reaction",name:o.target.value,description:r.description||""});const E=n.filter(A=>A.type==="Reaction"),N=E[E.length-1];N&&N.name.trim()&&n.push({type:"Reaction",name:"",description:""}),u&&u(t.id,{features:n})},placeholder:"Reaction name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:r.description||"",onChange:o=>{const n=[...t.features||[]],i=n.findIndex(A=>A.type==="Reaction"&&A===r);i>=0?n[i]={...n[i],description:o.target.value}:n.push({type:"Reaction",name:r.name||"",description:o.target.value});const E=n.filter(A=>A.type==="Reaction"),N=E[E.length-1];N&&N.name.trim()&&n.push({type:"Reaction",name:"",description:""}),u&&u(t.id,{features:n})},onInput:o=>{const n=o.target.offsetHeight;o.target.style.height="auto";const i=o.target.scrollHeight,E=i>n?i:n;o.target.style.height=E+"px"},placeholder:"Reaction description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(Fe,{feature:r,featureType:"Reaction",item:t,onUpdate:u,handleFeatureDeleteClick:F,deleteConfirmations:v,getFeatureKey:b})]},s):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:r.name}),r.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:r.description})]},s))})()})]})]})]}),(q&&q.length>0||t.type!=="Minion"&&(t.thresholds||c))&&e.jsxs("div",{style:{padding:"0 8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Status"})]}),c?e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border)"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"number",value:t.hpMax||"",onChange:l=>{const h=parseInt(l.target.value)||1;u&&u(t.id,{hpMax:h})},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),e.jsx(Ee,{type:"adversaryHP",value:0,maxValue:t.hpMax||1,showTooltip:!1}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:"HP"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"number",value:t.stressMax||"",onChange:l=>{const h=parseInt(l.target.value)||1;u&&u(t.id,{stressMax:h})},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),e.jsx(Ee,{type:"adversaryStress",value:0,maxValue:t.stressMax||1,showTooltip:!1}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:"Stress"})]})]})})}):q&&q.length>0&&q.map((l,h)=>{const r=(l.hp||0)>=(l.hpMax||1);return e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsxs("div",{style:{backgroundColor:r?"var(--gray-900)":"var(--bg-primary)",borderRadius:"6px",padding:"0.25rem 0.5rem",border:"1px solid",borderColor:r?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",display:"flex",justifyContent:"flex-start",alignItems:"center",gap:"0.5rem",opacity:r?.7:1,position:"relative",transition:"all 0.2s ease",minHeight:"40px"},children:[r&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                          45deg,
                          transparent 0px,
                          transparent 8px,
                          var(--gray-600) 9px,
                          var(--gray-600) 9px
                        )`,pointerEvents:"none",zIndex:1,borderRadius:"4px"}})}),e.jsx("div",{style:{backgroundColor:r?"var(--gray-900)":"var(--bg-card)",border:"1px solid",borderColor:r?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",borderRadius:"50%",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",flexShrink:0,opacity:r?.5:1},children:e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:r?"var(--gray-400)":"var(--text-primary)"},children:l.duplicateNumber||1})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.125rem"},children:[e.jsx("div",{style:{opacity:r?.3:1},children:e.jsx(Ee,{type:"adversaryHP",value:l.hp||0,maxValue:l.hpMax||1,onPipClick:(s,o)=>{if(m&&a==="adversary"){const n=l.hp||0,i=l.hpMax||1;o?x&&x(l.id,1,n):n<i&&m(l.id,1,n,i)}},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})}),l.stressMax>0&&e.jsx("div",{style:{opacity:r?.3:1},children:e.jsx(Ee,{type:"adversaryStress",value:l.stress||0,maxValue:l.stressMax,onPipClick:(s,o)=>{z&&a==="adversary"&&(o?z(l.id,-1):z(l.id,1))},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})})]})]},l.id)},l.id)}),t.type!=="Minion"&&(t.thresholds||c)&&e.jsx("div",{style:{display:"flex",justifyContent:"center",paddingTop:"1px",marginTop:"0.5rem",marginBottom:"0.5rem"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",position:"relative"},children:e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",height:"36px"},children:[e.jsx("svg",{width:"300",height:"36",viewBox:"0 0 300 36",style:{position:"absolute",zIndex:1},children:e.jsx("rect",{x:"20",y:"6",width:"260",height:"24",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4"})}),e.jsx("div",{style:{position:"relative",zIndex:2,display:"flex",alignItems:"center",gap:"0.5rem"},children:c?e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",fontSize:"0.8rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),e.jsx("input",{type:"text",value:((B=t.thresholds)==null?void 0:B.major)||"7",onChange:l=>{const h=l.target.value.replace(/[^0-9]/g,"");h.length<=2&&u&&u(t.id,{thresholds:{...t.thresholds,major:parseInt(h)||7}})},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),e.jsx("input",{type:"text",value:((J=t.thresholds)==null?void 0:J.severe)||"14",onChange:l=>{const h=l.target.value.replace(/[^0-9]/g,"");h.length<=2&&u&&u(t.id,{thresholds:{...t.thresholds,severe:parseInt(h)||14}})},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),e.jsx(Qe,{value:((ae=t.thresholds)==null?void 0:ae.major)||"7"}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),e.jsx(Qe,{value:((pe=t.thresholds)==null?void 0:pe.severe)||"14"}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]})})]})})})]}),c&&e.jsxs("div",{style:{padding:"0 8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Description"})]}),c?e.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-primary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"none",overflow:"hidden",fontFamily:"inherit",marginTop:"0.75rem",marginBottom:"0.75rem"},value:t.description,onChange:l=>{l.target.style.height="auto",l.target.style.height=l.target.scrollHeight+"px",u&&u(t.id,{description:l.target.value})},placeholder:"Description..."}):e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",whiteSpace:"pre-wrap"},children:t.description})]}),ce()]})};return(p==="expanded"||p==="edit")&&(a==="adversary"||a==="adversaries")?R():a==="adversary"||a==="adversaries"?null:e.jsxs("div",{className:U(),style:V(!0),children:[e.jsxs("div",{style:xe.rowMain,children:[e.jsx("h4",{style:xe.rowTitle,children:ie()}),e.jsx("div",{style:xe.rowMeta,children:_()})]}),e.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"12px",margin:0},children:["Expanded view coming soon for ",a]})]})},zt="modulepreload",Wt=function(t){return"/Daggerheart/"+t},Ze={},Me=function(a,p,d){if(!p||p.length===0)return a();const f=document.getElementsByTagName("link");return Promise.all(p.map(m=>{if(m=Wt(m),m in Ze)return;Ze[m]=!0;const x=m.endsWith(".css"),z=x?'[rel="stylesheet"]':"";if(!!d)for(let D=f.length-1;D>=0;D--){const W=f[D];if(W.href===m&&(!x||W.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${m}"]${z}`))return;const T=document.createElement("link");if(T.rel=x?"stylesheet":zt,x||(T.as="script",T.crossOrigin=""),T.href=m,document.head.appendChild(T),x)return new Promise((D,W)=>{T.addEventListener("load",D),T.addEventListener("error",()=>W(new Error(`Unable to preload CSS for ${m}`)))})})).then(()=>a()).catch(m=>{const x=new Event("vite:preloadError",{cancelable:!0});if(x.payload=m,window.dispatchEvent(x),!x.defaultPrevented)throw m})},Mt="/Daggerheart/assets/daggerheart-logo-fe7815ad.svg",Tt=({onSelectAdversary:t,selectedAdversaryId:a,onEditAdversary:p})=>{const{customContent:d,deleteCustomAdversary:f}=Le(),[m,x]=S.useState(""),[z,u]=S.useState(null),T=S.useMemo(()=>d!=null&&d.adversaries?d.adversaries.filter(C=>{var P,F;return!m||((P=C.name)==null?void 0:P.toLowerCase().includes(m.toLowerCase()))||((F=C.type)==null?void 0:F.toLowerCase().includes(m.toLowerCase()))}):[],[d==null?void 0:d.adversaries,m]),D=S.useMemo(()=>[...T].sort((C,b)=>(C.name||"").localeCompare(b.name||"")),[T]),W=(C,b)=>{C.stopPropagation(),z===b?(f(b),u(null),a===b&&t&&t(null)):(u(b),setTimeout(()=>u(null),3e3))},q=C=>{t&&t(C.id)},j=(C,b)=>{C.stopPropagation(),p&&p(b)},v={container:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",height:"100%"},header:{padding:"1rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)",flexShrink:0},searchContainer:{position:"relative",display:"flex",alignItems:"center",gap:"0.5rem"},searchInput:{flex:1,padding:"0.5rem 2.5rem 0.5rem 2.5rem",border:"1px solid var(--border)",borderRadius:"6px",backgroundColor:"var(--bg-secondary)",color:"var(--text-primary)",fontSize:"0.875rem",outline:"none",transition:"border-color 0.2s ease"},searchIcon:{position:"absolute",left:"0.75rem",color:"var(--text-secondary)",pointerEvents:"none"},clearButton:{position:"absolute",right:"0.75rem",background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease"},tableContainer:{flex:1,overflowY:"auto",overflowX:"auto"},table:{width:"100%",borderCollapse:"collapse",fontSize:"0.875rem"},th:{position:"sticky",top:0,backgroundColor:"var(--bg-primary)",padding:"0.75rem 1rem",textAlign:"left",fontWeight:600,color:"var(--text-primary)",borderBottom:"2px solid var(--border)",whiteSpace:"nowrap",zIndex:10},td:{padding:"0.75rem 1rem",borderBottom:"1px solid var(--border)",color:"var(--text-secondary)"},row:{cursor:"pointer",transition:"background-color 0.1s ease"},actionButton:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease",borderRadius:"4px"},emptyState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"3rem 1rem",textAlign:"center",color:"var(--text-secondary)"}};return e.jsxs("div",{style:v.container,children:[e.jsxs("div",{style:v.header,children:[e.jsxs("div",{style:v.searchContainer,children:[e.jsx(xt,{size:16,style:v.searchIcon}),e.jsx("input",{type:"text",placeholder:"Search custom adversaries...",value:m,onChange:C=>x(C.target.value),style:v.searchInput}),m&&e.jsx("button",{onClick:()=>x(""),style:v.clearButton,onMouseEnter:C=>C.target.style.color="var(--text-primary)",onMouseLeave:C=>C.target.style.color="var(--text-secondary)",children:e.jsx(Ne,{size:16})})]}),e.jsxs("div",{style:{marginTop:"0.75rem",fontSize:"0.875rem",color:"var(--text-secondary)"},children:[D.length," custom ",D.length===1?"adversary":"adversaries"]})]}),e.jsx("div",{style:v.tableContainer,children:D.length===0?e.jsxs("div",{style:v.emptyState,children:[e.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem",opacity:.5},children:"📝"}),e.jsx("div",{style:{fontSize:"1rem",fontWeight:500,marginBottom:"0.5rem",color:"var(--text-primary)"},children:m?"No adversaries found":"No custom adversaries yet"}),e.jsx("div",{style:{fontSize:"0.875rem"},children:m?"Try adjusting your search":'Create your first custom adversary in the "Create Adversary" tab'})]}):e.jsxs("table",{style:v.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:v.th,children:"Name"}),e.jsx("th",{style:v.th,children:"Type"}),e.jsx("th",{style:v.th,children:"Tier"}),e.jsx("th",{style:v.th,children:"Difficulty"}),e.jsx("th",{style:v.th,children:"HP"}),e.jsx("th",{style:v.th,children:"Stress"}),e.jsx("th",{style:v.th,children:"Actions"})]})}),e.jsx("tbody",{children:D.map(C=>e.jsxs("tr",{style:{...v.row,backgroundColor:a===C.id?"var(--bg-hover)":"transparent"},onClick:()=>q(C),onMouseEnter:b=>{a!==C.id&&(b.currentTarget.style.backgroundColor="var(--bg-secondary)")},onMouseLeave:b=>{a!==C.id&&(b.currentTarget.style.backgroundColor="transparent")},children:[e.jsx("td",{style:{...v.td,fontWeight:500,color:"var(--text-primary)"},children:C.name||"Unnamed"}),e.jsx("td",{style:v.td,children:C.type||"-"}),e.jsx("td",{style:v.td,children:C.tier||"-"}),e.jsx("td",{style:v.td,children:C.difficulty||"-"}),e.jsx("td",{style:v.td,children:C.hpMax||"-"}),e.jsx("td",{style:v.td,children:C.stressMax||"-"}),e.jsxs("td",{style:{...v.td,display:"flex",gap:"0.5rem"},children:[e.jsx("button",{style:{...v.actionButton,color:"var(--text-secondary)"},onClick:b=>j(b,C),onMouseEnter:b=>{b.target.style.color="var(--purple)",b.target.style.backgroundColor="rgba(147, 51, 234, 0.1)"},onMouseLeave:b=>{b.target.style.color="var(--text-secondary)",b.target.style.backgroundColor="transparent"},title:"Edit adversary",children:e.jsx(ht,{size:16})}),e.jsx("button",{style:{...v.actionButton,backgroundColor:z===C.id?"var(--red)":"transparent",color:z===C.id?"white":"var(--text-secondary)"},onClick:b=>W(b,C.id),onMouseEnter:b=>{z!==C.id&&(b.target.style.color="var(--red)",b.target.style.backgroundColor="rgba(239, 68, 68, 0.1)")},onMouseLeave:b=>{z!==C.id&&(b.target.style.color="var(--text-secondary)",b.target.style.backgroundColor="transparent")},title:z===C.id?"Click again to confirm delete":"Delete adversary",children:e.jsx(ft,{size:16})})]})]},C.id))})]})})]})},Bt=({onSave:t,onRefresh:a,onAddItem:p,editingAdversary:d,onCancelEdit:f})=>{const[m,x]=S.useState({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:11,thresholds:{major:7,severe:12},hpMax:3,stressMax:1,atk:1,weapon:"",range:"Melee",damage:"",experience:[],features:[]}),[z,u]=S.useState(!1);Se.useEffect(()=>{x(d?{name:d.name||"",tier:d.tier||1,type:d.type||"Standard",description:d.description||"",motives:d.motives||"",difficulty:d.difficulty||11,thresholds:d.thresholds||{major:7,severe:12},hpMax:d.hpMax||3,stressMax:d.stressMax||1,atk:d.atk||1,weapon:d.weapon||"",range:d.range||"Melee",damage:d.damage||"",experience:d.experience||[],features:d.features||[]}:{name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:11,thresholds:{major:7,severe:12},hpMax:3,stressMax:1,atk:1,weapon:"",range:"Melee",damage:"",experience:[],features:[]})},[d]);const T=async()=>{if(!m.name.trim()){alert("Please enter a name for the adversary");return}u(!0);try{const W={...m,hp:d?d.hp:0,stress:d?d.stress:0,source:"Homebrew"};if(d)W.id=d.id,await t(W,d.id),alert("Adversary updated successfully!"),f&&f();else{const q=await t(W);a&&await a(),x({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:11,thresholds:{major:7,severe:12},hpMax:3,stressMax:1,atk:1,weapon:"",range:"Melee",damage:"",experience:[],features:[]}),alert("Custom adversary created successfully!")}}catch(W){console.error("Error saving adversary:",W),alert("Error saving adversary. Please try again.")}finally{u(!1)}},D={...m,id:"new-adversary",hp:0,stress:0,source:"Homebrew"};return e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem",display:"flex",justifyContent:"center",alignItems:"flex-start"},children:e.jsxs("div",{style:{maxWidth:"600px",width:"100%"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h2",{style:{color:"var(--text-primary)",fontSize:"1.5rem",fontWeight:"600",margin:0},children:d?"Edit Custom Adversary":"Create Custom Adversary"}),e.jsx("button",{onClick:T,disabled:z||!m.name.trim(),style:{padding:"0.75rem 1.5rem",backgroundColor:z||!m.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"8px",cursor:z||!m.name.trim()?"not-allowed":"pointer",fontSize:"1rem",fontWeight:"600",opacity:z||!m.name.trim()?.6:1},children:z?d?"Saving...":"Creating...":d?"Save":"Create"})]}),e.jsx(Pe,{item:D,type:"adversary",mode:"edit",onUpdate:(W,q)=>{x(j=>({...j,...q}))}})]})})},Rt=(t,a)=>{const[p,d]=S.useState("max-content"),f=S.useCallback(()=>{if(!a.current||t<=3)return"max-content";const m=a.current.offsetWidth,z=Math.floor(m/120);return z<=1?"max-content":t===4?"max-content max-content":t===5||t===6?z>=2?"max-content max-content":"max-content":t===7?z>=3?"max-content max-content max-content":z>=2?"max-content max-content":"max-content":"repeat(auto-fit, minmax(80px, max-content))"},[t,a]);return S.useEffect(()=>{const m=f();d(m);const x=new ResizeObserver(()=>{const z=f();d(z)});return a.current&&x.observe(a.current),()=>{x.disconnect()}},[f]),p},Nt=({encounter:t})=>{var f,m;const a=S.useRef(null),p=((f=t.encounterItems)==null?void 0:f.length)||0,d=Rt(p,a);return e.jsx("div",{ref:a,className:"saved-encounter-adversary-list",style:{flex:1,fontSize:"0.8rem",color:"var(--text-secondary)",lineHeight:"1.3",display:"grid",gridTemplateColumns:d,gap:"0.25rem 1rem",gridAutoRows:"min-content"},children:((m=t.encounterItems)==null?void 0:m.length)>0?t.encounterItems.map((x,z)=>{var T;const u=x.item.baseName||((T=x.item.name)==null?void 0:T.replace(/\s+\(\d+\)$/,""))||x.item.name;return e.jsxs("div",{style:{marginBottom:"0.125rem"},children:[x.quantity,"x ",u]},z)}):e.jsx("div",{children:"No adversaries"})})},Ae={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},Te={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1,lowerTierAdversary:1};let Be={adversaries:[]},Re={environments:[]},Ve=!1;const Dt=()=>{const t=JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]"),a=JSON.parse(localStorage.getItem("daggerheart-custom-environments")||"[]");return{customAdversaries:t,customEnvironments:a}},Ue=async()=>{if(Ve)return;let t={adversaries:[]},a={environments:[]},p={adversaries:[]},d={environments:[]};try{const x=await Me(()=>import("./adversaries-9c8932de.js"),[]);t=(x==null?void 0:x.default)||x}catch(x){console.warn("Failed to load adversaries.json:",x)}try{const x=await Me(()=>import("./environments-c340637c.js"),[]);a=(x==null?void 0:x.default)||x}catch(x){console.warn("Failed to load environments.json:",x)}try{const x=await Me(()=>import("./playtest-adversaries-4a099c10.js"),[]);p=(x==null?void 0:x.default)||x}catch(x){console.warn("Failed to load playtest-adversaries.json:",x)}try{const x=await Me(()=>import("./playtest-environments-d9cdffb6.js"),[]);d=(x==null?void 0:x.default)||x}catch(x){console.warn("Failed to load playtest-environments.json:",x)}const{customAdversaries:f,customEnvironments:m}=Dt();Be={...t,adversaries:[...t.adversaries||[],...p.adversaries||[],...f]},Re={...a,environments:[...a.environments||[],...d.environments||[],...m]},Ve=!0,console.log(`Loaded ${Be.adversaries.length} adversaries and ${Re.environments.length} environments`)},Lt=(t,a=[],p=4,d=1)=>{const[f,m]=S.useState(""),[x,z]=S.useState([{field:"tier",direction:"asc"},{field:"name",direction:"asc"}]),[u,T]=S.useState([]),[D,W]=S.useState(!0),[q,j]=S.useState([]),[v,C]=S.useState([]),[b,P]=S.useState(!1),[F,re]=S.useState(!1),I=S.useRef(null),oe=S.useRef(null);S.useEffect(()=>{(async()=>{await Ue(),W(!1);let k=[];t==="adversary"?k=Be.adversaries||[]:t==="environment"&&(k=Re.environments||[]),T(k)})()},[t]);const ue=S.useCallback(async()=>{Ve=!1,await Ue();let c=[];t==="adversary"?c=Be.adversaries||[]:t==="environment"&&(c=Re.environments||[]),T(c)},[t]),he=c=>{const k=u.map(B=>B[c]).filter(Boolean);return[...new Set(k)].sort((B,J)=>typeof B=="number"&&typeof J=="number"?B-J:String(B).localeCompare(String(J)))},Y=he("tier"),V=he("type"),U=S.useMemo(()=>{let c=u.filter(k=>{var pe,l;const B=k.name.toLowerCase().includes(f.toLowerCase())||((pe=k.type)==null?void 0:pe.toLowerCase().includes(f.toLowerCase()))||((l=k.description)==null?void 0:l.toLowerCase().includes(f.toLowerCase())),J=q.length===0||(q.includes("party-tier")?k.tier===d:q.includes(k.tier.toString())),ae=v.length===0||v.includes(k.type);return B&&J&&ae});return c.sort((k,B)=>{for(const J of x){const{field:ae,direction:pe}=J;let l=k[ae],h=B[ae];if(ae==="tier")l=parseInt(l)||0,h=parseInt(h)||0;else if(ae==="cost"){const r=s=>{if(t!=="adversary")return 0;const o=Ae[s.type]||2;let n=0;const i=a.filter(N=>N.type==="adversary"&&N.item.type==="Solo"&&N.quantity>0).reduce((N,A)=>N+A.quantity,0),E=a.filter(N=>N.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(N.item.type)&&N.quantity>0).reduce((N,A)=>N+A.quantity,0);return s.type==="Solo"&&i===1&&(n+=2),["Bruiser","Horde","Leader","Solo"].includes(s.type)&&E===0&&(n+=1),o+n};l=r(k),h=r(B)}else if(ae==="difficulty"){const r=parseInt(l),s=parseInt(h);!isNaN(r)&&!isNaN(s)?(l=r,h=s):!isNaN(r)&&isNaN(s)?(l=r,h=999):isNaN(r)&&!isNaN(s)?(l=999,h=s):(l=String(l||"").toLowerCase(),h=String(h||"").toLowerCase())}else typeof l=="string"&&typeof h=="string"?(l=l.toLowerCase(),h=h.toLowerCase()):(l=String(l||"").toLowerCase(),h=String(h||"").toLowerCase());if(pe==="asc"){if(l>h)return 1;if(l<h)return-1}else{if(l<h)return 1;if(l>h)return-1}}return 0}),c},[u,f,x,q,v,a,p,d]),ie=c=>{z(k=>{const B=k.findIndex(J=>J.field===c);if(B>=0)if(B===0){const J=[...k];return J[0]={...J[0],direction:J[0].direction==="asc"?"desc":"asc"},J}else{const J=[...k];return J.splice(B,1)[0],[{field:c,direction:"asc"},...J]}else return[{field:c,direction:"asc"},...k]})},_=c=>{j(c==="clear"?[]:c==="party-tier"?["party-tier"]:k=>k.includes(c)?k.filter(B=>B!==c):[...k,c])},ce=c=>{C(c==="clear"?[]:k=>k.includes(c)?k.filter(B=>B!==c):[...k,c])},R=q.length>0,ee=v.length>0;return S.useEffect(()=>{const c=B=>{const J=B.target.closest(".filter-dropdown"),ae=B.target.closest(".header-filter-icon");J||ae||(P(!1),re(!1))},k=B=>{B.key==="Escape"&&(P(!1),re(!1))};return document.addEventListener("pointerdown",c,!0),document.addEventListener("mousedown",c,!0),document.addEventListener("touchstart",c,!0),document.addEventListener("click",c,!0),document.addEventListener("keydown",k,!0),()=>{document.removeEventListener("pointerdown",c,!0),document.removeEventListener("mousedown",c,!0),document.removeEventListener("touchstart",c,!0),document.removeEventListener("click",c,!0),document.removeEventListener("keydown",k,!0)}},[P,re]),{searchTerm:f,setSearchTerm:m,sortFields:x,handleSort:ie,filteredAndSortedData:U,loading:D,refreshData:ue,selectedTiers:q,selectedTypes:v,showTierDropdown:b,setShowTierDropdown:P,showTypeDropdown:F,setShowTypeDropdown:re,tierFilterRef:I,typeFilterRef:oe,uniqueTiers:Y,uniqueTypes:V,handleTierSelect:_,handleTypeSelect:ce,isTierFiltered:R,isTypeFiltered:ee,getDropdownStyle:c=>{if(!c.current)return{};const k=c.current.getBoundingClientRect();return{position:"fixed",top:k.bottom+4,left:k.left-100,zIndex:99999}}}},Pt=({searchTerm:t,onSearchChange:a,type:p,partyControls:d})=>e.jsxs("div",{style:G.browserHeader,children:[e.jsx("input",{type:"text",placeholder:"Search",value:t,onChange:f=>a(f.target.value),style:G.searchInput}),d&&e.jsx("div",{style:G.partyControls,children:d})]}),Ht=({sortFields:t,onSort:a,type:p,uniqueTiers:d,uniqueTypes:f,selectedTiers:m,selectedTypes:x,showTierDropdown:z,setShowTierDropdown:u,showTypeDropdown:T,setShowTypeDropdown:D,tierFilterRef:W,typeFilterRef:q,handleTierSelect:j,handleTypeSelect:v,isTierFiltered:C,isTypeFiltered:b,getDropdownStyle:P,costFilter:F,showCostDropdown:re,setShowCostDropdown:I,costFilterRef:oe,handleCostFilterSelect:ue,isCostFiltered:he})=>{const[Y,V]=S.useState(null),ie=(()=>p==="adversary"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"cost",label:"Cost",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:p==="environment"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:[])(),_=()=>{if(!re)return null;const R=[{value:"all",label:"All"},{value:"auto-grey",label:"Auto Grey"},{value:"auto-hide",label:"Auto Hide"}];return Oe.createPortal(e.jsx("div",{className:"filter-dropdown",style:{...G.filterDropdown,...P(oe),maxHeight:"60vh",overflow:"auto"},onMouseDown:ee=>ee.stopPropagation(),onClick:ee=>ee.stopPropagation(),children:R.map(ee=>{const y=F===ee.value;return e.jsxs("div",{style:{...G.filterOption,...y?G.filterOptionSelected:{}},onClick:()=>ue(ee.value),children:[e.jsx("span",{style:G.checkIcon,children:y?e.jsx(ze,{size:16}):e.jsx(We,{size:16})}),e.jsx("span",{style:G.filterLabel,children:ee.label})]},ee.value)})}),document.body)},ce=(R,ee,y,c,k,B,J,ae)=>{if(!k)return null;const pe=()=>{(R==="tier"||R==="type")&&c("clear")};return Oe.createPortal(e.jsxs("div",{className:"filter-dropdown",style:{...G.filterDropdown,...P(J),maxHeight:"60vh",overflow:"auto"},onMouseDown:l=>l.stopPropagation(),onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{style:{...G.filterOption,...y.length===0?G.filterOptionSelected:{}},onClick:pe,children:[e.jsx("span",{style:G.checkIcon,children:y.length===0?e.jsx(ze,{size:16}):e.jsx(We,{size:16})}),e.jsx("span",{style:G.filterLabel,children:"All"})]}),R==="tier"&&e.jsxs("div",{style:{...G.filterOption,...y.includes("party-tier")?G.filterOptionSelected:{}},onClick:()=>c("party-tier"),children:[e.jsx("span",{style:G.checkIcon,children:y.includes("party-tier")?e.jsx(ze,{size:16}):e.jsx(We,{size:16})}),e.jsx("span",{style:G.filterLabel,children:"Party Tier"})]}),ee.map(l=>{const h=y.includes(l.toString());return e.jsxs("div",{style:{...G.filterOption,...h?G.filterOptionSelected:{}},onClick:()=>c(l.toString()),children:[e.jsx("span",{style:G.checkIcon,children:h?e.jsx(ze,{size:16}):e.jsx(We,{size:16})}),e.jsx("span",{style:G.filterLabel,children:l})]},l)})]}),document.body)};return e.jsx("tr",{style:G.tableHeader,children:ie.map(R=>e.jsxs("th",{style:{...G.tableHeaderCell,...Y===R.key?G.tableHeaderCellHover:{},position:"relative",...R.key==="name"?{width:"auto",minWidth:"0"}:{},...R.key==="tier"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...R.key==="type"?{width:"80px",minWidth:"80px",maxWidth:"80px"}:{},...R.key==="difficulty"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...R.key==="cost"?{width:"50px",minWidth:"50px",maxWidth:"50px"}:{},...R.key==="action"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{}},onClick:()=>a(R.key),onMouseEnter:()=>V(R.key),onMouseLeave:()=>V(null),children:[R.hasFilter?e.jsxs("div",{style:G.headerWithFilter,children:[e.jsx("span",{style:{cursor:"pointer"},onClick:ee=>{ee.stopPropagation(),a(R.key)},children:R.label}),e.jsxs("button",{ref:R.key==="tier"?W:R.key==="type"?q:oe,style:{...G.headerFilterIcon,...R.key==="tier"&&C?G.headerFilterIconActive:{},...R.key==="type"&&b?G.headerFilterIconActive:{},...R.key==="cost"&&he?G.headerFilterIconActive:{}},className:"header-filter-icon",onClick:ee=>{ee.stopPropagation(),R.key==="tier"?(u(!z),D(!1),I(!1)):R.key==="type"?(D(!T),u(!1),I(!1)):R.key==="cost"&&(I(!re),u(!1),D(!1))},children:[e.jsx(gt,{size:14}),R.key==="tier"&&C||R.key==="type"&&b||R.key==="cost"&&he?e.jsx("span",{style:G.filterActiveDot}):null]})]}):R.label,R.key==="tier"&&ce("tier",d,m,j,z,u,W),R.key==="type"&&ce("type",f,x,v,T,D,q),R.key==="cost"&&_()]},R.key))})},Ft=({item:t,onAdd:a,type:p,onRowClick:d,encounterItems:f=[],pcCount:m=4,playerTier:x=1,remainingBudget:z=0,costFilter:u="auto-grey",onAdversaryClick:T})=>{const[D,W]=S.useState(!1),q=()=>{a(t)},j=()=>{if(p!=="adversary")return null;const b=Ae[t.type]||2;let P=0;const F=f.filter(I=>I.type==="adversary"&&I.item.type==="Solo"&&I.quantity>0).reduce((I,oe)=>I+oe.quantity,0),re=f.filter(I=>I.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(I.item.type)&&I.quantity>0).reduce((I,oe)=>I+oe.quantity,0);return t.type==="Solo"&&F===1&&(P+=2),["Bruiser","Horde","Leader","Solo"].includes(t.type)&&re===0&&(P+=1),b+P},C=(()=>{if(p==="adversary"){const b=j();Ae[t.type];const P=b>z||z<=0;if(u==="auto-hide"&&P)return null;const F=u==="auto-grey"&&P?{opacity:.5,color:"var(--text-secondary)"}:{};return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...G.rowCell,width:"auto",minWidth:"0",textAlign:"left",...F},children:e.jsxs("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:[e.jsx("div",{style:{fontWeight:"600"},children:t.name}),t.description&&e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"0.125rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.description})]})}),e.jsx("td",{style:{...G.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...F},children:t.tier}),e.jsx("td",{style:{...G.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center",...F},children:t.type}),e.jsx("td",{style:{...G.rowCell,width:"50px",minWidth:"50px",maxWidth:"50px",textAlign:"center",...F},children:b}),e.jsx("td",{style:{...G.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...F},children:t.difficulty})]})}else if(p==="environment")return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...G.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:t.name}),e.jsx("td",{style:{...G.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:t.tier}),e.jsx("td",{style:{...G.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:t.type}),e.jsx("td",{style:{...G.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:t.difficulty})]});return null})();return C===null?null:e.jsx(e.Fragment,{children:e.jsxs("tr",{style:{...G.row,...D?G.rowHover:{}},onClick:()=>{p==="adversary"&&T?T(t):d&&d(t,p)},onMouseEnter:()=>W(!0),onMouseLeave:()=>W(!1),children:[C,e.jsx("td",{style:{width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",boxSizing:"border-box",overflow:"visible",textOverflow:"unset",whiteSpace:"nowrap"},children:e.jsx("button",{style:G.addButton,onClick:b=>{b.stopPropagation(),q()},onMouseEnter:b=>{b.target.style.background="var(--bg-secondary)"},onMouseLeave:b=>{b.target.style.background="var(--purple)"},children:"+"})})]})})},$t=({type:t,onAddItem:a,onCancel:p=null,onRowClick:d,encounterItems:f=[],pcCount:m=4,playerTier:x=1,partyControls:z=null,showContainer:u=!0,savedEncounters:T=[],onLoadEncounter:D,onDeleteEncounter:W,activeTab:q="adversaries",selectedCustomAdversaryId:j,onSelectCustomAdversary:v,onTabChange:C})=>{const{addCustomAdversary:b,updateCustomAdversary:P}=Le(),[F,re]=S.useState(null),[I,oe]=S.useState("all"),[ue,he]=S.useState(!1),[Y,V]=S.useState(null),[U,ie]=S.useState({}),_=S.useRef({}),ce=S.useRef(null),R=w=>{re(w),C&&C("create")},ee=()=>{re(null)},y=async(w,L)=>{L?P(L,w):b(w)},c=w=>{U[w]?(W&&W(w),ie(L=>{const $={...L};return delete $[w],$}),_.current[w]&&(clearTimeout(_.current[w]),delete _.current[w])):(ie(L=>({...L,[w]:!0})),_.current[w]&&clearTimeout(_.current[w]),_.current[w]=setTimeout(()=>{ie(L=>{const $={...L};return delete $[w],$}),delete _.current[w]},3e3))};S.useEffect(()=>()=>{Object.values(_.current).forEach(w=>{clearTimeout(w)})},[]);const{searchTerm:k,setSearchTerm:B,sortFields:J,handleSort:ae,filteredAndSortedData:pe,loading:l,refreshData:h,selectedTiers:r,selectedTypes:s,showTierDropdown:o,setShowTierDropdown:n,showTypeDropdown:i,setShowTypeDropdown:E,tierFilterRef:N,typeFilterRef:A,uniqueTiers:Z,uniqueTypes:le,handleTierSelect:be,handleTypeSelect:je,isTierFiltered:we,isTypeFiltered:Ie,getDropdownStyle:g}=Lt(t,f,m,x),H=(()=>{const w=3*m+2,L=f.reduce((O,se)=>{if(se.type==="adversary"){const fe=Ae[se.item.type]||2;if(se.item.type==="Minion"){const ne=Math.ceil(se.quantity/m);return O+ne*fe}else return O+se.quantity*fe}return O},0);let $=0;f.filter(O=>O.type==="adversary"&&O.item.type==="Solo"&&O.quantity>0).reduce((O,se)=>O+se.quantity,0)>=2&&($+=Te.twoOrMoreSolos);const te=f.some(O=>O.type==="adversary"&&O.item.type==="Bruiser"&&O.quantity>0),ge=f.some(O=>O.type==="adversary"&&O.item.type==="Horde"&&O.quantity>0),ye=f.some(O=>O.type==="adversary"&&O.item.type==="Leader"&&O.quantity>0),me=f.some(O=>O.type==="adversary"&&O.item.type==="Solo"&&O.quantity>0);return!te&&!ge&&!ye&&!me&&($+=Te.noBruisersHordesLeadersSolos),w+$-L})(),K=w=>{oe(w),he(!1)},Q=I!=="all";return l?e.jsx("div",{style:G.browser,children:e.jsx("div",{style:G.loading,children:"Loading..."})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:u?G.browserWrapper:G.browserWrapperNoContainer,children:[q==="adversaries"&&e.jsxs(e.Fragment,{children:[e.jsx(Pt,{searchTerm:k,onSearchChange:B,type:t,partyControls:z}),e.jsx("div",{className:"browser-content invisible-scrollbar",style:G.browserContent,children:e.jsxs("table",{style:G.browserTable,children:[e.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,backgroundColor:"var(--bg-primary)"},children:e.jsx(Ht,{sortFields:J,onSort:ae,type:t,uniqueTiers:Z,uniqueTypes:le,selectedTiers:r,selectedTypes:s,showTierDropdown:o,setShowTierDropdown:n,showTypeDropdown:i,setShowTypeDropdown:E,tierFilterRef:N,typeFilterRef:A,handleTierSelect:be,handleTypeSelect:je,isTierFiltered:we,isTypeFiltered:Ie,getDropdownStyle:g,costFilter:I,showCostDropdown:ue,setShowCostDropdown:he,costFilterRef:ce,handleCostFilterSelect:K,isCostFiltered:Q})}),e.jsx("tbody",{children:pe.map(w=>e.jsx(Ft,{item:w,onAdd:a,type:t,onRowClick:d,encounterItems:f,pcCount:m,playerTier:x,remainingBudget:H,costFilter:I,onAdversaryClick:L=>{t==="adversary"&&V(L)}},w.id))})]})})]}),q==="encounters"&&e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:T.length===0?e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",textAlign:"center",padding:"2rem 1rem"},children:"No saved encounters yet"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:T.map(w=>e.jsxs("div",{onClick:()=>D&&D(w.id),className:"saved-encounter-card",style:{border:"1px solid var(--border)",borderRadius:"8px",padding:"8px",backgroundColor:"var(--bg-card)",transition:"background-color 0.2s ease",display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsxs("div",{style:{minWidth:"100px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",flexDirection:"column",justifyContent:"center",minHeight:"60px"},children:[e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Tier: ",(()=>{var X,te,ge,ye;const L=((ye=(ge=(te=(X=w.encounterItems)==null?void 0:X.filter(me=>me.type==="adversary"))==null?void 0:te.map(me=>me.item.tier))==null?void 0:ge.filter(me=>me!=null))==null?void 0:ye.sort((me,de)=>me-de))||[];if(L.length===0)return"N/A";if(L.length===1)return L[0];const $=[...new Set(L)];return $.length===1?$[0]:`${Math.min(...$)}-${Math.max(...$)}`})()]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Party Size: ",w.partySize||4]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)"},children:["Balance: ",(()=>{const L=w.partySize||4,$=3*L+2;let X=0;const te=w.encounterItems||[];te.filter(ne=>ne.type==="adversary"&&ne.item.type==="Solo"&&ne.quantity>0).reduce((ne,ve)=>ne+ve.quantity,0)>=2&&(X+=Te.twoOrMoreSolos);const ye=te.some(ne=>ne.type==="adversary"&&ne.item.type==="Bruiser"&&ne.quantity>0),me=te.some(ne=>ne.type==="adversary"&&ne.item.type==="Horde"&&ne.quantity>0),de=te.some(ne=>ne.type==="adversary"&&ne.item.type==="Leader"&&ne.quantity>0),O=te.some(ne=>ne.type==="adversary"&&ne.item.type==="Solo"&&ne.quantity>0);!ye&&!me&&!de&&!O&&(X+=Te.noBruisersHordesLeadersSolos);const se=$+X,fe=te.reduce((ne,ve)=>{if(ve.type==="adversary"){const _e=Ae[ve.item.type]||2;if(ve.item.type==="Minion"){const ot=Math.ceil(ve.quantity/L);return ne+ot*_e}else return ne+ve.quantity*_e}return ne},0);return fe>se?`+${fe-se}`:fe===se?"0":`-${se-fe}`})()]})]}),e.jsx("div",{style:{minWidth:"120px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",alignItems:"center",minHeight:"60px"},children:e.jsx("div",{style:{fontWeight:"500",color:"var(--text-primary)",fontSize:"0.9rem",wordWrap:"break-word",wordBreak:"break-word",width:"150px",maxWidth:"150px"},children:w.name})}),e.jsx(Nt,{encounter:w}),e.jsx("button",{onClick:L=>{L.stopPropagation(),c(w.id)},style:{background:U[w.id]?"var(--danger)":"var(--gray-600)",border:"none",color:"white",padding:"0.4rem 0.8rem",borderRadius:"4px",fontSize:"0.75rem",cursor:"pointer",minWidth:"60px",transition:"background-color 0.2s"},children:"Delete"})]},w.id))})}),q==="create"&&e.jsx(Bt,{onSave:y,onRefresh:()=>{},onAddItem:a,editingAdversary:F,onCancelEdit:ee}),q==="myAdversaries"&&e.jsx(Tt,{selectedAdversaryId:j,onSelectAdversary:v,onEditAdversary:R}),q==="info"&&e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"2rem"},children:[e.jsxs("div",{style:{marginBottom:"2rem",textAlign:"center"},children:[e.jsx("img",{src:Mt,alt:"Daggerheart Community Content Logo",style:{width:"100%",maxWidth:"300px",height:"auto",margin:"0 auto 1.5rem auto",display:"block"},onError:w=>{console.error("Failed to load Daggerheart logo:",w.target.src),w.target.style.display="none"}}),e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",textAlign:"left",maxWidth:"600px",margin:"0 auto"},children:[e.jsx("p",{style:{marginTop:0},children:"This product includes materials from the Daggerheart System Reference Document 1.0, © Critical Role, LLC, under the terms of the Darrington Press Community Gaming (DPCGL) License."}),e.jsxs("p",{children:["More information can be found at ",e.jsx("a",{href:"https://www.daggerheart.com",target:"_blank",rel:"noopener noreferrer",style:{color:"var(--purple)",textDecoration:"underline"},children:"daggerheart.com"})]}),e.jsx("p",{style:{marginBottom:0},children:e.jsx("em",{children:"This project is unofficial and not endorsed by Darrington Press or Critical Role."})})]})]}),e.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto",border:"1px solid var(--border)",borderRadius:"8px",overflow:"hidden"},children:[e.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"1rem 1.5rem",color:"var(--text-primary)",border:"none",background:"var(--bg-secondary)",width:"100%",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"0.875rem",borderBottom:"1px solid var(--border)"},onMouseEnter:w=>{w.target.style.backgroundColor="var(--bg-hover)"},onMouseLeave:w=>{w.target.style.backgroundColor="var(--bg-secondary)"},onClick:w=>{w.stopPropagation(),window.open("https://github.com/Splinter714/Daggerheart","_blank")},children:[e.jsx("span",{children:"View on GitHub"}),e.jsx("span",{children:"→"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem 1.5rem",color:"var(--text-secondary)",background:"var(--bg-secondary)",fontSize:"0.875rem"},children:["Version ","0.4.0 (58324ff)"]})]})]})]}),Y&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:2e3,display:"flex",alignItems:"center",justifyContent:"center",padding:"2rem"},onClick:()=>V(null),children:e.jsx("div",{style:{maxWidth:"600px",width:"90vw",maxHeight:"80vh",overflowY:"auto"},onClick:w=>w.stopPropagation(),children:e.jsx(Pe,{item:Y,type:"adversary",mode:"expanded",onClose:()=>V(null)})})})]})},G={browserWrapper:{display:"flex",flexDirection:"column",background:"var(--bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border)",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserWrapperNoContainer:{display:"flex",flexDirection:"column",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserContent:{flex:1,overflowY:"auto",overflowX:"visible",padding:0,width:"100%",scrollbarWidth:"none",msOverflowStyle:"none"},tableHeaderContainer:{flexShrink:0,position:"sticky",top:0,zIndex:15,backgroundColor:"var(--bg-secondary)"},browserTable:{width:"100%",minWidth:"100%",borderCollapse:"collapse",tableLayout:"fixed",background:"var(--bg-primary)",margin:0},browserHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--gray-900)",flexShrink:0,position:"sticky",top:0,zIndex:20},browserTitle:{margin:0,color:"var(--text-primary)",fontSize:"18px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"24px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",marginRight:"12px",transition:"all 0.2s ease"},partyControls:{display:"flex",alignItems:"center",gap:"12px",flexShrink:0},searchInputFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 3px rgba(139, 92, 246, 0.1)"},tableHeader:{background:"var(--gray-900)",borderBottom:"1px solid var(--border)",boxShadow:"0 1px 0 var(--border)",position:"sticky",top:"0",zIndex:10},tableHeaderCell:{backgroundColor:"var(--gray-900)",fontWeight:"700",borderBottom:"1px solid var(--border)",cursor:"pointer",userSelect:"none",minWidth:"100px",whiteSpace:"nowrap",padding:"4px 4px",color:"var(--text-primary)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",boxShadow:"0 1px 0 var(--border)",transition:"background-color 0.2s",position:"sticky",top:"0",zIndex:10},tableHeaderCellHover:{backgroundColor:"var(--bg-hover)"},sortIndicator:{fontSize:"12px",color:"var(--text-secondary)"},tableBody:{flex:1,overflowY:"auto",padding:"8px",backgroundColor:"var(--bg-primary)"},row:{height:"35px",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s ease",cursor:"pointer",backgroundColor:"var(--gray-900)"},rowHover:{backgroundColor:"var(--bg-secondary)"},expandedRow:{backgroundColor:"var(--bg-secondary)"},rowCell:{padding:"4px 4px",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid var(--border)"},rowCellName:{fontWeight:"500",minWidth:"150px"},rowCellCenter:{textAlign:"center",justifyContent:"center",minWidth:"80px"},rowActions:{width:"80px",textAlign:"center",padding:"4px 8px",borderBottom:"1px solid var(--border)"},addButton:{width:"2rem",height:"2rem",border:"1px solid var(--purple)",borderRadius:"var(--radius-sm)",background:"var(--purple)",color:"white",cursor:"pointer",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"500"},expandedContent:{padding:"0",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)"},columnName:{width:"auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",paddingLeft:"8px",textAlign:"left"},columnTier:{width:"80px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnType:{width:"100px",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},columnDifficulty:{width:"40px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnAction:{width:"32px",minWidth:"24px",maxWidth:"24px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"visible",textOverflow:"unset"},loading:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"var(--text-primary)",fontSize:"16px"},mobileBrowser:{width:"95vw",height:"90vh",maxWidth:"none"},mobileSearchInput:{fontSize:"16px"},headerWithFilter:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0px",position:"relative"},headerFilterIcon:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"2px 4px",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",position:"relative",marginLeft:"-2px"},headerFilterIconActive:{color:"var(--purple)"},filterIcon:{fontSize:"12px"},filterActiveDot:{position:"absolute",left:"50%",top:"2px",transform:"translateX(-50%)",width:"4px",height:"4px",borderRadius:"50%",background:"var(--purple)",pointerEvents:"none"},filterDropdown:{position:"fixed",background:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",zIndex:99999,marginTop:"4px",overflow:"hidden",width:"max-content",minWidth:"120px",maxWidth:"200px"},filterOption:{padding:"8px 12px",cursor:"pointer",color:"var(--text-primary)",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background-color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},filterOptionSelected:{backgroundColor:"var(--bg-hover)"},checkIcon:{width:"16px",height:"16px",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"12px"},filterLabel:{flex:1}},Ot=()=>e.jsx("div",{className:"pwa-install-prompt",style:{}}),qt=({side:t="left",children:a,className:p="",style:d={}})=>{const f=t==="left",m={flex:1,minWidth:0,background:"var(--bg-primary)",overflowY:"auto",overflowX:f?"auto":"hidden",display:f?"block":"flex",flexDirection:f?"initial":"column",height:"100%",padding:f?"8px 0 8px 0":"0 8px 0 0",...d};return e.jsx("div",{className:p,style:m,children:a})},Vt=t=>3*t+2,_t={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},$e={lessDifficult:-1,twoOrMoreSolos:-2,increasedDamage:-2,lowerTierAdversary:1,noBruisersHordesLeadersSolos:1,moreDangerous:2},Gt=({isOpen:t,onClose:a,onAddAdversary:p,onAddAdversariesBulk:d,onAddEnvironment:f,onDeleteAdversary:m,onDeleteEnvironment:x,onDeleteCountdown:z,adversaries:u=[],environments:T=[],countdowns:D=[],savedEncounters:W=[],onSaveEncounter:q,onLoadEncounter:j,onDeleteEncounter:v})=>{const{partySize:C,updatePartySize:b,currentEncounterName:P,updateCurrentEncounterName:F,customContent:re}=Le(),I=C,oe=b,[ue,he]=S.useState({lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),[Y,V]=S.useState([]),[U,ie]=S.useState(P||"Encounter"),[_,ce]=S.useState("adversaries"),[R,ee]=S.useState(null),[y,c]=S.useState(null),[k,B]=S.useState(null);S.useEffect(()=>{t&&!R&&ie(P||"Encounter")},[t,R,P]);const J=()=>y?U!==y.name||JSON.stringify(Y)!==JSON.stringify(y.encounterItems)||I!==y.partySize||JSON.stringify(ue)!==JSON.stringify(y.battlePointsAdjustments):!1,ae=()=>{var g;if(Y.length>0||(U||"").trim()!=="Encounter")return!0;if(R&&J()){if(y){const M=Y.length,H=((g=y.encounterItems)==null?void 0:g.length)||0;if(M!==H||(U||"").trim()!==(y.name||""))return!0;const K=JSON.stringify(ue),Q=JSON.stringify(y.battlePointsAdjustments||{});return K!==Q}return!0}return!1},pe=({onClick:g,children:M,variant:H="secondary",isConfirmation:K=!1})=>{const Q=H==="danger"||H==="secondary"&&K,w=H==="purple";return e.jsx("button",{onClick:g,style:{background:Q?"var(--danger)":w?"var(--purple)":"var(--bg-secondary)",border:w?"none":"1px solid var(--border)",color:Q||w?"white":"var(--text-primary)",padding:"0.375rem 0.75rem",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s",width:"70px",fontSize:"0.875rem"},children:M})},l=Se.useRef(I),h=S.useCallback(g=>!g||g.length===0?null:W.find(H=>{var L,$;if(((L=H.encounterItems)==null?void 0:L.length)!==g.length)return!1;const K=X=>{var te;return{type:X.type,quantity:X.quantity,item:{name:X.item.baseName||((te=X.item.name)==null?void 0:te.replace(/\s+\(\d+\)$/,""))||X.item.name,type:X.item.type,tier:X.item.tier}}},Q=($=H.encounterItems)==null?void 0:$.map(K).sort((X,te)=>X.item.name.localeCompare(te.item.name)||X.item.type.localeCompare(te.item.type)),w=g.map(K).sort((X,te)=>X.item.name.localeCompare(te.item.name)||X.item.type.localeCompare(te.item.type));return JSON.stringify(Q)===JSON.stringify(w)})||null,[W]);Se.useEffect(()=>{if(t&&u.length>0&&Y.length===0){const g={};u.forEach(K=>{var w;const Q=K.baseName||((w=K.name)==null?void 0:w.replace(/\s+\(\d+\)$/,""))||K.name;g[Q]||(g[Q]={type:"adversary",item:K,quantity:0}),g[Q].quantity+=1});const M=Object.values(g);V(M);const H=h(M);H&&!R&&(ee(H.id),c({name:H.name||"",encounterItems:H.encounterItems||[],partySize:H.partySize||4,battlePointsAdjustments:H.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),ie(H.name||"Encounter"),F(H.name||"Encounter"))}else t&&u.length===0&&Y.length===0&&V([])},[t,h,R,F]);const r=Se.useMemo(()=>{let g=0;Y.filter(L=>L.type==="adversary"&&L.item.type==="Solo"&&L.quantity>0).reduce((L,$)=>L+$.quantity,0)>=2&&(g+=$e.twoOrMoreSolos);const H=Y.some(L=>L.type==="adversary"&&L.item.type==="Bruiser"&&L.quantity>0),K=Y.some(L=>L.type==="adversary"&&L.item.type==="Horde"&&L.quantity>0),Q=Y.some(L=>L.type==="adversary"&&L.item.type==="Leader"&&L.quantity>0),w=Y.some(L=>L.type==="adversary"&&L.item.type==="Solo"&&L.quantity>0);return!H&&!K&&!Q&&!w&&(g+=$e.noBruisersHordesLeadersSolos),g},[Y]),s=Vt(I),o=Object.entries(ue).filter(([g,M])=>M).reduce((g,[M,H])=>g+$e[M],0),n=s+o+r,i=Y.reduce((g,M)=>{if(M.type==="adversary"){const H=_t[M.item.type]||2;return M.item.type==="Minion"?g+Math.ceil(M.quantity/I)*H:g+H*M.quantity}return g},0);Se.useEffect(()=>{const g=l.current;g!==I&&(V(M=>M.map(H=>{if(H.type==="adversary"&&H.item.type==="Minion"){const Q=Math.ceil(H.quantity/g)*I;return{...H,quantity:Q}}return H})),l.current=I)},[I]);const E=(g,M)=>{const H=Y.findIndex(w=>w.item.id===g.id&&w.type===M),K=g.type==="Minion"?I:1;let Q;H>=0?Q=Y.map((w,L)=>L===H?{...w,quantity:w.quantity+K}:w):Q=[...Y,{item:g,type:M,quantity:K}],V(Q),N(Q)},N=g=>{const M=u||[],H=[];g.forEach($=>{for(let X=0;X<$.quantity;X++)$.type==="adversary"&&H.push($.item)});const K={};M.forEach($=>{var te;const X=$.baseName||((te=$.name)==null?void 0:te.replace(/\s+\(\d+\)$/,""))||$.name;K[X]||(K[X]=[]),K[X].push($)});const Q={};H.forEach($=>{var te;const X=$.baseName||((te=$.name)==null?void 0:te.replace(/\s+\(\d+\)$/,""))||$.name;Q[X]||(Q[X]=[]),Q[X].push($)});const w=[],L=[];Object.keys(Q).forEach($=>{var ge;const X=((ge=K[$])==null?void 0:ge.length)||0,te=Q[$].length;if(te>X){const ye=te-X;for(let me=0;me<ye;me++)w.push(Q[$][0])}else if(te<X){const ye=X-te,de=[...K[$]].sort((O,se)=>{const fe=O.duplicateNumber||1;return(se.duplicateNumber||1)-fe});for(let O=0;O<ye;O++)L.push(de[O].id)}}),Object.keys(K).forEach($=>{Q[$]||[...K[$]].sort((ge,ye)=>{const me=ge.duplicateNumber||1;return(ye.duplicateNumber||1)-me}).forEach(ge=>{L.push(ge.id)})}),L.forEach($=>{m($)}),w.length>0&&d(w)},A=(g,M)=>{const H=(()=>{const K=Y.findIndex(Q=>Q.item.id===g&&Q.type===M);if(K>=0){const Q=Y[K];if(Q.quantity===0)return Y.filter(($,X)=>X!==K);const w=Q.item.type==="Minion"?I:1,L=Math.max(0,Q.quantity-w);return Y.map(($,X)=>X===K?{...$,quantity:L}:$)}return Y})();V(H),N(H)},Z=S.useCallback(()=>{if(Y.length===0)return null;const g=(U||"").trim()||"Encounter",M=W.find(H=>{var w,L;if(H.name!==g||((w=H.encounterItems)==null?void 0:w.length)!==Y.length)return!1;const K=JSON.stringify((L=H.encounterItems)==null?void 0:L.sort()),Q=JSON.stringify([...Y].sort());return K===Q});return(M==null?void 0:M.id)||null},[W,U,Y]),le=S.useCallback(()=>{let g=(U||"").trim(),M=R;if(M||(M=Z()),Y.length===0&&(!g||g==="Encounter")&&M){v(M),ee(null),c(null);return}const H={name:g,encounterItems:Y,partySize:I,battlePointsAdjustments:ue};if(M){H.id=M;const K=q(H);ee(K)}else{const K=q(H);ee(K)}c({name:g,encounterItems:Y,partySize:I,battlePointsAdjustments:ue})},[Y,U,I,ue,R,q,Z,v]);S.useEffect(()=>{if(R&&J()){const g=setTimeout(()=>{le()},2e3);return()=>clearTimeout(g)}else if(!R&&Y.length>0&&U&&U.trim()!==""){const g=setTimeout(()=>{le()},2e3);return()=>clearTimeout(g)}},[Y,R,U,ue,I]);const be=()=>{ae()&&(V([]),ie("Encounter"),F("Encounter"),ee(null),c(null),u.forEach(g=>{m(g.id)}),T.forEach(g=>{x(g.id)}),D.forEach(g=>{z(g.id)}))},je=g=>{const M=j(g);if(M){const H=M.encounterItems||[];V(H),oe(M.partySize||4),he(M.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),ie(M.name||""),F(M.name||""),ee(g),c({name:M.name||"",encounterItems:M.encounterItems||[],partySize:M.partySize||4,battlePointsAdjustments:M.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),N(H)}},we=g=>{v(g),R===g&&(V([]),ie("Encounter"),F("Encounter"),ee(null),c(null),u.forEach(M=>{m(M.id)}),T.forEach(M=>{x(M.id)}),D.forEach(M=>{z(M.id)}))};if(!t)return null;const Ie=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://");return e.jsx("div",{onClick:a,className:"encounter-builder-modal",style:{position:"fixed",top:0,left:0,right:0,bottom:Ie?"calc(60px + env(safe-area-inset-bottom) + 1rem)":"calc(60px + env(safe-area-inset-bottom))",backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:1e3,display:"flex",alignItems:"flex-start",justifyContent:"center",padding:"12px"},children:e.jsxs("div",{onClick:g=>g.stopPropagation(),style:{backgroundColor:"var(--bg-primary)",border:"2px solid var(--border)",borderRadius:"12px",width:"100%",maxWidth:"1200px",height:"100%",maxHeight:"100%",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"},children:[e.jsxs("div",{className:"encounter-top-bar",style:{flex:"0 0 auto",display:"flex",alignItems:"center",height:"39px",backgroundColor:"var(--bg-primary)",borderBottom:"1px solid var(--border)"},children:[e.jsx("button",{onClick:()=>ce("adversaries"),style:{flex:1,background:_==="adversaries"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:_==="adversaries"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Adversary Browser"}),e.jsx("button",{onClick:()=>ce("encounters"),style:{flex:1,background:_==="encounters"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:_==="encounters"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Saved Encounters"}),e.jsx("button",{onClick:()=>ce("create"),style:{flex:1,background:_==="create"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:_==="create"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Create Adversary"}),e.jsx("button",{onClick:()=>ce("myAdversaries"),style:{flex:1,background:_==="myAdversaries"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:_==="myAdversaries"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"My Adversaries"}),e.jsx("button",{onClick:()=>ce("info"),style:{flex:1,background:_==="info"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:_==="info"?"500":"400",transition:"all 0.2s ease",position:"relative"},children:"Info"})]}),e.jsxs("div",{className:"encounter-builder-content",style:{flex:1,display:"flex",overflow:"hidden"},children:[e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",borderTop:"1px solid var(--border)"},children:e.jsx($t,{type:"adversary",onAddItem:g=>E(g,"adversary"),encounterItems:Y,pcCount:I,showContainer:!1,savedEncounters:W,onLoadEncounter:je,onDeleteEncounter:we,activeTab:_,selectedCustomAdversaryId:k,onSelectCustomAdversary:B,onTabChange:ce})}),_!=="info"&&e.jsxs("div",{className:"encounter-right-panel",style:{flex:"0 0 350px",borderLeft:"1px solid var(--border)",display:"flex",flexDirection:"column",overflow:"hidden"},children:[(_==="adversaries"||_==="encounters")&&e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-primary)",flexShrink:0},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:U,onChange:g=>{ie(g.target.value),F(g.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(pe,{onClick:be,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:ae()?1:.5,cursor:ae()?"pointer":"not-allowed"},children:"New"})]})}),(_==="adversaries"||_==="encounters")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"encounter-receipt-buttons-vertical",style:{display:"none",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:U,onChange:g=>{ie(g.target.value),F(g.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(pe,{onClick:be,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:ae()?1:.5,cursor:ae()?"pointer":"not-allowed"},children:"New"})]})}),e.jsx("div",{className:"receipt-content",style:{padding:"1rem",display:"flex",flexDirection:"column",height:"100%"},children:e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"flex-start",overflowY:"auto",marginBottom:"0.75rem"},children:[e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>oe(Math.max(1,I-1)),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(Ye,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:I}),e.jsx("button",{onClick:()=>oe(I+1),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(Xe,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Party Size"})}),e.jsx("div",{style:{width:"120px",textAlign:"right"}})]}),Y.map(g=>{var M;return g.type!=="adversary"?null:e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>A(g.item.id,g.type),style:{background:g.quantity===0?"var(--danger)":"var(--bg-secondary)",border:g.quantity===0?"none":"1px solid var(--border)",color:g.quantity===0?"white":"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:g.quantity===0?e.jsx(Ne,{size:10}):e.jsx(Ye,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:g.quantity}),e.jsx("button",{onClick:()=>E(g.item,g.type),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(Xe,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:g.item.baseName||((M=g.item.name)==null?void 0:M.replace(/\s+\(\d+\)$/,""))||g.item.name})}),e.jsx("div",{style:{width:"80px",textAlign:"right"},children:e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.8rem"},children:g.item.type})})]},`${g.item.id}-${g.type}`)}),e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Balance"})}),e.jsx("div",{style:{width:"120px",textAlign:"right",display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsx("span",{style:{color:i>n?"var(--danger)":i===n?"var(--purple)":"var(--success)",fontWeight:600},children:i>n?`+${i-n}`:n-i===0?"0":`-${n-i}`})})]})]})})]}),_==="create"&&e.jsxs("div",{style:{padding:"1.5rem",overflowY:"auto",height:"100%"},children:[e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Creating Adversaries"}),e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsx("p",{children:"Use the form to create custom adversaries for your encounters."}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Adversary Types:"}),e.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Minion (1 BP):"})," Weak enemies in groups"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Standard (2 BP):"})," Average threat level"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Leader (3 BP):"})," Commands others"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Bruiser (4 BP):"})," High HP tank"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Solo (5 BP):"})," Boss-level threat"]})]})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Tips:"}),e.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[e.jsx("li",{children:"Match adversary tier to party level"}),e.jsx("li",{children:"Balance encounter difficulty with Battle Points"}),e.jsx("li",{children:"Mix adversary types for variety"}),e.jsx("li",{children:"Add features that create interesting choices"})]})]})]})]}),_==="myAdversaries"&&e.jsx("div",{style:{padding:"1.5rem",overflowY:"auto",height:"100%"},children:k?(()=>{var M;const g=(M=re==null?void 0:re.adversaries)==null?void 0:M.find(H=>H.id===k);return g?e.jsx(Pe,{item:g,type:"adversary",mode:"expanded",onUpdate:()=>{},onDelete:()=>{}}):e.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Adversary not found"})})():e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Adversary Preview"}),e.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Select an adversary to view details"})]})})]})]})]})})};class Yt extends Se.Component{constructor(a){super(a),this.state={hasError:!1,error:null}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,p){console.error("ErrorBoundary caught an error:",a,p)}render(){var a;return this.state.hasError?e.jsxs("div",{className:"p-md text-red",children:[e.jsx("h3",{children:"Something went wrong:"}),e.jsx("pre",{children:(a=this.state.error)==null?void 0:a.toString()}),e.jsx("button",{className:"btn-base btn-text",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try again"})]}):this.props.children}}const Xt=()=>{const{adversaries:t,environments:a,countdowns:p,fear:d,savedEncounters:f,updateFear:m,createAdversary:x,createAdversariesBulk:z,updateAdversary:u,deleteAdversary:T,createEnvironment:D,updateEnvironment:W,deleteEnvironment:q,createCountdown:j,updateCountdown:v,deleteCountdown:C,advanceCountdown:b,saveEncounter:P,loadEncounter:F,deleteEncounter:re}=Le(),[I,oe]=S.useState(!1),[ue,he]=S.useState(!1);S.useState(!1),S.useState(!1),S.useState(!0);const[Y,V]=S.useState(null),[U,ie]=S.useState(0),[_,ce]=S.useState(0),[R,ee]=S.useState(!1);S.useEffect(()=>{const o=()=>{const i=window.matchMedia("(max-width: 800px)");oe(i.matches)};o();const n=window.matchMedia("(max-width: 800px)");return n.addEventListener("change",o),()=>n.removeEventListener("change",o)},[]);const y=12,c=o=>o===1?200:350,k=o=>{if(o<=0)return{visibleColumns:1,columnWidth:c(1)};const n=y*2,i=o-n;let E={visibleColumns:1,columnWidth:i};for(let A=1;A<=5;A++){const Z=(A-1)*y,le=(i-Z)/A;le>=c(A)&&A*le+Z<=i&&(E={visibleColumns:A,columnWidth:le})}return E.visibleColumns*E.columnWidth+(E.visibleColumns-1)*y>i&&(E={visibleColumns:1,columnWidth:i}),E},{visibleColumns:B,columnWidth:J}=k(U);S.useEffect(()=>{const o=()=>{ie(window.innerWidth)};return o(),window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)},[]);const ae=()=>{he(!0)},pe=()=>{he(!ue)},l=S.useCallback(()=>{he(!1)},[]),h=S.useCallback(o=>{ce(o.target.scrollLeft)},[]);S.useCallback(()=>{ee(!0)},[]),S.useCallback(()=>{setTimeout(()=>ee(!1),100)},[]);const s=(()=>{const o={};return t.forEach(n=>{var E;const i=n.baseName||((E=n.name)==null?void 0:E.replace(/\s+\(\d+\)$/,""))||n.name;o[i]||(o[i]={type:"adversary",baseName:i,instances:[]}),o[i].instances.push(n)}),a.forEach(n=>{o[n.name]||(o[n.name]={type:"environment",baseName:n.name,instances:[]}),o[n.name].instances.push(n)}),p.forEach(n=>{o[`countdown-${n.id}`]={type:"countdown",baseName:n.name,instances:[n]}}),Object.values(o)})();return s.length,e.jsxs("div",{className:"app",onClick:o=>{o.target,o.currentTarget},children:[e.jsx(kt,{onToggle:pe,isOpen:ue}),e.jsx("div",{className:"main-content",style:{position:"relative",width:"100%"},children:e.jsx("div",{className:"dashboard-scroll-container",style:{display:"flex",flexDirection:"row",overflowX:"auto",overflowY:"hidden",padding:`0 ${y}px`,scrollSnapType:"x mandatory",height:"100%",width:"100%"},onScroll:h,children:s.length===0?e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",width:"100%",padding:"2rem"},children:e.jsx("button",{onClick:ae,style:{backgroundColor:"transparent",color:"var(--text-secondary)",border:"2px dashed var(--border)",borderRadius:"var(--radius-md)",padding:"1rem 2rem",fontSize:"1rem",fontWeight:"500",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:o=>{o.target.style.borderColor="var(--purple)",o.target.style.color="var(--purple)"},onMouseLeave:o=>{o.target.style.borderColor="var(--border)",o.target.style.color="var(--text-secondary)"},children:"Create Encounter"})}):s.map((o,n)=>e.jsx(qt,{className:"invisible-scrollbar",style:{width:`${J+y}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:`${y}px`,paddingRight:"0",paddingTop:`${y}px`,paddingBottom:`${y}px`,scrollSnapAlign:"start",overflowY:"auto",overflowX:"hidden"},children:e.jsx(Pe,{type:o.type,item:{...o.instances[0],name:o.baseName,hp:0,stress:0,isDead:!1},mode:"expanded",instances:o.instances,onApplyDamage:o.type==="adversary"?(i,E,N,A)=>{const Z=o.instances.find(le=>le.id===i);Z&&u(i,{hp:Math.min(Z.hpMax||1,(Z.hp||0)+E)})}:void 0,onApplyHealing:o.type==="adversary"?(i,E,N)=>{const A=o.instances.find(Z=>Z.id===i);A&&u(i,{hp:Math.max(0,(A.hp||0)-E)})}:void 0,onApplyStressChange:o.type==="adversary"?(i,E)=>{var N,A;return u(i,{stress:Math.max(0,Math.min(((N=o.instances.find(Z=>Z.id===i))==null?void 0:N.stressMax)||6,(((A=o.instances.find(Z=>Z.id===i))==null?void 0:A.stress)||0)+E))})}:void 0,onUpdate:o.type==="adversary"?u:o.type==="environment"?W:v,adversaries:t})},`${o.type}-${o.baseName}`))})}),e.jsx(It,{position:"bottom",children:e.jsx(Ee,{type:"fear",value:(d==null?void 0:d.value)||0,maxValue:12,onChange:m,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0})}),e.jsx(Gt,{isOpen:ue,onClose:l,onAddAdversary:o=>{x(o),V("adversary")},onAddAdversariesBulk:o=>{z(o),V("adversary")},onAddEnvironment:o=>{D(o),V("environment")},onDeleteAdversary:T,onDeleteEnvironment:q,onDeleteCountdown:C,adversaries:t,environments:a,countdowns:p,savedEncounters:f,onSaveEncounter:P,onLoadEncounter:F,onDeleteEncounter:re}),e.jsx(Ot,{})]})},Jt=()=>e.jsx(Yt,{children:e.jsx(Xt,{})});qe.createRoot(document.getElementById("root")).render(e.jsx(Se.StrictMode,{children:e.jsx(St,{children:e.jsx(Jt,{})})}));
