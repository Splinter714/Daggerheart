import{r as h,a as wt,R as Ve}from"./dndkit-57209f9c.js";import{F as ir,f as lr,a as dr,b as cr,c as Mt}from"./fa-b4bcccb0.js";import{D as ur,A as pr,C as Kt,X as rt,M as dt,P as Ye,a as mr,H as fr,L as hr,F as xr,S as gt,b as yt,T as Nt,c as zt,B as Wt}from"./lucide-e69a925c.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))a(l);new MutationObserver(l=>{for(const d of l)if(d.type==="childList")for(const c of d.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function o(l){const d={};return l.integrity&&(d.integrity=l.integrity),l.referrerPolicy&&(d.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?d.credentials="include":l.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function a(l){if(l.ep)return;l.ep=!0;const d=o(l);fetch(l.href,d)}})();var Gt={exports:{}},mt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gr=h,yr=Symbol.for("react.element"),vr=Symbol.for("react.fragment"),br=Object.prototype.hasOwnProperty,wr=gr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Sr={key:!0,ref:!0,__self:!0,__source:!0};function Jt(e,i,o){var a,l={},d=null,c=null;o!==void 0&&(d=""+o),i.key!==void 0&&(d=""+i.key),i.ref!==void 0&&(c=i.ref);for(a in i)br.call(i,a)&&!Sr.hasOwnProperty(a)&&(l[a]=i[a]);if(e&&e.defaultProps)for(a in i=e.defaultProps,i)l[a]===void 0&&(l[a]=i[a]);return{$$typeof:yr,type:e,key:d,ref:c,props:l,_owner:wr.current}}mt.Fragment=vr;mt.jsx=Jt;mt.jsxs=Jt;Gt.exports=mt;var t=Gt.exports,St={},Lt=wt;St.createRoot=Lt.createRoot,St.hydrateRoot=Lt.hydrateRoot;function qe(e){if(typeof localStorage>"u")return null;try{const i=localStorage.getItem(e);return i==null?null:JSON.parse(i)}catch{return null}}function Ge(e,i){if(!(typeof localStorage>"u"))try{localStorage.setItem(e,JSON.stringify(i))}catch{}}function Xe(e){const i=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return e?`${e}-${i}`:i}function Cr(e=[]){const[i,o]=h.useState(e),a=h.useRef(!0);return h.useEffect(()=>{if(a.current){a.current=!1;return}const p=qe("daggerheart-game-state")||{};Ge("daggerheart-game-state",{...p,adversaries:i})},[i]),{adversaries:i,createAdversary:p=>{var g;const f=Xe("adv"),m=p.baseName||((g=p.name)==null?void 0:g.replace(/\s+\(\d+\)$/,""))||p.name||"Unknown",r=i.filter(S=>S.baseName===m);let s=1;if(r.length>0){const S=r.map(B=>B.duplicateNumber||1);let w=1;for(;S.includes(w);)w++;s=w}const n={...p,id:f,baseName:m,duplicateNumber:s,name:`${m} (${s})`,hp:0,stress:0,isVisible:!0};o(S=>[...S,n])},createAdversariesBulk:p=>{const f=[],m={};p.forEach(r=>{var P;const s=r.baseName||((P=r.name)==null?void 0:P.replace(/\s+\(\d+\)$/,""))||r.name||"Unknown",g=i.filter(K=>K.baseName===s).length,S=m[s]||0,w=g+S+1;m[s]=S+1;const B={...r,id:Xe("adv"),baseName:s,duplicateNumber:w,name:`${s} (${w})`,hp:0,stress:0,isVisible:!0};f.push(B)}),o(r=>[...r,...f])},updateAdversary:(p,f)=>{o(m=>m.map(r=>{if(r.id===p){const s={...r,...f};if(f.baseName!==void 0){const n=f.baseName,g=s.duplicateNumber||1;s.name=g===1?n:`${n} (${g})`}return s}return r}))},deleteAdversary:p=>{o(f=>f.filter(m=>m.id!==p))}}}function jr(e=[]){const[i,o]=h.useState(e),a=h.useRef(!0);return h.useEffect(()=>{if(a.current){a.current=!1;return}const m=qe("daggerheart-game-state")||{};Ge("daggerheart-game-state",{...m,countdowns:i})},[i]),{countdowns:i,createCountdown:m=>{const r={id:Xe("countdown"),name:m.name||"Countdown",max:parseInt(m.max)||1,value:0,visible:!0,type:m.type||"standard",loop:m.loop||"none",source:m.source||"campaign"};o(s=>[...s,r])},updateCountdown:(m,r)=>{o(s=>s.map(n=>n.id===m?{...n,...r}:n))},deleteCountdown:m=>{o(r=>r.filter(s=>s.id!==m))},advanceCountdown:(m,r)=>{o(s=>s.map(n=>{if(n.id!==m)return n;let g=r;if(n.loop==="loop")g>n.max?g=(g-1)%n.max+1:g<0&&(g=n.max);else if(n.loop==="increasing"){if(g>n.max)return{...n,max:n.max+1,value:1};if(g<0)return{...n,max:Math.max(1,n.max-1),value:1};g=Math.max(0,g)}else if(n.loop==="decreasing"){if(g>n.max)return{...n,max:Math.max(1,n.max-1),value:1};if(g<0)return{...n,max:n.max+1,value:1};g=Math.min(n.max,g)}else g=Math.max(0,Math.min(g,n.max));return{...n,value:g}}))},incrementCountdown:(m,r=1)=>{o(s=>s.map(n=>{if(n.id!==m)return n;let g=n.value+r;if(n.loop==="loop")g>n.max&&(g=(g-1)%n.max+1);else if(n.loop==="increasing"){if(g>n.max)return{...n,max:n.max+1,value:1}}else if(n.loop==="decreasing"){if(g>n.max)return{...n,max:Math.max(1,n.max-1),value:1}}else g=Math.min(g,n.max);return{...n,value:g}}))},decrementCountdown:m=>{o(r=>r.map(s=>{if(s.id!==m)return s;let n=s.value-1;if(s.loop==="loop")n<0&&(n=s.max);else if(s.loop==="increasing"){if(n<0)return{...s,max:Math.max(1,s.max-1),value:s.max};n=Math.max(0,n)}else if(s.loop==="decreasing"){if(n<0)return{...s,max:s.max+1,value:1}}else n=Math.max(0,n);return{...s,value:n}}))}}}function kr(e=[]){const[i,o]=h.useState(e),a=h.useRef(!0);return h.useEffect(()=>{if(a.current){a.current=!1;return}const u=qe("daggerheart-game-state")||{};Ge("daggerheart-game-state",{...u,environments:i})},[i]),{environments:i,createEnvironment:u=>{const p=Xe("env"),m=(i||[]).filter(n=>n.name.replace(/\s+\(\d+\)$/,"")===u.name);let r=u.name||"Unknown";if(m.length===0)r=u.name;else if(m.length===1){const n=m[0],g=n.name.replace(/\s+\(\d+\)$/,""),S=i.map(w=>w.id===n.id?{...w,name:`${g} (1)`}:w);o(S),r=`${u.name} (2)`}else{const n=m.map(S=>{const w=S.name.match(/\((\d+)\)$/);return w?parseInt(w[1]):null}).filter(S=>S!==null);let g=1;for(;n.includes(g);)g++;r=`${u.name} (${g})`}const s={...u,id:p,name:r,isVisible:!0};o(n=>[...n,s])},updateEnvironment:(u,p)=>{o(f=>f.map(m=>m.id===u?{...m,...p}:m))},deleteEnvironment:u=>{o(p=>p.filter(f=>f.id!==u))}}}function Er(e=[],i="Encounter"){const[o,a]=h.useState(e),[l,d]=h.useState(i),c=h.useRef(!0);return h.useEffect(()=>{if(c.current){c.current=!1;return}const r=qe("daggerheart-game-state")||{};Ge("daggerheart-game-state",{...r,savedEncounters:o,currentEncounterName:l})},[o,l]),{savedEncounters:o,currentEncounterName:l,saveEncounter:r=>{if(r.id)return a(s=>s.map(n=>n.id===r.id?{...n,name:r.name||n.name,encounterItems:r.encounterItems||n.encounterItems,partySize:r.partySize||n.partySize,battlePointsAdjustments:r.battlePointsAdjustments||n.battlePointsAdjustments,updatedAt:new Date().toISOString()}:n)),r.id;{const s={id:Xe("encounter"),name:r.name||"Encounter",createdAt:new Date().toISOString(),encounterItems:r.encounterItems||[],partySize:r.partySize||4,battlePointsAdjustments:r.battlePointsAdjustments||{}};return a(n=>[...n,s]),s.id}},loadEncounter:r=>o.find(s=>s.id===r),deleteEncounter:r=>{a(s=>s.filter(n=>n.id!==r))},updateCurrentEncounterName:r=>{d(r||"Encounter")}}}function Ar(e={value:0,visible:!1},i=4){const[o,a]=h.useState(e),[l,d]=h.useState(i),c=h.useRef(!0);return h.useEffect(()=>{if(c.current){c.current=!1;return}const f=qe("daggerheart-game-state")||{};Ge("daggerheart-game-state",{...f,fear:o,partySize:l})},[o,l]),{fear:o,partySize:l,updateFear:f=>{a(m=>({...m,value:f}))},updatePartySize:f=>{d(Math.max(1,f))}}}function Ir(){const[e,i]=h.useState({adversaries:[],environments:[]});return h.useEffect(()=>{const d=qe("daggerheart-custom-adversaries")||[],c=qe("daggerheart-custom-environments")||[];i({adversaries:d,environments:c})},[]),h.useEffect(()=>{Ge("daggerheart-custom-adversaries",e.adversaries)},[e.adversaries]),h.useEffect(()=>{Ge("daggerheart-custom-environments",e.environments)},[e.environments]),{customContent:e,addCustomAdversary:d=>{const c={...d,id:Xe("custom-adv"),source:d.source||"Homebrew",isCustom:!0};return i(u=>({...u,adversaries:[...u.adversaries,c]})),c.id},updateCustomAdversary:(d,c)=>{i(u=>({...u,adversaries:u.adversaries.map(p=>p.id===d?{...p,...c}:p)}))},deleteCustomAdversary:d=>{i(c=>({...c,adversaries:c.adversaries.filter(u=>u.id!==d)}))}}}const Yt=h.createContext(),Tr=({children:e})=>{const[i,o]=h.useState(!1),[a,l]=h.useState(()=>qe("daggerheart-game-state")||{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],currentEncounterName:"Encounter"}),d=Ar(a.fear,a.partySize),c=Cr(a.adversaries||[]),u=jr(a.countdowns||[]),p=kr(a.environments||[]),f=Er(a.savedEncounters||[],a.currentEncounterName||"Encounter"),m=Ir();h.useEffect(()=>{o(!0)},[]);const s={gameState:{fear:d.fear,countdowns:u.countdowns,adversaries:c.adversaries,environments:p.environments,partySize:d.partySize,savedEncounters:f.savedEncounters,currentEncounterName:f.currentEncounterName},isLoaded:i,customContent:m.customContent,updateFear:d.updateFear,updatePartySize:d.updatePartySize,updateCurrentEncounterName:f.updateCurrentEncounterName,saveEncounter:f.saveEncounter,loadEncounter:f.loadEncounter,deleteEncounter:f.deleteEncounter,createCountdown:u.createCountdown,updateCountdown:u.updateCountdown,deleteCountdown:u.deleteCountdown,advanceCountdown:u.advanceCountdown,incrementCountdown:u.incrementCountdown,decrementCountdown:u.decrementCountdown,createAdversary:c.createAdversary,createAdversariesBulk:c.createAdversariesBulk,updateAdversary:c.updateAdversary,deleteAdversary:c.deleteAdversary,createEnvironment:p.createEnvironment,updateEnvironment:p.updateEnvironment,deleteEnvironment:p.deleteEnvironment,addCustomAdversary:m.addCustomAdversary,updateCustomAdversary:m.updateCustomAdversary,deleteCustomAdversary:m.deleteCustomAdversary};return t.jsx(Yt.Provider,{value:s,children:e})},ft=()=>{const e=h.useContext(Yt);if(!e)return console.warn("useGameState: Context not available yet, returning defaults"),{isLoaded:!1,fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],customContent:{adversaries:[],environments:[]},updateFear:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},addCustomAdversary:()=>{},updateCustomAdversary:()=>{},deleteCustomAdversary:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{gameState:i,customContent:o,...a}=e;if(!i)return console.warn("useGameState: gameState not available, returning defaults"),{isLoaded:e.isLoaded||!1,fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],customContent:{adversaries:[],environments:[]},updateFear:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},addCustomAdversary:()=>{},updateCustomAdversary:()=>{},deleteCustomAdversary:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{fear:l,countdowns:d,adversaries:c,environments:u,partySize:p,savedEncounters:f}=i;return{gameState:i,isLoaded:e.isLoaded,fear:l,countdowns:d,adversaries:c,environments:u,partySize:p,savedEncounters:f,customContent:o,...a,hasCountdowns:d.length>0,hasAdversaries:c.length>0,hasEnvironments:u.length>0,getCountdownById:m=>d.find(r=>r.id===m),getAdversaryById:m=>c.find(r=>r.id===m),getEnvironmentById:m=>u.find(r=>r.id===m)}},Ce=12,ot=48,Mr=()=>t.jsx("div",{className:"pwa-install-prompt",style:{}}),Ct=({tabContent:e,children:i,containerStyle:o={},tabStyle:a={},showTab:l=!0,tabBackgroundColor:d="var(--bg-primary)",tabBorderColor:c="var(--border)",tabJustifyContent:u="center",containerBackgroundColor:p,containerBorderColor:f,containerBorderRadius:m="8px",containerBoxShadow:r,containerOverflow:s="hidden",reserveTabSpace:n=!1,style:g={},...S})=>{const w={display:"flex",flexDirection:"column",position:"relative",height:"100%",width:"100%",borderRadius:m,overflow:s};p&&(w.backgroundColor=p),f&&(w.border=`2px solid ${f}`),r&&(w.boxShadow=r);const B={position:"relative",overflow:"visible",height:"100%",width:"100%",display:"flex",flexDirection:"column",boxSizing:"border-box"},P=n?"0":`-${ot}px`,K=n&&l&&e?`${ot}px`:"0";return t.jsxs("div",{style:{...B,...g},...S,children:[l&&e&&t.jsx("div",{style:{position:"absolute",top:P,left:"7px",right:"7px",width:"calc(100% - 14px)",display:"flex",alignItems:"center",gap:"0.5rem",justifyContent:u,flexShrink:0,zIndex:0,padding:"0.5rem 0.75rem",paddingBottom:"calc(0.5rem + 4px)",minHeight:`${ot}px`,backgroundColor:d,border:`1.5px solid ${c}`,borderBottom:"none",borderRadius:"8px 8px 0 0",boxSizing:"border-box",marginBottom:"-4px",...a},children:e}),t.jsx("div",{style:{...w,...o,zIndex:1,marginTop:K},children:i})]})},Nr="modulepreload",zr=function(e){return"/Daggerheart/"+e},Rt={},Je=function(i,o,a){if(!o||o.length===0)return i();const l=document.getElementsByTagName("link");return Promise.all(o.map(d=>{if(d=zr(d),d in Rt)return;Rt[d]=!0;const c=d.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(!!a)for(let m=l.length-1;m>=0;m--){const r=l[m];if(r.href===d&&(!c||r.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${u}`))return;const f=document.createElement("link");if(f.rel=c?"stylesheet":Nr,c||(f.as="script",f.crossOrigin=""),f.href=d,document.head.appendChild(f),c)return new Promise((m,r)=>{f.addEventListener("load",m),f.addEventListener("error",()=>r(new Error(`Unable to preload CSS for ${d}`)))})})).then(()=>i()).catch(d=>{const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=d,window.dispatchEvent(c),!c.defaultPrevented)throw d})},Bt={Minion:{difficulty:e=>[9,12,15,18][e-1],thresholds:e=>({major:0,severe:0}),hpMax:e=>1,stressMax:e=>1,atk:e=>[-1,0,1,2][e-1],damage:e=>["2","5","8","11"][e-1],range:"Melee"},Standard:{difficulty:e=>[11,14,17,20][e-1],thresholds:e=>({major:[7,10,20,25][e-1],severe:[12,20,32,45][e-1]}),hpMax:e=>[4,5,6,7][e-1],stressMax:e=>[3,3,4,4][e-1],atk:e=>[1,2,3,4][e-1],damage:e=>["1d8+1","2d8+2","3d8+3","4d8+4"][e-1],range:"Melee"},Bruiser:{difficulty:e=>[11,14,17,20][e-1],thresholds:e=>({major:[8,14,22,38][e-1],severe:[15,28,40,70][e-1]}),hpMax:e=>[6,7,8,9][e-1],stressMax:e=>[4,4,5,5][e-1],atk:e=>[-1,0,1,2][e-1],damage:e=>["1d12+2","2d12+4","3d12+6","4d12+8"][e-1],range:"Melee"},Horde:{difficulty:e=>[10,13,16,19][e-1],thresholds:e=>({major:[7,10,20,25][e-1],severe:[12,20,32,45][e-1]}),hpMax:e=>[5,6,7,8][e-1],stressMax:e=>[3,3,4,4][e-1],atk:e=>[-1,0,1,2][e-1],damage:e=>["1d8+2","2d8+4","3d8+6","4d8+8"][e-1],range:"Melee"},Leader:{difficulty:e=>[11,14,17,20][e-1],thresholds:e=>({major:[7,13,21,35][e-1],severe:[14,26,38,65][e-1]}),hpMax:e=>[5,6,7,8][e-1],stressMax:e=>[5,5,6,6][e-1],atk:e=>[2,4,6,8][e-1],damage:e=>["1d10+2","2d10+4","3d10+6","4d10+8"][e-1],range:"Melee"},Ranged:{difficulty:e=>[10,13,16,19][e-1],thresholds:e=>({major:[4,8,18,22][e-1],severe:[7,16,30,42][e-1]}),hpMax:e=>[3,4,5,6][e-1],stressMax:e=>[3,3,4,4][e-1],atk:e=>[2,3,4,5][e-1],damage:e=>["1d8+2","2d8+4","3d8+6","4d8+8"][e-1],range:"Close"},Skulk:{difficulty:e=>[12,15,18,21][e-1],thresholds:e=>({major:[5,9,19,23][e-1],severe:[10,18,31,43][e-1]}),hpMax:e=>[4,5,6,7][e-1],stressMax:e=>[3,3,4,4][e-1],atk:e=>[2,3,4,5][e-1],damage:e=>["1d6+2","2d6+4","3d6+6","4d6+8"][e-1],range:"Melee"},Solo:{difficulty:e=>[12,15,18,21][e-1],thresholds:e=>({major:[7,13,21,35][e-1],severe:[14,26,38,65][e-1]}),hpMax:e=>[8,9,10,11][e-1],stressMax:e=>[5,5,6,6][e-1],atk:e=>[3,5,7,9][e-1],damage:e=>["1d10+3","2d10+6","3d10+9","4d10+12"][e-1],range:"Melee"},Support:{difficulty:e=>[11,14,17,20][e-1],thresholds:e=>({major:[5,9,19,23][e-1],severe:[10,18,31,43][e-1]}),hpMax:e=>[4,4,5,5][e-1],stressMax:e=>[4,4,5,5][e-1],atk:e=>[2,3,4,5][e-1],damage:e=>["1d4+2","2d4+4","3d4+6","4d4+8"][e-1],range:"Melee"},Social:{difficulty:e=>[11,14,17,20][e-1],thresholds:e=>({major:[5,9,19,23][e-1],severe:[10,18,31,43][e-1]}),hpMax:e=>[4,4,5,5][e-1],stressMax:e=>[4,4,5,5][e-1],atk:e=>[2,3,4,5][e-1],damage:e=>["1d4+2","2d4+4","3d4+6","4d4+8"][e-1],range:"Melee"}},et=(e,i)=>{const o=Bt[i]||Bt.Standard;return{difficulty:o.difficulty(e),thresholds:o.thresholds(e),hpMax:o.hpMax(e),stressMax:o.stressMax(e),atk:o.atk(e),damage:o.damage(e),range:o.range}};let Xt={adversaries:[]},Dt=!1;const Wr=()=>({customAdversaries:JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]")}),Lr=async()=>{if(Dt)return;let e={adversaries:[]},i={adversaries:[]};try{const a=await Je(()=>import("./adversaries-9c8932de.js"),[]);e=(a==null?void 0:a.default)||a}catch(a){console.warn("Failed to load adversaries.json:",a)}try{const a=await Je(()=>import("./playtest-adversaries-4a099c10.js"),[]);i=(a==null?void 0:a.default)||a}catch(a){console.warn("Failed to load playtest-adversaries.json:",a)}const{customAdversaries:o}=Wr();Xt={...e,adversaries:[...e.adversaries||[],...i.adversaries||[],...o]},Dt=!0},kt=h.forwardRef(({onSave:e,onRefresh:i,onAddItem:o,editingAdversary:a,onCancelEdit:l,isStockAdversary:d=!1,autoFocus:c=!1,allAdversaries:u=[],embedded:p=!1,hideEmbeddedButtons:f=!1},m)=>{const r=h.useRef(null),s=h.useRef(null),[n,g]=h.useState(()=>{const C=et(1,"Standard");return{name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:C.difficulty,thresholds:C.thresholds,hpMax:C.hpMax,stressMax:C.stressMax,atk:C.atk,weapon:"",range:C.range,damage:C.damage,experience:[],features:[]}}),[S,w]=h.useState(!1),[B,P]=h.useState(!1),[K,D]=h.useState([]),[_,L]=h.useState(!1),[F,E]=h.useState([]);h.useEffect(()=>{(async()=>{await Lr(),u.length>0?E(u):E(Xt.adversaries||[])})()},[u]),h.useEffect(()=>{c&&setTimeout(()=>{var C,v,j;a&&s.current?((C=s.current)==null||C.focus(),(v=s.current)==null||v.select()):r.current&&((j=r.current)==null||j.focus())},650)},[c,a]),h.useEffect(()=>{var C;if(a){const v=a.baseName||((C=a.name)==null?void 0:C.replace(/\s+\(\d+\)$/,""))||a.name||"";g({name:v,tier:a.tier||1,type:a.type||"Standard",description:a.description||"",motives:a.motives||"",difficulty:a.difficulty||11,thresholds:a.thresholds||{major:7,severe:12},hpMax:a.hpMax||3,stressMax:a.stressMax||1,atk:a.atk||1,weapon:a.weapon||"",range:a.range||"Melee",damage:a.damage||"",experience:a.experience||[],features:a.features||[]}),P(!1)}else{const v=et(1,"Standard");g({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:v.difficulty,thresholds:v.thresholds,hpMax:v.hpMax,stressMax:v.stressMax,atk:v.atk,weapon:"",range:v.range,damage:v.damage,experience:[],features:[]}),P(!1)}},[a]),h.useEffect(()=>{if(!a&&!B){const C=et(n.tier,n.type);g(v=>({...v,difficulty:C.difficulty,thresholds:C.thresholds,hpMax:C.hpMax,stressMax:C.stressMax,atk:C.atk,range:C.range,damage:C.damage}))}},[n.tier,n.type,a,B]);const y=C=>{if(g(v=>({...v,name:C})),C.trim().length>0){const v=F.filter(j=>{var b;return(((b=j.name)==null?void 0:b.replace(/\s+\(\d+\)$/,""))||j.name||"").toLowerCase().includes(C.toLowerCase())}).slice(0,5);D(v),L(v.length>0)}else D([]),L(!1)},O=async()=>{if(!n.name.trim()){alert("Please enter a name for the adversary");return}w(!0);try{const C=b=>(b||[]).filter(T=>T.name&&T.name.trim()!==""||T.modifier!==void 0&&T.modifier!==0),v=n.name.trim()||"Unknown",j=C(n.experience||[]),q={...n,experience:j,baseName:v,name:v,hp:a?a.hp:0,stress:a?a.stress:0,source:"Homebrew"};if(a){if(d){const{id:b,name:T,...k}=q;await e(k),alert("Custom adversary created successfully!")}else{const b={...q,name:q.baseName};await e(b,a.id),alert("Adversary updated successfully!")}l&&l()}else{await e(q),i&&await i();const b=et(1,"Standard");g({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:b.difficulty,thresholds:b.thresholds,hpMax:b.hpMax,stressMax:b.stressMax,atk:b.atk,weapon:"",range:b.range,damage:b.damage,experience:[],features:[]}),P(!1),alert("Custom adversary created successfully!")}}catch(C){console.error("Error saving adversary:",C),alert("Error saving adversary. Please try again.")}finally{w(!1)}};h.useImperativeHandle(m,()=>({handleSave:O,isSaving:S,canSave:n.name.trim().length>0}));const Z={...n,id:"new-adversary",hp:0,stress:0,source:"Homebrew"},R=()=>S?a?d?"Creating...":"Saving...":"Creating...":a?d?"Save As Custom":"Save":"Create";return t.jsxs(t.Fragment,{children:[!p&&t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[t.jsx("h2",{style:{color:"var(--text-primary)",fontSize:"1.5rem",fontWeight:"600",margin:0},children:a?d?"Edit Adversary (Save As Custom)":"Edit Custom Adversary":"Create Custom Adversary"}),t.jsx("button",{onClick:O,disabled:S||!n.name.trim(),style:{padding:"0.75rem 1.5rem",backgroundColor:S||!n.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"8px",cursor:S||!n.name.trim()?"not-allowed":"pointer",fontSize:"1rem",fontWeight:"600",opacity:S||!n.name.trim()?.6:1},children:R()})]}),p&&!f&&t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",marginBottom:"0.5rem",padding:"0.5rem",borderBottom:"1px solid var(--border)"},children:[t.jsx("button",{onClick:O,disabled:S||!n.name.trim(),style:{padding:"0.5rem 1rem",backgroundColor:S||!n.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"6px",cursor:S||!n.name.trim()?"not-allowed":"pointer",fontSize:"0.875rem",fontWeight:"600",opacity:S||!n.name.trim()?.6:1,marginRight:"0.5rem"},children:R()}),l&&t.jsx("button",{onClick:l,style:{padding:"0.5rem 1rem",backgroundColor:"transparent",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"6px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600"},children:"Cancel"})]}),!a&&t.jsxs("div",{style:{marginBottom:"1rem",position:"relative"},children:[t.jsx("input",{ref:r,type:"text",value:n.name,onChange:C=>{const v=C.target.value;g(j=>({...j,name:v})),y(v)},placeholder:"Adversary name",style:{width:"100%",padding:"0.75rem",border:"1px solid var(--border)",borderRadius:"8px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"1rem",outline:"none"}}),_&&K.length>0&&t.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"0 0 8px 8px",borderTop:"none",maxHeight:"200px",overflowY:"auto",zIndex:1e3,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)"},children:K.map((C,v)=>{var q;const j=C.baseName||((q=C.name)==null?void 0:q.replace(/\s+\(\d+\)$/,""))||C.name;return t.jsxs("div",{onClick:()=>{g(b=>({...b,name:j,tier:C.tier||b.tier,type:C.type||b.type,difficulty:C.difficulty||b.difficulty,thresholds:C.thresholds||b.thresholds,hpMax:C.hpMax||b.hpMax,stressMax:C.stressMax||b.stressMax,atk:C.atk||b.atk,range:C.range||b.range,damage:C.damage||b.damage})),L(!1),P(!0),r.current&&r.current.blur()},style:{padding:"0.75rem",cursor:"pointer",borderBottom:v<K.length-1?"1px solid var(--border)":"none",transition:"background-color 0.2s"},onMouseEnter:b=>{b.target.style.backgroundColor="var(--bg-secondary)"},onMouseLeave:b=>{b.target.style.backgroundColor="transparent"},onMouseDown:b=>b.preventDefault(),children:[t.jsx("div",{style:{fontWeight:"600"},children:j}),t.jsxs("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",marginTop:"2px"},children:[C.type," • Tier ",C.tier]})]},v)})})]}),t.jsx(pt,{item:Z,type:"adversary",mode:"edit",nameInputRef:a?s:void 0,autoFocusNameInput:c&&a,onUpdate:(C,v)=>{g(j=>({...j,...v}))}})]})});kt.displayName="CustomAdversaryCreator";const Rr=({feature:e,featureType:i,item:o,onUpdate:a,handleFeatureDeleteClick:l,deleteConfirmations:d,getFeatureKey:c})=>{const u=()=>(o.features||[]).filter(r=>r.type===i),p=r=>r.type===i&&r.name.trim(),f=r=>{try{const n=[...(o==null?void 0:o.features)||[]],g=u(),S=g.findIndex(w=>w===e);if(r==="up"&&S>0){const w=g[S],B=g[S-1];m(n,w,B)}else if(r==="down"&&S<g.length-1&&S>=0){const w=g[S],B=g[S+1];m(n,w,B)}}catch(s){console.error(`Error in ${i.toLowerCase()} ${r} button:`,s)}},m=(r,s,n)=>{if(!s||!n)return;const g=r.findIndex(w=>w===s),S=r.findIndex(w=>w===n);g>=0&&S>=0&&(r[g]=n,r[S]=s,a&&a(o.id,{features:r}))};return t.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",alignSelf:"stretch"},children:[t.jsx("button",{onClick:()=>f("up"),disabled:u().findIndex(r=>r===e)===0,tabIndex:"-1",style:{width:"22px",height:"22px",padding:0,border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:p(e)&&u().findIndex(r=>r===e)!==0&&e.name.trim()?"white":"var(--text-secondary)",cursor:p(e)&&u().findIndex(r=>r===e)!==0&&e.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↑"}),t.jsx("button",{onClick:()=>l(e),disabled:!e.name.trim()&&!e.description.trim(),style:{width:"22px",height:"22px",padding:0,border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:d[c(e)]?"var(--danger)":"var(--gray-700)",color:!e.name.trim()&&!e.description.trim()?"var(--text-secondary)":"white",cursor:!e.name.trim()&&!e.description.trim()?"not-allowed":"pointer",opacity:!e.name.trim()&&!e.description.trim()?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"×"}),t.jsx("button",{onClick:()=>f("down"),disabled:u().findIndex(r=>r===e)===u().length-1,style:{width:"22px",height:"22px",padding:0,border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:p(e)&&u().findIndex(r=>r===e)<u().length-1&&e.name.trim()?"white":"var(--text-secondary)",cursor:p(e)&&u().findIndex(r=>r===e)<u().length-1&&e.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↓"})]})},Y="0.5rem",ct="0.5rem",Br=({title:e})=>t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:Y},children:[t.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),t.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px"},children:e})]}),Dr=({item:e,isEditMode:i,onUpdate:o,handleFeatureDeleteClick:a,deleteConfirmations:l,getFeatureKey:d})=>{if(!(e.features&&e.features.length>0||i))return null;const c=(f,m,r)=>t.jsxs("div",{style:{display:"flex",gap:Y,padding:Y,border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[t.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:Y},children:[t.jsx("input",{type:"text",value:f.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false","data-lpignore":"true","data-form-type":"other",name:`feature-name-${r.toLowerCase()}`,onChange:s=>{const n=[...e.features||[]],g=n.findIndex(B=>B.type===r&&B===f);g>=0?n[g]={...n[g],name:s.target.value}:n.push({type:r,name:s.target.value,description:f.description||""});const S=n.filter(B=>B.type===r),w=S[S.length-1];w&&w.name.trim()&&n.push({type:r,name:"",description:""}),o&&o(e.id,{features:n})},placeholder:`${m} name`,style:{padding:Y,border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),t.jsx("textarea",{value:f.description||"",onChange:s=>{const n=[...e.features||[]],g=n.findIndex(B=>B.type===r&&B===f);g>=0?n[g]={...n[g],description:s.target.value}:n.push({type:r,name:f.name||"",description:s.target.value});const S=n.filter(B=>B.type===r),w=S[S.length-1];w&&w.name.trim()&&n.push({type:r,name:"",description:""}),o&&o(e.id,{features:n})},placeholder:`${m} description`,style:{padding:Y,border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",minHeight:"4.5rem",resize:"vertical"}})]}),t.jsx(Rr,{feature:f,featureType:r,item:e,onUpdate:o,handleFeatureDeleteClick:a,deleteConfirmations:l,getFeatureKey:d})]},f.id||`${r}-${f.name}-${f.description}-${Math.random()}`),u=(f,m)=>t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:Y},children:f.map((r,s)=>t.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[t.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:t.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",fontSize:"0.9rem"},children:r.name})}),t.jsx("div",{style:{fontSize:"0.85rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:ct,marginRight:ct},children:r.description||m})]},`${r.type}-${s}`))}),p=(f,m)=>{const r=(e.features||[]).filter(S=>S.type===f);if(!(r.length>0)&&!i)return null;const n=i&&r.length===0?[{type:f,name:"",description:""}]:r,g=f==="Action";return t.jsxs("div",{style:g?{}:{marginTop:Y},children:[t.jsx(Br,{title:m}),t.jsx("div",{style:{display:"flex",flexDirection:"column"},children:i?n.map(S=>c(S,m.slice(0,-1),f)):u(n,`Describe the ${m.toLowerCase()}`)})]})};return t.jsxs("div",{style:{paddingLeft:Y,paddingRight:Y,marginTop:Y},children:[p("Action","Actions"),p("Passive","Passives"),p("Reaction","Reactions")]})},Fr=({item:e,isEditMode:i,onUpdate:o})=>i||e.atk!==void 0&&e.weapon?t.jsxs("div",{style:{display:"flex",flexDirection:"column",paddingLeft:Y,paddingRight:Y},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:Y},children:[t.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),t.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Standard Attack"})]}),t.jsx("div",{style:{display:"flex",flexDirection:"column"},children:i?t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:Y,padding:Y,border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)"},children:t.jsxs("div",{style:{display:"flex",gap:Y,alignItems:"center"},children:[t.jsx("input",{type:"text",value:e.weapon||"",onChange:l=>o&&o(e.id,{weapon:l.target.value}),placeholder:"Standard attack name",style:{flex:1,padding:Y,border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}}),t.jsxs("select",{value:e.range||"",onChange:l=>o&&o(e.id,{range:l.target.value}),style:{flex:1,padding:Y,border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",appearance:"none",backgroundImage:`url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",backgroundSize:"1rem",paddingRight:"2rem"},children:[t.jsx("option",{value:""}),t.jsx("option",{value:"Melee",children:"Melee"}),t.jsx("option",{value:"Very Close",children:"Very Close"}),t.jsx("option",{value:"Close",children:"Close"}),t.jsx("option",{value:"Far",children:"Far"}),t.jsx("option",{value:"Very Far",children:"Very Far"})]}),t.jsx("input",{type:"text",value:e.damage||"",onChange:l=>o&&o(e.id,{damage:l.target.value}),placeholder:"Damage (e.g., 1d6+2)",style:{flex:1,padding:Y,border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}})]})}):t.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[t.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",fontSize:"0.9rem"},children:e.weapon}),t.jsxs("div",{style:{fontSize:"0.85rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:ct,marginRight:ct},children:["Make an attack against a target within ",e.range||"Melee"," range. On a success, deal"," ",e.damage||"damage varies","."]})]})})]}):null,Ft={fear:{icon:lr,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"0.125rem",maxWidth:"none"},pipStyle:{fontSize:"var(--text-lg)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0,imageRendering:"crisp-edges"},filledColor:"var(--purple)",emptyColor:"var(--gray-dark)",tooltipTitle:"Click anywhere in header to adjust fear:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease fear by 1"},{text:"Right of boundary:",description:"Click to increase fear by 1"}]},hp:{icon:dr,maxValue:20,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stress:{icon:cr,maxValue:12,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},countdown:{icon:Mt,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust countdown:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease countdown by 1"},{text:"Right of boundary:",description:"Click to increase countdown by 1"}]},hpDots:{maxValue:20,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--red)",borderColor:"var(--red)",boxShadow:"0 0 4px rgba(239, 68, 68, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stressDots:{maxValue:12,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--purple)",borderColor:"var(--purple)",boxShadow:"0 0 4px rgba(139, 92, 246, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},adversaryHP:{icon:ur,maxValue:20,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust HP:",tooltipInstructions:[{text:"Filled pip:",description:"Click to heal (reduce damage)"},{text:"Empty pip:",description:"Click to take damage"}]},adversaryStress:{icon:pr,maxValue:12,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust stress:",tooltipInstructions:[{text:"Filled pip:",description:"Click to reduce stress"},{text:"Empty pip:",description:"Click to increase stress"}]},countdownDistributed:{icon:Mt,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Countdown progress:",tooltipInstructions:[{text:"Progress:",description:"Current countdown value"}]}},ut=({type:e="fear",value:i=0,maxValue:o,onChange:a,size:l="lg",showTooltip:d=!0,containerStyle:c={},pipStyle:u={},countdownType:p=null,distributedGroups:f=null,onPipClick:m=null,enableBoundaryClick:r=!1,clickContainerWidth:s="auto",centerPips:n=!0})=>{const[g,S]=h.useState(!1),w=Ft[e]||Ft.fear,B=o||w.maxValue,P=Math.max(0,Math.min(B,i));let K=w.filledColor;e==="countdown"&&p&&(["progress","dynamic-progress","simple-hope"].includes(p)?K="var(--gold)":["consequence","dynamic-consequence","simple-fear"].includes(p)?K="var(--purple)":["long-term","standard"].includes(p)&&(K="var(--text-secondary)"));const D=(y,O)=>{if(m)m(y,O);else if(a){const Z=y+1;a(Z)}},_=y=>{if(!r||!a||m)return;y.currentTarget.getBoundingClientRect();const O=y.currentTarget.querySelector(".pip-container");if(!O)return;const Z=O.getBoundingClientRect(),R=y.clientX-Z.left;if(R<0){P>0&&a(P-1);return}if(R>Z.width){P<B&&a(P+1);return}const C=Z.width,v=C*.05,j=C-2*v,q=R-v,b=P/B,T=j*b;q<T?P>0&&a(P-1):P<B&&a(P+1)},F=(()=>{if(!f||e!=="countdownDistributed")return[{start:0,end:B,groupIndex:0}];let y=0;return f.map((O,Z)=>{const R={start:y,end:y+O,groupIndex:Z};return y+=O,R})})(),E=()=>t.jsxs(t.Fragment,{children:[F.map(y=>t.jsx(Ve.Fragment,{children:[...Array(y.end-y.start)].map((O,Z)=>{const R=y.start+Z,C=R<P;if(w.isDots)return t.jsx("div",{style:{...w.pipStyle,...C?w.filledStyle:w.emptyStyle,...u,cursor:a||m?"pointer":"default"},onClick:r?void 0:()=>D(R,C),title:`${R+1} of ${B}`},R);{const v=w.icon,j=v&&typeof v=="object"&&v.iconName,q=C?K:w.emptyColor;return t.jsx("span",{className:`fear-pip ${C?"filled":"empty"}`,style:{...w.pipStyle,color:q,cursor:a||m?"pointer":"default",...u},onClick:r?void 0:()=>D(R,C),title:`${R+1} of ${B}`,children:j?t.jsx(ir,{icon:v,size:l}):t.jsx(v,{size:l==="lg"?18:16})},R)}})},y.groupIndex)),d&&t.jsx("div",{style:{position:"relative",cursor:"help",pointerEvents:"none"},children:t.jsxs("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:g?"translateX(-50%) translateY(-5px)":"translateX(-50%)",background:"rgba(15, 23, 42, 0.95)",border:"1px solid var(--gray)",borderRadius:"var(--radius-md)",padding:"var(--space-md)",minWidth:"250px",zIndex:1e3,opacity:g?1:0,visibility:g?"visible":"hidden",transition:"all 0.2s ease",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.5)"},children:[t.jsx("div",{style:{fontWeight:600,color:"var(--gray-200)",marginBottom:"0.75rem",fontSize:"var(--text-sm)"},children:w.tooltipTitle}),w.tooltipInstructions.map((y,O)=>t.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.8rem",color:"var(--gray-300)",lineHeight:1.4},children:[t.jsx("strong",{style:{color:"var(--gray-200)"},children:y.text})," ",y.description]},O))]})})]});return t.jsx("div",{style:{width:s,height:"100%",cursor:a||m?"pointer":"default",touchAction:"manipulation",userSelect:"none",display:n?"flex":"block",alignItems:n?"center":"stretch",justifyContent:n?"center":"flex-start",...c},onClick:y=>{y.stopPropagation(),y.preventDefault(),r&&_(y)},onMouseEnter:()=>S(d),onMouseLeave:()=>S(!1),children:t.jsx("div",{className:"pip-container",style:{...w.containerStyle,width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},children:E()})})},Pt=({value:e})=>t.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"44px",height:"32px",zIndex:3},children:[t.jsx("svg",{width:"40",height:"32",viewBox:"0 0 40 32",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",style:{position:"absolute",zIndex:1},children:t.jsx("path",{d:"M2 2h28l6 14-6 14H2l6-14-6-14z"})}),t.jsx("span",{style:{position:"absolute",fontSize:"0.8rem",fontWeight:500,color:"var(--text-primary)",textAlign:"center",zIndex:2,left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:e})]}),Pr=({item:e,instances:i=[],isEditMode:o,type:a,onUpdate:l,onApplyDamage:d,onApplyHealing:c,onApplyStressChange:u})=>{if(!(i&&i.length>0||e.type!=="Minion"&&(e.thresholds||o)))return null;const f=r=>{const s=(r.hp||0)>=(r.hpMax||1);return t.jsx("div",{"data-instance-id":r.id,children:t.jsxs("div",{style:{backgroundColor:s?"var(--gray-900)":"var(--bg-primary)",borderRadius:"6px",padding:Y,border:"1px solid",borderColor:s?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",display:"flex",justifyContent:"flex-start",alignItems:"center",gap:Y,opacity:s?.7:1,position:"relative",transition:"all 0.2s ease",minHeight:"40px"},children:[s&&t.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                          45deg,
                          transparent 0px,
                          transparent 8px,
                          var(--gray-600) 9px,
                          var(--gray-600) 9px
                        )`,pointerEvents:"none",zIndex:1,borderRadius:"4px"}}),t.jsx("div",{style:{backgroundColor:s?"var(--gray-900)":"var(--bg-card)",border:"1px solid",borderColor:s?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",borderRadius:"50%",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",flexShrink:0,opacity:s?.5:1},children:t.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:s?"var(--gray-400)":"var(--text-primary)"},children:r.duplicateNumber||1})}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.125rem"},children:[t.jsx("div",{style:{opacity:s?.3:1},children:t.jsx(ut,{type:"adversaryHP",value:r.hp||0,maxValue:r.hpMax||1,onPipClick:(n,g)=>{if(d&&a==="adversary"){const S=r.hp||0,w=r.hpMax||1;g?c==null||c(r.id,1,S):S<w&&d(r.id,1,S,w)}},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})}),r.stressMax>0&&t.jsx("div",{style:{opacity:s?.3:1},children:t.jsx(ut,{type:"adversaryStress",value:r.stress||0,maxValue:r.stressMax,onPipClick:(n,g)=>{u&&a==="adversary"&&u(r.id,g?-1:1)},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})})]})]})},r.id)},m=()=>{var r,s,n,g;return e.type==="Minion"||!e.thresholds&&!o?null:t.jsx("div",{style:{display:"flex",justifyContent:"center",paddingTop:"1px"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",position:"relative"},children:[t.jsx("svg",{width:"300",height:"36",viewBox:"0 0 300 36",style:{position:"absolute",zIndex:1},children:t.jsx("rect",{x:"20",y:"6",width:"260",height:"24",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4"})}),t.jsx("div",{style:{position:"relative",zIndex:2,display:"flex",alignItems:"center",gap:Y},children:o?t.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",fontSize:"0.8rem"},children:[t.jsx(Ot,{label:"Minor",value:(r=e.thresholds)==null?void 0:r.major,onChange:S=>$t("major",S,l,e)}),t.jsx(Ot,{label:"Major",value:(s=e.thresholds)==null?void 0:s.severe,onChange:S=>$t("severe",S,l,e)})]}):t.jsxs(t.Fragment,{children:[t.jsx(at,{text:"Minor"}),t.jsx(Pt,{value:((n=e.thresholds)==null?void 0:n.major)||7}),t.jsx(at,{text:"Major"}),t.jsx(Pt,{value:((g=e.thresholds)==null?void 0:g.severe)||14}),t.jsx(at,{text:"Severe"})]})})]})})};return t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:Y,paddingLeft:Y,paddingRight:Y,marginTop:Y},children:[t.jsx(Hr,{title:"Status"}),o?t.jsx(Or,{item:e,onUpdate:l}):t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:Y},children:i.map(r=>f(r))}),m()]})},Hr=({title:e})=>t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:Y},children:[t.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),t.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px"},children:e})]}),Or=({item:e,onUpdate:i})=>t.jsx("div",{children:t.jsx("div",{style:{padding:Y,backgroundColor:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border)"},children:t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:Y},children:[t.jsx(Ht,{label:"HP",pipType:"adversaryHP",value:e.hpMax||"",onChange:o=>i&&i(e.id,{hpMax:o})}),t.jsx(Ht,{label:"Stress",pipType:"adversaryStress",value:e.stressMax||"",onChange:o=>i&&i(e.id,{stressMax:o})})]})})}),Ht=({label:e,pipType:i,value:o,onChange:a})=>t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:Y},children:[t.jsx("input",{type:"number",value:o,onChange:l=>{const d=parseInt(l.target.value)||1;a(d)},min:"1",max:"99",style:{width:"40px",padding:Y,border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),t.jsx(ut,{type:i,value:0,maxValue:o||1,showTooltip:!1}),t.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:e})]}),at=({text:e})=>t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:e}),Ot=({label:e,value:i,onChange:o})=>t.jsxs(t.Fragment,{children:[t.jsx(at,{text:e}),t.jsx("input",{type:"number",min:"1",max:"99",value:i||"",onChange:a=>{const l=a.target.value;(l===""||parseInt(l)>=1&&parseInt(l)<=99)&&o(l===""?null:parseInt(l))},style:{width:"30px",padding:Y,border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}})]}),$t=(e,i,o,a)=>{o&&o(a.id,{thresholds:{...a.thresholds,[e]:i}})},$r=({item:e,isEditMode:i,mode:o,onUpdate:a})=>i||o==="expanded"&&e.description&&e.description.trim()?t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:Y,paddingLeft:Y,paddingRight:Y,textAlign:"center"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:Y},children:[t.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),t.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Description"})]}),i?t.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:Y,border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-primary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"none",overflow:"hidden",fontFamily:"inherit"},value:e.description,onChange:d=>{d.target.style.height="auto",d.target.style.height=d.target.scrollHeight+"px",a&&a(e.id,{description:d.target.value})},placeholder:"Description..."}):t.jsx("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,whiteSpace:"pre-wrap",padding:`${Y} 0`},children:e.description})]}):null,qr=({type:e,tier:i,isEditMode:o,onUpdate:a,itemId:l})=>{const c=(r=>{if(!r)return 0;const n=document.createElement("canvas").getContext("2d");return n.font="600 11px system-ui, -apple-system, sans-serif",n.measureText(r.toUpperCase()).width})(e),u=4,p=18,f=Math.max(50,c+u+p),m=f+15;return o?t.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",gap:Y,height:"32px"},children:[t.jsxs("select",{value:e||"",onChange:r=>{a&&a(l,{type:r.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",outline:"none",borderRadius:"4px",padding:Y,width:"95px",height:"24px"},children:[t.jsx("option",{value:"Standard",children:"Standard"}),t.jsx("option",{value:"Solo",children:"Solo"}),t.jsx("option",{value:"Bruiser",children:"Bruiser"}),t.jsx("option",{value:"Horde",children:"Horde"}),t.jsx("option",{value:"Minion",children:"Minion"}),t.jsx("option",{value:"Ranged",children:"Ranged"}),t.jsx("option",{value:"Leader",children:"Leader"}),t.jsx("option",{value:"Skulk",children:"Skulk"}),t.jsx("option",{value:"Social",children:"Social"}),t.jsx("option",{value:"Support",children:"Support"})]}),t.jsxs("div",{style:{position:"relative",width:"24px",height:"24px"},children:[t.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",width:"20px",height:"20px",backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",borderRadius:"2px"}}),t.jsx("input",{type:"text",value:i||"",onChange:r=>{const s=r.target.value.replace(/[^1-4]/g,"");s.length<=1&&a&&a(l,{tier:s===""?"":parseInt(s)})},onKeyDown:r=>{if(r.key==="ArrowUp"){r.preventDefault();const s=parseInt(i)||1;a&&a(l,{tier:Math.min(s+1,4)})}else if(r.key==="ArrowDown"){r.preventDefault();const s=parseInt(i)||1;a&&a(l,{tier:Math.max(s-1,1)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"transparent",border:"none",color:"var(--text-primary)",fontSize:"0.8rem",fontWeight:600,width:"24px",height:"24px",textAlign:"center",outline:"none",zIndex:1},maxLength:"1"})]})]}):t.jsxs("div",{style:{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"center",height:"32px",width:`${m}px`},children:[t.jsxs("svg",{width:m,height:"32",viewBox:`0 0 ${m} 32`,style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1},children:[t.jsx("rect",{x:"1",y:"6",width:f-1,height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4",ry:"4"}),t.jsx("rect",{x:f-10,y:"6",width:"20",height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"2",ry:"2",transform:`rotate(45 ${f-1} 16)`})]}),t.jsx("span",{style:{position:"absolute",top:"50%",left:"4px",transform:"translateY(-50%)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",color:"var(--text-primary)",zIndex:2,pointerEvents:"none"},children:e}),t.jsx("span",{style:{position:"absolute",top:"50%",left:`${f-.5}px`,transform:"translate(-50%, -50%)",fontSize:"0.8rem",fontWeight:600,color:"white",zIndex:2,pointerEvents:"none",textAlign:"center",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",width:"20px",height:"20px"},children:i})]})},_r=({item:e,isEditMode:i,onUpdate:o,deleteConfirmations:a,setDeleteConfirmations:l})=>{const d=(m,r)=>`experience-${r}-${typeof m=="string"?m:m.name||"blank"}`,c=m=>Array.isArray(m)?m.filter(r=>{if(typeof r=="string")return r.trim().length>0;const s=r.name||"",n=r.modifier||0;return s.trim().length>0||n>0}):[],u=(m,r)=>{const s=d(m,r);if(a[s]){const n=[...e.experience||[]];n.splice(r,1);const g=c(n);o&&o(e.id,{experience:g}),l(S=>{const w={...S};return delete w[s],w})}else l(n=>({...n,[s]:!0})),setTimeout(()=>{l(n=>{const g={...n};return delete g[s],g})},3e3)},p=()=>{const m=e.experience||[],r=m.length===0?[{name:"",modifier:0}]:m;return t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:Y},children:r.map((s,n)=>{var g,S,w,B,P,K,D,_,L,F,E,y,O,Z,R,C,v,j,q,b,T,k,A,V,M,H,ne,$,te,ce,he,We,ve,Te,Be;return t.jsxs("div",{style:{position:"relative"},children:[t.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:t.jsx("input",{type:"text",value:typeof s=="object"&&s.modifier>0?`+${s.modifier}`:"",onChange:re=>{const xe=[...e.experience||[]],ue=re.target.value.replace(/[^0-9+-]/g,""),Ae=ue===""||ue==="+"?0:parseInt(ue)||0,je=Math.max(0,Ae);xe[n]={name:typeof s=="string"?s:s.name||"",modifier:je};const Ne=c(xe);o&&o(e.id,{experience:Ne})},onKeyDown:re=>{if(re.key==="ArrowUp"||re.key==="ArrowDown"){re.preventDefault();const xe=[...e.experience||[]],ue=typeof s=="object"&&s.modifier||0,Ae=re.key==="ArrowUp"?1:-1;xe[n]={name:typeof s=="string"?s:s.name||"",modifier:Math.max(0,ue+Ae)};const je=c(xe);o&&o(e.id,{experience:je})}},style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)",textAlign:"center",outline:"none"}})}),t.jsxs("div",{style:{marginLeft:"32px",display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("input",{type:"text",value:typeof s=="string"?s:s.name||"",onChange:re=>{var Ne;const xe=[...e.experience||[]],ue=typeof s=="object"&&s.modifier||0;xe[n]={name:re.target.value,modifier:ue};let Ae=c(xe);const je=Ae[Ae.length-1];je&&(typeof je=="string"?je.trim():(Ne=je.name)!=null&&Ne.trim())&&(Ae=[...Ae,{name:"",modifier:0}]),o&&o(e.id,{experience:Ae})},placeholder:"Experience name",style:{flex:1,padding:Y,border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),t.jsxs("div",{style:{display:"flex",gap:"0.125rem"},children:[t.jsx("button",{onClick:()=>{var je,Ne;const re=[...e.experience||[]],xe=typeof s=="string"?s.trim():(je=s.name)==null?void 0:je.trim(),ue=re[n-1],Ae=typeof ue=="string"?ue==null?void 0:ue.trim():(Ne=ue==null?void 0:ue.name)==null?void 0:Ne.trim();if(n>0&&n<re.length&&xe&&Ae){re[n]=ue,re[n-1]=s;const Pe=c(re);o&&o(e.id,{experience:Pe})}},disabled:n===0||!(typeof s=="string"?s.trim():(g=s.name)!=null&&g.trim())||!(typeof r[n-1]=="string"?r[n-1].trim():(w=(S=r[n-1])==null?void 0:S.name)!=null&&w.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:n===0||!(typeof s=="string"?s.trim():(B=s.name)!=null&&B.trim())||!(typeof r[n-1]=="string"?r[n-1].trim():(K=(P=r[n-1])==null?void 0:P.name)!=null&&K.trim())?"var(--gray-800)":"var(--gray-700)",color:n===0||!(typeof s=="string"?s.trim():(D=s.name)!=null&&D.trim())||!(typeof r[n-1]=="string"?r[n-1].trim():(L=(_=r[n-1])==null?void 0:_.name)!=null&&L.trim())?"var(--text-secondary)":"white",cursor:n===0||!(typeof s=="string"?s.trim():(F=s.name)!=null&&F.trim())||!(typeof r[n-1]=="string"?r[n-1].trim():(y=(E=r[n-1])==null?void 0:E.name)!=null&&y.trim())?"not-allowed":"pointer",opacity:n===0||!(typeof s=="string"?s.trim():(O=s.name)!=null&&O.trim())||!(typeof r[n-1]=="string"?r[n-1].trim():(R=(Z=r[n-1])==null?void 0:Z.name)!=null&&R.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move up",children:"↑"}),t.jsx("button",{onClick:()=>{var je,Ne;const re=[...e.experience||[]],xe=typeof s=="string"?s.trim():(je=s.name)==null?void 0:je.trim(),ue=re[n+1],Ae=typeof ue=="string"?ue==null?void 0:ue.trim():(Ne=ue==null?void 0:ue.name)==null?void 0:Ne.trim();if(n<re.length-1&&n>=0&&xe&&Ae){re[n]=ue,re[n+1]=s;const Pe=c(re);o&&o(e.id,{experience:Pe})}},disabled:n===r.length-1||!(typeof s=="string"?s.trim():(C=s.name)!=null&&C.trim())||!(typeof r[n+1]=="string"?r[n+1].trim():(j=(v=r[n+1])==null?void 0:v.name)!=null&&j.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:n===r.length-1||!(typeof s=="string"?s.trim():(q=s.name)!=null&&q.trim())||!(typeof r[n+1]=="string"?r[n+1].trim():(T=(b=r[n+1])==null?void 0:b.name)!=null&&T.trim())?"var(--gray-800)":"var(--gray-700)",color:n===r.length-1||!(typeof s=="string"?s.trim():(k=s.name)!=null&&k.trim())||!(typeof r[n+1]=="string"?r[n+1].trim():(V=(A=r[n+1])==null?void 0:A.name)!=null&&V.trim())?"var(--text-secondary)":"white",cursor:n===r.length-1||!(typeof s=="string"?s.trim():(M=s.name)!=null&&M.trim())||!(typeof r[n+1]=="string"?r[n+1].trim():(ne=(H=r[n+1])==null?void 0:H.name)!=null&&ne.trim())?"not-allowed":"pointer",opacity:n===r.length-1||!(typeof s=="string"?s.trim():($=s.name)!=null&&$.trim())||!(typeof r[n+1]=="string"?r[n+1].trim():(ce=(te=r[n+1])==null?void 0:te.name)!=null&&ce.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move down",children:"↓"}),t.jsx("button",{onClick:()=>u(s,n),disabled:!(typeof s=="string"?s.trim():(he=s.name)!=null&&he.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:a[d(s,n)]?"var(--danger)":(typeof s=="string"?s.trim():(We=s.name)!=null&&We.trim())?"var(--gray-700)":"var(--gray-800)",color:(typeof s=="string"?s.trim():(ve=s.name)!=null&&ve.trim())?"white":"var(--text-secondary)",cursor:(typeof s=="string"?s.trim():(Te=s.name)!=null&&Te.trim())?"pointer":"not-allowed",opacity:(typeof s=="string"?s.trim():(Be=s.name)!=null&&Be.trim())?1:.5,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:a[d(s,n)]?"Click again to confirm delete":"Delete experience",children:"×"})]})]})]},n)})})},f=()=>!e.experience||e.experience.length===0?null:t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:Y},children:e.experience.map((m,r)=>{if(typeof m=="string"){const s=m.match(/^(.+?)\s*([+-]?\d+)$/);if(s){const[,n,g]=s;return t.jsxs("div",{style:{position:"relative"},children:[t.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:t.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:t.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:g})})}),t.jsx("span",{style:{marginLeft:"32px"},children:n})]},r)}return t.jsx("div",{children:m},r)}return t.jsxs("div",{style:{position:"relative"},children:[t.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:t.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:t.jsxs("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:[m.modifier>=0?"+":"",m.modifier]})})}),t.jsx("span",{style:{marginLeft:"32px"},children:m.name})]},r)})});return t.jsx("div",{style:{paddingTop:"0"},children:i?p():t.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:f()})})},vt={background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease"},qt={background:"var(--purple)",border:"1px solid var(--purple)",color:"white",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},Vr=({showCustomCreator:e,onSaveCustomAdversary:i,item:o,onCancelEdit:a,onRemoveInstance:l,onAddInstance:d,instances:c,onEdit:u})=>e?t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:p=>{p.stopPropagation(),i&&(i(o,o.id),a&&a())},style:qt,onMouseEnter:p=>{p.currentTarget.style.opacity="0.9"},onMouseLeave:p=>{p.currentTarget.style.opacity="1"},title:"Save",children:[t.jsx(Kt,{size:16}),t.jsx("span",{children:"Save"})]}),a&&t.jsxs("button",{onClick:p=>{p.stopPropagation(),a()},style:{...qt,background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)"},onMouseEnter:p=>{p.currentTarget.style.backgroundColor="var(--bg-hover)",p.currentTarget.style.borderColor="var(--purple)"},onMouseLeave:p=>{p.currentTarget.style.backgroundColor="var(--bg-secondary)",p.currentTarget.style.borderColor="var(--border)"},title:"Cancel",children:[t.jsx(rt,{size:16}),t.jsx("span",{children:"Cancel"})]})]}):t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:p=>{p.stopPropagation(),l&&l(o.id)},style:vt,onMouseEnter:p=>{p.currentTarget.style.backgroundColor="var(--bg-hover)",p.currentTarget.style.borderColor="var(--purple)"},onMouseLeave:p=>{p.currentTarget.style.backgroundColor="var(--bg-secondary)",p.currentTarget.style.borderColor="var(--border)"},title:"Remove one",children:t.jsx(dt,{size:16})}),t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"1rem",fontWeight:"500",minWidth:"24px",textAlign:"center"},children:c.length}),t.jsx("button",{onClick:p=>{p.stopPropagation(),d&&d(o)},style:vt,onMouseEnter:p=>{p.currentTarget.style.backgroundColor="var(--purple)",p.currentTarget.style.borderColor="var(--purple)",p.currentTarget.style.color="white"},onMouseLeave:p=>{p.currentTarget.style.backgroundColor="var(--bg-secondary)",p.currentTarget.style.borderColor="var(--border)",p.currentTarget.style.color="var(--text-primary)"},title:"Add another",children:t.jsx(Ye,{size:16})}),u&&t.jsx("button",{onClick:p=>{p.stopPropagation(),u(o.id)},style:{...vt,marginLeft:"0.25rem"},onMouseEnter:p=>{p.currentTarget.style.backgroundColor="var(--purple)",p.currentTarget.style.borderColor="var(--purple)",p.currentTarget.style.color="white"},onMouseLeave:p=>{p.currentTarget.style.backgroundColor="var(--bg-secondary)",p.currentTarget.style.borderColor="var(--border)",p.currentTarget.style.color="var(--text-primary)"},title:"Edit",children:t.jsx(mr,{size:16})})]}),Kr=e=>{const i=h.useRef(null),o=h.useRef(e.length),a=h.useRef(null),l=h.useRef(null),d=h.useRef(null);return h.useEffect(()=>{const c=i.current;if(!c)return;const u=()=>{a.current=c.scrollHeight,l.current=c.scrollTop};c.addEventListener("scroll",u,{passive:!0});const p=setInterval(u,100);return()=>{c.removeEventListener("scroll",u),clearInterval(p),d.current&&(cancelAnimationFrame(d.current),d.current=null)}},[]),h.useEffect(()=>()=>{const c=i.current;c&&(a.current=c.scrollHeight,l.current=c.scrollTop)},[e.length,e]),h.useLayoutEffect(()=>{const c=e.length,u=o.current,p=i.current;if(!p){o.current=c;return}if(c!==u){const f=a.current,m=l.current;if(!f||m===null){o.current=c;return}const r=p.scrollHeight,s=p.clientHeight;if(c>u){const n=r-s,g=p.scrollTop,S=n-g;if(Math.abs(S)>.5){d.current&&(cancelAnimationFrame(d.current),d.current=null);const w=400,B=performance.now(),P=K=>{const D=K-B,_=Math.min(D/w,1),L=1-_,F=1-L*L*L,E=g+S*F;p.scrollTop=E,_<1?d.current=requestAnimationFrame(P):(p.scrollTop=n,d.current=null)};d.current=requestAnimationFrame(P)}}}o.current=c},[e.length,e]),{scrollableContentRef:i}},Fe={transitions:{hoverIn:"all 0.1s ease",hoverOut:"all 0.3s ease"},card:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"8px",cursor:"pointer",transition:"all 0.1s ease",position:"relative",border:"none"},cardHover:{backgroundColor:"var(--bg-card-hover)"},cardDead:{opacity:.6,backgroundColor:"var(--gray-800)",borderColor:"var(--border)"},cardAtMax:{backgroundColor:"var(--success)",borderColor:"var(--success)"},rowMain:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},rowTitle:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",margin:0},rowMeta:{display:"flex",gap:"8px",alignItems:"center"},badge:{padding:"2px 6px",borderRadius:"3px",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},typeBadge:{backgroundColor:"var(--purple)",color:"var(--text-primary)"},tierBadge:{backgroundColor:"var(--info)",color:"var(--text-primary)"}},Gr=({item:e,type:i,mode:o="expanded",onClick:a,onApplyDamage:l,onApplyHealing:d,onApplyStressChange:c,onUpdate:u,adversaries:p=[],isSelected:f=!1,instances:m=[],isEmbedded:r=!1,onAddInstance:s=null,onRemoveInstance:n=null,onEdit:g=null,showCustomCreator:S=!1,onSaveCustomAdversary:w=null,onCancelEdit:B=null,isStockAdversary:P=!1})=>{const{scrollableContentRef:K}=Kr(m),D=h.useRef(null),_=h.useRef(null),[L,F]=h.useState({});h.useEffect(()=>{if(S&&D.current){const b=setTimeout(()=>{var T,k;(T=D.current)==null||T.focus(),(k=D.current)==null||k.select()},650);return()=>clearTimeout(b)}},[S]);const E=b=>{const k=(e.features||[]).filter(A=>A.type===b.type).findIndex(A=>A===b);return`${b.type}-${k}-${b.name||"blank"}`},y=b=>{const T=E(b);if(L[T]){const k=e.features.filter(A=>A!==b);u&&u(e.id,{features:k}),F(A=>{const V={...A};return delete V[T],V})}else F(k=>({...k,[T]:!0})),setTimeout(()=>{F(k=>{const A={...k};return delete A[T],A})},3e3)},O=(b=!1)=>{let T={...Fe.card};if(f?T.transition="none":T.transition=Fe.transitions.hoverOut,b){const{marginTop:k,...A}=T;T=A}return f&&(T={...T,...Fe.cardHover}),i==="adversary"&&(e.hp||0)>=(e.hpMax||1)&&(T={...T,...Fe.cardDead}),T},Z=()=>{if(r)return"";let b="border rounded-lg";return f&&(b+=" border-hover"),b},R=()=>{var b;if(i==="adversary"||i==="adversaries"){const T=e.baseName||((b=e.name)==null?void 0:b.replace(/\s+\(\d+\)$/,""))||"",k=e.duplicateNumber||1,A=[...p];return p.some(H=>H.id===e.id)||A.push(e),A.filter(H=>H.baseName===T).length>1?`${T} (${k})`:T}return e.name},C=()=>{const b=[];return e.type&&b.push(t.jsx("span",{style:{...Fe.badge,...Fe.typeBadge},children:e.type},"type")),b},v=()=>{var V;const b=(e.hp||0)>=(e.hpMax||1),T=j==="edit"||S,k=i==="adversary",A=k?t.jsx(Vr,{showCustomCreator:S,onSaveCustomAdversary:w,item:e,onCancelEdit:B,onRemoveInstance:n,onAddInstance:s,instances:m,onEdit:g}):null;return t.jsx(Ct,{tabContent:A,showTab:k,tabBorderColor:f?"var(--purple)":"var(--border)",containerBackgroundColor:b?"var(--gray-900)":O(!0).backgroundColor,containerBorderColor:b?"color-mix(in srgb, var(--gray-600) 40%, transparent)":f?"var(--purple)":"var(--border)",containerBorderRadius:"8px",containerOverflow:"hidden",containerStyle:{padding:0,opacity:b?.7:1,height:"auto",maxHeight:k?"calc(100vh - 120px)":"calc(100vh - 68px)",minHeight:0},children:t.jsxs("div",{className:Z(),style:{...O(!0),padding:0,display:"flex",flexDirection:"column",position:"relative",height:"100%",minHeight:0,border:"none",borderRadius:0},onClick:a,children:[b&&t.jsx(t.Fragment,{children:t.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                45deg,
                transparent,
                transparent 8px,
                var(--gray-600) 1px,
                var(--gray-600) 9px
              )`,pointerEvents:"none",zIndex:9999}})}),t.jsx("div",{className:"border-b",style:{padding:Y,flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative",zIndex:b?1:"auto",borderBottomColor:f?"var(--purple)":"var(--border)"},children:t.jsx("div",{style:{display:"flex",flexDirection:"column",position:"relative",zIndex:b?1:"auto",padding:"2px",gap:0},children:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",minHeight:"40px"},children:[T?t.jsx("input",{ref:D,type:"text",value:e.name||"",onChange:M=>{u&&e.id&&u(e.id,{name:M.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"4px",color:"var(--text-primary)",fontSize:"1.1rem",fontWeight:"600",padding:Y,width:"100%",maxWidth:"300px",paddingRight:"0.625rem"},placeholder:"Name"}):t.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flex:1},children:t.jsx("h4",{style:{...Fe.rowTitle,color:b?"color-mix(in srgb, var(--gray-400) 80%, transparent)":Fe.rowTitle.color,textAlign:"left",margin:0,fontSize:"1.1rem",paddingRight:"6px",flex:1},children:((V=e.name)==null?void 0:V.replace(/\s+\(\d+\)$/,""))||e.name})}),(e.type||e.tier||T)&&t.jsx(qr,{type:e.type,tier:e.tier,isEditMode:T,onUpdate:u,itemId:e.id})]})})}),t.jsxs("div",{ref:K,style:{borderRadius:"0 0 8px 8px",flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0},className:"invisible-scrollbar",children:[(e.motives||T)&&t.jsx("div",{style:{padding:`${Y} ${Y}`,textAlign:"center"},children:T?t.jsx("input",{type:"text",value:e.motives||"",onChange:M=>u&&u(e.id,{motives:M.target.value}),placeholder:"Motives...",style:{width:"100%",padding:Y,border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}):t.jsxs("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,textAlign:"center"},children:[e.motives,e.motives&&!e.motives.endsWith(".")?".":""]})}),(e.difficulty||e.atk!==void 0||e.thresholds&&e.type!=="Minion"||e.experience&&e.experience.length>0||T)&&t.jsxs("div",{style:{padding:"0.5rem 8px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[(e.difficulty||T)&&t.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[t.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[t.jsx(fr,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(0deg)"}}),T?t.jsx("input",{type:"text",value:e.difficulty||"",onChange:M=>{const H=M.target.value.replace(/[^0-9]/g,"");H.length<=2&&u&&u(e.id,{difficulty:parseInt(H)||0})},onKeyDown:M=>{if(M.key==="ArrowUp"){M.preventDefault();const H=parseInt(e.difficulty)||0;u&&u(e.id,{difficulty:Math.min(H+1,99)})}else if(M.key==="ArrowDown"){M.preventDefault();const H=parseInt(e.difficulty)||0;u&&u(e.id,{difficulty:Math.max(H-1,0)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"2"}):t.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:e.difficulty})]}),t.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Difficulty"})]}),(e.atk!==void 0||T)&&t.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[t.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[t.jsx(hr,{size:38,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(45deg)"}}),T?t.jsx("input",{type:"text",value:(()=>{if(typeof e.atk=="string"&&e.atk.includes("d"))return e.atk;const M=typeof e.atk=="string"?parseInt(e.atk.replace(/[^0-9-]/g,"")):e.atk||0;return M>=0?`+${M}`:M.toString()})(),onChange:M=>{const H=M.target.value;if(H.includes("d"))u&&u(e.id,{atk:H});else{const ne=H.replace(/[^0-9+-]/g,"");if(ne.length<=4){const $=parseInt(ne.replace(/[^0-9-]/g,""))||0;u&&u(e.id,{atk:$})}}},onKeyDown:M=>{if(!(typeof e.atk=="string"&&e.atk.includes("d"))){if(M.key==="ArrowUp"){M.preventDefault();const ne=(typeof e.atk=="string"?parseInt(e.atk.replace(/[^0-9-]/g,"")):e.atk||0)+1;u&&u(e.id,{atk:ne})}else if(M.key==="ArrowDown"){M.preventDefault();const ne=(typeof e.atk=="string"?parseInt(e.atk.replace(/[^0-9-]/g,"")):e.atk||0)-1;u&&u(e.id,{atk:ne})}}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"3"}):t.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:(()=>{if(typeof e.atk=="string"&&e.atk.includes("d"))return e.atk;const M=typeof e.atk=="string"?parseInt(e.atk.replace(/[^0-9-]/g,"")):e.atk;return M>=0?`+${M}`:M})()})]}),t.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Attack"})]})]}),t.jsx(_r,{item:e,isEditMode:T,onUpdate:u,deleteConfirmations:L,setDeleteConfirmations:F})]}),t.jsx(Fr,{item:e,isEditMode:T,onUpdate:u}),t.jsx(Dr,{item:e,isEditMode:T,onUpdate:u,handleFeatureDeleteClick:y,deleteConfirmations:L,getFeatureKey:E}),t.jsx(Pr,{item:e,instances:m,isEditMode:T,type:i,onUpdate:u,onApplyDamage:l,onApplyHealing:d,onApplyStressChange:c}),t.jsx($r,{item:e,isEditMode:T,mode:o,onUpdate:u})]})]})})};if(S&&(i==="adversary"||i==="adversaries")){const b=i==="adversary",T=b?t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:k=>{var A;k.stopPropagation(),(A=_.current)!=null&&A.handleSave&&_.current.handleSave()},style:{background:"var(--purple)",border:"1px solid var(--purple)",color:"white",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:k=>{k.currentTarget.style.opacity="0.9"},onMouseLeave:k=>{k.currentTarget.style.opacity="1"},title:"Save",children:[t.jsx(Kt,{size:16}),t.jsx("span",{children:"Save"})]}),B&&t.jsxs("button",{onClick:k=>{k.stopPropagation(),B()},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:k=>{k.currentTarget.style.backgroundColor="var(--bg-hover)",k.currentTarget.style.borderColor="var(--purple)"},onMouseLeave:k=>{k.currentTarget.style.backgroundColor="var(--bg-secondary)",k.currentTarget.style.borderColor="var(--border)"},title:"Cancel",children:[t.jsx(rt,{size:16}),t.jsx("span",{children:"Cancel"})]})]}):null;return t.jsx(Ct,{tabContent:T,containerStyle:{padding:0,height:"auto",maxHeight:b?"calc(100vh - 120px)":"calc(100vh - 68px)",minHeight:0},children:t.jsx(kt,{ref:_,editingAdversary:e,onSave:w,onCancelEdit:B,isStockAdversary:P,embedded:!0,hideEmbeddedButtons:!0,allAdversaries:p,autoFocus:!e.baseName||e.baseName.trim()===""||e.baseName==="Unknown"})})}const j=S?"edit":o;return(j==="expanded"||j==="edit")&&(i==="adversary"||i==="adversaries")?v():i==="adversary"||i==="adversaries"?null:t.jsxs("div",{className:Z(),style:O(!0),children:[t.jsxs("div",{style:Fe.rowMain,children:[t.jsx("h4",{style:Fe.rowTitle,children:R()}),t.jsx("div",{style:Fe.rowMeta,children:C()})]}),t.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"12px",margin:0},children:["Expanded view coming soon for ",i]})]})},pt=Gr,Jr="/Daggerheart/assets/daggerheart-logo-fe7815ad.svg",Qe={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},Ke={lessDifficult:-1,twoOrMoreSolos:-2,increasedDamage:-2,lowerTierAdversary:1,noBruisersHordesLeadersSolos:1,moreDangerous:2};function Qt(e){return 3*e+2}function Zt(e,i){return e.reduce((o,a)=>{if(a.type==="adversary"){const l=Qe[a.item.type]||2;return a.item.type==="Minion"?o+Math.ceil(a.quantity/i)*l:o+l*a.quantity}return o},0)}function Ut(e){let i=0;return e.filter(l=>l.type==="adversary"&&l.item.type==="Solo"&&l.quantity>0).reduce((l,d)=>l+d.quantity,0)>=2&&(i+=Ke.twoOrMoreSolos),e.some(l=>l.type==="adversary"&&l.item.type&&["Bruiser","Horde","Leader","Solo"].includes(l.item.type)&&l.quantity>0)||(i+=Ke.noBruisersHordesLeadersSolos),i}function Yr(e,i={}){const o=Qt(e),a=Object.entries(i).filter(([l,d])=>d).reduce((l,[d,c])=>l+Ke[d],0);return o+a}let it={adversaries:[]},lt={environments:[]},jt=!1;function Xr(){const e=JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]"),i=JSON.parse(localStorage.getItem("daggerheart-custom-environments")||"[]");return{customAdversaries:e,customEnvironments:i}}async function er(){if(jt)return{adversariesData:it,environmentsData:lt};let e={adversaries:[]},i={environments:[]},o={adversaries:[]},a={environments:[]};try{const c=await Je(()=>import("./adversaries-9c8932de.js"),[]);e=(c==null?void 0:c.default)||c}catch(c){console.warn("Failed to load adversaries.json:",c)}try{const c=await Je(()=>import("./environments-c340637c.js"),[]);i=(c==null?void 0:c.default)||c}catch(c){console.warn("Failed to load environments.json:",c)}try{const c=await Je(()=>import("./playtest-adversaries-4a099c10.js"),[]);o=(c==null?void 0:c.default)||c}catch(c){console.warn("Failed to load playtest-adversaries.json:",c)}try{const c=await Je(()=>import("./playtest-environments-d9cdffb6.js"),[]);a=(c==null?void 0:c.default)||c}catch(c){console.warn("Failed to load playtest-environments.json:",c)}const{customAdversaries:l,customEnvironments:d}=Xr();return it={...e,adversaries:[...e.adversaries||[],...o.adversaries||[],...l]},lt={...i,environments:[...i.environments||[],...a.environments||[],...d]},jt=!0,{adversariesData:it,environmentsData:lt}}function _t(){return jt=!1,er()}const Qr=(e,i)=>{const[o,a]=h.useState("max-content"),l=h.useCallback(()=>{if(!i.current||e<=3)return"max-content";const d=i.current.offsetWidth,u=Math.floor(d/120);return u<=1?"max-content":e===4?"max-content max-content":e===5||e===6?u>=2?"max-content max-content":"max-content":e===7?u>=3?"max-content max-content max-content":u>=2?"max-content max-content":"max-content":"repeat(auto-fit, minmax(80px, max-content))"},[e,i]);return h.useEffect(()=>{const d=l();a(d);const c=new ResizeObserver(()=>{const u=l();a(u)});return i.current&&c.observe(i.current),()=>{c.disconnect()}},[l]),o},Zr=({encounter:e})=>{var l,d;const i=h.useRef(null),o=((l=e.encounterItems)==null?void 0:l.length)||0,a=Qr(o,i);return t.jsx("div",{ref:i,className:"saved-encounter-adversary-list",style:{flex:1,fontSize:"0.8rem",color:"var(--text-secondary)",lineHeight:"1.3",display:"grid",gridTemplateColumns:a,gap:"0.25rem 1rem",gridAutoRows:"min-content"},children:((d=e.encounterItems)==null?void 0:d.length)>0?e.encounterItems.map((c,u)=>{var f;const p=c.item.baseName||((f=c.item.name)==null?void 0:f.replace(/\s+\(\d+\)$/,""))||c.item.name;return t.jsxs("div",{style:{marginBottom:"0.125rem"},children:[c.quantity,"x ",p]},u)}):t.jsx("div",{children:"No adversaries"})})};let $e=it,tt=lt;const Ur=async()=>{const e=await er();$e=e.adversariesData,tt=e.environmentsData},en=(e,i=[],o=4,a=1,l=!1,d=null)=>{const[c,u]=h.useState(""),[p,f]=h.useState([{field:"tier",direction:"asc"},{field:"name",direction:"asc"}]),[m,r]=h.useState([]),[s,n]=h.useState(!0),[g,S]=h.useState([]),[w,B]=h.useState([]),[P,K]=h.useState(!1),[D,_]=h.useState(!1),L=h.useRef(null),F=h.useRef(null);h.useEffect(()=>{(async()=>{await Ur(),n(!1);let A=[];e==="adversary"?A=$e.adversaries||[]:e==="environment"&&(A=tt.environments||[]),r(A)})()},[e]),h.useEffect(()=>{e==="adversary"&&d&&(async()=>{const A=await _t();$e=A.adversariesData,tt=A.environmentsData;let V=[];l?V=($e.adversaries||[]).filter(M=>{var H;return M.source==="Homebrew"||((H=M.id)==null?void 0:H.startsWith("custom-"))}):V=$e.adversaries||[],r(V)})()},[d,e,l]);const E=k=>{const A=m.map(V=>V[k]).filter(Boolean);return[...new Set(A)].sort((V,M)=>typeof V=="number"&&typeof M=="number"?V-M:String(V).localeCompare(String(M)))},y=h.useCallback(async()=>{const k=await _t();$e=k.adversariesData,tt=k.environmentsData;let A=[];e==="adversary"?l?A=($e.adversaries||[]).filter(V=>{var M;return V.source==="Homebrew"||((M=V.id)==null?void 0:M.startsWith("custom-"))}):A=$e.adversaries||[]:e==="environment"&&(A=tt.environments||[]),r(A)},[e,l]);h.useEffect(()=>{y()},[l,y]);const O=E("tier"),Z=E("type"),R=h.useMemo(()=>{let k=m.filter(A=>{var $,te;const M=(A.name||A.baseName||"").toLowerCase().includes(c.toLowerCase())||(($=A.type)==null?void 0:$.toLowerCase().includes(c.toLowerCase()))||((te=A.description)==null?void 0:te.toLowerCase().includes(c.toLowerCase())),H=g.length===0||g.includes(A.tier.toString()),ne=w.length===0||w.includes(A.type);return M&&H&&ne});return k.sort((A,V)=>{for(const M of p){const{field:H,direction:ne}=M;let $=A[H],te=V[H];if(H==="tier")$=parseInt($)||0,te=parseInt(te)||0;else if(H==="atk")$=parseInt($)||0,te=parseInt(te)||0;else if(H==="cost"){const ce=he=>{if(e!=="adversary")return 0;const We=Qe[he.type]||2;let ve=0;const Te=i.filter(re=>re.type==="adversary"&&re.item.type==="Solo"&&re.quantity>0).reduce((re,xe)=>re+xe.quantity,0),Be=i.filter(re=>re.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(re.item.type)&&re.quantity>0).reduce((re,xe)=>re+xe.quantity,0);return he.type==="Solo"&&Te===1&&(ve+=2),["Bruiser","Horde","Leader","Solo"].includes(he.type)&&Be===0&&(ve+=1),We+ve};$=ce(A),te=ce(V)}else if(H==="difficulty"){const ce=parseInt($),he=parseInt(te);!isNaN(ce)&&!isNaN(he)?($=ce,te=he):!isNaN(ce)&&isNaN(he)?($=ce,te=999):isNaN(ce)&&!isNaN(he)?($=999,te=he):($=String($||"").toLowerCase(),te=String(te||"").toLowerCase())}else typeof $=="string"&&typeof te=="string"?($=$.toLowerCase(),te=te.toLowerCase()):($=String($||"").toLowerCase(),te=String(te||"").toLowerCase());if(ne==="asc"){if($>te)return 1;if($<te)return-1}else{if($<te)return 1;if($>te)return-1}}return 0}),k},[m,c,p,g,w,i,o,a]),C=k=>{f(A=>{const V=A.findIndex(M=>M.field===k);if(V>=0)if(V===0){const M=[...A];return M[0]={...M[0],direction:M[0].direction==="asc"?"desc":"asc"},M}else{const M=[...A];return M.splice(V,1)[0],[{field:k,direction:"asc"},...M]}else return[{field:k,direction:"asc"},...A]})},v=k=>{S(k==="clear"?[]:A=>A.includes(k)?A.filter(V=>V!==k):[...A,k])},j=k=>{B(k==="clear"?[]:A=>A.includes(k)?A.filter(V=>V!==k):[...A,k])},q=g.length>0,b=w.length>0;return h.useEffect(()=>{const k=V=>{const M=V.target.closest(".filter-dropdown"),H=V.target.closest(".header-filter-icon");M||H||(K(!1),_(!1))},A=V=>{V.key==="Escape"&&(K(!1),_(!1))};return document.addEventListener("pointerdown",k,!0),document.addEventListener("mousedown",k,!0),document.addEventListener("touchstart",k,!0),document.addEventListener("click",k,!0),document.addEventListener("keydown",A,!0),()=>{document.removeEventListener("pointerdown",k,!0),document.removeEventListener("mousedown",k,!0),document.removeEventListener("touchstart",k,!0),document.removeEventListener("click",k,!0),document.removeEventListener("keydown",A,!0)}},[K,_]),{searchTerm:c,setSearchTerm:u,sortFields:p,handleSort:C,filteredAndSortedData:R,loading:s,refreshData:y,selectedTiers:g,selectedTypes:w,showTierDropdown:P,setShowTierDropdown:K,showTypeDropdown:D,setShowTypeDropdown:_,tierFilterRef:L,typeFilterRef:F,uniqueTiers:O,uniqueTypes:Z,handleTierSelect:v,handleTypeSelect:j,isTierFiltered:q,isTypeFiltered:b,getDropdownStyle:k=>{if(!k.current)return{};const A=k.current.getBoundingClientRect();return{position:"fixed",top:A.bottom+4,left:A.left-100,zIndex:99999}}}},tn=({searchTerm:e,onSearchChange:i,type:o,partyControls:a,showCustomToggle:l=!1,onToggleCustom:d,filterCustom:c=!1,onExportCustomAdversaries:u,onImportCustomAdversaries:p,autoFocus:f=!1,onClose:m=null,placeholder:r="Search"})=>{const s=h.useRef(null);return h.useEffect(()=>{f&&s.current&&setTimeout(()=>{var n;(n=s.current)==null||n.focus()},100)},[f]),t.jsxs("div",{className:"browser-header",style:G.browserHeader,children:[t.jsx("div",{style:{display:"flex",alignItems:"center",flex:1,gap:"0.5rem"},children:t.jsx("input",{ref:s,type:"text",placeholder:r,value:e,onChange:n=>i(n.target.value),style:{...G.searchInput,flex:1,marginRight:0}})}),a&&t.jsx("div",{style:G.partyControls,children:a})]})},rn=({showCustomToggle:e=!1,onToggleCustom:i,filterCustom:o=!1,onExportCustomAdversaries:a,onImportCustomAdversaries:l})=>t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e&&t.jsxs("button",{onClick:()=>i&&i(!o),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:o?"var(--purple)":"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:o?"white":"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:d=>{o||(d.target.style.backgroundColor="var(--bg-hover)",d.target.style.borderColor="var(--purple)")},onMouseLeave:d=>{o||(d.target.style.backgroundColor="var(--bg-primary)",d.target.style.borderColor="var(--border)")},children:[t.jsx("span",{children:o?"✓":"○"}),"Custom Only"]}),t.jsxs("button",{onClick:a,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:d=>{d.target.style.backgroundColor="var(--bg-hover)",d.target.style.borderColor="var(--purple)"},onMouseLeave:d=>{d.target.style.backgroundColor="var(--bg-primary)",d.target.style.borderColor="var(--border)"},children:[t.jsx("span",{children:"↓"}),"Export"]}),t.jsxs("button",{onClick:()=>document.getElementById("import-file-input").click(),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:d=>{d.target.style.backgroundColor="var(--bg-hover)",d.target.style.borderColor="var(--purple)"},onMouseLeave:d=>{d.target.style.backgroundColor="var(--bg-primary)",d.target.style.borderColor="var(--border)"},children:[t.jsx("span",{children:"↑"}),"Import"]}),t.jsx("input",{id:"import-file-input",type:"file",accept:".csv,.json",onChange:l,style:{display:"none"}})]}),nn=({sortFields:e,onSort:i,type:o,uniqueTiers:a,uniqueTypes:l,selectedTiers:d,selectedTypes:c,showTierDropdown:u,setShowTierDropdown:p,showTypeDropdown:f,setShowTypeDropdown:m,tierFilterRef:r,typeFilterRef:s,handleTierSelect:n,handleTypeSelect:g,isTierFiltered:S,isTypeFiltered:w,getDropdownStyle:B,costFilter:P,showCostDropdown:K,setShowCostDropdown:D,costFilterRef:_,handleCostFilterSelect:L,isCostFiltered:F})=>{const[E,y]=h.useState(null),Z=(()=>o==="adversary"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0,hasCostFilter:!0},{key:"source",label:"Src"}]:o==="environment"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"}]:[])(),R=()=>{if(!K)return null;const v=[{value:"all",label:"All"},{value:"auto-grey",label:"Auto Grey"},{value:"auto-hide",label:"Auto Hide"}];return wt.createPortal(t.jsx("div",{className:"filter-dropdown",style:{...G.filterDropdown,...B(_),maxHeight:"60vh",overflow:"auto"},onMouseDown:j=>j.stopPropagation(),onClick:j=>j.stopPropagation(),children:v.map(j=>{const q=P===j.value;return t.jsxs("div",{style:{...G.filterOption,...q?G.filterOptionSelected:{}},onClick:()=>L(j.value),children:[t.jsx("span",{style:G.checkIcon,children:q?t.jsx(gt,{size:16}):t.jsx(yt,{size:16})}),t.jsx("span",{style:G.filterLabel,children:j.label})]},j.value)})}),document.body)},C=(v,j,q,b,T,k,A,V)=>{if(!T)return null;const M=()=>{(v==="tier"||v==="type")&&b("clear")};return wt.createPortal(t.jsxs("div",{className:"filter-dropdown",style:{...G.filterDropdown,...B(A),maxHeight:"60vh",overflow:"auto"},onMouseDown:H=>H.stopPropagation(),onClick:H=>H.stopPropagation(),children:[t.jsxs("div",{style:{...G.filterOption,...q.length===0?G.filterOptionSelected:{}},onClick:M,children:[t.jsx("span",{style:G.checkIcon,children:q.length===0?t.jsx(gt,{size:16}):t.jsx(yt,{size:16})}),t.jsx("span",{style:G.filterLabel,children:"All"})]}),j.map(H=>{const ne=q.includes(H.toString());return t.jsxs("div",{style:{...G.filterOption,...ne?G.filterOptionSelected:{}},onClick:()=>b(H.toString()),children:[t.jsx("span",{style:G.checkIcon,children:ne?t.jsx(gt,{size:16}):t.jsx(yt,{size:16})}),t.jsx("span",{style:G.filterLabel,children:H})]},H)})]}),document.body)};return t.jsx("tr",{style:G.tableHeader,children:Z.map(v=>t.jsxs("th",{style:{...G.tableHeaderCell,...E===v.key?G.tableHeaderCellHover:{},position:"relative",...v.key==="name"?{width:"auto",minWidth:"0"}:{},...v.key==="tier"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...v.key==="type"?{width:"80px",minWidth:"80px",maxWidth:"80px"}:{},...v.key==="source"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{}},onClick:()=>i(v.key),onMouseEnter:()=>y(v.key),onMouseLeave:()=>y(null),children:[v.hasFilter?t.jsxs("div",{style:G.headerWithFilter,children:[t.jsx("span",{style:{cursor:"pointer"},onClick:j=>{j.stopPropagation(),i(v.key)},children:v.label}),t.jsxs("button",{ref:v.key==="tier"?r:v.key==="type"&&v.hasCostFilter?_:v.key==="type"?s:_,style:{...G.headerFilterIcon,...v.key==="tier"&&S?G.headerFilterIconActive:{},...v.key==="type"&&(w||F)?G.headerFilterIconActive:{},...v.key==="cost"&&F?G.headerFilterIconActive:{}},className:"header-filter-icon",onClick:j=>{j.stopPropagation(),v.key==="tier"?(p(!u),m(!1),D(!1)):v.key==="type"&&(v.hasCostFilter?(D(!K),p(!1),m(!1)):(m(!f),p(!1),D(!1)))},children:[t.jsx(xr,{size:14}),v.key==="tier"&&S||v.key==="type"&&(w||F)||v.key==="cost"&&F?t.jsx("span",{style:G.filterActiveDot}):null]})]}):v.label,v.key==="tier"&&C("tier",a,d,n,u,p,r),v.key==="type"&&!v.hasCostFilter&&C("type",l,c,g,f,m,s),v.key==="type"&&v.hasCostFilter&&R()]},v.key))})},sn=({item:e,onAdd:i,type:o,onRowClick:a,encounterItems:l=[],pcCount:d=4,playerTier:c=1,remainingBudget:u=0,costFilter:p="auto-grey",isFocused:f=!1,rowRef:m=null,onDeleteCustomAdversary:r=null,isDeleteConfirmed:s=!1})=>{const[n,g]=h.useState(!1),S=()=>{i(e)},w=()=>{if(o!=="adversary")return null;const K=Qe[e.type]||2;let D=0;const _=l.filter(F=>F.type==="adversary"&&F.item.type==="Solo"&&F.quantity>0).reduce((F,E)=>F+E.quantity,0),L=l.filter(F=>F.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(F.item.type)&&F.quantity>0).reduce((F,E)=>F+E.quantity,0);return e.type==="Solo"&&_===1&&(D+=2),["Bruiser","Horde","Leader","Solo"].includes(e.type)&&L===0&&(D+=1),K+D},P=(()=>{if(o==="adversary"){const K=w();Qe[e.type];const D=K>u||u<=0;if(p==="auto-hide"&&D)return null;const _=p==="auto-grey"&&D?{opacity:.5,color:"var(--text-secondary)"}:{};return e.description||e.motives?[[t.jsx("td",{style:{...G.rowCell,width:"auto",minWidth:"0",textAlign:"left",..._,borderBottom:"none",padding:"0.25rem 0.25rem 0 0.5rem",outline:"none"},children:t.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%",display:"flex",alignItems:"center",gap:"0.5rem"},children:t.jsx("div",{style:{flex:1,minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.jsx("div",{style:{fontWeight:"600"},children:e.name||e.baseName||""})})})},"name"),t.jsx("td",{style:{...G.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",..._,borderBottom:"none",padding:"0.25rem 0.25rem 0 0.25rem",outline:"none"},children:e.tier},"tier"),t.jsx("td",{style:{...G.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center",..._,borderBottom:"none",padding:"0.25rem 0.25rem 0 0.25rem",outline:"none"},children:e.type},"type"),t.jsx("td",{style:{...G.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",..._,borderBottom:"none",outline:"none"},rowSpan:2,children:e.source==="Homebrew"||e.isCustom?(n||f||s)&&r?t.jsx("button",{onClick:L=>{L.stopPropagation(),r(e.id)},style:{background:s?"var(--danger)":"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"4px",padding:"0.25rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:s?"var(--text-primary)":"var(--danger)",transition:"all 0.2s ease",flexShrink:0,width:"24px",height:"24px",margin:"0 auto"},title:s?"Click again to confirm delete":"Delete custom adversary",children:t.jsx(Nt,{size:14})}):t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",margin:"0 auto"},children:t.jsx(zt,{size:14,style:{color:"var(--text-secondary)",opacity:.7},title:"Custom adversary"})}):t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",margin:"0 auto"},children:t.jsx(Wt,{size:14,style:{color:"var(--text-secondary)",opacity:.7},title:"Stock adversary"})})},"source")],[t.jsx("td",{colSpan:3,style:{...G.rowCell,textAlign:"left",..._,padding:"0 0.25rem 0.25rem 0.5rem",borderTop:"none",borderBottom:"none",outline:"none"},children:t.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.description||e.motives||""})},"desc")]]:t.jsxs(t.Fragment,{children:[t.jsx("td",{style:{...G.rowCell,width:"auto",minWidth:"0",textAlign:"left",..._,paddingLeft:"0.5rem"},children:t.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%",display:"flex",alignItems:"center",gap:"0.5rem"},children:t.jsx("div",{style:{flex:1,minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.jsx("div",{style:{fontWeight:"600"},children:e.name||e.baseName||""})})})}),t.jsx("td",{style:{...G.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",..._},children:e.tier}),t.jsx("td",{style:{...G.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center",..._},children:e.type}),t.jsx("td",{style:{...G.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",..._},children:e.source==="Homebrew"||e.isCustom?(n||f||s)&&r?t.jsx("button",{onClick:L=>{L.stopPropagation(),r(e.id)},style:{background:s?"var(--danger)":"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"4px",padding:"0.25rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:s?"var(--text-primary)":"var(--danger)",transition:"all 0.2s ease",flexShrink:0,width:"24px",height:"24px",margin:"0 auto"},title:s?"Click again to confirm delete":"Delete custom adversary",children:t.jsx(Nt,{size:14})}):t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",margin:"0 auto"},children:t.jsx(zt,{size:14,style:{color:"var(--text-secondary)",opacity:.7},title:"Custom adversary"})}):t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",margin:"0 auto"},children:t.jsx(Wt,{size:14,style:{color:"var(--text-secondary)",opacity:.7},title:"Stock adversary"})})})]})}else if(o==="environment")return t.jsxs(t.Fragment,{children:[t.jsx("td",{style:{...G.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:e.name||e.baseName||""}),t.jsx("td",{style:{...G.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:e.tier}),t.jsx("td",{style:{...G.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:e.type}),t.jsx("td",{style:{...G.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:e.difficulty})]});return null})();return P===null?null:Array.isArray(P)?t.jsx(t.Fragment,{children:P.map((K,D)=>t.jsx("tr",{ref:D===0?m:null,style:{...G.row,...n?G.rowHover:{},...f?G.rowFocused:{},...D===0?{borderBottom:"none"}:{},...D===1?{borderTop:"none",height:"auto",outline:"none"}:{}},onClick:()=>{o==="adversary"?S():a&&a(e,o)},onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:K},D))}):t.jsx(t.Fragment,{children:t.jsx("tr",{ref:m,style:{...G.row,...n?G.rowHover:{},...f?G.rowFocused:{}},onClick:()=>{o==="adversary"?S():a&&a(e,o)},onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:P})})},tr=({type:e,onAddItem:i,onCancel:o=null,onRowClick:a,encounterItems:l=[],pcCount:d=4,playerTier:c=1,partyControls:u=null,showContainer:p=!0,savedEncounters:f=[],onLoadEncounter:m,onDeleteEncounter:r,activeTab:s="adversaries",selectedCustomAdversaryId:n,onSelectCustomAdversary:g,onTabChange:S,selectedAdversary:w,onSelectAdversary:B,filterCustom:P=!1,showCustomToggle:K=!1,onToggleCustom:D,onExportCustomAdversaries:_,onImportCustomAdversaries:L,autoFocus:F=!1,hideImportExport:E=!1,onClose:y=null,searchPlaceholder:O="Search"})=>{const{addCustomAdversary:Z,updateCustomAdversary:R,deleteCustomAdversary:C,customContent:v,adversaries:j,deleteAdversary:q}=ft(),[b,T]=h.useState(null),[k,A]=h.useState("all"),[V,M]=h.useState(!1),[H,ne]=h.useState({}),[$,te]=h.useState({}),ce=h.useRef({}),he=h.useRef({}),We=h.useRef(null),[ve,Te]=h.useState(-1),[Be,re]=h.useState(null),xe=h.useRef({}),ue=()=>{try{const N=v.adversaries||[];if(N.length===0){alert("No custom adversaries to export.");return}const Q=["name","tier","type","difficulty","threshold_major","threshold_severe","hp_max","stress_max","atk","weapon","range","damage","description","motives"],ae=N.map(de=>{var ee,ge;return[de.name||"",de.tier||"",de.type||"",de.difficulty||"",((ee=de.thresholds)==null?void 0:ee.major)||"",((ge=de.thresholds)==null?void 0:ge.severe)||"",de.hpMax||"",de.stressMax||"",de.atk||"",de.weapon||"",de.range||"",de.damage||"",de.description||"",de.motives||""]}),Ie=de=>{const ee=String(de);return ee.includes(",")||ee.includes('"')||ee.includes(`
`)?`"${ee.replace(/"/g,'""')}"`:ee},ye=[Q.join(","),...ae.map(de=>de.map(Ie).join(","))].join(`
`),be=new Blob([ye],{type:"text/csv;charset=utf-8;"}),ke=URL.createObjectURL(be),ie=document.createElement("a");ie.href=ke,ie.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(ie),ie.click(),document.body.removeChild(ie),URL.revokeObjectURL(ke),console.log(`Exported ${N.length} custom adversaries to CSV`)}catch(N){console.error("Failed to export custom adversaries:",N),alert("Failed to export custom adversaries. Please try again.")}},Ae=N=>{const Q=N.target.files[0];if(!Q)return;const ae=Q.name.endsWith(".csv"),Ie=Q.name.endsWith(".json");if(!ae&&!Ie){alert("Please upload a CSV or JSON file."),N.target.value="";return}const ye=new FileReader;ye.onload=be=>{try{let ke=[];if(ae){const le=be.target.result.split(`
`).filter(ze=>ze.trim());if(le.length<2)throw new Error("CSV file is empty or invalid.");const me=le[0].split(",").map(ze=>ze.trim().replace(/^"|"$/g,""));for(let ze=1;ze<le.length;ze++){const fe=[];let Re="",He=!1;for(let Me=0;Me<le[ze].length;Me++){const Oe=le[ze][Me],ar=le[ze][Me+1];Oe==='"'&&He&&ar==='"'?(Re+='"',Me++):Oe==='"'?He=!He:Oe===","&&!He?(fe.push(Re.trim()),Re=""):Re+=Oe}fe.push(Re.trim());const st={name:fe[me.indexOf("name")]||"",tier:parseInt(fe[me.indexOf("tier")])||1,type:fe[me.indexOf("type")]||"Standard",difficulty:parseInt(fe[me.indexOf("difficulty")])||11,thresholds:{major:parseInt(fe[me.indexOf("threshold_major")])||7,severe:parseInt(fe[me.indexOf("threshold_severe")])||12},hpMax:parseInt(fe[me.indexOf("hp_max")])||3,stressMax:parseInt(fe[me.indexOf("stress_max")])||1,atk:parseInt(fe[me.indexOf("atk")])||1,weapon:fe[me.indexOf("weapon")]||"",range:fe[me.indexOf("range")]||"Melee",damage:fe[me.indexOf("damage")]||"",description:fe[me.indexOf("description")]||"",motives:fe[me.indexOf("motives")]||"",source:"Homebrew"};st.name&&ke.push(st)}}else if(Ie){const we=JSON.parse(be.target.result);if(!we.customAdversaries||!Array.isArray(we.customAdversaries))throw new Error("Invalid JSON format. Expected customAdversaries array.");ke=we.customAdversaries}const ie=v.adversaries||[],de=[...ie];let ee=0,ge=0;ke.forEach(we=>{if(ie.some(me=>me.name===we.name&&me.source===we.source))ge++;else{const me={...we,id:`custom-adv-${Date.now()}-${Math.random().toString(36).slice(2,10)}`,hp:0,stress:0};de.push(me),ee++}}),ee>0?(localStorage.setItem("daggerheart-custom-adversaries",JSON.stringify(de)),window.location.reload(),alert(`Import successful! Added ${ee} new adversaries${ge>0?`, skipped ${ge} duplicates`:""}.`)):alert("No new adversaries were added. All imported adversaries already exist.")}catch(ke){console.error("Failed to import custom adversaries:",ke),alert(`Failed to import custom adversaries: ${ke.message}`)}},ye.readAsText(Q),N.target.value=""},je=()=>{T(null)},Ne=async(N,Q)=>{Q?R(Q,N):Z(N)},Pe=N=>{H[N]?(r&&r(N),ne(Q=>{const ae={...Q};return delete ae[N],ae}),ce.current[N]&&(clearTimeout(ce.current[N]),delete ce.current[N])):(ne(Q=>({...Q,[N]:!0})),ce.current[N]&&clearTimeout(ce.current[N]),ce.current[N]=setTimeout(()=>{ne(Q=>{const ae={...Q};return delete ae[N],ae}),delete ce.current[N]},3e3))},Ze=N=>{$[N]?(j.filter(ae=>ae.customContentId===N).forEach(ae=>{q(ae.id)}),C(N),te(ae=>{const Ie={...ae};return delete Ie[N],Ie}),he.current[N]&&(clearTimeout(he.current[N]),delete he.current[N])):(te(Q=>({...Q,[N]:!0})),he.current[N]&&clearTimeout(he.current[N]),he.current[N]=setTimeout(()=>{te(Q=>{const ae={...Q};return delete ae[N],ae}),delete he.current[N]},3e3))};h.useEffect(()=>()=>{Object.values(ce.current).forEach(N=>{clearTimeout(N)}),Object.values(he.current).forEach(N=>{clearTimeout(N)})},[]);const{searchTerm:De,setSearchTerm:Ue,sortFields:x,handleSort:W,filteredAndSortedData:z,loading:X,selectedTiers:I,selectedTypes:se,showTierDropdown:pe,setShowTierDropdown:U,showTypeDropdown:J,setShowTypeDropdown:oe,tierFilterRef:Se,typeFilterRef:Ee,uniqueTiers:Le,uniqueTypes:nt,handleTierSelect:_e,handleTypeSelect:ht,isTierFiltered:xt,isTypeFiltered:Et,getDropdownStyle:rr}=en(e,l,d,c,P,v),At=h.useRef(De),It=h.useRef(JSON.stringify(I)),Tt=h.useRef(JSON.stringify(se));h.useEffect(()=>{const N=At.current!==De,Q=It.current!==JSON.stringify(I),ae=Tt.current!==JSON.stringify(se);(N||Q||ae)&&(Te(-1),re(null),At.current=De,It.current=JSON.stringify(I),Tt.current=JSON.stringify(se))},[De,I,se]),h.useEffect(()=>{if(s!=="adversaries")return;const N=Q=>{const ae=document.activeElement;if(ae&&["INPUT","TEXTAREA","SELECT"].includes(ae.tagName))if(Q.key==="ArrowDown"||Q.key==="ArrowUp"||Q.key==="Enter")(Q.key!=="Enter"||ae.tagName!=="INPUT")&&ae.blur();else return;const Ie=z.length-1;if(Q.key==="ArrowDown")Q.preventDefault(),Te(ye=>{var ke;const be=ye<Ie?ye+1:ye;return be>=0&&be<z.length&&(re(((ke=z[be])==null?void 0:ke.id)||null),xe.current[be]&&setTimeout(()=>{const ie=xe.current[be];if(ie){const de=ie.closest(".browser-content");if(de){const ee=de.getBoundingClientRect(),ge=ie.getBoundingClientRect(),we=ie.nextElementSibling,le=we&&we.tagName==="TR"&&we.querySelector("td[colspan]");let me=ge.height;le&&(me+=we.getBoundingClientRect().height);const ze=ge.bottom-ee.top,fe=ee.height,Re=ze>=fe-1,He=ge.bottom>ee.bottom;if(Re||He){let Me=ie.offsetTop+me-fe;const Oe=de.scrollHeight-fe;Me=Math.min(Me,Oe),Me=Math.max(0,Me),de.scrollTo({top:Me,behavior:"smooth"})}}else ie.scrollIntoView({behavior:"smooth",block:"end"})}},0)),be});else if(Q.key==="ArrowUp")Q.preventDefault(),Te(ye=>{var ke;if(ye<=0)return re(null),setTimeout(()=>{const ie=document.querySelector('.browser-header input[type="text"]');ie==null||ie.focus()},0),-1;const be=ye-1;return be>=0&&be<z.length?(re(((ke=z[be])==null?void 0:ke.id)||null),xe.current[be]&&setTimeout(()=>{const ie=xe.current[be];if(ie){const de=ie.closest(".browser-content");if(de){const ee=de.getBoundingClientRect(),ge=ie.getBoundingClientRect(),we=(()=>{const fe=ie.closest("table"),Re=fe==null?void 0:fe.querySelector("thead");return Re?Re.getBoundingClientRect().height:0})(),le=ge.top-ee.top,me=Math.abs(le-we)<=1;if(ge.top<ee.top||me){const fe=ie.nextElementSibling,Re=fe&&fe.tagName==="TR"&&fe.querySelector("td[colspan]");let He=ge.height;Re&&(He+=fe.getBoundingClientRect().height);let Me=ie.offsetTop-we;const Oe=de.scrollHeight-de.clientHeight;Me=Math.min(Me,Oe),Me=Math.max(0,Me),de.scrollTo({top:Me,behavior:"smooth"})}}else ie.scrollIntoView({behavior:"smooth",block:"start"})}},0)):re(null),be});else if(Q.key==="Enter"&&ve>=0&&ve<=Ie){Q.preventDefault();const ye=z[ve];ye&&i&&i(ye)}};return document.addEventListener("keydown",N),()=>{document.removeEventListener("keydown",N)}},[s,z,ve,i]);const nr=(()=>{const N=3*d+2,Q=l.reduce((ee,ge)=>{if(ge.type==="adversary"){const we=Qe[ge.item.type]||2;if(ge.item.type==="Minion"){const le=Math.ceil(ge.quantity/d);return ee+le*we}else return ee+ge.quantity*we}return ee},0);let ae=0;l.filter(ee=>ee.type==="adversary"&&ee.item.type==="Solo"&&ee.quantity>0).reduce((ee,ge)=>ee+ge.quantity,0)>=2&&(ae+=Ke.twoOrMoreSolos);const ye=l.some(ee=>ee.type==="adversary"&&ee.item.type==="Bruiser"&&ee.quantity>0),be=l.some(ee=>ee.type==="adversary"&&ee.item.type==="Horde"&&ee.quantity>0),ke=l.some(ee=>ee.type==="adversary"&&ee.item.type==="Leader"&&ee.quantity>0),ie=l.some(ee=>ee.type==="adversary"&&ee.item.type==="Solo"&&ee.quantity>0);return!ye&&!be&&!ke&&!ie&&(ae+=Ke.noBruisersHordesLeadersSolos),N+ae-Q})(),sr=N=>{A(N),M(!1)},or=k!=="all";return X?t.jsx("div",{style:G.browser,children:t.jsx("div",{style:G.loading,children:"Loading..."})}):t.jsx(t.Fragment,{children:t.jsxs("div",{style:p?G.browserWrapper:G.browserWrapperNoContainer,children:[s==="adversaries"&&t.jsxs(t.Fragment,{children:[t.jsx(tn,{searchTerm:De,onSearchChange:Ue,type:e,partyControls:u,autoFocus:F,onClose:y,placeholder:O}),!E&&t.jsx(rn,{showCustomToggle:K,onToggleCustom:D,filterCustom:P,onExportCustomAdversaries:ue,onImportCustomAdversaries:Ae}),t.jsx("div",{className:"browser-content invisible-scrollbar",style:G.browserContent,children:t.jsxs("table",{style:G.browserTable,children:[t.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,backgroundColor:"var(--bg-primary)"},children:t.jsx(nn,{sortFields:x,onSort:W,type:e,uniqueTiers:Le,uniqueTypes:nt,selectedTiers:I,selectedTypes:se,showTierDropdown:pe,setShowTierDropdown:U,showTypeDropdown:J,setShowTypeDropdown:oe,tierFilterRef:Se,typeFilterRef:Ee,handleTierSelect:_e,handleTypeSelect:ht,isTierFiltered:xt,isTypeFiltered:Et,getDropdownStyle:rr,costFilter:k,showCostDropdown:V,setShowCostDropdown:M,costFilterRef:We,handleCostFilterSelect:sr,isCostFiltered:or})}),t.jsx("tbody",{children:z.map((N,Q)=>t.jsx(sn,{item:N,onAdd:i,type:e,onRowClick:a,encounterItems:l,pcCount:d,playerTier:c,remainingBudget:nr,costFilter:k,isFocused:Be===N.id||ve===Q,onDeleteCustomAdversary:e==="adversary"?Ze:null,isDeleteConfirmed:$[N.id]||!1,rowRef:ae=>{ae?xe.current[Q]=ae:delete xe.current[Q]}},N.id))})]})})]}),s==="encounters"&&t.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:f.length===0?t.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",textAlign:"center",padding:"2rem 1rem"},children:"No saved encounters yet"}):t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:f.map(N=>t.jsxs("div",{onClick:()=>m&&m(N.id),className:"saved-encounter-card",style:{border:"1px solid var(--border)",borderRadius:"8px",padding:"8px",backgroundColor:"var(--bg-card)",transition:"background-color 0.2s ease",display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[t.jsxs("div",{style:{minWidth:"100px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",flexDirection:"column",justifyContent:"center",minHeight:"60px"},children:[t.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Tier: ",(()=>{var Ie,ye,be,ke;const Q=((ke=(be=(ye=(Ie=N.encounterItems)==null?void 0:Ie.filter(ie=>ie.type==="adversary"))==null?void 0:ye.map(ie=>ie.item.tier))==null?void 0:be.filter(ie=>ie!=null))==null?void 0:ke.sort((ie,de)=>ie-de))||[];if(Q.length===0)return"N/A";if(Q.length===1)return Q[0];const ae=[...new Set(Q)];return ae.length===1?ae[0]:`${Math.min(...ae)}-${Math.max(...ae)}`})()]}),t.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Party Size: ",N.partySize||4]}),t.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)"},children:["Balance: ",(()=>{const Q=N.partySize||4,ae=3*Q+2;let Ie=0;const ye=N.encounterItems||[];ye.filter(le=>le.type==="adversary"&&le.item.type==="Solo"&&le.quantity>0).reduce((le,me)=>le+me.quantity,0)>=2&&(Ie+=Ke.twoOrMoreSolos);const ke=ye.some(le=>le.type==="adversary"&&le.item.type==="Bruiser"&&le.quantity>0),ie=ye.some(le=>le.type==="adversary"&&le.item.type==="Horde"&&le.quantity>0),de=ye.some(le=>le.type==="adversary"&&le.item.type==="Leader"&&le.quantity>0),ee=ye.some(le=>le.type==="adversary"&&le.item.type==="Solo"&&le.quantity>0);!ke&&!ie&&!de&&!ee&&(Ie+=Ke.noBruisersHordesLeadersSolos);const ge=ae+Ie,we=ye.reduce((le,me)=>{if(me.type==="adversary"){const ze=Qe[me.item.type]||2;if(me.item.type==="Minion"){const fe=Math.ceil(me.quantity/Q);return le+fe*ze}else return le+me.quantity*ze}return le},0);return we>ge?`+${we-ge}`:we===ge?"0":`-${ge-we}`})()]})]}),t.jsx("div",{style:{minWidth:"120px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",alignItems:"center",minHeight:"60px"},children:t.jsx("div",{style:{fontWeight:"500",color:"var(--text-primary)",fontSize:"0.9rem",wordWrap:"break-word",wordBreak:"break-word",width:"150px",maxWidth:"150px"},children:N.name})}),t.jsx(Zr,{encounter:N}),t.jsx("button",{onClick:Q=>{Q.stopPropagation(),Pe(N.id)},style:{background:H[N.id]?"var(--danger)":"var(--gray-600)",border:"none",color:"white",padding:"0.4rem 0.8rem",borderRadius:"4px",fontSize:"0.75rem",cursor:"pointer",minWidth:"60px",transition:"background-color 0.2s"},children:"Delete"})]},N.id))})}),s==="create"&&t.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"1rem",display:"flex",justifyContent:"center",alignItems:"flex-start",height:"100%",minHeight:0},children:t.jsx("div",{style:{maxWidth:"600px",width:"100%",height:"auto",display:"flex",flexDirection:"column",padding:"0",overflowY:"visible",overflowX:"hidden",minHeight:0},children:t.jsx(kt,{onSave:Ne,onRefresh:()=>{},onAddItem:i,editingAdversary:b,onCancelEdit:je,embedded:!1})})}),s==="info"&&t.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"2rem"},children:[t.jsxs("div",{style:{marginBottom:"2rem",textAlign:"center"},children:[t.jsx("img",{src:Jr,alt:"Daggerheart Community Content Logo",style:{width:"100%",maxWidth:"300px",height:"auto",margin:"0 auto 1.5rem auto",display:"block"},onError:N=>{console.error("Failed to load Daggerheart logo:",N.target.src),N.target.style.display="none"}}),t.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",textAlign:"left",maxWidth:"600px",margin:"0 auto"},children:[t.jsx("p",{style:{marginTop:0},children:"This product includes materials from the Daggerheart System Reference Document 1.0, © Critical Role, LLC, under the terms of the Darrington Press Community Gaming (DPCGL) License."}),t.jsxs("p",{children:["More information can be found at ",t.jsx("a",{href:"https://www.daggerheart.com",target:"_blank",rel:"noopener noreferrer",style:{color:"var(--purple)",textDecoration:"underline"},children:"daggerheart.com"})]}),t.jsx("p",{style:{marginBottom:0},children:t.jsx("em",{children:"This project is unofficial and not endorsed by Darrington Press or Critical Role."})})]})]}),t.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto",border:"1px solid var(--border)",borderRadius:"8px",overflow:"hidden"},children:[t.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"1rem 1.5rem",color:"var(--text-primary)",border:"none",background:"var(--bg-secondary)",width:"100%",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"0.875rem",borderBottom:"1px solid var(--border)"},onMouseEnter:N=>{N.target.style.backgroundColor="var(--bg-hover)"},onMouseLeave:N=>{N.target.style.backgroundColor="var(--bg-secondary)"},onClick:N=>{N.stopPropagation(),window.open("https://github.com/Splinter714/Daggerheart","_blank")},children:[t.jsx("span",{children:"View on GitHub"}),t.jsx("span",{children:"→"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem 1.5rem",color:"var(--text-secondary)",background:"var(--bg-secondary)",fontSize:"0.875rem"},children:["Version ","0.4.17 (36a75f5)"]})]})]})]})})},G={browserWrapper:{display:"flex",flexDirection:"column",background:"var(--bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border)",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserWrapperNoContainer:{display:"flex",flexDirection:"column",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserContent:{flex:1,overflowY:"auto",overflowX:"visible",padding:0,width:"100%",scrollbarWidth:"none",msOverflowStyle:"none",borderRadius:"0 0 8px 8px"},tableHeaderContainer:{flexShrink:0,position:"sticky",top:0,zIndex:15,backgroundColor:"var(--bg-secondary)"},browserTable:{width:"100%",minWidth:"100%",borderCollapse:"collapse",tableLayout:"fixed",background:"var(--bg-primary)",margin:0},browserHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--gray-900)",flexShrink:0,position:"sticky",top:0,zIndex:20},browserTitle:{margin:0,color:"var(--text-primary)",fontSize:"18px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"24px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",marginRight:"12px",transition:"all 0.2s ease"},partyControls:{display:"flex",alignItems:"center",gap:"12px",flexShrink:0},searchInputFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 3px rgba(139, 92, 246, 0.1)"},tableHeader:{background:"var(--gray-900)",borderBottom:"1px solid var(--border)",boxShadow:"0 1px 0 var(--border)",position:"sticky",top:"0",zIndex:10},tableHeaderCell:{backgroundColor:"var(--gray-900)",fontWeight:"700",borderBottom:"1px solid var(--border)",cursor:"pointer",userSelect:"none",minWidth:"100px",whiteSpace:"nowrap",padding:"4px 4px",color:"var(--text-primary)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",boxShadow:"0 1px 0 var(--border)",transition:"background-color 0.2s",position:"sticky",top:"0",zIndex:10},tableHeaderCellHover:{backgroundColor:"var(--bg-hover)"},sortIndicator:{fontSize:"12px",color:"var(--text-secondary)"},tableBody:{flex:1,overflowY:"auto",padding:"8px",backgroundColor:"var(--bg-primary)"},row:{height:"auto",minHeight:"35px",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s ease",cursor:"pointer",backgroundColor:"var(--gray-900)"},rowHover:{backgroundColor:"var(--bg-secondary)"},rowFocused:{backgroundColor:"var(--bg-secondary)",boxShadow:"inset 0 0 0 2px var(--purple)"},expandedRow:{backgroundColor:"var(--bg-secondary)"},rowCell:{padding:"4px 4px",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid var(--border)"},rowCellName:{fontWeight:"500",minWidth:"150px"},rowCellCenter:{textAlign:"center",justifyContent:"center",minWidth:"80px"},rowActions:{width:"80px",textAlign:"center",padding:"4px 8px",borderBottom:"1px solid var(--border)"},addButton:{width:"2rem",height:"2rem",border:"1px solid var(--purple)",borderRadius:"var(--radius-sm)",background:"var(--purple)",color:"white",cursor:"pointer",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"500"},expandedContent:{padding:"0",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)"},columnName:{width:"auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",paddingLeft:"8px",textAlign:"left"},columnTier:{width:"80px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnType:{width:"100px",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},columnDifficulty:{width:"40px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnAction:{width:"32px",minWidth:"24px",maxWidth:"24px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"visible",textOverflow:"unset"},loading:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"var(--text-primary)",fontSize:"16px"},mobileBrowser:{width:"95vw",height:"90vh",maxWidth:"none"},mobileSearchInput:{fontSize:"16px"},headerWithFilter:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0px",position:"relative"},headerFilterIcon:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"2px 4px",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",position:"relative",marginLeft:"-2px"},headerFilterIconActive:{color:"var(--purple)"},filterIcon:{fontSize:"12px"},filterActiveDot:{position:"absolute",left:"50%",top:"2px",transform:"translateX(-50%)",width:"4px",height:"4px",borderRadius:"50%",background:"var(--purple)",pointerEvents:"none"},filterDropdown:{position:"fixed",background:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",zIndex:99999,marginTop:"4px",overflow:"hidden",width:"max-content",minWidth:"120px",maxWidth:"200px"},filterOption:{padding:"8px 12px",cursor:"pointer",color:"var(--text-primary)",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background-color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},filterOptionSelected:{backgroundColor:"var(--bg-hover)"},checkIcon:{width:"16px",height:"16px",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"12px"},filterLabel:{flex:1}},on=({isOpen:e,onClose:i,onAddAdversary:o,onAddAdversariesBulk:a,onAddEnvironment:l,onDeleteAdversary:d,onDeleteEnvironment:c,onDeleteCountdown:u,adversaries:p=[],environments:f=[],countdowns:m=[],savedEncounters:r=[],onSaveEncounter:s,onLoadEncounter:n,onDeleteEncounter:g})=>{const{partySize:S,updatePartySize:w,currentEncounterName:B,updateCurrentEncounterName:P,customContent:K}=ft(),D=S,_=w,[L,F]=h.useState({lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),[E,y]=h.useState([]),[O,Z]=h.useState(B||"Encounter"),[R,C]=h.useState("adversaries"),[v,j]=h.useState(null),[q,b]=h.useState(null),[T,k]=h.useState(null),[A,V]=h.useState(null),[M,H]=h.useState(!1);h.useEffect(()=>{e&&!v&&Z(B||"Encounter")},[e,v,B]);const ne=()=>q?O!==q.name||JSON.stringify(E)!==JSON.stringify(q.encounterItems)||D!==q.partySize||JSON.stringify(L)!==JSON.stringify(q.battlePointsAdjustments):!1,$=()=>{var x;if(E.length>0||(O||"").trim()!=="Encounter")return!0;if(v&&ne()){if(q){const W=E.length,z=((x=q.encounterItems)==null?void 0:x.length)||0;if(W!==z||(O||"").trim()!==(q.name||""))return!0;const X=JSON.stringify(L),I=JSON.stringify(q.battlePointsAdjustments||{});return X!==I}return!0}return!1},te=({onClick:x,children:W,variant:z="secondary",isConfirmation:X=!1})=>{const I=z==="danger"||z==="secondary"&&X,se=z==="purple";return t.jsx("button",{onClick:x,style:{background:I?"var(--danger)":se?"var(--purple)":"var(--bg-secondary)",border:se?"none":"1px solid var(--border)",color:I||se?"white":"var(--text-primary)",padding:"0.375rem 0.75rem",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s",width:"70px",fontSize:"0.875rem"},children:W})},ce=Ve.useRef(D),he=h.useCallback(x=>!x||x.length===0?null:r.find(z=>{var pe,U;if(((pe=z.encounterItems)==null?void 0:pe.length)!==x.length)return!1;const X=J=>{var oe;return{type:J.type,quantity:J.quantity,item:{name:J.item.baseName||((oe=J.item.name)==null?void 0:oe.replace(/\s+\(\d+\)$/,""))||J.item.name,type:J.item.type,tier:J.item.tier}}},I=(U=z.encounterItems)==null?void 0:U.map(X).sort((J,oe)=>J.item.name.localeCompare(oe.item.name)||J.item.type.localeCompare(oe.item.type)),se=x.map(X).sort((J,oe)=>J.item.name.localeCompare(oe.item.name)||J.item.type.localeCompare(oe.item.type));return JSON.stringify(I)===JSON.stringify(se)})||null,[r]);Ve.useEffect(()=>{if(e&&p.length>0&&E.length===0){const x={};p.forEach(X=>{var se;const I=X.baseName||((se=X.name)==null?void 0:se.replace(/\s+\(\d+\)$/,""))||X.name;x[I]||(x[I]={type:"adversary",item:X,quantity:0}),x[I].quantity+=1});const W=Object.values(x);y(W);const z=he(W);z&&!v&&(j(z.id),b({name:z.name||"",encounterItems:z.encounterItems||[],partySize:z.partySize||4,battlePointsAdjustments:z.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),Z(z.name||"Encounter"),P(z.name||"Encounter"))}else e&&p.length===0&&E.length===0&&y([])},[e,he,v,P]);const We=Ve.useMemo(()=>Ut(E),[E]),ve=Yr(D,L)+We,Te=Zt(E,D);Ve.useEffect(()=>{const x=ce.current;x!==D&&(y(W=>W.map(z=>{if(z.type==="adversary"&&z.item.type==="Minion"){const I=Math.ceil(z.quantity/x)*D;return{...z,quantity:I}}return z})),ce.current=D)},[D]);const Be=(x,W)=>{const z=E.findIndex(se=>se.item.id===x.id&&se.type===W),X=x.type==="Minion"?D:1;let I;z>=0?I=E.map((se,pe)=>pe===z?{...se,quantity:se.quantity+X}:se):I=[...E,{item:x,type:W,quantity:X}],y(I),re(I)},re=x=>{const W=p||[],z=[];x.forEach(U=>{for(let J=0;J<U.quantity;J++)U.type==="adversary"&&z.push(U.item)});const X={};W.forEach(U=>{var oe;const J=U.baseName||((oe=U.name)==null?void 0:oe.replace(/\s+\(\d+\)$/,""))||U.name;X[J]||(X[J]=[]),X[J].push(U)});const I={};z.forEach(U=>{var oe;const J=U.baseName||((oe=U.name)==null?void 0:oe.replace(/\s+\(\d+\)$/,""))||U.name;I[J]||(I[J]=[]),I[J].push(U)});const se=[],pe=[];Object.keys(I).forEach(U=>{var Se;const J=((Se=X[U])==null?void 0:Se.length)||0,oe=I[U].length;if(oe>J){const Ee=oe-J;for(let Le=0;Le<Ee;Le++)se.push(I[U][0])}else if(oe<J){const Ee=J-oe,nt=[...X[U]].sort((_e,ht)=>{const xt=_e.duplicateNumber||1;return(ht.duplicateNumber||1)-xt});for(let _e=0;_e<Ee;_e++)pe.push(nt[_e].id)}}),Object.keys(X).forEach(U=>{I[U]||[...X[U]].sort((Se,Ee)=>{const Le=Se.duplicateNumber||1;return(Ee.duplicateNumber||1)-Le}).forEach(Se=>{pe.push(Se.id)})}),pe.forEach(U=>{d(U)}),se.length>0&&a(se)},xe=(x,W)=>{const z=(()=>{const X=E.findIndex(I=>I.item.id===x&&I.type===W);if(X>=0){const I=E[X];if(I.quantity===0)return E.filter((U,J)=>J!==X);const se=I.item.type==="Minion"?D:1,pe=Math.max(0,I.quantity-se);return E.map((U,J)=>J===X?{...U,quantity:pe}:U)}return E})();y(z),re(z)},ue=h.useCallback(()=>{if(E.length===0)return null;const x=(O||"").trim()||"Encounter",W=r.find(z=>{var se,pe;if(z.name!==x||((se=z.encounterItems)==null?void 0:se.length)!==E.length)return!1;const X=JSON.stringify((pe=z.encounterItems)==null?void 0:pe.sort()),I=JSON.stringify([...E].sort());return X===I});return(W==null?void 0:W.id)||null},[r,O,E]),Ae=h.useCallback(()=>{let x=(O||"").trim(),W=v;if(W||(W=ue()),E.length===0&&(!x||x==="Encounter")&&W){g(W),j(null),b(null);return}const z={name:x,encounterItems:E,partySize:D,battlePointsAdjustments:L};if(W){z.id=W;const X=s(z);j(X)}else{const X=s(z);j(X)}b({name:x,encounterItems:E,partySize:D,battlePointsAdjustments:L})},[E,O,D,L,v,s,ue,g]);h.useEffect(()=>{if(v&&ne()){const x=setTimeout(()=>{Ae()},2e3);return()=>clearTimeout(x)}else if(!v&&E.length>0&&O&&O.trim()!==""){const x=setTimeout(()=>{Ae()},2e3);return()=>clearTimeout(x)}},[E,v,O,L,D]);const je=()=>{$()&&(y([]),Z("Encounter"),P("Encounter"),j(null),b(null),p.forEach(x=>{d(x.id)}),f.forEach(x=>{c(x.id)}),m.forEach(x=>{u(x.id)}))},Ne=x=>{const W=n(x);if(W){const z=W.encounterItems||[];y(z),_(W.partySize||4),F(W.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),Z(W.name||""),P(W.name||""),j(x),b({name:W.name||"",encounterItems:W.encounterItems||[],partySize:W.partySize||4,battlePointsAdjustments:W.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),re(z)}},Pe=x=>{g(x),v===x&&(y([]),Z("Encounter"),P("Encounter"),j(null),b(null),p.forEach(W=>{d(W.id)}),f.forEach(W=>{c(W.id)}),m.forEach(W=>{u(W.id)}))},Ze=()=>{try{const x={version:"1.0",exportDate:new Date().toISOString(),customAdversaries:K.adversaries||[]},W=JSON.stringify(x,null,2),z=new Blob([W],{type:"application/json"}),X=URL.createObjectURL(z),I=document.createElement("a");I.href=X,I.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(I),I.click(),document.body.removeChild(I),URL.revokeObjectURL(X),console.log("Custom adversaries exported successfully")}catch(x){console.error("Failed to export custom adversaries:",x),alert("Failed to export custom adversaries. Please try again.")}},De=x=>{const W=x.target.files[0];if(!W)return;const z=new FileReader;z.onload=X=>{try{const I=JSON.parse(X.target.result);if(!I.customAdversaries||!Array.isArray(I.customAdversaries))throw new Error("Invalid file format. Expected customAdversaries array.");const se=K.adversaries||[],pe=I.customAdversaries,U=[...se];let J=0;pe.forEach(oe=>{se.some(Ee=>Ee.name===oe.name&&Ee.type===oe.type)||(U.push({...oe,id:`custom-${Date.now()}-${Math.random().toString(36).slice(2,10)}`}),J++)}),updateCustomContent("adversary",null,U),J>0?alert(`Successfully imported ${J} custom adversaries.`):alert("No new adversaries were added. All imported adversaries already exist.")}catch(I){console.error("Failed to import custom adversaries:",I),alert("Failed to import custom adversaries. Please check the file format and try again.")}},z.readAsText(W),x.target.value=""};if(!e)return null;const Ue=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://");return t.jsx("div",{onClick:i,className:"encounter-builder-modal",style:{position:"fixed",top:0,left:0,right:0,bottom:Ue?"calc(60px + env(safe-area-inset-bottom) + 1rem)":"calc(60px + env(safe-area-inset-bottom))",backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:1e3,display:"flex",alignItems:"flex-start",justifyContent:"center",padding:"12px"},children:t.jsxs("div",{onClick:x=>x.stopPropagation(),style:{backgroundColor:"var(--bg-primary)",border:"2px solid var(--border)",borderRadius:"12px",width:"100%",maxWidth:"1200px",height:"100%",maxHeight:"100%",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"},children:[t.jsxs("div",{className:"encounter-top-bar",style:{flex:"0 0 auto",display:"flex",alignItems:"center",height:"39px",backgroundColor:"var(--bg-primary)",borderBottom:"1px solid var(--border)"},children:[t.jsx("button",{onClick:()=>C("adversaries"),style:{flex:1,background:R==="adversaries"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:R==="adversaries"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Builder"}),t.jsx("button",{onClick:()=>C("encounters"),style:{flex:1,background:R==="encounters"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:R==="encounters"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Saved Encounters"}),t.jsx("button",{onClick:()=>C("create"),style:{flex:1,background:R==="create"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:R==="create"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Create Adversary"}),t.jsx("button",{onClick:()=>C("info"),style:{flex:1,background:R==="info"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:R==="info"?"500":"400",transition:"all 0.2s ease",position:"relative"},children:"Info"})]}),t.jsxs("div",{className:"encounter-builder-content",style:{flex:1,display:"flex",overflow:"hidden"},children:[t.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",borderTop:"1px solid var(--border)"},children:t.jsx(tr,{type:"adversary",onAddItem:x=>Be(x,"adversary"),encounterItems:E,pcCount:D,showContainer:!1,savedEncounters:r,onLoadEncounter:Ne,onDeleteEncounter:Pe,activeTab:R,selectedCustomAdversaryId:T,onSelectCustomAdversary:k,onTabChange:C,selectedAdversary:A,onSelectAdversary:V,filterCustom:M,showCustomToggle:!0,onToggleCustom:H,onExportCustomAdversaries:Ze,onImportCustomAdversaries:De})}),R!=="info"&&t.jsxs("div",{className:"encounter-right-panel",style:{flex:1,borderLeft:"1px solid var(--border)",display:"flex",flexDirection:"column",overflow:"hidden",position:"relative"},children:[A&&t.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"var(--bg-primary)",zIndex:10,display:"flex",flexDirection:"column"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)",flexShrink:0},children:[t.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:0},children:"Adversary Preview"}),t.jsx("button",{onClick:()=>V(null),style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease"},onMouseEnter:x=>x.target.style.color="var(--text-primary)",onMouseLeave:x=>x.target.style.color="var(--text-secondary)",title:"Close preview",children:t.jsx(rt,{size:16})})]}),t.jsx("div",{style:{flex:1,overflowY:"auto",padding:"0.75rem"},children:t.jsx(pt,{item:{...A,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...A,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}})})]}),(R==="adversaries"||R==="encounters")&&t.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-primary)",flexShrink:0},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[t.jsx("input",{type:"text",value:O,onChange:x=>{Z(x.target.value),P(x.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),t.jsx(te,{onClick:je,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:$()?1:.5,cursor:$()?"pointer":"not-allowed"},children:"New"})]})}),(R==="adversaries"||R==="encounters")&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"encounter-receipt-buttons-vertical",style:{display:"none",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[t.jsx("input",{type:"text",value:O,onChange:x=>{Z(x.target.value),P(x.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),t.jsx(te,{onClick:je,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:$()?1:.5,cursor:$()?"pointer":"not-allowed"},children:"New"})]})}),t.jsx("div",{className:"receipt-content",style:{padding:"1rem",display:"flex",flexDirection:"column",height:"100%"},children:t.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"flex-start",overflowY:"auto",marginBottom:"0.75rem"},children:[t.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[t.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[t.jsx("button",{onClick:()=>_(Math.max(1,D-1)),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:t.jsx(dt,{size:10})}),t.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:D}),t.jsx("button",{onClick:()=>_(D+1),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:t.jsx(Ye,{size:10})})]}),t.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Party Size"})}),t.jsx("div",{style:{width:"120px",textAlign:"right"}})]}),E.map(x=>{var W;return x.type!=="adversary"?null:t.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[t.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[t.jsx("button",{onClick:()=>xe(x.item.id,x.type),style:{background:x.quantity===0?"var(--danger)":"var(--bg-secondary)",border:x.quantity===0?"none":"1px solid var(--border)",color:x.quantity===0?"white":"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:x.quantity===0?t.jsx(rt,{size:10}):t.jsx(dt,{size:10})}),t.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:x.quantity}),t.jsx("button",{onClick:()=>Be(x.item,x.type),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:t.jsx(Ye,{size:10})})]}),t.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:x.item.baseName||((W=x.item.name)==null?void 0:W.replace(/\s+\(\d+\)$/,""))||x.item.name})}),t.jsx("div",{style:{width:"80px",textAlign:"right"},children:t.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.8rem"},children:x.item.type})})]},`${x.item.id}-${x.type}`)}),t.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[t.jsx("div",{style:{flex:1,display:"flex",alignItems:"center"},children:t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Balance"})}),t.jsx("div",{style:{width:"120px",textAlign:"right",display:"flex",alignItems:"center",justifyContent:"flex-end"},children:t.jsx("span",{style:{color:Te>ve?"var(--danger)":Te===ve?"var(--purple)":"var(--success)",fontWeight:600},children:Te>ve?`+${Te-ve}`:ve-Te===0?"0":`-${ve-Te}`})})]})]})})]}),R==="create"&&t.jsxs("div",{style:{padding:"1.5rem",overflowY:"auto",height:"100%"},children:[t.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Creating Adversaries"}),t.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",display:"flex",flexDirection:"column",gap:"1rem"},children:[t.jsx("p",{children:"Use the form to create custom adversaries for your encounters."}),t.jsxs("div",{children:[t.jsx("strong",{style:{color:"var(--text-primary)"},children:"Adversary Types:"}),t.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Minion (1 BP):"})," Weak enemies in groups"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Standard (2 BP):"})," Average threat level"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Leader (3 BP):"})," Commands others"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Bruiser (4 BP):"})," High HP tank"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Solo (5 BP):"})," Boss-level threat"]})]})]}),t.jsxs("div",{children:[t.jsx("strong",{style:{color:"var(--text-primary)"},children:"Tips:"}),t.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[t.jsx("li",{children:"Match adversary tier to party level"}),t.jsx("li",{children:"Balance encounter difficulty with Battle Points"}),t.jsx("li",{children:"Mix adversary types for variety"}),t.jsx("li",{children:"Add features that create interesting choices"})]})]})]})]}),R==="myAdversaries"&&t.jsx("div",{style:{padding:"0.75rem",overflowY:"auto",height:"100%"},children:T?(()=>{var W;const x=(W=K==null?void 0:K.adversaries)==null?void 0:W.find(z=>z.id===T);return x?t.jsx(pt,{item:{...x,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...x,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}}):t.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Adversary not found"})})():t.jsxs("div",{children:[t.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Adversary Preview"}),t.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Select an adversary to view details"})]})})]})]})]})})},an=({browserOpenAtPosition:e,handleCloseBrowser:i,handleOpenBrowser:o,getEntityGroups:a,fear:l,updateFear:d})=>{const c=h.useRef(!1),u=h.useRef(null),p=h.useRef(null),f=h.useMemo(()=>({"shift+space":()=>{if(e!==null)i();else{const r=a();o(r.length)}},escape:()=>{e!==null&&i()},"+":()=>{const r=(l==null?void 0:l.value)||0,s=Math.min(12,r+1);d(s)},"=":()=>{const r=(l==null?void 0:l.value)||0,s=Math.min(12,r+1);d(s)},"-":()=>{const r=(l==null?void 0:l.value)||0,s=Math.max(0,r-1);d(s)},_:()=>{const r=(l==null?void 0:l.value)||0,s=Math.max(0,r-1);d(s)}}),[e,i,o,a,l,d]),m=h.useCallback(r=>{var D;if(window.matchMedia("(max-width: 800px)").matches)return;const n=r.key===" "||r.key==="Space"||r.code==="Space";if(r.shiftKey&&n&&!r.ctrlKey&&!r.metaKey&&!r.altKey){if(console.log("[Keyboard] Shift+Space detected, toggling browser"),r.preventDefault(),r.stopPropagation(),r.stopImmediatePropagation(),e!==null)i();else{const _=a();o(_.length)}return}const S=document.activeElement;if(S&&["INPUT","TEXTAREA","SELECT"].includes(S.tagName)){const _=r.key==="Escape",L=r.shiftKey&&n&&!r.ctrlKey&&!r.metaKey&&!r.altKey;if(!_&&!L)return}const B=[];(r.ctrlKey||r.metaKey)&&B.push("ctrl"),r.shiftKey&&B.push("shift"),r.altKey&&B.push("alt");let P=r.key.toLowerCase();P===" "&&(P="space"),B.push(P);const K=B.join("+");if(f[K]){r.preventDefault(),f[K](r);return}if(!r.ctrlKey&&!r.metaKey&&!r.shiftKey&&!r.altKey&&f[P]){r.preventDefault(),f[P](r);return}if(!r.ctrlKey&&!r.metaKey&&!r.shiftKey&&!r.altKey&&(r.key==="ArrowLeft"||r.key==="ArrowRight")){const _=document.activeElement;if(_&&["INPUT","TEXTAREA","SELECT"].includes(_.tagName))return;const L=document.querySelector(".dashboard-scroll-container");if(L){r.preventDefault(),console.log("[Keyboard] Dashboard scroll requested:",{key:r.key,currentScrollLeft:L.scrollLeft,containerWidth:L.clientWidth,scrollWidth:L.scrollWidth,scrollInProgress:c.current,browserOpen:e!==null});const F=Array.from(L.children).filter(E=>getComputedStyle(E).scrollSnapAlign!=="none");if(console.log("[Keyboard] Found panels:",{totalPanels:F.length,panelDetails:F.map((E,y)=>({index:y,offsetLeft:E.offsetLeft,offsetWidth:E.offsetWidth,scrollSnapAlign:getComputedStyle(E).scrollSnapAlign}))}),F.length>0){const E=L.scrollLeft;let y=0,O=1/0;F.forEach((C,v)=>{const j=C.offsetLeft,q=Math.abs(j-E);q<O&&(O=q,y=v)}),console.log("[Keyboard] Panel detection:",{currentScroll:E,currentPanelIndex:y,currentPanelOffsetLeft:(D=F[y])==null?void 0:D.offsetLeft,minDistance:O,allPanels:F.map((C,v)=>({index:v,offsetLeft:C.offsetLeft,distance:Math.abs(C.offsetLeft-E)}))});const Z=r.key==="ArrowLeft"?-1:1,R=y+Z;if(console.log("[Keyboard] Scrolling decision:",{scrollDirection:Z,currentPanelIndex:y,nextPanelIndex:R,canScroll:R>=0&&R<F.length}),R>=0&&R<F.length){const C=F[R],v=C.offsetLeft;console.log("[Keyboard] Scrolling to panel:",{index:R,offsetLeft:C.offsetLeft,offsetWidth:C.offsetWidth,targetScrollPosition:v,currentScroll:E,scrollInProgress:c.current}),u.current&&(clearTimeout(u.current),u.current=null),p.current=R,c.current?(console.log("[Keyboard] Redirecting scroll to new target",{previousTarget:p.current,newTarget:R,targetScrollPosition:v}),L.scrollTo({left:v,behavior:"smooth"})):(c.current=!0,C.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"})),u.current=setTimeout(()=>{if(p.current===R){const j=L.scrollLeft,q=C.offsetLeft,b=Math.abs(j-q);b>.5&&(console.log("[Keyboard] Correcting misalignment:",{finalScroll:j,expectedScroll:q,misalignment:b}),L.scrollTo({left:q,behavior:"auto"})),c.current=!1,p.current=null,console.log("[Keyboard] Scroll after action:",{newScrollLeft:L.scrollLeft,targetScrollPosition:v,difference:L.scrollLeft-E,actualDifference:L.scrollLeft-v,misalignment:b})}u.current=null},600)}else console.log("[Keyboard] Cannot scroll - panel index out of bounds")}else{console.log("[Keyboard] No panels found, using fallback scroll");const E=L.firstElementChild;if(E){const y=E.offsetWidth,O=r.key==="ArrowLeft"?-1:1;L.scrollBy({left:y*O,behavior:"smooth"})}}}else console.log("[Keyboard] Scroll container not found")}},[f,e,i,o,a]);h.useEffect(()=>(document.addEventListener("keydown",m,!0),()=>{document.removeEventListener("keydown",m,!0)}),[m])},ln=({position:e="top",children:i,onClick:o,className:a="",style:l={}})=>{const d=e==="top",c=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://"),u={background:"var(--bg-primary)",borderTop:d?"none":"1px solid var(--border)",borderBottom:d?"1px solid var(--border)":"none",padding:d?"0.25rem 0":"0.5rem",paddingBottom:d?"0.25rem":c?"calc(0.5rem + env(safe-area-inset-bottom) + 1rem)":"calc(0.5rem + env(safe-area-inset-bottom))",position:d?"relative":"sticky",[d?"top":"bottom"]:0,zIndex:d?10:100,order:d?1:3,flexShrink:0,touchAction:"manipulation",userSelect:"none",display:"flex",flexDirection:d?"column":"row",justifyContent:d?"stretch":"center",alignItems:d?"stretch":"center",gap:d?"0":"1rem",height:d?"auto":"60px",...l};return t.jsx("div",{className:a,style:u,onClick:o,children:i})},dn=({fearValue:e,onUpdateFear:i,onToggleBrowser:o,isBrowserOpen:a})=>t.jsx(ln,{position:"top",children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",width:"100%",justifyContent:"space-between",padding:"0 1rem"},children:[t.jsx(ut,{type:"fear",value:e,maxValue:12,onChange:i,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0}),t.jsx("button",{onClick:o,title:a?"Close Browser":"Add Adversaries",style:{width:"36px",height:"36px",padding:0,backgroundColor:a?"var(--purple)":"transparent",border:"1px solid var(--border)",borderRadius:"50%",color:a?"white":"var(--text-primary)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",flexShrink:0},onMouseEnter:l=>{a||(l.currentTarget.style.borderColor="var(--purple)",l.currentTarget.style.backgroundColor="var(--bg-secondary)")},onMouseLeave:l=>{a||(l.currentTarget.style.borderColor="var(--border)",l.currentTarget.style.backgroundColor="transparent")},children:t.jsx(Ye,{size:18})})]})}),cn=({isOpen:e,columnWidth:i,onClose:o,onCreateCustomAdversary:a,pcCount:l,updatePartySize:d,availableBattlePoints:c,spentBattlePoints:u,browserActiveTab:p,onTabChange:f,savedEncounters:m,loadEncounter:r,deleteEncounter:s,selectedCustomAdversaryId:n,onSelectCustomAdversary:g,onAddAdversaryFromBrowser:S})=>e?t.jsx("div",{style:{position:"absolute",top:`${Ce}px`,right:`${Ce}px`,bottom:`${Ce}px`,width:`${i}px`,zIndex:100,overflow:"visible"},children:t.jsx(Ct,{tabContent:t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:a,style:{padding:"0.375rem 0.75rem",backgroundColor:"var(--purple)",border:"none",color:"white",borderRadius:"4px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",transition:"opacity 0.2s ease"},onMouseEnter:w=>{w.currentTarget.style.opacity="0.9"},onMouseLeave:w=>{w.currentTarget.style.opacity="1"},children:[t.jsx(Ye,{size:16}),t.jsx("span",{children:"Add Custom"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:"500"},children:"Party Size:"}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",border:"1px solid var(--border)",borderRadius:"4px",padding:"0.125rem 0.25rem",backgroundColor:"var(--bg-secondary)"},children:[t.jsx("button",{onClick:()=>d(Math.max(1,l-1)),style:{background:"transparent",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:0,display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem"},onMouseEnter:w=>{w.currentTarget.style.color="var(--purple)"},onMouseLeave:w=>{w.currentTarget.style.color="var(--text-primary)"},children:t.jsx(dt,{size:12})}),t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:"500",minWidth:"1.5rem",textAlign:"center"},children:l}),t.jsx("button",{onClick:()=>d(l+1),style:{background:"transparent",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:0,display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem"},onMouseEnter:w=>{w.currentTarget.style.color="var(--purple)"},onMouseLeave:w=>{w.currentTarget.style.color="var(--text-primary)"},children:t.jsx(Ye,{size:12})})]})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:"500"},children:"Balance:"}),t.jsx("span",{style:{color:u>c?"var(--danger)":u===c?"var(--purple)":"var(--success)",fontWeight:600,fontSize:"0.875rem"},children:u>c?`+${u-c}`:c-u===0?"0":`-${c-u}`})]}),o&&t.jsx("button",{onClick:o,style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease",flexShrink:0},onMouseEnter:w=>w.currentTarget.style.color="var(--text-primary)",onMouseLeave:w=>w.currentTarget.style.color="var(--text-secondary)",title:"Close browser",children:t.jsx(rt,{size:16})})]}),showTab:!0,tabBackgroundColor:"var(--bg-primary)",tabBorderColor:"var(--border)",tabJustifyContent:"space-between",containerBackgroundColor:"var(--bg-primary)",containerBorderColor:"var(--border)",containerBorderRadius:"8px",containerBoxShadow:"-4px 0 12px rgba(0, 0, 0, 0.3)",containerOverflow:"hidden",reserveTabSpace:!0,containerStyle:{height:"100%"},children:t.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,display:"flex",flexDirection:"column",width:"100%",minWidth:0},children:t.jsx(tr,{type:"adversary",onAddItem:S,showContainer:!1,activeTab:p,onTabChange:f,pcCount:l,savedEncounters:m,onLoadEncounter:r,onDeleteEncounter:s,selectedCustomAdversaryId:n,onSelectCustomAdversary:g,autoFocus:!0,hideImportExport:!0,onClose:o,searchPlaceholder:"Search adversaries"})})})}):null,bt=({side:e="left",children:i,className:o="",style:a={}})=>{const l=e==="left",d={flex:1,minWidth:0,background:"var(--bg-primary)",overflowY:"auto",overflowX:l?"auto":"hidden",display:l?"block":"flex",flexDirection:l?"initial":"column",height:"100%",padding:l?"8px 0 8px 0":"0 8px 0 0",...a};return t.jsx("div",{className:o,style:d,children:i})},un=({entityGroups:e,columnWidth:i,scrollContainerRef:o,onScroll:a,newCards:l,removingCardSpacer:d,spacerShrinking:c,browserOpenAtPosition:u,editingAdversaryId:p,handleSaveCustomAdversary:f,handleCancelEdit:m,updateAdversary:r,updateEnvironment:s,updateCountdown:n,adversaries:g,handleEditAdversary:S,createAdversary:w,createAdversariesBulk:B,pcCount:P,smoothScrollTo:K,getEntityGroups:D,deleteAdversary:_,setRemovingCardSpacer:L,setSpacerShrinking:F})=>t.jsxs("div",{ref:o,className:"dashboard-scroll-container",onScroll:a,children:[e.length===0?null:(()=>{const E=[];if(e.forEach((y,O)=>{var R,C,v;if(d&&d.baseName===y.baseName&&y.type==="adversary"){E.push(t.jsx(bt,{style:{width:c?"0px":`${i}px`,flexShrink:0,flexGrow:0,flex:"none",paddingRight:"0",paddingTop:c?"0px":`${Ce}px`,paddingBottom:c?"0px":`${Ce}px`,scrollSnapAlign:"none",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"100%",opacity:0,transition:"width 0.3s ease, padding-top 0.3s ease, padding-bottom 0.3s ease"}},`spacer-${d.baseName}`));return}E.push(t.jsx(bt,{className:O===0?"dashboard-column dashboard-column--first":O===e.length-1?"dashboard-column dashboard-column--last":"dashboard-column",style:{width:`${i}px`,flexShrink:0,flexGrow:0,flex:"none",paddingRight:"0",paddingTop:`${y.type==="adversary"?Ce+ot:Ce}px`,paddingBottom:`${Ce}px`,scrollSnapAlign:"start",overflow:y.type==="adversary"?"visible":"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"auto",opacity:l.has(`${y.type}-${y.baseName}`)?0:1,transition:"opacity 0.2s ease"},children:t.jsx(pt,{type:y.type,item:{...y.instances[0],name:((R=y.instances[0])==null?void 0:R.name)||y.baseName,hp:0,stress:0,isDead:!1},mode:"expanded",instances:y.instances,showCustomCreator:y.type==="adversary"&&p&&y.instances.some(j=>j.id===p),onSaveCustomAdversary:y.type==="adversary"&&p&&y.instances.some(j=>j.id===p)?f:void 0,onCancelEdit:y.type==="adversary"&&p&&y.instances.some(j=>j.id===p)?m:void 0,isStockAdversary:y.type==="adversary"&&p&&y.instances.some(j=>j.id===p)?!((C=y.instances[0])!=null&&C.source)||((v=y.instances[0])==null?void 0:v.source)!=="Homebrew":!1,onApplyDamage:y.type==="adversary"?(j,q)=>{const b=y.instances.find(T=>T.id===j);b&&r(j,{hp:Math.min(b.hpMax||1,(b.hp||0)+q)})}:void 0,onApplyHealing:y.type==="adversary"?(j,q)=>{const b=y.instances.find(T=>T.id===j);b&&r(j,{hp:Math.max(0,(b.hp||0)-q)})}:void 0,onApplyStressChange:y.type==="adversary"?(j,q)=>{var b,T;return r(j,{stress:Math.max(0,Math.min(((b=y.instances.find(k=>k.id===j))==null?void 0:b.stressMax)||6,(((T=y.instances.find(k=>k.id===j))==null?void 0:T.stress)||0)+q))})}:void 0,onUpdate:y.type==="adversary"?r:y.type==="environment"?s:n,adversaries:g,showAddRemoveButtons:u!==null&&y.type==="adversary",onEdit:y.type==="adversary"?j=>S(j):void 0,onAddInstance:y.type==="adversary"?j=>{const q=j.type==="Minion",b=q?P:1;if(q&&b>1){const T=Array(b).fill(null).map(()=>({...j}));B(T)}else w(j);setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!o.current)return;const T=o.current,k=T.scrollLeft,A=T.clientWidth,V=u!==null?A-(i+Ce):A,H=D().findIndex(ne=>ne.baseName===y.baseName&&ne.type==="adversary");if(H>=0){const ne=Ce+H*(i+Ce),$=ne+i,te=10;ne>=k-te&&$<=k+V+te||K(ne,500)}})})},50)}:void 0,onRemoveInstance:y.type==="adversary"?()=>{const j=y.instances[0],b=(j==null?void 0:j.type)==="Minion"?P:1,T=y.instances.sort((M,H)=>{const ne=M.duplicateNumber||1;return(H.duplicateNumber||1)-ne}),A=Math.max(0,T.length-b)===0;if(T.length===0)return;const V=T.slice(0,b);if(A){const M=e.findIndex($=>$.baseName===y.baseName&&$.type==="adversary"),H=M===0;let ne=!1;if(o.current){const $=o.current,te=$.scrollLeft,ce=$.scrollWidth-$.clientWidth;ne=Math.abs(te-ce)<1}L({baseName:y.baseName,groupIndex:M}),F(!1),H&&o.current&&(o.current.style.scrollSnapType="none"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{o.current&&o.current.offsetHeight,V.forEach($=>{_($.id)}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{o.current&&o.current.offsetHeight,setTimeout(()=>{if(F(!0),ne&&o.current){const $=performance.now(),te=300,ce=()=>{if(!o.current)return;const he=o.current,We=he.scrollWidth-he.clientWidth;he.scrollLeft=We,performance.now()-$<te&&requestAnimationFrame(ce)};requestAnimationFrame(ce)}setTimeout(()=>{if(L(null),F(!1),H&&o.current&&(o.current.style.scrollSnapType="x mandatory"),ne&&o.current){const $=o.current;$.scrollLeft=$.scrollWidth-$.clientWidth}},300)},50)})})})})}else V.forEach(M=>{_(M.id)})}:void 0})},`${y.type}-${y.baseName}`))}),d&&!E.some(y=>(y==null?void 0:y.key)===`spacer-${d.baseName}`)){const y=Math.min(d.groupIndex,E.length);E.splice(y,0,t.jsx(bt,{className:"dashboard-column",style:{width:c?"0px":`${i}px`,flexShrink:0,flexGrow:0,flex:"none",paddingRight:"0",paddingTop:c?"0px":`${Ce}px`,paddingBottom:c?"0px":`${Ce}px`,scrollSnapAlign:"none",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"100%",opacity:0,transition:"width 0.3s ease, padding-top 0.3s ease, padding-bottom 0.3s ease"}},`spacer-${d.baseName}`))}return E})(),u!==null&&t.jsx("div",{style:{width:`${i}px`,flexShrink:0,flexGrow:0,flex:"none",height:"100%"}})]}),pn=(e=[])=>e.reduce((i,o)=>{var l;const a=o.baseName||((l=o.name)==null?void 0:l.replace(/\s+\(\d+\)$/,""))||o.name||"Unknown";return i[a]||(i[a]={type:"adversary",baseName:a,instances:[]}),i[a].instances.push(o),i},{}),mn=(e,i,o,a)=>{const l=h.useRef(i);h.useEffect(()=>{const d=l.current;if(d!==i&&d>0){const c=pn(e);Object.values(c).forEach(u=>{if(u.type!=="adversary"||u.instances.length===0)return;const p=u.instances[0];if(p.type!=="Minion")return;const f=u.instances.length,r=Math.ceil(f/d)*i;if(r!==f)if(r>f){const s=r-f,n=Array(s).fill(null).map(()=>({...p}));o(n)}else{const s=f-r;u.instances.slice(-s).forEach(g=>a(g.id))}}),l.current=i}else(d===0||l.current===0)&&(l.current=i)},[e,i,o,a])},Vt=e=>e===1?200:350,fn=e=>{if(e<=0)return{visibleColumns:1,columnWidth:Vt(1)};const i=e-Ce*2;let o={visibleColumns:1,columnWidth:i};for(let l=1;l<=5;l+=1){const d=(l-1)*Ce,c=(i-d)/l;c>=Vt(l)&&l*c+d<=i&&(o={visibleColumns:l,columnWidth:c})}return o.visibleColumns*o.columnWidth+(o.visibleColumns-1)*Ce>i&&(o={visibleColumns:1,columnWidth:i}),o},hn=()=>typeof window>"u"?0:window.innerWidth,xn=e=>{const[i,o]=h.useState(hn),a=h.useMemo(()=>fn(i),[i]);return h.useLayoutEffect(()=>{const l=()=>{e.current?o(e.current.clientWidth):typeof window<"u"&&o(window.innerWidth)};l();const d=()=>l();window.addEventListener("resize",d);let c;return typeof ResizeObserver<"u"&&e.current&&(c=new ResizeObserver(()=>{e.current&&o(e.current.clientWidth)}),c.observe(e.current)),()=>{window.removeEventListener("resize",d),c&&c.disconnect()}},[e]),{gap:Ce,columnWidth:a.columnWidth,visibleColumns:a.visibleColumns}};class gn extends Ve.Component{constructor(i){super(i),this.state={hasError:!1,error:null}}static getDerivedStateFromError(i){return{hasError:!0,error:i}}componentDidCatch(i,o){console.error("ErrorBoundary caught an error:",i,o)}render(){var i;return this.state.hasError?t.jsxs("div",{className:"p-md text-red",children:[t.jsx("h3",{children:"Something went wrong:"}),t.jsx("pre",{children:(i=this.state.error)==null?void 0:i.toString()}),t.jsx("button",{className:"btn-base btn-text",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try again"})]}):this.props.children}}const yn=({scrollContainerRef:e,columnWidth:i,onCloseReset:o})=>{const[a,l]=h.useState(null),d=h.useCallback(u=>{if(l(u),e.current){const p=e.current,f=p.scrollLeft,m=p.scrollWidth-p.clientWidth,r=Math.abs(f-m)<1;p._scrollBeforeBrowserOpen=f,p._scrollWidthBeforeOpen=p.scrollWidth,p._wasAtMaxScrollBeforeBrowserOpen=r}},[e]),c=h.useCallback(()=>{if(e.current){const u=e.current;u._scrollBeforeBrowserClose=u.scrollLeft,u._scrollWidthBeforeClose=u.scrollWidth}l(null),o==null||o()},[e,o]);return h.useEffect(()=>{e.current&&requestAnimationFrame(a!==null?()=>{requestAnimationFrame(()=>{if(!e.current)return;const u=e.current,p=u._wasAtMaxScrollBeforeBrowserOpen,f=u._scrollBeforeBrowserOpen||0;u.scrollLeft=f,delete u._scrollBeforeBrowserOpen,delete u._wasAtMaxScrollBeforeBrowserOpen})}:()=>{requestAnimationFrame(()=>{if(!e.current)return;const u=e.current,p=u._scrollBeforeBrowserClose||0,f=u.scrollWidth-u.clientWidth,m=Math.min(p,f);u.scrollLeft=m,delete u._scrollBeforeBrowserClose})})},[a,i,e]),{browserOpenAtPosition:a,handleOpenBrowser:d,handleCloseBrowser:c}},vn=e=>h.useCallback((i,o=500)=>{if(!e.current)return;const a=e.current,l=a.scrollLeft,d=i-l;if(Math.abs(d)<1)return;a._horizontalScrollAnimationId&&(cancelAnimationFrame(a._horizontalScrollAnimationId),a._horizontalScrollAnimationId=null),window.getComputedStyle(a).scrollSnapType!=="none"&&(a.style.scrollSnapType="none");const p=performance.now(),f=m=>{const r=m-p,s=Math.min(r/o,1),n=1-s,g=1-n*n*n;if(a){const S=l+d*g;a.scrollLeft=S}s<1?a._horizontalScrollAnimationId=requestAnimationFrame(f):a&&(a.scrollLeft=i,a._horizontalScrollAnimationId=null)};a._horizontalScrollAnimationId=requestAnimationFrame(f)},[e]),bn=(e,i)=>{const o=h.useCallback(()=>{const l={};return e.forEach(d=>{var u;const c=d.baseName||((u=d.name)==null?void 0:u.replace(/\s+\(\d+\)$/,""))||d.name;l[c]||(l[c]={type:"adversary",baseName:c,instances:[]}),l[c].instances.push(d)}),i.forEach(d=>{l[`countdown-${d.id}`]={type:"countdown",baseName:d.name,instances:[d]}}),Object.values(l)},[e,i]);return{entityGroups:h.useMemo(()=>o(),[o]),getEntityGroups:o}},wn=({entityGroups:e,pcCount:i,scrollContainerRef:o,createAdversariesBulk:a,createAdversary:l,setNewCards:d,getEntityGroups:c,smoothScrollTo:u,browserOpenAtPosition:p,columnWidth:f})=>h.useCallback(m=>{var K,D,_;const r=m.baseName||((K=m.name)==null?void 0:K.replace(/\s+\(\d+\)$/,""))||m.name,n=!e.find(L=>L.baseName===r&&L.type==="adversary"),g=m.type==="Minion",S=g?i:1,w=((D=o.current)==null?void 0:D.scrollWidth)??0,B=((_=o.current)==null?void 0:_.scrollLeft)??0,P=o.current;if(P&&n&&window.getComputedStyle(P).scrollSnapType!=="none"&&(P.style.scrollSnapType="none"),g&&S>1){const L=Array(S).fill(null).map(()=>({...m}));a(L)}else l(m);if(n){const L=`adversary-${r}`;d(F=>new Set(F).add(L)),setTimeout(()=>{d(F=>{const E=new Set(F);return E.delete(L),E})},10)}setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!o.current)return;const L=o.current;if(!(L.scrollWidth<=L.clientWidth))if(n){const F=L.scrollWidth;setTimeout(()=>{if(!o.current)return;const E=o.current,y=()=>{if(!o.current)return;const O=o.current,Z=O.scrollWidth-O.clientWidth,R=Z-B;O.scrollWidth>w&&Math.abs(R)<1?u(Z+10,500):Math.abs(R)>1&&u(Z,500)};E.scrollWidth!==F?requestAnimationFrame(()=>{requestAnimationFrame(()=>{y()})}):y()},10)}else{const E=c().findIndex(y=>y.baseName===r&&y.type==="adversary");if(E>=0){const y=o.current,O=y.scrollLeft,Z=y.clientWidth,R=p!==null?Z-(f+Ce):Z,C=Ce+E*(f+Ce),v=C+f,j=10;C>=O-j&&v<=O+R+j||u(C,500)}}})})},50)},[p,f,a,l,e,c,i,o,d,u]);const Sn=()=>{const{adversaries:e,environments:i,countdowns:o,fear:a,savedEncounters:l,partySize:d,customContent:c,updatePartySize:u,updateFear:p,createAdversary:f,createAdversariesBulk:m,updateAdversary:r,deleteAdversary:s,addCustomAdversary:n,updateCustomAdversary:g,createEnvironment:S,updateEnvironment:w,deleteEnvironment:B,updateCountdown:P,deleteCountdown:K,saveEncounter:D,loadEncounter:_,deleteEncounter:L}=ft(),F=d||4,[E,y]=h.useState(!1),[O,Z]=h.useState(null),[R,C]=h.useState("adversaries"),[v,j]=h.useState(null),[q,b]=h.useState(new Set),[T,k]=h.useState(null),[A,V]=h.useState(!1),M=h.useRef(null);mn(e,F,m,s);const{columnWidth:H}=xn(M),{browserOpenAtPosition:ne,handleOpenBrowser:$,handleCloseBrowser:te}=yn({scrollContainerRef:M,columnWidth:H,onCloseReset:()=>C("adversaries")}),ce=vn(M),he=h.useCallback(()=>{y(!1)},[]),{entityGroups:We,getEntityGroups:ve}=bn(e,o);an({browserOpenAtPosition:ne,handleCloseBrowser:te,handleOpenBrowser:$,getEntityGroups:ve,fear:a,updateFear:p});const Te=wn({entityGroups:We,pcCount:F,scrollContainerRef:M,createAdversariesBulk:m,createAdversary:f,setNewCards:b,getEntityGroups:ve,smoothScrollTo:ce,browserOpenAtPosition:ne,columnWidth:H}),Be=h.useCallback(()=>{const W="Standard",z=et(1,W),X={name:"",baseName:"",tier:1,type:W,description:"",motives:"",difficulty:z.difficulty,thresholds:z.thresholds,hpMax:z.hpMax,stressMax:z.stressMax,atk:z.atk,weapon:"",range:z.range,damage:z.damage,experience:[],features:[],source:"Homebrew",hp:0,stress:0,isVisible:!0};f(X),setTimeout(()=>{const I=ve();for(const se of I)if(se.type==="adversary"){const pe=se.instances.find(U=>U.source==="Homebrew"&&(!U.baseName||U.baseName.trim()===""||U.baseName==="Unknown"));if(pe&&!O){Z(pe.id),requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(M.current){const U=I.findIndex(J=>J.instances.some(oe=>oe.id===pe.id));if(U>=0){const J=Ce+U*(H+Ce);ce(J,600,"new-custom-adversary")}}})});break}}},100)},[f,ve,H,ce,O]),re=h.useCallback(x=>{Z(x)},[]),xe=h.useCallback(()=>{Z(null)},[]),ue=h.useCallback(async(x,W)=>{var z,X;if(W){const I=e.find(pe=>pe.id===W);if((I==null?void 0:I.source)==="Homebrew"||(I==null?void 0:I.isCustom)){const pe=I==null?void 0:I.customContentId,U=I==null?void 0:I.baseName,J=pe?(z=c==null?void 0:c.adversaries)==null?void 0:z.find(oe=>oe.id===pe):(X=c==null?void 0:c.adversaries)==null?void 0:X.find(oe=>oe.baseName===U&&(oe.source==="Homebrew"||oe.isCustom));if(J){const oe={...x,name:x.baseName||x.name};g(J.id,oe);const Se=x.baseName||(I==null?void 0:I.baseName);e.forEach(Ee=>{(Ee.customContentId===pe||Ee.baseName===Se&&(Ee.source==="Homebrew"||Ee.isCustom))&&r(Ee.id,{...x,customContentId:J.id})})}else{const oe={...x,name:x.baseName||x.name},Se=n(oe),Ee=x.baseName||(I==null?void 0:I.baseName);e.forEach(Le=>{Le.baseName===Ee&&(Le.source==="Homebrew"||Le.isCustom)&&r(Le.id,{...x,customContentId:Se})})}}else{const pe=I==null?void 0:I.baseName,U=e.filter(Se=>{const Ee=Se.baseName===pe,Le=!Se.source||Se.source!=="Homebrew"&&!Se.isCustom;return Ee&&Le}),J={...x,name:x.baseName||x.name},oe=n(J);U.forEach(Se=>{s(Se.id)}),setTimeout(()=>{const Se=U.map(()=>({...x,source:"Homebrew",isCustom:!0,customContentId:oe,hp:0,stress:0}));Se.length>0&&m(Se)},0)}Z(null)}else if(O){const I={...x,name:x.baseName||x.name},se=n(I),pe=f({...x,source:"Homebrew",isCustom:!0,customContentId:se});return Z(null),pe}else{const I={...x,name:x.baseName||x.name},se=n(I);return f({...x,source:"Homebrew",isCustom:!0,customContentId:se})}},[O,e,c,f,r,n,g,m,s]),je=h.useCallback(()=>{const x={};return e.forEach(W=>{var X;const z=W.baseName||((X=W.name)==null?void 0:X.replace(/\s+\(\d+\)$/,""))||W.name;x[z]||(x[z]={type:"adversary",item:W,quantity:0}),x[z].quantity+=1}),Object.values(x)},[e])(),Ne=Ut(je),Pe=Qt(F)+Ne,Ze=Zt(je,F),De=h.useRef(null),Ue=h.useCallback(x=>{De.current&&clearTimeout(De.current),De.current=setTimeout(()=>{const W=x.target;W&&W.style.scrollSnapType==="none"&&(W.style.scrollSnapType="x mandatory")},150)},[]);return t.jsxs("div",{className:"app dashboard-root",style:{"--dashboard-gap":`${Ce}px`},onClick:x=>{x.target,x.currentTarget},children:[t.jsx(dn,{fearValue:(a==null?void 0:a.value)||0,onUpdateFear:p,isBrowserOpen:ne!==null,onToggleBrowser:()=>{ne!==null?te():$(We.length)}}),t.jsxs("div",{className:"dashboard-main",children:[t.jsx(cn,{isOpen:ne!==null,columnWidth:H,onClose:te,onCreateCustomAdversary:Be,pcCount:F,updatePartySize:u,availableBattlePoints:Pe,spentBattlePoints:Ze,browserActiveTab:R,onTabChange:C,savedEncounters:l,loadEncounter:_,deleteEncounter:L,selectedCustomAdversaryId:v,onSelectCustomAdversary:j,onAddAdversaryFromBrowser:Te}),t.jsx(un,{entityGroups:We,columnWidth:H,scrollContainerRef:M,onScroll:Ue,newCards:q,removingCardSpacer:T,spacerShrinking:A,browserOpenAtPosition:ne,editingAdversaryId:O,handleSaveCustomAdversary:ue,handleCancelEdit:xe,updateAdversary:r,updateEnvironment:w,updateCountdown:P,adversaries:e,handleEditAdversary:re,createAdversary:f,createAdversariesBulk:m,pcCount:F,smoothScrollTo:ce,getEntityGroups:ve,deleteAdversary:s,setRemovingCardSpacer:k,setSpacerShrinking:V})]}),t.jsx(on,{isOpen:E,onClose:he,onAddAdversary:x=>{f(x)},onAddAdversariesBulk:x=>{m(x)},onAddEnvironment:x=>{S(x)},onDeleteAdversary:s,onDeleteEnvironment:B,onDeleteCountdown:K,adversaries:e,environments:i,countdowns:o,savedEncounters:l,onSaveEncounter:D,onLoadEncounter:_,onDeleteEncounter:L}),t.jsx(Mr,{})]})},Cn=()=>{const{isLoaded:e}=ft();return e?t.jsx(gn,{children:t.jsx(Sn,{})}):t.jsx("div",{className:"app loading-state",children:t.jsx("div",{className:"loading-placeholder","aria-hidden":"true"})})};St.createRoot(document.getElementById("root")).render(t.jsx(Ve.StrictMode,{children:t.jsx(Tr,{children:t.jsx(Cn,{})})}));
