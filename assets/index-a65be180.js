import{r as j,a as Ne,R as ye}from"./dndkit-57209f9c.js";import{F as Ze,f as Ue,a as et,b as tt,c as Pe}from"./fa-b4bcccb0.js";import{D as me,A as _e,C as rt,T as nt,S as ot,M as st,X as De,E as at,a as it,L as lt,b as dt,c as ct,F as pt,d as je,e as we,f as Le,P as He}from"./lucide-38687890.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const y of document.querySelectorAll('link[rel="modulepreload"]'))g(y);new MutationObserver(y=>{for(const u of y)if(u.type==="childList")for(const l of u.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&g(l)}).observe(document,{childList:!0,subtree:!0});function i(y){const u={};return y.integrity&&(u.integrity=y.integrity),y.referrerPolicy&&(u.referrerPolicy=y.referrerPolicy),y.crossOrigin==="use-credentials"?u.credentials="include":y.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function g(y){if(y.ep)return;y.ep=!0;const u=i(y);fetch(y.href,u)}})();var Ve={exports:{}},Ae={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ut=j,xt=Symbol.for("react.element"),mt=Symbol.for("react.fragment"),ft=Object.prototype.hasOwnProperty,ht=ut.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,gt={key:!0,ref:!0,__self:!0,__source:!0};function Ge(t,o,i){var g,y={},u=null,l=null;i!==void 0&&(u=""+i),o.key!==void 0&&(u=""+o.key),o.ref!==void 0&&(l=o.ref);for(g in o)ft.call(o,g)&&!gt.hasOwnProperty(g)&&(y[g]=o[g]);if(t&&t.defaultProps)for(g in o=t.defaultProps,o)y[g]===void 0&&(y[g]=o[g]);return{$$typeof:xt,type:t,key:u,ref:l,props:y,_owner:ht.current}}Ae.Fragment=mt;Ae.jsx=Ge;Ae.jsxs=Ge;Ve.exports=Ae;var e=Ve.exports,Te={},Fe=Ne;Te.createRoot=Fe.createRoot,Te.hydrateRoot=Fe.hydrateRoot;function fe(t){const o=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return t?`${t}-${o}`:o}const Xe=j.createContext();function ze(t){if(typeof localStorage>"u")return null;try{const o=localStorage.getItem(t);return o==null?null:JSON.parse(o)}catch{return null}}function ge(t,o){if(!(typeof localStorage>"u"))try{localStorage.setItem(t,JSON.stringify(o))}catch{}}const yt=({children:t})=>{const[o,i]=j.useState({fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],currentEncounterName:"Encounter"}),[g,y]=j.useState(!1),[u,l]=j.useState({adversaries:[],environments:[]});j.useEffect(()=>{var r,m,_,O;const s=ze("daggerheart-game-state");if(s)try{(((r=s.adversaries)==null?void 0:r.length)>0||((m=s.environments)==null?void 0:m.length)>0||((_=s.countdowns)==null?void 0:_.length)>0||((O=s.savedEncounters)==null?void 0:O.length)>0)&&i(s)}catch(de){console.error("Failed to load saved state:",de)}const a=ze("daggerheart-custom-adversaries")||[],x=ze("daggerheart-custom-environments")||[];l({adversaries:a,environments:x}),y(!0)},[]),j.useEffect(()=>{ge("daggerheart-game-state",o)},[o]);const A=s=>{i(a=>({...a,fear:{...a.fear,value:s}}))},d=()=>{i(s=>({...s,fear:{...s.fear,visible:!s.fear.visible}}))},E=s=>{i(a=>({...a,partySize:Math.max(1,s)}))},z=s=>{i(a=>({...a,currentEncounterName:s||"Encounter"}))},H=s=>{if(s.id)return i(a=>({...a,savedEncounters:(a.savedEncounters||[]).map(x=>x.id===s.id?{...x,name:s.name||x.name,encounterItems:s.encounterItems||x.encounterItems,partySize:s.partySize||x.partySize,battlePointsAdjustments:s.battlePointsAdjustments||x.battlePointsAdjustments,updatedAt:new Date().toISOString()}:x)})),s.id;{const a={id:fe("encounter"),name:s.name||"Encounter",createdAt:new Date().toISOString(),encounterItems:s.encounterItems||[],partySize:s.partySize||4,battlePointsAdjustments:s.battlePointsAdjustments||{}};return i(x=>({...x,savedEncounters:[...x.savedEncounters||[],a]})),a.id}},Z=s=>(o.savedEncounters||[]).find(x=>x.id===s),b=s=>{const a={id:fe("encounter"),name:s.name||`Encounter ${Date.now()}`,createdAt:new Date().toISOString(),encounterItems:s.encounterItems||[],partySize:s.partySize||4,battlePointsAdjustments:s.battlePointsAdjustments||{}};return i(x=>({...x,savedEncounters:[...x.savedEncounters||[],a]})),a.id},T=s=>{i(a=>({...a,savedEncounters:(a.savedEncounters||[]).filter(x=>x.id!==s)}))},K=j.useRef(o);j.useEffect(()=>{K.current=o},[o]);const W={gameState:o,isLoaded:g,customContent:u,updateFear:A,toggleFearVisibility:d,updatePartySize:E,updateCurrentEncounterName:z,saveEncounter:H,saveEncounterAs:b,loadEncounter:Z,deleteEncounter:T,createCountdown:s=>{const a={id:fe("countdown"),name:s.name||"Countdown",max:parseInt(s.max)||1,value:0,visible:!0,type:s.type||"standard",loop:s.loop||"none",source:s.source||"campaign"};i(x=>({...x,countdowns:[...x.countdowns,a]}))},updateCountdown:(s,a)=>{i(x=>({...x,countdowns:x.countdowns.map(r=>r.id===s?{...r,...a}:r)}))},deleteCountdown:s=>{i(a=>({...a,countdowns:a.countdowns.filter(x=>x.id!==s)}))},advanceCountdown:(s,a)=>{i(x=>({...x,countdowns:x.countdowns.map(r=>{if(r.id!==s)return r;let m=a;if(r.loop==="loop")m>r.max?m=(m-1)%r.max+1:m<0&&(m=r.max);else if(r.loop==="increasing"){if(m>r.max)return{...r,max:r.max+1,value:1};if(m<0)return{...r,max:Math.max(1,r.max-1),value:1};m=Math.max(0,m)}else if(r.loop==="decreasing"){if(m>r.max)return{...r,max:Math.max(1,r.max-1),value:1};if(m<0)return{...r,max:r.max+1,value:1};m=Math.min(r.max,m)}else m=Math.max(0,Math.min(m,r.max));return{...r,value:m}})}))},incrementCountdown:(s,a=1)=>{i(x=>({...x,countdowns:x.countdowns.map(r=>{if(r.id!==s)return r;let m=r.value+a;if(r.loop==="loop")m>r.max&&(m=(m-1)%r.max+1);else if(r.loop==="increasing"){if(m>r.max)return{...r,max:r.max+1,value:1}}else if(r.loop==="decreasing"){if(m>r.max)return{...r,max:Math.max(1,r.max-1),value:1}}else m=Math.min(m,r.max);return{...r,value:m}})}))},decrementCountdown:s=>{i(a=>({...a,countdowns:a.countdowns.map(x=>{if(x.id!==s)return x;let r=x.value-1;if(x.loop==="loop")r<0&&(r=x.max);else if(x.loop==="increasing"){if(r<0)return{...x,max:Math.max(1,x.max-1),value:x.max};r=Math.max(0,r)}else if(x.loop==="decreasing"){if(r<0)return{...x,max:x.max+1,value:1}}else r=Math.max(0,r);return{...x,value:r}})}))},reorderCountdowns:s=>{i(a=>{const[x,r]=s,m=[...a.countdowns],[_]=m.splice(x,1);return m.splice(r,0,_),{...a,countdowns:m}})},createAdversary:s=>{var de;const a=fe("adv"),x=o.adversaries||[],r=s.baseName||((de=s.name)==null?void 0:de.replace(/\s+\(\d+\)$/,""))||s.name||"Unknown",m=x.filter(re=>re.baseName===r);let _=1;if(m.length===0)_=1;else{const re=m.map(c=>c.duplicateNumber||1);let N=1;for(;re.includes(N);)N++;_=N}const O={...s,id:a,baseName:r,duplicateNumber:_,name:`${r} (${_})`,hp:0,stress:0,isVisible:!0};i(re=>({...re,adversaries:[...re.adversaries,O]}))},createAdversariesBulk:s=>{const a=[],x={};s.forEach(r=>{var S;const m=r.baseName||((S=r.name)==null?void 0:S.replace(/\s+\(\d+\)$/,""))||r.name||"Unknown",de=(o.adversaries||[]).filter(L=>L.baseName===m).length,re=x[m]||0,N=de+re+1;x[m]=re+1;const c={...r,id:fe("adv"),baseName:m,duplicateNumber:N,name:`${m} (${N})`,hp:0,stress:0,isVisible:!0};a.push(c)}),i(r=>({...r,adversaries:[...r.adversaries,...a]}))},updateAdversary:(s,a)=>{i(x=>({...x,adversaries:x.adversaries.map(r=>{if(r.id===s){const m={...r,...a};if(a.baseName!==void 0){const _=a.baseName,O=m.duplicateNumber||1;m.name=O===1?_:`${_} (${O})`}return m}return r})}))},deleteAdversary:s=>{i(a=>({...a,adversaries:a.adversaries.filter(x=>x.id!==s)}))},clearAllAdversaries:()=>{i(s=>({...s,adversaries:[]}))},reorderAdversaries:s=>{i(a=>{const[x,r]=s,m=[...a.adversaries],[_]=m.splice(x,1);return m.splice(r,0,_),{...a,adversaries:m}})},bulkReorderAdversaries:s=>{i(a=>({...a,adversaries:s}))},createEnvironment:s=>{const a=fe("env"),r=(o.environments||[]).filter(O=>O.name.replace(/\s+\(\d+\)$/,"")===s.name);let m=s.name||"Unknown";if(r.length===0)m=s.name;else if(r.length===1){const O=r[0],de=O.name.replace(/\s+\(\d+\)$/,""),re=o.environments.map(N=>N.id===O.id?{...N,name:`${de} (1)`}:N);i(N=>({...N,environments:re})),m=`${s.name} (2)`}else{const O=r.map(re=>{const N=re.name.match(/\((\d+)\)$/);return N?parseInt(N[1]):null}).filter(re=>re!==null);let de=1;for(;O.includes(de);)de++;m=`${s.name} (${de})`}const _={...s,id:a,name:m,isVisible:!0};i(O=>({...O,environments:[...O.environments,_]}))},updateEnvironment:(s,a)=>{i(x=>({...x,environments:x.environments.map(r=>r.id===s?{...r,...a}:r)}))},deleteEnvironment:s=>{i(a=>({...a,environments:a.environments.filter(x=>x.id!==s)}))},reorderEnvironments:s=>{i(a=>{const[x,r]=s,m=[...a.environments],[_]=m.splice(x,1);return m.splice(r,0,_),{...a,environments:m}})},addCustomAdversary:s=>{const a={...s,id:fe("custom-adv"),source:s.source||"Homebrew",isCustom:!0};return l(x=>({...x,adversaries:[...x.adversaries,a]})),ge("daggerheart-custom-adversaries",[...u.adversaries,a]),a.id},addCustomEnvironment:s=>{const a={...s,id:fe("custom-env"),source:s.source||"Homebrew",isCustom:!0};return l(x=>({...x,environments:[...x.environments,a]})),ge("daggerheart-custom-environments",[...u.environments,a]),a.id},updateCustomAdversary:(s,a)=>{l(r=>({...r,adversaries:r.adversaries.map(m=>m.id===s?{...m,...a}:m)}));const x=u.adversaries.map(r=>r.id===s?{...r,...a}:r);ge("daggerheart-custom-adversaries",x)},updateCustomEnvironment:(s,a)=>{l(r=>({...r,environments:r.environments.map(m=>m.id===s?{...m,...a}:m)}));const x=u.environments.map(r=>r.id===s?{...r,...a}:r);ge("daggerheart-custom-environments",x)},deleteCustomAdversary:s=>{l(x=>({...x,adversaries:x.adversaries.filter(r=>r.id!==s)}));const a=u.adversaries.filter(x=>x.id!==s);ge("daggerheart-custom-adversaries",a)},deleteCustomEnvironment:s=>{l(x=>({...x,environments:x.environments.filter(r=>r.id!==s)}));const a=u.environments.filter(x=>x.id!==s);ge("daggerheart-custom-environments",a)}};return e.jsx(Xe.Provider,{value:W,children:t})},Je=()=>{const t=j.useContext(Xe);if(!t)return console.warn("useGameState: Context not available yet, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{gameState:o,customContent:i,...g}=t;if(!o)return console.warn("useGameState: gameState not available, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],customContent:{adversaries:[],environments:[]},updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},addCustomAdversary:()=>{},addCustomEnvironment:()=>{},updateCustomAdversary:()=>{},updateCustomEnvironment:()=>{},deleteCustomAdversary:()=>{},deleteCustomEnvironment:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{fear:y,countdowns:u,adversaries:l,environments:A,partySize:d,savedEncounters:E}=o;return{gameState:o,fear:y,countdowns:u,adversaries:l,environments:A,partySize:d,savedEncounters:E,customContent:i,...g,hasCountdowns:u.length>0,hasAdversaries:l.length>0,hasEnvironments:A.length>0,getCountdownById:z=>u.find(H=>H.id===z),getAdversaryById:z=>l.find(H=>H.id===z),getEnvironmentById:z=>A.find(H=>H.id===z)}},Oe={fear:{icon:Ue,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"0.125rem",maxWidth:"none"},pipStyle:{fontSize:"var(--text-lg)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0,imageRendering:"crisp-edges"},filledColor:"var(--purple)",emptyColor:"var(--gray-dark)",tooltipTitle:"Click anywhere in header to adjust fear:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease fear by 1"},{text:"Right of boundary:",description:"Click to increase fear by 1"}]},hp:{icon:et,maxValue:20,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stress:{icon:tt,maxValue:12,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},countdown:{icon:Pe,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust countdown:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease countdown by 1"},{text:"Right of boundary:",description:"Click to increase countdown by 1"}]},hpDots:{maxValue:20,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--red)",borderColor:"var(--red)",boxShadow:"0 0 4px rgba(239, 68, 68, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stressDots:{maxValue:12,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--purple)",borderColor:"var(--purple)",boxShadow:"0 0 4px rgba(139, 92, 246, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},adversaryHP:{icon:me,maxValue:20,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust HP:",tooltipInstructions:[{text:"Filled pip:",description:"Click to heal (reduce damage)"},{text:"Empty pip:",description:"Click to take damage"}]},adversaryStress:{icon:_e,maxValue:12,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust stress:",tooltipInstructions:[{text:"Filled pip:",description:"Click to reduce stress"},{text:"Empty pip:",description:"Click to increase stress"}]},countdownDistributed:{icon:Pe,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Countdown progress:",tooltipInstructions:[{text:"Progress:",description:"Current countdown value"}]}},vt=({type:t="fear",value:o=0,maxValue:i,onChange:g,size:y="lg",showTooltip:u=!0,containerStyle:l={},pipStyle:A={},countdownType:d=null,distributedGroups:E=null,onPipClick:z=null,enableBoundaryClick:H=!1,clickContainerWidth:Z="auto",centerPips:b=!0})=>{const[T,K]=j.useState(!1),D=Oe[t]||Oe.fear,M=i||D.maxValue,w=Math.max(0,Math.min(M,o));let P=D.filledColor;t==="countdown"&&d&&(["progress","dynamic-progress","simple-hope"].includes(d)?P="var(--gold)":["consequence","dynamic-consequence","simple-fear"].includes(d)?P="var(--purple)":["long-term","standard"].includes(d)&&(P="var(--text-secondary)"));const I=(V,le)=>{if(z)z(V,le);else if(g){const ae=V+1;g(ae)}},$=V=>{if(!H||!g||z)return;V.currentTarget.getBoundingClientRect();const le=V.currentTarget.querySelector(".pip-container");if(!le)return;const ae=le.getBoundingClientRect(),ie=V.clientX-ae.left;if(ie<0){w>0&&g(w-1);return}if(ie>ae.width){w<M&&g(w+1);return}const te=ae.width,p=te*.05,h=te-2*p,Y=ie-p,n=w/M,f=h*n;Y<f?w>0&&g(w-1):w<M&&g(w+1)},q=(()=>{if(!E||t!=="countdownDistributed")return[{start:0,end:M,groupIndex:0}];let V=0;return E.map((le,ae)=>{const ie={start:V,end:V+le,groupIndex:ae};return V+=le,ie})})(),ce=()=>e.jsxs(e.Fragment,{children:[q.map(V=>e.jsx(ye.Fragment,{children:[...Array(V.end-V.start)].map((le,ae)=>{const ie=V.start+ae,te=ie<w;if(D.isDots)return e.jsx("div",{style:{...D.pipStyle,...te?D.filledStyle:D.emptyStyle,...A,cursor:g||z?"pointer":"default"},onClick:H?void 0:()=>I(ie,te),title:`${ie+1} of ${M}`},ie);{const p=D.icon,h=p&&typeof p=="object"&&p.iconName,Y=te?P:D.emptyColor;return e.jsx("span",{className:`fear-pip ${te?"filled":"empty"}`,style:{...D.pipStyle,color:Y,cursor:g||z?"pointer":"default",...A},onClick:H?void 0:()=>I(ie,te),title:`${ie+1} of ${M}`,children:h?e.jsx(Ze,{icon:p,size:y}):e.jsx(p,{size:16})},ie)}})},V.groupIndex)),u&&e.jsx("div",{style:{position:"relative",cursor:"help",pointerEvents:"none"},children:e.jsxs("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:T?"translateX(-50%) translateY(-5px)":"translateX(-50%)",background:"rgba(15, 23, 42, 0.95)",border:"1px solid var(--gray)",borderRadius:"var(--radius-md)",padding:"var(--space-md)",minWidth:"250px",zIndex:1e3,opacity:T?1:0,visibility:T?"visible":"hidden",transition:"all 0.2s ease",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.5)"},children:[e.jsx("div",{style:{fontWeight:600,color:"var(--gray-200)",marginBottom:"0.75rem",fontSize:"var(--text-sm)"},children:D.tooltipTitle}),D.tooltipInstructions.map((V,le)=>e.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.8rem",color:"var(--gray-300)",lineHeight:1.4},children:[e.jsx("strong",{style:{color:"var(--gray-200)"},children:V.text})," ",V.description]},le))]})})]});return e.jsx("div",{style:{width:Z,height:"100%",cursor:g||z?"pointer":"default",touchAction:"manipulation",userSelect:"none",display:b?"flex":"block",alignItems:b?"center":"stretch",justifyContent:b?"center":"flex-start",...l},onClick:V=>{V.stopPropagation(),V.preventDefault(),H&&$(V)},onMouseEnter:()=>K(u),onMouseLeave:()=>K(!1),children:e.jsx("div",{className:"pip-container",style:{...D.containerStyle,width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},children:ce()})})},bt="/Daggerheart/assets/daggerheart-logo-fe7815ad.svg",jt=({showFlyout:t,onFlyoutChange:o})=>{const[i,g]=j.useState(!1),[y,u]=j.useState(!1),l=t!==void 0?t:i,A=o||g;return j.useEffect(()=>{const d=E=>{E.target.closest(".help-button")||A(!1)};return document.addEventListener("click",d),()=>document.removeEventListener("click",d)},[A]),j.useEffect(()=>{const d=window.matchMedia("(max-width: 800px)"),E=z=>u(z.matches);return u(d.matches),d.addEventListener("change",E),()=>d.removeEventListener("change",E)},[]),e.jsxs("div",{className:"help-button",style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",padding:"0.5rem",color:l?"white":"var(--text-primary)",borderRadius:"50%",cursor:"pointer",transition:"all 0.2s ease",minWidth:"44px",minHeight:"44px",backgroundColor:l?"var(--purple)":"transparent"},onMouseEnter:d=>{l||(d.currentTarget.style.backgroundColor="var(--bg-secondary)")},onMouseLeave:d=>{l||(d.currentTarget.style.backgroundColor="transparent")},onClick:d=>{d.stopPropagation(),A(!l)},title:"Help & Info",children:[e.jsx("div",{style:{width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center",color:"inherit",backgroundColor:"transparent",border:"none",outline:"none"},children:e.jsx(rt,{size:20})}),e.jsxs("div",{style:{position:"absolute",top:"50%",right:"100%",left:"auto",transform:"translateY(-50%)",background:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,opacity:l?1:0,visibility:l?"visible":"hidden",transition:"opacity 0.2s ease, visibility 0.2s ease, transform 0.2s ease",pointerEvents:l?"auto":"none",minWidth:"280px",maxWidth:y?"calc(100vw - 2rem)":"320px",marginRight:"0.5rem"},children:[e.jsxs("div",{style:{padding:"0.75rem",borderTop:"1px solid rgba(255, 255, 255, 0.1)",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",background:"var(--bg-primary)",maxWidth:"280px"},children:[e.jsx("img",{src:bt,alt:"Daggerheart Community Content Logo",style:{width:"100%",maxWidth:"200px",height:"auto",margin:"0 auto 0.75rem auto",display:"block"},onError:d=>{console.error("Failed to load Daggerheart logo:",d.target.src),d.target.style.display="none";const E=document.createElement("div");E.style.cssText="text-align: center; margin-bottom: 0.75rem; font-size: 1.5rem; font-weight: bold; color: var(--purple);",E.textContent="⚔️ DAGGERHEART ⚔️",d.target.parentNode.insertBefore(E,d.target)},onLoad:()=>{}}),e.jsxs("div",{style:{fontSize:"0.7rem",lineHeight:1.3,color:"var(--text-secondary)",textAlign:"left",wordWrap:"break-word",overflowWrap:"break-word"},children:[e.jsx("p",{children:"This product includes materials from the Daggerheart System Reference Document 1.0, © Critical Role, LLC, under the terms of the Darrington Press Community Gaming (DPCGL) License."}),e.jsxs("p",{children:["More information can be found at ",e.jsx("a",{href:"https://www.daggerheart.com",target:"_blank",rel:"noopener noreferrer",children:"daggerheart.com"})]}),e.jsx("p",{children:e.jsx("em",{children:"This project is unofficial and not endorsed by Darrington Press or Critical Role."})})]})]}),e.jsx("button",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"0.25rem 1rem",color:"var(--text-primary)",border:"none",background:"none",width:"100%",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"0.875rem",minHeight:"32px",borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},onMouseEnter:d=>{d.target.style.backgroundColor="var(--gray-dark)"},onMouseLeave:d=>{d.target.style.backgroundColor="transparent"},onClick:d=>{d.stopPropagation(),A(!1),window.open("https://github.com/Splinter714/Daggerheart","_blank")},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.25rem"},children:e.jsx("span",{children:"GitHub"})})}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"0.25rem 1rem",color:"var(--text-secondary)",border:"none",background:"none",width:"100%",textAlign:"left",cursor:"default",fontSize:"0.875rem",minHeight:"32px"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.25rem"},children:e.jsxs("span",{children:["Version ","0.3.9 (6aa0acd)"]})})})]})]})},wt=({adversaries:t,environments:o,countdowns:i,deleteAdversary:g,deleteEnvironment:y,deleteCountdown:u,isClearMode:l,setIsClearMode:A,showFlyout:d,onFlyoutChange:E})=>{const[z,H]=j.useState(!1),Z=d!==void 0?d:z,b=E||H,T=((t==null?void 0:t.length)||0)>0||((o==null?void 0:o.length)||0)>0||((i==null?void 0:i.length)||0)>0,K=(t||[]).some(I=>(I.hp||0)>=(I.hpMax||1));j.useEffect(()=>{const I=$=>{$.target.closest(".delete-clear-container")||(b(!1),l&&A(!1))};return document.addEventListener("click",I),()=>document.removeEventListener("click",I)},[l,b]),j.useEffect(()=>{l&&!T&&(A(!1),b(!1))},[l,T,A,b]);const D={position:"absolute",top:"50%",right:"100%",left:"auto",transform:"translateY(-50%)",backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",padding:"0.5rem",minWidth:"200px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,display:Z?"block":"none",marginRight:"0.5rem"},M={background:l||Z?"var(--red)":"none",border:"none",color:l||Z?"white":T?"var(--text-primary)":"var(--text-secondary)",cursor:T?"pointer":"not-allowed",padding:"0.5rem",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s",opacity:T?1:.5,minWidth:"44px",minHeight:"44px"},w={background:"none",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:"0.5rem",borderRadius:"var(--radius-sm)",width:"100%",textAlign:"left",display:"flex",alignItems:"center",gap:"0.5rem",transition:"background-color 0.2s"},P={backgroundColor:"var(--bg-hover)"};return e.jsxs("div",{className:"delete-clear-container",style:{position:"relative"},children:[e.jsx("button",{style:M,onClick:I=>{I.stopPropagation(),T&&(l?(A(!1),b(!1)):(A(!0),b(!0)))},title:T?l?"Clear Items":"Enter Clear Mode":"Nothing to clear",children:e.jsx(nt,{size:20})}),e.jsxs("div",{style:D,children:[t&&t.length>0&&e.jsxs("button",{style:w,onMouseEnter:I=>Object.assign(I.target.style,P),onMouseLeave:I=>Object.assign(I.target.style,w),onClick:I=>{I.stopPropagation(),H(!1),t.forEach($=>g($.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Adversaries"})]}),t&&t.length>0&&K&&e.jsxs("button",{style:w,onMouseEnter:I=>Object.assign(I.target.style,P),onMouseLeave:I=>Object.assign(I.target.style,w),onClick:I=>{I.stopPropagation(),H(!1),t.filter(ee=>(ee.hp||0)>=(ee.hpMax||1)).forEach(ee=>g(ee.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"Dead Adversaries"})]}),o&&o.length>0&&e.jsxs("button",{style:w,onMouseEnter:I=>Object.assign(I.target.style,P),onMouseLeave:I=>Object.assign(I.target.style,w),onClick:I=>{I.stopPropagation(),H(!1),o.forEach($=>y($.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Environments"})]}),i&&i.length>0&&e.jsxs("button",{style:w,onMouseEnter:I=>Object.assign(I.target.style,P),onMouseLeave:I=>Object.assign(I.target.style,w),onClick:I=>{I.stopPropagation(),H(!1),i.forEach($=>u($.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Countdowns"})]})]})]})},Ct=({adversaries:t,environments:o,countdowns:i,deleteAdversary:g,deleteEnvironment:y,deleteCountdown:u,isClearMode:l,setIsClearMode:A,sortAdversaries:d,onOpenDatabase:E})=>{const[z,H]=j.useState(!1),[Z,b]=j.useState(!1),[T,K]=j.useState(!1);j.useEffect(()=>{const ee=q=>{q.target.closest(".floating-menu-container")||(H(!1),b(!1),K(!1),l&&A(!1))};return document.addEventListener("click",ee),()=>document.removeEventListener("click",ee)},[l,A]),j.useEffect(()=>{z||(b(!1),K(!1),l&&A(!1))},[z,l,A]);const D=ee=>{b(ee),ee&&(K(!1),l&&A(!1))},M=ee=>{K(ee),ee&&b(!1)},P={position:"fixed",bottom:window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://")?"calc(60px + env(safe-area-inset-bottom) + 2rem)":"calc(60px + env(safe-area-inset-bottom) + 1rem)",right:"1rem",zIndex:1100,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",pointerEvents:"none",width:"56px",height:"56px"},I={width:"56px",height:"56px",borderRadius:"50%",background:z?"var(--red)":"var(--bg-secondary)",border:"2px solid var(--border)",color:z?"white":"var(--text-primary)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"all 0.3s ease",pointerEvents:"auto"},$=(ee,q)=>{const ae=135+ee*135/(q-1),ie=70,te=ae*Math.PI/180,p=Math.cos(te)*ie,h=Math.sin(te)*ie;return{width:"48px",height:"48px",borderRadius:"50%",background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.2)",transition:"all 0.3s ease",position:"absolute",pointerEvents:"auto",transform:z?`translate(${p}px, ${h}px)`:"translate(0px, 0px)",opacity:z?1:0,visibility:z?"visible":"hidden"}};return e.jsxs("div",{className:"floating-menu-container",style:P,children:[e.jsxs("div",{style:{position:"absolute",top:"0",left:"0",width:"56px",height:"56px",pointerEvents:"none"},children:[e.jsx("div",{style:$(0,4),children:e.jsx("button",{onClick:ee=>{ee.stopPropagation(),E("adversaries"),H(!1)},style:{width:"100%",height:"100%",background:"none",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Browse Adversaries",children:e.jsx(ot,{size:20})})}),e.jsx("div",{style:$(1,4),children:e.jsx("button",{onClick:ee=>{ee.stopPropagation(),E("environments"),H(!1)},style:{width:"100%",height:"100%",background:"none",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Browse Environments",children:e.jsx(st,{size:20})})}),e.jsx("div",{style:$(2,4),children:e.jsx(wt,{adversaries:t,environments:o,countdowns:i,deleteAdversary:g,deleteEnvironment:y,deleteCountdown:u,isClearMode:l,setIsClearMode:A,showFlyout:T,onFlyoutChange:M})}),e.jsx("div",{style:$(3,4),children:e.jsx(jt,{showFlyout:Z,onFlyoutChange:D})})]}),e.jsx("button",{style:I,onClick:ee=>{ee.stopPropagation(),H(!z)},title:z?"Close Menu":"Open Menu",children:z?e.jsx(De,{size:24}):e.jsx(at,{size:24})})]})},St=({position:t="top",children:o,onClick:i,className:g="",style:y={}})=>{const u=t==="top",l=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://"),A={background:"var(--bg-primary)",borderTop:u?"none":"1px solid var(--border)",borderBottom:u?"1px solid var(--border)":"none",padding:u?"0.25rem 0":"0.5rem",paddingBottom:u?"0.25rem":l?"calc(0.5rem + env(safe-area-inset-bottom) + 1rem)":"calc(0.5rem + env(safe-area-inset-bottom))",position:u?"relative":"sticky",[u?"top":"bottom"]:0,zIndex:u?10:100,order:u?1:3,flexShrink:0,touchAction:"manipulation",userSelect:"none",display:"flex",flexDirection:u?"column":"row",justifyContent:u?"stretch":"center",alignItems:u?"stretch":"center",gap:u?"0":"1rem",height:u?"auto":"60px",...y};return e.jsx("div",{className:g,style:A,onClick:i,children:o})},We=({feature:t,featureType:o,item:i,onUpdate:g,handleFeatureDeleteClick:y,deleteConfirmations:u,getFeatureKey:l})=>{var H,Z;const A=()=>{try{const T=[...(i==null?void 0:i.features)||[]],K=T.filter(M=>M.type===o),D=K.findIndex(M=>M===t);if(D>0&&D<K.length){const M=K[D],w=K[D-1];if(M&&w){const P=T.findIndex($=>$===M),I=T.findIndex($=>$===w);P>=0&&I>=0&&(T[P]=w,T[I]=M,g&&g(i.id,{features:T}))}}}catch(b){console.error(`Error in ${o.toLowerCase()} up button:`,b)}},d=()=>{try{const T=[...(i==null?void 0:i.features)||[]],K=T.filter(M=>M.type===o),D=K.findIndex(M=>M===t);if(D<K.length-1&&D>=0){const M=K[D],w=K[D+1];if(M&&w){const P=T.findIndex($=>$===M),I=T.findIndex($=>$===w);P>=0&&I>=0&&(T[P]=w,T[I]=M,g&&g(i.id,{features:T}))}}}catch(b){console.error(`Error in ${o.toLowerCase()} down button:`,b)}},E=b=>b.type===o,z=b=>b.type===o&&b.name.trim();return e.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",alignSelf:"stretch"},children:[e.jsx("button",{onClick:A,disabled:(i.features||[]).filter(E).findIndex(b=>b===t)===0,tabIndex:"-1",style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(i.features||[]).filter(z).length>=2&&(i.features||[]).filter(E).findIndex(b=>b===t)!==0&&t.name.trim()?"white":"var(--text-secondary)",cursor:(i.features||[]).filter(z).length>=2&&(i.features||[]).filter(E).findIndex(b=>b===t)!==0&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↑"}),e.jsx("button",{onClick:()=>y(t),disabled:!t.name.trim()&&!t.description.trim(),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:u[l(t)]?"var(--danger)":"var(--gray-700)",color:!t.name.trim()&&!t.description.trim()?"var(--text-secondary)":"white",cursor:!t.name.trim()&&!t.description.trim()?"not-allowed":"pointer",opacity:!t.name.trim()&&!t.description.trim()?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"×"}),e.jsx("button",{onClick:d,disabled:(i.features||[]).filter(E).findIndex(b=>b===t)===(i.features||[]).filter(E).length-1,style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(i.features||[]).filter(z).length>=2&&(i.features||[]).filter(E).findIndex(b=>b===t)<(i.features||[]).filter(E).length-1&&((H=(i.features||[]).filter(E)[(i.features||[]).filter(E).findIndex(b=>b===t)+1])!=null&&H.name.trim())&&t.name.trim()?"white":"var(--text-secondary)",cursor:(i.features||[]).filter(z).length>=2&&(i.features||[]).filter(E).findIndex(b=>b===t)<(i.features||[]).filter(E).length-1&&((Z=(i.features||[]).filter(E)[(i.features||[]).filter(E).findIndex(b=>b===t)+1])!=null&&Z.name.trim())&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↓"})]})},$e=({value:t})=>e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"36px",height:"24px"},children:[e.jsx("svg",{width:"32",height:"24",viewBox:"0 0 32 24",fill:"none",stroke:"var(--text-secondary)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",style:{position:"absolute"},children:e.jsx("path",{d:"M2 2h20l4 10-4 10H2l4-10-4-10z"})}),e.jsx("span",{style:{position:"absolute",fontSize:"0.7rem",fontWeight:500,color:"var(--text-primary)",textAlign:"center",zIndex:1,left:"45%",top:"50%",transform:"translate(-50%, -50%)"},children:t})]}),pe={transitions:{hoverIn:"all 0.1s ease",hoverOut:"all 0.3s ease"},card:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"8px",cursor:"pointer",transition:"all 0.1s ease",position:"relative"},cardHover:{backgroundColor:"var(--bg-card-hover)"},cardDead:{opacity:.6,backgroundColor:"var(--gray-800)",borderColor:"var(--border)"},cardAtMax:{backgroundColor:"var(--success)",borderColor:"var(--success)"},rowMain:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},rowTitle:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",margin:0},rowMeta:{display:"flex",gap:"8px",alignItems:"center"},badge:{padding:"2px 6px",borderRadius:"3px",fontSize:"10px",fontWeight:"600",textTransform:"uppercase"},typeBadge:{backgroundColor:"var(--purple)",color:"var(--text-primary)"},tierBadge:{backgroundColor:"var(--info)",color:"var(--text-primary)"},damageInputPopup:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,borderRadius:"8px"},damageInputContent:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"8px",padding:"8px",display:"flex",flexDirection:"row",gap:"8px",minWidth:"200px",alignItems:"center",position:"absolute",right:"1rem",top:"50%",transform:"translateY(-50%)"},damageInput:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"4px",padding:"4px 6px",color:"var(--text-primary)",fontSize:"16px",width:"80px",textAlign:"center"},damageIndicators:{display:"flex",gap:"8px",alignItems:"center",justifyContent:"center"},damageDrop:{fontSize:"16px",color:"var(--text-secondary)",cursor:"pointer",transition:"color 0.1s ease"},applyButton:{backgroundColor:"var(--gray-600)",color:"white",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"32px",minHeight:"32px"}},kt=(t,o,i,g)=>{const[y,u]=j.useState(!1),[l,A]=j.useState("");j.useEffect(()=>{if(y){const b=T=>{T.target.closest(".damage-input-popup")||(u(!1),A(""))};return document.addEventListener("click",b),()=>document.removeEventListener("click",b)}},[y]);const d=b=>{b.stopPropagation(),b.preventDefault();const T=t.hp||0,K=t.hpMax||1,D=b.currentTarget.getBoundingClientRect(),M=b.clientX-D.left,w=D.width/K;Math.floor(M/w)<T?i&&i(t.id,1,t.hp):o&&o(t.id,1,t.hp,t.hpMax)},E=b=>{b.stopPropagation(),b.preventDefault();const T=t.stress||0,K=t.stressMax||1,D=b.currentTarget.getBoundingClientRect(),M=b.clientX-D.left,w=D.width/K;Math.floor(M/w)<T?g&&g(t.id,-1,t.stress,t.stressMax):g&&g(t.id,1,t.stress,t.stressMax)},z=b=>{b.stopPropagation(),(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")&&(u(!0),A(t.type==="Minion"?"1":""))},H=()=>{const b=parseInt(l);if(b>0){if(t.type==="Minion")o&&o(t.id,b,t.hp,t.hpMax);else{let T=0;b>=t.thresholds.severe?T=3:b>=t.thresholds.major?T=2:b>=1&&(T=1),o&&o(t.id,T,t.hp,t.hpMax)}u(!1),A("")}};return{showDamageInput:y,damageValue:l,setDamageValue:A,setShowDamageInput:u,handleHpClick:d,handleStressClick:E,handleDifficultyClick:z,applyDamage:H,handleKeyDown:b=>{b.key==="Enter"?H():b.key==="Escape"&&(u(!1),A(""))}}},Me=({item:t,type:o,mode:i="expanded",onClick:g,onDelete:y,onApplyDamage:u,onApplyHealing:l,onApplyStressChange:A,onUpdate:d,adversaries:E=[],isSelected:z=!1,isEditMode:H=!1,instances:Z=[],isEmbedded:b=!1})=>{const[T,K]=j.useState({}),D=p=>{const Y=(t.features||[]).filter(n=>n.type===p.type).findIndex(n=>n===p);return`${p.type}-${Y}-${p.name||"blank"}`},M=p=>{const h=D(p);if(T[h]){const Y=t.features.filter(n=>n!==p);d&&d(t.id,{features:Y}),K(n=>{const f={...n};return delete f[h],f})}else K(Y=>({...Y,[h]:!0})),setTimeout(()=>{K(Y=>{const n={...Y};return delete n[h],n})},3e3)},w=kt(t,u,l,A);(o==="adversary"||o==="adversaries")&&w.handleDifficultyClick;const[P,I]=j.useState(!1),$=()=>{I(!0)},ee=()=>{I(!1)},q=(p=!1)=>{let h={...pe.card};if(z?h.transition="none":h.transition=P?pe.transitions.hoverIn:pe.transitions.hoverOut,p){const{marginTop:Y,...n}=h;h=n}return(P&&i!=="expanded"||z)&&(h={...h,...pe.cardHover}),o==="adversary"&&(t.hp||0)>=(t.hpMax||1)&&(h={...h,...pe.cardDead}),h},ce=()=>{if(b)return"";let p="border rounded-lg";return(P&&i!=="expanded"||z)&&(p+=" border-hover"),p},V=()=>{var p;if(o==="adversary"||o==="adversaries"){const h=t.baseName||((p=t.name)==null?void 0:p.replace(/\s+\(\d+\)$/,""))||"",Y=t.duplicateNumber||1,n=[...E];return E.some(F=>F.id===t.id)||n.push(t),n.filter(F=>F.baseName===h).length>1?`${h} (${Y})`:h}return t.name},le=()=>{const p=[];return t.type&&p.push(e.jsx("span",{style:{...pe.badge,...pe.typeBadge},children:t.type},"type")),p},ae=()=>o!=="adversary"||!w.showDamageInput||!(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")?null:e.jsx("div",{className:"damage-input-popup",style:pe.damageInputPopup,onClick:p=>{p.stopPropagation(),p.target===p.currentTarget&&(o==="adversary"||o==="adversaries")&&(w.setShowDamageInput(!1),w.setDamageValue(""))},children:e.jsxs("div",{className:"border rounded-lg",style:{...pe.damageInputContent,borderColor:"var(--border)"},onClick:p=>p.stopPropagation(),children:[e.jsx("input",{type:"number",inputMode:"numeric",enterKeyHint:"done",placeholder:"dmg",min:(t.type==="Minion","0"),value:o==="adversary"||o==="adversaries"?w.damageValue:"",onChange:p=>{(o==="adversary"||o==="adversaries")&&w.setDamageValue(p.target.value)},onKeyDown:o==="adversary"||o==="adversaries"?w.handleKeyDown:void 0,className:"border rounded-sm",style:{...pe.damageInput,borderColor:"var(--border)"},autoFocus:!0}),e.jsxs("div",{style:pe.damageIndicators,children:[t.type==="Minion"?(()=>{var f,v;const p=parseInt(o==="adversary"||o==="adversaries"?w.damageValue:"0")||0,h=(f=t.features)==null?void 0:f.find(F=>{var R;return(R=F.name)==null?void 0:R.startsWith("Minion (")}),Y=h?parseInt(((v=h.name.match(/\((\d+)\)/))==null?void 0:v[1])||"1"):1,n=Math.floor(p/Y);return p>=Y&&n>0?e.jsxs("span",{style:{...pe.damageDrop,color:"var(--red)"},title:`${p} damage can defeat ${n+1} minion${n+1!==1?"s":""} (1 + ${n} additional)`,children:["+",n," additional minion(s)"]}):e.jsx("span",{style:pe.damageDrop,title:`${p} damage defeats this minion only`,children:"+0 additional minion(s)"})})():[1,2,3].map(p=>{const h=parseInt(o==="adversary"||o==="adversaries"?w.damageValue:"0")||0;let Y=!1;return p===1&&h>=1&&(Y=!0),p===2&&h>=t.thresholds.major&&(Y=!0),p===3&&h>=t.thresholds.severe&&(Y=!0),e.jsx("span",{style:{...pe.damageDrop,color:Y?"var(--red)":"var(--text-secondary)"},onClick:n=>{n.stopPropagation(),(o==="adversary"||o==="adversaries")&&(p===1?w.setDamageValue("1"):p===2?w.setDamageValue(t.thresholds.major.toString()):p===3&&w.setDamageValue(t.thresholds.severe.toString()))},title:`Click to set damage to ${p===1?"1":p===2?t.thresholds.major:t.thresholds.severe}`,children:e.jsx(me,{size:16})},p)}),e.jsx("button",{style:{...pe.applyButton,backgroundColor:"var(--gray-600)"},onClick:p=>{p.stopPropagation(),(o==="adversary"||o==="adversaries")&&(!w.damageValue||parseInt(w.damageValue)<1?(w.setShowDamageInput(!1),w.setDamageValue("")):w.applyDamage())},title:!w.damageValue||parseInt(w.damageValue)<1?"Close damage input":"Apply damage",children:!w.damageValue||parseInt(w.damageValue)<1?e.jsx(De,{size:16}):e.jsx(ct,{size:16})})]})]})}),ie=()=>{var Y;const p=(t.hp||0)>=(t.hpMax||1),h=i==="edit";return e.jsxs("div",{className:ce(),style:{...q(!0),padding:0,minHeight:"400px",opacity:p?.7:1,backgroundColor:p?"var(--gray-900)":q(!0).backgroundColor,borderColor:p?"color-mix(in srgb, var(--gray-600) 40%, transparent)":z?"var(--purple)":P&&i!=="expanded"?"var(--border-hover)":"var(--border)",borderWidth:"2px",display:"flex",flexDirection:"column",position:"relative"},onClick:g,...i!=="expanded"&&{onMouseEnter:$,onMouseLeave:ee},children:[p&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                45deg,
                transparent,
                transparent 8px,
                var(--gray-600) 1px,
                var(--gray-600) 9px
              )`,pointerEvents:"none",zIndex:9999}}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"var(--text-secondary)",fontSize:"1rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em",zIndex:1e4,pointerEvents:"none",textShadow:"1px 1px 2px rgba(0, 0, 0, 0.5)",backgroundColor:"var(--gray-900)",padding:"0.25rem 0.5rem",borderRadius:"0.5rem",border:"0.5px solid var(--gray-600)"},children:"DEFEATED"})]}),e.jsx("div",{className:"border-b",style:{padding:"8px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative",zIndex:p?1:"auto",borderBottomColor:z?"var(--purple)":"var(--border)"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",position:"relative",zIndex:p?1:"auto"},children:[h?e.jsx("input",{type:"text",value:t.name||"",onChange:n=>{d&&d(t.id,{name:n.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"4px",color:"var(--text-primary)",fontSize:"1.1rem",fontWeight:"600",padding:"0.5rem",width:"100%",maxWidth:"300px"},placeholder:"Adversary name"}):e.jsx("h4",{style:{...pe.rowTitle,color:p?"color-mix(in srgb, var(--gray-400) 80%, transparent)":pe.rowTitle.color,textAlign:"left",margin:0,fontSize:"1.1rem"},children:((Y=t.name)==null?void 0:Y.replace(/\s+\(\d+\)$/,""))||t.name}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[(t.type||h)&&e.jsx("div",{children:h?e.jsxs("select",{value:t.type||"",onChange:n=>{d&&d(t.id,{type:n.target.value})},style:{backgroundColor:"var(--purple)",border:"1px solid var(--border)",borderRadius:"3px",color:"var(--text-primary)",fontSize:"14px",fontWeight:"600",textTransform:"uppercase",padding:"2px 6px",outline:"none"},children:[e.jsx("option",{value:"Standard",children:"Standard"}),e.jsx("option",{value:"Solo",children:"Solo"}),e.jsx("option",{value:"Bruiser",children:"Bruiser"}),e.jsx("option",{value:"Horde",children:"Horde"}),e.jsx("option",{value:"Minion",children:"Minion"}),e.jsx("option",{value:"Ranged",children:"Ranged"}),e.jsx("option",{value:"Leader",children:"Leader"}),e.jsx("option",{value:"Skulk",children:"Skulk"}),e.jsx("option",{value:"Social",children:"Social"}),e.jsx("option",{value:"Support",children:"Support"})]}):e.jsx("span",{style:{...pe.badge,...pe.typeBadge},children:t.type})}),(t.difficulty||h)&&e.jsx("div",{children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[e.jsx(it,{size:28,strokeWidth:1,style:{color:"var(--text-secondary)"}}),h?e.jsx("input",{type:"text",value:t.difficulty||"",onChange:n=>{const f=n.target.value.replace(/[^0-9]/g,"");f.length<=2&&d&&d(t.id,{difficulty:parseInt(f)||0})},onKeyDown:n=>{if(n.key==="ArrowUp"){n.preventDefault();const f=parseInt(t.difficulty)||0;d&&d(t.id,{difficulty:Math.min(f+1,99)})}else if(n.key==="ArrowDown"){n.preventDefault();const f=parseInt(t.difficulty)||0;d&&d(t.id,{difficulty:Math.max(f-1,0)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.625rem",fontWeight:600,width:"20px",textAlign:"center",outline:"none"},placeholder:"10",maxLength:"2"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.625rem",fontWeight:600,color:"white",pointerEvents:"none"},children:t.difficulty})]})}),(t.atk!==void 0||h)&&e.jsx("div",{children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[e.jsx(lt,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)"}}),h?e.jsx("input",{type:"text",value:t.atk||"",onChange:n=>{const f=n.target.value.replace(/[^0-9+\-d]/g,"");f.length<=3&&d&&d(t.id,{atk:f})},onKeyDown:n=>{if(n.key==="ArrowUp"){n.preventDefault();const f=parseInt(t.atk)||0;d&&d(t.id,{atk:f>=0?`+${f+1}`:`${f+1}`})}else if(n.key==="ArrowDown"){n.preventDefault();const f=parseInt(t.atk)||0;d&&d(t.id,{atk:f>0?`+${f-1}`:`${f-1}`})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.625rem",fontWeight:600,width:"20px",textAlign:"center",outline:"none"},placeholder:"+1",maxLength:"3"}):e.jsxs("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.625rem",fontWeight:600,color:"white",pointerEvents:"none"},children:[t.atk>=0?"+":"",t.atk]})]})}),(t.tier||h)&&e.jsx("div",{children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[e.jsx(dt,{size:28,strokeWidth:1,style:{color:"var(--text-secondary)"}}),h?e.jsx("input",{type:"text",value:t.tier||"",onChange:n=>{const f=n.target.value.replace(/[^1-4]/g,"");f.length<=1&&d&&d(t.id,{tier:f===""?"":parseInt(f)})},onKeyDown:n=>{if(n.key==="ArrowUp"){n.preventDefault();const f=parseInt(t.tier)||1;d&&d(t.id,{tier:Math.min(f+1,4)})}else if(n.key==="ArrowDown"){n.preventDefault();const f=parseInt(t.tier)||1;d&&d(t.id,{tier:Math.max(f-1,1)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.625rem",fontWeight:600,width:"20px",textAlign:"center",outline:"none"},maxLength:"1"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.625rem",fontWeight:600,color:"white",pointerEvents:"none"},children:t.tier})]})})]})]})}),e.jsxs("div",{style:{borderRadius:"0 0 8px 8px"},children:[(t.motives||t.experience&&t.experience.length>0||h)&&e.jsxs("div",{style:{padding:"0.75rem 8px",marginBottom:"1rem"},children:[(t.motives||h)&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",marginBottom:t.experience&&t.experience.length>0||h?"1rem":"0"},children:[e.jsx("div",{style:{fontSize:"0.875rem",fontWeight:600,color:"var(--text-primary)",marginBottom:"0.5rem"},children:"Motives"}),h?e.jsx("textarea",{value:t.motives||"",onChange:n=>d&&d(t.id,{motives:n.target.value}),placeholder:"Enter motives (e.g., Hunt, defend, patrol)",rows:2,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"vertical"}}):e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)"},children:t.motives})]}),(t.experience&&t.experience.length>0||h)&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("div",{style:{fontSize:"0.875rem",fontWeight:600,color:"var(--text-primary)",marginBottom:"0.5rem"},children:"Experience"}),h?e.jsx("textarea",{value:(t.experience||[]).join(", ")||"",onChange:n=>{const f=n.target.value.split(",").map(v=>v.trim()).filter(v=>v.length>0);d&&d(t.id,{experience:f})},placeholder:"Enter experience tags (e.g., Battle Hardened +3, Keen Senses +2)",rows:2,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"vertical"}}):e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)"},children:t.experience.map(n=>typeof n=="string"?n:`${n.name} ${n.modifier>=0?"+":""}${n.modifier}`).join(", ")})]})]}),(t.features&&t.features.length>0||h)&&e.jsxs("div",{style:{marginBottom:"1rem",padding:"8px"},children:[(t.atk!==void 0&&t.weapon||t.features.filter(n=>n.type==="Action").length>0||h)&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px",textAlign:"center",minWidth:"80px"},children:"Actions"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[h?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)"},children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[e.jsx("input",{type:"text",value:t.weapon||"",onChange:n=>d&&d(t.id,{weapon:n.target.value}),placeholder:"Standard attack name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}}),e.jsxs("select",{value:t.range||"",onChange:n=>d&&d(t.id,{range:n.target.value}),style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",appearance:"none",backgroundImage:`url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",backgroundSize:"1rem",paddingRight:"2rem"},children:[e.jsx("option",{value:"",children:"Range"}),e.jsx("option",{value:"Melee",children:"Melee"}),e.jsx("option",{value:"Very Close",children:"Very Close"}),e.jsx("option",{value:"Close",children:"Close"}),e.jsx("option",{value:"Far",children:"Far"}),e.jsx("option",{value:"Very Far",children:"Very Far"})]}),e.jsx("input",{type:"text",value:t.damage||"",onChange:n=>d&&d(t.id,{damage:n.target.value}),placeholder:"Damage (e.g., 1d6+2)",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}})]})}):t.atk!==void 0&&t.weapon&&e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsxs("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:[t.weapon," (Standard)"]}),e.jsxs("span",{children:[" - Make an attack against a target within ",t.range||"Melee"," range. On a success, deal ",t.damage||"damage varies","."]})]}),(()=>{const n=t.features.filter(v=>v.type==="Action");return(h&&n.length===0?[{type:"Action",name:"",description:""}]:n).map((v,F)=>h?e.jsxs("div",{style:{display:"flex",gap:"0.5rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:v.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false","data-lpignore":"true","data-form-type":"other",name:`feature-name-${v.type.toLowerCase()}`,onChange:R=>{const k=[...t.features||[]],C=k.findIndex(a=>a.type==="Action"&&a===v);C>=0?k[C]={...k[C],name:R.target.value}:k.push({type:"Action",name:R.target.value,description:v.description||""});const W=k.filter(a=>a.type==="Action"),s=W[W.length-1];s&&s.name.trim()&&k.push({type:"Action",name:"",description:""}),d&&d(t.id,{features:k})},placeholder:"Action name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:v.description||"",onChange:R=>{const k=[...t.features||[]],C=k.findIndex(a=>a.type==="Action"&&a===v);C>=0?k[C]={...k[C],description:R.target.value}:k.push({type:"Action",name:v.name||"",description:R.target.value});const W=k.filter(a=>a.type==="Action"),s=W[W.length-1];s&&s.name.trim()&&k.push({type:"Action",name:"",description:""}),d&&d(t.id,{features:k})},onInput:R=>{const k=R.target.offsetHeight;R.target.style.height="auto";const C=R.target.scrollHeight,W=C>k?C:k;R.target.style.height=W+"px"},placeholder:"Action description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(We,{feature:v,featureType:"Action",item:t,onUpdate:d,handleFeatureDeleteClick:M,deleteConfirmations:T,getFeatureKey:D})]},F):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:v.name}),v.description&&e.jsxs("span",{children:[" - ",v.description]})]},F))})()]})]}),(t.features.filter(n=>n.type==="Passive").length>0||h)&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px",textAlign:"center",minWidth:"80px"},children:"Passives"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:(()=>{const n=t.features.filter(v=>v.type==="Passive");return(h&&n.length===0?[{type:"Passive",name:"",description:""}]:n).map((v,F)=>h?e.jsxs("div",{style:{display:"flex",gap:"0.5rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:v.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:R=>{const k=[...t.features||[]],C=k.findIndex(a=>a.type==="Passive"&&a===v);C>=0?k[C]={...k[C],name:R.target.value}:k.push({type:"Passive",name:R.target.value,description:v.description||""});const W=k.filter(a=>a.type==="Passive"),s=W[W.length-1];s&&s.name.trim()&&k.push({type:"Passive",name:"",description:""}),d&&d(t.id,{features:k})},placeholder:"Passive name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:v.description||"",onChange:R=>{const k=[...t.features||[]],C=k.findIndex(a=>a.type==="Passive"&&a===v);C>=0?k[C]={...k[C],description:R.target.value}:k.push({type:"Passive",name:v.name||"",description:R.target.value});const W=k.filter(a=>a.type==="Passive"),s=W[W.length-1];s&&s.name.trim()&&k.push({type:"Passive",name:"",description:""}),d&&d(t.id,{features:k})},onInput:R=>{const k=R.target.offsetHeight;R.target.style.height="auto";const C=R.target.scrollHeight,W=C>k?C:k;R.target.style.height=W+"px"},placeholder:"Passive description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(We,{feature:v,featureType:"Passive",item:t,onUpdate:d,handleFeatureDeleteClick:M,deleteConfirmations:T,getFeatureKey:D})]},F):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:v.name}),v.description&&e.jsxs("span",{children:[" - ",v.description]})]},F))})()})]}),(t.features.filter(n=>n.type==="Reaction").length>0||h)&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px",textAlign:"center",minWidth:"80px"},children:"Reactions"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:(()=>{const n=t.features.filter(v=>v.type==="Reaction");return(h&&n.length===0?[{type:"Reaction",name:"",description:""}]:n).map((v,F)=>h?e.jsxs("div",{style:{display:"flex",gap:"0.5rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:v.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:R=>{const k=[...t.features||[]],C=k.findIndex(a=>a.type==="Reaction"&&a===v);C>=0?k[C]={...k[C],name:R.target.value}:k.push({type:"Reaction",name:R.target.value,description:v.description||""});const W=k.filter(a=>a.type==="Reaction"),s=W[W.length-1];s&&s.name.trim()&&k.push({type:"Reaction",name:"",description:""}),d&&d(t.id,{features:k})},placeholder:"Reaction name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:v.description||"",onChange:R=>{const k=[...t.features||[]],C=k.findIndex(a=>a.type==="Reaction"&&a===v);C>=0?k[C]={...k[C],description:R.target.value}:k.push({type:"Reaction",name:v.name||"",description:R.target.value});const W=k.filter(a=>a.type==="Reaction"),s=W[W.length-1];s&&s.name.trim()&&k.push({type:"Reaction",name:"",description:""}),d&&d(t.id,{features:k})},onInput:R=>{const k=R.target.offsetHeight;R.target.style.height="auto";const C=R.target.scrollHeight,W=C>k?C:k;R.target.style.height=W+"px"},placeholder:"Reaction description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(We,{feature:v,featureType:"Reaction",item:t,onUpdate:d,handleFeatureDeleteClick:M,deleteConfirmations:T,getFeatureKey:D})]},F):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:v.name}),v.description&&e.jsxs("span",{children:[" - ",v.description]})]},F))})()})]})]})]}),t.type!=="Minion"&&t.thresholds&&e.jsxs("div",{style:{marginBottom:"1rem",padding:"0 8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px",textAlign:"center",minWidth:"80px"},children:"Status"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{padding:"0.75rem 0 0 0"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",fontSize:"0.875rem"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"2px",marginTop:"-3px"},children:e.jsx(me,{size:16,style:{color:"var(--red)"}})}),e.jsx($e,{value:t.thresholds.major||"7"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"2px",marginTop:"-3px"},children:[e.jsx(me,{size:16,style:{color:"var(--red)"}}),e.jsx(me,{size:16,style:{color:"var(--red)"}})]}),e.jsx($e,{value:t.thresholds.severe||"14"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"2px",marginTop:"-3px"},children:[e.jsx(me,{size:16,style:{color:"var(--red)"}}),e.jsx(me,{size:16,style:{color:"var(--red)"}}),e.jsx(me,{size:16,style:{color:"var(--red)"}})]})]})})]}),Z&&Z.length>0&&e.jsx("div",{style:{marginTop:"1rem",borderTop:"1px solid var(--border)"},children:Z.map((n,f)=>{const v=(n.hp||0)>=(n.hpMax||1);return e.jsx("div",{children:e.jsxs("div",{style:{backgroundColor:"var(--bg-primary)",borderRadius:"4px",padding:"4px",border:"1px solid var(--border)",marginBottom:"4px",display:"flex",justifyContent:"flex-start",alignItems:"center",gap:"8px",opacity:v?.7:1,backgroundColor:v?"var(--gray-900)":"var(--bg-secondary)",borderColor:v?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--border)",position:"relative"},children:[v&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                          45deg,
                          transparent 0px,
                          transparent 8px,
                          var(--gray-600) 9px,
                          var(--gray-600) 9px
                        )`,pointerEvents:"none",zIndex:1,borderRadius:"4px"}}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"var(--text-secondary)",fontSize:"0.75rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em",zIndex:2,backgroundColor:"var(--gray-900)",padding:"0.125rem 0.25rem",borderRadius:"0.25rem",border:"0.5px solid var(--gray-600)"},children:"DEFEATED"})]}),e.jsx("div",{style:{backgroundColor:"var(--bg-primary)",borderRadius:"6px",border:"1px solid var(--border-hover)",width:"32px",textAlign:"center",flexShrink:0,padding:"2px"},children:e.jsx("span",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)"},children:n.duplicateNumber||1})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"2px"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:F=>{if(F.stopPropagation(),!u||o!=="adversary")return;F.currentTarget.getBoundingClientRect();const R=F.currentTarget.querySelector(".pip-container");if(!R)return;const k=R.getBoundingClientRect(),C=F.clientX-k.left,W=n.hp||0,s=n.hpMax||1;if(C<0){W>0&&l&&l(n.id,1,W);return}if(C>k.width){W<s&&u(n.id,1,W,s);return}const a=k.width,x=a*.05,r=a-2*x,m=C-x,_=W/s,O=r*_;m<O?W>0&&l&&l(n.id,1,W):W<s&&u(n.id,1,W,s)},children:e.jsx("div",{className:"pip-container",style:{display:"flex",gap:"2px",alignItems:"center"},children:Array.from({length:n.hpMax||1},(F,R)=>e.jsx("span",{style:{fontSize:"0.75rem",color:R<(n.hp||0)?"var(--red)":"var(--text-secondary)",transition:"all 0.1s ease"},children:e.jsx(me,{size:16})},R))})}),n.stressMax>0&&e.jsx("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:F=>{if(F.stopPropagation(),!A||o!=="adversary")return;F.currentTarget.getBoundingClientRect();const R=F.currentTarget.querySelector(".pip-container");if(!R)return;const k=R.getBoundingClientRect(),C=F.clientX-k.left,W=n.stress||0,s=n.stressMax;if(C<0){W>0&&A(n.id,-1);return}if(C>k.width){W<s&&A(n.id,1);return}const a=k.width,x=a*.05,r=a-2*x,m=C-x,_=W/s,O=r*_;m<O?W>0&&A(n.id,-1):W<s&&A(n.id,1)},children:e.jsx("div",{className:"pip-container",style:{display:"flex",gap:"2px",alignItems:"center"},children:Array.from({length:n.stressMax},(F,R)=>e.jsx("span",{style:{fontSize:"0.75rem",color:R<(n.stress||0)?"var(--gold)":"var(--text-secondary)",transition:"all 0.1s ease"},children:e.jsx(_e,{size:16})},R))})})]})]},n.id)},n.id)})}),(t.description||h)&&e.jsxs("div",{style:{marginBottom:"1rem",padding:"0 8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px",textAlign:"center",minWidth:"80px"},children:"Description"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),h?e.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-primary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"none",overflow:"hidden",fontFamily:"inherit"},value:t.description,onChange:n=>{n.target.style.height="auto",n.target.style.height=n.target.scrollHeight+"px",d&&d(t.id,{description:n.target.value})},placeholder:"Enter adversary description..."}):e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",whiteSpace:"pre-wrap"},children:t.description})]}),ae()]})};return(i==="expanded"||i==="edit")&&(o==="adversary"||o==="adversaries")?ie():o==="adversary"||o==="adversaries"?null:e.jsxs("div",{className:ce(),style:q(!0),children:[e.jsxs("div",{style:pe.rowMain,children:[e.jsx("h4",{style:pe.rowTitle,children:V()}),e.jsx("div",{style:pe.rowMeta,children:le()})]}),e.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"12px",margin:0},children:["Expanded view coming soon for ",o]})]})},Et="modulepreload",It=function(t){return"/Daggerheart/"+t},qe={},Ce=function(o,i,g){if(!i||i.length===0)return o();const y=document.getElementsByTagName("link");return Promise.all(i.map(u=>{if(u=It(u),u in qe)return;qe[u]=!0;const l=u.endsWith(".css"),A=l?'[rel="stylesheet"]':"";if(!!g)for(let z=y.length-1;z>=0;z--){const H=y[z];if(H.href===u&&(!l||H.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${A}`))return;const E=document.createElement("link");if(E.rel=l?"stylesheet":Et,l||(E.as="script",E.crossOrigin=""),E.href=u,document.head.appendChild(E),l)return new Promise((z,H)=>{E.addEventListener("load",z),E.addEventListener("error",()=>H(new Error(`Unable to preload CSS for ${u}`)))})})).then(()=>o()).catch(u=>{const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=u,window.dispatchEvent(l),!l.defaultPrevented)throw u})},At=({onSave:t,onRefresh:o,onAddItem:i})=>{const[g,y]=j.useState({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:11,thresholds:{major:7,severe:12},hpMax:3,stressMax:1,atk:1,weapon:"",range:"Melee",damage:"",experience:[],features:[]}),[u,l]=j.useState(!1),A=async()=>{if(!g.name.trim()){alert("Please enter a name for the adversary");return}l(!0);try{const E={...g,hp:0,stress:0,source:"Homebrew"},z=await t(E);i&&z&&i(z),o&&await o(),y({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:11,thresholds:{major:7,severe:12},hpMax:3,stressMax:1,atk:1,weapon:"",range:"Melee",damage:"",experience:[],features:[]}),alert("Custom adversary created successfully!")}catch(E){console.error("Error saving adversary:",E),alert("Error saving adversary. Please try again.")}finally{l(!1)}},d={...g,id:"new-adversary",hp:0,stress:0,source:"Homebrew"};return e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem",display:"flex",justifyContent:"center",alignItems:"flex-start"},children:e.jsxs("div",{style:{maxWidth:"600px",width:"100%"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h2",{style:{color:"var(--text-primary)",fontSize:"1.5rem",fontWeight:"600",margin:0},children:"Create Custom Adversary"}),e.jsx("button",{onClick:A,disabled:u||!g.name.trim(),style:{padding:"0.75rem 1.5rem",backgroundColor:u||!g.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"8px",cursor:u||!g.name.trim()?"not-allowed":"pointer",fontSize:"1rem",fontWeight:"600",opacity:u||!g.name.trim()?.6:1},children:u?"Creating...":"Create and Add"})]}),e.jsx(Me,{item:d,type:"adversary",mode:"edit",onUpdate:(E,z)=>{y(H=>({...H,...z}))}})]})})},zt=(t,o)=>{const[i,g]=j.useState("max-content"),y=j.useCallback(()=>{if(!o.current||t<=3)return"max-content";const u=o.current.offsetWidth,A=Math.floor(u/120);return A<=1?"max-content":t===4?"max-content max-content":t===5||t===6?A>=2?"max-content max-content":"max-content":t===7?A>=3?"max-content max-content max-content":A>=2?"max-content max-content":"max-content":"repeat(auto-fit, minmax(80px, max-content))"},[t,o]);return j.useEffect(()=>{const u=y();g(u);const l=new ResizeObserver(()=>{const A=y();g(A)});return o.current&&l.observe(o.current),()=>{l.disconnect()}},[y]),i},Wt=({encounter:t})=>{var y,u;const o=j.useRef(null),i=((y=t.encounterItems)==null?void 0:y.length)||0,g=zt(i,o);return e.jsx("div",{ref:o,className:"saved-encounter-adversary-list",style:{flex:1,fontSize:"0.8rem",color:"var(--text-secondary)",lineHeight:"1.3",display:"grid",gridTemplateColumns:g,gap:"0.25rem 1rem",gridAutoRows:"min-content"},children:((u=t.encounterItems)==null?void 0:u.length)>0?t.encounterItems.map((l,A)=>{var E;const d=l.item.baseName||((E=l.item.name)==null?void 0:E.replace(/\s+\(\d+\)$/,""))||l.item.name;return e.jsxs("div",{style:{marginBottom:"0.125rem"},children:[l.quantity,"x ",d]},A)}):e.jsx("div",{children:"No adversaries"})})},be={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},Se={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1,lowerTierAdversary:1};let ke={adversaries:[]},Ee={environments:[]},Ie=!1;const Ye=()=>{const t=JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]"),o=JSON.parse(localStorage.getItem("daggerheart-custom-environments")||"[]");return{customAdversaries:t,customEnvironments:o}},Rt=(t,o)=>{t==="adversary"?localStorage.setItem("daggerheart-custom-adversaries",JSON.stringify(o)):t==="environment"&&localStorage.setItem("daggerheart-custom-environments",JSON.stringify(o))},Be=async()=>{if(Ie)return;let t={adversaries:[]},o={environments:[]},i={adversaries:[]},g={environments:[]};try{const l=await Ce(()=>import("./adversaries-9c8932de.js"),[]);t=(l==null?void 0:l.default)||l}catch(l){console.warn("Failed to load adversaries.json:",l)}try{const l=await Ce(()=>import("./environments-c340637c.js"),[]);o=(l==null?void 0:l.default)||l}catch(l){console.warn("Failed to load environments.json:",l)}try{const l=await Ce(()=>import("./playtest-adversaries-4a099c10.js"),[]);i=(l==null?void 0:l.default)||l}catch(l){console.warn("Failed to load playtest-adversaries.json:",l)}try{const l=await Ce(()=>import("./playtest-environments-d9cdffb6.js"),[]);g=(l==null?void 0:l.default)||l}catch(l){console.warn("Failed to load playtest-environments.json:",l)}const{customAdversaries:y,customEnvironments:u}=Ye();ke={...t,adversaries:[...t.adversaries||[],...i.adversaries||[],...y]},Ee={...o,environments:[...o.environments||[],...g.environments||[],...u]},Ie=!0,console.log(`Loaded ${ke.adversaries.length} adversaries and ${Ee.environments.length} environments`)},Nt=t=>{const{customAdversaries:o}=Ye(),i={...t,id:`custom-${Date.now()}-${Math.random().toString(36).slice(2,10)}`,source:t.source||"Homebrew"},g=[...o,i];return Rt("adversary",g),Ie=!1,Be(),i},Tt=(t,o=[],i=4,g=1)=>{const[y,u]=j.useState(""),[l,A]=j.useState([{field:"tier",direction:"asc"},{field:"name",direction:"asc"}]),[d,E]=j.useState([]),[z,H]=j.useState(!0),[Z,b]=j.useState([]),[T,K]=j.useState([]),[D,M]=j.useState(!1),[w,P]=j.useState(!1),I=j.useRef(null),$=j.useRef(null);j.useEffect(()=>{(async()=>{await Be(),H(!1);let f=[];t==="adversary"?f=ke.adversaries||[]:t==="environment"&&(f=Ee.environments||[]),E(f)})()},[t]);const ee=j.useCallback(async()=>{Ie=!1,await Be();let n=[];t==="adversary"?n=ke.adversaries||[]:t==="environment"&&(n=Ee.environments||[]),E(n)},[t]),q=n=>{const f=d.map(v=>v[n]).filter(Boolean);return[...new Set(f)].sort((v,F)=>typeof v=="number"&&typeof F=="number"?v-F:String(v).localeCompare(String(F)))},ce=q("tier"),V=q("type"),le=j.useMemo(()=>{let n=d.filter(f=>{var k,C;const v=f.name.toLowerCase().includes(y.toLowerCase())||((k=f.type)==null?void 0:k.toLowerCase().includes(y.toLowerCase()))||((C=f.description)==null?void 0:C.toLowerCase().includes(y.toLowerCase())),F=Z.length===0||(Z.includes("party-tier")?f.tier===g:Z.includes(f.tier.toString())),R=T.length===0||T.includes(f.type);return v&&F&&R});return n.sort((f,v)=>{for(const F of l){const{field:R,direction:k}=F;let C=f[R],W=v[R];if(R==="tier")C=parseInt(C)||0,W=parseInt(W)||0;else if(R==="cost"){const s=a=>{if(t!=="adversary")return 0;const x=be[a.type]||2;let r=0;const m=o.filter(O=>O.type==="adversary"&&O.item.type==="Solo"&&O.quantity>0).reduce((O,de)=>O+de.quantity,0),_=o.filter(O=>O.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(O.item.type)&&O.quantity>0).reduce((O,de)=>O+de.quantity,0);return a.type==="Solo"&&m===1&&(r+=2),["Bruiser","Horde","Leader","Solo"].includes(a.type)&&_===0&&(r+=1),x+r};C=s(f),W=s(v)}else if(R==="difficulty"){const s=parseInt(C),a=parseInt(W);!isNaN(s)&&!isNaN(a)?(C=s,W=a):!isNaN(s)&&isNaN(a)?(C=s,W=999):isNaN(s)&&!isNaN(a)?(C=999,W=a):(C=String(C||"").toLowerCase(),W=String(W||"").toLowerCase())}else typeof C=="string"&&typeof W=="string"?(C=C.toLowerCase(),W=W.toLowerCase()):(C=String(C||"").toLowerCase(),W=String(W||"").toLowerCase());if(k==="asc"){if(C>W)return 1;if(C<W)return-1}else{if(C<W)return 1;if(C>W)return-1}}return 0}),n},[d,y,l,Z,T,o,i,g]),ae=n=>{A(f=>{const v=f.findIndex(F=>F.field===n);if(v>=0)if(v===0){const F=[...f];return F[0]={...F[0],direction:F[0].direction==="asc"?"desc":"asc"},F}else{const F=[...f];return F.splice(v,1)[0],[{field:n,direction:"asc"},...F]}else return[{field:n,direction:"asc"},...f]})},ie=n=>{b(n==="clear"?[]:n==="party-tier"?["party-tier"]:f=>f.includes(n)?f.filter(v=>v!==n):[...f,n])},te=n=>{K(n==="clear"?[]:f=>f.includes(n)?f.filter(v=>v!==n):[...f,n])},p=Z.length>0,h=T.length>0;return j.useEffect(()=>{const n=v=>{const F=v.target.closest(".filter-dropdown"),R=v.target.closest(".header-filter-icon");F||R||(M(!1),P(!1))},f=v=>{v.key==="Escape"&&(M(!1),P(!1))};return document.addEventListener("pointerdown",n,!0),document.addEventListener("mousedown",n,!0),document.addEventListener("touchstart",n,!0),document.addEventListener("click",n,!0),document.addEventListener("keydown",f,!0),()=>{document.removeEventListener("pointerdown",n,!0),document.removeEventListener("mousedown",n,!0),document.removeEventListener("touchstart",n,!0),document.removeEventListener("click",n,!0),document.removeEventListener("keydown",f,!0)}},[M,P]),{searchTerm:y,setSearchTerm:u,sortFields:l,handleSort:ae,filteredAndSortedData:le,loading:z,refreshData:ee,selectedTiers:Z,selectedTypes:T,showTierDropdown:D,setShowTierDropdown:M,showTypeDropdown:w,setShowTypeDropdown:P,tierFilterRef:I,typeFilterRef:$,uniqueTiers:ce,uniqueTypes:V,handleTierSelect:ie,handleTypeSelect:te,isTierFiltered:p,isTypeFiltered:h,getDropdownStyle:n=>{if(!n.current)return{};const f=n.current.getBoundingClientRect();return{position:"fixed",top:f.bottom+4,left:f.left-100,zIndex:99999}}}},Bt=({searchTerm:t,onSearchChange:o,type:i,partyControls:g})=>e.jsxs("div",{style:J.browserHeader,children:[e.jsx("input",{type:"text",placeholder:"Search",value:t,onChange:y=>o(y.target.value),style:J.searchInput}),g&&e.jsx("div",{style:J.partyControls,children:g})]}),Dt=({sortFields:t,onSort:o,type:i,uniqueTiers:g,uniqueTypes:y,selectedTiers:u,selectedTypes:l,showTierDropdown:A,setShowTierDropdown:d,showTypeDropdown:E,setShowTypeDropdown:z,tierFilterRef:H,typeFilterRef:Z,handleTierSelect:b,handleTypeSelect:T,isTierFiltered:K,isTypeFiltered:D,getDropdownStyle:M,costFilter:w,showCostDropdown:P,setShowCostDropdown:I,costFilterRef:$,handleCostFilterSelect:ee,isCostFiltered:q})=>{const[ce,V]=j.useState(null),ae=(()=>i==="adversary"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"cost",label:"Cost",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:i==="environment"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:[])(),ie=()=>{if(!P)return null;const p=[{value:"all",label:"All"},{value:"auto-grey",label:"Auto Grey"},{value:"auto-hide",label:"Auto Hide"}];return Ne.createPortal(e.jsx("div",{className:"filter-dropdown",style:{...J.filterDropdown,...M($),maxHeight:"60vh",overflow:"auto"},onMouseDown:h=>h.stopPropagation(),onClick:h=>h.stopPropagation(),children:p.map(h=>{const Y=w===h.value;return e.jsxs("div",{style:{...J.filterOption,...Y?J.filterOptionSelected:{}},onClick:()=>ee(h.value),children:[e.jsx("span",{style:J.checkIcon,children:Y?e.jsx(je,{size:16}):e.jsx(we,{size:16})}),e.jsx("span",{style:J.filterLabel,children:h.label})]},h.value)})}),document.body)},te=(p,h,Y,n,f,v,F,R)=>{if(!f)return null;const k=()=>{(p==="tier"||p==="type")&&n("clear")};return Ne.createPortal(e.jsxs("div",{className:"filter-dropdown",style:{...J.filterDropdown,...M(F),maxHeight:"60vh",overflow:"auto"},onMouseDown:C=>C.stopPropagation(),onClick:C=>C.stopPropagation(),children:[e.jsxs("div",{style:{...J.filterOption,...Y.length===0?J.filterOptionSelected:{}},onClick:k,children:[e.jsx("span",{style:J.checkIcon,children:Y.length===0?e.jsx(je,{size:16}):e.jsx(we,{size:16})}),e.jsx("span",{style:J.filterLabel,children:"All"})]}),p==="tier"&&e.jsxs("div",{style:{...J.filterOption,...Y.includes("party-tier")?J.filterOptionSelected:{}},onClick:()=>n("party-tier"),children:[e.jsx("span",{style:J.checkIcon,children:Y.includes("party-tier")?e.jsx(je,{size:16}):e.jsx(we,{size:16})}),e.jsx("span",{style:J.filterLabel,children:"Party Tier"})]}),h.map(C=>{const W=Y.includes(C.toString());return e.jsxs("div",{style:{...J.filterOption,...W?J.filterOptionSelected:{}},onClick:()=>n(C.toString()),children:[e.jsx("span",{style:J.checkIcon,children:W?e.jsx(je,{size:16}):e.jsx(we,{size:16})}),e.jsx("span",{style:J.filterLabel,children:C})]},C)})]}),document.body)};return e.jsx("tr",{style:J.tableHeader,children:ae.map(p=>e.jsxs("th",{style:{...J.tableHeaderCell,...ce===p.key?J.tableHeaderCellHover:{},position:"relative",...p.key==="name"?{width:"auto",minWidth:"0"}:{},...p.key==="tier"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...p.key==="type"?{width:"80px",minWidth:"80px",maxWidth:"80px"}:{},...p.key==="difficulty"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...p.key==="cost"?{width:"50px",minWidth:"50px",maxWidth:"50px"}:{},...p.key==="action"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{}},onClick:()=>o(p.key),onMouseEnter:()=>V(p.key),onMouseLeave:()=>V(null),children:[p.hasFilter?e.jsxs("div",{style:J.headerWithFilter,children:[e.jsx("span",{style:{cursor:"pointer"},onClick:h=>{h.stopPropagation(),o(p.key)},children:p.label}),e.jsxs("button",{ref:p.key==="tier"?H:p.key==="type"?Z:$,style:{...J.headerFilterIcon,...p.key==="tier"&&K?J.headerFilterIconActive:{},...p.key==="type"&&D?J.headerFilterIconActive:{},...p.key==="cost"&&q?J.headerFilterIconActive:{}},className:"header-filter-icon",onClick:h=>{h.stopPropagation(),p.key==="tier"?(d(!A),z(!1),I(!1)):p.key==="type"?(z(!E),d(!1),I(!1)):p.key==="cost"&&(I(!P),d(!1),z(!1))},children:[e.jsx(pt,{size:14}),p.key==="tier"&&K||p.key==="type"&&D||p.key==="cost"&&q?e.jsx("span",{style:J.filterActiveDot}):null]})]}):p.label,p.key==="tier"&&te("tier",g,u,b,A,d,H),p.key==="type"&&te("type",y,l,T,E,z,Z),p.key==="cost"&&ie()]},p.key))})},Mt=({item:t,onAdd:o,type:i,onRowClick:g,encounterItems:y=[],pcCount:u=4,playerTier:l=1,remainingBudget:A=0,costFilter:d="auto-grey",onAdversaryClick:E})=>{const[z,H]=j.useState(!1),Z=()=>{o(t)},b=()=>{if(i!=="adversary")return null;const D=be[t.type]||2;let M=0;const w=y.filter(I=>I.type==="adversary"&&I.item.type==="Solo"&&I.quantity>0).reduce((I,$)=>I+$.quantity,0),P=y.filter(I=>I.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(I.item.type)&&I.quantity>0).reduce((I,$)=>I+$.quantity,0);return t.type==="Solo"&&w===1&&(M+=2),["Bruiser","Horde","Leader","Solo"].includes(t.type)&&P===0&&(M+=1),D+M},K=(()=>{if(i==="adversary"){const D=b();be[t.type];const M=D>A||A<=0;if(d==="auto-hide"&&M)return null;const w=d==="auto-grey"&&M?{opacity:.5,color:"var(--text-secondary)"}:{};return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...J.rowCell,width:"auto",minWidth:"0",textAlign:"left",...w},children:e.jsxs("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:[e.jsx("div",{style:{fontWeight:"600"},children:t.name}),t.description&&e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"0.125rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.description})]})}),e.jsx("td",{style:{...J.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...w},children:t.tier}),e.jsx("td",{style:{...J.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center",...w},children:t.type}),e.jsx("td",{style:{...J.rowCell,width:"50px",minWidth:"50px",maxWidth:"50px",textAlign:"center",...w},children:D}),e.jsx("td",{style:{...J.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...w},children:t.difficulty})]})}else if(i==="environment")return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...J.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:t.name}),e.jsx("td",{style:{...J.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:t.tier}),e.jsx("td",{style:{...J.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:t.type}),e.jsx("td",{style:{...J.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:t.difficulty})]});return null})();return K===null?null:e.jsx(e.Fragment,{children:e.jsxs("tr",{style:{...J.row,...z?J.rowHover:{}},onClick:()=>{i==="adversary"&&E?E(t):g&&g(t,i)},onMouseEnter:()=>H(!0),onMouseLeave:()=>H(!1),children:[K,e.jsx("td",{style:{width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",boxSizing:"border-box",overflow:"visible",textOverflow:"unset",whiteSpace:"nowrap"},children:e.jsx("button",{style:J.addButton,onClick:D=>{D.stopPropagation(),Z()},onMouseEnter:D=>{D.target.style.background="var(--bg-secondary)"},onMouseLeave:D=>{D.target.style.background="var(--purple)"},children:"+"})})]})})},Pt=({type:t,onAddItem:o,onCancel:i=null,onRowClick:g,encounterItems:y=[],pcCount:u=4,playerTier:l=1,partyControls:A=null,showContainer:d=!0,savedEncounters:E=[],onLoadEncounter:z,onDeleteEncounter:H,activeTab:Z="adversaries"})=>{const[b,T]=j.useState("all"),[K,D]=j.useState(!1),[M,w]=j.useState(null),[P,I]=j.useState({}),$=j.useRef({}),ee=j.useRef(null),q=N=>{P[N]?(H&&H(N),I(c=>{const S={...c};return delete S[N],S}),$.current[N]&&(clearTimeout($.current[N]),delete $.current[N])):(I(c=>({...c,[N]:!0})),$.current[N]&&clearTimeout($.current[N]),$.current[N]=setTimeout(()=>{I(c=>{const S={...c};return delete S[N],S}),delete $.current[N]},3e3))};j.useEffect(()=>()=>{Object.values($.current).forEach(N=>{clearTimeout(N)})},[]);const{searchTerm:ce,setSearchTerm:V,sortFields:le,handleSort:ae,filteredAndSortedData:ie,loading:te,refreshData:p,selectedTiers:h,selectedTypes:Y,showTierDropdown:n,setShowTierDropdown:f,showTypeDropdown:v,setShowTypeDropdown:F,tierFilterRef:R,typeFilterRef:k,uniqueTiers:C,uniqueTypes:W,handleTierSelect:s,handleTypeSelect:a,isTierFiltered:x,isTypeFiltered:r,getDropdownStyle:m}=Tt(t,y,u,l),O=(()=>{const N=3*u+2,c=y.reduce((B,oe)=>{if(oe.type==="adversary"){const ue=be[oe.item.type]||2;if(oe.item.type==="Minion"){const se=Math.ceil(oe.quantity/u);return B+se*ue}else return B+oe.quantity*ue}return B},0);let S=0;y.filter(B=>B.type==="adversary"&&B.item.type==="Solo"&&B.quantity>0).reduce((B,oe)=>B+oe.quantity,0)>=2&&(S+=Se.twoOrMoreSolos);const G=y.some(B=>B.type==="adversary"&&B.item.type==="Bruiser"&&B.quantity>0),Q=y.some(B=>B.type==="adversary"&&B.item.type==="Horde"&&B.quantity>0),ne=y.some(B=>B.type==="adversary"&&B.item.type==="Leader"&&B.quantity>0),X=y.some(B=>B.type==="adversary"&&B.item.type==="Solo"&&B.quantity>0);return!G&&!Q&&!ne&&!X&&(S+=Se.noBruisersHordesLeadersSolos),N+S-c})(),de=N=>{T(N),D(!1)},re=b!=="all";return te?e.jsx("div",{style:J.browser,children:e.jsx("div",{style:J.loading,children:"Loading..."})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:d?J.browserWrapper:J.browserWrapperNoContainer,children:[Z==="adversaries"&&e.jsxs(e.Fragment,{children:[e.jsx(Bt,{searchTerm:ce,onSearchChange:V,type:t,partyControls:A}),e.jsx("div",{className:"browser-content invisible-scrollbar",style:J.browserContent,children:e.jsxs("table",{style:J.browserTable,children:[e.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,backgroundColor:"var(--bg-primary)"},children:e.jsx(Dt,{sortFields:le,onSort:ae,type:t,uniqueTiers:C,uniqueTypes:W,selectedTiers:h,selectedTypes:Y,showTierDropdown:n,setShowTierDropdown:f,showTypeDropdown:v,setShowTypeDropdown:F,tierFilterRef:R,typeFilterRef:k,handleTierSelect:s,handleTypeSelect:a,isTierFiltered:x,isTypeFiltered:r,getDropdownStyle:m,costFilter:b,showCostDropdown:K,setShowCostDropdown:D,costFilterRef:ee,handleCostFilterSelect:de,isCostFiltered:re})}),e.jsx("tbody",{children:ie.map(N=>e.jsx(Mt,{item:N,onAdd:o,type:t,onRowClick:g,encounterItems:y,pcCount:u,playerTier:l,remainingBudget:O,costFilter:b,onAdversaryClick:c=>{t==="adversary"&&w(c)}},N.id))})]})})]}),Z==="encounters"&&e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:E.length===0?e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",textAlign:"center",padding:"2rem 1rem"},children:"No saved encounters yet"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:E.map(N=>e.jsxs("div",{onClick:()=>z&&z(N.id),className:"saved-encounter-card",style:{border:"1px solid var(--border)",borderRadius:"8px",padding:"8px",backgroundColor:"var(--bg-card)",transition:"background-color 0.2s ease",display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsxs("div",{style:{minWidth:"100px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",flexDirection:"column",justifyContent:"center",minHeight:"60px"},children:[e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Tier: ",(()=>{var L,G,Q,ne;const c=((ne=(Q=(G=(L=N.encounterItems)==null?void 0:L.filter(X=>X.type==="adversary"))==null?void 0:G.map(X=>X.item.tier))==null?void 0:Q.filter(X=>X!=null))==null?void 0:ne.sort((X,U)=>X-U))||[];if(c.length===0)return"N/A";if(c.length===1)return c[0];const S=[...new Set(c)];return S.length===1?S[0]:`${Math.min(...S)}-${Math.max(...S)}`})()]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Party Size: ",N.partySize||4]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)"},children:["Balance: ",(()=>{const c=N.partySize||4,S=3*c+2;let L=0;const G=N.encounterItems||[];G.filter(se=>se.type==="adversary"&&se.item.type==="Solo"&&se.quantity>0).reduce((se,xe)=>se+xe.quantity,0)>=2&&(L+=Se.twoOrMoreSolos);const ne=G.some(se=>se.type==="adversary"&&se.item.type==="Bruiser"&&se.quantity>0),X=G.some(se=>se.type==="adversary"&&se.item.type==="Horde"&&se.quantity>0),U=G.some(se=>se.type==="adversary"&&se.item.type==="Leader"&&se.quantity>0),B=G.some(se=>se.type==="adversary"&&se.item.type==="Solo"&&se.quantity>0);!ne&&!X&&!U&&!B&&(L+=Se.noBruisersHordesLeadersSolos);const oe=S+L,ue=G.reduce((se,xe)=>{if(xe.type==="adversary"){const ve=be[xe.item.type]||2;if(xe.item.type==="Minion"){const he=Math.ceil(xe.quantity/c);return se+he*ve}else return se+xe.quantity*ve}return se},0);return ue>oe?`+${ue-oe}`:ue===oe?"0":`-${oe-ue}`})()]})]}),e.jsx("div",{style:{minWidth:"120px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",alignItems:"center",minHeight:"60px"},children:e.jsx("div",{style:{fontWeight:"500",color:"var(--text-primary)",fontSize:"0.9rem",wordWrap:"break-word",wordBreak:"break-word",width:"150px",maxWidth:"150px"},children:N.name})}),e.jsx(Wt,{encounter:N}),e.jsx("button",{onClick:c=>{c.stopPropagation(),q(N.id)},style:{background:P[N.id]?"var(--danger)":"var(--gray-600)",border:"none",color:"white",padding:"0.4rem 0.8rem",borderRadius:"4px",fontSize:"0.75rem",cursor:"pointer",minWidth:"60px",transition:"background-color 0.2s"},children:"Delete"})]},N.id))})}),Z==="custom"&&e.jsx(At,{onSave:Nt,onRefresh:p,onAddItem:o})]}),M&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:2e3,display:"flex",alignItems:"center",justifyContent:"center",padding:"2rem"},onClick:()=>w(null),children:e.jsx("div",{style:{maxWidth:"600px",width:"90vw",maxHeight:"80vh",overflowY:"auto"},onClick:N=>N.stopPropagation(),children:e.jsx(Me,{item:M,type:"adversary",mode:"expanded",onClose:()=>w(null)})})})]})},J={browserWrapper:{display:"flex",flexDirection:"column",background:"var(--bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border)",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserWrapperNoContainer:{display:"flex",flexDirection:"column",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserContent:{flex:1,overflowY:"auto",overflowX:"visible",padding:0,width:"100%",scrollbarWidth:"none",msOverflowStyle:"none"},tableHeaderContainer:{flexShrink:0,position:"sticky",top:0,zIndex:15,backgroundColor:"var(--bg-secondary)"},browserTable:{width:"100%",minWidth:"100%",borderCollapse:"collapse",tableLayout:"fixed",background:"var(--bg-primary)",margin:0},browserHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--gray-900)",flexShrink:0,position:"sticky",top:0,zIndex:20},browserTitle:{margin:0,color:"var(--text-primary)",fontSize:"18px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"24px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",marginRight:"12px",transition:"all 0.2s ease"},partyControls:{display:"flex",alignItems:"center",gap:"12px",flexShrink:0},searchInputFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 3px rgba(139, 92, 246, 0.1)"},tableHeader:{background:"var(--gray-900)",borderBottom:"1px solid var(--border)",boxShadow:"0 1px 0 var(--border)",position:"sticky",top:"0",zIndex:10},tableHeaderCell:{backgroundColor:"var(--gray-900)",fontWeight:"700",borderBottom:"1px solid var(--border)",cursor:"pointer",userSelect:"none",minWidth:"100px",whiteSpace:"nowrap",padding:"4px 4px",color:"var(--text-primary)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",boxShadow:"0 1px 0 var(--border)",transition:"background-color 0.2s",position:"sticky",top:"0",zIndex:10},tableHeaderCellHover:{backgroundColor:"var(--bg-hover)"},sortIndicator:{fontSize:"12px",color:"var(--text-secondary)"},tableBody:{flex:1,overflowY:"auto",padding:"8px",backgroundColor:"var(--bg-primary)"},row:{height:"35px",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s ease",cursor:"pointer",backgroundColor:"var(--gray-900)"},rowHover:{backgroundColor:"var(--bg-secondary)"},expandedRow:{backgroundColor:"var(--bg-secondary)"},rowCell:{padding:"4px 4px",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid var(--border)"},rowCellName:{fontWeight:"500",minWidth:"150px"},rowCellCenter:{textAlign:"center",justifyContent:"center",minWidth:"80px"},rowActions:{width:"80px",textAlign:"center",padding:"4px 8px",borderBottom:"1px solid var(--border)"},addButton:{width:"2rem",height:"2rem",border:"1px solid var(--purple)",borderRadius:"var(--radius-sm)",background:"var(--purple)",color:"white",cursor:"pointer",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"500"},expandedContent:{padding:"0",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)"},columnName:{width:"auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",paddingLeft:"8px",textAlign:"left"},columnTier:{width:"80px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnType:{width:"100px",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},columnDifficulty:{width:"40px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnAction:{width:"32px",minWidth:"24px",maxWidth:"24px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"visible",textOverflow:"unset"},loading:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"var(--text-primary)",fontSize:"16px"},mobileBrowser:{width:"95vw",height:"90vh",maxWidth:"none"},mobileSearchInput:{fontSize:"16px"},headerWithFilter:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0px",position:"relative"},headerFilterIcon:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"2px 4px",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",position:"relative",marginLeft:"-2px"},headerFilterIconActive:{color:"var(--purple)"},filterIcon:{fontSize:"12px"},filterActiveDot:{position:"absolute",left:"50%",top:"2px",transform:"translateX(-50%)",width:"4px",height:"4px",borderRadius:"50%",background:"var(--purple)",pointerEvents:"none"},filterDropdown:{position:"fixed",background:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",zIndex:99999,marginTop:"4px",overflow:"hidden",width:"max-content",minWidth:"120px",maxWidth:"200px"},filterOption:{padding:"8px 12px",cursor:"pointer",color:"var(--text-primary)",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background-color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},filterOptionSelected:{backgroundColor:"var(--bg-hover)"},checkIcon:{width:"16px",height:"16px",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"12px"},filterLabel:{flex:1}},Lt=()=>e.jsx("div",{className:"pwa-install-prompt",style:{}}),Ht=({side:t="left",children:o,className:i="",style:g={}})=>{const y=t==="left",u={flex:1,minWidth:0,background:"var(--bg-primary)",overflowY:"auto",overflowX:y?"auto":"hidden",display:y?"block":"flex",flexDirection:y?"initial":"column",height:"100%",padding:y?"8px 0 8px 0":"0 8px 0 0",...g};return e.jsx("div",{className:i,style:u,children:o})},Ft=t=>3*t+2,Ot={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},Re={lessDifficult:-1,twoOrMoreSolos:-2,increasedDamage:-2,lowerTierAdversary:1,noBruisersHordesLeadersSolos:1,moreDangerous:2},$t=({isOpen:t,onClose:o,onAddAdversary:i,onAddAdversariesBulk:g,onAddEnvironment:y,onDeleteAdversary:u,onDeleteEnvironment:l,onDeleteCountdown:A,adversaries:d=[],environments:E=[],countdowns:z=[],savedEncounters:H=[],onSaveEncounter:Z,onLoadEncounter:b,onDeleteEncounter:T})=>{const{partySize:K,updatePartySize:D,currentEncounterName:M,updateCurrentEncounterName:w}=Je(),P=K,I=D,[$,ee]=j.useState({lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),[q,ce]=j.useState([]),[V,le]=j.useState(M||"Encounter"),[ae,ie]=j.useState("adversaries"),[te,p]=j.useState(null),[h,Y]=j.useState(null);j.useEffect(()=>{t&&!te&&le(M||"Encounter")},[t,te,M]);const n=()=>h?V!==h.name||JSON.stringify(q)!==JSON.stringify(h.encounterItems)||P!==h.partySize||JSON.stringify($)!==JSON.stringify(h.battlePointsAdjustments):!1,f=()=>{var c;if(q.length>0||(V||"").trim()!=="Encounter")return!0;if(te&&n()){if(h){const S=q.length,L=((c=h.encounterItems)==null?void 0:c.length)||0;if(S!==L||(V||"").trim()!==(h.name||""))return!0;const G=JSON.stringify($),Q=JSON.stringify(h.battlePointsAdjustments||{});return G!==Q}return!0}return!1},v=({onClick:c,children:S,variant:L="secondary",isConfirmation:G=!1})=>{const Q=L==="danger"||L==="secondary"&&G,ne=L==="purple";return e.jsx("button",{onClick:c,style:{background:Q?"var(--danger)":ne?"var(--purple)":"var(--bg-secondary)",border:ne?"none":"1px solid var(--border)",color:Q||ne?"white":"var(--text-primary)",padding:"0.375rem 0.75rem",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s",width:"70px",fontSize:"0.875rem"},children:S})},F=ye.useRef(P),R=j.useCallback(c=>!c||c.length===0?null:H.find(L=>{var X,U;if(((X=L.encounterItems)==null?void 0:X.length)!==c.length)return!1;const G=B=>{var oe;return{type:B.type,quantity:B.quantity,item:{name:B.item.baseName||((oe=B.item.name)==null?void 0:oe.replace(/\s+\(\d+\)$/,""))||B.item.name,type:B.item.type,tier:B.item.tier}}},Q=(U=L.encounterItems)==null?void 0:U.map(G).sort((B,oe)=>B.item.name.localeCompare(oe.item.name)||B.item.type.localeCompare(oe.item.type)),ne=c.map(G).sort((B,oe)=>B.item.name.localeCompare(oe.item.name)||B.item.type.localeCompare(oe.item.type));return JSON.stringify(Q)===JSON.stringify(ne)})||null,[H]);ye.useEffect(()=>{if(t&&d.length>0&&q.length===0){const c={};d.forEach(G=>{var ne;const Q=G.baseName||((ne=G.name)==null?void 0:ne.replace(/\s+\(\d+\)$/,""))||G.name;c[Q]||(c[Q]={type:"adversary",item:G,quantity:0}),c[Q].quantity+=1});const S=Object.values(c);ce(S);const L=R(S);L&&!te&&(p(L.id),Y({name:L.name||"",encounterItems:L.encounterItems||[],partySize:L.partySize||4,battlePointsAdjustments:L.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),le(L.name||"Encounter"),w(L.name||"Encounter"))}else t&&d.length===0&&ce([])},[t,R,te,w]);const k=ye.useMemo(()=>{let c=0;q.filter(X=>X.type==="adversary"&&X.item.type==="Solo"&&X.quantity>0).reduce((X,U)=>X+U.quantity,0)>=2&&(c+=Re.twoOrMoreSolos);const L=q.some(X=>X.type==="adversary"&&X.item.type==="Bruiser"&&X.quantity>0),G=q.some(X=>X.type==="adversary"&&X.item.type==="Horde"&&X.quantity>0),Q=q.some(X=>X.type==="adversary"&&X.item.type==="Leader"&&X.quantity>0),ne=q.some(X=>X.type==="adversary"&&X.item.type==="Solo"&&X.quantity>0);return!L&&!G&&!Q&&!ne&&(c+=Re.noBruisersHordesLeadersSolos),c},[q]),C=Ft(P),W=Object.entries($).filter(([c,S])=>S).reduce((c,[S,L])=>c+Re[S],0),s=C+W+k,a=q.reduce((c,S)=>{if(S.type==="adversary"){const L=Ot[S.item.type]||2;return S.item.type==="Minion"?c+Math.ceil(S.quantity/P)*L:c+L*S.quantity}return c},0);ye.useEffect(()=>{const c=F.current;c!==P&&(ce(S=>S.map(L=>{if(L.type==="adversary"&&L.item.type==="Minion"){const Q=Math.ceil(L.quantity/c)*P;return{...L,quantity:Q}}return L})),F.current=P)},[P]);const x=(c,S)=>{const L=q.findIndex(ne=>ne.item.id===c.id&&ne.type===S),G=c.type==="Minion"?P:1;let Q;L>=0?Q=q.map((ne,X)=>X===L?{...ne,quantity:ne.quantity+G}:ne):Q=[...q,{item:c,type:S,quantity:G}],ce(Q),r(Q)},r=c=>{const S=d||[],L=[];c.forEach(U=>{for(let B=0;B<U.quantity;B++)U.type==="adversary"&&L.push(U.item)});const G={};S.forEach(U=>{var oe;const B=U.baseName||((oe=U.name)==null?void 0:oe.replace(/\s+\(\d+\)$/,""))||U.name;G[B]||(G[B]=[]),G[B].push(U)});const Q={};L.forEach(U=>{var oe;const B=U.baseName||((oe=U.name)==null?void 0:oe.replace(/\s+\(\d+\)$/,""))||U.name;Q[B]||(Q[B]=[]),Q[B].push(U)});const ne=[],X=[];Object.keys(Q).forEach(U=>{var ue;const B=((ue=G[U])==null?void 0:ue.length)||0,oe=Q[U].length;if(oe>B){const se=oe-B;for(let xe=0;xe<se;xe++)ne.push(Q[U][0])}else if(oe<B){const se=B-oe,ve=[...G[U]].sort((he,Ke)=>{const Qe=he.duplicateNumber||1;return(Ke.duplicateNumber||1)-Qe});for(let he=0;he<se;he++)X.push(ve[he].id)}}),Object.keys(G).forEach(U=>{Q[U]||[...G[U]].sort((ue,se)=>{const xe=ue.duplicateNumber||1;return(se.duplicateNumber||1)-xe}).forEach(ue=>{X.push(ue.id)})}),X.forEach(U=>{u(U)}),ne.length>0&&g(ne)},m=(c,S)=>{const L=(()=>{const G=q.findIndex(Q=>Q.item.id===c&&Q.type===S);if(G>=0){const Q=q[G];if(Q.quantity===0)return q.filter((U,B)=>B!==G);const ne=Q.item.type==="Minion"?P:1,X=Math.max(0,Q.quantity-ne);return q.map((U,B)=>B===G?{...U,quantity:X}:U)}return q})();ce(L),r(L)},_=j.useCallback(()=>{if(q.length===0)return null;const c=(V||"").trim()||"Encounter",S=H.find(L=>{var ne,X;if(L.name!==c||((ne=L.encounterItems)==null?void 0:ne.length)!==q.length)return!1;const G=JSON.stringify((X=L.encounterItems)==null?void 0:X.sort()),Q=JSON.stringify([...q].sort());return G===Q});return(S==null?void 0:S.id)||null},[H,V,q]),O=j.useCallback(()=>{let c=(V||"").trim(),S=te;if(S||(S=_()),q.length===0&&(!c||c==="Encounter")&&S){T(S),p(null),Y(null);return}const L={name:c,encounterItems:q,partySize:P,battlePointsAdjustments:$};if(S){L.id=S;const G=Z(L);p(G)}else{const G=Z(L);p(G)}Y({name:c,encounterItems:q,partySize:P,battlePointsAdjustments:$})},[q,V,P,$,te,Z,_,T]);j.useEffect(()=>{if(te&&n()){const c=setTimeout(()=>{O()},2e3);return()=>clearTimeout(c)}else if(!te&&q.length>0&&V&&V.trim()!==""){const c=setTimeout(()=>{O()},2e3);return()=>clearTimeout(c)}},[q,te,V,$,P]);const de=()=>{f()&&(ce([]),le("Encounter"),w("Encounter"),p(null),Y(null),d.forEach(c=>{u(c.id)}),E.forEach(c=>{l(c.id)}),z.forEach(c=>{A(c.id)}))},re=c=>{const S=b(c);if(S){const L=S.encounterItems||[];ce(L),I(S.partySize||4),ee(S.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),le(S.name||""),w(S.name||""),p(c),Y({name:S.name||"",encounterItems:S.encounterItems||[],partySize:S.partySize||4,battlePointsAdjustments:S.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),r(L)}},N=c=>{T(c),te===c&&(ce([]),le("Encounter"),w("Encounter"),p(null),Y(null),d.forEach(S=>{u(S.id)}),E.forEach(S=>{l(S.id)}),z.forEach(S=>{A(S.id)}))};return t?e.jsx("div",{onClick:o,className:"encounter-builder-modal",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:1e3,display:"flex",alignItems:"flex-start",justifyContent:"center",padding:"12px"},children:e.jsxs("div",{onClick:c=>c.stopPropagation(),style:{backgroundColor:"var(--bg-primary)",border:"2px solid var(--border)",borderRadius:"12px",width:"100%",maxWidth:"1200px",height:"calc(100vh - 24px)",maxHeight:"800px",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"},children:[e.jsxs("div",{className:"encounter-top-bar",style:{flex:"0 0 auto",display:"flex",alignItems:"center",height:"39px",backgroundColor:"var(--bg-primary)"},children:[e.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center"},children:[e.jsx("button",{onClick:()=>ie("adversaries"),style:{flex:1,background:ae==="adversaries"?"var(--gray-900)":"transparent",border:"none",borderBottom:"1px solid var(--border)",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:ae==="adversaries"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Adversaries"}),e.jsx("button",{onClick:()=>ie("encounters"),style:{flex:1,background:ae==="encounters"?"var(--gray-900)":"transparent",border:"none",borderBottom:"1px solid var(--border)",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:ae==="encounters"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Encounters"}),e.jsx("button",{onClick:()=>ie("custom"),style:{flex:1,background:ae==="custom"?"var(--gray-900)":"transparent",border:"none",borderBottom:"1px solid var(--border)",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:ae==="custom"?"500":"400",transition:"all 0.2s ease",position:"relative"},children:"Custom Adversary"})]}),e.jsx("div",{className:"encounter-receipt-buttons",style:{flex:"0 0 350px",display:"flex",alignItems:"flex-start",justifyContent:"center",borderLeft:"1px solid var(--border)",height:"100%",padding:"1rem 0.75rem"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:V,onChange:c=>{le(c.target.value),w(c.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(v,{onClick:de,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:f()?1:.5,cursor:f()?"pointer":"not-allowed"},children:"New"})]})})]}),e.jsxs("div",{className:"encounter-builder-content",style:{flex:1,display:"flex",overflow:"hidden"},children:[e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",borderTop:"1px solid var(--border)"},children:e.jsx(Pt,{type:"adversary",onAddItem:c=>x(c,"adversary"),encounterItems:q,pcCount:P,showContainer:!1,savedEncounters:H,onLoadEncounter:re,onDeleteEncounter:N,activeTab:ae})}),e.jsxs("div",{className:"encounter-right-panel",style:{flex:"0 0 350px",borderLeft:"1px solid var(--border)",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx("div",{className:"receipt-content",style:{padding:"1rem",display:"flex",flexDirection:"column",height:"100%"},children:e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"flex-start",overflowY:"auto",marginBottom:"0.75rem"},children:[e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>I(Math.max(1,P-1)),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(Le,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:P}),e.jsx("button",{onClick:()=>I(P+1),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(He,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Party Size"})}),e.jsx("div",{style:{width:"120px",textAlign:"right"}})]}),q.map(c=>{var S;return c.type!=="adversary"?null:e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>m(c.item.id,c.type),style:{background:c.quantity===0?"var(--danger)":"var(--bg-secondary)",border:c.quantity===0?"none":"1px solid var(--border)",color:c.quantity===0?"white":"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:c.quantity===0?e.jsx(De,{size:10}):e.jsx(Le,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:c.quantity}),e.jsx("button",{onClick:()=>x(c.item,c.type),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(He,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:c.item.baseName||((S=c.item.name)==null?void 0:S.replace(/\s+\(\d+\)$/,""))||c.item.name})}),e.jsx("div",{style:{width:"80px",textAlign:"right"},children:e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.8rem"},children:c.item.type})})]},`${c.item.id}-${c.type}`)}),e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Balance"})}),e.jsx("div",{style:{width:"120px",textAlign:"right",display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsx("span",{style:{color:a>s?"var(--danger)":a===s?"var(--purple)":"var(--success)",fontWeight:600},children:a>s?`+${a-s}`:s-a===0?"0":`-${s-a}`})})]})]})}),e.jsx("div",{className:"encounter-receipt-buttons-vertical",style:{display:"none",padding:"0.75rem",borderTop:"1px solid var(--border)",backgroundColor:"var(--bg-primary)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:V,onChange:c=>{le(c.target.value),w(c.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",color:"var(--text-primary)",fontSize:"0.875rem"}}),e.jsx(v,{onClick:de,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:f()?1:.5,cursor:f()?"pointer":"not-allowed"},children:"New"})]})})]})]})]})}):null};class qt extends ye.Component{constructor(o){super(o),this.state={hasError:!1,error:null}}static getDerivedStateFromError(o){return{hasError:!0,error:o}}componentDidCatch(o,i){console.error("ErrorBoundary caught an error:",o,i)}render(){var o;return this.state.hasError?e.jsxs("div",{className:"p-md text-red",children:[e.jsx("h3",{children:"Something went wrong:"}),e.jsx("pre",{children:(o=this.state.error)==null?void 0:o.toString()}),e.jsx("button",{className:"btn-base btn-text",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try again"})]}):this.props.children}}const _t=()=>{const{adversaries:t,environments:o,countdowns:i,fear:g,savedEncounters:y,updateFear:u,createAdversary:l,createAdversariesBulk:A,updateAdversary:d,deleteAdversary:E,createEnvironment:z,updateEnvironment:H,deleteEnvironment:Z,createCountdown:b,updateCountdown:T,deleteCountdown:K,advanceCountdown:D,saveEncounter:M,loadEncounter:w,deleteEncounter:P}=Je(),[I,$]=j.useState(!1),[ee,q]=j.useState(!1);j.useState(!1);const[ce,V]=j.useState(!1);j.useState(!0);const[le,ae]=j.useState(null),[ie,te]=j.useState(0),[p,h]=j.useState(0),[Y,n]=j.useState(!1);j.useEffect(()=>{const r=()=>{const _=window.matchMedia("(max-width: 800px)");$(_.matches)};r();const m=window.matchMedia("(max-width: 800px)");return m.addEventListener("change",r),()=>m.removeEventListener("change",r)},[]);const f=12,v=r=>r===1?200:350,F=r=>{if(r<=0)return{visibleColumns:1,columnWidth:v(1)};const m=f*2,_=r-m;let O={visibleColumns:1,columnWidth:_};for(let re=1;re<=5;re++){const N=(re-1)*f,c=(_-N)/re;c>=v(re)&&re*c+N<=_&&(O={visibleColumns:re,columnWidth:c})}return O.visibleColumns*O.columnWidth+(O.visibleColumns-1)*f>_&&(O={visibleColumns:1,columnWidth:_}),O},{visibleColumns:R,columnWidth:k}=F(ie);j.useEffect(()=>{const r=()=>{te(window.innerWidth)};return r(),window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]);const C=()=>{q(!0)},W=j.useCallback(()=>{q(!1)},[]),s=j.useCallback(r=>{h(r.target.scrollLeft)},[]);j.useCallback(()=>{n(!0)},[]),j.useCallback(()=>{setTimeout(()=>n(!1),100)},[]);const x=(()=>{const r={};return t.forEach(m=>{var O;const _=m.baseName||((O=m.name)==null?void 0:O.replace(/\s+\(\d+\)$/,""))||m.name;r[_]||(r[_]={type:"adversary",baseName:_,instances:[]}),r[_].instances.push(m)}),o.forEach(m=>{r[m.name]||(r[m.name]={type:"environment",baseName:m.name,instances:[]}),r[m.name].instances.push(m)}),i.forEach(m=>{r[`countdown-${m.id}`]={type:"countdown",baseName:m.name,instances:[m]}}),Object.values(r)})();return x.length,e.jsxs("div",{className:"app",onClick:r=>{r.target,r.currentTarget},children:[e.jsx(Ct,{adversaries:t,environments:o,countdowns:i,deleteAdversary:E,deleteEnvironment:Z,deleteCountdown:K,isClearMode:ce,setIsClearMode:V,sortAdversaries:()=>{},onOpenDatabase:C}),e.jsx("div",{className:"main-content",style:{position:"relative",width:"100%"},children:e.jsx("div",{className:"dashboard-scroll-container",style:{display:"flex",flexDirection:"row",overflowX:"auto",overflowY:"hidden",padding:`0 ${f}px`,scrollSnapType:"x mandatory",height:"100%",width:"100%"},onScroll:s,children:x.length===0?e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",width:"100%",padding:"2rem"},children:e.jsx("button",{onClick:C,style:{backgroundColor:"transparent",color:"var(--text-secondary)",border:"2px dashed var(--border)",borderRadius:"var(--radius-md)",padding:"1rem 2rem",fontSize:"1rem",fontWeight:"500",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:r=>{r.target.style.borderColor="var(--purple)",r.target.style.color="var(--purple)"},onMouseLeave:r=>{r.target.style.borderColor="var(--border)",r.target.style.color="var(--text-secondary)"},children:"Create Encounter"})}):x.map((r,m)=>e.jsx(Ht,{className:"invisible-scrollbar",style:{width:`${k+f}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:`${f}px`,paddingRight:"0",paddingTop:`${f}px`,paddingBottom:`${f}px`,scrollSnapAlign:"start",overflowY:"auto",overflowX:"hidden"},children:e.jsx(Me,{type:r.type,item:{...r.instances[0],name:r.baseName,hp:0,stress:0,isDead:!1},mode:"expanded",instances:r.instances,onApplyDamage:r.type==="adversary"?(_,O,de,re)=>{const N=r.instances.find(c=>c.id===_);N&&d(_,{hp:Math.min(N.hpMax||1,(N.hp||0)+O)})}:void 0,onApplyHealing:r.type==="adversary"?(_,O,de)=>{const re=r.instances.find(N=>N.id===_);re&&d(_,{hp:Math.max(0,(re.hp||0)-O)})}:void 0,onApplyStressChange:r.type==="adversary"?(_,O)=>{var de,re;return d(_,{stress:Math.max(0,Math.min(((de=r.instances.find(N=>N.id===_))==null?void 0:de.stressMax)||6,(((re=r.instances.find(N=>N.id===_))==null?void 0:re.stress)||0)+O))})}:void 0,onUpdate:r.type==="adversary"?d:r.type==="environment"?H:T,adversaries:t})},`${r.type}-${r.baseName}`))})}),e.jsx(St,{position:"bottom",children:e.jsx(vt,{type:"fear",value:(g==null?void 0:g.value)||0,maxValue:12,onChange:u,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0})}),e.jsx($t,{isOpen:ee,onClose:W,onAddAdversary:r=>{l(r),ae("adversary")},onAddAdversariesBulk:r=>{A(r),ae("adversary")},onAddEnvironment:r=>{z(r),ae("environment")},onDeleteAdversary:E,onDeleteEnvironment:Z,onDeleteCountdown:K,adversaries:t,environments:o,countdowns:i,savedEncounters:y,onSaveEncounter:M,onLoadEncounter:w,onDeleteEncounter:P}),e.jsx(Lt,{})]})},Vt=()=>e.jsx(qt,{children:e.jsx(_t,{})});Te.createRoot(document.getElementById("root")).render(e.jsx(ye.StrictMode,{children:e.jsx(yt,{children:e.jsx(Vt,{})})}));
