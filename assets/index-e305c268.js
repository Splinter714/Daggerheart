import{r as v,a as ye,R as oe}from"./dndkit-57209f9c.js";import{F as Me,f as We,a as ze,b as Ae,c as le}from"./fa-b4bcccb0.js";import{D as re,A as ve,H as Q,X as be,C as Te,M as Le,P as te,a as Be,T as Re,E as He,F as Ne,S as de,b as ce}from"./lucide-af619837.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))h(l);new MutationObserver(l=>{for(const i of l)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&h(o)}).observe(document,{childList:!0,subtree:!0});function p(l){const i={};return l.integrity&&(i.integrity=l.integrity),l.referrerPolicy&&(i.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?i.credentials="include":l.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function h(l){if(l.ep)return;l.ep=!0;const i=p(l);fetch(l.href,i)}})();var je={exports:{}},Z={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Pe=v,Fe=Symbol.for("react.element"),Oe=Symbol.for("react.fragment"),Ve=Object.prototype.hasOwnProperty,$e=Pe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,_e={key:!0,ref:!0,__self:!0,__source:!0};function we(r,t,p){var h,l={},i=null,o=null;p!==void 0&&(i=""+p),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(o=t.ref);for(h in t)Ve.call(t,h)&&!_e.hasOwnProperty(h)&&(l[h]=t[h]);if(r&&r.defaultProps)for(h in t=r.defaultProps,t)l[h]===void 0&&(l[h]=t[h]);return{$$typeof:Fe,type:r,key:i,ref:o,props:l,_owner:$e.current}}Z.Fragment=Oe;Z.jsx=we;Z.jsxs=we;je.exports=Z;var e=je.exports,ne={},pe=ye;ne.createRoot=pe.createRoot,ne.hydrateRoot=pe.hydrateRoot;const ue={fear:{icon:We,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"0.125rem",maxWidth:"none"},pipStyle:{fontSize:"var(--text-lg)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0,imageRendering:"crisp-edges"},filledColor:"var(--purple)",emptyColor:"var(--gray-dark)",tooltipTitle:"Click anywhere in header to adjust fear:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease fear by 1"},{text:"Right of boundary:",description:"Click to increase fear by 1"}]},hp:{icon:ze,maxValue:20,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stress:{icon:Ae,maxValue:12,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},countdown:{icon:le,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust countdown:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease countdown by 1"},{text:"Right of boundary:",description:"Click to increase countdown by 1"}]},hpDots:{maxValue:20,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--red)",borderColor:"var(--red)",boxShadow:"0 0 4px rgba(239, 68, 68, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stressDots:{maxValue:12,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--purple)",borderColor:"var(--purple)",boxShadow:"0 0 4px rgba(139, 92, 246, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},adversaryHP:{icon:re,maxValue:20,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust HP:",tooltipInstructions:[{text:"Filled pip:",description:"Click to heal (reduce damage)"},{text:"Empty pip:",description:"Click to take damage"}]},adversaryStress:{icon:ve,maxValue:12,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust stress:",tooltipInstructions:[{text:"Filled pip:",description:"Click to reduce stress"},{text:"Empty pip:",description:"Click to increase stress"}]},countdownDistributed:{icon:le,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Countdown progress:",tooltipInstructions:[{text:"Progress:",description:"Current countdown value"}]}},K=({type:r="fear",value:t=0,maxValue:p,onChange:h,size:l="lg",showTooltip:i=!0,containerStyle:o={},pipStyle:a={},countdownType:n=null,distributedGroups:d=null,onPipClick:u=null,enableBoundaryClick:s=!1,clickContainerWidth:f="auto",centerPips:x=!0})=>{const[b,k]=v.useState(!1),m=ue[r]||ue.fear,W=p||m.maxValue,C=Math.max(0,Math.min(W,t));let M=m.filledColor;r==="countdown"&&n&&(["progress","dynamic-progress","simple-hope"].includes(n)?M="var(--gold)":["consequence","dynamic-consequence","simple-fear"].includes(n)?M="var(--purple)":["long-term","standard"].includes(n)&&(M="var(--text-secondary)"));const j=(B,R)=>{if(u)u(B,R);else if(h){const V=B+1;h(V)}},I=B=>{if(!s||!h||u)return;B.currentTarget.getBoundingClientRect();const R=B.currentTarget.querySelector(".pip-container");if(!R)return;const V=R.getBoundingClientRect(),P=B.clientX-V.left;if(P<0){C>0&&h(C-1);return}if(P>V.width){C<W&&h(C+1);return}const $=V.width,_=$*.05,A=$-2*_,S=P-_,E=C/W,c=A*E;S<c?C>0&&h(C-1):C<W&&h(C+1)},z=(()=>{if(!d||r!=="countdownDistributed")return[{start:0,end:W,groupIndex:0}];let B=0;return d.map((R,V)=>{const P={start:B,end:B+R,groupIndex:V};return B+=R,P})})(),O=()=>e.jsxs(e.Fragment,{children:[z.map(B=>e.jsx(oe.Fragment,{children:[...Array(B.end-B.start)].map((R,V)=>{const P=B.start+V,$=P<C;if(m.isDots)return e.jsx("div",{style:{...m.pipStyle,...$?m.filledStyle:m.emptyStyle,...a,cursor:h||u?"pointer":"default"},onClick:s?void 0:()=>j(P,$),title:`${P+1} of ${W}`},P);{const _=m.icon,A=_&&typeof _=="object"&&_.iconName,S=$?M:m.emptyColor;return e.jsx("span",{className:`fear-pip ${$?"filled":"empty"}`,style:{...m.pipStyle,color:S,cursor:h||u?"pointer":"default",...a},onClick:s?void 0:()=>j(P,$),title:`${P+1} of ${W}`,children:A?e.jsx(Me,{icon:_,size:l}):e.jsx(_,{size:16})},P)}})},B.groupIndex)),i&&e.jsx("div",{style:{position:"relative",cursor:"help",pointerEvents:"none"},children:e.jsxs("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:b?"translateX(-50%) translateY(-5px)":"translateX(-50%)",background:"rgba(15, 23, 42, 0.95)",border:"1px solid var(--gray)",borderRadius:"var(--radius-md)",padding:"var(--space-md)",minWidth:"250px",zIndex:1e3,opacity:b?1:0,visibility:b?"visible":"hidden",transition:"all 0.2s ease",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.5)"},children:[e.jsx("div",{style:{fontWeight:600,color:"var(--gray-200)",marginBottom:"0.75rem",fontSize:"var(--text-sm)"},children:m.tooltipTitle}),m.tooltipInstructions.map((B,R)=>e.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.8rem",color:"var(--gray-300)",lineHeight:1.4},children:[e.jsx("strong",{style:{color:"var(--gray-200)"},children:B.text})," ",B.description]},R))]})})]});return e.jsx("div",{style:{width:f,height:"100%",cursor:h||u?"pointer":"default",touchAction:"manipulation",userSelect:"none",display:x?"flex":"block",alignItems:x?"center":"stretch",justifyContent:x?"center":"flex-start",...o},onClick:B=>{B.stopPropagation(),B.preventDefault(),s&&I(B)},onMouseEnter:()=>k(i),onMouseLeave:()=>k(!1),children:e.jsx("div",{className:"pip-container",style:{...m.containerStyle,width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},children:O()})})};function ae(r){const t=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return r?`${r}-${t}`:t}const Ye=(r,t)=>({createAdversary:o=>{const a=ae("adv"),n=r().adversaries||[],d=o.name||"Unknown",u=n.filter(x=>x.baseName===d);let s=1;if(u.length===0)s=1;else{const x=u.map(k=>k.duplicateNumber||1);let b=1;for(;x.includes(b);)b++;s=b}const f={...o,id:a,baseName:d,duplicateNumber:s,name:`${d} (${s})`,hp:0,stress:0,isVisible:!0};t(x=>({...x,adversaries:[...x.adversaries,f]}))},updateAdversary:(o,a)=>{t(n=>({...n,adversaries:n.adversaries.map(d=>{if(d.id===o){const u={...d,...a};if(a.baseName!==void 0){const s=a.baseName,f=u.duplicateNumber||1;u.name=f===1?s:`${s} (${f})`}return u}return d})}))},deleteAdversary:o=>{t(a=>({...a,adversaries:a.adversaries.filter(n=>n.id!==o)}))},reorderAdversaries:o=>{t(a=>{const[n,d]=o,u=[...a.adversaries],[s]=u.splice(n,1);return u.splice(d,0,s),{...a,adversaries:u}})}}),qe=r=>({createCountdown:n=>{const d={id:ae("countdown"),name:n.name||"Countdown",max:parseInt(n.max)||1,value:0,visible:!0,type:n.type||"standard",loop:n.loop||"none",source:n.source||"campaign"};r(u=>({...u,countdowns:[...u.countdowns,d]}))},updateCountdown:(n,d)=>{r(u=>({...u,countdowns:u.countdowns.map(s=>s.id===n?{...s,...d}:s)}))},deleteCountdown:n=>{r(d=>({...d,countdowns:d.countdowns.filter(u=>u.id!==n)}))},advanceCountdown:(n,d)=>{r(u=>({...u,countdowns:u.countdowns.map(s=>{if(s.id!==n)return s;let f=d;if(s.loop==="loop")f>s.max?f=(f-1)%s.max+1:f<0&&(f=s.max);else if(s.loop==="increasing"){if(f>s.max)return{...s,max:s.max+1,value:1};if(f<0)return{...s,max:Math.max(1,s.max-1),value:1};f=Math.max(0,f)}else if(s.loop==="decreasing"){if(f>s.max)return{...s,max:Math.max(1,s.max-1),value:1};if(f<0)return{...s,max:s.max+1,value:1};f=Math.min(s.max,f)}else f=Math.max(0,Math.min(f,s.max));return{...s,value:f}})}))},incrementCountdown:(n,d=1)=>{r(u=>({...u,countdowns:u.countdowns.map(s=>{if(s.id!==n)return s;let f=s.value+d;if(s.loop==="loop")f>s.max&&(f=(f-1)%s.max+1);else if(s.loop==="increasing"){if(f>s.max)return{...s,max:s.max+1,value:1}}else if(s.loop==="decreasing"){if(f>s.max)return{...s,max:Math.max(1,s.max-1),value:1}}else f=Math.min(f,s.max);return{...s,value:f}})}))},decrementCountdown:n=>{r(d=>({...d,countdowns:d.countdowns.map(u=>{if(u.id!==n)return u;let s=u.value-1;if(u.loop==="loop")s<0&&(s=u.max);else if(u.loop==="increasing"){if(s<0)return{...u,max:Math.max(1,u.max-1),value:u.max};s=Math.max(0,s)}else if(u.loop==="decreasing"){if(s<0)return{...u,max:u.max+1,value:1}}else s=Math.max(0,s);return{...u,value:s}})}))},reorderCountdowns:n=>{r(d=>{const[u,s]=n,f=[...d.countdowns],[x]=f.splice(u,1);return f.splice(s,0,x),{...d,countdowns:f}})}}),Xe=(r,t)=>({createEnvironment:o=>{const a=ae("env"),d=(r().environments||[]).filter(f=>f.name.replace(/\s+\(\d+\)$/,"")===o.name);let u=o.name||"Unknown";if(d.length===0)u=o.name;else if(d.length===1){const f=d[0],x=f.name.replace(/\s+\(\d+\)$/,""),b=r().environments.map(k=>k.id===f.id?{...k,name:`${x} (1)`}:k);t(k=>({...k,environments:b})),u=`${o.name} (2)`}else{const f=d.map(b=>{const k=b.name.match(/\((\d+)\)$/);return k?parseInt(k[1]):null}).filter(b=>b!==null);let x=1;for(;f.includes(x);)x++;u=`${o.name} (${x})`}const s={...o,id:a,name:u,isVisible:!0};t(f=>({...f,environments:[...f.environments,s]}))},updateEnvironment:(o,a)=>{t(n=>({...n,environments:n.environments.map(d=>d.id===o?{...d,...a}:d)}))},deleteEnvironment:o=>{t(a=>({...a,environments:a.environments.filter(n=>n.id!==o)}))},reorderEnvironments:o=>{t(a=>{const[n,d]=o,u=[...a.environments],[s]=u.splice(n,1);return u.splice(d,0,s),{...a,environments:u}})}});function Ge(r,t){const p=(r==null?void 0:r.type)||"standard";if(p==="standard")return 1;if(p==="progress"||p==="dynamic-progress")switch(t){case"success-hope":return 2;case"success-fear":return 1;case"critical-success":return 3;default:return 0}if(p==="consequence"||p==="dynamic-consequence")switch(t){case"success-fear":return 1;case"failure-hope":return 2;case"failure-fear":return 3;default:return 0}return p==="simple-fear"?t==="simple-fear"||t==="success-fear"||t==="failure-fear"?1:0:p==="simple-hope"&&(t==="simple-hope"||t==="success-hope"||t==="failure-hope"||t==="critical-success")?1:0}function Ke(r){return((r==null?void 0:r.type)||"standard")==="standard"?1:0}function Ue({adversaries:r,updateAdversary:t,deleteAdversary:p,selectedItem:h,setSelectedItem:l}){const i=v.useCallback((n,d,u,s)=>{var W,C;const f=r.find(M=>M.id===n);if(!f)return;const x=f.type==="Minion",b=(W=f.features)==null?void 0:W.find(M=>{var j;return(j=M.name)==null?void 0:j.startsWith("Minion (")}),k=b?parseInt(((C=b.name.match(/\((\d+)\)/))==null?void 0:C[1])||"1"):1;if(x){p(n);const M=Math.floor(d/k);if(M>0){const j=r.filter(I=>I.type==="Minion"&&I.id!==n&&I.name===f.name);for(let I=0;I<Math.min(M,j.length);I++)p(j[I].id)}return}const m=Math.min(u+d,s);h&&h.id===n&&l(M=>({...M,hp:m})),t(n,{hp:m})},[r,t,p,h,l]),o=v.useCallback((n,d,u)=>{const s=Math.max(0,u-d);h&&h.id===n&&l(f=>({...f,hp:s})),t(n,{hp:s})},[t,h,l]),a=v.useCallback((n,d,u,s)=>{const f=r.find(k=>k.id===n);if(!f)return;let x=u+d,b=f.hp||0;if(x>s){const k=x-s;x=s,b=Math.min(f.hpMax||0,b+k)}x=Math.max(0,x),h&&h.id===n&&l(k=>({...k,stress:x,hp:b})),t(n,{stress:x,hp:b})},[r,t,h,l]);return{handleAdversaryDamage:i,handleAdversaryHealing:o,handleAdversaryStressChange:a}}const H={transitions:{hoverIn:"all 0.1s ease",hoverOut:"all 0.3s ease",colorIn:"color 0.1s ease",colorOut:"color 0.3s ease",backgroundIn:"background-color 0.1s ease",backgroundOut:"background-color 0.3s ease"},card:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"12px",cursor:"pointer",transition:"all 0.1s ease",position:"relative"},cardHover:{backgroundColor:"var(--bg-card-hover)"},cardDead:{opacity:.6,backgroundColor:"var(--gray-800)",borderColor:"var(--border)"},cardAtMax:{backgroundColor:"var(--success)",borderColor:"var(--success)"},rowMain:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},rowTitle:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",margin:0},rowMeta:{display:"flex",gap:"8px",alignItems:"center"},cardActions:{display:"flex",justifyContent:"flex-start",alignItems:"center",gap:"12px"},controlButtons:{display:"flex",gap:"8px",alignItems:"center"},pipSymbols:{display:"flex",gap:"4px",alignItems:"center",cursor:"pointer",padding:"2px"},pipSymbol:{fontSize:"16px",transition:"color 0.1s ease"},pipGroup:{display:"flex",gap:"4px",marginBottom:"4px"},badge:{padding:"2px 6px",borderRadius:"3px",fontSize:"10px",fontWeight:"600",textTransform:"uppercase"},typeBadge:{backgroundColor:"var(--purple)",color:"var(--text-primary)"},difficultyBadge:{backgroundColor:"var(--gray-500)",color:"var(--text-primary)",cursor:"pointer",transition:"background-color 0.1s ease"},tierBadge:{backgroundColor:"var(--info)",color:"var(--text-primary)"},inputBase:{padding:"8px",borderColor:"var(--gray-500)",backgroundColor:"var(--gray-900)",color:"var(--text-primary)",fontSize:"14px",transition:"all 0.2s ease"},inputBaseFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 2px rgba(79, 70, 229, 0.1)"},inputBaseDisabled:{opacity:.6,cursor:"not-allowed"},button:{backgroundColor:"var(--danger)",color:"var(--text-primary)",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease"},incrementButton:{backgroundColor:"var(--success)",color:"var(--text-primary)",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease"},decrementButton:{backgroundColor:"var(--warning)",color:"var(--text-primary)",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease"},damageInputPopup:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,borderRadius:"8px"},damageInputContent:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"8px",padding:"8px",display:"flex",flexDirection:"row",gap:"8px",minWidth:"200px",alignItems:"center",position:"absolute",right:"1rem",top:"50%",transform:"translateY(-50%)"},damageInput:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"4px",padding:"4px 6px",color:"var(--text-primary)",fontSize:"12px",width:"80px",textAlign:"center"},damageIndicators:{display:"flex",gap:"8px",alignItems:"center",justifyContent:"center"},damageDrop:{fontSize:"16px",color:"var(--text-secondary)",cursor:"pointer",transition:"color 0.1s ease"},applyButton:{backgroundColor:"var(--gray-600)",color:"white",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"32px",minHeight:"32px"}},Je=(r,t,p,h)=>{const[l,i]=v.useState(!1),[o,a]=v.useState("");v.useEffect(()=>{if(l){const x=b=>{b.target.closest(".damage-input-popup")||(i(!1),a(""))};return document.addEventListener("click",x),()=>document.removeEventListener("click",x)}},[l]);const n=x=>{x.stopPropagation(),x.preventDefault();const b=r.hp||0,k=r.hpMax||1,m=x.currentTarget.getBoundingClientRect(),W=x.clientX-m.left,C=m.width/k;Math.floor(W/C)<b?p&&p(r.id,1,r.hp):t&&t(r.id,1,r.hp,r.hpMax)},d=x=>{x.stopPropagation(),x.preventDefault();const b=r.stress||0,k=r.stressMax||1,m=x.currentTarget.getBoundingClientRect(),W=x.clientX-m.left,C=m.width/k;Math.floor(W/C)<b?h&&h(r.id,-1,r.stress,r.stressMax):h&&h(r.id,1,r.stress,r.stressMax)},u=x=>{x.stopPropagation(),(r.thresholds&&r.thresholds.major&&r.thresholds.severe||r.type==="Minion")&&(i(!0),a(r.type==="Minion"?"1":""))},s=()=>{const x=parseInt(o);if(x>0){if(r.type==="Minion")t&&t(r.id,x,r.hp,r.hpMax);else{let b=0;x>=r.thresholds.severe?b=3:x>=r.thresholds.major?b=2:x>=1&&(b=1),t&&t(r.id,b,r.hp,r.hpMax)}i(!1),a("")}};return{showDamageInput:l,damageValue:o,setDamageValue:a,setShowDamageInput:i,handleHpClick:n,handleStressClick:d,handleDifficultyClick:u,applyDamage:s,handleKeyDown:x=>{x.key==="Enter"?s():x.key==="Escape"&&(i(!1),a(""))}}},Qe=(r,t,p)=>({renderDistributedPips:()=>{const l=r.max,i=[];for(let o=0;o<l;o+=5){const a=Math.min(5,l-o);i.push(a)}return i.map((o,a)=>e.jsx("div",{style:H.pipGroup,children:Array.from({length:o},(n,d)=>{const u=a*5+d;return e.jsx("span",{style:{...H.pipSymbol,color:u<(r.value||0)?"var(--red)":"var(--text-secondary)"},title:`${u+1} of ${r.max}`,children:u<(r.value||0)?"●":"○"},u)})},a))}}),U=({item:r,type:t,mode:p="compact",onClick:h,onDelete:l,onApplyDamage:i,onApplyHealing:o,onApplyStressChange:a,onUpdate:n,onIncrement:d,onDecrement:u,dragAttributes:s,dragListeners:f,adversaries:x=[],isSelected:b=!1,isEditMode:k=!1})=>{const m=Je(r,i,o,a),W=Qe(r);(t==="adversary"||t==="adversaries")&&m.handleDifficultyClick;const[C,M]=v.useState(!1),j=()=>{M(!0)},I=()=>{M(!1)},T=(c=!1)=>{let g={...H.card};if(b?g.transition="none":g.transition=C?H.transitions.hoverIn:H.transitions.hoverOut,c){const{marginTop:y,...w}=g;g=w}return(C&&p!=="expanded"||b)&&(g={...g,...H.cardHover}),t==="adversary"&&(r.hp||0)>=(r.hpMax||1)&&(g={...g,...H.cardDead}),t==="countdown"&&(r.value||0)>=r.max&&(g={...g,...H.cardAtMax}),g},z=()=>{let c="border rounded-lg";return(C&&p!=="expanded"||b)&&(c+=" border-hover"),c},O=()=>{var c,g;if(t==="adversary"||t==="adversaries"){const y=r.baseName||((c=r.name)==null?void 0:c.replace(/\s+\(\d+\)$/,""))||"",w=r.duplicateNumber||((g=r.name)!=null&&g.match(/\((\d+)\)$/)?parseInt(r.name.match(/\((\d+)\)$/)[1]):1),D=[...x];return x.some(q=>q.id===r.id)||D.push(r),D.filter(q=>q.baseName===y).length>1?`${y} (${w})`:y}return r.name},B=()=>{const c=[];return r.type&&c.push(e.jsx("span",{style:{...H.badge,...H.typeBadge},children:r.type},"type")),t==="environment"&&r.tier&&c.push(e.jsxs("span",{style:{...H.badge,...H.tierBadge},children:["Tier ",r.tier]},"tier")),c},R=()=>e.jsxs("div",{style:H.cardActions,children:[e.jsxs("div",{style:H.controlButtons,children:[e.jsx("div",{style:{display:"flex",alignItems:"center"},children:e.jsx("div",{style:{display:"flex",gap:"0.25rem",alignItems:"center",cursor:"pointer",padding:"0.125rem",borderRadius:"0.5rem",transition:"all 0.2s ease"},onClick:t==="adversary"||t==="adversaries"?m.handleHpClick:void 0,onMouseEnter:c=>c.target.style.background="var(--gray-800)",onMouseLeave:c=>c.target.style.background="transparent",children:Array.from({length:r.hpMax||1},(c,g)=>e.jsx("span",{style:{fontSize:"1rem",transition:"color 0.1s ease",cursor:"pointer",color:g<(r.hp||0)?"var(--red)":"var(--text-secondary)"},title:g<(r.hp||0)?"Click to heal (reduce damage)":"Click to take damage",children:e.jsx(re,{size:16})},g))})}),r.stressMax>0&&e.jsx("div",{style:{display:"flex",alignItems:"center"},children:e.jsx("div",{style:{display:"flex",gap:"0.25rem",alignItems:"center",cursor:"pointer",padding:"0.125rem",borderRadius:"0.5rem",transition:"all 0.2s ease"},onClick:t==="adversary"||t==="adversaries"?m.handleStressClick:void 0,onMouseEnter:c=>c.target.style.background="var(--gray-800)",onMouseLeave:c=>c.target.style.background="transparent",children:Array.from({length:r.stressMax},(c,g)=>e.jsx("span",{style:{fontSize:"1rem",transition:"color 0.1s ease",cursor:"pointer",color:g<(r.stress||0)?"var(--gold)":"var(--text-secondary)"},title:g<(r.stress||0)?"Click to reduce stress":"Click to increase stress",children:e.jsx(ve,{size:16})},g))})}),r.difficulty&&e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:e.jsx("div",{onClick:t==="adversary"||t==="adversaries"?m.handleDifficultyClick:void 0,style:{cursor:r.thresholds&&r.thresholds.major&&r.thresholds.severe||r.type==="Minion"?"pointer":"default"},title:r.thresholds&&r.thresholds.major&&r.thresholds.severe?`Click to enter damage (thresholds: ${r.thresholds.major}/${r.thresholds.severe})`:r.type==="Minion"?"Click to enter damage (minion mechanics)":"",children:e.jsx("div",{className:"border rounded-sm",style:{display:"flex",alignItems:"center",gap:"0.25rem",background:"var(--gray-900)",borderColor:"var(--border)",padding:"0.25rem 0.5rem",transition:"all 0.2s ease"},onMouseEnter:c=>c.target.style.background="var(--gray-800)",onMouseLeave:c=>c.target.style.background="var(--gray-900)",children:e.jsx("span",{style:{fontSize:"0.875rem",fontWeight:600,color:"var(--text-primary)"},children:r.difficulty})})})})]}),e.jsx("div",{style:{display:"flex",alignItems:"center"},children:!1})]}),V=()=>null,P=()=>e.jsxs(e.Fragment,{children:[e.jsx("button",{style:H.decrementButton,onClick:c=>{c.stopPropagation(),c.preventDefault(),u&&u(r.id)},title:"Decrease progress",children:e.jsx(Le,{size:16})}),e.jsx("button",{style:H.incrementButton,onClick:c=>{c.stopPropagation(),c.preventDefault(),d&&d(r.id)},title:r.value>=r.max?r.loop&&r.loop!=="none"?"Loop countdown":"Countdown at max":"Increase progress",children:r.value>=r.max?r.loop&&r.loop!=="none"?"⟳":e.jsx(te,{size:16}):e.jsx(te,{size:16})})]}),$=()=>{switch(t){case"adversary":return R();case"environment":return V();case"countdown":return P();default:return null}},_=()=>t==="countdown"?e.jsx("div",{style:H.pipSymbols,children:t==="countdown"?W.renderDistributedPips():null}):null,A=()=>t!=="adversary"||!m.showDamageInput||!(r.thresholds&&r.thresholds.major&&r.thresholds.severe||r.type==="Minion")?null:e.jsx("div",{className:"damage-input-popup",style:H.damageInputPopup,onClick:c=>{c.stopPropagation(),c.target===c.currentTarget&&(t==="adversary"||t==="adversaries")&&(m.setShowDamageInput(!1),m.setDamageValue(""))},children:e.jsxs("div",{className:"border rounded-lg",style:{...H.damageInputContent,borderColor:"var(--border)"},onClick:c=>c.stopPropagation(),children:[e.jsx("input",{type:"number",inputMode:"numeric",enterKeyHint:"done",placeholder:"dmg",min:(r.type==="Minion","0"),value:t==="adversary"||t==="adversaries"?m.damageValue:"",onChange:c=>{(t==="adversary"||t==="adversaries")&&m.setDamageValue(c.target.value)},onKeyDown:t==="adversary"||t==="adversaries"?m.handleKeyDown:void 0,className:"border rounded-sm",style:{...H.damageInput,borderColor:"var(--border)"},autoFocus:!0}),e.jsxs("div",{style:H.damageIndicators,children:[r.type==="Minion"?(()=>{var D,L;const c=parseInt(t==="adversary"||t==="adversaries"?m.damageValue:"0")||0,g=(D=r.features)==null?void 0:D.find(X=>{var q;return(q=X.name)==null?void 0:q.startsWith("Minion (")}),y=g?parseInt(((L=g.name.match(/\((\d+)\)/))==null?void 0:L[1])||"1"):1,w=Math.floor(c/y);return c>=y&&w>0?e.jsxs("span",{style:{...H.damageDrop,color:"var(--red)"},title:`${c} damage can defeat ${w+1} minion${w+1!==1?"s":""} (1 + ${w} additional)`,children:["+",w," additional minion(s)"]}):e.jsx("span",{style:H.damageDrop,title:`${c} damage defeats this minion only`,children:"+0 additional minion(s)"})})():[1,2,3].map(c=>{const g=parseInt(t==="adversary"||t==="adversaries"?m.damageValue:"0")||0;let y=!1;return c===1&&g>=1&&(y=!0),c===2&&g>=r.thresholds.major&&(y=!0),c===3&&g>=r.thresholds.severe&&(y=!0),e.jsx("span",{style:{...H.damageDrop,color:y?"var(--red)":"var(--text-secondary)"},onClick:w=>{w.stopPropagation(),(t==="adversary"||t==="adversaries")&&(c===1?m.setDamageValue("1"):c===2?m.setDamageValue(r.thresholds.major.toString()):c===3&&m.setDamageValue(r.thresholds.severe.toString()))},title:`Click to set damage to ${c===1?"1":c===2?r.thresholds.major:r.thresholds.severe}`,children:e.jsx(re,{size:16})},c)}),e.jsx("button",{style:{...H.applyButton,backgroundColor:"var(--gray-600)"},onClick:c=>{c.stopPropagation(),(t==="adversary"||t==="adversaries")&&(!m.damageValue||parseInt(m.damageValue)<1?(m.setShowDamageInput(!1),m.setDamageValue("")):m.applyDamage())},title:!m.damageValue||parseInt(m.damageValue)<1?"Close damage input":"Apply damage",children:!m.damageValue||parseInt(m.damageValue)<1?e.jsx(be,{size:16}):e.jsx(Te,{size:16})})]})]})}),S=()=>{const g=(r.hp||0)>=(r.hpMax||1),y=p==="edit";return e.jsxs("div",{className:z(),style:{...T(!0),padding:0,minHeight:"400px",opacity:g?.7:1,backgroundColor:g?"var(--gray-900)":T(!0).backgroundColor,borderColor:g?"color-mix(in srgb, var(--gray-600) 40%, transparent)":b?"var(--purple)":C&&p!=="expanded"?"var(--border-hover)":"var(--border)",borderWidth:"2px",display:"flex",flexDirection:"column",position:"relative"},...s,...f,onClick:h,...p!=="expanded"&&{onMouseEnter:j,onMouseLeave:I},children:[g&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                45deg,
                transparent,
                transparent 8px,
                var(--gray-600) 1px,
                var(--gray-600) 9px
              )`,pointerEvents:"none",zIndex:9999}}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"var(--text-secondary)",fontSize:"1rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em",zIndex:1e4,pointerEvents:"none",textShadow:"1px 1px 2px rgba(0, 0, 0, 0.5)",backgroundColor:"var(--gray-900)",padding:"0.25rem 0.5rem",borderRadius:"0.5rem",border:"0.5px solid var(--gray-600)"},children:"DEFEATED"})]}),e.jsx("div",{className:"border-b",style:{padding:"12px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative",zIndex:g?1:"auto",borderBottomColor:b?"var(--purple)":"var(--border)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",position:"relative",zIndex:g?1:"auto"},children:[e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.25rem",flex:"1 1 0%",minWidth:0},children:e.jsx("h4",{style:{...H.rowTitle,color:g?"color-mix(in srgb, var(--gray-400) 80%, transparent)":H.rowTitle.color},children:O()})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flex:"0 0 auto",minWidth:"fit-content"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.125rem",alignItems:"flex-end"},children:[e.jsx(K,{type:"adversaryHP",value:r.hp||0,maxValue:r.hpMax||1,onChange:w=>{const D=r.hp||0;w>D?i&&i(r.id,w-D,r.hp,r.hpMax):w<D&&o&&o(r.id,D-w,r.hp)},containerStyle:{cursor:"pointer",padding:"0.0625rem",borderRadius:"0.125rem",transition:"all 0.2s ease"},pipStyle:{fontSize:"0.75rem"},showTooltip:!1,enableBoundaryClick:!0}),r.stressMax>0&&e.jsx(K,{type:"adversaryStress",value:r.stress||0,maxValue:r.stressMax,onChange:w=>{const D=r.stress||0,L=w-D;a&&a(r.id,L,r.stress)},containerStyle:{cursor:"pointer",padding:"0.0625rem",borderRadius:"0.125rem",transition:"all 0.2s ease"},pipStyle:{fontSize:"0.75rem"},showTooltip:!1,enableBoundaryClick:!0})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem"},children:[r.type&&e.jsx("span",{style:{fontSize:"0.625rem",fontWeight:500,color:g?"color-mix(in srgb, var(--gray-400) 80%, transparent)":"var(--text-secondary)",letterSpacing:"0.5px",textAlign:"center",lineHeight:1},children:r.type}),r.difficulty&&e.jsxs("div",{onClick:m.handleDifficultyClick,style:{cursor:r.thresholds&&r.thresholds.major&&r.thresholds.severe||r.type==="Minion"?"pointer":"default",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},title:r.thresholds&&r.thresholds.major&&r.thresholds.severe?`Click to enter damage (thresholds: ${r.thresholds.major}/${r.thresholds.severe})`:r.type==="Minion"?"Click to enter damage (minion mechanics)":"",children:[e.jsx(Q,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(30deg)"}}),e.jsx("span",{style:{position:"absolute",fontSize:"0.75rem",fontWeight:600,color:"white",pointerEvents:"none"},children:r.difficulty})]})]}),!1]})]})}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"12px",borderRadius:"0 0 8px 8px",position:"relative",zIndex:g?1:"auto"},children:[(r.tier||r.type)&&e.jsx("div",{style:{marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--border)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[r.tier&&e.jsxs("span",{style:{fontSize:"0.875rem",fontWeight:500,color:g?"color-mix(in srgb, var(--gray-400) 80%, transparent)":"var(--text-secondary)",letterSpacing:"0.5px",padding:"0.25rem 0.5rem",backgroundColor:"var(--gray-800)",borderRadius:"0.25rem",border:"1px solid var(--border)"},children:["Tier ",r.tier]}),r.type&&e.jsx("span",{style:{fontSize:"0.875rem",fontWeight:500,color:g?"color-mix(in srgb, var(--gray-400) 80%, transparent)":"var(--text-secondary)",letterSpacing:"0.5px",padding:"0.25rem 0.5rem",backgroundColor:"var(--gray-800)",borderRadius:"0.25rem",border:"1px solid var(--border)"},children:r.type})]})}),r.description&&e.jsxs("div",{style:{marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--border)"},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:"0 0 0.5rem 0"},children:"Description"}),y?e.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-secondary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"vertical",fontFamily:"inherit"},value:r.description,onChange:w=>{n&&n(r.id,{description:w.target.value})},placeholder:"Enter adversary description..."}):e.jsx("p",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",margin:0,whiteSpace:"pre-wrap"},children:r.description})]}),r.motives&&e.jsxs("div",{style:{marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--border)"},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:"0 0 0.5rem 0"},children:"Motives"}),y?e.jsx("textarea",{style:{width:"100%",minHeight:"80px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-secondary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"vertical",fontFamily:"inherit"},value:r.motives,onChange:w=>{n&&n(r.id,{motives:w.target.value})},placeholder:"Enter adversary motives..."}):e.jsx("p",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",margin:0,whiteSpace:"pre-wrap"},children:r.motives})]}),e.jsx("div",{style:{marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--border)"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",fontSize:"0.875rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[e.jsxs("span",{children:[e.jsx("strong",{children:"Difficulty:"})," ",r.difficulty]}),r.thresholds&&e.jsxs("span",{children:[e.jsx("strong",{children:"Thresholds:"})," ",r.thresholds.major,"/",r.thresholds.severe]}),e.jsxs("span",{children:[e.jsx("strong",{children:"HP:"})," ",r.hpMax]}),r.stressMax>0&&e.jsxs("span",{children:[e.jsx("strong",{children:"Stress:"})," ",r.stressMax]})]}),(r.atk!==void 0||r.weapon||r.damage)&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[r.atk!==void 0&&e.jsxs("span",{children:[e.jsx("strong",{children:"ATK:"})," ",r.atk>=0?"+":"",r.atk]}),r.weapon&&e.jsxs("span",{children:[e.jsxs("strong",{children:[r.weapon,":"]})," ",r.range||"Melee"]}),r.damage&&e.jsxs("span",{children:[e.jsx("strong",{children:"Damage:"})," ",r.damage]})]}),r.experience&&r.experience.length>0&&e.jsxs("div",{children:[e.jsx("strong",{children:"Experience:"})," ",r.experience.map(w=>typeof w=="string"?w:`${w.name} ${w.modifier>=0?"+":""}${w.modifier}`).join(", ")]})]})}),r.features&&r.features.length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[r.features.filter(w=>w.type==="Passive").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Passives"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:r.features.filter(w=>w.type==="Passive").map((w,D)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:w.name}),w.description&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:" - "}),e.jsx("span",{children:w.description})]})]},D))})]}),r.features.filter(w=>w.type==="Action").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Actions"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:r.features.filter(w=>w.type==="Action").map((w,D)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:w.name}),w.description&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:" - "}),e.jsx("span",{children:w.description})]})]},D))})]}),r.features.filter(w=>w.type==="Reaction").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Reactions"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:r.features.filter(w=>w.type==="Reaction").map((w,D)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:w.name}),w.description&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:" - "}),e.jsx("span",{children:w.description})]})]},D))})]})]})]}),A()]})},E=()=>{const g=p==="edit";return e.jsxs("div",{className:z(),style:{...T(!0),padding:0,minHeight:"400px",display:"flex",flexDirection:"column",position:"relative"},...s,...f,onClick:h,...p!=="expanded"&&{onMouseEnter:j,onMouseLeave:I},children:[e.jsx("div",{className:"border-b",style:{padding:"12px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.25rem"},children:[e.jsx("h2",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:0},children:r.name}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[r.tier&&e.jsxs("span",{style:{fontSize:"0.75rem",fontWeight:500,color:"var(--text-secondary)",letterSpacing:"0.5px"},children:["Tier ",r.tier]}),r.type&&e.jsx("span",{style:{fontSize:"0.75rem",fontWeight:500,color:"var(--text-secondary)",letterSpacing:"0.5px"},children:r.type})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[r.difficulty&&e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[e.jsx(Q,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)"}}),e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",fontWeight:700,color:"white",pointerEvents:"none"},children:r.difficulty})]}),!1]})]})}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"12px",borderRadius:"0 0 8px 8px"},children:[r.description&&e.jsxs("div",{style:{marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--border)"},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:"0 0 0.5rem 0"},children:"Description"}),g?e.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-secondary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"vertical",fontFamily:"inherit"},value:r.description,onChange:y=>{n&&n(r.id,{description:y.target.value})},placeholder:"Enter environment description..."}):e.jsx("p",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",margin:0,whiteSpace:"pre-wrap"},children:r.description})]}),r.impulses&&e.jsxs("div",{style:{marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--border)"},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:"0 0 0.5rem 0"},children:"Impulses"}),e.jsx("p",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",margin:0,whiteSpace:"pre-wrap"},children:r.impulses})]}),e.jsxs("div",{style:{marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--border)"},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:"0 0 0.5rem 0"},children:"Core Stats"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",fontSize:"0.875rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[e.jsxs("span",{children:[e.jsx("strong",{children:"Difficulty:"})," ",r.difficulty||"~"]}),e.jsxs("span",{children:[e.jsx("strong",{children:"Type:"})," ",r.type]}),e.jsxs("span",{children:[e.jsx("strong",{children:"Tier:"})," ",r.tier]})]}),r.potentialAdversaries&&r.potentialAdversaries.length>0&&e.jsxs("div",{children:[e.jsx("strong",{children:"Potential Adversaries:"}),e.jsx("div",{style:{marginTop:"0.25rem",display:"flex",flexDirection:"column",gap:"0.125rem"},children:r.potentialAdversaries.map((y,w)=>e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",marginLeft:"0.5rem"},children:["• ",y]},w))})]})]})]}),r.features&&r.features.length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[r.features.filter(y=>y.type==="Passive").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Passives"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:r.features.filter(y=>y.type==="Passive").map((y,w)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("div",{style:{fontWeight:600,color:"white",marginBottom:"0.25rem"},children:y.name}),e.jsx("div",{style:{marginBottom:"0.25rem"},children:y.description}),y.details&&y.details.length>0&&e.jsxs("div",{style:{marginLeft:"0.5rem"},children:[e.jsx("strong",{children:"Details:"}),e.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:y.details.map((D,L)=>e.jsx("li",{children:D},L))})]}),y.prompts&&y.prompts.length>0&&e.jsxs("div",{style:{marginLeft:"0.5rem"},children:[e.jsx("strong",{children:"Prompts:"}),e.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:y.prompts.map((D,L)=>e.jsxs("li",{style:{fontStyle:"italic"},children:['"',D,'"']},L))})]})]},w))})]}),r.features.filter(y=>y.type==="Action").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Actions"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:r.features.filter(y=>y.type==="Action").map((y,w)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("div",{style:{fontWeight:600,color:"white",marginBottom:"0.25rem"},children:y.name}),e.jsx("div",{style:{marginBottom:"0.25rem"},children:y.description}),y.details&&y.details.length>0&&e.jsxs("div",{style:{marginLeft:"0.5rem"},children:[e.jsx("strong",{children:"Details:"}),e.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:y.details.map((D,L)=>e.jsx("li",{children:D},L))})]}),y.prompts&&y.prompts.length>0&&e.jsxs("div",{style:{marginLeft:"0.5rem"},children:[e.jsx("strong",{children:"Prompts:"}),e.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:y.prompts.map((D,L)=>e.jsxs("li",{style:{fontStyle:"italic"},children:['"',D,'"']},L))})]})]},w))})]}),r.features.filter(y=>y.type==="Reaction").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Reactions"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:r.features.filter(y=>y.type==="Reaction").map((y,w)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("div",{style:{fontWeight:600,color:"white",marginBottom:"0.25rem"},children:y.name}),e.jsx("div",{style:{marginBottom:"0.25rem"},children:y.description}),y.details&&y.details.length>0&&e.jsxs("div",{style:{marginLeft:"0.5rem"},children:[e.jsx("strong",{children:"Details:"}),e.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:y.details.map((D,L)=>e.jsx("li",{children:D},L))})]}),y.prompts&&y.prompts.length>0&&e.jsxs("div",{style:{marginLeft:"0.5rem"},children:[e.jsx("strong",{children:"Prompts:"}),e.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:y.prompts.map((D,L)=>e.jsxs("li",{style:{fontStyle:"italic"},children:['"',D,'"']},L))})]})]},w))})]})]})]})]})};if((p==="expanded"||p==="edit")&&(t==="adversary"||t==="adversaries"))return S();if((p==="expanded"||p==="edit")&&(t==="environment"||t==="environments"))return E();if(p!=="compact"&&!(t==="adversary"||t==="adversaries"||t==="environment"||t==="environments"))return e.jsxs("div",{className:z(),style:T(!0),children:[e.jsxs("div",{style:H.rowMain,children:[e.jsx("h4",{style:H.rowTitle,children:O()}),e.jsx("div",{style:H.rowMeta,children:B()})]}),e.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"12px",margin:0},children:["Expanded view coming soon for ",t]})]});if(t==="adversary"||t==="adversaries"){const g=(r.hp||0)>=(r.hpMax||1);return e.jsxs("div",{className:z(),style:{...T(),opacity:g?.7:1,backgroundColor:g?"var(--gray-900)":T().backgroundColor,borderColor:g?"color-mix(in srgb, var(--gray-600) 40%, transparent)":b?"var(--purple)":C&&p!=="expanded"?"var(--border-hover)":"var(--border)",paddingLeft:"0.75rem",position:"relative"},onClick:h,...p!=="expanded"&&{onMouseEnter:j,onMouseLeave:I},...s,...f,children:[g&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                45deg,
                transparent,
                transparent 8px,
                var(--gray-600) 1px,
                var(--gray-600) 9px
              )`,pointerEvents:"none",zIndex:9999}}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"var(--text-secondary)",fontSize:"1rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em",zIndex:1e4,pointerEvents:"none",textShadow:"1px 1px 2px rgba(0, 0, 0, 0.5)",backgroundColor:"var(--gray-900)",padding:"0.25rem 0.5rem",borderRadius:"0.5rem",border:"0.5px solid var(--gray-600)"},children:"DEFEATED"})]}),!1,e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",position:"relative",zIndex:g?1:"auto"},children:[e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.25rem",flex:"1 1 0%",minWidth:0},children:e.jsx("h4",{style:{...H.rowTitle,color:g?"color-mix(in srgb, var(--gray-400) 80%, transparent)":H.rowTitle.color},children:O()})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flex:"0 0 auto",minWidth:"200px",justifyContent:"flex-end"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.125rem",alignItems:"flex-end"},children:[e.jsx(K,{type:"adversaryHP",value:r.hp||0,maxValue:r.hpMax||1,onChange:y=>{const w=r.hp||0;y>w?i&&i(r.id,y-w,r.hp,r.hpMax):y<w&&o&&o(r.id,w-y,r.hp)},containerStyle:{cursor:"pointer",padding:"0.0625rem",borderRadius:"0.125rem",transition:"all 0.2s ease"},pipStyle:{fontSize:"0.75rem"},showTooltip:!1,enableBoundaryClick:!0}),r.stressMax>0&&e.jsx(K,{type:"adversaryStress",value:r.stress||0,maxValue:r.stressMax,onChange:y=>{const w=r.stress||0,D=y-w;a&&a(r.id,D,r.stress)},containerStyle:{cursor:"pointer",padding:"0.0625rem",borderRadius:"0.125rem",transition:"all 0.2s ease"},pipStyle:{fontSize:"0.75rem"},showTooltip:!1,enableBoundaryClick:!0})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem"},children:[r.type&&e.jsx("span",{style:{fontSize:"0.625rem",fontWeight:500,color:g?"color-mix(in srgb, var(--gray-400) 80%, transparent)":"var(--text-secondary)",letterSpacing:"0.5px",textAlign:"center",lineHeight:1},children:r.type}),r.difficulty&&e.jsxs("div",{onClick:m.handleDifficultyClick,style:{cursor:r.thresholds&&r.thresholds.major&&r.thresholds.severe||r.type==="Minion"?"pointer":"default",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},title:r.thresholds&&r.thresholds.major&&r.thresholds.severe?`Click to enter damage (thresholds: ${r.thresholds.major}/${r.thresholds.severe})`:r.type==="Minion"?"Click to enter damage (minion mechanics)":"",children:[e.jsx(Q,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(30deg)"}}),e.jsx("span",{style:{position:"absolute",fontSize:"0.75rem",fontWeight:600,color:"white",pointerEvents:"none"},children:r.difficulty})]})]}),console.log("Delete button check:",{onDelete:!!l,isEditMode:k,shouldShow:l&&k}),l&&k&&e.jsx("button",{className:"border rounded-sm",style:{background:"var(--red)",borderColor:"var(--red)",padding:"0.25rem",minWidth:"1.5rem",height:"1.5rem",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.1s ease",color:"white",fontSize:"1rem"},onClick:y=>{y.stopPropagation(),y.preventDefault(),l&&l(r.id)},onMouseEnter:y=>y.target.style.background="var(--red-dark)",onMouseLeave:y=>y.target.style.background="var(--red)",title:"Delete item",children:"×"})]})]}),A()]})}return t==="environment"||t==="environments"?e.jsxs("div",{className:z(),style:{...T(),paddingLeft:"0.75rem",position:"relative"},onClick:h,...p!=="expanded"&&{onMouseEnter:j,onMouseLeave:I},...s,...f,children:[!1,e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"0.5rem",position:"relative"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.25rem"},children:[e.jsx("h4",{style:H.rowTitle,children:O()}),r.type&&e.jsx("span",{style:{fontSize:"0.75rem",fontWeight:500,color:"var(--text-secondary)",letterSpacing:"0.5px"},children:r.type})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[r.difficulty&&e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[e.jsx(Q,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)"}}),e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",fontWeight:700,color:"white",pointerEvents:"none"},children:r.difficulty})]}),r.type&&e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.125rem"},children:e.jsx("span",{style:{fontSize:"0.625rem",fontWeight:500,color:isDead?"color-mix(in srgb, var(--gray-400) 80%, transparent)":"var(--text-secondary)",letterSpacing:"0.5px",textAlign:"center",lineHeight:1},children:r.type})}),console.log("Delete button check:",{onDelete:!!l,isEditMode:k,shouldShow:l&&k}),l&&k&&e.jsx("button",{className:"border rounded-sm",style:{background:"var(--red)",borderColor:"var(--red)",padding:"0.25rem",minWidth:"1.5rem",height:"1.5rem",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.1s ease",color:"white",fontSize:"1rem"},onClick:g=>{g.stopPropagation(),g.preventDefault(),l&&l(r.id)},onMouseEnter:g=>g.target.style.background="var(--red-dark)",onMouseLeave:g=>g.target.style.background="var(--red)",title:"Delete environment",children:"×"})]})]})]}):e.jsxs("div",{className:z(),style:T(),onClick:h,onMouseEnter:()=>M(!0),onMouseLeave:()=>M(!1),...s,...f,children:[e.jsxs("div",{style:H.rowMain,children:[e.jsx("h4",{style:H.rowTitle,children:O()}),e.jsx("div",{style:H.rowMeta,children:B()})]}),_(),e.jsxs("div",{style:H.cardActions,children:[e.jsx("div",{style:H.controlButtons,children:$()}),e.jsx("div",{style:{display:"flex",alignItems:"center"},children:!1})]}),A()]})},Ce=v.createContext();function se(r){if(typeof localStorage>"u")return null;try{const t=localStorage.getItem(r);return t==null?null:JSON.parse(t)}catch{return null}}function Se(r,t){if(!(typeof localStorage>"u"))try{localStorage.setItem(r,JSON.stringify(t))}catch{}}const ke=({children:r})=>{const[t,p]=v.useState({fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[]});v.useEffect(()=>{var V,P,$;const R=se("daggerheart-game-state");if(R)try{(((V=R.adversaries)==null?void 0:V.length)>0||((P=R.environments)==null?void 0:P.length)>0||(($=R.countdowns)==null?void 0:$.length)>0)&&p(R)}catch(_){console.error("Failed to load saved state:",_)}},[]),v.useEffect(()=>{Se("daggerheart-game-state",t)},[t]);const h=R=>{p(V=>({...V,fear:{...V.fear,value:R}}))},l=()=>{p(R=>({...R,fear:{...R.fear,visible:!R.fear.visible}}))},i=v.useRef(t);v.useEffect(()=>{i.current=t},[t]);const o=()=>i.current,a=qe(p),n=Ye(o,p),d=Xe(o,p),{createCountdown:u,updateCountdown:s,deleteCountdown:f,advanceCountdown:x,incrementCountdown:b,decrementCountdown:k,reorderCountdowns:m}=a,{createAdversary:W,updateAdversary:C,deleteAdversary:M,reorderAdversaries:j}=n,{createEnvironment:I,updateEnvironment:T,deleteEnvironment:z,reorderEnvironments:O}=d,B={gameState:t,updateFear:h,toggleFearVisibility:l,createCountdown:u,updateCountdown:s,deleteCountdown:f,advanceCountdown:x,incrementCountdown:b,decrementCountdown:k,reorderCountdowns:m,createAdversary:W,updateAdversary:C,deleteAdversary:M,reorderAdversaries:j,createEnvironment:I,updateEnvironment:T,deleteEnvironment:z,reorderEnvironments:O};return e.jsx(Ce.Provider,{value:B,children:r})},Ee=()=>{const r=v.useContext(Ce);if(!r)return console.warn("useGameState: Context not available yet, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],updateFear:()=>{},toggleFearVisibility:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{gameState:t,...p}=r;if(!t)return console.warn("useGameState: gameState not available, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],updateFear:()=>{},toggleFearVisibility:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{fear:h,countdowns:l,adversaries:i,environments:o}=t;return{gameState:t,fear:h,countdowns:l,adversaries:i,environments:o,...p,hasCountdowns:l.length>0,hasAdversaries:i.length>0,hasEnvironments:o.length>0,getCountdownById:a=>l.find(n=>n.id===a),getAdversaryById:a=>i.find(n=>n.id===a),getEnvironmentById:a=>o.find(n=>n.id===a)}},Ze=(r,t)=>{const[p,h]=v.useState(()=>{const l=se(r);return l??t});return v.useEffect(()=>{const l=se(r);h(l??t)},[r]),v.useEffect(()=>{Se(r,p)},[r,p]),[p,h]},er="/Daggerheart/assets/daggerheart-logo-fe7815ad.svg",rr=({showFlyout:r,onFlyoutChange:t})=>{const[p,h]=v.useState(!1),[l,i]=v.useState(!1),o=r!==void 0?r:p,a=t||h;return v.useEffect(()=>{const n=d=>{d.target.closest(".help-button")||a(!1)};return document.addEventListener("click",n),()=>document.removeEventListener("click",n)},[a]),v.useEffect(()=>{const n=window.matchMedia("(max-width: 800px)"),d=u=>i(u.matches);return i(n.matches),n.addEventListener("change",d),()=>n.removeEventListener("change",d)},[]),e.jsxs("div",{className:"help-button",style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",padding:"0.5rem",color:o?"white":"var(--text-primary)",borderRadius:"50%",cursor:"pointer",transition:"all 0.2s ease",minWidth:"44px",minHeight:"44px",backgroundColor:o?"var(--purple)":"transparent"},onMouseEnter:n=>{o||(n.currentTarget.style.backgroundColor="var(--bg-secondary)")},onMouseLeave:n=>{o||(n.currentTarget.style.backgroundColor="transparent")},onClick:n=>{n.stopPropagation(),a(!o)},title:"Help & Info",children:[e.jsx("div",{style:{width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center",color:"inherit",backgroundColor:"transparent",border:"none",outline:"none"},children:e.jsx(Be,{size:20})}),e.jsxs("div",{style:{position:"absolute",top:"50%",right:"100%",left:"auto",transform:"translateY(-50%)",background:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,opacity:o?1:0,visibility:o?"visible":"hidden",transition:"opacity 0.2s ease, visibility 0.2s ease, transform 0.2s ease",pointerEvents:o?"auto":"none",minWidth:"280px",maxWidth:l?"calc(100vw - 2rem)":"320px",marginRight:"0.5rem"},children:[e.jsxs("div",{style:{padding:"0.75rem",borderTop:"1px solid rgba(255, 255, 255, 0.1)",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",background:"var(--bg-primary)",maxWidth:"280px"},children:[e.jsx("img",{src:er,alt:"Daggerheart Community Content Logo",style:{width:"100%",maxWidth:"200px",height:"auto",margin:"0 auto 0.75rem auto",display:"block"},onError:n=>{console.error("Failed to load Daggerheart logo:",n.target.src),n.target.style.display="none";const d=document.createElement("div");d.style.cssText="text-align: center; margin-bottom: 0.75rem; font-size: 1.5rem; font-weight: bold; color: var(--purple);",d.textContent="⚔️ DAGGERHEART ⚔️",n.target.parentNode.insertBefore(d,n.target)},onLoad:()=>{}}),e.jsxs("div",{style:{fontSize:"0.7rem",lineHeight:1.3,color:"var(--text-secondary)",textAlign:"left",wordWrap:"break-word",overflowWrap:"break-word"},children:[e.jsx("p",{children:"This product includes materials from the Daggerheart System Reference Document 1.0, © Critical Role, LLC, under the terms of the Darrington Press Community Gaming (DPCGL) License."}),e.jsxs("p",{children:["More information can be found at ",e.jsx("a",{href:"https://www.daggerheart.com",target:"_blank",rel:"noopener noreferrer",children:"daggerheart.com"})]}),e.jsx("p",{children:e.jsx("em",{children:"This project is unofficial and not endorsed by Darrington Press or Critical Role."})})]})]}),e.jsx("button",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"0.25rem 1rem",color:"var(--text-primary)",border:"none",background:"none",width:"100%",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"0.875rem",minHeight:"32px",borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},onMouseEnter:n=>{n.target.style.backgroundColor="var(--gray-dark)"},onMouseLeave:n=>{n.target.style.backgroundColor="transparent"},onClick:n=>{n.stopPropagation(),a(!1),window.open("https://github.com/Splinter714/Daggerheart","_blank")},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.25rem"},children:e.jsx("span",{children:"GitHub"})})}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"0.25rem 1rem",color:"var(--text-secondary)",border:"none",background:"none",width:"100%",textAlign:"left",cursor:"default",fontSize:"0.875rem",minHeight:"32px"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.25rem"},children:e.jsxs("span",{children:["Version ","0.2.32 (7f69340)"]})})})]})]})},tr=({adversaries:r,environments:t,countdowns:p,deleteAdversary:h,deleteEnvironment:l,deleteCountdown:i,isClearMode:o,setIsClearMode:a,showFlyout:n,onFlyoutChange:d})=>{const[u,s]=v.useState(!1),f=n!==void 0?n:u,x=d||s,b=((r==null?void 0:r.length)||0)>0||((t==null?void 0:t.length)||0)>0||((p==null?void 0:p.length)||0)>0,k=(r||[]).some(j=>(j.hp||0)>=(j.hpMax||1));v.useEffect(()=>{const j=I=>{I.target.closest(".delete-clear-container")||(x(!1),o&&a(!1))};return document.addEventListener("click",j),()=>document.removeEventListener("click",j)},[o,x]),v.useEffect(()=>{o&&!b&&(a(!1),x(!1))},[o,b,a,x]);const m={position:"absolute",top:"50%",right:"100%",left:"auto",transform:"translateY(-50%)",backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",padding:"0.5rem",minWidth:"200px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,display:f?"block":"none",marginRight:"0.5rem"},W={background:o||f?"var(--red)":"none",border:"none",color:o||f?"white":b?"var(--text-primary)":"var(--text-secondary)",cursor:b?"pointer":"not-allowed",padding:"0.5rem",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s",opacity:b?1:.5,minWidth:"44px",minHeight:"44px"},C={background:"none",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:"0.5rem",borderRadius:"var(--radius-sm)",width:"100%",textAlign:"left",display:"flex",alignItems:"center",gap:"0.5rem",transition:"background-color 0.2s"},M={backgroundColor:"var(--bg-hover)"};return e.jsxs("div",{className:"delete-clear-container",style:{position:"relative"},children:[e.jsx("button",{style:W,onClick:j=>{j.stopPropagation(),b&&(o?x(!f):(a(!0),x(!0)))},title:b?o?"Clear Items":"Enter Clear Mode":"Nothing to clear",children:e.jsx(Re,{size:20})}),e.jsxs("div",{style:m,children:[r&&r.length>0&&e.jsxs("button",{style:C,onMouseEnter:j=>Object.assign(j.target.style,M),onMouseLeave:j=>Object.assign(j.target.style,C),onClick:j=>{j.stopPropagation(),s(!1),r.forEach(I=>h(I.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Adversaries"})]}),r&&r.length>0&&k&&e.jsxs("button",{style:C,onMouseEnter:j=>Object.assign(j.target.style,M),onMouseLeave:j=>Object.assign(j.target.style,C),onClick:j=>{j.stopPropagation(),s(!1),r.filter(T=>(T.hp||0)>=(T.hpMax||1)).forEach(T=>h(T.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"Dead Adversaries"})]}),t&&t.length>0&&e.jsxs("button",{style:C,onMouseEnter:j=>Object.assign(j.target.style,M),onMouseLeave:j=>Object.assign(j.target.style,C),onClick:j=>{j.stopPropagation(),s(!1),t.forEach(I=>l(I.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Environments"})]}),p&&p.length>0&&e.jsxs("button",{style:C,onMouseEnter:j=>Object.assign(j.target.style,M),onMouseLeave:j=>Object.assign(j.target.style,C),onClick:j=>{j.stopPropagation(),s(!1),p.forEach(I=>i(I.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Countdowns"})]})]})]})},nr=({adversaries:r,environments:t,countdowns:p,deleteAdversary:h,deleteEnvironment:l,deleteCountdown:i,isClearMode:o,setIsClearMode:a})=>{const[n,d]=v.useState(!1),[u,s]=v.useState(!1),[f,x]=v.useState(!1);v.useEffect(()=>{const I=T=>{T.target.closest(".floating-menu-container")||(d(!1),s(!1),x(!1),o&&a(!1))};return document.addEventListener("click",I),()=>document.removeEventListener("click",I)},[o,a]),v.useEffect(()=>{n||(s(!1),x(!1),o&&a(!1))},[n,o,a]);const b=I=>{s(I),I&&(x(!1),o&&a(!1))},k=I=>{x(I),I&&s(!1)},W={position:"fixed",bottom:window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://")?"calc(60px + env(safe-area-inset-bottom) + 2rem)":"calc(60px + env(safe-area-inset-bottom) + 1rem)",right:"1rem",zIndex:1100,display:"flex",flexDirection:"column",alignItems:"center",gap:"0.5rem",pointerEvents:"none"},C={width:"56px",height:"56px",borderRadius:"50%",background:n?"var(--red)":"var(--bg-secondary)",border:"2px solid var(--border)",color:n?"white":"var(--text-primary)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"all 0.3s ease",pointerEvents:"auto"},M={display:"flex",flexDirection:"column",gap:"0.5rem",opacity:n?1:0,visibility:n?"visible":"hidden",transform:n?"translateY(0)":"translateY(10px)",transition:"all 0.3s ease",pointerEvents:n?"auto":"none"},j={width:"48px",height:"48px",borderRadius:"50%",background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.2)",transition:"all 0.2s ease",position:"relative",pointerEvents:"auto"};return e.jsxs("div",{className:"floating-menu-container",style:W,children:[e.jsxs("div",{style:M,children:[e.jsx("div",{style:j,children:e.jsx(rr,{showFlyout:u,onFlyoutChange:b})}),e.jsx("div",{style:j,children:e.jsx(tr,{adversaries:r,environments:t,countdowns:p,deleteAdversary:h,deleteEnvironment:l,deleteCountdown:i,isClearMode:o,setIsClearMode:a,showFlyout:f,onFlyoutChange:k})})]}),e.jsx("button",{style:C,onClick:I=>{I.stopPropagation(),d(!n)},title:n?"Close Menu":"Open Menu",children:n?e.jsx(be,{size:24}):e.jsx(He,{size:24})})]})},he=({position:r="top",children:t,onClick:p,className:h="",style:l={}})=>{const i=r==="top",o=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://"),a={background:"var(--bg-primary)",borderTop:i?"none":"1px solid var(--border)",borderBottom:i?"1px solid var(--border)":"none",padding:i?"0.25rem 0":"0.5rem",paddingBottom:i?"0.25rem":o?"calc(0.5rem + env(safe-area-inset-bottom) + 1rem)":"calc(0.5rem + env(safe-area-inset-bottom))",position:"sticky",[i?"top":"bottom"]:0,zIndex:i?10:100,order:i?1:3,flexShrink:0,touchAction:"manipulation",userSelect:"none",display:"flex",flexDirection:i?"column":"row",justifyContent:i?"stretch":"center",alignItems:i?"stretch":"center",gap:i?"0":"1rem",height:i?"auto":"60px",...l};return e.jsx("div",{className:h,style:a,onClick:p,children:t})},xe=({side:r="left",children:t,className:p="",style:h={}})=>{const l=r==="left",i={flex:1,minWidth:0,background:"var(--bg-primary)",overflowY:"auto",overflowX:l?"auto":"hidden",display:l?"block":"flex",flexDirection:l?"initial":"column",height:"100%",padding:l?"1rem 0 1rem 0":"1rem 1rem 1rem 0",...h};return e.jsx("div",{className:p,style:i,children:t})},sr=({items:r,onDelete:t,onEdit:p,onToggleVisibility:h,onReorder:l,onItemSelect:i,selectedItem:o,selectedType:a,onApplyDamage:n,onApplyHealing:d,onApplyStressChange:u,onIncrement:s,onDecrement:f,isEditMode:x,isClearMode:b,elementType:k,adversaries:m=[]})=>{if(!r||r.length===0)return null;const W=C=>{const M=o&&o.id===C.id&&a===k;console.log("Card selection check:",{itemId:C.id,selectedItemId:o==null?void 0:o.id,selectedType:a,elementType:k,isSelected:M});const j={item:C,mode:"compact",onClick:()=>i(C,k),onDelete:b?t:void 0,dragAttributes:x?{draggable:!0}:null,dragListeners:x?{onDragStart:I=>{I.dataTransfer.setData("text/plain",C.id)}}:null,adversaries:m,isSelected:M,isEditMode:x||b};switch(k){case"adversaries":return e.jsx(U,{...j,type:"adversary",onApplyDamage:n,onApplyHealing:d,onApplyStressChange:u},C.id);case"environments":return e.jsx(U,{...j,type:"environment",onEdit:p},C.id);case"countdowns":return e.jsx(U,{...j,type:"countdown",onIncrement:s,onDecrement:f},C.id);default:return null}};return e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:r.map(W)})},or=({onItemSelect:r,selectedItem:t,selectedType:p,onOpenDatabase:h,isEditMode:l,isClearMode:i,showLongTermCountdowns:o,fear:a,updateFear:n,handleRollOutcome:d,handleActionRoll:u,setShowLongTermCountdowns:s,lastAddedItemType:f})=>{console.log("GameBoard received props:",{selectedItem:t,selectedType:p});const{adversaries:x,environments:b,updateAdversary:k,deleteAdversary:m,reorderAdversaries:W,updateEnvironment:C,deleteEnvironment:M,reorderEnvironments:j,countdowns:I,createCountdown:T,deleteCountdown:z,reorderCountdowns:O,incrementCountdown:B,decrementCountdown:R}=Ee();v.useState({adversary:!1,environment:!1,campaign:!1});const[V,P]=Ze("sectionVisibility",{countdowns:!1,environments:!1,adversaries:!1});v.useEffect(()=>{f&&(f==="environment"?P(A=>({...A,environments:!0})):f==="adversary"?P(A=>({...A,adversaries:!0})):f==="countdown"&&P(A=>({...A,countdowns:!0})))},[f,P]);const $=(A,S)=>{},_=(A,S)=>{S==="environment"?M(A):S==="adversary"?m(A):S==="countdown"&&z(A),t&&t.id===A&&r(null,null)};return e.jsx("div",{style:{flex:1,overflowY:"auto"},children:e.jsxs("div",{children:[e.jsx(sr,{items:x,onDelete:A=>_(A,"adversary"),onEdit:A=>$(),onToggleVisibility:A=>{const S=x.find(E=>E.id===A);S&&k(A,{isVisible:!S.isVisible})},onReorder:W,onItemSelect:r,selectedItem:t,selectedType:p,onApplyDamage:(A,S,E,c)=>{const g=Math.min(c,E+S);k(A,{hp:g})},onApplyHealing:(A,S,E)=>{if(x.find(g=>g.id===A)){const g=Math.max(0,E-S);k(A,{hp:g})}},onApplyStressChange:(A,S)=>{const E=x.find(c=>c.id===A);if(E){let c=E.stress+S,g=E.hp||0;if(c>E.stressMax){const y=c-E.stressMax;c=E.stressMax,g=Math.min(E.hpMax,g+y)}else c<0&&(c=0);k(A,{stress:c,hp:g})}},isEditMode:l,isClearMode:i,elementType:"adversaries",adversaries:x}),e.jsx("div",{className:"border rounded-lg",style:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"12px",marginTop:"0.5rem",cursor:"pointer",transition:"all 0.1s ease",position:"relative",border:"2px dashed var(--border)",opacity:.8,background:"var(--bg-card)"},onClick:()=>h("adversaries"),onMouseEnter:A=>{A.target.style.opacity="1",A.target.style.borderColor="var(--border-hover)"},onMouseLeave:A=>{A.target.style.opacity="0.8",A.target.style.borderColor="var(--border)"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"0.5rem",position:"relative"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.25rem"},children:[e.jsx("h4",{style:{fontSize:"16px",fontWeight:"600",color:"var(--text-secondary)",margin:0},children:"Add Adversary"}),e.jsx("span",{style:{fontSize:"0.75rem",fontWeight:500,color:"var(--text-secondary)",letterSpacing:"0.5px"},children:"Click to browse"})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",borderRadius:"50%",border:"1px dashed var(--text-secondary)",color:"var(--text-secondary)"},children:e.jsx(te,{size:16})})]})})]})})};function ar({headerSelector:r=".drawer-header",closeThreshold:t=100,snapThreshold:p=30,onClose:h}={}){const[l,i]=v.useState(null),[o,a]=v.useState(null),[n,d]=v.useState(0),[u,s]=v.useState(!1),f=v.useCallback(m=>{var j,I;const W=m.target;if(!(r?W.closest(r):!1))return;const M=((I=(j=m.targetTouches)==null?void 0:j[0])==null?void 0:I.clientY)??0;i(M),a(M),d(0),s(!1)},[r]),x=v.useCallback(m=>{var j,I;if(l==null)return;const W=((I=(j=m.targetTouches)==null?void 0:j[0])==null?void 0:I.clientY)??0,C=W-l,M=6;!u&&Math.abs(C)>M&&s(!0),u&&(m.preventDefault(),m.stopPropagation(),a(W),d(Math.max(0,C)))},[l,u]),b=v.useCallback(m=>{if(l==null||o==null)return;const W=o-l;u?(m.preventDefault(),m.stopPropagation(),W>t?(d(window.innerHeight),typeof h=="function"&&setTimeout(()=>h(),300)):W>p?(d(0),setTimeout(()=>{i(null),a(null),s(!1)},50)):(d(0),i(null),a(null),s(!1))):(d(0),i(null),a(null),s(!1))},[l,o,u,t,p,h]),k=v.useCallback(()=>{d(0),i(null),a(null)},[]);return{drawerOffset:n,setDrawerOffset:d,touchHandlers:{onTouchStart:f,onTouchMove:x,onTouchEnd:b},resetSwipeState:k}}const ir=({isOpen:r,onClose:t,children:p})=>{const{drawerOffset:h,setDrawerOffset:l,touchHandlers:i,resetSwipeState:o}=ar({headerSelector:".drawer-header",closeThreshold:100,snapThreshold:30,onClose:t});return v.useEffect(()=>{r||o()},[r,o]),e.jsxs("div",{className:`mobile-drawer ${r?"open":""}`,children:[e.jsx("div",{className:"drawer-backdrop",onClick:t}),e.jsxs("div",{className:"drawer-content",style:{transform:r?`translateY(${h}px)`:"translateY(100%)",transition:h?"none":"transform 0.25s cubic-bezier(0.4, 0.0, 0.2, 1)"},onTouchStart:a=>{i.onTouchStart(a)},onTouchMove:a=>{i.onTouchMove(a)},onTouchEnd:a=>{i.onTouchEnd(a)},onClick:a=>{a.stopPropagation()},children:[e.jsx("div",{className:"drawer-header",onClick:()=>{l(window.innerHeight),setTimeout(()=>{t()},300)},children:e.jsx("div",{className:"drawer-handle"})}),e.jsx("div",{className:"drawer-body",children:p})]})]})},lr=()=>e.jsx("div",{className:"pwa-install-prompt",style:{}}),dr="modulepreload",cr=function(r){return"/Daggerheart/"+r},fe={},ge=function(t,p,h){if(!p||p.length===0)return t();const l=document.getElementsByTagName("link");return Promise.all(p.map(i=>{if(i=cr(i),i in fe)return;fe[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!h)for(let u=l.length-1;u>=0;u--){const s=l[u];if(s.href===i&&(!o||s.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const d=document.createElement("link");if(d.rel=o?"stylesheet":dr,o||(d.as="script",d.crossOrigin=""),d.href=i,document.head.appendChild(d),o)return new Promise((u,s)=>{d.addEventListener("load",u),d.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>t()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})};let Ie={adversaries:[]},De={environments:[]};const pr=async()=>{try{const r=await ge(()=>import("./adversaries-e62ea4d8.js"),[]);Ie=(r==null?void 0:r.default)||r}catch(r){console.warn("Failed to load adversaries.json:",r)}try{const r=await ge(()=>import("./environments-5ca1c1e1.js"),[]);De=(r==null?void 0:r.default)||r}catch(r){console.warn("Failed to load environments.json:",r)}},ur=r=>{const[t,p]=v.useState(""),[h,l]=v.useState([{field:"tier",direction:"asc"},{field:"name",direction:"asc"}]),[i,o]=v.useState(null),[a,n]=v.useState([]),[d,u]=v.useState(!0),[s,f]=v.useState([]),[x,b]=v.useState([]),[k,m]=v.useState(!1),[W,C]=v.useState(!1),M=v.useRef(null),j=v.useRef(null);v.useEffect(()=>{(async()=>{await pr(),u(!1);let E=[];r==="adversary"?E=Ie.adversaries||[]:r==="environment"&&(E=De.environments||[]),n(E)})()},[r]);const I=S=>{const E=a.map(c=>c[S]).filter(Boolean);return[...new Set(E)].sort((c,g)=>typeof c=="number"&&typeof g=="number"?c-g:String(c).localeCompare(String(g)))},T=I("tier"),z=I("type"),O=v.useMemo(()=>{let S=a.filter(E=>{var w,D;const c=E.name.toLowerCase().includes(t.toLowerCase())||((w=E.type)==null?void 0:w.toLowerCase().includes(t.toLowerCase()))||((D=E.description)==null?void 0:D.toLowerCase().includes(t.toLowerCase())),g=s.length===0||s.includes(E.tier.toString()),y=x.length===0||x.includes(E.type);return c&&g&&y});return S.sort((E,c)=>{for(const g of h){const{field:y,direction:w}=g;let D=E[y],L=c[y];if(y==="tier")D=parseInt(D)||0,L=parseInt(L)||0;else if(y==="difficulty"){const X=parseInt(D),q=parseInt(L);!isNaN(X)&&!isNaN(q)?(D=X,L=q):!isNaN(X)&&isNaN(q)?(D=X,L=999):isNaN(X)&&!isNaN(q)?(D=999,L=q):(D=String(D||"").toLowerCase(),L=String(L||"").toLowerCase())}else typeof D=="string"&&typeof L=="string"?(D=D.toLowerCase(),L=L.toLowerCase()):(D=String(D||"").toLowerCase(),L=String(L||"").toLowerCase());if(w==="asc"){if(D>L)return 1;if(D<L)return-1}else{if(D<L)return 1;if(D>L)return-1}}return 0}),S},[a,t,h,s,x]),B=S=>{l(E=>{const c=E.findIndex(g=>g.field===S);if(c>=0)if(c===0){const g=[...E];return g[0]={...g[0],direction:g[0].direction==="asc"?"desc":"asc"},g}else{const g=[...E];return g.splice(c,1)[0],[{field:S,direction:"asc"},...g]}else return[{field:S,direction:"asc"},...E]})},R=S=>{o(i===S?null:S)},V=S=>{f(S==="clear"?[]:E=>E.includes(S)?E.filter(c=>c!==S):[...E,S])},P=S=>{b(S==="clear"?[]:E=>E.includes(S)?E.filter(c=>c!==S):[...E,S])},$=s.length>0,_=x.length>0;return v.useEffect(()=>{const S=c=>{const g=c.target.closest(".filter-dropdown"),y=c.target.closest(".header-filter-icon");g||y||(m(!1),C(!1))},E=c=>{c.key==="Escape"&&(m(!1),C(!1))};return document.addEventListener("pointerdown",S,!0),document.addEventListener("mousedown",S,!0),document.addEventListener("touchstart",S,!0),document.addEventListener("click",S,!0),document.addEventListener("keydown",E,!0),()=>{document.removeEventListener("pointerdown",S,!0),document.removeEventListener("mousedown",S,!0),document.removeEventListener("touchstart",S,!0),document.removeEventListener("click",S,!0),document.removeEventListener("keydown",E,!0)}},[m,C]),{searchTerm:t,setSearchTerm:p,sortFields:h,handleSort:B,expandedCard:i,toggleExpanded:R,filteredAndSortedData:O,loading:d,selectedTiers:s,selectedTypes:x,showTierDropdown:k,setShowTierDropdown:m,showTypeDropdown:W,setShowTypeDropdown:C,tierFilterRef:M,typeFilterRef:j,uniqueTiers:T,uniqueTypes:z,handleTierSelect:V,handleTypeSelect:P,isTierFiltered:$,isTypeFiltered:_,getDropdownStyle:S=>{if(!S.current)return{};const E=S.current.getBoundingClientRect();return{position:"fixed",top:E.bottom+4,left:E.left-100,zIndex:99999}}}},hr=({searchTerm:r,onSearchChange:t,type:p})=>e.jsx("div",{style:N.browserHeader,children:e.jsx("input",{type:"text",placeholder:"Search",value:r,onChange:h=>t(h.target.value),style:N.searchInput})}),xr=({sortFields:r,onSort:t,type:p,uniqueTiers:h,uniqueTypes:l,selectedTiers:i,selectedTypes:o,showTierDropdown:a,setShowTierDropdown:n,showTypeDropdown:d,setShowTypeDropdown:u,tierFilterRef:s,typeFilterRef:f,handleTierSelect:x,handleTypeSelect:b,isTierFiltered:k,isTypeFiltered:m,getDropdownStyle:W})=>{const[C,M]=v.useState(null),I=(()=>p==="adversary"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:p==="environment"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:[])(),T=(z,O,B,R,V,P,$,_)=>{if(!V)return null;const A=()=>{(z==="tier"||z==="type")&&R("clear")};return ye.createPortal(e.jsxs("div",{className:"filter-dropdown",style:{...N.filterDropdown,...W($),maxHeight:"60vh",overflow:"auto"},onMouseDown:S=>S.stopPropagation(),onClick:S=>S.stopPropagation(),children:[e.jsxs("div",{style:{...N.filterOption,...B.length===0?N.filterOptionSelected:{}},onClick:A,children:[e.jsx("span",{style:N.checkIcon,children:B.length===0?e.jsx(de,{size:16}):e.jsx(ce,{size:16})}),e.jsx("span",{style:N.filterLabel,children:"All"})]}),O.map(S=>{const E=B.includes(S.toString());return e.jsxs("div",{style:{...N.filterOption,...E?N.filterOptionSelected:{}},onClick:()=>R(S.toString()),children:[e.jsx("span",{style:N.checkIcon,children:E?e.jsx(de,{size:16}):e.jsx(ce,{size:16})}),e.jsx("span",{style:N.filterLabel,children:S})]},S)})]}),document.body)};return e.jsx("tr",{style:N.tableHeader,children:I.map(z=>e.jsxs("th",{style:{...N.tableHeaderCell,...C===z.key?N.tableHeaderCellHover:{},position:"relative",...z.key==="name"?{width:"auto",minWidth:"0"}:{},...z.key==="tier"?{width:"80px",minWidth:"80px",maxWidth:"80px"}:{},...z.key==="type"?{width:"100px",minWidth:"100px",maxWidth:"100px"}:{},...z.key==="difficulty"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...z.key==="action"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{}},onClick:()=>t(z.key),onMouseEnter:()=>M(z.key),onMouseLeave:()=>M(null),children:[z.hasFilter?e.jsxs("div",{style:N.headerWithFilter,children:[e.jsx("span",{style:{cursor:"pointer"},onClick:O=>{O.stopPropagation(),t(z.key)},children:z.label}),e.jsxs("button",{ref:z.key==="tier"?s:f,style:{...N.headerFilterIcon,...z.key==="tier"&&k?N.headerFilterIconActive:{},...z.key==="type"&&m?N.headerFilterIconActive:{}},className:"header-filter-icon",onClick:O=>{O.stopPropagation(),z.key==="tier"?(n(!a),u(!1)):z.key==="type"&&(u(!d),n(!1))},children:[e.jsx(Ne,{size:14}),z.key==="tier"&&k||z.key==="type"&&m?e.jsx("span",{style:N.filterActiveDot}):null]})]}):z.label,z.key==="tier"&&T("tier",h,i,x,a,n,s),z.key==="type"&&T("type",l,o,b,d,u,f)]},z.key))})},fr=({item:r,isExpanded:t,onToggleExpanded:p,onAdd:h,type:l})=>{const[i,o]=v.useState(!1),a=()=>{h(r)},n=()=>l==="adversary"?e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...N.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:r.name}),e.jsx("td",{style:{...N.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:r.tier}),e.jsx("td",{style:{...N.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:r.type}),e.jsx("td",{style:{...N.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:r.difficulty})]}):l==="environment"?e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...N.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:r.name}),e.jsx("td",{style:{...N.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:r.tier}),e.jsx("td",{style:{...N.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:r.type}),e.jsx("td",{style:{...N.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:r.difficulty})]}):null;return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{style:{...N.row,...i?N.rowHover:{}},onClick:()=>p(r.id),onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:[n(),e.jsx("td",{style:{width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",boxSizing:"border-box",overflow:"visible",textOverflow:"unset",whiteSpace:"nowrap"},children:e.jsx("button",{style:N.addButton,onClick:d=>{d.stopPropagation(),a()},onMouseEnter:d=>{d.target.style.background="var(--bg-secondary)"},onMouseLeave:d=>{d.target.style.background="var(--purple)"},children:"+"})})]}),t&&e.jsx("tr",{style:N.expandedRow,children:e.jsx("td",{colSpan:"5",style:N.expandedContent,children:e.jsx(U,{item:r,type:l,mode:"expanded",onClick:()=>{},onDelete:()=>{}})})})]})},me=({type:r,onAddItem:t,onCancel:p})=>{const{searchTerm:h,setSearchTerm:l,sortFields:i,handleSort:o,expandedCard:a,toggleExpanded:n,filteredAndSortedData:d,loading:u,selectedTiers:s,selectedTypes:f,showTierDropdown:x,setShowTierDropdown:b,showTypeDropdown:k,setShowTypeDropdown:m,tierFilterRef:W,typeFilterRef:C,uniqueTiers:M,uniqueTypes:j,handleTierSelect:I,handleTypeSelect:T,isTierFiltered:z,isTypeFiltered:O,getDropdownStyle:B}=ur(r);return u?e.jsx("div",{style:N.browser,children:e.jsx("div",{style:N.loading,children:"Loading..."})}):e.jsxs("div",{style:N.browserWrapper,children:[e.jsx(hr,{searchTerm:h,onSearchChange:l,type:r}),e.jsx("div",{className:"browser-content",style:N.browserContent,children:e.jsxs("table",{style:N.browserTable,children:[e.jsx("thead",{children:e.jsx(xr,{sortFields:i,onSort:o,type:r,uniqueTiers:M,uniqueTypes:j,selectedTiers:s,selectedTypes:f,showTierDropdown:x,setShowTierDropdown:b,showTypeDropdown:k,setShowTypeDropdown:m,tierFilterRef:W,typeFilterRef:C,handleTierSelect:I,handleTypeSelect:T,isTierFiltered:z,isTypeFiltered:O,getDropdownStyle:B})}),e.jsx("tbody",{children:d.map(R=>e.jsx(fr,{item:R,isExpanded:a===R.id,onToggleExpanded:n,onAdd:t,type:r},R.id))})]})})]})},N={browserWrapper:{display:"flex",flexDirection:"column",background:"var(--bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border)",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserContent:{flex:1,overflowY:"auto",overflowX:"visible",padding:0,width:"100%"},tableHeaderContainer:{flexShrink:0,position:"sticky",top:0,zIndex:15,backgroundColor:"var(--bg-secondary)"},browserTable:{width:"100%",minWidth:"100%",borderCollapse:"collapse",tableLayout:"fixed",background:"var(--bg-primary)",margin:0},browserHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--gray-900)",flexShrink:0,position:"sticky",top:0,zIndex:20},browserTitle:{margin:0,color:"var(--text-primary)",fontSize:"18px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"24px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"14px",marginRight:"12px",transition:"all 0.2s ease"},searchInputFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 3px rgba(139, 92, 246, 0.1)"},tableHeader:{background:"var(--gray-900)",borderBottom:"1px solid var(--border)",boxShadow:"0 1px 0 var(--border)",position:"sticky",top:"0",zIndex:10},tableHeaderCell:{backgroundColor:"var(--gray-900)",fontWeight:"700",borderBottom:"1px solid var(--border)",cursor:"pointer",userSelect:"none",minWidth:"100px",whiteSpace:"nowrap",padding:"4px 4px",color:"var(--text-primary)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",boxShadow:"0 1px 0 var(--border)",transition:"background-color 0.2s",position:"sticky",top:"0",zIndex:10},tableHeaderCellHover:{backgroundColor:"var(--bg-hover)"},sortIndicator:{fontSize:"12px",color:"var(--text-secondary)"},tableBody:{flex:1,overflowY:"auto",padding:"8px",backgroundColor:"var(--bg-primary)"},row:{height:"35px",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s ease",cursor:"pointer",backgroundColor:"var(--gray-900)"},rowHover:{backgroundColor:"var(--bg-secondary)"},expandedRow:{backgroundColor:"var(--bg-secondary)"},rowCell:{padding:"4px 4px",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid var(--border)"},rowCellName:{fontWeight:"500",minWidth:"150px"},rowCellCenter:{textAlign:"center",justifyContent:"center",minWidth:"80px"},rowActions:{width:"80px",textAlign:"center",padding:"4px 8px",borderBottom:"1px solid var(--border)"},addButton:{width:"1.5rem",height:"1.5rem",border:"1px solid var(--purple)",borderRadius:"var(--radius-sm)",background:"var(--purple)",color:"white",cursor:"pointer",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"500"},expandedContent:{padding:"0",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)"},columnName:{width:"auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",paddingLeft:"8px",textAlign:"left"},columnTier:{width:"80px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnType:{width:"100px",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},columnDifficulty:{width:"40px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnAction:{width:"24px",minWidth:"24px",maxWidth:"24px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"visible",textOverflow:"unset"},loading:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"var(--text-primary)",fontSize:"16px"},mobileBrowser:{width:"95vw",height:"90vh",maxWidth:"none"},mobileSearchInput:{fontSize:"16px"},headerWithFilter:{display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",position:"relative"},headerFilterIcon:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"2px 4px",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",position:"relative"},headerFilterIconActive:{color:"var(--purple)"},filterIcon:{fontSize:"12px"},filterActiveDot:{position:"absolute",left:"50%",top:"2px",transform:"translateX(-50%)",width:"4px",height:"4px",borderRadius:"50%",background:"var(--purple)",pointerEvents:"none"},filterDropdown:{position:"absolute",top:"100%",left:"0",background:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",zIndex:99999,marginTop:"4px",overflow:"hidden",width:"max-content",minWidth:"120px",maxWidth:"200px"},filterOption:{padding:"8px 12px",cursor:"pointer",color:"var(--text-primary)",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background-color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},filterOptionSelected:{backgroundColor:"var(--bg-hover)"},checkIcon:{width:"16px",height:"16px",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"12px"},filterLabel:{flex:1}};function gr({selectedItem:r,selectedType:t,countdowns:p,adversaries:h,environments:l,setSelectedItem:i,handleCloseRightColumn:o}){v.useEffect(()=>{if(!r||!t)return;let a=!1;t==="adversaries"||t==="adversary"?a=h.some(n=>n.id===r.id):t==="environments"||t==="environment"?a=l.some(n=>n.id===r.id):(t==="countdowns"||t==="countdown")&&(a=p.some(n=>n.id===r.id)),a||o()},[r,t,p,h,l,i,o]),v.useEffect(()=>{if(!r||!t)return;let a=null;t==="adversaries"||t==="adversary"?a=h.find(n=>n.id===r.id):t==="environments"||t==="environment"?a=l.find(n=>n.id===r.id):(t==="countdowns"||t==="countdown")&&(a=p.find(n=>n.id===r.id)),a&&JSON.stringify(a)!==JSON.stringify(r)&&i(a)},[r,t,p,h,l,i])}class mr extends oe.Component{constructor(t){super(t),this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,p){console.error("ErrorBoundary caught an error:",t,p)}render(){var t;return this.state.hasError?e.jsxs("div",{className:"p-md text-red",children:[e.jsx("h3",{children:"Something went wrong:"}),e.jsx("pre",{children:(t=this.state.error)==null?void 0:t.toString()}),e.jsx("button",{className:"btn-base btn-text",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try again"})]}):this.props.children}}const yr=()=>{const{adversaries:r,environments:t,countdowns:p,fear:h,updateFear:l,createAdversary:i,updateAdversary:o,deleteAdversary:a,createEnvironment:n,updateEnvironment:d,deleteEnvironment:u,createCountdown:s,deleteCountdown:f,advanceCountdown:x}=Ee(),[b,k]=v.useState(null),[m,W]=v.useState(null),[C,M]=v.useState(null),[j,I]=v.useState("unified"),[T,z]=v.useState(!1),[O,B]=v.useState(!1),[R,V]=v.useState(!1),[P]=v.useState("left"),[$,_]=v.useState(!0);v.useState(!1);const[A,S]=v.useState(null),[E,c]=v.useState(!1),g=(F,Y)=>{v.startTransition(()=>{b&&b.id===F.id&&m===Y&&C==="item"?(k(null),W(null),M(null),T&&c(!1)):(k(F),W(Y),M("item"),T&&c(!0))})},y=(F="unified")=>{let Y=F;F==="adversaries"?Y="adversary":F==="environments"&&(Y="environment"),C==="database"&&j===Y?v.startTransition(()=>{M(null),I("unified"),T&&c(!1)}):v.startTransition(()=>{I(Y),M("database"),T&&c(!0)})},w=F=>{p.forEach(Y=>{const G=Ge(Y,F);if(G>0){const J=Y.value||0;x(Y.id,J+G)}})},D=()=>{p.forEach(F=>{const Y=Ke(F);if(Y>0){const G=F.value||0;x(F.id,G+Y)}})},L=v.useCallback(()=>{M(null),k(null),W(null),T&&c(!1)},[T]);v.useEffect(()=>{const F=()=>{const J=T,ee=window.matchMedia("(max-width: 800px)").matches;z(ee),!J&&ee&&(C==="database"||C==="creator"||C==="item")&&c(!0),J&&!ee&&E&&c(!1)};F();const Y=window.matchMedia("(max-width: 800px)"),G=()=>F();return Y.addEventListener("change",G),()=>Y.removeEventListener("change",G)},[T,C,E]),v.useEffect(()=>(E||T&&b?(document.body.classList.add("mobile-drawer-open"),document.documentElement.classList.add("mobile-drawer-open")):(document.body.classList.remove("mobile-drawer-open"),document.documentElement.classList.remove("mobile-drawer-open")),()=>{document.body.classList.remove("mobile-drawer-open"),document.documentElement.classList.remove("mobile-drawer-open")}),[T,E,b]),gr({selectedItem:b,selectedType:m,countdowns:p,adversaries:r,environments:t,setSelectedItem:k,handleCloseRightColumn:L});const{handleAdversaryDamage:X,handleAdversaryHealing:q,handleAdversaryStressChange:ie}=Ue({adversaries:r,updateAdversary:o,deleteAdversary:a,selectedItem:b,setSelectedItem:k});return e.jsxs("div",{className:"app",onClick:F=>{F.target===F.currentTarget&&L()},children:[!T&&e.jsx(he,{position:"top",style:{display:"flex",alignItems:"center",justifyContent:"center",height:"var(--topbar-height)",touchAction:"manipulation",userSelect:"none"},children:e.jsx(K,{type:"fear",value:(h==null?void 0:h.value)||0,maxValue:12,onChange:l,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0})}),e.jsx(he,{position:"bottom",children:T&&e.jsx(K,{type:"fear",value:(h==null?void 0:h.value)||0,maxValue:12,onChange:l,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0})}),e.jsx(nr,{adversaries:r,environments:t,countdowns:p,deleteAdversary:a,deleteEnvironment:u,deleteCountdown:f,isClearMode:R,setIsClearMode:V}),e.jsxs("div",{className:"main-content",children:[e.jsx(xe,{side:"left",className:`${T&&P==="right"?"mobile-hidden":""}`,children:e.jsx(or,{onItemSelect:g,selectedItem:b,selectedType:m,onOpenDatabase:y,isEditMode:O,onEditModeChange:B,isClearMode:R,showLongTermCountdowns:$,fear:h,updateFear:l,handleRollOutcome:w,handleActionRoll:D,setShowLongTermCountdowns:_,lastAddedItemType:A})}),e.jsxs(xe,{side:"right",className:`${T&&P==="left"?"mobile-hidden":""}`,style:C==="database"?{overflowY:"hidden"}:{},children:[C==="database"&&e.jsx("div",{className:"database-display",children:e.jsx(me,{type:j,onAddItem:F=>{j==="adversary"?(i(F),S("adversary")):j==="environment"&&(n(F),S("environment"))},onCancel:L})}),C==="item"&&b&&e.jsx(U,{type:m,item:b,mode:O?"edit":"expanded",onApplyDamage:X,onApplyHealing:q,onApplyStressChange:ie,onUpdate:m==="adversaries"?o:m==="environments"?d:updateCountdown,adversaries:r}),!C&&e.jsx("div",{})]})]},`mobile-${T}`),T&&e.jsxs(ir,{isOpen:E,onClose:L,children:[C==="database"&&e.jsx("div",{className:"browser-container",children:e.jsx(me,{type:j,onAddItem:F=>{j==="adversary"?(i(F),S("adversary")):j==="environment"&&(n(F),S("environment"))},onCancel:L})}),C==="item"&&b&&e.jsx("div",{className:"expanded-content",children:e.jsx(U,{type:m,item:b,mode:O?"edit":"expanded",onApplyDamage:X,onApplyHealing:q,onApplyStressChange:ie,onUpdate:m==="adversaries"?o:m==="environments"?d:updateCountdown,adversaries:r})})]}),e.jsx(lr,{})]})},vr=()=>e.jsx(mr,{children:e.jsx(ke,{children:e.jsx(yr,{})})});ne.createRoot(document.getElementById("root")).render(e.jsx(oe.StrictMode,{children:e.jsx(ke,{children:e.jsx(vr,{})})}));
