import{r as f,a as vt,R as _e}from"./dndkit-57209f9c.js";import{F as ar,f as ir,a as lr,b as dr,c as It}from"./fa-b4bcccb0.js";import{D as cr,A as ur,C as Vt,X as tt,M as lt,P as Je,a as pr,H as mr,L as fr,F as hr,S as ht,b as xt,T as Tt,c as Mt,B as Nt}from"./lucide-e69a925c.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const d of l)if(d.type==="childList")for(const c of d.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function o(l){const d={};return l.integrity&&(d.integrity=l.integrity),l.referrerPolicy&&(d.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?d.credentials="include":l.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function i(l){if(l.ep)return;l.ep=!0;const d=o(l);fetch(l.href,d)}})();var Kt={exports:{}},ut={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xr=f,gr=Symbol.for("react.element"),yr=Symbol.for("react.fragment"),vr=Object.prototype.hasOwnProperty,br=xr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,wr={key:!0,ref:!0,__self:!0,__source:!0};function Gt(e,a,o){var i,l={},d=null,c=null;o!==void 0&&(d=""+o),a.key!==void 0&&(d=""+a.key),a.ref!==void 0&&(c=a.ref);for(i in a)vr.call(a,i)&&!wr.hasOwnProperty(i)&&(l[i]=a[i]);if(e&&e.defaultProps)for(i in a=e.defaultProps,a)l[i]===void 0&&(l[i]=a[i]);return{$$typeof:gr,type:e,key:d,ref:c,props:l,_owner:br.current}}ut.Fragment=yr;ut.jsx=Gt;ut.jsxs=Gt;Kt.exports=ut;var t=Kt.exports,bt={},zt=vt;bt.createRoot=zt.createRoot,bt.hydrateRoot=zt.hydrateRoot;function $e(e){if(typeof localStorage>"u")return null;try{const a=localStorage.getItem(e);return a==null?null:JSON.parse(a)}catch{return null}}function Ke(e,a){if(!(typeof localStorage>"u"))try{localStorage.setItem(e,JSON.stringify(a))}catch{}}function Ye(e){const a=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return e?`${e}-${a}`:a}function Sr(e=[]){const[a,o]=f.useState(e),i=f.useRef(!0);return f.useEffect(()=>{if(i.current){i.current=!1;return}const p=$e("daggerheart-game-state")||{};Ke("daggerheart-game-state",{...p,adversaries:a})},[a]),{adversaries:a,createAdversary:p=>{var h;const x=Ye("adv"),m=p.baseName||((h=p.name)==null?void 0:h.replace(/\s+\(\d+\)$/,""))||p.name||"Unknown",r=a.filter(w=>w.baseName===m);let n=1;if(r.length>0){const w=r.map(O=>O.duplicateNumber||1);let S=1;for(;w.includes(S);)S++;n=S}const s={...p,id:x,baseName:m,duplicateNumber:n,name:`${m} (${n})`,hp:0,stress:0,isVisible:!0};o(w=>[...w,s])},createAdversariesBulk:p=>{const x=[],m={};p.forEach(r=>{var W;const n=r.baseName||((W=r.name)==null?void 0:W.replace(/\s+\(\d+\)$/,""))||r.name||"Unknown",h=a.filter(K=>K.baseName===n).length,w=m[n]||0,S=h+w+1;m[n]=w+1;const O={...r,id:Ye("adv"),baseName:n,duplicateNumber:S,name:`${n} (${S})`,hp:0,stress:0,isVisible:!0};x.push(O)}),o(r=>[...r,...x])},updateAdversary:(p,x)=>{o(m=>m.map(r=>{if(r.id===p){const n={...r,...x};if(x.baseName!==void 0){const s=x.baseName,h=n.duplicateNumber||1;n.name=h===1?s:`${s} (${h})`}return n}return r}))},deleteAdversary:p=>{o(x=>x.filter(m=>m.id!==p))}}}function jr(e=[]){const[a,o]=f.useState(e),i=f.useRef(!0);return f.useEffect(()=>{if(i.current){i.current=!1;return}const m=$e("daggerheart-game-state")||{};Ke("daggerheart-game-state",{...m,countdowns:a})},[a]),{countdowns:a,createCountdown:m=>{const r={id:Ye("countdown"),name:m.name||"Countdown",max:parseInt(m.max)||1,value:0,visible:!0,type:m.type||"standard",loop:m.loop||"none",source:m.source||"campaign"};o(n=>[...n,r])},updateCountdown:(m,r)=>{o(n=>n.map(s=>s.id===m?{...s,...r}:s))},deleteCountdown:m=>{o(r=>r.filter(n=>n.id!==m))},advanceCountdown:(m,r)=>{o(n=>n.map(s=>{if(s.id!==m)return s;let h=r;if(s.loop==="loop")h>s.max?h=(h-1)%s.max+1:h<0&&(h=s.max);else if(s.loop==="increasing"){if(h>s.max)return{...s,max:s.max+1,value:1};if(h<0)return{...s,max:Math.max(1,s.max-1),value:1};h=Math.max(0,h)}else if(s.loop==="decreasing"){if(h>s.max)return{...s,max:Math.max(1,s.max-1),value:1};if(h<0)return{...s,max:s.max+1,value:1};h=Math.min(s.max,h)}else h=Math.max(0,Math.min(h,s.max));return{...s,value:h}}))},incrementCountdown:(m,r=1)=>{o(n=>n.map(s=>{if(s.id!==m)return s;let h=s.value+r;if(s.loop==="loop")h>s.max&&(h=(h-1)%s.max+1);else if(s.loop==="increasing"){if(h>s.max)return{...s,max:s.max+1,value:1}}else if(s.loop==="decreasing"){if(h>s.max)return{...s,max:Math.max(1,s.max-1),value:1}}else h=Math.min(h,s.max);return{...s,value:h}}))},decrementCountdown:m=>{o(r=>r.map(n=>{if(n.id!==m)return n;let s=n.value-1;if(n.loop==="loop")s<0&&(s=n.max);else if(n.loop==="increasing"){if(s<0)return{...n,max:Math.max(1,n.max-1),value:n.max};s=Math.max(0,s)}else if(n.loop==="decreasing"){if(s<0)return{...n,max:n.max+1,value:1}}else s=Math.max(0,s);return{...n,value:s}}))}}}function Cr(e=[]){const[a,o]=f.useState(e),i=f.useRef(!0);return f.useEffect(()=>{if(i.current){i.current=!1;return}const u=$e("daggerheart-game-state")||{};Ke("daggerheart-game-state",{...u,environments:a})},[a]),{environments:a,createEnvironment:u=>{const p=Ye("env"),m=(a||[]).filter(s=>s.name.replace(/\s+\(\d+\)$/,"")===u.name);let r=u.name||"Unknown";if(m.length===0)r=u.name;else if(m.length===1){const s=m[0],h=s.name.replace(/\s+\(\d+\)$/,""),w=a.map(S=>S.id===s.id?{...S,name:`${h} (1)`}:S);o(w),r=`${u.name} (2)`}else{const s=m.map(w=>{const S=w.name.match(/\((\d+)\)$/);return S?parseInt(S[1]):null}).filter(w=>w!==null);let h=1;for(;s.includes(h);)h++;r=`${u.name} (${h})`}const n={...u,id:p,name:r,isVisible:!0};o(s=>[...s,n])},updateEnvironment:(u,p)=>{o(x=>x.map(m=>m.id===u?{...m,...p}:m))},deleteEnvironment:u=>{o(p=>p.filter(x=>x.id!==u))}}}function kr(e=[],a="Encounter"){const[o,i]=f.useState(e),[l,d]=f.useState(a),c=f.useRef(!0);return f.useEffect(()=>{if(c.current){c.current=!1;return}const r=$e("daggerheart-game-state")||{};Ke("daggerheart-game-state",{...r,savedEncounters:o,currentEncounterName:l})},[o,l]),{savedEncounters:o,currentEncounterName:l,saveEncounter:r=>{if(r.id)return i(n=>n.map(s=>s.id===r.id?{...s,name:r.name||s.name,encounterItems:r.encounterItems||s.encounterItems,partySize:r.partySize||s.partySize,battlePointsAdjustments:r.battlePointsAdjustments||s.battlePointsAdjustments,updatedAt:new Date().toISOString()}:s)),r.id;{const n={id:Ye("encounter"),name:r.name||"Encounter",createdAt:new Date().toISOString(),encounterItems:r.encounterItems||[],partySize:r.partySize||4,battlePointsAdjustments:r.battlePointsAdjustments||{}};return i(s=>[...s,n]),n.id}},loadEncounter:r=>o.find(n=>n.id===r),deleteEncounter:r=>{i(n=>n.filter(s=>s.id!==r))},updateCurrentEncounterName:r=>{d(r||"Encounter")}}}function Er(e={value:0,visible:!1},a=4){const[o,i]=f.useState(e),[l,d]=f.useState(a),c=f.useRef(!0);return f.useEffect(()=>{if(c.current){c.current=!1;return}const x=$e("daggerheart-game-state")||{};Ke("daggerheart-game-state",{...x,fear:o,partySize:l})},[o,l]),{fear:o,partySize:l,updateFear:x=>{i(m=>({...m,value:x}))},updatePartySize:x=>{d(Math.max(1,x))}}}function Ar(){const[e,a]=f.useState({adversaries:[],environments:[]});return f.useEffect(()=>{const d=$e("daggerheart-custom-adversaries")||[],c=$e("daggerheart-custom-environments")||[];a({adversaries:d,environments:c})},[]),f.useEffect(()=>{Ke("daggerheart-custom-adversaries",e.adversaries)},[e.adversaries]),f.useEffect(()=>{Ke("daggerheart-custom-environments",e.environments)},[e.environments]),{customContent:e,addCustomAdversary:d=>{const c={...d,id:Ye("custom-adv"),source:d.source||"Homebrew",isCustom:!0};return a(u=>({...u,adversaries:[...u.adversaries,c]})),c.id},updateCustomAdversary:(d,c)=>{a(u=>({...u,adversaries:u.adversaries.map(p=>p.id===d?{...p,...c}:p)}))},deleteCustomAdversary:d=>{a(c=>({...c,adversaries:c.adversaries.filter(u=>u.id!==d)}))}}}const Jt=f.createContext(),Ir=({children:e})=>{const[a,o]=f.useState(!1),[i,l]=f.useState(()=>$e("daggerheart-game-state")||{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],currentEncounterName:"Encounter"}),d=Er(i.fear,i.partySize),c=Sr(i.adversaries||[]),u=jr(i.countdowns||[]),p=Cr(i.environments||[]),x=kr(i.savedEncounters||[],i.currentEncounterName||"Encounter"),m=Ar();f.useEffect(()=>{o(!0)},[]);const n={gameState:{fear:d.fear,countdowns:u.countdowns,adversaries:c.adversaries,environments:p.environments,partySize:d.partySize,savedEncounters:x.savedEncounters,currentEncounterName:x.currentEncounterName},isLoaded:a,customContent:m.customContent,updateFear:d.updateFear,updatePartySize:d.updatePartySize,updateCurrentEncounterName:x.updateCurrentEncounterName,saveEncounter:x.saveEncounter,loadEncounter:x.loadEncounter,deleteEncounter:x.deleteEncounter,createCountdown:u.createCountdown,updateCountdown:u.updateCountdown,deleteCountdown:u.deleteCountdown,advanceCountdown:u.advanceCountdown,incrementCountdown:u.incrementCountdown,decrementCountdown:u.decrementCountdown,createAdversary:c.createAdversary,createAdversariesBulk:c.createAdversariesBulk,updateAdversary:c.updateAdversary,deleteAdversary:c.deleteAdversary,createEnvironment:p.createEnvironment,updateEnvironment:p.updateEnvironment,deleteEnvironment:p.deleteEnvironment,addCustomAdversary:m.addCustomAdversary,updateCustomAdversary:m.updateCustomAdversary,deleteCustomAdversary:m.deleteCustomAdversary};return t.jsx(Jt.Provider,{value:n,children:e})},pt=()=>{const e=f.useContext(Jt);if(!e)return console.warn("useGameState: Context not available yet, returning defaults"),{isLoaded:!1,fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],customContent:{adversaries:[],environments:[]},updateFear:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},addCustomAdversary:()=>{},updateCustomAdversary:()=>{},deleteCustomAdversary:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{gameState:a,customContent:o,...i}=e;if(!a)return console.warn("useGameState: gameState not available, returning defaults"),{isLoaded:e.isLoaded||!1,fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],customContent:{adversaries:[],environments:[]},updateFear:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},addCustomAdversary:()=>{},updateCustomAdversary:()=>{},deleteCustomAdversary:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{fear:l,countdowns:d,adversaries:c,environments:u,partySize:p,savedEncounters:x}=a;return{gameState:a,isLoaded:e.isLoaded,fear:l,countdowns:d,adversaries:c,environments:u,partySize:p,savedEncounters:x,customContent:o,...i,hasCountdowns:d.length>0,hasAdversaries:c.length>0,hasEnvironments:u.length>0,getCountdownById:m=>d.find(r=>r.id===m),getAdversaryById:m=>c.find(r=>r.id===m),getEnvironmentById:m=>u.find(r=>r.id===m)}},Se=12,ot=48,Tr=()=>t.jsx("div",{className:"pwa-install-prompt",style:{}}),wt=({tabContent:e,children:a,containerStyle:o={},tabStyle:i={},showTab:l=!0,tabBackgroundColor:d="var(--bg-primary)",tabBorderColor:c="var(--border)",tabJustifyContent:u="center",containerBackgroundColor:p,containerBorderColor:x,containerBorderRadius:m="8px",containerBoxShadow:r,containerOverflow:n="hidden",reserveTabSpace:s=!1,style:h={},...w})=>{const S={display:"flex",flexDirection:"column",position:"relative",height:"100%",width:"100%",borderRadius:m,overflow:n};p&&(S.backgroundColor=p),x&&(S.border=`2px solid ${x}`),r&&(S.boxShadow=r);const O={position:"relative",overflow:"visible",height:"100%",width:"100%",display:"flex",flexDirection:"column",boxSizing:"border-box"},W=s?"0":`-${ot}px`,K=s&&l&&e?`${ot}px`:"0";return t.jsxs("div",{style:{...O,...h},...w,children:[l&&e&&t.jsx("div",{style:{position:"absolute",top:W,left:"7px",right:"7px",width:"calc(100% - 14px)",display:"flex",alignItems:"center",gap:"0.5rem",justifyContent:u,flexShrink:0,zIndex:0,padding:"0.5rem 0.75rem",paddingBottom:"calc(0.5rem + 4px)",minHeight:`${ot}px`,backgroundColor:d,border:`1.5px solid ${c}`,borderBottom:"none",borderRadius:"8px 8px 0 0",boxSizing:"border-box",marginBottom:"-4px",...i},children:e}),t.jsx("div",{style:{...S,...o,zIndex:1,marginTop:K},children:a})]})},Mr="modulepreload",Nr=function(e){return"/Daggerheart/"+e},Wt={},Ge=function(a,o,i){if(!o||o.length===0)return a();const l=document.getElementsByTagName("link");return Promise.all(o.map(d=>{if(d=Nr(d),d in Wt)return;Wt[d]=!0;const c=d.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(!!i)for(let m=l.length-1;m>=0;m--){const r=l[m];if(r.href===d&&(!c||r.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${u}`))return;const x=document.createElement("link");if(x.rel=c?"stylesheet":Mr,c||(x.as="script",x.crossOrigin=""),x.href=d,document.head.appendChild(x),c)return new Promise((m,r)=>{x.addEventListener("load",m),x.addEventListener("error",()=>r(new Error(`Unable to preload CSS for ${d}`)))})})).then(()=>a()).catch(d=>{const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=d,window.dispatchEvent(c),!c.defaultPrevented)throw d})},Bt={Minion:{difficulty:e=>[9,12,15,18][e-1],thresholds:e=>({major:0,severe:0}),hpMax:e=>1,stressMax:e=>1,atk:e=>[-1,0,1,2][e-1],damage:e=>["2","5","8","11"][e-1],range:"Melee"},Standard:{difficulty:e=>[11,14,17,20][e-1],thresholds:e=>({major:[7,10,20,25][e-1],severe:[12,20,32,45][e-1]}),hpMax:e=>[4,5,6,7][e-1],stressMax:e=>[3,3,4,4][e-1],atk:e=>[1,2,3,4][e-1],damage:e=>["1d8+1","2d8+2","3d8+3","4d8+4"][e-1],range:"Melee"},Bruiser:{difficulty:e=>[11,14,17,20][e-1],thresholds:e=>({major:[8,14,22,38][e-1],severe:[15,28,40,70][e-1]}),hpMax:e=>[6,7,8,9][e-1],stressMax:e=>[4,4,5,5][e-1],atk:e=>[-1,0,1,2][e-1],damage:e=>["1d12+2","2d12+4","3d12+6","4d12+8"][e-1],range:"Melee"},Horde:{difficulty:e=>[10,13,16,19][e-1],thresholds:e=>({major:[7,10,20,25][e-1],severe:[12,20,32,45][e-1]}),hpMax:e=>[5,6,7,8][e-1],stressMax:e=>[3,3,4,4][e-1],atk:e=>[-1,0,1,2][e-1],damage:e=>["1d8+2","2d8+4","3d8+6","4d8+8"][e-1],range:"Melee"},Leader:{difficulty:e=>[11,14,17,20][e-1],thresholds:e=>({major:[7,13,21,35][e-1],severe:[14,26,38,65][e-1]}),hpMax:e=>[5,6,7,8][e-1],stressMax:e=>[5,5,6,6][e-1],atk:e=>[2,4,6,8][e-1],damage:e=>["1d10+2","2d10+4","3d10+6","4d10+8"][e-1],range:"Melee"},Ranged:{difficulty:e=>[10,13,16,19][e-1],thresholds:e=>({major:[4,8,18,22][e-1],severe:[7,16,30,42][e-1]}),hpMax:e=>[3,4,5,6][e-1],stressMax:e=>[3,3,4,4][e-1],atk:e=>[2,3,4,5][e-1],damage:e=>["1d8+2","2d8+4","3d8+6","4d8+8"][e-1],range:"Close"},Skulk:{difficulty:e=>[12,15,18,21][e-1],thresholds:e=>({major:[5,9,19,23][e-1],severe:[10,18,31,43][e-1]}),hpMax:e=>[4,5,6,7][e-1],stressMax:e=>[3,3,4,4][e-1],atk:e=>[2,3,4,5][e-1],damage:e=>["1d6+2","2d6+4","3d6+6","4d6+8"][e-1],range:"Melee"},Solo:{difficulty:e=>[12,15,18,21][e-1],thresholds:e=>({major:[7,13,21,35][e-1],severe:[14,26,38,65][e-1]}),hpMax:e=>[8,9,10,11][e-1],stressMax:e=>[5,5,6,6][e-1],atk:e=>[3,5,7,9][e-1],damage:e=>["1d10+3","2d10+6","3d10+9","4d10+12"][e-1],range:"Melee"},Support:{difficulty:e=>[11,14,17,20][e-1],thresholds:e=>({major:[5,9,19,23][e-1],severe:[10,18,31,43][e-1]}),hpMax:e=>[4,4,5,5][e-1],stressMax:e=>[4,4,5,5][e-1],atk:e=>[2,3,4,5][e-1],damage:e=>["1d4+2","2d4+4","3d4+6","4d4+8"][e-1],range:"Melee"},Social:{difficulty:e=>[11,14,17,20][e-1],thresholds:e=>({major:[5,9,19,23][e-1],severe:[10,18,31,43][e-1]}),hpMax:e=>[4,4,5,5][e-1],stressMax:e=>[4,4,5,5][e-1],atk:e=>[2,3,4,5][e-1],damage:e=>["1d4+2","2d4+4","3d4+6","4d4+8"][e-1],range:"Melee"}},Ue=(e,a)=>{const o=Bt[a]||Bt.Standard;return{difficulty:o.difficulty(e),thresholds:o.thresholds(e),hpMax:o.hpMax(e),stressMax:o.stressMax(e),atk:o.atk(e),damage:o.damage(e),range:o.range}};let Yt={adversaries:[]},Lt=!1;const zr=()=>({customAdversaries:JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]")}),Wr=async()=>{if(Lt)return;let e={adversaries:[]},a={adversaries:[]};try{const i=await Ge(()=>import("./adversaries-9c8932de.js"),[]);e=(i==null?void 0:i.default)||i}catch(i){console.warn("Failed to load adversaries.json:",i)}try{const i=await Ge(()=>import("./playtest-adversaries-4a099c10.js"),[]);a=(i==null?void 0:i.default)||i}catch(i){console.warn("Failed to load playtest-adversaries.json:",i)}const{customAdversaries:o}=zr();Yt={...e,adversaries:[...e.adversaries||[],...a.adversaries||[],...o]},Lt=!0},jt=f.forwardRef(({onSave:e,onRefresh:a,onAddItem:o,editingAdversary:i,onCancelEdit:l,isStockAdversary:d=!1,autoFocus:c=!1,allAdversaries:u=[],embedded:p=!1,hideEmbeddedButtons:x=!1},m)=>{const r=f.useRef(null),n=f.useRef(null),[s,h]=f.useState(()=>{const j=Ue(1,"Standard");return{name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:j.difficulty,thresholds:j.thresholds,hpMax:j.hpMax,stressMax:j.stressMax,atk:j.atk,weapon:"",range:j.range,damage:j.damage,experience:[],features:[]}}),[w,S]=f.useState(!1),[O,W]=f.useState(!1),[K,F]=f.useState([]),[_,L]=f.useState(!1),[D,E]=f.useState([]);f.useEffect(()=>{(async()=>{await Wr(),u.length>0?E(u):E(Yt.adversaries||[])})()},[u]),f.useEffect(()=>{c&&setTimeout(()=>{var j,v,C;i&&n.current?((j=n.current)==null||j.focus(),(v=n.current)==null||v.select()):r.current&&((C=r.current)==null||C.focus())},650)},[c,i]),f.useEffect(()=>{var j;if(i){const v=i.baseName||((j=i.name)==null?void 0:j.replace(/\s+\(\d+\)$/,""))||i.name||"";h({name:v,tier:i.tier||1,type:i.type||"Standard",description:i.description||"",motives:i.motives||"",difficulty:i.difficulty||11,thresholds:i.thresholds||{major:7,severe:12},hpMax:i.hpMax||3,stressMax:i.stressMax||1,atk:i.atk||1,weapon:i.weapon||"",range:i.range||"Melee",damage:i.damage||"",experience:i.experience||[],features:i.features||[]}),W(!1)}else{const v=Ue(1,"Standard");h({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:v.difficulty,thresholds:v.thresholds,hpMax:v.hpMax,stressMax:v.stressMax,atk:v.atk,weapon:"",range:v.range,damage:v.damage,experience:[],features:[]}),W(!1)}},[i]),f.useEffect(()=>{if(!i&&!O){const j=Ue(s.tier,s.type);h(v=>({...v,difficulty:j.difficulty,thresholds:j.thresholds,hpMax:j.hpMax,stressMax:j.stressMax,atk:j.atk,range:j.range,damage:j.damage}))}},[s.tier,s.type,i,O]);const y=j=>{if(h(v=>({...v,name:j})),j.trim().length>0){const v=D.filter(C=>{var b;return(((b=C.name)==null?void 0:b.replace(/\s+\(\d+\)$/,""))||C.name||"").toLowerCase().includes(j.toLowerCase())}).slice(0,5);F(v),L(v.length>0)}else F([]),L(!1)},H=async()=>{if(!s.name.trim()){alert("Please enter a name for the adversary");return}S(!0);try{const j=b=>(b||[]).filter(T=>T.name&&T.name.trim()!==""||T.modifier!==void 0&&T.modifier!==0),v=s.name.trim()||"Unknown",C=j(s.experience||[]),q={...s,experience:C,baseName:v,name:v,hp:i?i.hp:0,stress:i?i.stress:0,source:"Homebrew"};if(i){if(d){const{id:b,name:T,...k}=q;await e(k),alert("Custom adversary created successfully!")}else{const b={...q,name:q.baseName};await e(b,i.id),alert("Adversary updated successfully!")}l&&l()}else{await e(q),a&&await a();const b=Ue(1,"Standard");h({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:b.difficulty,thresholds:b.thresholds,hpMax:b.hpMax,stressMax:b.stressMax,atk:b.atk,weapon:"",range:b.range,damage:b.damage,experience:[],features:[]}),W(!1),alert("Custom adversary created successfully!")}}catch(j){console.error("Error saving adversary:",j),alert("Error saving adversary. Please try again.")}finally{S(!1)}};f.useImperativeHandle(m,()=>({handleSave:H,isSaving:w,canSave:s.name.trim().length>0}));const Q={...s,id:"new-adversary",hp:0,stress:0,source:"Homebrew"},R=()=>w?i?d?"Creating...":"Saving...":"Creating...":i?d?"Save As Custom":"Save":"Create";return t.jsxs(t.Fragment,{children:[!p&&t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[t.jsx("h2",{style:{color:"var(--text-primary)",fontSize:"1.5rem",fontWeight:"600",margin:0},children:i?d?"Edit Adversary (Save As Custom)":"Edit Custom Adversary":"Create Custom Adversary"}),t.jsx("button",{onClick:H,disabled:w||!s.name.trim(),style:{padding:"0.75rem 1.5rem",backgroundColor:w||!s.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"8px",cursor:w||!s.name.trim()?"not-allowed":"pointer",fontSize:"1rem",fontWeight:"600",opacity:w||!s.name.trim()?.6:1},children:R()})]}),p&&!x&&t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",marginBottom:"0.5rem",padding:"0.5rem",borderBottom:"1px solid var(--border)"},children:[t.jsx("button",{onClick:H,disabled:w||!s.name.trim(),style:{padding:"0.5rem 1rem",backgroundColor:w||!s.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"6px",cursor:w||!s.name.trim()?"not-allowed":"pointer",fontSize:"0.875rem",fontWeight:"600",opacity:w||!s.name.trim()?.6:1,marginRight:"0.5rem"},children:R()}),l&&t.jsx("button",{onClick:l,style:{padding:"0.5rem 1rem",backgroundColor:"transparent",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"6px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600"},children:"Cancel"})]}),!i&&t.jsxs("div",{style:{marginBottom:"1rem",position:"relative"},children:[t.jsx("input",{ref:r,type:"text",value:s.name,onChange:j=>{const v=j.target.value;h(C=>({...C,name:v})),y(v)},placeholder:"Adversary name",style:{width:"100%",padding:"0.75rem",border:"1px solid var(--border)",borderRadius:"8px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"1rem",outline:"none"}}),_&&K.length>0&&t.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"0 0 8px 8px",borderTop:"none",maxHeight:"200px",overflowY:"auto",zIndex:1e3,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)"},children:K.map((j,v)=>{var q;const C=j.baseName||((q=j.name)==null?void 0:q.replace(/\s+\(\d+\)$/,""))||j.name;return t.jsxs("div",{onClick:()=>{h(b=>({...b,name:C,tier:j.tier||b.tier,type:j.type||b.type,difficulty:j.difficulty||b.difficulty,thresholds:j.thresholds||b.thresholds,hpMax:j.hpMax||b.hpMax,stressMax:j.stressMax||b.stressMax,atk:j.atk||b.atk,range:j.range||b.range,damage:j.damage||b.damage})),L(!1),W(!0),r.current&&r.current.blur()},style:{padding:"0.75rem",cursor:"pointer",borderBottom:v<K.length-1?"1px solid var(--border)":"none",transition:"background-color 0.2s"},onMouseEnter:b=>{b.target.style.backgroundColor="var(--bg-secondary)"},onMouseLeave:b=>{b.target.style.backgroundColor="transparent"},onMouseDown:b=>b.preventDefault(),children:[t.jsx("div",{style:{fontWeight:"600"},children:C}),t.jsxs("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",marginTop:"2px"},children:[j.type," • Tier ",j.tier]})]},v)})})]}),t.jsx(ct,{item:Q,type:"adversary",mode:"edit",nameInputRef:i?n:void 0,autoFocusNameInput:c&&i,onUpdate:(j,v)=>{h(C=>({...C,...v}))}})]})});jt.displayName="CustomAdversaryCreator";const Br=({feature:e,featureType:a,item:o,onUpdate:i,handleFeatureDeleteClick:l,deleteConfirmations:d,getFeatureKey:c})=>{const u=()=>(o.features||[]).filter(r=>r.type===a),p=r=>r.type===a&&r.name.trim(),x=r=>{try{const s=[...(o==null?void 0:o.features)||[]],h=u(),w=h.findIndex(S=>S===e);if(r==="up"&&w>0){const S=h[w],O=h[w-1];m(s,S,O)}else if(r==="down"&&w<h.length-1&&w>=0){const S=h[w],O=h[w+1];m(s,S,O)}}catch(n){console.error(`Error in ${a.toLowerCase()} ${r} button:`,n)}},m=(r,n,s)=>{if(!n||!s)return;const h=r.findIndex(S=>S===n),w=r.findIndex(S=>S===s);h>=0&&w>=0&&(r[h]=s,r[w]=n,i&&i(o.id,{features:r}))};return t.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",alignSelf:"stretch"},children:[t.jsx("button",{onClick:()=>x("up"),disabled:u().findIndex(r=>r===e)===0,tabIndex:"-1",style:{width:"22px",height:"22px",padding:0,border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:p(e)&&u().findIndex(r=>r===e)!==0&&e.name.trim()?"white":"var(--text-secondary)",cursor:p(e)&&u().findIndex(r=>r===e)!==0&&e.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↑"}),t.jsx("button",{onClick:()=>l(e),disabled:!e.name.trim()&&!e.description.trim(),style:{width:"22px",height:"22px",padding:0,border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:d[c(e)]?"var(--danger)":"var(--gray-700)",color:!e.name.trim()&&!e.description.trim()?"var(--text-secondary)":"white",cursor:!e.name.trim()&&!e.description.trim()?"not-allowed":"pointer",opacity:!e.name.trim()&&!e.description.trim()?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"×"}),t.jsx("button",{onClick:()=>x("down"),disabled:u().findIndex(r=>r===e)===u().length-1,style:{width:"22px",height:"22px",padding:0,border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:p(e)&&u().findIndex(r=>r===e)<u().length-1&&e.name.trim()?"white":"var(--text-secondary)",cursor:p(e)&&u().findIndex(r=>r===e)<u().length-1&&e.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↓"})]})},Rt=({title:e})=>t.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[t.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),t.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:e})]}),Lr=({item:e,isEditMode:a,onUpdate:o,handleFeatureDeleteClick:i,deleteConfirmations:l,getFeatureKey:d})=>{if(!(e.features&&e.features.length>0||a))return null;const c=(m,r,n)=>t.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[t.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[t.jsx("input",{type:"text",value:m.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false","data-lpignore":"true","data-form-type":"other",name:`feature-name-${n.toLowerCase()}`,onChange:s=>{const h=[...e.features||[]],w=h.findIndex(W=>W.type===n&&W===m);w>=0?h[w]={...h[w],name:s.target.value}:h.push({type:n,name:s.target.value,description:m.description||""});const S=h.filter(W=>W.type===n),O=S[S.length-1];O&&O.name.trim()&&h.push({type:n,name:"",description:""}),o&&o(e.id,{features:h})},placeholder:`${r} name`,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),t.jsx("textarea",{value:m.description||"",onChange:s=>{const h=[...e.features||[]],w=h.findIndex(W=>W.type===n&&W===m);w>=0?h[w]={...h[w],description:s.target.value}:h.push({type:n,name:m.name||"",description:s.target.value});const S=h.filter(W=>W.type===n),O=S[S.length-1];O&&O.name.trim()&&h.push({type:n,name:"",description:""}),o&&o(e.id,{features:h})},placeholder:`${r} description`,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",minHeight:"4.5rem",resize:"vertical"}})]}),t.jsx(Br,{feature:m,featureType:n,item:e,onUpdate:o,handleFeatureDeleteClick:i,deleteConfirmations:l,getFeatureKey:d})]},m.id||`${n}-${m.name}-${m.description}-${Math.random()}`),u=(m,r)=>t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginTop:"0.75rem"},children:m.map((n,s)=>t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[t.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:t.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",fontSize:"0.9rem"},children:n.name})}),t.jsx("div",{style:{fontSize:"0.85rem",lineHeight:1.4,color:"var(--text-secondary)"},children:n.description||r})]},`${n.type}-${s}`))}),p=(m,r)=>{const n=(e.features||[]).filter(w=>w.type===m);if(!(n.length>0)&&!a)return null;const h=a&&n.length===0?[{type:m,name:"",description:""}]:n;return t.jsxs("div",{children:[t.jsx(Rt,{title:r}),t.jsx("div",{style:{display:"flex",flexDirection:"column"},children:a?h.map(w=>c(w,r.slice(0,-1),m)):u(h,`Describe the ${r.toLowerCase()}`)})]})},x=()=>e.atk!==void 0&&e.weapon||a?t.jsxs("div",{children:[t.jsx(Rt,{title:"Standard Attack"}),t.jsx("div",{style:{display:"flex",flexDirection:"column"},children:a?t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",marginTop:"0.75rem",marginBottom:"0.75rem"},children:t.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[t.jsx("input",{type:"text",value:e.weapon||"",onChange:m=>o&&o(e.id,{weapon:m.target.value}),placeholder:"Standard attack name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}}),t.jsxs("select",{value:e.range||"",onChange:m=>o&&o(e.id,{range:m.target.value}),style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",appearance:"none",backgroundImage:`url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",backgroundSize:"1rem",paddingRight:"2rem"},children:[t.jsx("option",{value:""}),t.jsx("option",{value:"Melee",children:"Melee"}),t.jsx("option",{value:"Very Close",children:"Very Close"}),t.jsx("option",{value:"Close",children:"Close"}),t.jsx("option",{value:"Far",children:"Far"}),t.jsx("option",{value:"Very Far",children:"Very Far"})]}),t.jsx("input",{type:"text",value:e.damage||"",onChange:m=>o&&o(e.id,{damage:m.target.value}),placeholder:"Damage (e.g., 1d6+2)",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}})]})}):e.atk!==void 0&&e.weapon&&t.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[t.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:e.weapon}),t.jsxs("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:["Make an attack against a target within ",e.range||"Melee"," range. On a success, deal ",e.damage||"damage varies","."]})]})})]}):null;return t.jsxs("div",{style:{padding:"0 8px 8px 8px"},children:[x(),p("Action","Actions"),p("Passive","Passives"),p("Reaction","Reactions")]})},Rr=({item:e,isEditMode:a,onUpdate:o})=>a||e.atk!==void 0&&e.weapon?t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[t.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),t.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Standard Attack"})]}),t.jsx("div",{style:{display:"flex",flexDirection:"column"},children:a?t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",marginTop:"0.75rem",marginBottom:"0.75rem"},children:t.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[t.jsx("input",{type:"text",value:e.weapon||"",onChange:l=>o&&o(e.id,{weapon:l.target.value}),placeholder:"Standard attack name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}}),t.jsxs("select",{value:e.range||"",onChange:l=>o&&o(e.id,{range:l.target.value}),style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",appearance:"none",backgroundImage:`url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",backgroundSize:"1rem",paddingRight:"2rem"},children:[t.jsx("option",{value:""}),t.jsx("option",{value:"Melee",children:"Melee"}),t.jsx("option",{value:"Very Close",children:"Very Close"}),t.jsx("option",{value:"Close",children:"Close"}),t.jsx("option",{value:"Far",children:"Far"}),t.jsx("option",{value:"Very Far",children:"Very Far"})]}),t.jsx("input",{type:"text",value:e.damage||"",onChange:l=>o&&o(e.id,{damage:l.target.value}),placeholder:"Damage (e.g., 1d6+2)",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}})]})}):t.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[t.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:e.weapon}),t.jsxs("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:["Make an attack against a target within ",e.range||"Melee"," range. On a success, deal"," ",e.damage||"damage varies","."]})]})})]}):null,Ft={fear:{icon:ir,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"0.125rem",maxWidth:"none"},pipStyle:{fontSize:"var(--text-lg)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0,imageRendering:"crisp-edges"},filledColor:"var(--purple)",emptyColor:"var(--gray-dark)",tooltipTitle:"Click anywhere in header to adjust fear:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease fear by 1"},{text:"Right of boundary:",description:"Click to increase fear by 1"}]},hp:{icon:lr,maxValue:20,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stress:{icon:dr,maxValue:12,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},countdown:{icon:It,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust countdown:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease countdown by 1"},{text:"Right of boundary:",description:"Click to increase countdown by 1"}]},hpDots:{maxValue:20,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--red)",borderColor:"var(--red)",boxShadow:"0 0 4px rgba(239, 68, 68, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stressDots:{maxValue:12,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--purple)",borderColor:"var(--purple)",boxShadow:"0 0 4px rgba(139, 92, 246, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},adversaryHP:{icon:cr,maxValue:20,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust HP:",tooltipInstructions:[{text:"Filled pip:",description:"Click to heal (reduce damage)"},{text:"Empty pip:",description:"Click to take damage"}]},adversaryStress:{icon:ur,maxValue:12,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust stress:",tooltipInstructions:[{text:"Filled pip:",description:"Click to reduce stress"},{text:"Empty pip:",description:"Click to increase stress"}]},countdownDistributed:{icon:It,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Countdown progress:",tooltipInstructions:[{text:"Progress:",description:"Current countdown value"}]}},dt=({type:e="fear",value:a=0,maxValue:o,onChange:i,size:l="lg",showTooltip:d=!0,containerStyle:c={},pipStyle:u={},countdownType:p=null,distributedGroups:x=null,onPipClick:m=null,enableBoundaryClick:r=!1,clickContainerWidth:n="auto",centerPips:s=!0})=>{const[h,w]=f.useState(!1),S=Ft[e]||Ft.fear,O=o||S.maxValue,W=Math.max(0,Math.min(O,a));let K=S.filledColor;e==="countdown"&&p&&(["progress","dynamic-progress","simple-hope"].includes(p)?K="var(--gold)":["consequence","dynamic-consequence","simple-fear"].includes(p)?K="var(--purple)":["long-term","standard"].includes(p)&&(K="var(--text-secondary)"));const F=(y,H)=>{if(m)m(y,H);else if(i){const Q=y+1;i(Q)}},_=y=>{if(!r||!i||m)return;y.currentTarget.getBoundingClientRect();const H=y.currentTarget.querySelector(".pip-container");if(!H)return;const Q=H.getBoundingClientRect(),R=y.clientX-Q.left;if(R<0){W>0&&i(W-1);return}if(R>Q.width){W<O&&i(W+1);return}const j=Q.width,v=j*.05,C=j-2*v,q=R-v,b=W/O,T=C*b;q<T?W>0&&i(W-1):W<O&&i(W+1)},D=(()=>{if(!x||e!=="countdownDistributed")return[{start:0,end:O,groupIndex:0}];let y=0;return x.map((H,Q)=>{const R={start:y,end:y+H,groupIndex:Q};return y+=H,R})})(),E=()=>t.jsxs(t.Fragment,{children:[D.map(y=>t.jsx(_e.Fragment,{children:[...Array(y.end-y.start)].map((H,Q)=>{const R=y.start+Q,j=R<W;if(S.isDots)return t.jsx("div",{style:{...S.pipStyle,...j?S.filledStyle:S.emptyStyle,...u,cursor:i||m?"pointer":"default"},onClick:r?void 0:()=>F(R,j),title:`${R+1} of ${O}`},R);{const v=S.icon,C=v&&typeof v=="object"&&v.iconName,q=j?K:S.emptyColor;return t.jsx("span",{className:`fear-pip ${j?"filled":"empty"}`,style:{...S.pipStyle,color:q,cursor:i||m?"pointer":"default",...u},onClick:r?void 0:()=>F(R,j),title:`${R+1} of ${O}`,children:C?t.jsx(ar,{icon:v,size:l}):t.jsx(v,{size:l==="lg"?18:16})},R)}})},y.groupIndex)),d&&t.jsx("div",{style:{position:"relative",cursor:"help",pointerEvents:"none"},children:t.jsxs("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:h?"translateX(-50%) translateY(-5px)":"translateX(-50%)",background:"rgba(15, 23, 42, 0.95)",border:"1px solid var(--gray)",borderRadius:"var(--radius-md)",padding:"var(--space-md)",minWidth:"250px",zIndex:1e3,opacity:h?1:0,visibility:h?"visible":"hidden",transition:"all 0.2s ease",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.5)"},children:[t.jsx("div",{style:{fontWeight:600,color:"var(--gray-200)",marginBottom:"0.75rem",fontSize:"var(--text-sm)"},children:S.tooltipTitle}),S.tooltipInstructions.map((y,H)=>t.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.8rem",color:"var(--gray-300)",lineHeight:1.4},children:[t.jsx("strong",{style:{color:"var(--gray-200)"},children:y.text})," ",y.description]},H))]})})]});return t.jsx("div",{style:{width:n,height:"100%",cursor:i||m?"pointer":"default",touchAction:"manipulation",userSelect:"none",display:s?"flex":"block",alignItems:s?"center":"stretch",justifyContent:s?"center":"flex-start",...c},onClick:y=>{y.stopPropagation(),y.preventDefault(),r&&_(y)},onMouseEnter:()=>w(d),onMouseLeave:()=>w(!1),children:t.jsx("div",{className:"pip-container",style:{...S.containerStyle,width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},children:E()})})},Dt=({value:e})=>t.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"44px",height:"32px",zIndex:3},children:[t.jsx("svg",{width:"40",height:"32",viewBox:"0 0 40 32",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",style:{position:"absolute",zIndex:1},children:t.jsx("path",{d:"M2 2h28l6 14-6 14H2l6-14-6-14z"})}),t.jsx("span",{style:{position:"absolute",fontSize:"0.8rem",fontWeight:500,color:"var(--text-primary)",textAlign:"center",zIndex:2,left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:e})]}),Fr=({item:e,instances:a=[],isEditMode:o,type:i,onUpdate:l,onApplyDamage:d,onApplyHealing:c,onApplyStressChange:u})=>{if(!(a&&a.length>0||e.type!=="Minion"&&(e.thresholds||o)))return null;const x=r=>{const n=(r.hp||0)>=(r.hpMax||1);return t.jsx("div",{"data-instance-id":r.id,style:{marginBottom:"0.5rem"},children:t.jsxs("div",{style:{backgroundColor:n?"var(--gray-900)":"var(--bg-primary)",borderRadius:"6px",padding:"0.25rem 0.5rem",border:"1px solid",borderColor:n?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",display:"flex",justifyContent:"flex-start",alignItems:"center",gap:"0.5rem",opacity:n?.7:1,position:"relative",transition:"all 0.2s ease",minHeight:"40px"},children:[n&&t.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                          45deg,
                          transparent 0px,
                          transparent 8px,
                          var(--gray-600) 9px,
                          var(--gray-600) 9px
                        )`,pointerEvents:"none",zIndex:1,borderRadius:"4px"}}),t.jsx("div",{style:{backgroundColor:n?"var(--gray-900)":"var(--bg-card)",border:"1px solid",borderColor:n?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",borderRadius:"50%",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",flexShrink:0,opacity:n?.5:1},children:t.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:n?"var(--gray-400)":"var(--text-primary)"},children:r.duplicateNumber||1})}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.125rem"},children:[t.jsx("div",{style:{opacity:n?.3:1},children:t.jsx(dt,{type:"adversaryHP",value:r.hp||0,maxValue:r.hpMax||1,onPipClick:(s,h)=>{if(d&&i==="adversary"){const w=r.hp||0,S=r.hpMax||1;h?c==null||c(r.id,1,w):w<S&&d(r.id,1,w,S)}},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})}),r.stressMax>0&&t.jsx("div",{style:{opacity:n?.3:1},children:t.jsx(dt,{type:"adversaryStress",value:r.stress||0,maxValue:r.stressMax,onPipClick:(s,h)=>{u&&i==="adversary"&&u(r.id,h?-1:1)},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})})]})]})},r.id)},m=()=>{var r,n,s,h;return e.type==="Minion"||!e.thresholds&&!o?null:t.jsx("div",{style:{display:"flex",justifyContent:"center",paddingTop:"1px",marginTop:"0.5rem",marginBottom:"0.5rem"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",position:"relative"},children:[t.jsx("svg",{width:"300",height:"36",viewBox:"0 0 300 36",style:{position:"absolute",zIndex:1},children:t.jsx("rect",{x:"20",y:"6",width:"260",height:"24",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4"})}),t.jsx("div",{style:{position:"relative",zIndex:2,display:"flex",alignItems:"center",gap:"0.5rem"},children:o?t.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",fontSize:"0.8rem"},children:[t.jsx(Ht,{label:"Minor",value:(r=e.thresholds)==null?void 0:r.major,onChange:w=>Ot("major",w,l,e)}),t.jsx(Ht,{label:"Major",value:(n=e.thresholds)==null?void 0:n.severe,onChange:w=>Ot("severe",w,l,e)})]}):t.jsxs(t.Fragment,{children:[t.jsx(st,{text:"Minor"}),t.jsx(Dt,{value:((s=e.thresholds)==null?void 0:s.major)||7}),t.jsx(st,{text:"Major"}),t.jsx(Dt,{value:((h=e.thresholds)==null?void 0:h.severe)||14}),t.jsx(st,{text:"Severe"})]})})]})})};return t.jsxs("div",{style:{padding:"0 8px"},children:[t.jsx(Dr,{title:"Status"}),o?t.jsx(Pr,{item:e,onUpdate:l}):a.map(r=>x(r)),m()]})},Dr=({title:e})=>t.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"0.25rem"},children:[t.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),t.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:e})]}),Pr=({item:e,onUpdate:a})=>t.jsx("div",{style:{marginBottom:"0.5rem"},children:t.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border)"},children:t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[t.jsx(Pt,{label:"HP",pipType:"adversaryHP",value:e.hpMax||"",onChange:o=>a&&a(e.id,{hpMax:o})}),t.jsx(Pt,{label:"Stress",pipType:"adversaryStress",value:e.stressMax||"",onChange:o=>a&&a(e.id,{stressMax:o})})]})})}),Pt=({label:e,pipType:a,value:o,onChange:i})=>t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("input",{type:"number",value:o,onChange:l=>{const d=parseInt(l.target.value)||1;i(d)},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),t.jsx(dt,{type:a,value:0,maxValue:o||1,showTooltip:!1}),t.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:e})]}),st=({text:e})=>t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:e}),Ht=({label:e,value:a,onChange:o})=>t.jsxs(t.Fragment,{children:[t.jsx(st,{text:e}),t.jsx("input",{type:"number",min:"1",max:"99",value:a||"",onChange:i=>{const l=i.target.value;(l===""||parseInt(l)>=1&&parseInt(l)<=99)&&o(l===""?null:parseInt(l))},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}})]}),Ot=(e,a,o,i)=>{o&&o(i.id,{thresholds:{...i.thresholds,[e]:a}})},Hr=({item:e,isEditMode:a,mode:o,onUpdate:i})=>a||o==="expanded"&&e.description&&e.description.trim()?t.jsxs("div",{style:{padding:"0 8px",textAlign:"center"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[t.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),t.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Description"})]}),a?t.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-primary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"none",overflow:"hidden",fontFamily:"inherit",marginTop:"0.75rem",marginBottom:"0.75rem"},value:e.description,onChange:d=>{d.target.style.height="auto",d.target.style.height=d.target.scrollHeight+"px",i&&i(e.id,{description:d.target.value})},placeholder:"Description..."}):t.jsx("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,whiteSpace:"pre-wrap",padding:"0.5rem 0"},children:e.description})]}):null,Or=({type:e,tier:a,isEditMode:o,onUpdate:i,itemId:l})=>{const c=(r=>{if(!r)return 0;const s=document.createElement("canvas").getContext("2d");return s.font="600 11px system-ui, -apple-system, sans-serif",s.measureText(r.toUpperCase()).width})(e),u=4,p=18,x=Math.max(50,c+u+p),m=x+15;return o?t.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",gap:"8px",height:"32px"},children:[t.jsxs("select",{value:e||"",onChange:r=>{i&&i(l,{type:r.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",outline:"none",borderRadius:"4px",padding:"4px 8px",width:"95px",height:"24px"},children:[t.jsx("option",{value:"Standard",children:"Standard"}),t.jsx("option",{value:"Solo",children:"Solo"}),t.jsx("option",{value:"Bruiser",children:"Bruiser"}),t.jsx("option",{value:"Horde",children:"Horde"}),t.jsx("option",{value:"Minion",children:"Minion"}),t.jsx("option",{value:"Ranged",children:"Ranged"}),t.jsx("option",{value:"Leader",children:"Leader"}),t.jsx("option",{value:"Skulk",children:"Skulk"}),t.jsx("option",{value:"Social",children:"Social"}),t.jsx("option",{value:"Support",children:"Support"})]}),t.jsxs("div",{style:{position:"relative",width:"24px",height:"24px"},children:[t.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",width:"20px",height:"20px",backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",borderRadius:"2px"}}),t.jsx("input",{type:"text",value:a||"",onChange:r=>{const n=r.target.value.replace(/[^1-4]/g,"");n.length<=1&&i&&i(l,{tier:n===""?"":parseInt(n)})},onKeyDown:r=>{if(r.key==="ArrowUp"){r.preventDefault();const n=parseInt(a)||1;i&&i(l,{tier:Math.min(n+1,4)})}else if(r.key==="ArrowDown"){r.preventDefault();const n=parseInt(a)||1;i&&i(l,{tier:Math.max(n-1,1)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"transparent",border:"none",color:"var(--text-primary)",fontSize:"0.8rem",fontWeight:600,width:"24px",height:"24px",textAlign:"center",outline:"none",zIndex:1},maxLength:"1"})]})]}):t.jsxs("div",{style:{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"center",height:"32px",width:`${m}px`},children:[t.jsxs("svg",{width:m,height:"32",viewBox:`0 0 ${m} 32`,style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1},children:[t.jsx("rect",{x:"1",y:"6",width:x-1,height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4",ry:"4"}),t.jsx("rect",{x:x-10,y:"6",width:"20",height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"2",ry:"2",transform:`rotate(45 ${x-1} 16)`})]}),t.jsx("span",{style:{position:"absolute",top:"50%",left:"4px",transform:"translateY(-50%)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",color:"var(--text-primary)",zIndex:2,pointerEvents:"none"},children:e}),t.jsx("span",{style:{position:"absolute",top:"50%",left:`${x-.5}px`,transform:"translate(-50%, -50%)",fontSize:"0.8rem",fontWeight:600,color:"white",zIndex:2,pointerEvents:"none",textAlign:"center",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",width:"20px",height:"20px"},children:a})]})},$r=({item:e,isEditMode:a,onUpdate:o,deleteConfirmations:i,setDeleteConfirmations:l})=>{const d=(m,r)=>`experience-${r}-${typeof m=="string"?m:m.name||"blank"}`,c=m=>Array.isArray(m)?m.filter(r=>{if(typeof r=="string")return r.trim().length>0;const n=r.name||"",s=r.modifier||0;return n.trim().length>0||s>0}):[],u=(m,r)=>{const n=d(m,r);if(i[n]){const s=[...e.experience||[]];s.splice(r,1);const h=c(s);o&&o(e.id,{experience:h}),l(w=>{const S={...w};return delete S[n],S})}else l(s=>({...s,[n]:!0})),setTimeout(()=>{l(s=>{const h={...s};return delete h[n],h})},3e3)},p=()=>{const m=e.experience||[],r=m.length===0?[{name:"",modifier:0}]:m;return t.jsx("div",{style:{display:"flex",flexDirection:"column",marginTop:"-0.25rem"},children:r.map((n,s)=>{var h,w,S,O,W,K,F,_,L,D,E,y,H,Q,R,j,v,C,q,b,T,k,A,V,M,P,re,$,ee,de,fe,ze,ye,Ie,Le;return t.jsxs("div",{style:{position:"relative",marginBottom:"0.5rem"},children:[t.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:t.jsx("input",{type:"text",value:typeof n=="object"&&n.modifier>0?`+${n.modifier}`:"",onChange:te=>{const he=[...e.experience||[]],ce=te.target.value.replace(/[^0-9+-]/g,""),Ee=ce===""||ce==="+"?0:parseInt(ce)||0,je=Math.max(0,Ee);he[s]={name:typeof n=="string"?n:n.name||"",modifier:je};const Me=c(he);o&&o(e.id,{experience:Me})},onKeyDown:te=>{if(te.key==="ArrowUp"||te.key==="ArrowDown"){te.preventDefault();const he=[...e.experience||[]],ce=typeof n=="object"&&n.modifier||0,Ee=te.key==="ArrowUp"?1:-1;he[s]={name:typeof n=="string"?n:n.name||"",modifier:Math.max(0,ce+Ee)};const je=c(he);o&&o(e.id,{experience:je})}},style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)",textAlign:"center",outline:"none"}})}),t.jsxs("div",{style:{marginLeft:"32px",display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("input",{type:"text",value:typeof n=="string"?n:n.name||"",onChange:te=>{var Me;const he=[...e.experience||[]],ce=typeof n=="object"&&n.modifier||0;he[s]={name:te.target.value,modifier:ce};let Ee=c(he);const je=Ee[Ee.length-1];je&&(typeof je=="string"?je.trim():(Me=je.name)!=null&&Me.trim())&&(Ee=[...Ee,{name:"",modifier:0}]),o&&o(e.id,{experience:Ee})},placeholder:"Experience name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),t.jsxs("div",{style:{display:"flex",gap:"0.125rem"},children:[t.jsx("button",{onClick:()=>{var je,Me;const te=[...e.experience||[]],he=typeof n=="string"?n.trim():(je=n.name)==null?void 0:je.trim(),ce=te[s-1],Ee=typeof ce=="string"?ce==null?void 0:ce.trim():(Me=ce==null?void 0:ce.name)==null?void 0:Me.trim();if(s>0&&s<te.length&&he&&Ee){te[s]=ce,te[s-1]=n;const De=c(te);o&&o(e.id,{experience:De})}},disabled:s===0||!(typeof n=="string"?n.trim():(h=n.name)!=null&&h.trim())||!(typeof r[s-1]=="string"?r[s-1].trim():(S=(w=r[s-1])==null?void 0:w.name)!=null&&S.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:s===0||!(typeof n=="string"?n.trim():(O=n.name)!=null&&O.trim())||!(typeof r[s-1]=="string"?r[s-1].trim():(K=(W=r[s-1])==null?void 0:W.name)!=null&&K.trim())?"var(--gray-800)":"var(--gray-700)",color:s===0||!(typeof n=="string"?n.trim():(F=n.name)!=null&&F.trim())||!(typeof r[s-1]=="string"?r[s-1].trim():(L=(_=r[s-1])==null?void 0:_.name)!=null&&L.trim())?"var(--text-secondary)":"white",cursor:s===0||!(typeof n=="string"?n.trim():(D=n.name)!=null&&D.trim())||!(typeof r[s-1]=="string"?r[s-1].trim():(y=(E=r[s-1])==null?void 0:E.name)!=null&&y.trim())?"not-allowed":"pointer",opacity:s===0||!(typeof n=="string"?n.trim():(H=n.name)!=null&&H.trim())||!(typeof r[s-1]=="string"?r[s-1].trim():(R=(Q=r[s-1])==null?void 0:Q.name)!=null&&R.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move up",children:"↑"}),t.jsx("button",{onClick:()=>{var je,Me;const te=[...e.experience||[]],he=typeof n=="string"?n.trim():(je=n.name)==null?void 0:je.trim(),ce=te[s+1],Ee=typeof ce=="string"?ce==null?void 0:ce.trim():(Me=ce==null?void 0:ce.name)==null?void 0:Me.trim();if(s<te.length-1&&s>=0&&he&&Ee){te[s]=ce,te[s+1]=n;const De=c(te);o&&o(e.id,{experience:De})}},disabled:s===r.length-1||!(typeof n=="string"?n.trim():(j=n.name)!=null&&j.trim())||!(typeof r[s+1]=="string"?r[s+1].trim():(C=(v=r[s+1])==null?void 0:v.name)!=null&&C.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:s===r.length-1||!(typeof n=="string"?n.trim():(q=n.name)!=null&&q.trim())||!(typeof r[s+1]=="string"?r[s+1].trim():(T=(b=r[s+1])==null?void 0:b.name)!=null&&T.trim())?"var(--gray-800)":"var(--gray-700)",color:s===r.length-1||!(typeof n=="string"?n.trim():(k=n.name)!=null&&k.trim())||!(typeof r[s+1]=="string"?r[s+1].trim():(V=(A=r[s+1])==null?void 0:A.name)!=null&&V.trim())?"var(--text-secondary)":"white",cursor:s===r.length-1||!(typeof n=="string"?n.trim():(M=n.name)!=null&&M.trim())||!(typeof r[s+1]=="string"?r[s+1].trim():(re=(P=r[s+1])==null?void 0:P.name)!=null&&re.trim())?"not-allowed":"pointer",opacity:s===r.length-1||!(typeof n=="string"?n.trim():($=n.name)!=null&&$.trim())||!(typeof r[s+1]=="string"?r[s+1].trim():(de=(ee=r[s+1])==null?void 0:ee.name)!=null&&de.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move down",children:"↓"}),t.jsx("button",{onClick:()=>u(n,s),disabled:!(typeof n=="string"?n.trim():(fe=n.name)!=null&&fe.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:i[d(n,s)]?"var(--danger)":(typeof n=="string"?n.trim():(ze=n.name)!=null&&ze.trim())?"var(--gray-700)":"var(--gray-800)",color:(typeof n=="string"?n.trim():(ye=n.name)!=null&&ye.trim())?"white":"var(--text-secondary)",cursor:(typeof n=="string"?n.trim():(Ie=n.name)!=null&&Ie.trim())?"pointer":"not-allowed",opacity:(typeof n=="string"?n.trim():(Le=n.name)!=null&&Le.trim())?1:.5,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:i[d(n,s)]?"Click again to confirm delete":"Delete experience",children:"×"})]})]})]},s)})})},x=()=>!e.experience||e.experience.length===0?null:e.experience.map((m,r)=>{if(typeof m=="string"){const n=m.match(/^(.+?)\s*([+-]?\d+)$/);if(n){const[,s,h]=n;return t.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[t.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:t.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:t.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:h})})}),t.jsx("span",{style:{marginLeft:"32px"},children:s})]},r)}return t.jsx("div",{style:{marginBottom:"0.25rem"},children:m},r)}return t.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[t.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:t.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:t.jsxs("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:[m.modifier>=0?"+":"",m.modifier]})})}),t.jsx("span",{style:{marginLeft:"32px"},children:m.name})]},r)});return t.jsx("div",{style:{paddingTop:"0"},children:a?p():t.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:x()})})},gt={background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease"},$t={background:"var(--purple)",border:"1px solid var(--purple)",color:"white",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},qr=({showCustomCreator:e,onSaveCustomAdversary:a,item:o,onCancelEdit:i,onRemoveInstance:l,onAddInstance:d,instances:c,onEdit:u})=>e?t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:p=>{p.stopPropagation(),a&&(a(o,o.id),i&&i())},style:$t,onMouseEnter:p=>{p.currentTarget.style.opacity="0.9"},onMouseLeave:p=>{p.currentTarget.style.opacity="1"},title:"Save",children:[t.jsx(Vt,{size:16}),t.jsx("span",{children:"Save"})]}),i&&t.jsxs("button",{onClick:p=>{p.stopPropagation(),i()},style:{...$t,background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)"},onMouseEnter:p=>{p.currentTarget.style.backgroundColor="var(--bg-hover)",p.currentTarget.style.borderColor="var(--purple)"},onMouseLeave:p=>{p.currentTarget.style.backgroundColor="var(--bg-secondary)",p.currentTarget.style.borderColor="var(--border)"},title:"Cancel",children:[t.jsx(tt,{size:16}),t.jsx("span",{children:"Cancel"})]})]}):t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:p=>{p.stopPropagation(),l&&l(o.id)},style:gt,onMouseEnter:p=>{p.currentTarget.style.backgroundColor="var(--bg-hover)",p.currentTarget.style.borderColor="var(--purple)"},onMouseLeave:p=>{p.currentTarget.style.backgroundColor="var(--bg-secondary)",p.currentTarget.style.borderColor="var(--border)"},title:"Remove one",children:t.jsx(lt,{size:16})}),t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"1rem",fontWeight:"500",minWidth:"24px",textAlign:"center"},children:c.length}),t.jsx("button",{onClick:p=>{p.stopPropagation(),d&&d(o)},style:gt,onMouseEnter:p=>{p.currentTarget.style.backgroundColor="var(--purple)",p.currentTarget.style.borderColor="var(--purple)",p.currentTarget.style.color="white"},onMouseLeave:p=>{p.currentTarget.style.backgroundColor="var(--bg-secondary)",p.currentTarget.style.borderColor="var(--border)",p.currentTarget.style.color="var(--text-primary)"},title:"Add another",children:t.jsx(Je,{size:16})}),u&&t.jsx("button",{onClick:p=>{p.stopPropagation(),u(o.id)},style:{...gt,marginLeft:"0.25rem"},onMouseEnter:p=>{p.currentTarget.style.backgroundColor="var(--purple)",p.currentTarget.style.borderColor="var(--purple)",p.currentTarget.style.color="white"},onMouseLeave:p=>{p.currentTarget.style.backgroundColor="var(--bg-secondary)",p.currentTarget.style.borderColor="var(--border)",p.currentTarget.style.color="var(--text-primary)"},title:"Edit",children:t.jsx(pr,{size:16})})]}),_r=e=>{const a=f.useRef(null),o=f.useRef(e.length),i=f.useRef(null),l=f.useRef(null),d=f.useRef(null);return f.useEffect(()=>{const c=a.current;if(!c)return;const u=()=>{i.current=c.scrollHeight,l.current=c.scrollTop};c.addEventListener("scroll",u,{passive:!0});const p=setInterval(u,100);return()=>{c.removeEventListener("scroll",u),clearInterval(p),d.current&&(cancelAnimationFrame(d.current),d.current=null)}},[]),f.useEffect(()=>()=>{const c=a.current;c&&(i.current=c.scrollHeight,l.current=c.scrollTop)},[e.length,e]),f.useLayoutEffect(()=>{const c=e.length,u=o.current,p=a.current;if(!p){o.current=c;return}if(c!==u){const x=i.current,m=l.current;if(!x||m===null){o.current=c;return}const r=p.scrollHeight,n=p.clientHeight;if(c>u){const s=r-n,h=p.scrollTop,w=s-h;if(Math.abs(w)>.5){d.current&&(cancelAnimationFrame(d.current),d.current=null);const S=400,O=performance.now(),W=K=>{const F=K-O,_=Math.min(F/S,1),L=1-_,D=1-L*L*L,E=h+w*D;p.scrollTop=E,_<1?d.current=requestAnimationFrame(W):(p.scrollTop=s,d.current=null)};d.current=requestAnimationFrame(W)}}}o.current=c},[e.length,e]),{scrollableContentRef:a}},Fe={transitions:{hoverIn:"all 0.1s ease",hoverOut:"all 0.3s ease"},card:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"8px",cursor:"pointer",transition:"all 0.1s ease",position:"relative",border:"none"},cardHover:{backgroundColor:"var(--bg-card-hover)"},cardDead:{opacity:.6,backgroundColor:"var(--gray-800)",borderColor:"var(--border)"},cardAtMax:{backgroundColor:"var(--success)",borderColor:"var(--success)"},rowMain:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},rowTitle:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",margin:0},rowMeta:{display:"flex",gap:"8px",alignItems:"center"},badge:{padding:"2px 6px",borderRadius:"3px",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},typeBadge:{backgroundColor:"var(--purple)",color:"var(--text-primary)"},tierBadge:{backgroundColor:"var(--info)",color:"var(--text-primary)"}},Vr=({item:e,type:a,mode:o="expanded",onClick:i,onApplyDamage:l,onApplyHealing:d,onApplyStressChange:c,onUpdate:u,adversaries:p=[],isSelected:x=!1,instances:m=[],isEmbedded:r=!1,onAddInstance:n=null,onRemoveInstance:s=null,onEdit:h=null,showCustomCreator:w=!1,onSaveCustomAdversary:S=null,onCancelEdit:O=null,isStockAdversary:W=!1})=>{const{scrollableContentRef:K}=_r(m),F=f.useRef(null),_=f.useRef(null),[L,D]=f.useState({});f.useEffect(()=>{if(w&&F.current){const b=setTimeout(()=>{var T,k;(T=F.current)==null||T.focus(),(k=F.current)==null||k.select()},650);return()=>clearTimeout(b)}},[w]);const E=b=>{const k=(e.features||[]).filter(A=>A.type===b.type).findIndex(A=>A===b);return`${b.type}-${k}-${b.name||"blank"}`},y=b=>{const T=E(b);if(L[T]){const k=e.features.filter(A=>A!==b);u&&u(e.id,{features:k}),D(A=>{const V={...A};return delete V[T],V})}else D(k=>({...k,[T]:!0})),setTimeout(()=>{D(k=>{const A={...k};return delete A[T],A})},3e3)},H=(b=!1)=>{let T={...Fe.card};if(x?T.transition="none":T.transition=Fe.transitions.hoverOut,b){const{marginTop:k,...A}=T;T=A}return x&&(T={...T,...Fe.cardHover}),a==="adversary"&&(e.hp||0)>=(e.hpMax||1)&&(T={...T,...Fe.cardDead}),T},Q=()=>{if(r)return"";let b="border rounded-lg";return x&&(b+=" border-hover"),b},R=()=>{var b;if(a==="adversary"||a==="adversaries"){const T=e.baseName||((b=e.name)==null?void 0:b.replace(/\s+\(\d+\)$/,""))||"",k=e.duplicateNumber||1,A=[...p];return p.some(P=>P.id===e.id)||A.push(e),A.filter(P=>P.baseName===T).length>1?`${T} (${k})`:T}return e.name},j=()=>{const b=[];return e.type&&b.push(t.jsx("span",{style:{...Fe.badge,...Fe.typeBadge},children:e.type},"type")),b},v=()=>{var V;const b=(e.hp||0)>=(e.hpMax||1),T=C==="edit"||w,k=a==="adversary",A=k?t.jsx(qr,{showCustomCreator:w,onSaveCustomAdversary:S,item:e,onCancelEdit:O,onRemoveInstance:s,onAddInstance:n,instances:m,onEdit:h}):null;return t.jsx(wt,{tabContent:A,showTab:k,tabBorderColor:x?"var(--purple)":"var(--border)",containerBackgroundColor:b?"var(--gray-900)":H(!0).backgroundColor,containerBorderColor:b?"color-mix(in srgb, var(--gray-600) 40%, transparent)":x?"var(--purple)":"var(--border)",containerBorderRadius:"8px",containerOverflow:"hidden",containerStyle:{padding:0,opacity:b?.7:1,height:"auto",maxHeight:k?"calc(100vh - 120px)":"calc(100vh - 68px)",minHeight:0},children:t.jsxs("div",{className:Q(),style:{...H(!0),padding:0,display:"flex",flexDirection:"column",position:"relative",height:"100%",minHeight:0,border:"none",borderRadius:0},onClick:i,children:[b&&t.jsx(t.Fragment,{children:t.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                45deg,
                transparent,
                transparent 8px,
                var(--gray-600) 1px,
                var(--gray-600) 9px
              )`,pointerEvents:"none",zIndex:9999}})}),t.jsx("div",{className:"border-b",style:{padding:"8px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative",zIndex:b?1:"auto",borderBottomColor:x?"var(--purple)":"var(--border)"},children:t.jsx("div",{style:{display:"flex",flexDirection:"column",position:"relative",zIndex:b?1:"auto",padding:"2px",gap:0},children:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",minHeight:"40px"},children:[T?t.jsx("input",{ref:F,type:"text",value:e.name||"",onChange:M=>{u&&e.id&&u(e.id,{name:M.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"4px",color:"var(--text-primary)",fontSize:"1.1rem",fontWeight:"600",padding:"0.5rem",width:"100%",maxWidth:"300px",paddingRight:"0.625rem"},placeholder:"Name"}):t.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flex:1},children:t.jsx("h4",{style:{...Fe.rowTitle,color:b?"color-mix(in srgb, var(--gray-400) 80%, transparent)":Fe.rowTitle.color,textAlign:"left",margin:0,fontSize:"1.1rem",paddingRight:"6px",flex:1},children:((V=e.name)==null?void 0:V.replace(/\s+\(\d+\)$/,""))||e.name})}),(e.type||e.tier||T)&&t.jsx(Or,{type:e.type,tier:e.tier,isEditMode:T,onUpdate:u,itemId:e.id})]})})}),t.jsxs("div",{ref:K,style:{borderRadius:"0 0 8px 8px",flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0},className:"invisible-scrollbar",children:[(e.motives||T)&&t.jsx("div",{style:{padding:"0.5rem 8px",textAlign:"center"},children:T?t.jsx("input",{type:"text",value:e.motives||"",onChange:M=>u&&u(e.id,{motives:M.target.value}),placeholder:"Motives...",style:{width:"100%",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}):t.jsxs("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,textAlign:"center"},children:[e.motives,e.motives&&!e.motives.endsWith(".")?".":""]})}),(e.difficulty||e.atk!==void 0||e.thresholds&&e.type!=="Minion"||e.experience&&e.experience.length>0||T)&&t.jsxs("div",{style:{padding:"0.5rem 8px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[(e.difficulty||T)&&t.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[t.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[t.jsx(mr,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(0deg)"}}),T?t.jsx("input",{type:"text",value:e.difficulty||"",onChange:M=>{const P=M.target.value.replace(/[^0-9]/g,"");P.length<=2&&u&&u(e.id,{difficulty:parseInt(P)||0})},onKeyDown:M=>{if(M.key==="ArrowUp"){M.preventDefault();const P=parseInt(e.difficulty)||0;u&&u(e.id,{difficulty:Math.min(P+1,99)})}else if(M.key==="ArrowDown"){M.preventDefault();const P=parseInt(e.difficulty)||0;u&&u(e.id,{difficulty:Math.max(P-1,0)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"2"}):t.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:e.difficulty})]}),t.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Difficulty"})]}),(e.atk!==void 0||T)&&t.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[t.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[t.jsx(fr,{size:38,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(45deg)"}}),T?t.jsx("input",{type:"text",value:(()=>{if(typeof e.atk=="string"&&e.atk.includes("d"))return e.atk;const M=typeof e.atk=="string"?parseInt(e.atk.replace(/[^0-9-]/g,"")):e.atk||0;return M>=0?`+${M}`:M.toString()})(),onChange:M=>{const P=M.target.value;if(P.includes("d"))u&&u(e.id,{atk:P});else{const re=P.replace(/[^0-9+-]/g,"");if(re.length<=4){const $=parseInt(re.replace(/[^0-9-]/g,""))||0;u&&u(e.id,{atk:$})}}},onKeyDown:M=>{if(!(typeof e.atk=="string"&&e.atk.includes("d"))){if(M.key==="ArrowUp"){M.preventDefault();const re=(typeof e.atk=="string"?parseInt(e.atk.replace(/[^0-9-]/g,"")):e.atk||0)+1;u&&u(e.id,{atk:re})}else if(M.key==="ArrowDown"){M.preventDefault();const re=(typeof e.atk=="string"?parseInt(e.atk.replace(/[^0-9-]/g,"")):e.atk||0)-1;u&&u(e.id,{atk:re})}}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"3"}):t.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:(()=>{if(typeof e.atk=="string"&&e.atk.includes("d"))return e.atk;const M=typeof e.atk=="string"?parseInt(e.atk.replace(/[^0-9-]/g,"")):e.atk;return M>=0?`+${M}`:M})()})]}),t.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Attack"})]})]}),t.jsx($r,{item:e,isEditMode:T,onUpdate:u,deleteConfirmations:L,setDeleteConfirmations:D})]}),t.jsx(Rr,{item:e,isEditMode:T,onUpdate:u}),t.jsx(Lr,{item:e,isEditMode:T,onUpdate:u,handleFeatureDeleteClick:y,deleteConfirmations:L,getFeatureKey:E}),t.jsx(Fr,{item:e,instances:m,isEditMode:T,type:a,onUpdate:u,onApplyDamage:l,onApplyHealing:d,onApplyStressChange:c}),t.jsx(Hr,{item:e,isEditMode:T,mode:o,onUpdate:u})]})]})})};if(w&&(a==="adversary"||a==="adversaries")){const b=a==="adversary",T=b?t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:k=>{var A;k.stopPropagation(),(A=_.current)!=null&&A.handleSave&&_.current.handleSave()},style:{background:"var(--purple)",border:"1px solid var(--purple)",color:"white",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:k=>{k.currentTarget.style.opacity="0.9"},onMouseLeave:k=>{k.currentTarget.style.opacity="1"},title:"Save",children:[t.jsx(Vt,{size:16}),t.jsx("span",{children:"Save"})]}),O&&t.jsxs("button",{onClick:k=>{k.stopPropagation(),O()},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:k=>{k.currentTarget.style.backgroundColor="var(--bg-hover)",k.currentTarget.style.borderColor="var(--purple)"},onMouseLeave:k=>{k.currentTarget.style.backgroundColor="var(--bg-secondary)",k.currentTarget.style.borderColor="var(--border)"},title:"Cancel",children:[t.jsx(tt,{size:16}),t.jsx("span",{children:"Cancel"})]})]}):null;return t.jsx(wt,{tabContent:T,containerStyle:{padding:0,height:"auto",maxHeight:b?"calc(100vh - 120px)":"calc(100vh - 68px)",minHeight:0},children:t.jsx(jt,{ref:_,editingAdversary:e,onSave:S,onCancelEdit:O,isStockAdversary:W,embedded:!0,hideEmbeddedButtons:!0,allAdversaries:p,autoFocus:!e.baseName||e.baseName.trim()===""||e.baseName==="Unknown"})})}const C=w?"edit":o;return(C==="expanded"||C==="edit")&&(a==="adversary"||a==="adversaries")?v():a==="adversary"||a==="adversaries"?null:t.jsxs("div",{className:Q(),style:H(!0),children:[t.jsxs("div",{style:Fe.rowMain,children:[t.jsx("h4",{style:Fe.rowTitle,children:R()}),t.jsx("div",{style:Fe.rowMeta,children:j()})]}),t.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"12px",margin:0},children:["Expanded view coming soon for ",a]})]})},ct=Vr,Kr="/Daggerheart/assets/daggerheart-logo-fe7815ad.svg",Xe={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},Ve={lessDifficult:-1,twoOrMoreSolos:-2,increasedDamage:-2,lowerTierAdversary:1,noBruisersHordesLeadersSolos:1,moreDangerous:2};function Xt(e){return 3*e+2}function Qt(e,a){return e.reduce((o,i)=>{if(i.type==="adversary"){const l=Xe[i.item.type]||2;return i.item.type==="Minion"?o+Math.ceil(i.quantity/a)*l:o+l*i.quantity}return o},0)}function Zt(e){let a=0;return e.filter(l=>l.type==="adversary"&&l.item.type==="Solo"&&l.quantity>0).reduce((l,d)=>l+d.quantity,0)>=2&&(a+=Ve.twoOrMoreSolos),e.some(l=>l.type==="adversary"&&l.item.type&&["Bruiser","Horde","Leader","Solo"].includes(l.item.type)&&l.quantity>0)||(a+=Ve.noBruisersHordesLeadersSolos),a}function Gr(e,a={}){const o=Xt(e),i=Object.entries(a).filter(([l,d])=>d).reduce((l,[d,c])=>l+Ve[d],0);return o+i}let at={adversaries:[]},it={environments:[]},St=!1;function Jr(){const e=JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]"),a=JSON.parse(localStorage.getItem("daggerheart-custom-environments")||"[]");return{customAdversaries:e,customEnvironments:a}}async function Ut(){if(St)return{adversariesData:at,environmentsData:it};let e={adversaries:[]},a={environments:[]},o={adversaries:[]},i={environments:[]};try{const c=await Ge(()=>import("./adversaries-9c8932de.js"),[]);e=(c==null?void 0:c.default)||c}catch(c){console.warn("Failed to load adversaries.json:",c)}try{const c=await Ge(()=>import("./environments-c340637c.js"),[]);a=(c==null?void 0:c.default)||c}catch(c){console.warn("Failed to load environments.json:",c)}try{const c=await Ge(()=>import("./playtest-adversaries-4a099c10.js"),[]);o=(c==null?void 0:c.default)||c}catch(c){console.warn("Failed to load playtest-adversaries.json:",c)}try{const c=await Ge(()=>import("./playtest-environments-d9cdffb6.js"),[]);i=(c==null?void 0:c.default)||c}catch(c){console.warn("Failed to load playtest-environments.json:",c)}const{customAdversaries:l,customEnvironments:d}=Jr();return at={...e,adversaries:[...e.adversaries||[],...o.adversaries||[],...l]},it={...a,environments:[...a.environments||[],...i.environments||[],...d]},St=!0,{adversariesData:at,environmentsData:it}}function qt(){return St=!1,Ut()}const Yr=(e,a)=>{const[o,i]=f.useState("max-content"),l=f.useCallback(()=>{if(!a.current||e<=3)return"max-content";const d=a.current.offsetWidth,u=Math.floor(d/120);return u<=1?"max-content":e===4?"max-content max-content":e===5||e===6?u>=2?"max-content max-content":"max-content":e===7?u>=3?"max-content max-content max-content":u>=2?"max-content max-content":"max-content":"repeat(auto-fit, minmax(80px, max-content))"},[e,a]);return f.useEffect(()=>{const d=l();i(d);const c=new ResizeObserver(()=>{const u=l();i(u)});return a.current&&c.observe(a.current),()=>{c.disconnect()}},[l]),o},Xr=({encounter:e})=>{var l,d;const a=f.useRef(null),o=((l=e.encounterItems)==null?void 0:l.length)||0,i=Yr(o,a);return t.jsx("div",{ref:a,className:"saved-encounter-adversary-list",style:{flex:1,fontSize:"0.8rem",color:"var(--text-secondary)",lineHeight:"1.3",display:"grid",gridTemplateColumns:i,gap:"0.25rem 1rem",gridAutoRows:"min-content"},children:((d=e.encounterItems)==null?void 0:d.length)>0?e.encounterItems.map((c,u)=>{var x;const p=c.item.baseName||((x=c.item.name)==null?void 0:x.replace(/\s+\(\d+\)$/,""))||c.item.name;return t.jsxs("div",{style:{marginBottom:"0.125rem"},children:[c.quantity,"x ",p]},u)}):t.jsx("div",{children:"No adversaries"})})};let Oe=at,et=it;const Qr=async()=>{const e=await Ut();Oe=e.adversariesData,et=e.environmentsData},Zr=(e,a=[],o=4,i=1,l=!1,d=null)=>{const[c,u]=f.useState(""),[p,x]=f.useState([{field:"tier",direction:"asc"},{field:"name",direction:"asc"}]),[m,r]=f.useState([]),[n,s]=f.useState(!0),[h,w]=f.useState([]),[S,O]=f.useState([]),[W,K]=f.useState(!1),[F,_]=f.useState(!1),L=f.useRef(null),D=f.useRef(null);f.useEffect(()=>{(async()=>{await Qr(),s(!1);let A=[];e==="adversary"?A=Oe.adversaries||[]:e==="environment"&&(A=et.environments||[]),r(A)})()},[e]),f.useEffect(()=>{e==="adversary"&&d&&(async()=>{const A=await qt();Oe=A.adversariesData,et=A.environmentsData;let V=[];l?V=(Oe.adversaries||[]).filter(M=>{var P;return M.source==="Homebrew"||((P=M.id)==null?void 0:P.startsWith("custom-"))}):V=Oe.adversaries||[],r(V)})()},[d,e,l]);const E=k=>{const A=m.map(V=>V[k]).filter(Boolean);return[...new Set(A)].sort((V,M)=>typeof V=="number"&&typeof M=="number"?V-M:String(V).localeCompare(String(M)))},y=f.useCallback(async()=>{const k=await qt();Oe=k.adversariesData,et=k.environmentsData;let A=[];e==="adversary"?l?A=(Oe.adversaries||[]).filter(V=>{var M;return V.source==="Homebrew"||((M=V.id)==null?void 0:M.startsWith("custom-"))}):A=Oe.adversaries||[]:e==="environment"&&(A=et.environments||[]),r(A)},[e,l]);f.useEffect(()=>{y()},[l,y]);const H=E("tier"),Q=E("type"),R=f.useMemo(()=>{let k=m.filter(A=>{var $,ee;const M=(A.name||A.baseName||"").toLowerCase().includes(c.toLowerCase())||(($=A.type)==null?void 0:$.toLowerCase().includes(c.toLowerCase()))||((ee=A.description)==null?void 0:ee.toLowerCase().includes(c.toLowerCase())),P=h.length===0||h.includes(A.tier.toString()),re=S.length===0||S.includes(A.type);return M&&P&&re});return k.sort((A,V)=>{for(const M of p){const{field:P,direction:re}=M;let $=A[P],ee=V[P];if(P==="tier")$=parseInt($)||0,ee=parseInt(ee)||0;else if(P==="atk")$=parseInt($)||0,ee=parseInt(ee)||0;else if(P==="cost"){const de=fe=>{if(e!=="adversary")return 0;const ze=Xe[fe.type]||2;let ye=0;const Ie=a.filter(te=>te.type==="adversary"&&te.item.type==="Solo"&&te.quantity>0).reduce((te,he)=>te+he.quantity,0),Le=a.filter(te=>te.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(te.item.type)&&te.quantity>0).reduce((te,he)=>te+he.quantity,0);return fe.type==="Solo"&&Ie===1&&(ye+=2),["Bruiser","Horde","Leader","Solo"].includes(fe.type)&&Le===0&&(ye+=1),ze+ye};$=de(A),ee=de(V)}else if(P==="difficulty"){const de=parseInt($),fe=parseInt(ee);!isNaN(de)&&!isNaN(fe)?($=de,ee=fe):!isNaN(de)&&isNaN(fe)?($=de,ee=999):isNaN(de)&&!isNaN(fe)?($=999,ee=fe):($=String($||"").toLowerCase(),ee=String(ee||"").toLowerCase())}else typeof $=="string"&&typeof ee=="string"?($=$.toLowerCase(),ee=ee.toLowerCase()):($=String($||"").toLowerCase(),ee=String(ee||"").toLowerCase());if(re==="asc"){if($>ee)return 1;if($<ee)return-1}else{if($<ee)return 1;if($>ee)return-1}}return 0}),k},[m,c,p,h,S,a,o,i]),j=k=>{x(A=>{const V=A.findIndex(M=>M.field===k);if(V>=0)if(V===0){const M=[...A];return M[0]={...M[0],direction:M[0].direction==="asc"?"desc":"asc"},M}else{const M=[...A];return M.splice(V,1)[0],[{field:k,direction:"asc"},...M]}else return[{field:k,direction:"asc"},...A]})},v=k=>{w(k==="clear"?[]:A=>A.includes(k)?A.filter(V=>V!==k):[...A,k])},C=k=>{O(k==="clear"?[]:A=>A.includes(k)?A.filter(V=>V!==k):[...A,k])},q=h.length>0,b=S.length>0;return f.useEffect(()=>{const k=V=>{const M=V.target.closest(".filter-dropdown"),P=V.target.closest(".header-filter-icon");M||P||(K(!1),_(!1))},A=V=>{V.key==="Escape"&&(K(!1),_(!1))};return document.addEventListener("pointerdown",k,!0),document.addEventListener("mousedown",k,!0),document.addEventListener("touchstart",k,!0),document.addEventListener("click",k,!0),document.addEventListener("keydown",A,!0),()=>{document.removeEventListener("pointerdown",k,!0),document.removeEventListener("mousedown",k,!0),document.removeEventListener("touchstart",k,!0),document.removeEventListener("click",k,!0),document.removeEventListener("keydown",A,!0)}},[K,_]),{searchTerm:c,setSearchTerm:u,sortFields:p,handleSort:j,filteredAndSortedData:R,loading:n,refreshData:y,selectedTiers:h,selectedTypes:S,showTierDropdown:W,setShowTierDropdown:K,showTypeDropdown:F,setShowTypeDropdown:_,tierFilterRef:L,typeFilterRef:D,uniqueTiers:H,uniqueTypes:Q,handleTierSelect:v,handleTypeSelect:C,isTierFiltered:q,isTypeFiltered:b,getDropdownStyle:k=>{if(!k.current)return{};const A=k.current.getBoundingClientRect();return{position:"fixed",top:A.bottom+4,left:A.left-100,zIndex:99999}}}},Ur=({searchTerm:e,onSearchChange:a,type:o,partyControls:i,showCustomToggle:l=!1,onToggleCustom:d,filterCustom:c=!1,onExportCustomAdversaries:u,onImportCustomAdversaries:p,autoFocus:x=!1,onClose:m=null,placeholder:r="Search"})=>{const n=f.useRef(null);return f.useEffect(()=>{x&&n.current&&setTimeout(()=>{var s;(s=n.current)==null||s.focus()},100)},[x]),t.jsxs("div",{className:"browser-header",style:G.browserHeader,children:[t.jsx("div",{style:{display:"flex",alignItems:"center",flex:1,gap:"0.5rem"},children:t.jsx("input",{ref:n,type:"text",placeholder:r,value:e,onChange:s=>a(s.target.value),style:{...G.searchInput,flex:1,marginRight:0}})}),i&&t.jsx("div",{style:G.partyControls,children:i})]})},en=({showCustomToggle:e=!1,onToggleCustom:a,filterCustom:o=!1,onExportCustomAdversaries:i,onImportCustomAdversaries:l})=>t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e&&t.jsxs("button",{onClick:()=>a&&a(!o),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:o?"var(--purple)":"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:o?"white":"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:d=>{o||(d.target.style.backgroundColor="var(--bg-hover)",d.target.style.borderColor="var(--purple)")},onMouseLeave:d=>{o||(d.target.style.backgroundColor="var(--bg-primary)",d.target.style.borderColor="var(--border)")},children:[t.jsx("span",{children:o?"✓":"○"}),"Custom Only"]}),t.jsxs("button",{onClick:i,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:d=>{d.target.style.backgroundColor="var(--bg-hover)",d.target.style.borderColor="var(--purple)"},onMouseLeave:d=>{d.target.style.backgroundColor="var(--bg-primary)",d.target.style.borderColor="var(--border)"},children:[t.jsx("span",{children:"↓"}),"Export"]}),t.jsxs("button",{onClick:()=>document.getElementById("import-file-input").click(),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:d=>{d.target.style.backgroundColor="var(--bg-hover)",d.target.style.borderColor="var(--purple)"},onMouseLeave:d=>{d.target.style.backgroundColor="var(--bg-primary)",d.target.style.borderColor="var(--border)"},children:[t.jsx("span",{children:"↑"}),"Import"]}),t.jsx("input",{id:"import-file-input",type:"file",accept:".csv,.json",onChange:l,style:{display:"none"}})]}),tn=({sortFields:e,onSort:a,type:o,uniqueTiers:i,uniqueTypes:l,selectedTiers:d,selectedTypes:c,showTierDropdown:u,setShowTierDropdown:p,showTypeDropdown:x,setShowTypeDropdown:m,tierFilterRef:r,typeFilterRef:n,handleTierSelect:s,handleTypeSelect:h,isTierFiltered:w,isTypeFiltered:S,getDropdownStyle:O,costFilter:W,showCostDropdown:K,setShowCostDropdown:F,costFilterRef:_,handleCostFilterSelect:L,isCostFiltered:D})=>{const[E,y]=f.useState(null),Q=(()=>o==="adversary"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0,hasCostFilter:!0},{key:"source",label:"Src"}]:o==="environment"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"}]:[])(),R=()=>{if(!K)return null;const v=[{value:"all",label:"All"},{value:"auto-grey",label:"Auto Grey"},{value:"auto-hide",label:"Auto Hide"}];return vt.createPortal(t.jsx("div",{className:"filter-dropdown",style:{...G.filterDropdown,...O(_),maxHeight:"60vh",overflow:"auto"},onMouseDown:C=>C.stopPropagation(),onClick:C=>C.stopPropagation(),children:v.map(C=>{const q=W===C.value;return t.jsxs("div",{style:{...G.filterOption,...q?G.filterOptionSelected:{}},onClick:()=>L(C.value),children:[t.jsx("span",{style:G.checkIcon,children:q?t.jsx(ht,{size:16}):t.jsx(xt,{size:16})}),t.jsx("span",{style:G.filterLabel,children:C.label})]},C.value)})}),document.body)},j=(v,C,q,b,T,k,A,V)=>{if(!T)return null;const M=()=>{(v==="tier"||v==="type")&&b("clear")};return vt.createPortal(t.jsxs("div",{className:"filter-dropdown",style:{...G.filterDropdown,...O(A),maxHeight:"60vh",overflow:"auto"},onMouseDown:P=>P.stopPropagation(),onClick:P=>P.stopPropagation(),children:[t.jsxs("div",{style:{...G.filterOption,...q.length===0?G.filterOptionSelected:{}},onClick:M,children:[t.jsx("span",{style:G.checkIcon,children:q.length===0?t.jsx(ht,{size:16}):t.jsx(xt,{size:16})}),t.jsx("span",{style:G.filterLabel,children:"All"})]}),C.map(P=>{const re=q.includes(P.toString());return t.jsxs("div",{style:{...G.filterOption,...re?G.filterOptionSelected:{}},onClick:()=>b(P.toString()),children:[t.jsx("span",{style:G.checkIcon,children:re?t.jsx(ht,{size:16}):t.jsx(xt,{size:16})}),t.jsx("span",{style:G.filterLabel,children:P})]},P)})]}),document.body)};return t.jsx("tr",{style:G.tableHeader,children:Q.map(v=>t.jsxs("th",{style:{...G.tableHeaderCell,...E===v.key?G.tableHeaderCellHover:{},position:"relative",...v.key==="name"?{width:"auto",minWidth:"0"}:{},...v.key==="tier"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...v.key==="type"?{width:"80px",minWidth:"80px",maxWidth:"80px"}:{},...v.key==="source"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{}},onClick:()=>a(v.key),onMouseEnter:()=>y(v.key),onMouseLeave:()=>y(null),children:[v.hasFilter?t.jsxs("div",{style:G.headerWithFilter,children:[t.jsx("span",{style:{cursor:"pointer"},onClick:C=>{C.stopPropagation(),a(v.key)},children:v.label}),t.jsxs("button",{ref:v.key==="tier"?r:v.key==="type"&&v.hasCostFilter?_:v.key==="type"?n:_,style:{...G.headerFilterIcon,...v.key==="tier"&&w?G.headerFilterIconActive:{},...v.key==="type"&&(S||D)?G.headerFilterIconActive:{},...v.key==="cost"&&D?G.headerFilterIconActive:{}},className:"header-filter-icon",onClick:C=>{C.stopPropagation(),v.key==="tier"?(p(!u),m(!1),F(!1)):v.key==="type"&&(v.hasCostFilter?(F(!K),p(!1),m(!1)):(m(!x),p(!1),F(!1)))},children:[t.jsx(hr,{size:14}),v.key==="tier"&&w||v.key==="type"&&(S||D)||v.key==="cost"&&D?t.jsx("span",{style:G.filterActiveDot}):null]})]}):v.label,v.key==="tier"&&j("tier",i,d,s,u,p,r),v.key==="type"&&!v.hasCostFilter&&j("type",l,c,h,x,m,n),v.key==="type"&&v.hasCostFilter&&R()]},v.key))})},rn=({item:e,onAdd:a,type:o,onRowClick:i,encounterItems:l=[],pcCount:d=4,playerTier:c=1,remainingBudget:u=0,costFilter:p="auto-grey",isFocused:x=!1,rowRef:m=null,onDeleteCustomAdversary:r=null,isDeleteConfirmed:n=!1})=>{const[s,h]=f.useState(!1),w=()=>{a(e)},S=()=>{if(o!=="adversary")return null;const K=Xe[e.type]||2;let F=0;const _=l.filter(D=>D.type==="adversary"&&D.item.type==="Solo"&&D.quantity>0).reduce((D,E)=>D+E.quantity,0),L=l.filter(D=>D.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(D.item.type)&&D.quantity>0).reduce((D,E)=>D+E.quantity,0);return e.type==="Solo"&&_===1&&(F+=2),["Bruiser","Horde","Leader","Solo"].includes(e.type)&&L===0&&(F+=1),K+F},W=(()=>{if(o==="adversary"){const K=S();Xe[e.type];const F=K>u||u<=0;if(p==="auto-hide"&&F)return null;const _=p==="auto-grey"&&F?{opacity:.5,color:"var(--text-secondary)"}:{};return e.description||e.motives?[[t.jsx("td",{style:{...G.rowCell,width:"auto",minWidth:"0",textAlign:"left",..._,borderBottom:"none",padding:"0.25rem 0.25rem 0 0.5rem",outline:"none"},children:t.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%",display:"flex",alignItems:"center",gap:"0.5rem"},children:t.jsx("div",{style:{flex:1,minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.jsx("div",{style:{fontWeight:"600"},children:e.name||e.baseName||""})})})},"name"),t.jsx("td",{style:{...G.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",..._,borderBottom:"none",padding:"0.25rem 0.25rem 0 0.25rem",outline:"none"},children:e.tier},"tier"),t.jsx("td",{style:{...G.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center",..._,borderBottom:"none",padding:"0.25rem 0.25rem 0 0.25rem",outline:"none"},children:e.type},"type"),t.jsx("td",{style:{...G.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",..._,borderBottom:"none",outline:"none"},rowSpan:2,children:e.source==="Homebrew"||e.isCustom?(s||x||n)&&r?t.jsx("button",{onClick:L=>{L.stopPropagation(),r(e.id)},style:{background:n?"var(--danger)":"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"4px",padding:"0.25rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:n?"var(--text-primary)":"var(--danger)",transition:"all 0.2s ease",flexShrink:0,width:"24px",height:"24px",margin:"0 auto"},title:n?"Click again to confirm delete":"Delete custom adversary",children:t.jsx(Tt,{size:14})}):t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",margin:"0 auto"},children:t.jsx(Mt,{size:14,style:{color:"var(--text-secondary)",opacity:.7},title:"Custom adversary"})}):t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",margin:"0 auto"},children:t.jsx(Nt,{size:14,style:{color:"var(--text-secondary)",opacity:.7},title:"Stock adversary"})})},"source")],[t.jsx("td",{colSpan:3,style:{...G.rowCell,textAlign:"left",..._,padding:"0 0.25rem 0.25rem 0.5rem",borderTop:"none",borderBottom:"none",outline:"none"},children:t.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.description||e.motives||""})},"desc")]]:t.jsxs(t.Fragment,{children:[t.jsx("td",{style:{...G.rowCell,width:"auto",minWidth:"0",textAlign:"left",..._,paddingLeft:"0.5rem"},children:t.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%",display:"flex",alignItems:"center",gap:"0.5rem"},children:t.jsx("div",{style:{flex:1,minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.jsx("div",{style:{fontWeight:"600"},children:e.name||e.baseName||""})})})}),t.jsx("td",{style:{...G.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",..._},children:e.tier}),t.jsx("td",{style:{...G.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center",..._},children:e.type}),t.jsx("td",{style:{...G.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",..._},children:e.source==="Homebrew"||e.isCustom?(s||x||n)&&r?t.jsx("button",{onClick:L=>{L.stopPropagation(),r(e.id)},style:{background:n?"var(--danger)":"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"4px",padding:"0.25rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:n?"var(--text-primary)":"var(--danger)",transition:"all 0.2s ease",flexShrink:0,width:"24px",height:"24px",margin:"0 auto"},title:n?"Click again to confirm delete":"Delete custom adversary",children:t.jsx(Tt,{size:14})}):t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",margin:"0 auto"},children:t.jsx(Mt,{size:14,style:{color:"var(--text-secondary)",opacity:.7},title:"Custom adversary"})}):t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",margin:"0 auto"},children:t.jsx(Nt,{size:14,style:{color:"var(--text-secondary)",opacity:.7},title:"Stock adversary"})})})]})}else if(o==="environment")return t.jsxs(t.Fragment,{children:[t.jsx("td",{style:{...G.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:e.name||e.baseName||""}),t.jsx("td",{style:{...G.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:e.tier}),t.jsx("td",{style:{...G.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:e.type}),t.jsx("td",{style:{...G.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:e.difficulty})]});return null})();return W===null?null:Array.isArray(W)?t.jsx(t.Fragment,{children:W.map((K,F)=>t.jsx("tr",{ref:F===0?m:null,style:{...G.row,...s?G.rowHover:{},...x?G.rowFocused:{},...F===0?{borderBottom:"none"}:{},...F===1?{borderTop:"none",height:"auto",outline:"none"}:{}},onClick:()=>{o==="adversary"?w():i&&i(e,o)},onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),children:K},F))}):t.jsx(t.Fragment,{children:t.jsx("tr",{ref:m,style:{...G.row,...s?G.rowHover:{},...x?G.rowFocused:{}},onClick:()=>{o==="adversary"?w():i&&i(e,o)},onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),children:W})})},er=({type:e,onAddItem:a,onCancel:o=null,onRowClick:i,encounterItems:l=[],pcCount:d=4,playerTier:c=1,partyControls:u=null,showContainer:p=!0,savedEncounters:x=[],onLoadEncounter:m,onDeleteEncounter:r,activeTab:n="adversaries",selectedCustomAdversaryId:s,onSelectCustomAdversary:h,onTabChange:w,selectedAdversary:S,onSelectAdversary:O,filterCustom:W=!1,showCustomToggle:K=!1,onToggleCustom:F,onExportCustomAdversaries:_,onImportCustomAdversaries:L,autoFocus:D=!1,hideImportExport:E=!1,onClose:y=null,searchPlaceholder:H="Search"})=>{const{addCustomAdversary:Q,updateCustomAdversary:R,deleteCustomAdversary:j,customContent:v,adversaries:C,deleteAdversary:q}=pt(),[b,T]=f.useState(null),[k,A]=f.useState("all"),[V,M]=f.useState(!1),[P,re]=f.useState({}),[$,ee]=f.useState({}),de=f.useRef({}),fe=f.useRef({}),ze=f.useRef(null),[ye,Ie]=f.useState(-1),[Le,te]=f.useState(null),he=f.useRef({}),ce=()=>{try{const N=v.adversaries||[];if(N.length===0){alert("No custom adversaries to export.");return}const X=["name","tier","type","difficulty","threshold_major","threshold_severe","hp_max","stress_max","atk","weapon","range","damage","description","motives"],se=N.map(le=>{var U,xe;return[le.name||"",le.tier||"",le.type||"",le.difficulty||"",((U=le.thresholds)==null?void 0:U.major)||"",((xe=le.thresholds)==null?void 0:xe.severe)||"",le.hpMax||"",le.stressMax||"",le.atk||"",le.weapon||"",le.range||"",le.damage||"",le.description||"",le.motives||""]}),Ae=le=>{const U=String(le);return U.includes(",")||U.includes('"')||U.includes(`
`)?`"${U.replace(/"/g,'""')}"`:U},ge=[X.join(","),...se.map(le=>le.map(Ae).join(","))].join(`
`),ve=new Blob([ge],{type:"text/csv;charset=utf-8;"}),Ce=URL.createObjectURL(ve),ae=document.createElement("a");ae.href=Ce,ae.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(ae),ae.click(),document.body.removeChild(ae),URL.revokeObjectURL(Ce),console.log(`Exported ${N.length} custom adversaries to CSV`)}catch(N){console.error("Failed to export custom adversaries:",N),alert("Failed to export custom adversaries. Please try again.")}},Ee=N=>{const X=N.target.files[0];if(!X)return;const se=X.name.endsWith(".csv"),Ae=X.name.endsWith(".json");if(!se&&!Ae){alert("Please upload a CSV or JSON file."),N.target.value="";return}const ge=new FileReader;ge.onload=ve=>{try{let Ce=[];if(se){const ie=ve.target.result.split(`
`).filter(Ne=>Ne.trim());if(ie.length<2)throw new Error("CSV file is empty or invalid.");const pe=ie[0].split(",").map(Ne=>Ne.trim().replace(/^"|"$/g,""));for(let Ne=1;Ne<ie.length;Ne++){const me=[];let Be="",Pe=!1;for(let Te=0;Te<ie[Ne].length;Te++){const He=ie[Ne][Te],sr=ie[Ne][Te+1];He==='"'&&Pe&&sr==='"'?(Be+='"',Te++):He==='"'?Pe=!Pe:He===","&&!Pe?(me.push(Be.trim()),Be=""):Be+=He}me.push(Be.trim());const nt={name:me[pe.indexOf("name")]||"",tier:parseInt(me[pe.indexOf("tier")])||1,type:me[pe.indexOf("type")]||"Standard",difficulty:parseInt(me[pe.indexOf("difficulty")])||11,thresholds:{major:parseInt(me[pe.indexOf("threshold_major")])||7,severe:parseInt(me[pe.indexOf("threshold_severe")])||12},hpMax:parseInt(me[pe.indexOf("hp_max")])||3,stressMax:parseInt(me[pe.indexOf("stress_max")])||1,atk:parseInt(me[pe.indexOf("atk")])||1,weapon:me[pe.indexOf("weapon")]||"",range:me[pe.indexOf("range")]||"Melee",damage:me[pe.indexOf("damage")]||"",description:me[pe.indexOf("description")]||"",motives:me[pe.indexOf("motives")]||"",source:"Homebrew"};nt.name&&Ce.push(nt)}}else if(Ae){const be=JSON.parse(ve.target.result);if(!be.customAdversaries||!Array.isArray(be.customAdversaries))throw new Error("Invalid JSON format. Expected customAdversaries array.");Ce=be.customAdversaries}const ae=v.adversaries||[],le=[...ae];let U=0,xe=0;Ce.forEach(be=>{if(ae.some(pe=>pe.name===be.name&&pe.source===be.source))xe++;else{const pe={...be,id:`custom-adv-${Date.now()}-${Math.random().toString(36).slice(2,10)}`,hp:0,stress:0};le.push(pe),U++}}),U>0?(localStorage.setItem("daggerheart-custom-adversaries",JSON.stringify(le)),window.location.reload(),alert(`Import successful! Added ${U} new adversaries${xe>0?`, skipped ${xe} duplicates`:""}.`)):alert("No new adversaries were added. All imported adversaries already exist.")}catch(Ce){console.error("Failed to import custom adversaries:",Ce),alert(`Failed to import custom adversaries: ${Ce.message}`)}},ge.readAsText(X),N.target.value=""},je=()=>{T(null)},Me=async(N,X)=>{X?R(X,N):Q(N)},De=N=>{P[N]?(r&&r(N),re(X=>{const se={...X};return delete se[N],se}),de.current[N]&&(clearTimeout(de.current[N]),delete de.current[N])):(re(X=>({...X,[N]:!0})),de.current[N]&&clearTimeout(de.current[N]),de.current[N]=setTimeout(()=>{re(X=>{const se={...X};return delete se[N],se}),delete de.current[N]},3e3))},Qe=N=>{$[N]?(C.filter(se=>se.customContentId===N).forEach(se=>{q(se.id)}),j(N),ee(se=>{const Ae={...se};return delete Ae[N],Ae}),fe.current[N]&&(clearTimeout(fe.current[N]),delete fe.current[N])):(ee(X=>({...X,[N]:!0})),fe.current[N]&&clearTimeout(fe.current[N]),fe.current[N]=setTimeout(()=>{ee(X=>{const se={...X};return delete se[N],se}),delete fe.current[N]},3e3))};f.useEffect(()=>()=>{Object.values(de.current).forEach(N=>{clearTimeout(N)}),Object.values(fe.current).forEach(N=>{clearTimeout(N)})},[]);const{searchTerm:Re,setSearchTerm:Ze,sortFields:g,handleSort:B,filteredAndSortedData:z,loading:Y,selectedTiers:I,selectedTypes:ne,showTierDropdown:ue,setShowTierDropdown:Z,showTypeDropdown:J,setShowTypeDropdown:oe,tierFilterRef:we,typeFilterRef:ke,uniqueTiers:We,uniqueTypes:rt,handleTierSelect:qe,handleTypeSelect:mt,isTierFiltered:ft,isTypeFiltered:Ct,getDropdownStyle:tr}=Zr(e,l,d,c,W,v),kt=f.useRef(Re),Et=f.useRef(JSON.stringify(I)),At=f.useRef(JSON.stringify(ne));f.useEffect(()=>{const N=kt.current!==Re,X=Et.current!==JSON.stringify(I),se=At.current!==JSON.stringify(ne);(N||X||se)&&(Ie(-1),te(null),kt.current=Re,Et.current=JSON.stringify(I),At.current=JSON.stringify(ne))},[Re,I,ne]),f.useEffect(()=>{if(n!=="adversaries")return;const N=X=>{const se=document.activeElement;if(se&&["INPUT","TEXTAREA","SELECT"].includes(se.tagName))if(X.key==="ArrowDown"||X.key==="ArrowUp"||X.key==="Enter")(X.key!=="Enter"||se.tagName!=="INPUT")&&se.blur();else return;const Ae=z.length-1;if(X.key==="ArrowDown")X.preventDefault(),Ie(ge=>{var Ce;const ve=ge<Ae?ge+1:ge;return ve>=0&&ve<z.length&&(te(((Ce=z[ve])==null?void 0:Ce.id)||null),he.current[ve]&&setTimeout(()=>{const ae=he.current[ve];if(ae){const le=ae.closest(".browser-content");if(le){const U=le.getBoundingClientRect(),xe=ae.getBoundingClientRect(),be=ae.nextElementSibling,ie=be&&be.tagName==="TR"&&be.querySelector("td[colspan]");let pe=xe.height;ie&&(pe+=be.getBoundingClientRect().height);const Ne=xe.bottom-U.top,me=U.height,Be=Ne>=me-1,Pe=xe.bottom>U.bottom;if(Be||Pe){let Te=ae.offsetTop+pe-me;const He=le.scrollHeight-me;Te=Math.min(Te,He),Te=Math.max(0,Te),le.scrollTo({top:Te,behavior:"smooth"})}}else ae.scrollIntoView({behavior:"smooth",block:"end"})}},0)),ve});else if(X.key==="ArrowUp")X.preventDefault(),Ie(ge=>{var Ce;if(ge<=0)return te(null),setTimeout(()=>{const ae=document.querySelector('.browser-header input[type="text"]');ae==null||ae.focus()},0),-1;const ve=ge-1;return ve>=0&&ve<z.length?(te(((Ce=z[ve])==null?void 0:Ce.id)||null),he.current[ve]&&setTimeout(()=>{const ae=he.current[ve];if(ae){const le=ae.closest(".browser-content");if(le){const U=le.getBoundingClientRect(),xe=ae.getBoundingClientRect(),be=(()=>{const me=ae.closest("table"),Be=me==null?void 0:me.querySelector("thead");return Be?Be.getBoundingClientRect().height:0})(),ie=xe.top-U.top,pe=Math.abs(ie-be)<=1;if(xe.top<U.top||pe){const me=ae.nextElementSibling,Be=me&&me.tagName==="TR"&&me.querySelector("td[colspan]");let Pe=xe.height;Be&&(Pe+=me.getBoundingClientRect().height);let Te=ae.offsetTop-be;const He=le.scrollHeight-le.clientHeight;Te=Math.min(Te,He),Te=Math.max(0,Te),le.scrollTo({top:Te,behavior:"smooth"})}}else ae.scrollIntoView({behavior:"smooth",block:"start"})}},0)):te(null),ve});else if(X.key==="Enter"&&ye>=0&&ye<=Ae){X.preventDefault();const ge=z[ye];ge&&a&&a(ge)}};return document.addEventListener("keydown",N),()=>{document.removeEventListener("keydown",N)}},[n,z,ye,a]);const rr=(()=>{const N=3*d+2,X=l.reduce((U,xe)=>{if(xe.type==="adversary"){const be=Xe[xe.item.type]||2;if(xe.item.type==="Minion"){const ie=Math.ceil(xe.quantity/d);return U+ie*be}else return U+xe.quantity*be}return U},0);let se=0;l.filter(U=>U.type==="adversary"&&U.item.type==="Solo"&&U.quantity>0).reduce((U,xe)=>U+xe.quantity,0)>=2&&(se+=Ve.twoOrMoreSolos);const ge=l.some(U=>U.type==="adversary"&&U.item.type==="Bruiser"&&U.quantity>0),ve=l.some(U=>U.type==="adversary"&&U.item.type==="Horde"&&U.quantity>0),Ce=l.some(U=>U.type==="adversary"&&U.item.type==="Leader"&&U.quantity>0),ae=l.some(U=>U.type==="adversary"&&U.item.type==="Solo"&&U.quantity>0);return!ge&&!ve&&!Ce&&!ae&&(se+=Ve.noBruisersHordesLeadersSolos),N+se-X})(),nr=N=>{A(N),M(!1)},or=k!=="all";return Y?t.jsx("div",{style:G.browser,children:t.jsx("div",{style:G.loading,children:"Loading..."})}):t.jsx(t.Fragment,{children:t.jsxs("div",{style:p?G.browserWrapper:G.browserWrapperNoContainer,children:[n==="adversaries"&&t.jsxs(t.Fragment,{children:[t.jsx(Ur,{searchTerm:Re,onSearchChange:Ze,type:e,partyControls:u,autoFocus:D,onClose:y,placeholder:H}),!E&&t.jsx(en,{showCustomToggle:K,onToggleCustom:F,filterCustom:W,onExportCustomAdversaries:ce,onImportCustomAdversaries:Ee}),t.jsx("div",{className:"browser-content invisible-scrollbar",style:G.browserContent,children:t.jsxs("table",{style:G.browserTable,children:[t.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,backgroundColor:"var(--bg-primary)"},children:t.jsx(tn,{sortFields:g,onSort:B,type:e,uniqueTiers:We,uniqueTypes:rt,selectedTiers:I,selectedTypes:ne,showTierDropdown:ue,setShowTierDropdown:Z,showTypeDropdown:J,setShowTypeDropdown:oe,tierFilterRef:we,typeFilterRef:ke,handleTierSelect:qe,handleTypeSelect:mt,isTierFiltered:ft,isTypeFiltered:Ct,getDropdownStyle:tr,costFilter:k,showCostDropdown:V,setShowCostDropdown:M,costFilterRef:ze,handleCostFilterSelect:nr,isCostFiltered:or})}),t.jsx("tbody",{children:z.map((N,X)=>t.jsx(rn,{item:N,onAdd:a,type:e,onRowClick:i,encounterItems:l,pcCount:d,playerTier:c,remainingBudget:rr,costFilter:k,isFocused:Le===N.id||ye===X,onDeleteCustomAdversary:e==="adversary"?Qe:null,isDeleteConfirmed:$[N.id]||!1,rowRef:se=>{se?he.current[X]=se:delete he.current[X]}},N.id))})]})})]}),n==="encounters"&&t.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:x.length===0?t.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",textAlign:"center",padding:"2rem 1rem"},children:"No saved encounters yet"}):t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:x.map(N=>t.jsxs("div",{onClick:()=>m&&m(N.id),className:"saved-encounter-card",style:{border:"1px solid var(--border)",borderRadius:"8px",padding:"8px",backgroundColor:"var(--bg-card)",transition:"background-color 0.2s ease",display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[t.jsxs("div",{style:{minWidth:"100px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",flexDirection:"column",justifyContent:"center",minHeight:"60px"},children:[t.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Tier: ",(()=>{var Ae,ge,ve,Ce;const X=((Ce=(ve=(ge=(Ae=N.encounterItems)==null?void 0:Ae.filter(ae=>ae.type==="adversary"))==null?void 0:ge.map(ae=>ae.item.tier))==null?void 0:ve.filter(ae=>ae!=null))==null?void 0:Ce.sort((ae,le)=>ae-le))||[];if(X.length===0)return"N/A";if(X.length===1)return X[0];const se=[...new Set(X)];return se.length===1?se[0]:`${Math.min(...se)}-${Math.max(...se)}`})()]}),t.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Party Size: ",N.partySize||4]}),t.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)"},children:["Balance: ",(()=>{const X=N.partySize||4,se=3*X+2;let Ae=0;const ge=N.encounterItems||[];ge.filter(ie=>ie.type==="adversary"&&ie.item.type==="Solo"&&ie.quantity>0).reduce((ie,pe)=>ie+pe.quantity,0)>=2&&(Ae+=Ve.twoOrMoreSolos);const Ce=ge.some(ie=>ie.type==="adversary"&&ie.item.type==="Bruiser"&&ie.quantity>0),ae=ge.some(ie=>ie.type==="adversary"&&ie.item.type==="Horde"&&ie.quantity>0),le=ge.some(ie=>ie.type==="adversary"&&ie.item.type==="Leader"&&ie.quantity>0),U=ge.some(ie=>ie.type==="adversary"&&ie.item.type==="Solo"&&ie.quantity>0);!Ce&&!ae&&!le&&!U&&(Ae+=Ve.noBruisersHordesLeadersSolos);const xe=se+Ae,be=ge.reduce((ie,pe)=>{if(pe.type==="adversary"){const Ne=Xe[pe.item.type]||2;if(pe.item.type==="Minion"){const me=Math.ceil(pe.quantity/X);return ie+me*Ne}else return ie+pe.quantity*Ne}return ie},0);return be>xe?`+${be-xe}`:be===xe?"0":`-${xe-be}`})()]})]}),t.jsx("div",{style:{minWidth:"120px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",alignItems:"center",minHeight:"60px"},children:t.jsx("div",{style:{fontWeight:"500",color:"var(--text-primary)",fontSize:"0.9rem",wordWrap:"break-word",wordBreak:"break-word",width:"150px",maxWidth:"150px"},children:N.name})}),t.jsx(Xr,{encounter:N}),t.jsx("button",{onClick:X=>{X.stopPropagation(),De(N.id)},style:{background:P[N.id]?"var(--danger)":"var(--gray-600)",border:"none",color:"white",padding:"0.4rem 0.8rem",borderRadius:"4px",fontSize:"0.75rem",cursor:"pointer",minWidth:"60px",transition:"background-color 0.2s"},children:"Delete"})]},N.id))})}),n==="create"&&t.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"1rem",display:"flex",justifyContent:"center",alignItems:"flex-start",height:"100%",minHeight:0},children:t.jsx("div",{style:{maxWidth:"600px",width:"100%",height:"auto",display:"flex",flexDirection:"column",padding:"0",overflowY:"visible",overflowX:"hidden",minHeight:0},children:t.jsx(jt,{onSave:Me,onRefresh:()=>{},onAddItem:a,editingAdversary:b,onCancelEdit:je,embedded:!1})})}),n==="info"&&t.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"2rem"},children:[t.jsxs("div",{style:{marginBottom:"2rem",textAlign:"center"},children:[t.jsx("img",{src:Kr,alt:"Daggerheart Community Content Logo",style:{width:"100%",maxWidth:"300px",height:"auto",margin:"0 auto 1.5rem auto",display:"block"},onError:N=>{console.error("Failed to load Daggerheart logo:",N.target.src),N.target.style.display="none"}}),t.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",textAlign:"left",maxWidth:"600px",margin:"0 auto"},children:[t.jsx("p",{style:{marginTop:0},children:"This product includes materials from the Daggerheart System Reference Document 1.0, © Critical Role, LLC, under the terms of the Darrington Press Community Gaming (DPCGL) License."}),t.jsxs("p",{children:["More information can be found at ",t.jsx("a",{href:"https://www.daggerheart.com",target:"_blank",rel:"noopener noreferrer",style:{color:"var(--purple)",textDecoration:"underline"},children:"daggerheart.com"})]}),t.jsx("p",{style:{marginBottom:0},children:t.jsx("em",{children:"This project is unofficial and not endorsed by Darrington Press or Critical Role."})})]})]}),t.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto",border:"1px solid var(--border)",borderRadius:"8px",overflow:"hidden"},children:[t.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"1rem 1.5rem",color:"var(--text-primary)",border:"none",background:"var(--bg-secondary)",width:"100%",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"0.875rem",borderBottom:"1px solid var(--border)"},onMouseEnter:N=>{N.target.style.backgroundColor="var(--bg-hover)"},onMouseLeave:N=>{N.target.style.backgroundColor="var(--bg-secondary)"},onClick:N=>{N.stopPropagation(),window.open("https://github.com/Splinter714/Daggerheart","_blank")},children:[t.jsx("span",{children:"View on GitHub"}),t.jsx("span",{children:"→"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem 1.5rem",color:"var(--text-secondary)",background:"var(--bg-secondary)",fontSize:"0.875rem"},children:["Version ","0.4.16 (681c01e)"]})]})]})]})})},G={browserWrapper:{display:"flex",flexDirection:"column",background:"var(--bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border)",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserWrapperNoContainer:{display:"flex",flexDirection:"column",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserContent:{flex:1,overflowY:"auto",overflowX:"visible",padding:0,width:"100%",scrollbarWidth:"none",msOverflowStyle:"none",borderRadius:"0 0 8px 8px"},tableHeaderContainer:{flexShrink:0,position:"sticky",top:0,zIndex:15,backgroundColor:"var(--bg-secondary)"},browserTable:{width:"100%",minWidth:"100%",borderCollapse:"collapse",tableLayout:"fixed",background:"var(--bg-primary)",margin:0},browserHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--gray-900)",flexShrink:0,position:"sticky",top:0,zIndex:20},browserTitle:{margin:0,color:"var(--text-primary)",fontSize:"18px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"24px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",marginRight:"12px",transition:"all 0.2s ease"},partyControls:{display:"flex",alignItems:"center",gap:"12px",flexShrink:0},searchInputFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 3px rgba(139, 92, 246, 0.1)"},tableHeader:{background:"var(--gray-900)",borderBottom:"1px solid var(--border)",boxShadow:"0 1px 0 var(--border)",position:"sticky",top:"0",zIndex:10},tableHeaderCell:{backgroundColor:"var(--gray-900)",fontWeight:"700",borderBottom:"1px solid var(--border)",cursor:"pointer",userSelect:"none",minWidth:"100px",whiteSpace:"nowrap",padding:"4px 4px",color:"var(--text-primary)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",boxShadow:"0 1px 0 var(--border)",transition:"background-color 0.2s",position:"sticky",top:"0",zIndex:10},tableHeaderCellHover:{backgroundColor:"var(--bg-hover)"},sortIndicator:{fontSize:"12px",color:"var(--text-secondary)"},tableBody:{flex:1,overflowY:"auto",padding:"8px",backgroundColor:"var(--bg-primary)"},row:{height:"auto",minHeight:"35px",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s ease",cursor:"pointer",backgroundColor:"var(--gray-900)"},rowHover:{backgroundColor:"var(--bg-secondary)"},rowFocused:{backgroundColor:"var(--bg-secondary)",boxShadow:"inset 0 0 0 2px var(--purple)"},expandedRow:{backgroundColor:"var(--bg-secondary)"},rowCell:{padding:"4px 4px",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid var(--border)"},rowCellName:{fontWeight:"500",minWidth:"150px"},rowCellCenter:{textAlign:"center",justifyContent:"center",minWidth:"80px"},rowActions:{width:"80px",textAlign:"center",padding:"4px 8px",borderBottom:"1px solid var(--border)"},addButton:{width:"2rem",height:"2rem",border:"1px solid var(--purple)",borderRadius:"var(--radius-sm)",background:"var(--purple)",color:"white",cursor:"pointer",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"500"},expandedContent:{padding:"0",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)"},columnName:{width:"auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",paddingLeft:"8px",textAlign:"left"},columnTier:{width:"80px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnType:{width:"100px",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},columnDifficulty:{width:"40px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnAction:{width:"32px",minWidth:"24px",maxWidth:"24px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"visible",textOverflow:"unset"},loading:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"var(--text-primary)",fontSize:"16px"},mobileBrowser:{width:"95vw",height:"90vh",maxWidth:"none"},mobileSearchInput:{fontSize:"16px"},headerWithFilter:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0px",position:"relative"},headerFilterIcon:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"2px 4px",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",position:"relative",marginLeft:"-2px"},headerFilterIconActive:{color:"var(--purple)"},filterIcon:{fontSize:"12px"},filterActiveDot:{position:"absolute",left:"50%",top:"2px",transform:"translateX(-50%)",width:"4px",height:"4px",borderRadius:"50%",background:"var(--purple)",pointerEvents:"none"},filterDropdown:{position:"fixed",background:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",zIndex:99999,marginTop:"4px",overflow:"hidden",width:"max-content",minWidth:"120px",maxWidth:"200px"},filterOption:{padding:"8px 12px",cursor:"pointer",color:"var(--text-primary)",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background-color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},filterOptionSelected:{backgroundColor:"var(--bg-hover)"},checkIcon:{width:"16px",height:"16px",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"12px"},filterLabel:{flex:1}},nn=({isOpen:e,onClose:a,onAddAdversary:o,onAddAdversariesBulk:i,onAddEnvironment:l,onDeleteAdversary:d,onDeleteEnvironment:c,onDeleteCountdown:u,adversaries:p=[],environments:x=[],countdowns:m=[],savedEncounters:r=[],onSaveEncounter:n,onLoadEncounter:s,onDeleteEncounter:h})=>{const{partySize:w,updatePartySize:S,currentEncounterName:O,updateCurrentEncounterName:W,customContent:K}=pt(),F=w,_=S,[L,D]=f.useState({lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),[E,y]=f.useState([]),[H,Q]=f.useState(O||"Encounter"),[R,j]=f.useState("adversaries"),[v,C]=f.useState(null),[q,b]=f.useState(null),[T,k]=f.useState(null),[A,V]=f.useState(null),[M,P]=f.useState(!1);f.useEffect(()=>{e&&!v&&Q(O||"Encounter")},[e,v,O]);const re=()=>q?H!==q.name||JSON.stringify(E)!==JSON.stringify(q.encounterItems)||F!==q.partySize||JSON.stringify(L)!==JSON.stringify(q.battlePointsAdjustments):!1,$=()=>{var g;if(E.length>0||(H||"").trim()!=="Encounter")return!0;if(v&&re()){if(q){const B=E.length,z=((g=q.encounterItems)==null?void 0:g.length)||0;if(B!==z||(H||"").trim()!==(q.name||""))return!0;const Y=JSON.stringify(L),I=JSON.stringify(q.battlePointsAdjustments||{});return Y!==I}return!0}return!1},ee=({onClick:g,children:B,variant:z="secondary",isConfirmation:Y=!1})=>{const I=z==="danger"||z==="secondary"&&Y,ne=z==="purple";return t.jsx("button",{onClick:g,style:{background:I?"var(--danger)":ne?"var(--purple)":"var(--bg-secondary)",border:ne?"none":"1px solid var(--border)",color:I||ne?"white":"var(--text-primary)",padding:"0.375rem 0.75rem",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s",width:"70px",fontSize:"0.875rem"},children:B})},de=_e.useRef(F),fe=f.useCallback(g=>!g||g.length===0?null:r.find(z=>{var ue,Z;if(((ue=z.encounterItems)==null?void 0:ue.length)!==g.length)return!1;const Y=J=>{var oe;return{type:J.type,quantity:J.quantity,item:{name:J.item.baseName||((oe=J.item.name)==null?void 0:oe.replace(/\s+\(\d+\)$/,""))||J.item.name,type:J.item.type,tier:J.item.tier}}},I=(Z=z.encounterItems)==null?void 0:Z.map(Y).sort((J,oe)=>J.item.name.localeCompare(oe.item.name)||J.item.type.localeCompare(oe.item.type)),ne=g.map(Y).sort((J,oe)=>J.item.name.localeCompare(oe.item.name)||J.item.type.localeCompare(oe.item.type));return JSON.stringify(I)===JSON.stringify(ne)})||null,[r]);_e.useEffect(()=>{if(e&&p.length>0&&E.length===0){const g={};p.forEach(Y=>{var ne;const I=Y.baseName||((ne=Y.name)==null?void 0:ne.replace(/\s+\(\d+\)$/,""))||Y.name;g[I]||(g[I]={type:"adversary",item:Y,quantity:0}),g[I].quantity+=1});const B=Object.values(g);y(B);const z=fe(B);z&&!v&&(C(z.id),b({name:z.name||"",encounterItems:z.encounterItems||[],partySize:z.partySize||4,battlePointsAdjustments:z.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),Q(z.name||"Encounter"),W(z.name||"Encounter"))}else e&&p.length===0&&E.length===0&&y([])},[e,fe,v,W]);const ze=_e.useMemo(()=>Zt(E),[E]),ye=Gr(F,L)+ze,Ie=Qt(E,F);_e.useEffect(()=>{const g=de.current;g!==F&&(y(B=>B.map(z=>{if(z.type==="adversary"&&z.item.type==="Minion"){const I=Math.ceil(z.quantity/g)*F;return{...z,quantity:I}}return z})),de.current=F)},[F]);const Le=(g,B)=>{const z=E.findIndex(ne=>ne.item.id===g.id&&ne.type===B),Y=g.type==="Minion"?F:1;let I;z>=0?I=E.map((ne,ue)=>ue===z?{...ne,quantity:ne.quantity+Y}:ne):I=[...E,{item:g,type:B,quantity:Y}],y(I),te(I)},te=g=>{const B=p||[],z=[];g.forEach(Z=>{for(let J=0;J<Z.quantity;J++)Z.type==="adversary"&&z.push(Z.item)});const Y={};B.forEach(Z=>{var oe;const J=Z.baseName||((oe=Z.name)==null?void 0:oe.replace(/\s+\(\d+\)$/,""))||Z.name;Y[J]||(Y[J]=[]),Y[J].push(Z)});const I={};z.forEach(Z=>{var oe;const J=Z.baseName||((oe=Z.name)==null?void 0:oe.replace(/\s+\(\d+\)$/,""))||Z.name;I[J]||(I[J]=[]),I[J].push(Z)});const ne=[],ue=[];Object.keys(I).forEach(Z=>{var we;const J=((we=Y[Z])==null?void 0:we.length)||0,oe=I[Z].length;if(oe>J){const ke=oe-J;for(let We=0;We<ke;We++)ne.push(I[Z][0])}else if(oe<J){const ke=J-oe,rt=[...Y[Z]].sort((qe,mt)=>{const ft=qe.duplicateNumber||1;return(mt.duplicateNumber||1)-ft});for(let qe=0;qe<ke;qe++)ue.push(rt[qe].id)}}),Object.keys(Y).forEach(Z=>{I[Z]||[...Y[Z]].sort((we,ke)=>{const We=we.duplicateNumber||1;return(ke.duplicateNumber||1)-We}).forEach(we=>{ue.push(we.id)})}),ue.forEach(Z=>{d(Z)}),ne.length>0&&i(ne)},he=(g,B)=>{const z=(()=>{const Y=E.findIndex(I=>I.item.id===g&&I.type===B);if(Y>=0){const I=E[Y];if(I.quantity===0)return E.filter((Z,J)=>J!==Y);const ne=I.item.type==="Minion"?F:1,ue=Math.max(0,I.quantity-ne);return E.map((Z,J)=>J===Y?{...Z,quantity:ue}:Z)}return E})();y(z),te(z)},ce=f.useCallback(()=>{if(E.length===0)return null;const g=(H||"").trim()||"Encounter",B=r.find(z=>{var ne,ue;if(z.name!==g||((ne=z.encounterItems)==null?void 0:ne.length)!==E.length)return!1;const Y=JSON.stringify((ue=z.encounterItems)==null?void 0:ue.sort()),I=JSON.stringify([...E].sort());return Y===I});return(B==null?void 0:B.id)||null},[r,H,E]),Ee=f.useCallback(()=>{let g=(H||"").trim(),B=v;if(B||(B=ce()),E.length===0&&(!g||g==="Encounter")&&B){h(B),C(null),b(null);return}const z={name:g,encounterItems:E,partySize:F,battlePointsAdjustments:L};if(B){z.id=B;const Y=n(z);C(Y)}else{const Y=n(z);C(Y)}b({name:g,encounterItems:E,partySize:F,battlePointsAdjustments:L})},[E,H,F,L,v,n,ce,h]);f.useEffect(()=>{if(v&&re()){const g=setTimeout(()=>{Ee()},2e3);return()=>clearTimeout(g)}else if(!v&&E.length>0&&H&&H.trim()!==""){const g=setTimeout(()=>{Ee()},2e3);return()=>clearTimeout(g)}},[E,v,H,L,F]);const je=()=>{$()&&(y([]),Q("Encounter"),W("Encounter"),C(null),b(null),p.forEach(g=>{d(g.id)}),x.forEach(g=>{c(g.id)}),m.forEach(g=>{u(g.id)}))},Me=g=>{const B=s(g);if(B){const z=B.encounterItems||[];y(z),_(B.partySize||4),D(B.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),Q(B.name||""),W(B.name||""),C(g),b({name:B.name||"",encounterItems:B.encounterItems||[],partySize:B.partySize||4,battlePointsAdjustments:B.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),te(z)}},De=g=>{h(g),v===g&&(y([]),Q("Encounter"),W("Encounter"),C(null),b(null),p.forEach(B=>{d(B.id)}),x.forEach(B=>{c(B.id)}),m.forEach(B=>{u(B.id)}))},Qe=()=>{try{const g={version:"1.0",exportDate:new Date().toISOString(),customAdversaries:K.adversaries||[]},B=JSON.stringify(g,null,2),z=new Blob([B],{type:"application/json"}),Y=URL.createObjectURL(z),I=document.createElement("a");I.href=Y,I.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(I),I.click(),document.body.removeChild(I),URL.revokeObjectURL(Y),console.log("Custom adversaries exported successfully")}catch(g){console.error("Failed to export custom adversaries:",g),alert("Failed to export custom adversaries. Please try again.")}},Re=g=>{const B=g.target.files[0];if(!B)return;const z=new FileReader;z.onload=Y=>{try{const I=JSON.parse(Y.target.result);if(!I.customAdversaries||!Array.isArray(I.customAdversaries))throw new Error("Invalid file format. Expected customAdversaries array.");const ne=K.adversaries||[],ue=I.customAdversaries,Z=[...ne];let J=0;ue.forEach(oe=>{ne.some(ke=>ke.name===oe.name&&ke.type===oe.type)||(Z.push({...oe,id:`custom-${Date.now()}-${Math.random().toString(36).slice(2,10)}`}),J++)}),updateCustomContent("adversary",null,Z),J>0?alert(`Successfully imported ${J} custom adversaries.`):alert("No new adversaries were added. All imported adversaries already exist.")}catch(I){console.error("Failed to import custom adversaries:",I),alert("Failed to import custom adversaries. Please check the file format and try again.")}},z.readAsText(B),g.target.value=""};if(!e)return null;const Ze=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://");return t.jsx("div",{onClick:a,className:"encounter-builder-modal",style:{position:"fixed",top:0,left:0,right:0,bottom:Ze?"calc(60px + env(safe-area-inset-bottom) + 1rem)":"calc(60px + env(safe-area-inset-bottom))",backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:1e3,display:"flex",alignItems:"flex-start",justifyContent:"center",padding:"12px"},children:t.jsxs("div",{onClick:g=>g.stopPropagation(),style:{backgroundColor:"var(--bg-primary)",border:"2px solid var(--border)",borderRadius:"12px",width:"100%",maxWidth:"1200px",height:"100%",maxHeight:"100%",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"},children:[t.jsxs("div",{className:"encounter-top-bar",style:{flex:"0 0 auto",display:"flex",alignItems:"center",height:"39px",backgroundColor:"var(--bg-primary)",borderBottom:"1px solid var(--border)"},children:[t.jsx("button",{onClick:()=>j("adversaries"),style:{flex:1,background:R==="adversaries"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:R==="adversaries"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Builder"}),t.jsx("button",{onClick:()=>j("encounters"),style:{flex:1,background:R==="encounters"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:R==="encounters"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Saved Encounters"}),t.jsx("button",{onClick:()=>j("create"),style:{flex:1,background:R==="create"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:R==="create"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Create Adversary"}),t.jsx("button",{onClick:()=>j("info"),style:{flex:1,background:R==="info"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:R==="info"?"500":"400",transition:"all 0.2s ease",position:"relative"},children:"Info"})]}),t.jsxs("div",{className:"encounter-builder-content",style:{flex:1,display:"flex",overflow:"hidden"},children:[t.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",borderTop:"1px solid var(--border)"},children:t.jsx(er,{type:"adversary",onAddItem:g=>Le(g,"adversary"),encounterItems:E,pcCount:F,showContainer:!1,savedEncounters:r,onLoadEncounter:Me,onDeleteEncounter:De,activeTab:R,selectedCustomAdversaryId:T,onSelectCustomAdversary:k,onTabChange:j,selectedAdversary:A,onSelectAdversary:V,filterCustom:M,showCustomToggle:!0,onToggleCustom:P,onExportCustomAdversaries:Qe,onImportCustomAdversaries:Re})}),R!=="info"&&t.jsxs("div",{className:"encounter-right-panel",style:{flex:1,borderLeft:"1px solid var(--border)",display:"flex",flexDirection:"column",overflow:"hidden",position:"relative"},children:[A&&t.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"var(--bg-primary)",zIndex:10,display:"flex",flexDirection:"column"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)",flexShrink:0},children:[t.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:0},children:"Adversary Preview"}),t.jsx("button",{onClick:()=>V(null),style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease"},onMouseEnter:g=>g.target.style.color="var(--text-primary)",onMouseLeave:g=>g.target.style.color="var(--text-secondary)",title:"Close preview",children:t.jsx(tt,{size:16})})]}),t.jsx("div",{style:{flex:1,overflowY:"auto",padding:"0.75rem"},children:t.jsx(ct,{item:{...A,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...A,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}})})]}),(R==="adversaries"||R==="encounters")&&t.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-primary)",flexShrink:0},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[t.jsx("input",{type:"text",value:H,onChange:g=>{Q(g.target.value),W(g.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),t.jsx(ee,{onClick:je,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:$()?1:.5,cursor:$()?"pointer":"not-allowed"},children:"New"})]})}),(R==="adversaries"||R==="encounters")&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"encounter-receipt-buttons-vertical",style:{display:"none",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[t.jsx("input",{type:"text",value:H,onChange:g=>{Q(g.target.value),W(g.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),t.jsx(ee,{onClick:je,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:$()?1:.5,cursor:$()?"pointer":"not-allowed"},children:"New"})]})}),t.jsx("div",{className:"receipt-content",style:{padding:"1rem",display:"flex",flexDirection:"column",height:"100%"},children:t.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"flex-start",overflowY:"auto",marginBottom:"0.75rem"},children:[t.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[t.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[t.jsx("button",{onClick:()=>_(Math.max(1,F-1)),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:t.jsx(lt,{size:10})}),t.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:F}),t.jsx("button",{onClick:()=>_(F+1),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:t.jsx(Je,{size:10})})]}),t.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Party Size"})}),t.jsx("div",{style:{width:"120px",textAlign:"right"}})]}),E.map(g=>{var B;return g.type!=="adversary"?null:t.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[t.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[t.jsx("button",{onClick:()=>he(g.item.id,g.type),style:{background:g.quantity===0?"var(--danger)":"var(--bg-secondary)",border:g.quantity===0?"none":"1px solid var(--border)",color:g.quantity===0?"white":"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:g.quantity===0?t.jsx(tt,{size:10}):t.jsx(lt,{size:10})}),t.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:g.quantity}),t.jsx("button",{onClick:()=>Le(g.item,g.type),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:t.jsx(Je,{size:10})})]}),t.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:g.item.baseName||((B=g.item.name)==null?void 0:B.replace(/\s+\(\d+\)$/,""))||g.item.name})}),t.jsx("div",{style:{width:"80px",textAlign:"right"},children:t.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.8rem"},children:g.item.type})})]},`${g.item.id}-${g.type}`)}),t.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[t.jsx("div",{style:{flex:1,display:"flex",alignItems:"center"},children:t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Balance"})}),t.jsx("div",{style:{width:"120px",textAlign:"right",display:"flex",alignItems:"center",justifyContent:"flex-end"},children:t.jsx("span",{style:{color:Ie>ye?"var(--danger)":Ie===ye?"var(--purple)":"var(--success)",fontWeight:600},children:Ie>ye?`+${Ie-ye}`:ye-Ie===0?"0":`-${ye-Ie}`})})]})]})})]}),R==="create"&&t.jsxs("div",{style:{padding:"1.5rem",overflowY:"auto",height:"100%"},children:[t.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Creating Adversaries"}),t.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",display:"flex",flexDirection:"column",gap:"1rem"},children:[t.jsx("p",{children:"Use the form to create custom adversaries for your encounters."}),t.jsxs("div",{children:[t.jsx("strong",{style:{color:"var(--text-primary)"},children:"Adversary Types:"}),t.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Minion (1 BP):"})," Weak enemies in groups"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Standard (2 BP):"})," Average threat level"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Leader (3 BP):"})," Commands others"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Bruiser (4 BP):"})," High HP tank"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Solo (5 BP):"})," Boss-level threat"]})]})]}),t.jsxs("div",{children:[t.jsx("strong",{style:{color:"var(--text-primary)"},children:"Tips:"}),t.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[t.jsx("li",{children:"Match adversary tier to party level"}),t.jsx("li",{children:"Balance encounter difficulty with Battle Points"}),t.jsx("li",{children:"Mix adversary types for variety"}),t.jsx("li",{children:"Add features that create interesting choices"})]})]})]})]}),R==="myAdversaries"&&t.jsx("div",{style:{padding:"0.75rem",overflowY:"auto",height:"100%"},children:T?(()=>{var B;const g=(B=K==null?void 0:K.adversaries)==null?void 0:B.find(z=>z.id===T);return g?t.jsx(ct,{item:{...g,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...g,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}}):t.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Adversary not found"})})():t.jsxs("div",{children:[t.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Adversary Preview"}),t.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Select an adversary to view details"})]})})]})]})]})})},on=({browserOpenAtPosition:e,handleCloseBrowser:a,handleOpenBrowser:o,getEntityGroups:i,fear:l,updateFear:d})=>{const c=f.useRef(!1),u=f.useRef(null),p=f.useRef(null),x=f.useMemo(()=>({"shift+space":()=>{if(e!==null)a();else{const r=i();o(r.length)}},escape:()=>{e!==null&&a()},"+":()=>{const r=(l==null?void 0:l.value)||0,n=Math.min(12,r+1);d(n)},"=":()=>{const r=(l==null?void 0:l.value)||0,n=Math.min(12,r+1);d(n)},"-":()=>{const r=(l==null?void 0:l.value)||0,n=Math.max(0,r-1);d(n)},_:()=>{const r=(l==null?void 0:l.value)||0,n=Math.max(0,r-1);d(n)}}),[e,a,o,i,l,d]),m=f.useCallback(r=>{var F;if(window.matchMedia("(max-width: 800px)").matches)return;const s=r.key===" "||r.key==="Space"||r.code==="Space";if(r.shiftKey&&s&&!r.ctrlKey&&!r.metaKey&&!r.altKey){if(console.log("[Keyboard] Shift+Space detected, toggling browser"),r.preventDefault(),r.stopPropagation(),r.stopImmediatePropagation(),e!==null)a();else{const _=i();o(_.length)}return}const w=document.activeElement;if(w&&["INPUT","TEXTAREA","SELECT"].includes(w.tagName)){const _=r.key==="Escape",L=r.shiftKey&&s&&!r.ctrlKey&&!r.metaKey&&!r.altKey;if(!_&&!L)return}const O=[];(r.ctrlKey||r.metaKey)&&O.push("ctrl"),r.shiftKey&&O.push("shift"),r.altKey&&O.push("alt");let W=r.key.toLowerCase();W===" "&&(W="space"),O.push(W);const K=O.join("+");if(x[K]){r.preventDefault(),x[K](r);return}if(!r.ctrlKey&&!r.metaKey&&!r.shiftKey&&!r.altKey&&x[W]){r.preventDefault(),x[W](r);return}if(!r.ctrlKey&&!r.metaKey&&!r.shiftKey&&!r.altKey&&(r.key==="ArrowLeft"||r.key==="ArrowRight")){const _=document.activeElement;if(_&&["INPUT","TEXTAREA","SELECT"].includes(_.tagName))return;const L=document.querySelector(".dashboard-scroll-container");if(L){r.preventDefault(),console.log("[Keyboard] Dashboard scroll requested:",{key:r.key,currentScrollLeft:L.scrollLeft,containerWidth:L.clientWidth,scrollWidth:L.scrollWidth,scrollInProgress:c.current,browserOpen:e!==null});const D=Array.from(L.children).filter(E=>getComputedStyle(E).scrollSnapAlign!=="none");if(console.log("[Keyboard] Found panels:",{totalPanels:D.length,panelDetails:D.map((E,y)=>({index:y,offsetLeft:E.offsetLeft,offsetWidth:E.offsetWidth,scrollSnapAlign:getComputedStyle(E).scrollSnapAlign}))}),D.length>0){const E=L.scrollLeft;let y=0,H=1/0;D.forEach((j,v)=>{const C=j.offsetLeft,q=Math.abs(C-E);q<H&&(H=q,y=v)}),console.log("[Keyboard] Panel detection:",{currentScroll:E,currentPanelIndex:y,currentPanelOffsetLeft:(F=D[y])==null?void 0:F.offsetLeft,minDistance:H,allPanels:D.map((j,v)=>({index:v,offsetLeft:j.offsetLeft,distance:Math.abs(j.offsetLeft-E)}))});const Q=r.key==="ArrowLeft"?-1:1,R=y+Q;if(console.log("[Keyboard] Scrolling decision:",{scrollDirection:Q,currentPanelIndex:y,nextPanelIndex:R,canScroll:R>=0&&R<D.length}),R>=0&&R<D.length){const j=D[R],v=j.offsetLeft;console.log("[Keyboard] Scrolling to panel:",{index:R,offsetLeft:j.offsetLeft,offsetWidth:j.offsetWidth,targetScrollPosition:v,currentScroll:E,scrollInProgress:c.current}),u.current&&(clearTimeout(u.current),u.current=null),p.current=R,c.current?(console.log("[Keyboard] Redirecting scroll to new target",{previousTarget:p.current,newTarget:R,targetScrollPosition:v}),L.scrollTo({left:v,behavior:"smooth"})):(c.current=!0,j.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"})),u.current=setTimeout(()=>{if(p.current===R){const C=L.scrollLeft,q=j.offsetLeft,b=Math.abs(C-q);b>.5&&(console.log("[Keyboard] Correcting misalignment:",{finalScroll:C,expectedScroll:q,misalignment:b}),L.scrollTo({left:q,behavior:"auto"})),c.current=!1,p.current=null,console.log("[Keyboard] Scroll after action:",{newScrollLeft:L.scrollLeft,targetScrollPosition:v,difference:L.scrollLeft-E,actualDifference:L.scrollLeft-v,misalignment:b})}u.current=null},600)}else console.log("[Keyboard] Cannot scroll - panel index out of bounds")}else{console.log("[Keyboard] No panels found, using fallback scroll");const E=L.firstElementChild;if(E){const y=E.offsetWidth,H=r.key==="ArrowLeft"?-1:1;L.scrollBy({left:y*H,behavior:"smooth"})}}}else console.log("[Keyboard] Scroll container not found")}},[x,e,a,o,i]);f.useEffect(()=>(document.addEventListener("keydown",m,!0),()=>{document.removeEventListener("keydown",m,!0)}),[m])},sn=({position:e="top",children:a,onClick:o,className:i="",style:l={}})=>{const d=e==="top",c=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://"),u={background:"var(--bg-primary)",borderTop:d?"none":"1px solid var(--border)",borderBottom:d?"1px solid var(--border)":"none",padding:d?"0.25rem 0":"0.5rem",paddingBottom:d?"0.25rem":c?"calc(0.5rem + env(safe-area-inset-bottom) + 1rem)":"calc(0.5rem + env(safe-area-inset-bottom))",position:d?"relative":"sticky",[d?"top":"bottom"]:0,zIndex:d?10:100,order:d?1:3,flexShrink:0,touchAction:"manipulation",userSelect:"none",display:"flex",flexDirection:d?"column":"row",justifyContent:d?"stretch":"center",alignItems:d?"stretch":"center",gap:d?"0":"1rem",height:d?"auto":"60px",...l};return t.jsx("div",{className:i,style:u,onClick:o,children:a})},an=({fearValue:e,onUpdateFear:a,onToggleBrowser:o,isBrowserOpen:i})=>t.jsx(sn,{position:"top",children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",width:"100%",justifyContent:"space-between",padding:"0 1rem"},children:[t.jsx(dt,{type:"fear",value:e,maxValue:12,onChange:a,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0}),t.jsx("button",{onClick:o,title:i?"Close Browser":"Add Adversaries",style:{width:"36px",height:"36px",padding:0,backgroundColor:i?"var(--purple)":"transparent",border:"1px solid var(--border)",borderRadius:"50%",color:i?"white":"var(--text-primary)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",flexShrink:0},onMouseEnter:l=>{i||(l.currentTarget.style.borderColor="var(--purple)",l.currentTarget.style.backgroundColor="var(--bg-secondary)")},onMouseLeave:l=>{i||(l.currentTarget.style.borderColor="var(--border)",l.currentTarget.style.backgroundColor="transparent")},children:t.jsx(Je,{size:18})})]})}),ln=({isOpen:e,columnWidth:a,onClose:o,onCreateCustomAdversary:i,pcCount:l,updatePartySize:d,availableBattlePoints:c,spentBattlePoints:u,browserActiveTab:p,onTabChange:x,savedEncounters:m,loadEncounter:r,deleteEncounter:n,selectedCustomAdversaryId:s,onSelectCustomAdversary:h,onAddAdversaryFromBrowser:w})=>e?t.jsx("div",{style:{position:"absolute",top:`${Se}px`,right:`${Se}px`,bottom:`${Se}px`,width:`${a}px`,zIndex:100,overflow:"visible"},children:t.jsx(wt,{tabContent:t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:i,style:{padding:"0.375rem 0.75rem",backgroundColor:"var(--purple)",border:"none",color:"white",borderRadius:"4px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",transition:"opacity 0.2s ease"},onMouseEnter:S=>{S.currentTarget.style.opacity="0.9"},onMouseLeave:S=>{S.currentTarget.style.opacity="1"},children:[t.jsx(Je,{size:16}),t.jsx("span",{children:"Add Custom"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:"500"},children:"Party Size:"}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",border:"1px solid var(--border)",borderRadius:"4px",padding:"0.125rem 0.25rem",backgroundColor:"var(--bg-secondary)"},children:[t.jsx("button",{onClick:()=>d(Math.max(1,l-1)),style:{background:"transparent",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:0,display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem"},onMouseEnter:S=>{S.currentTarget.style.color="var(--purple)"},onMouseLeave:S=>{S.currentTarget.style.color="var(--text-primary)"},children:t.jsx(lt,{size:12})}),t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:"500",minWidth:"1.5rem",textAlign:"center"},children:l}),t.jsx("button",{onClick:()=>d(l+1),style:{background:"transparent",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:0,display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem"},onMouseEnter:S=>{S.currentTarget.style.color="var(--purple)"},onMouseLeave:S=>{S.currentTarget.style.color="var(--text-primary)"},children:t.jsx(Je,{size:12})})]})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:"500"},children:"Balance:"}),t.jsx("span",{style:{color:u>c?"var(--danger)":u===c?"var(--purple)":"var(--success)",fontWeight:600,fontSize:"0.875rem"},children:u>c?`+${u-c}`:c-u===0?"0":`-${c-u}`})]}),o&&t.jsx("button",{onClick:o,style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease",flexShrink:0},onMouseEnter:S=>S.currentTarget.style.color="var(--text-primary)",onMouseLeave:S=>S.currentTarget.style.color="var(--text-secondary)",title:"Close browser",children:t.jsx(tt,{size:16})})]}),showTab:!0,tabBackgroundColor:"var(--bg-primary)",tabBorderColor:"var(--border)",tabJustifyContent:"space-between",containerBackgroundColor:"var(--bg-primary)",containerBorderColor:"var(--border)",containerBorderRadius:"8px",containerBoxShadow:"-4px 0 12px rgba(0, 0, 0, 0.3)",containerOverflow:"hidden",reserveTabSpace:!0,containerStyle:{height:"100%"},children:t.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,display:"flex",flexDirection:"column",width:"100%",minWidth:0},children:t.jsx(er,{type:"adversary",onAddItem:w,showContainer:!1,activeTab:p,onTabChange:x,pcCount:l,savedEncounters:m,onLoadEncounter:r,onDeleteEncounter:n,selectedCustomAdversaryId:s,onSelectCustomAdversary:h,autoFocus:!0,hideImportExport:!0,onClose:o,searchPlaceholder:"Search adversaries"})})})}):null,yt=({side:e="left",children:a,className:o="",style:i={}})=>{const l=e==="left",d={flex:1,minWidth:0,background:"var(--bg-primary)",overflowY:"auto",overflowX:l?"auto":"hidden",display:l?"block":"flex",flexDirection:l?"initial":"column",height:"100%",padding:l?"8px 0 8px 0":"0 8px 0 0",...i};return t.jsx("div",{className:o,style:d,children:a})},dn=({entityGroups:e,columnWidth:a,scrollContainerRef:o,onScroll:i,newCards:l,removingCardSpacer:d,spacerShrinking:c,browserOpenAtPosition:u,editingAdversaryId:p,handleSaveCustomAdversary:x,handleCancelEdit:m,updateAdversary:r,updateEnvironment:n,updateCountdown:s,adversaries:h,handleEditAdversary:w,createAdversary:S,createAdversariesBulk:O,pcCount:W,smoothScrollTo:K,getEntityGroups:F,deleteAdversary:_,setRemovingCardSpacer:L,setSpacerShrinking:D})=>t.jsxs("div",{ref:o,className:"dashboard-scroll-container",onScroll:i,children:[e.length===0?null:(()=>{const E=[];if(e.forEach((y,H)=>{var R,j,v;if(d&&d.baseName===y.baseName&&y.type==="adversary"){E.push(t.jsx(yt,{style:{width:c?"0px":`${a}px`,flexShrink:0,flexGrow:0,flex:"none",paddingRight:"0",paddingTop:c?"0px":`${Se}px`,paddingBottom:c?"0px":`${Se}px`,scrollSnapAlign:"none",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"100%",opacity:0,transition:"width 0.3s ease, padding-top 0.3s ease, padding-bottom 0.3s ease"}},`spacer-${d.baseName}`));return}E.push(t.jsx(yt,{className:H===0?"dashboard-column dashboard-column--first":H===e.length-1?"dashboard-column dashboard-column--last":"dashboard-column",style:{width:`${a}px`,flexShrink:0,flexGrow:0,flex:"none",paddingRight:"0",paddingTop:`${y.type==="adversary"?Se+ot:Se}px`,paddingBottom:`${Se}px`,scrollSnapAlign:"start",overflow:y.type==="adversary"?"visible":"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"auto",opacity:l.has(`${y.type}-${y.baseName}`)?0:1,transition:"opacity 0.2s ease"},children:t.jsx(ct,{type:y.type,item:{...y.instances[0],name:((R=y.instances[0])==null?void 0:R.name)||y.baseName,hp:0,stress:0,isDead:!1},mode:"expanded",instances:y.instances,showCustomCreator:y.type==="adversary"&&p&&y.instances.some(C=>C.id===p),onSaveCustomAdversary:y.type==="adversary"&&p&&y.instances.some(C=>C.id===p)?x:void 0,onCancelEdit:y.type==="adversary"&&p&&y.instances.some(C=>C.id===p)?m:void 0,isStockAdversary:y.type==="adversary"&&p&&y.instances.some(C=>C.id===p)?!((j=y.instances[0])!=null&&j.source)||((v=y.instances[0])==null?void 0:v.source)!=="Homebrew":!1,onApplyDamage:y.type==="adversary"?(C,q)=>{const b=y.instances.find(T=>T.id===C);b&&r(C,{hp:Math.min(b.hpMax||1,(b.hp||0)+q)})}:void 0,onApplyHealing:y.type==="adversary"?(C,q)=>{const b=y.instances.find(T=>T.id===C);b&&r(C,{hp:Math.max(0,(b.hp||0)-q)})}:void 0,onApplyStressChange:y.type==="adversary"?(C,q)=>{var b,T;return r(C,{stress:Math.max(0,Math.min(((b=y.instances.find(k=>k.id===C))==null?void 0:b.stressMax)||6,(((T=y.instances.find(k=>k.id===C))==null?void 0:T.stress)||0)+q))})}:void 0,onUpdate:y.type==="adversary"?r:y.type==="environment"?n:s,adversaries:h,showAddRemoveButtons:u!==null&&y.type==="adversary",onEdit:y.type==="adversary"?C=>w(C):void 0,onAddInstance:y.type==="adversary"?C=>{const q=C.type==="Minion",b=q?W:1;if(q&&b>1){const T=Array(b).fill(null).map(()=>({...C}));O(T)}else S(C);setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!o.current)return;const T=o.current,k=T.scrollLeft,A=T.clientWidth,V=u!==null?A-(a+Se):A,P=F().findIndex(re=>re.baseName===y.baseName&&re.type==="adversary");if(P>=0){const re=Se+P*(a+Se),$=re+a,ee=10;re>=k-ee&&$<=k+V+ee||K(re,500)}})})},50)}:void 0,onRemoveInstance:y.type==="adversary"?()=>{const C=y.instances[0],b=(C==null?void 0:C.type)==="Minion"?W:1,T=y.instances.sort((M,P)=>{const re=M.duplicateNumber||1;return(P.duplicateNumber||1)-re}),A=Math.max(0,T.length-b)===0;if(T.length===0)return;const V=T.slice(0,b);if(A){const M=e.findIndex($=>$.baseName===y.baseName&&$.type==="adversary"),P=M===0;let re=!1;if(o.current){const $=o.current,ee=$.scrollLeft,de=$.scrollWidth-$.clientWidth;re=Math.abs(ee-de)<1}L({baseName:y.baseName,groupIndex:M}),D(!1),P&&o.current&&(o.current.style.scrollSnapType="none"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{o.current&&o.current.offsetHeight,V.forEach($=>{_($.id)}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{o.current&&o.current.offsetHeight,setTimeout(()=>{if(D(!0),re&&o.current){const $=performance.now(),ee=300,de=()=>{if(!o.current)return;const fe=o.current,ze=fe.scrollWidth-fe.clientWidth;fe.scrollLeft=ze,performance.now()-$<ee&&requestAnimationFrame(de)};requestAnimationFrame(de)}setTimeout(()=>{if(L(null),D(!1),P&&o.current&&(o.current.style.scrollSnapType="x mandatory"),re&&o.current){const $=o.current;$.scrollLeft=$.scrollWidth-$.clientWidth}},300)},50)})})})})}else V.forEach(M=>{_(M.id)})}:void 0})},`${y.type}-${y.baseName}`))}),d&&!E.some(y=>(y==null?void 0:y.key)===`spacer-${d.baseName}`)){const y=Math.min(d.groupIndex,E.length);E.splice(y,0,t.jsx(yt,{className:"dashboard-column",style:{width:c?"0px":`${a}px`,flexShrink:0,flexGrow:0,flex:"none",paddingRight:"0",paddingTop:c?"0px":`${Se}px`,paddingBottom:c?"0px":`${Se}px`,scrollSnapAlign:"none",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"100%",opacity:0,transition:"width 0.3s ease, padding-top 0.3s ease, padding-bottom 0.3s ease"}},`spacer-${d.baseName}`))}return E})(),u!==null&&t.jsx("div",{style:{width:`${a}px`,flexShrink:0,flexGrow:0,flex:"none",height:"100%"}})]}),cn=(e=[])=>e.reduce((a,o)=>{var l;const i=o.baseName||((l=o.name)==null?void 0:l.replace(/\s+\(\d+\)$/,""))||o.name||"Unknown";return a[i]||(a[i]={type:"adversary",baseName:i,instances:[]}),a[i].instances.push(o),a},{}),un=(e,a,o,i)=>{const l=f.useRef(a);f.useEffect(()=>{const d=l.current;if(d!==a&&d>0){const c=cn(e);Object.values(c).forEach(u=>{if(u.type!=="adversary"||u.instances.length===0)return;const p=u.instances[0];if(p.type!=="Minion")return;const x=u.instances.length,r=Math.ceil(x/d)*a;if(r!==x)if(r>x){const n=r-x,s=Array(n).fill(null).map(()=>({...p}));o(s)}else{const n=x-r;u.instances.slice(-n).forEach(h=>i(h.id))}}),l.current=a}else(d===0||l.current===0)&&(l.current=a)},[e,a,o,i])},_t=e=>e===1?200:350,pn=e=>{if(e<=0)return{visibleColumns:1,columnWidth:_t(1)};const a=e-Se*2;let o={visibleColumns:1,columnWidth:a};for(let l=1;l<=5;l+=1){const d=(l-1)*Se,c=(a-d)/l;c>=_t(l)&&l*c+d<=a&&(o={visibleColumns:l,columnWidth:c})}return o.visibleColumns*o.columnWidth+(o.visibleColumns-1)*Se>a&&(o={visibleColumns:1,columnWidth:a}),o},mn=()=>typeof window>"u"?0:window.innerWidth,fn=e=>{const[a,o]=f.useState(mn),i=f.useMemo(()=>pn(a),[a]);return f.useLayoutEffect(()=>{const l=()=>{e.current?o(e.current.clientWidth):typeof window<"u"&&o(window.innerWidth)};l();const d=()=>l();window.addEventListener("resize",d);let c;return typeof ResizeObserver<"u"&&e.current&&(c=new ResizeObserver(()=>{e.current&&o(e.current.clientWidth)}),c.observe(e.current)),()=>{window.removeEventListener("resize",d),c&&c.disconnect()}},[e]),{gap:Se,columnWidth:i.columnWidth,visibleColumns:i.visibleColumns}};class hn extends _e.Component{constructor(a){super(a),this.state={hasError:!1,error:null}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,o){console.error("ErrorBoundary caught an error:",a,o)}render(){var a;return this.state.hasError?t.jsxs("div",{className:"p-md text-red",children:[t.jsx("h3",{children:"Something went wrong:"}),t.jsx("pre",{children:(a=this.state.error)==null?void 0:a.toString()}),t.jsx("button",{className:"btn-base btn-text",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try again"})]}):this.props.children}}const xn=({scrollContainerRef:e,columnWidth:a,onCloseReset:o})=>{const[i,l]=f.useState(null),d=f.useCallback(u=>{if(l(u),e.current){const p=e.current,x=p.scrollLeft,m=p.scrollWidth-p.clientWidth,r=Math.abs(x-m)<1;p._scrollBeforeBrowserOpen=x,p._scrollWidthBeforeOpen=p.scrollWidth,p._wasAtMaxScrollBeforeBrowserOpen=r}},[e]),c=f.useCallback(()=>{if(e.current){const u=e.current;u._scrollBeforeBrowserClose=u.scrollLeft,u._scrollWidthBeforeClose=u.scrollWidth}l(null),o==null||o()},[e,o]);return f.useEffect(()=>{e.current&&requestAnimationFrame(i!==null?()=>{requestAnimationFrame(()=>{if(!e.current)return;const u=e.current,p=u._wasAtMaxScrollBeforeBrowserOpen,x=u._scrollBeforeBrowserOpen||0;u.scrollLeft=x,delete u._scrollBeforeBrowserOpen,delete u._wasAtMaxScrollBeforeBrowserOpen})}:()=>{requestAnimationFrame(()=>{if(!e.current)return;const u=e.current,p=u._scrollBeforeBrowserClose||0,x=u.scrollWidth-u.clientWidth,m=Math.min(p,x);u.scrollLeft=m,delete u._scrollBeforeBrowserClose})})},[i,a,e]),{browserOpenAtPosition:i,handleOpenBrowser:d,handleCloseBrowser:c}},gn=e=>f.useCallback((a,o=500)=>{if(!e.current)return;const i=e.current,l=i.scrollLeft,d=a-l;if(Math.abs(d)<1)return;i._horizontalScrollAnimationId&&(cancelAnimationFrame(i._horizontalScrollAnimationId),i._horizontalScrollAnimationId=null),window.getComputedStyle(i).scrollSnapType!=="none"&&(i.style.scrollSnapType="none");const p=performance.now(),x=m=>{const r=m-p,n=Math.min(r/o,1),s=1-n,h=1-s*s*s;if(i){const w=l+d*h;i.scrollLeft=w}n<1?i._horizontalScrollAnimationId=requestAnimationFrame(x):i&&(i.scrollLeft=a,i._horizontalScrollAnimationId=null)};i._horizontalScrollAnimationId=requestAnimationFrame(x)},[e]),yn=(e,a)=>{const o=f.useCallback(()=>{const l={};return e.forEach(d=>{var u;const c=d.baseName||((u=d.name)==null?void 0:u.replace(/\s+\(\d+\)$/,""))||d.name;l[c]||(l[c]={type:"adversary",baseName:c,instances:[]}),l[c].instances.push(d)}),a.forEach(d=>{l[`countdown-${d.id}`]={type:"countdown",baseName:d.name,instances:[d]}}),Object.values(l)},[e,a]);return{entityGroups:f.useMemo(()=>o(),[o]),getEntityGroups:o}},vn=({entityGroups:e,pcCount:a,scrollContainerRef:o,createAdversariesBulk:i,createAdversary:l,setNewCards:d,getEntityGroups:c,smoothScrollTo:u,browserOpenAtPosition:p,columnWidth:x})=>f.useCallback(m=>{var K,F,_;const r=m.baseName||((K=m.name)==null?void 0:K.replace(/\s+\(\d+\)$/,""))||m.name,s=!e.find(L=>L.baseName===r&&L.type==="adversary"),h=m.type==="Minion",w=h?a:1,S=((F=o.current)==null?void 0:F.scrollWidth)??0,O=((_=o.current)==null?void 0:_.scrollLeft)??0,W=o.current;if(W&&s&&window.getComputedStyle(W).scrollSnapType!=="none"&&(W.style.scrollSnapType="none"),h&&w>1){const L=Array(w).fill(null).map(()=>({...m}));i(L)}else l(m);if(s){const L=`adversary-${r}`;d(D=>new Set(D).add(L)),setTimeout(()=>{d(D=>{const E=new Set(D);return E.delete(L),E})},10)}setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!o.current)return;const L=o.current;if(!(L.scrollWidth<=L.clientWidth))if(s){const D=L.scrollWidth;setTimeout(()=>{if(!o.current)return;const E=o.current,y=()=>{if(!o.current)return;const H=o.current,Q=H.scrollWidth-H.clientWidth,R=Q-O;H.scrollWidth>S&&Math.abs(R)<1?u(Q+10,500):Math.abs(R)>1&&u(Q,500)};E.scrollWidth!==D?requestAnimationFrame(()=>{requestAnimationFrame(()=>{y()})}):y()},10)}else{const E=c().findIndex(y=>y.baseName===r&&y.type==="adversary");if(E>=0){const y=o.current,H=y.scrollLeft,Q=y.clientWidth,R=p!==null?Q-(x+Se):Q,j=Se+E*(x+Se),v=j+x,C=10;j>=H-C&&v<=H+R+C||u(j,500)}}})})},50)},[p,x,i,l,e,c,a,o,d,u]);const bn=()=>{const{adversaries:e,environments:a,countdowns:o,fear:i,savedEncounters:l,partySize:d,customContent:c,updatePartySize:u,updateFear:p,createAdversary:x,createAdversariesBulk:m,updateAdversary:r,deleteAdversary:n,addCustomAdversary:s,updateCustomAdversary:h,createEnvironment:w,updateEnvironment:S,deleteEnvironment:O,updateCountdown:W,deleteCountdown:K,saveEncounter:F,loadEncounter:_,deleteEncounter:L}=pt(),D=d||4,[E,y]=f.useState(!1),[H,Q]=f.useState(null),[R,j]=f.useState("adversaries"),[v,C]=f.useState(null),[q,b]=f.useState(new Set),[T,k]=f.useState(null),[A,V]=f.useState(!1),M=f.useRef(null);un(e,D,m,n);const{columnWidth:P}=fn(M),{browserOpenAtPosition:re,handleOpenBrowser:$,handleCloseBrowser:ee}=xn({scrollContainerRef:M,columnWidth:P,onCloseReset:()=>j("adversaries")}),de=gn(M),fe=f.useCallback(()=>{y(!1)},[]),{entityGroups:ze,getEntityGroups:ye}=yn(e,o);on({browserOpenAtPosition:re,handleCloseBrowser:ee,handleOpenBrowser:$,getEntityGroups:ye,fear:i,updateFear:p});const Ie=vn({entityGroups:ze,pcCount:D,scrollContainerRef:M,createAdversariesBulk:m,createAdversary:x,setNewCards:b,getEntityGroups:ye,smoothScrollTo:de,browserOpenAtPosition:re,columnWidth:P}),Le=f.useCallback(()=>{const B="Standard",z=Ue(1,B),Y={name:"",baseName:"",tier:1,type:B,description:"",motives:"",difficulty:z.difficulty,thresholds:z.thresholds,hpMax:z.hpMax,stressMax:z.stressMax,atk:z.atk,weapon:"",range:z.range,damage:z.damage,experience:[],features:[],source:"Homebrew",hp:0,stress:0,isVisible:!0};x(Y),setTimeout(()=>{const I=ye();for(const ne of I)if(ne.type==="adversary"){const ue=ne.instances.find(Z=>Z.source==="Homebrew"&&(!Z.baseName||Z.baseName.trim()===""||Z.baseName==="Unknown"));if(ue&&!H){Q(ue.id),requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(M.current){const Z=I.findIndex(J=>J.instances.some(oe=>oe.id===ue.id));if(Z>=0){const J=Se+Z*(P+Se);de(J,600,"new-custom-adversary")}}})});break}}},100)},[x,ye,P,de,H]),te=f.useCallback(g=>{Q(g)},[]),he=f.useCallback(()=>{Q(null)},[]),ce=f.useCallback(async(g,B)=>{var z,Y;if(B){const I=e.find(ue=>ue.id===B);if((I==null?void 0:I.source)==="Homebrew"||(I==null?void 0:I.isCustom)){const ue=I==null?void 0:I.customContentId,Z=I==null?void 0:I.baseName,J=ue?(z=c==null?void 0:c.adversaries)==null?void 0:z.find(oe=>oe.id===ue):(Y=c==null?void 0:c.adversaries)==null?void 0:Y.find(oe=>oe.baseName===Z&&(oe.source==="Homebrew"||oe.isCustom));if(J){const oe={...g,name:g.baseName||g.name};h(J.id,oe);const we=g.baseName||(I==null?void 0:I.baseName);e.forEach(ke=>{(ke.customContentId===ue||ke.baseName===we&&(ke.source==="Homebrew"||ke.isCustom))&&r(ke.id,{...g,customContentId:J.id})})}else{const oe={...g,name:g.baseName||g.name},we=s(oe),ke=g.baseName||(I==null?void 0:I.baseName);e.forEach(We=>{We.baseName===ke&&(We.source==="Homebrew"||We.isCustom)&&r(We.id,{...g,customContentId:we})})}}else{const ue=I==null?void 0:I.baseName,Z=e.filter(we=>{const ke=we.baseName===ue,We=!we.source||we.source!=="Homebrew"&&!we.isCustom;return ke&&We}),J={...g,name:g.baseName||g.name},oe=s(J);Z.forEach(we=>{n(we.id)}),setTimeout(()=>{const we=Z.map(()=>({...g,source:"Homebrew",isCustom:!0,customContentId:oe,hp:0,stress:0}));we.length>0&&m(we)},0)}Q(null)}else if(H){const I={...g,name:g.baseName||g.name},ne=s(I),ue=x({...g,source:"Homebrew",isCustom:!0,customContentId:ne});return Q(null),ue}else{const I={...g,name:g.baseName||g.name},ne=s(I);return x({...g,source:"Homebrew",isCustom:!0,customContentId:ne})}},[H,e,c,x,r,s,h,m,n]),je=f.useCallback(()=>{const g={};return e.forEach(B=>{var Y;const z=B.baseName||((Y=B.name)==null?void 0:Y.replace(/\s+\(\d+\)$/,""))||B.name;g[z]||(g[z]={type:"adversary",item:B,quantity:0}),g[z].quantity+=1}),Object.values(g)},[e])(),Me=Zt(je),De=Xt(D)+Me,Qe=Qt(je,D),Re=f.useRef(null),Ze=f.useCallback(g=>{Re.current&&clearTimeout(Re.current),Re.current=setTimeout(()=>{const B=g.target;B&&B.style.scrollSnapType==="none"&&(B.style.scrollSnapType="x mandatory")},150)},[]);return t.jsxs("div",{className:"app dashboard-root",style:{"--dashboard-gap":`${Se}px`},onClick:g=>{g.target,g.currentTarget},children:[t.jsx(an,{fearValue:(i==null?void 0:i.value)||0,onUpdateFear:p,isBrowserOpen:re!==null,onToggleBrowser:()=>{re!==null?ee():$(ze.length)}}),t.jsxs("div",{className:"dashboard-main",children:[t.jsx(ln,{isOpen:re!==null,columnWidth:P,onClose:ee,onCreateCustomAdversary:Le,pcCount:D,updatePartySize:u,availableBattlePoints:De,spentBattlePoints:Qe,browserActiveTab:R,onTabChange:j,savedEncounters:l,loadEncounter:_,deleteEncounter:L,selectedCustomAdversaryId:v,onSelectCustomAdversary:C,onAddAdversaryFromBrowser:Ie}),t.jsx(dn,{entityGroups:ze,columnWidth:P,scrollContainerRef:M,onScroll:Ze,newCards:q,removingCardSpacer:T,spacerShrinking:A,browserOpenAtPosition:re,editingAdversaryId:H,handleSaveCustomAdversary:ce,handleCancelEdit:he,updateAdversary:r,updateEnvironment:S,updateCountdown:W,adversaries:e,handleEditAdversary:te,createAdversary:x,createAdversariesBulk:m,pcCount:D,smoothScrollTo:de,getEntityGroups:ye,deleteAdversary:n,setRemovingCardSpacer:k,setSpacerShrinking:V})]}),t.jsx(nn,{isOpen:E,onClose:fe,onAddAdversary:g=>{x(g)},onAddAdversariesBulk:g=>{m(g)},onAddEnvironment:g=>{w(g)},onDeleteAdversary:n,onDeleteEnvironment:O,onDeleteCountdown:K,adversaries:e,environments:a,countdowns:o,savedEncounters:l,onSaveEncounter:F,onLoadEncounter:_,onDeleteEncounter:L}),t.jsx(Tr,{})]})},wn=()=>{const{isLoaded:e}=pt();return e?t.jsx(hn,{children:t.jsx(bn,{})}):t.jsx("div",{className:"app loading-state",children:t.jsx("div",{className:"loading-placeholder","aria-hidden":"true"})})};bt.createRoot(document.getElementById("root")).render(t.jsx(_e.StrictMode,{children:t.jsx(Ir,{children:t.jsx(wn,{})})}));
