import{r as m,a as jt,R as rt}from"./dndkit-57209f9c.js";import{F as Gt,f as Yt,a as Jt,b as Xt,c as zt}from"./fa-b4bcccb0.js";import{D as Ot,A as Kt,C as Rt,X as ot,M as ft,P as at,a as Zt,H as Qt,L as Ut,b as er,F as tr,S as pt,c as ut}from"./lucide-9f8be461.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const S of document.querySelectorAll('link[rel="modulepreload"]'))c(S);new MutationObserver(S=>{for(const u of S)if(u.type==="childList")for(const g of u.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&c(g)}).observe(document,{childList:!0,subtree:!0});function p(S){const u={};return S.integrity&&(u.integrity=S.integrity),S.referrerPolicy&&(u.referrerPolicy=S.referrerPolicy),S.crossOrigin==="use-credentials"?u.credentials="include":S.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function c(S){if(S.ep)return;S.ep=!0;const u=p(S);fetch(S.href,u)}})();var Ft={exports:{}},gt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rr=m,nr=Symbol.for("react.element"),sr=Symbol.for("react.fragment"),or=Object.prototype.hasOwnProperty,ar=rr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ir={key:!0,ref:!0,__self:!0,__source:!0};function $t(t,o,p){var c,S={},u=null,g=null;p!==void 0&&(u=""+p),o.key!==void 0&&(u=""+o.key),o.ref!==void 0&&(g=o.ref);for(c in o)or.call(o,c)&&!ir.hasOwnProperty(c)&&(S[c]=o[c]);if(t&&t.defaultProps)for(c in o=t.defaultProps,o)S[c]===void 0&&(S[c]=o[c]);return{$$typeof:nr,type:t,key:u,ref:g,props:S,_owner:ar.current}}gt.Fragment=sr;gt.jsx=$t;gt.jsxs=$t;Ft.exports=gt;var e=Ft.exports,kt={},Wt=jt;kt.createRoot=Wt.createRoot,kt.hydrateRoot=Wt.hydrateRoot;function et(t){const o=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return t?`${t}-${o}`:o}const _t=m.createContext();function yt(t){if(typeof localStorage>"u")return null;try{const o=localStorage.getItem(t);return o==null?null:JSON.parse(o)}catch{return null}}function tt(t,o){if(!(typeof localStorage>"u"))try{localStorage.setItem(t,JSON.stringify(o))}catch{}}const lr=({children:t})=>{const[o,p]=m.useState({fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],currentEncounterName:"Encounter"}),[c,S]=m.useState(!1),[u,g]=m.useState({adversaries:[],environments:[]});m.useEffect(()=>{var f,a,v,z;const l=yt("daggerheart-game-state");if(l)try{(((f=l.adversaries)==null?void 0:f.length)>0||((a=l.environments)==null?void 0:a.length)>0||((v=l.countdowns)==null?void 0:v.length)>0||((z=l.savedEncounters)==null?void 0:z.length)>0)&&p(l)}catch(D){console.error("Failed to load saved state:",D)}const h=yt("daggerheart-custom-adversaries")||[],y=yt("daggerheart-custom-environments")||[];g({adversaries:h,environments:y}),S(!0)},[]),m.useEffect(()=>{tt("daggerheart-game-state",o)},[o]);const Y=l=>{p(h=>({...h,fear:{...h.fear,value:l}}))},x=()=>{p(l=>({...l,fear:{...l.fear,visible:!l.fear.visible}}))},W=l=>{p(h=>({...h,partySize:Math.max(1,l)}))},P=l=>{p(h=>({...h,currentEncounterName:l||"Encounter"}))},N=l=>{if(l.id)return p(h=>({...h,savedEncounters:(h.savedEncounters||[]).map(y=>y.id===l.id?{...y,name:l.name||y.name,encounterItems:l.encounterItems||y.encounterItems,partySize:l.partySize||y.partySize,battlePointsAdjustments:l.battlePointsAdjustments||y.battlePointsAdjustments,updatedAt:new Date().toISOString()}:y)})),l.id;{const h={id:et("encounter"),name:l.name||"Encounter",createdAt:new Date().toISOString(),encounterItems:l.encounterItems||[],partySize:l.partySize||4,battlePointsAdjustments:l.battlePointsAdjustments||{}};return p(y=>({...y,savedEncounters:[...y.savedEncounters||[],h]})),h.id}},_=l=>(o.savedEncounters||[]).find(y=>y.id===l),b=l=>{const h={id:et("encounter"),name:l.name||`Encounter ${Date.now()}`,createdAt:new Date().toISOString(),encounterItems:l.encounterItems||[],partySize:l.partySize||4,battlePointsAdjustments:l.battlePointsAdjustments||{}};return p(y=>({...y,savedEncounters:[...y.savedEncounters||[],h]})),h.id},O=l=>{p(h=>({...h,savedEncounters:(h.savedEncounters||[]).filter(y=>y.id!==l)}))},se=m.useRef(o);m.useEffect(()=>{se.current=o},[o]);const Ve={gameState:o,isLoaded:c,customContent:u,updateFear:Y,toggleFearVisibility:x,updatePartySize:W,updateCurrentEncounterName:P,saveEncounter:N,saveEncounterAs:b,loadEncounter:_,deleteEncounter:O,createCountdown:l=>{const h={id:et("countdown"),name:l.name||"Countdown",max:parseInt(l.max)||1,value:0,visible:!0,type:l.type||"standard",loop:l.loop||"none",source:l.source||"campaign"};p(y=>({...y,countdowns:[...y.countdowns,h]}))},updateCountdown:(l,h)=>{p(y=>({...y,countdowns:y.countdowns.map(f=>f.id===l?{...f,...h}:f)}))},deleteCountdown:l=>{p(h=>({...h,countdowns:h.countdowns.filter(y=>y.id!==l)}))},advanceCountdown:(l,h)=>{p(y=>({...y,countdowns:y.countdowns.map(f=>{if(f.id!==l)return f;let a=h;if(f.loop==="loop")a>f.max?a=(a-1)%f.max+1:a<0&&(a=f.max);else if(f.loop==="increasing"){if(a>f.max)return{...f,max:f.max+1,value:1};if(a<0)return{...f,max:Math.max(1,f.max-1),value:1};a=Math.max(0,a)}else if(f.loop==="decreasing"){if(a>f.max)return{...f,max:Math.max(1,f.max-1),value:1};if(a<0)return{...f,max:f.max+1,value:1};a=Math.min(f.max,a)}else a=Math.max(0,Math.min(a,f.max));return{...f,value:a}})}))},incrementCountdown:(l,h=1)=>{p(y=>({...y,countdowns:y.countdowns.map(f=>{if(f.id!==l)return f;let a=f.value+h;if(f.loop==="loop")a>f.max&&(a=(a-1)%f.max+1);else if(f.loop==="increasing"){if(a>f.max)return{...f,max:f.max+1,value:1}}else if(f.loop==="decreasing"){if(a>f.max)return{...f,max:Math.max(1,f.max-1),value:1}}else a=Math.min(a,f.max);return{...f,value:a}})}))},decrementCountdown:l=>{p(h=>({...h,countdowns:h.countdowns.map(y=>{if(y.id!==l)return y;let f=y.value-1;if(y.loop==="loop")f<0&&(f=y.max);else if(y.loop==="increasing"){if(f<0)return{...y,max:Math.max(1,y.max-1),value:y.max};f=Math.max(0,f)}else if(y.loop==="decreasing"){if(f<0)return{...y,max:y.max+1,value:1}}else f=Math.max(0,f);return{...y,value:f}})}))},reorderCountdowns:l=>{p(h=>{const[y,f]=l,a=[...h.countdowns],[v]=a.splice(y,1);return a.splice(f,0,v),{...h,countdowns:a}})},createAdversary:l=>{var D;const h=et("adv"),y=o.adversaries||[],f=l.baseName||((D=l.name)==null?void 0:D.replace(/\s+\(\d+\)$/,""))||l.name||"Unknown",a=y.filter(V=>V.baseName===f);let v=1;if(a.length===0)v=1;else{const V=a.map(We=>We.duplicateNumber||1);let me=1;for(;V.includes(me);)me++;v=me}const z={...l,id:h,baseName:f,duplicateNumber:v,name:`${f} (${v})`,hp:0,stress:0,isVisible:!0};p(V=>({...V,adversaries:[...V.adversaries,z]}))},createAdversariesBulk:l=>{const h=[],y={};l.forEach(f=>{var Be;const a=f.baseName||((Be=f.name)==null?void 0:Be.replace(/\s+\(\d+\)$/,""))||f.name||"Unknown",D=(o.adversaries||[]).filter(Je=>Je.baseName===a).length,V=y[a]||0,me=D+V+1;y[a]=V+1;const We={...f,id:et("adv"),baseName:a,duplicateNumber:me,name:`${a} (${me})`,hp:0,stress:0,isVisible:!0};h.push(We)}),p(f=>({...f,adversaries:[...f.adversaries,...h]}))},updateAdversary:(l,h)=>{p(y=>({...y,adversaries:y.adversaries.map(f=>{if(f.id===l){const a={...f,...h};if(h.baseName!==void 0){const v=h.baseName,z=a.duplicateNumber||1;a.name=z===1?v:`${v} (${z})`}return a}return f})}))},deleteAdversary:l=>{p(h=>({...h,adversaries:h.adversaries.filter(y=>y.id!==l)}))},clearAllAdversaries:()=>{p(l=>({...l,adversaries:[]}))},reorderAdversaries:l=>{p(h=>{const[y,f]=l,a=[...h.adversaries],[v]=a.splice(y,1);return a.splice(f,0,v),{...h,adversaries:a}})},bulkReorderAdversaries:l=>{p(h=>({...h,adversaries:l}))},createEnvironment:l=>{const h=et("env"),f=(o.environments||[]).filter(z=>z.name.replace(/\s+\(\d+\)$/,"")===l.name);let a=l.name||"Unknown";if(f.length===0)a=l.name;else if(f.length===1){const z=f[0],D=z.name.replace(/\s+\(\d+\)$/,""),V=o.environments.map(me=>me.id===z.id?{...me,name:`${D} (1)`}:me);p(me=>({...me,environments:V})),a=`${l.name} (2)`}else{const z=f.map(V=>{const me=V.name.match(/\((\d+)\)$/);return me?parseInt(me[1]):null}).filter(V=>V!==null);let D=1;for(;z.includes(D);)D++;a=`${l.name} (${D})`}const v={...l,id:h,name:a,isVisible:!0};p(z=>({...z,environments:[...z.environments,v]}))},updateEnvironment:(l,h)=>{p(y=>({...y,environments:y.environments.map(f=>f.id===l?{...f,...h}:f)}))},deleteEnvironment:l=>{p(h=>({...h,environments:h.environments.filter(y=>y.id!==l)}))},reorderEnvironments:l=>{p(h=>{const[y,f]=l,a=[...h.environments],[v]=a.splice(y,1);return a.splice(f,0,v),{...h,environments:a}})},addCustomAdversary:l=>{const h={...l,id:et("custom-adv"),source:l.source||"Homebrew",isCustom:!0};return g(y=>({...y,adversaries:[...y.adversaries,h]})),tt("daggerheart-custom-adversaries",[...u.adversaries,h]),h.id},addCustomEnvironment:l=>{const h={...l,id:et("custom-env"),source:l.source||"Homebrew",isCustom:!0};return g(y=>({...y,environments:[...y.environments,h]})),tt("daggerheart-custom-environments",[...u.environments,h]),h.id},updateCustomAdversary:(l,h)=>{g(f=>({...f,adversaries:f.adversaries.map(a=>a.id===l?{...a,...h}:a)}));const y=u.adversaries.map(f=>f.id===l?{...f,...h}:f);tt("daggerheart-custom-adversaries",y)},updateCustomEnvironment:(l,h)=>{g(f=>({...f,environments:f.environments.map(a=>a.id===l?{...a,...h}:a)}));const y=u.environments.map(f=>f.id===l?{...f,...h}:f);tt("daggerheart-custom-environments",y)},deleteCustomAdversary:l=>{g(y=>({...y,adversaries:y.adversaries.filter(f=>f.id!==l)}));const h=u.adversaries.filter(y=>y.id!==l);tt("daggerheart-custom-adversaries",h)},deleteCustomEnvironment:l=>{g(y=>({...y,environments:y.environments.filter(f=>f.id!==l)}));const h=u.environments.filter(y=>y.id!==l);tt("daggerheart-custom-environments",h)}};return e.jsx(_t.Provider,{value:Ve,children:t})},Et=()=>{const t=m.useContext(_t);if(!t)return console.warn("useGameState: Context not available yet, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{gameState:o,customContent:p,...c}=t;if(!o)return console.warn("useGameState: gameState not available, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],customContent:{adversaries:[],environments:[]},updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},addCustomAdversary:()=>{},addCustomEnvironment:()=>{},updateCustomAdversary:()=>{},updateCustomEnvironment:()=>{},deleteCustomAdversary:()=>{},deleteCustomEnvironment:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{fear:S,countdowns:u,adversaries:g,environments:Y,partySize:x,savedEncounters:W}=o;return{gameState:o,fear:S,countdowns:u,adversaries:g,environments:Y,partySize:x,savedEncounters:W,customContent:p,...c,hasCountdowns:u.length>0,hasAdversaries:g.length>0,hasEnvironments:Y.length>0,getCountdownById:P=>u.find(N=>N.id===P),getAdversaryById:P=>g.find(N=>N.id===P),getEnvironmentById:P=>Y.find(N=>N.id===P)}},Nt={fear:{icon:Yt,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"0.125rem",maxWidth:"none"},pipStyle:{fontSize:"var(--text-lg)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0,imageRendering:"crisp-edges"},filledColor:"var(--purple)",emptyColor:"var(--gray-dark)",tooltipTitle:"Click anywhere in header to adjust fear:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease fear by 1"},{text:"Right of boundary:",description:"Click to increase fear by 1"}]},hp:{icon:Jt,maxValue:20,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stress:{icon:Xt,maxValue:12,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},countdown:{icon:zt,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust countdown:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease countdown by 1"},{text:"Right of boundary:",description:"Click to increase countdown by 1"}]},hpDots:{maxValue:20,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--red)",borderColor:"var(--red)",boxShadow:"0 0 4px rgba(239, 68, 68, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stressDots:{maxValue:12,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--purple)",borderColor:"var(--purple)",boxShadow:"0 0 4px rgba(139, 92, 246, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},adversaryHP:{icon:Ot,maxValue:20,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust HP:",tooltipInstructions:[{text:"Filled pip:",description:"Click to heal (reduce damage)"},{text:"Empty pip:",description:"Click to take damage"}]},adversaryStress:{icon:Kt,maxValue:12,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust stress:",tooltipInstructions:[{text:"Filled pip:",description:"Click to reduce stress"},{text:"Empty pip:",description:"Click to increase stress"}]},countdownDistributed:{icon:zt,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Countdown progress:",tooltipInstructions:[{text:"Progress:",description:"Current countdown value"}]}},it=({type:t="fear",value:o=0,maxValue:p,onChange:c,size:S="lg",showTooltip:u=!0,containerStyle:g={},pipStyle:Y={},countdownType:x=null,distributedGroups:W=null,onPipClick:P=null,enableBoundaryClick:N=!1,clickContainerWidth:_="auto",centerPips:b=!0})=>{const[O,se]=m.useState(!1),q=Nt[t]||Nt.fear,X=p||q.maxValue,U=Math.max(0,Math.min(X,o));let te=q.filledColor;t==="countdown"&&x&&(["progress","dynamic-progress","simple-hope"].includes(x)?te="var(--gold)":["consequence","dynamic-consequence","simple-fear"].includes(x)?te="var(--purple)":["long-term","standard"].includes(x)&&(te="var(--text-secondary)"));const re=(F,fe)=>{if(P)P(F,fe);else if(c){const ke=F+1;c(ke)}},Te=F=>{if(!N||!c||P)return;F.currentTarget.getBoundingClientRect();const fe=F.currentTarget.querySelector(".pip-container");if(!fe)return;const ke=fe.getBoundingClientRect(),le=F.clientX-ke.left;if(le<0){U>0&&c(U-1);return}if(le>ke.width){U<X&&c(U+1);return}const E=ke.width,C=E*.05,Z=E-2*C,K=le-C,$=U/X,we=Z*$;K<we?U>0&&c(U-1):U<X&&c(U+1)},Oe=(()=>{if(!W||t!=="countdownDistributed")return[{start:0,end:X,groupIndex:0}];let F=0;return W.map((fe,ke)=>{const le={start:F,end:F+fe,groupIndex:ke};return F+=fe,le})})(),ne=()=>e.jsxs(e.Fragment,{children:[Oe.map(F=>e.jsx(rt.Fragment,{children:[...Array(F.end-F.start)].map((fe,ke)=>{const le=F.start+ke,E=le<U;if(q.isDots)return e.jsx("div",{style:{...q.pipStyle,...E?q.filledStyle:q.emptyStyle,...Y,cursor:c||P?"pointer":"default"},onClick:N?void 0:()=>re(le,E),title:`${le+1} of ${X}`},le);{const C=q.icon,Z=C&&typeof C=="object"&&C.iconName,K=E?te:q.emptyColor;return e.jsx("span",{className:`fear-pip ${E?"filled":"empty"}`,style:{...q.pipStyle,color:K,cursor:c||P?"pointer":"default",...Y},onClick:N?void 0:()=>re(le,E),title:`${le+1} of ${X}`,children:Z?e.jsx(Gt,{icon:C,size:S}):e.jsx(C,{size:S==="lg"?18:16})},le)}})},F.groupIndex)),u&&e.jsx("div",{style:{position:"relative",cursor:"help",pointerEvents:"none"},children:e.jsxs("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:O?"translateX(-50%) translateY(-5px)":"translateX(-50%)",background:"rgba(15, 23, 42, 0.95)",border:"1px solid var(--gray)",borderRadius:"var(--radius-md)",padding:"var(--space-md)",minWidth:"250px",zIndex:1e3,opacity:O?1:0,visibility:O?"visible":"hidden",transition:"all 0.2s ease",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.5)"},children:[e.jsx("div",{style:{fontWeight:600,color:"var(--gray-200)",marginBottom:"0.75rem",fontSize:"var(--text-sm)"},children:q.tooltipTitle}),q.tooltipInstructions.map((F,fe)=>e.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.8rem",color:"var(--gray-300)",lineHeight:1.4},children:[e.jsx("strong",{style:{color:"var(--gray-200)"},children:F.text})," ",F.description]},fe))]})})]});return e.jsx("div",{style:{width:_,height:"100%",cursor:c||P?"pointer":"default",touchAction:"manipulation",userSelect:"none",display:b?"flex":"block",alignItems:b?"center":"stretch",justifyContent:b?"center":"flex-start",...g},onClick:F=>{F.stopPropagation(),F.preventDefault(),N&&Te(F)},onMouseEnter:()=>se(u),onMouseLeave:()=>se(!1),children:e.jsx("div",{className:"pip-container",style:{...q.containerStyle,width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},children:ne()})})},dr=({position:t="top",children:o,onClick:p,className:c="",style:S={}})=>{const u=t==="top",g=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://"),Y={background:"var(--bg-primary)",borderTop:u?"none":"1px solid var(--border)",borderBottom:u?"1px solid var(--border)":"none",padding:u?"0.25rem 0":"0.5rem",paddingBottom:u?"0.25rem":g?"calc(0.5rem + env(safe-area-inset-bottom) + 1rem)":"calc(0.5rem + env(safe-area-inset-bottom))",position:u?"relative":"sticky",[u?"top":"bottom"]:0,zIndex:u?10:100,order:u?1:3,flexShrink:0,touchAction:"manipulation",userSelect:"none",display:"flex",flexDirection:u?"column":"row",justifyContent:u?"stretch":"center",alignItems:u?"stretch":"center",gap:u?"0":"1rem",height:u?"auto":"60px",...S};return e.jsx("div",{className:c,style:Y,onClick:p,children:o})},vt=52,It=({tabContent:t,children:o,containerStyle:p={},tabStyle:c={},showTab:S=!0,tabBackgroundColor:u="var(--bg-primary)",tabBorderColor:g="var(--border)",tabJustifyContent:Y="center",containerBackgroundColor:x,containerBorderColor:W,containerBorderRadius:P="8px",containerBoxShadow:N,containerOverflow:_="hidden",reserveTabSpace:b=!1,style:O={},...se})=>{const q={display:"flex",flexDirection:"column",position:"relative",height:"100%",width:"100%",borderRadius:P,overflow:_};x&&(q.backgroundColor=x),W&&(q.border=`2px solid ${W}`),N&&(q.boxShadow=N);const X={position:"relative",overflow:"visible",height:"100%",width:"100%",display:"flex",flexDirection:"column",boxSizing:"border-box"},U=b?"0":`-${vt}px`,te=b&&S&&t?`${vt}px`:"0";return e.jsxs("div",{style:{...X,...O},...se,children:[S&&t&&e.jsx("div",{style:{position:"absolute",top:U,left:"7px",right:"7px",width:"calc(100% - 14px)",display:"flex",alignItems:"center",gap:"0.5rem",justifyContent:Y,flexShrink:0,zIndex:0,padding:"0.5rem 0.75rem",paddingBottom:"calc(0.5rem + 4px)",minHeight:`${vt}px`,backgroundColor:u,border:`1.5px solid ${g}`,borderBottom:"none",borderRadius:"8px 8px 0 0",boxSizing:"border-box",marginBottom:"-4px",...c},children:t}),e.jsx("div",{style:{...q,...p,zIndex:1,marginTop:te},children:o})]})},cr="modulepreload",pr=function(t){return"/Daggerheart/"+t},Lt={},st=function(o,p,c){if(!p||p.length===0)return o();const S=document.getElementsByTagName("link");return Promise.all(p.map(u=>{if(u=pr(u),u in Lt)return;Lt[u]=!0;const g=u.endsWith(".css"),Y=g?'[rel="stylesheet"]':"";if(!!c)for(let P=S.length-1;P>=0;P--){const N=S[P];if(N.href===u&&(!g||N.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${Y}`))return;const W=document.createElement("link");if(W.rel=g?"stylesheet":cr,g||(W.as="script",W.crossOrigin=""),W.href=u,document.head.appendChild(W),g)return new Promise((P,N)=>{W.addEventListener("load",P),W.addEventListener("error",()=>N(new Error(`Unable to preload CSS for ${u}`)))})})).then(()=>o()).catch(u=>{const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=u,window.dispatchEvent(g),!g.defaultPrevented)throw u})},Bt={Minion:{difficulty:t=>[9,12,15,18][t-1],thresholds:t=>({major:0,severe:0}),hpMax:t=>1,stressMax:t=>1,atk:t=>[-1,0,1,2][t-1],damage:t=>["2","5","8","11"][t-1],range:"Melee"},Standard:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[7,10,20,25][t-1],severe:[12,20,32,45][t-1]}),hpMax:t=>[4,5,6,7][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[1,2,3,4][t-1],damage:t=>["1d8+1","2d8+2","3d8+3","4d8+4"][t-1],range:"Melee"},Bruiser:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[8,14,22,38][t-1],severe:[15,28,40,70][t-1]}),hpMax:t=>[6,7,8,9][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[-1,0,1,2][t-1],damage:t=>["1d12+2","2d12+4","3d12+6","4d12+8"][t-1],range:"Melee"},Horde:{difficulty:t=>[10,13,16,19][t-1],thresholds:t=>({major:[7,10,20,25][t-1],severe:[12,20,32,45][t-1]}),hpMax:t=>[5,6,7,8][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[-1,0,1,2][t-1],damage:t=>["1d8+2","2d8+4","3d8+6","4d8+8"][t-1],range:"Melee"},Leader:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[7,13,21,35][t-1],severe:[14,26,38,65][t-1]}),hpMax:t=>[5,6,7,8][t-1],stressMax:t=>[5,5,6,6][t-1],atk:t=>[2,4,6,8][t-1],damage:t=>["1d10+2","2d10+4","3d10+6","4d10+8"][t-1],range:"Melee"},Ranged:{difficulty:t=>[10,13,16,19][t-1],thresholds:t=>({major:[4,8,18,22][t-1],severe:[7,16,30,42][t-1]}),hpMax:t=>[3,4,5,6][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d8+2","2d8+4","3d8+6","4d8+8"][t-1],range:"Close"},Skulk:{difficulty:t=>[12,15,18,21][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,5,6,7][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d6+2","2d6+4","3d6+6","4d6+8"][t-1],range:"Melee"},Solo:{difficulty:t=>[12,15,18,21][t-1],thresholds:t=>({major:[7,13,21,35][t-1],severe:[14,26,38,65][t-1]}),hpMax:t=>[8,9,10,11][t-1],stressMax:t=>[5,5,6,6][t-1],atk:t=>[3,5,7,9][t-1],damage:t=>["1d10+3","2d10+6","3d10+9","4d10+12"][t-1],range:"Melee"},Support:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,4,5,5][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d4+2","2d4+4","3d4+6","4d4+8"][t-1],range:"Melee"},Social:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,4,5,5][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d4+2","2d4+4","3d4+6","4d4+8"][t-1],range:"Melee"}},lt=(t,o)=>{const p=Bt[o]||Bt.Standard;return{difficulty:p.difficulty(t),thresholds:p.thresholds(t),hpMax:p.hpMax(t),stressMax:p.stressMax(t),atk:p.atk(t),damage:p.damage(t),range:p.range}};let qt={adversaries:[]},Ht=!1;const ur=()=>({customAdversaries:JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]")}),mr=async()=>{if(Ht)return;let t={adversaries:[]},o={adversaries:[]};try{const c=await st(()=>import("./adversaries-9c8932de.js"),[]);t=(c==null?void 0:c.default)||c}catch(c){console.warn("Failed to load adversaries.json:",c)}try{const c=await st(()=>import("./playtest-adversaries-4a099c10.js"),[]);o=(c==null?void 0:c.default)||c}catch(c){console.warn("Failed to load playtest-adversaries.json:",c)}const{customAdversaries:p}=ur();qt={...t,adversaries:[...t.adversaries||[],...o.adversaries||[],...p]},Ht=!0},Mt=m.forwardRef(({onSave:t,onRefresh:o,onAddItem:p,editingAdversary:c,onCancelEdit:S,isStockAdversary:u=!1,autoFocus:g=!1,allAdversaries:Y=[],embedded:x=!1,hideEmbeddedButtons:W=!1},P)=>{const N=m.useRef(null),_=m.useRef(null),[b,O]=m.useState(()=>{const E=lt(1,"Standard");return{name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:E.difficulty,thresholds:E.thresholds,hpMax:E.hpMax,stressMax:E.stressMax,atk:E.atk,weapon:"",range:E.range,damage:E.damage,experience:[],features:[]}}),[se,q]=m.useState(!1),[X,U]=m.useState(!1),[te,re]=m.useState([]),[Te,ze]=m.useState(!1),[Oe,ne]=m.useState([]);m.useEffect(()=>{(async()=>{await mr(),Y.length>0?ne(Y):ne(qt.adversaries||[])})()},[Y]),m.useEffect(()=>{g&&setTimeout(()=>{var E,C,Z;c&&_.current?((E=_.current)==null||E.focus(),(C=_.current)==null||C.select()):N.current&&((Z=N.current)==null||Z.focus())},650)},[g,c]),m.useEffect(()=>{var E;if(c){const C=c.baseName||((E=c.name)==null?void 0:E.replace(/\s+\(\d+\)$/,""))||c.name||"";O({name:C,tier:c.tier||1,type:c.type||"Standard",description:c.description||"",motives:c.motives||"",difficulty:c.difficulty||11,thresholds:c.thresholds||{major:7,severe:12},hpMax:c.hpMax||3,stressMax:c.stressMax||1,atk:c.atk||1,weapon:c.weapon||"",range:c.range||"Melee",damage:c.damage||"",experience:c.experience||[],features:c.features||[]}),U(!1)}else{const C=lt(1,"Standard");O({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:C.difficulty,thresholds:C.thresholds,hpMax:C.hpMax,stressMax:C.stressMax,atk:C.atk,weapon:"",range:C.range,damage:C.damage,experience:[],features:[]}),U(!1)}},[c]),m.useEffect(()=>{if(!c&&!X){const E=lt(b.tier,b.type);O(C=>({...C,difficulty:E.difficulty,thresholds:E.thresholds,hpMax:E.hpMax,stressMax:E.stressMax,atk:E.atk,range:E.range,damage:E.damage}))}},[b.tier,b.type,c,X]);const F=E=>{if(O(C=>({...C,name:E})),E.trim().length>0){const C=Oe.filter(Z=>{var $;return((($=Z.name)==null?void 0:$.replace(/\s+\(\d+\)$/,""))||Z.name||"").toLowerCase().includes(E.toLowerCase())}).slice(0,5);re(C),ze(C.length>0)}else re([]),ze(!1)},fe=async()=>{if(!b.name.trim()){alert("Please enter a name for the adversary");return}q(!0);try{const E=$=>($||[]).filter(we=>we.name&&we.name.trim()!==""||we.modifier!==void 0&&we.modifier!==0),C=b.name.trim()||"Unknown",Z=E(b.experience||[]),K={...b,experience:Z,baseName:C,name:C,hp:c?c.hp:0,stress:c?c.stress:0,source:"Homebrew"};if(c){if(u){const{id:$,name:we,...ee}=K;await t(ee),alert("Custom adversary created successfully!")}else{const $={...K,name:K.baseName};await t($,c.id),alert("Adversary updated successfully!")}S&&S()}else{await t(K),o&&await o();const $=lt(1,"Standard");O({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:$.difficulty,thresholds:$.thresholds,hpMax:$.hpMax,stressMax:$.stressMax,atk:$.atk,weapon:"",range:$.range,damage:$.damage,experience:[],features:[]}),U(!1),alert("Custom adversary created successfully!")}}catch(E){console.error("Error saving adversary:",E),alert("Error saving adversary. Please try again.")}finally{q(!1)}};m.useImperativeHandle(P,()=>({handleSave:fe,isSaving:se,canSave:b.name.trim().length>0}));const ke={...b,id:"new-adversary",hp:0,stress:0,source:"Homebrew"},le=()=>se?c?u?"Creating...":"Saving...":"Creating...":c?u?"Save As Custom":"Save":"Create";return e.jsxs(e.Fragment,{children:[!x&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h2",{style:{color:"var(--text-primary)",fontSize:"1.5rem",fontWeight:"600",margin:0},children:c?u?"Edit Adversary (Save As Custom)":"Edit Custom Adversary":"Create Custom Adversary"}),e.jsx("button",{onClick:fe,disabled:se||!b.name.trim(),style:{padding:"0.75rem 1.5rem",backgroundColor:se||!b.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"8px",cursor:se||!b.name.trim()?"not-allowed":"pointer",fontSize:"1rem",fontWeight:"600",opacity:se||!b.name.trim()?.6:1},children:le()})]}),x&&!W&&e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",marginBottom:"0.5rem",padding:"0.5rem",borderBottom:"1px solid var(--border)"},children:[e.jsx("button",{onClick:fe,disabled:se||!b.name.trim(),style:{padding:"0.5rem 1rem",backgroundColor:se||!b.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"6px",cursor:se||!b.name.trim()?"not-allowed":"pointer",fontSize:"0.875rem",fontWeight:"600",opacity:se||!b.name.trim()?.6:1,marginRight:"0.5rem"},children:le()}),S&&e.jsx("button",{onClick:S,style:{padding:"0.5rem 1rem",backgroundColor:"transparent",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"6px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600"},children:"Cancel"})]}),!c&&e.jsxs("div",{style:{marginBottom:"1rem",position:"relative"},children:[e.jsx("input",{ref:N,type:"text",value:b.name,onChange:E=>{const C=E.target.value;O(Z=>({...Z,name:C})),F(C)},placeholder:"Adversary name",style:{width:"100%",padding:"0.75rem",border:"1px solid var(--border)",borderRadius:"8px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"1rem",outline:"none"}}),Te&&te.length>0&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"0 0 8px 8px",borderTop:"none",maxHeight:"200px",overflowY:"auto",zIndex:1e3,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)"},children:te.map((E,C)=>{var K;const Z=E.baseName||((K=E.name)==null?void 0:K.replace(/\s+\(\d+\)$/,""))||E.name;return e.jsxs("div",{onClick:()=>{O($=>({...$,name:Z,tier:E.tier||$.tier,type:E.type||$.type,difficulty:E.difficulty||$.difficulty,thresholds:E.thresholds||$.thresholds,hpMax:E.hpMax||$.hpMax,stressMax:E.stressMax||$.stressMax,atk:E.atk||$.atk,range:E.range||$.range,damage:E.damage||$.damage})),ze(!1),U(!0),N.current&&N.current.blur()},style:{padding:"0.75rem",cursor:"pointer",borderBottom:C<te.length-1?"1px solid var(--border)":"none",transition:"background-color 0.2s"},onMouseEnter:$=>{$.target.style.backgroundColor="var(--bg-secondary)"},onMouseLeave:$=>{$.target.style.backgroundColor="transparent"},onMouseDown:$=>$.preventDefault(),children:[e.jsx("div",{style:{fontWeight:"600"},children:Z}),e.jsxs("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",marginTop:"2px"},children:[E.type," • Tier ",E.tier]})]},C)})})]}),e.jsx(ht,{item:ke,type:"adversary",mode:"edit",nameInputRef:c?_:void 0,autoFocusNameInput:g&&c,onUpdate:(E,C)=>{O(Z=>({...Z,...C}))}})]})});Mt.displayName="CustomAdversaryCreator";const Pt=({value:t})=>e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"44px",height:"32px",zIndex:3},children:[e.jsx("svg",{width:"40",height:"32",viewBox:"0 0 40 32",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",style:{position:"absolute",zIndex:1},children:e.jsx("path",{d:"M2 2h28l6 14-6 14H2l6-14-6-14z"})}),e.jsx("span",{style:{position:"absolute",fontSize:"0.8rem",fontWeight:500,color:"var(--text-primary)",textAlign:"center",zIndex:2,left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:t})]}),fr=({type:t,tier:o,isEditMode:p,onUpdate:c,itemId:S})=>{const g=(N=>{if(!N)return 0;const b=document.createElement("canvas").getContext("2d");return b.font="600 11px system-ui, -apple-system, sans-serif",b.measureText(N.toUpperCase()).width})(t),Y=4,x=18,W=Math.max(50,g+Y+x),P=W+15;return p?e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",gap:"8px",height:"32px"},children:[e.jsxs("select",{value:t||"",onChange:N=>{c&&c(S,{type:N.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",outline:"none",borderRadius:"4px",padding:"4px 8px",width:"95px",height:"24px"},children:[e.jsx("option",{value:"Standard",children:"Standard"}),e.jsx("option",{value:"Solo",children:"Solo"}),e.jsx("option",{value:"Bruiser",children:"Bruiser"}),e.jsx("option",{value:"Horde",children:"Horde"}),e.jsx("option",{value:"Minion",children:"Minion"}),e.jsx("option",{value:"Ranged",children:"Ranged"}),e.jsx("option",{value:"Leader",children:"Leader"}),e.jsx("option",{value:"Skulk",children:"Skulk"}),e.jsx("option",{value:"Social",children:"Social"}),e.jsx("option",{value:"Support",children:"Support"})]}),e.jsxs("div",{style:{position:"relative",width:"24px",height:"24px"},children:[e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",width:"20px",height:"20px",backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",borderRadius:"2px"}}),e.jsx("input",{type:"text",value:o||"",onChange:N=>{const _=N.target.value.replace(/[^1-4]/g,"");_.length<=1&&c&&c(S,{tier:_===""?"":parseInt(_)})},onKeyDown:N=>{if(N.key==="ArrowUp"){N.preventDefault();const _=parseInt(o)||1;c&&c(S,{tier:Math.min(_+1,4)})}else if(N.key==="ArrowDown"){N.preventDefault();const _=parseInt(o)||1;c&&c(S,{tier:Math.max(_-1,1)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"transparent",border:"none",color:"var(--text-primary)",fontSize:"0.8rem",fontWeight:600,width:"24px",height:"24px",textAlign:"center",outline:"none",zIndex:1},maxLength:"1"})]})]}):e.jsxs("div",{style:{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"center",height:"32px",width:`${P}px`},children:[e.jsxs("svg",{width:P,height:"32",viewBox:`0 0 ${P} 32`,style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1},children:[e.jsx("rect",{x:"1",y:"6",width:W-1,height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4",ry:"4"}),e.jsx("rect",{x:W-10,y:"6",width:"20",height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"2",ry:"2",transform:`rotate(45 ${W-1} 16)`})]}),e.jsx("span",{style:{position:"absolute",top:"50%",left:"4px",transform:"translateY(-50%)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",color:"var(--text-primary)",zIndex:2,pointerEvents:"none"},children:t}),e.jsx("span",{style:{position:"absolute",top:"50%",left:`${W-.5}px`,transform:"translate(-50%, -50%)",fontSize:"0.8rem",fontWeight:600,color:"white",zIndex:2,pointerEvents:"none",textAlign:"center",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",width:"20px",height:"20px"},children:o})]})},bt=({feature:t,featureType:o,item:p,onUpdate:c,handleFeatureDeleteClick:S,deleteConfirmations:u,getFeatureKey:g})=>{var N,_;const Y=()=>{try{const O=[...(p==null?void 0:p.features)||[]],se=O.filter(X=>X.type===o),q=se.findIndex(X=>X===t);if(q>0&&q<se.length){const X=se[q],U=se[q-1];if(X&&U){const te=O.findIndex(Te=>Te===X),re=O.findIndex(Te=>Te===U);te>=0&&re>=0&&(O[te]=U,O[re]=X,c&&c(p.id,{features:O}))}}}catch(b){console.error(`Error in ${o.toLowerCase()} up button:`,b)}},x=()=>{try{const O=[...(p==null?void 0:p.features)||[]],se=O.filter(X=>X.type===o),q=se.findIndex(X=>X===t);if(q<se.length-1&&q>=0){const X=se[q],U=se[q+1];if(X&&U){const te=O.findIndex(Te=>Te===X),re=O.findIndex(Te=>Te===U);te>=0&&re>=0&&(O[te]=U,O[re]=X,c&&c(p.id,{features:O}))}}}catch(b){console.error(`Error in ${o.toLowerCase()} down button:`,b)}},W=b=>b.type===o,P=b=>b.type===o&&b.name.trim();return e.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",alignSelf:"stretch"},children:[e.jsx("button",{onClick:Y,disabled:(p.features||[]).filter(W).findIndex(b=>b===t)===0,tabIndex:"-1",style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(p.features||[]).filter(P).length>=2&&(p.features||[]).filter(W).findIndex(b=>b===t)!==0&&t.name.trim()?"white":"var(--text-secondary)",cursor:(p.features||[]).filter(P).length>=2&&(p.features||[]).filter(W).findIndex(b=>b===t)!==0&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↑"}),e.jsx("button",{onClick:()=>S(t),disabled:!t.name.trim()&&!t.description.trim(),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:u[g(t)]?"var(--danger)":"var(--gray-700)",color:!t.name.trim()&&!t.description.trim()?"var(--text-secondary)":"white",cursor:!t.name.trim()&&!t.description.trim()?"not-allowed":"pointer",opacity:!t.name.trim()&&!t.description.trim()?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"×"}),e.jsx("button",{onClick:x,disabled:(p.features||[]).filter(W).findIndex(b=>b===t)===(p.features||[]).filter(W).length-1,style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(p.features||[]).filter(P).length>=2&&(p.features||[]).filter(W).findIndex(b=>b===t)<(p.features||[]).filter(W).length-1&&((N=(p.features||[]).filter(W)[(p.features||[]).filter(W).findIndex(b=>b===t)+1])!=null&&N.name.trim())&&t.name.trim()?"white":"var(--text-secondary)",cursor:(p.features||[]).filter(P).length>=2&&(p.features||[]).filter(W).findIndex(b=>b===t)<(p.features||[]).filter(W).length-1&&((_=(p.features||[]).filter(W)[(p.features||[]).filter(W).findIndex(b=>b===t)+1])!=null&&_.name.trim())&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↓"})]})},qe={transitions:{hoverIn:"all 0.1s ease",hoverOut:"all 0.3s ease"},card:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"8px",cursor:"pointer",transition:"all 0.1s ease",position:"relative",border:"none"},cardHover:{backgroundColor:"var(--bg-card-hover)"},cardDead:{opacity:.6,backgroundColor:"var(--gray-800)",borderColor:"var(--border)"},cardAtMax:{backgroundColor:"var(--success)",borderColor:"var(--success)"},rowMain:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},rowTitle:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",margin:0},rowMeta:{display:"flex",gap:"8px",alignItems:"center"},badge:{padding:"2px 6px",borderRadius:"3px",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},typeBadge:{backgroundColor:"var(--purple)",color:"var(--text-primary)"},tierBadge:{backgroundColor:"var(--info)",color:"var(--text-primary)"},damageInputPopup:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,borderRadius:"8px"},damageInputContent:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"8px",padding:"8px",display:"flex",flexDirection:"row",gap:"8px",minWidth:"200px",alignItems:"center",position:"absolute",right:"1rem",top:"50%",transform:"translateY(-50%)"},damageInput:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"4px",padding:"4px 6px",color:"var(--text-primary)",fontSize:"16px",width:"80px",textAlign:"center"},damageIndicators:{display:"flex",gap:"8px",alignItems:"center",justifyContent:"center"},damageDrop:{fontSize:"16px",color:"var(--text-secondary)",cursor:"pointer",transition:"color 0.1s ease"},applyButton:{backgroundColor:"var(--gray-600)",color:"white",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"32px",minHeight:"32px"}},hr=(t,o,p,c)=>{const[S,u]=m.useState(!1),[g,Y]=m.useState("");m.useEffect(()=>{if(S){const b=O=>{O.target.closest(".damage-input-popup")||(u(!1),Y(""))};return document.addEventListener("click",b),()=>document.removeEventListener("click",b)}},[S]);const x=b=>{b.stopPropagation(),b.preventDefault();const O=t.hp||0,se=t.hpMax||1,q=b.currentTarget.getBoundingClientRect(),X=b.clientX-q.left,U=q.width/se;Math.floor(X/U)<O?p&&p(t.id,1,t.hp):o&&o(t.id,1,t.hp,t.hpMax)},W=b=>{b.stopPropagation(),b.preventDefault();const O=t.stress||0,se=t.stressMax||1,q=b.currentTarget.getBoundingClientRect(),X=b.clientX-q.left,U=q.width/se;Math.floor(X/U)<O?c&&c(t.id,-1,t.stress,t.stressMax):c&&c(t.id,1,t.stress,t.stressMax)},P=b=>{b.stopPropagation(),(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")&&(u(!0),Y(t.type==="Minion"?"1":""))},N=()=>{const b=parseInt(g);if(b>0){if(t.type==="Minion")o&&o(t.id,b,t.hp,t.hpMax);else{let O=0;b>=t.thresholds.severe?O=3:b>=t.thresholds.major?O=2:b>=1&&(O=1),o&&o(t.id,O,t.hp,t.hpMax)}u(!1),Y("")}};return{showDamageInput:S,damageValue:g,setDamageValue:Y,setShowDamageInput:u,handleHpClick:x,handleStressClick:W,handleDifficultyClick:P,applyDamage:N,handleKeyDown:b=>{b.key==="Enter"?N():b.key==="Escape"&&(u(!1),Y(""))}}},xr=({item:t,type:o,mode:p="expanded",onClick:c,onDelete:S,onApplyDamage:u,onApplyHealing:g,onApplyStressChange:Y,onUpdate:x,adversaries:W=[],isSelected:P=!1,isEditMode:N=!1,instances:_=[],isEmbedded:b=!1,showAddRemoveButtons:O=!1,onAddInstance:se=null,onRemoveInstance:q=null,onEdit:X=null,showCustomCreator:U=!1,onSaveCustomAdversary:te=null,onCancelEdit:re=null,isStockAdversary:Te=!1})=>{const ze=m.useRef(null),Oe=m.useRef(_.length),ne=m.useRef(null),F=m.useRef(null),fe=m.useRef(null),ke=m.useRef(null),le=m.useRef(null);m.useEffect(()=>{const a=ze.current;if(!a)return;const v=()=>{ne.current=a.scrollHeight,F.current=a.scrollTop};a.addEventListener("scroll",v,{passive:!0});const z=setInterval(v,100);return()=>{a.removeEventListener("scroll",v),clearInterval(z)}},[]),m.useEffect(()=>()=>{ze.current&&(ne.current=ze.current.scrollHeight,F.current=ze.current.scrollTop)},[_.length,_]);const[E,C]=m.useState({});m.useEffect(()=>{if(U&&ke.current){const a=setTimeout(()=>{var v,z;(v=ke.current)==null||v.focus(),(z=ke.current)==null||z.select()},650);return()=>clearTimeout(a)}},[U]),m.useLayoutEffect(()=>{const a=_.length,v=Oe.current;if(a!==v&&ze.current){const z=ne.current,D=F.current;if(!z||D===null){Oe.current=a;return}const V=ze.current,me=V.scrollHeight,We=V.clientHeight;if(!(a<v)){if(a>v){const Be=me-We,Je=V.scrollTop,s=Be-Je;if(Math.abs(s)>.5){fe.current&&(cancelAnimationFrame(fe.current),fe.current=null);const I=400,r=performance.now(),M=ae=>{if(!V){fe.current=null;return}const B=ae-r,G=Math.min(B/I,1),d=1-G,j=1-d*d*d,w=Je+s*j;V.scrollTop=w,G<1?fe.current=requestAnimationFrame(M):(V.scrollTop=Be,fe.current=null)};fe.current=requestAnimationFrame(M)}}}Oe.current=a}else Oe.current=a},[_.length,_]);const Z=a=>{const z=(t.features||[]).filter(D=>D.type===a.type).findIndex(D=>D===a);return`${a.type}-${z}-${a.name||"blank"}`},K=(a,v)=>`experience-${v}-${typeof a=="string"?a:a.name||"blank"}`,$=a=>!a||!Array.isArray(a)?[]:a.filter(v=>{if(typeof v=="string")return v.trim().length>0;const z=v.name||"",D=v.modifier||0;return z.trim().length>0||D>0}),we=a=>{const v=Z(a);if(E[v]){const z=t.features.filter(D=>D!==a);x&&x(t.id,{features:z}),C(D=>{const V={...D};return delete V[v],V})}else C(z=>({...z,[v]:!0})),setTimeout(()=>{C(z=>{const D={...z};return delete D[v],D})},3e3)},ee=(a,v)=>{const z=K(a,v);if(E[z]){const D=[...t.experience||[]];D.splice(v,1);const V=$(D);x&&x(t.id,{experience:V}),C(me=>{const We={...me};return delete We[z],We})}else C(D=>({...D,[z]:!0})),setTimeout(()=>{C(D=>{const V={...D};return delete V[z],V})},3e3)},R=hr(t,u,g,Y);(o==="adversary"||o==="adversaries")&&R.handleDifficultyClick;const ce=(a=!1)=>{let v={...qe.card};if(P?v.transition="none":v.transition=qe.transitions.hoverOut,a){const{marginTop:z,...D}=v;v=D}return P&&(v={...v,...qe.cardHover}),o==="adversary"&&(t.hp||0)>=(t.hpMax||1)&&(v={...v,...qe.cardDead}),v},xe=()=>{if(b)return"";let a="border rounded-lg";return P&&(a+=" border-hover"),a},Re=()=>{var a;if(o==="adversary"||o==="adversaries"){const v=t.baseName||((a=t.name)==null?void 0:a.replace(/\s+\(\d+\)$/,""))||"",z=t.duplicateNumber||1,D=[...W];return W.some(We=>We.id===t.id)||D.push(t),D.filter(We=>We.baseName===v).length>1?`${v} (${z})`:v}return t.name},Ve=()=>{const a=[];return t.type&&a.push(e.jsx("span",{style:{...qe.badge,...qe.typeBadge},children:t.type},"type")),a},l=()=>o!=="adversary"||!R.showDamageInput||!(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")?null:e.jsx("div",{className:"damage-input-popup",style:qe.damageInputPopup,onClick:a=>{a.stopPropagation(),a.target===a.currentTarget&&(o==="adversary"||o==="adversaries")&&(R.setShowDamageInput(!1),R.setDamageValue(""))},children:e.jsxs("div",{className:"border rounded-lg",style:{...qe.damageInputContent,borderColor:"var(--border)"},onClick:a=>a.stopPropagation(),children:[e.jsx("input",{type:"number",inputMode:"numeric",enterKeyHint:"done",placeholder:"dmg",min:(t.type==="Minion","0"),value:o==="adversary"||o==="adversaries"?R.damageValue:"",onChange:a=>{(o==="adversary"||o==="adversaries")&&R.setDamageValue(a.target.value)},onKeyDown:o==="adversary"||o==="adversaries"?R.handleKeyDown:void 0,className:"border rounded-sm",style:{...qe.damageInput,borderColor:"var(--border)"},autoFocus:!0}),e.jsxs("div",{style:qe.damageIndicators,children:[t.type==="Minion"?(()=>{var V,me;const a=parseInt(o==="adversary"||o==="adversaries"?R.damageValue:"0")||0,v=(V=t.features)==null?void 0:V.find(We=>{var Be;return(Be=We.name)==null?void 0:Be.startsWith("Minion (")}),z=v?parseInt(((me=v.name.match(/\((\d+)\)/))==null?void 0:me[1])||"1"):1,D=Math.floor(a/z);return a>=z&&D>0?e.jsxs("span",{style:{...qe.damageDrop,color:"var(--red)"},title:`${a} damage can defeat ${D+1} minion${D+1!==1?"s":""} (1 + ${D} additional)`,children:["+",D," additional minion(s)"]}):e.jsx("span",{style:qe.damageDrop,title:`${a} damage defeats this minion only`,children:"+0 additional minion(s)"})})():[1,2,3].map(a=>{const v=parseInt(o==="adversary"||o==="adversaries"?R.damageValue:"0")||0;let z=!1;return a===1&&v>=1&&(z=!0),a===2&&v>=t.thresholds.major&&(z=!0),a===3&&v>=t.thresholds.severe&&(z=!0),e.jsx("span",{style:{...qe.damageDrop,color:z?"var(--red)":"var(--text-secondary)"},onClick:D=>{D.stopPropagation(),(o==="adversary"||o==="adversaries")&&(a===1?R.setDamageValue("1"):a===2?R.setDamageValue(t.thresholds.major.toString()):a===3&&R.setDamageValue(t.thresholds.severe.toString()))},title:`Click to set damage to ${a===1?"1":a===2?t.thresholds.major:t.thresholds.severe}`,children:e.jsx(Ot,{size:16})},a)}),e.jsx("button",{style:{...qe.applyButton,backgroundColor:"var(--gray-600)"},onClick:a=>{a.stopPropagation(),(o==="adversary"||o==="adversaries")&&(!R.damageValue||parseInt(R.damageValue)<1?(R.setShowDamageInput(!1),R.setDamageValue("")):R.applyDamage())},title:!R.damageValue||parseInt(R.damageValue)<1?"Close damage input":"Apply damage",children:!R.damageValue||parseInt(R.damageValue)<1?e.jsx(ot,{size:16}):e.jsx(er,{size:16})})]})]})}),h=()=>{var V,me,We,Be,Je;const a=(t.hp||0)>=(t.hpMax||1),v=y==="edit"||U,z=o==="adversary",D=z?U?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:s=>{s.stopPropagation(),te&&(te(t,t.id),re&&re())},style:{background:"var(--purple)",border:"1px solid var(--purple)",color:"white",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:s=>{s.target.style.opacity="0.9"},onMouseLeave:s=>{s.target.style.opacity="1"},title:"Save",children:[e.jsx(Rt,{size:16}),e.jsx("span",{children:"Save"})]}),re&&e.jsxs("button",{onClick:s=>{s.stopPropagation(),re()},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:s=>{s.target.style.backgroundColor="var(--bg-hover)",s.target.style.borderColor="var(--purple)"},onMouseLeave:s=>{s.target.style.backgroundColor="var(--bg-secondary)",s.target.style.borderColor="var(--border)"},title:"Cancel",children:[e.jsx(ot,{size:16}),e.jsx("span",{children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:s=>{s.stopPropagation(),q&&q(t.id)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease"},onMouseEnter:s=>{s.currentTarget.style.backgroundColor="var(--bg-hover)",s.currentTarget.style.borderColor="var(--purple)"},onMouseLeave:s=>{s.currentTarget.style.backgroundColor="var(--bg-secondary)",s.currentTarget.style.borderColor="var(--border)"},title:"Remove one",children:e.jsx(ft,{size:16})}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"1rem",fontWeight:"500",minWidth:"24px",textAlign:"center"},children:_.length}),e.jsx("button",{onClick:s=>{s.stopPropagation(),se&&se(t)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease"},onMouseEnter:s=>{s.currentTarget.style.backgroundColor="var(--purple)",s.currentTarget.style.borderColor="var(--purple)",s.currentTarget.style.color="white"},onMouseLeave:s=>{s.currentTarget.style.backgroundColor="var(--bg-secondary)",s.currentTarget.style.borderColor="var(--border)",s.currentTarget.style.color="var(--text-primary)"},title:"Add another",children:e.jsx(at,{size:16})}),X&&e.jsx("button",{onClick:s=>{s.stopPropagation(),X(t.id)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease",marginLeft:"0.25rem"},onMouseEnter:s=>{s.currentTarget.style.backgroundColor="var(--purple)",s.currentTarget.style.borderColor="var(--purple)",s.currentTarget.style.color="white"},onMouseLeave:s=>{s.currentTarget.style.backgroundColor="var(--bg-secondary)",s.currentTarget.style.borderColor="var(--border)",s.currentTarget.style.color="var(--text-primary)"},title:"Edit",children:e.jsx(Zt,{size:16})})]}):null;return e.jsx(It,{tabContent:D,showTab:z,tabBorderColor:P?"var(--purple)":"var(--border)",containerBackgroundColor:a?"var(--gray-900)":ce(!0).backgroundColor,containerBorderColor:a?"color-mix(in srgb, var(--gray-600) 40%, transparent)":P?"var(--purple)":"var(--border)",containerBorderRadius:"8px",containerOverflow:"hidden",containerStyle:{padding:0,opacity:a?.7:1,height:"auto",maxHeight:z?"calc(100vh - 120px)":"calc(100vh - 68px)",minHeight:0},children:e.jsxs("div",{className:xe(),style:{...ce(!0),padding:0,display:"flex",flexDirection:"column",position:"relative",height:"100%",minHeight:0,border:"none",borderRadius:0},onClick:c,children:[a&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                  45deg,
                  transparent,
                  transparent 8px,
                  var(--gray-600) 1px,
                  var(--gray-600) 9px
                )`,pointerEvents:"none",zIndex:9999}})}),e.jsx("div",{className:"border-b",style:{padding:"8px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative",zIndex:a?1:"auto",borderBottomColor:P?"var(--purple)":"var(--border)"},children:e.jsx("div",{style:{display:"flex",flexDirection:"column",position:"relative",zIndex:a?1:"auto",padding:"2px",gap:0},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",minHeight:"40px"},children:[v?e.jsx("input",{ref:ke,type:"text",value:t.name||"",onChange:s=>{x&&t.id&&x(t.id,{name:s.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"4px",color:"var(--text-primary)",fontSize:"1.1rem",fontWeight:"600",padding:"0.5rem",width:"100%",maxWidth:"300px",paddingRight:"0.625rem"},placeholder:"Name"}):e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flex:1},children:e.jsx("h4",{style:{...qe.rowTitle,color:a?"color-mix(in srgb, var(--gray-400) 80%, transparent)":qe.rowTitle.color,textAlign:"left",margin:0,fontSize:"1.1rem",paddingRight:"6px",flex:1},children:((V=t.name)==null?void 0:V.replace(/\s+\(\d+\)$/,""))||t.name})}),(t.type||t.tier||v)&&e.jsx(fr,{type:t.type,tier:t.tier,isEditMode:v,onUpdate:x,itemId:t.id})]})})}),e.jsxs("div",{ref:ze,style:{borderRadius:"0 0 8px 8px",flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0},className:"invisible-scrollbar",children:[(t.motives||v)&&e.jsx("div",{style:{padding:"0.5rem 8px",textAlign:"center"},children:v?e.jsx("input",{type:"text",value:t.motives||"",onChange:s=>x&&x(t.id,{motives:s.target.value}),placeholder:"Motives...",style:{width:"100%",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}):e.jsxs("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,textAlign:"center"},children:[t.motives,t.motives&&!t.motives.endsWith(".")?".":""]})}),(t.difficulty||t.atk!==void 0||t.thresholds&&t.type!=="Minion"||t.experience&&t.experience.length>0||v)&&e.jsxs("div",{style:{padding:"0.5rem 8px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[(t.difficulty||v)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[e.jsx(Qt,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(0deg)"}}),v?e.jsx("input",{type:"text",value:t.difficulty||"",onChange:s=>{const I=s.target.value.replace(/[^0-9]/g,"");I.length<=2&&x&&x(t.id,{difficulty:parseInt(I)||0})},onKeyDown:s=>{if(s.key==="ArrowUp"){s.preventDefault();const I=parseInt(t.difficulty)||0;x&&x(t.id,{difficulty:Math.min(I+1,99)})}else if(s.key==="ArrowDown"){s.preventDefault();const I=parseInt(t.difficulty)||0;x&&x(t.id,{difficulty:Math.max(I-1,0)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"2"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:t.difficulty})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Difficulty"})]}),(t.atk!==void 0||v)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[e.jsx(Ut,{size:38,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(45deg)"}}),v?e.jsx("input",{type:"text",value:(()=>{const s=typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0;return s>=0?`+${s}`:s.toString()})(),onChange:s=>{const I=s.target.value.replace(/[^0-9+\-]/g,"");if(I.length<=4){const r=parseInt(I.replace(/[^0-9\-]/g,""))||0;x&&x(t.id,{atk:r})}},onKeyDown:s=>{if(s.key==="ArrowUp"){s.preventDefault();const r=(typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0)+1;x&&x(t.id,{atk:r})}else if(s.key==="ArrowDown"){s.preventDefault();const r=(typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0)-1;x&&x(t.id,{atk:r})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"3"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:(()=>{const s=typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk;return s>=0?`+${s}`:s})()})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Attack"})]})]}),e.jsx("div",{style:{paddingTop:"0"},children:v?e.jsx("div",{style:{display:"flex",flexDirection:"column",marginTop:"-0.25rem"},children:(()=>{const s=t.experience||[],I=s.length===0?[{name:"",modifier:0}]:s;return I.map((r,M)=>{var ae,B,G,d,j,w,Q,J,ge,ue,he,pe,A,ye,Se,Le,He,Fe,Pe,Ee,Ce,oe,Ne,$e,n;return e.jsxs("div",{style:{position:"relative",marginBottom:"0.5rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("input",{type:"text",value:typeof r=="object"&&r.modifier>0?`+${r.modifier}`:"",onChange:i=>{const T=[...t.experience||[]],k=i.target.value.replace(/[^0-9+-]/g,""),L=k===""||k==="+"?0:parseInt(k)||0,ve=Math.max(0,L);T[M]={name:typeof r=="string"?r:r.name||"",modifier:ve};const de=$(T);x&&x(t.id,{experience:de})},onKeyDown:i=>{if(i.key==="ArrowUp"){i.preventDefault();const T=[...t.experience||[]],k=typeof r=="object"&&r.modifier||0;T[M]={name:typeof r=="string"?r:r.name||"",modifier:k+1};const L=$(T);x&&x(t.id,{experience:L})}else if(i.key==="ArrowDown"){i.preventDefault();const T=[...t.experience||[]],k=typeof r=="object"&&r.modifier||0;T[M]={name:typeof r=="string"?r:r.name||"",modifier:Math.max(0,k-1)};const L=$(T);x&&x(t.id,{experience:L})}},style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)",textAlign:"center",outline:"none"}})}),e.jsxs("div",{style:{marginLeft:"32px",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:typeof r=="string"?r:r.name||"",onChange:i=>{var de;const T=[...t.experience||[]],k=typeof r=="object"&&r.modifier||0;T[M]={name:i.target.value,modifier:k};let L=$(T);const ve=L[L.length-1];ve&&(typeof ve=="string"?ve.trim():(de=ve.name)!=null&&de.trim())&&L.push({name:"",modifier:0}),x&&x(t.id,{experience:L})},placeholder:"Experience name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsxs("div",{style:{display:"flex",gap:"0.125rem"},children:[e.jsx("button",{onClick:()=>{var ve,de;const i=[...t.experience||[]],T=typeof r=="string"?r.trim():(ve=r.name)==null?void 0:ve.trim(),k=i[M-1],L=typeof k=="string"?k.trim():(de=k.name)==null?void 0:de.trim();if(M>0&&M<i.length&&T&&L){i[M]=k,i[M-1]=r;const H=$(i);x&&x(t.id,{experience:H})}},disabled:M===0||!(typeof r=="string"?r.trim():(ae=r.name)!=null&&ae.trim())||!(typeof I[M-1]=="string"?I[M-1].trim():(B=I[M-1].name)!=null&&B.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:M===0||!(typeof r=="string"?r.trim():(G=r.name)!=null&&G.trim())||!(typeof I[M-1]=="string"?I[M-1].trim():(d=I[M-1].name)!=null&&d.trim())?"var(--gray-800)":"var(--gray-700)",color:M===0||!(typeof r=="string"?r.trim():(j=r.name)!=null&&j.trim())||!(typeof I[M-1]=="string"?I[M-1].trim():(w=I[M-1].name)!=null&&w.trim())?"var(--text-secondary)":"white",cursor:M===0||!(typeof r=="string"?r.trim():(Q=r.name)!=null&&Q.trim())||!(typeof I[M-1]=="string"?I[M-1].trim():(J=I[M-1].name)!=null&&J.trim())?"not-allowed":"pointer",opacity:M===0||!(typeof r=="string"?r.trim():(ge=r.name)!=null&&ge.trim())||!(typeof I[M-1]=="string"?I[M-1].trim():(ue=I[M-1].name)!=null&&ue.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move up",children:"↑"}),e.jsx("button",{onClick:()=>{var ve,de;const i=[...t.experience||[]],T=typeof r=="string"?r.trim():(ve=r.name)==null?void 0:ve.trim(),k=i[M+1],L=typeof k=="string"?k.trim():(de=k.name)==null?void 0:de.trim();if(M<i.length-1&&M>=0&&T&&L){i[M]=k,i[M+1]=r;const H=$(i);x&&x(t.id,{experience:H})}},disabled:M===I.length-1||!(typeof r=="string"?r.trim():(he=r.name)!=null&&he.trim())||!(typeof I[M+1]=="string"?I[M+1].trim():(pe=I[M+1].name)!=null&&pe.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:M===I.length-1||!(typeof r=="string"?r.trim():(A=r.name)!=null&&A.trim())||!(typeof I[M+1]=="string"?I[M+1].trim():(ye=I[M+1].name)!=null&&ye.trim())?"var(--gray-800)":"var(--gray-700)",color:M===I.length-1||!(typeof r=="string"?r.trim():(Se=r.name)!=null&&Se.trim())||!(typeof I[M+1]=="string"?I[M+1].trim():(Le=I[M+1].name)!=null&&Le.trim())?"var(--text-secondary)":"white",cursor:M===I.length-1||!(typeof r=="string"?r.trim():(He=r.name)!=null&&He.trim())||!(typeof I[M+1]=="string"?I[M+1].trim():(Fe=I[M+1].name)!=null&&Fe.trim())?"not-allowed":"pointer",opacity:M===I.length-1||!(typeof r=="string"?r.trim():(Pe=r.name)!=null&&Pe.trim())||!(typeof I[M+1]=="string"?I[M+1].trim():(Ee=I[M+1].name)!=null&&Ee.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move down",children:"↓"}),e.jsx("button",{onClick:()=>ee(r,M),disabled:!(typeof r=="string"?r.trim():(Ce=r.name)!=null&&Ce.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:E[K(r,M)]?"var(--danger)":(typeof r=="string"?r.trim():(oe=r.name)!=null&&oe.trim())?"var(--gray-700)":"var(--gray-800)",color:(typeof r=="string"?r.trim():(Ne=r.name)!=null&&Ne.trim())?"white":"var(--text-secondary)",cursor:(typeof r=="string"?r.trim():($e=r.name)!=null&&$e.trim())?"pointer":"not-allowed",opacity:(typeof r=="string"?r.trim():(n=r.name)!=null&&n.trim())?1:.5,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:E[K(r,M)]?"Click again to confirm delete":"Delete experience",children:"×"})]})]})]},M)})})()}):e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:t.experience&&t.experience.length>0?t.experience.map((s,I)=>{if(typeof s=="string"){const r=s.match(/^(.+?)\s*([+-]?\d+)$/);if(r){const[,M,ae]=r;return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:ae})})}),e.jsx("span",{style:{marginLeft:"32px"},children:M})]},I)}else return e.jsx("div",{style:{marginBottom:"0.25rem"},children:s},I)}else return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:e.jsxs("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:[s.modifier>=0?"+":"",s.modifier]})})}),e.jsx("span",{style:{marginLeft:"32px"},children:s.name})]},I)}):null})})]}),(t.features&&t.features.length>0||v)&&e.jsxs("div",{style:{padding:"0 8px 8px 8px"},children:[(t.atk!==void 0&&t.weapon||v)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Standard Attack"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:v?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",marginTop:"0.75rem",marginBottom:"0.75rem"},children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[e.jsx("input",{type:"text",value:t.weapon||"",onChange:s=>x&&x(t.id,{weapon:s.target.value}),placeholder:"Standard attack name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}}),e.jsxs("select",{value:t.range||"",onChange:s=>x&&x(t.id,{range:s.target.value}),style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",appearance:"none",backgroundImage:`url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",backgroundSize:"1rem",paddingRight:"2rem"},children:[e.jsx("option",{value:""}),e.jsx("option",{value:"Melee",children:"Melee"}),e.jsx("option",{value:"Very Close",children:"Very Close"}),e.jsx("option",{value:"Close",children:"Close"}),e.jsx("option",{value:"Far",children:"Far"}),e.jsx("option",{value:"Very Far",children:"Very Far"})]}),e.jsx("input",{type:"text",value:t.damage||"",onChange:s=>x&&x(t.id,{damage:s.target.value}),placeholder:"Damage (e.g., 1d6+2)",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}})]})}):t.atk!==void 0&&t.weapon&&e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:t.weapon}),e.jsxs("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:["Make an attack against a target within ",t.range||"Melee"," range. On a success, deal ",t.damage||"damage varies","."]})]})})]}),(t.features.filter(s=>s.type==="Action").length>0||v)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Actions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const s=t.features.filter(r=>r.type==="Action");return(v&&s.length===0?[{type:"Action",name:"",description:""}]:s).map((r,M)=>v?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:r.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false","data-lpignore":"true","data-form-type":"other",name:`feature-name-${r.type.toLowerCase()}`,onChange:ae=>{const B=[...t.features||[]],G=B.findIndex(w=>w.type==="Action"&&w===r);G>=0?B[G]={...B[G],name:ae.target.value}:B.push({type:"Action",name:ae.target.value,description:r.description||""});const d=B.filter(w=>w.type==="Action"),j=d[d.length-1];j&&j.name.trim()&&B.push({type:"Action",name:"",description:""}),x&&x(t.id,{features:B})},placeholder:"Action name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:r.description||"",onChange:ae=>{const B=[...t.features||[]],G=B.findIndex(w=>w.type==="Action"&&w===r);G>=0?B[G]={...B[G],description:ae.target.value}:B.push({type:"Action",name:r.name||"",description:ae.target.value});const d=B.filter(w=>w.type==="Action"),j=d[d.length-1];j&&j.name.trim()&&B.push({type:"Action",name:"",description:""}),x&&x(t.id,{features:B})},onInput:ae=>{const B=ae.target.offsetHeight;ae.target.style.height="auto";const G=ae.target.scrollHeight,d=G>B?G:B;ae.target.style.height=d+"px"},placeholder:"Action description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(bt,{feature:r,featureType:"Action",item:t,onUpdate:x,handleFeatureDeleteClick:we,deleteConfirmations:E,getFeatureKey:Z})]},M):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:r.name}),r.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:r.description})]},M))})()})]}),(t.features.filter(s=>s.type==="Passive").length>0||v)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Passives"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const s=t.features.filter(r=>r.type==="Passive");return(v&&s.length===0?[{type:"Passive",name:"",description:""}]:s).map((r,M)=>v?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:r.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:ae=>{const B=[...t.features||[]],G=B.findIndex(w=>w.type==="Passive"&&w===r);G>=0?B[G]={...B[G],name:ae.target.value}:B.push({type:"Passive",name:ae.target.value,description:r.description||""});const d=B.filter(w=>w.type==="Passive"),j=d[d.length-1];j&&j.name.trim()&&B.push({type:"Passive",name:"",description:""}),x&&x(t.id,{features:B})},placeholder:"Passive name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:r.description||"",onChange:ae=>{const B=[...t.features||[]],G=B.findIndex(w=>w.type==="Passive"&&w===r);G>=0?B[G]={...B[G],description:ae.target.value}:B.push({type:"Passive",name:r.name||"",description:ae.target.value});const d=B.filter(w=>w.type==="Passive"),j=d[d.length-1];j&&j.name.trim()&&B.push({type:"Passive",name:"",description:""}),x&&x(t.id,{features:B})},onInput:ae=>{const B=ae.target.offsetHeight;ae.target.style.height="auto";const G=ae.target.scrollHeight,d=G>B?G:B;ae.target.style.height=d+"px"},placeholder:"Passive description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(bt,{feature:r,featureType:"Passive",item:t,onUpdate:x,handleFeatureDeleteClick:we,deleteConfirmations:E,getFeatureKey:Z})]},M):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:r.name}),r.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:r.description})]},M))})()})]}),(t.features.filter(s=>s.type==="Reaction").length>0||v)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Reactions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const s=t.features.filter(r=>r.type==="Reaction");return(v&&s.length===0?[{type:"Reaction",name:"",description:""}]:s).map((r,M)=>v?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:r.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:ae=>{const B=[...t.features||[]],G=B.findIndex(w=>w.type==="Reaction"&&w===r);G>=0?B[G]={...B[G],name:ae.target.value}:B.push({type:"Reaction",name:ae.target.value,description:r.description||""});const d=B.filter(w=>w.type==="Reaction"),j=d[d.length-1];j&&j.name.trim()&&B.push({type:"Reaction",name:"",description:""}),x&&x(t.id,{features:B})},placeholder:"Reaction name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:r.description||"",onChange:ae=>{const B=[...t.features||[]],G=B.findIndex(w=>w.type==="Reaction"&&w===r);G>=0?B[G]={...B[G],description:ae.target.value}:B.push({type:"Reaction",name:r.name||"",description:ae.target.value});const d=B.filter(w=>w.type==="Reaction"),j=d[d.length-1];j&&j.name.trim()&&B.push({type:"Reaction",name:"",description:""}),x&&x(t.id,{features:B})},onInput:ae=>{const B=ae.target.offsetHeight;ae.target.style.height="auto";const G=ae.target.scrollHeight,d=G>B?G:B;ae.target.style.height=d+"px"},placeholder:"Reaction description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(bt,{feature:r,featureType:"Reaction",item:t,onUpdate:x,handleFeatureDeleteClick:we,deleteConfirmations:E,getFeatureKey:Z})]},M):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:r.name}),r.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:r.description})]},M))})()})]})]}),(_&&_.length>0||t.type!=="Minion"&&(t.thresholds||v))&&e.jsxs("div",{style:{padding:"0 8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Status"})]}),v?e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border)"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"number",value:t.hpMax||"",onChange:s=>{const I=parseInt(s.target.value)||1;x&&x(t.id,{hpMax:I})},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),e.jsx(it,{type:"adversaryHP",value:0,maxValue:t.hpMax||1,showTooltip:!1}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:"HP"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"number",value:t.stressMax||"",onChange:s=>{const I=parseInt(s.target.value)||1;x&&x(t.id,{stressMax:I})},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),e.jsx(it,{type:"adversaryStress",value:0,maxValue:t.stressMax||1,showTooltip:!1}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:"Stress"})]})]})})}):_&&_.length>0&&_.map((s,I)=>{const r=(s.hp||0)>=(s.hpMax||1);return e.jsx("div",{"data-instance-id":s.id,style:{marginBottom:"0.5rem"},children:e.jsxs("div",{style:{backgroundColor:r?"var(--gray-900)":"var(--bg-primary)",borderRadius:"6px",padding:"0.25rem 0.5rem",border:"1px solid",borderColor:r?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",display:"flex",justifyContent:"flex-start",alignItems:"center",gap:"0.5rem",opacity:r?.7:1,position:"relative",transition:"all 0.2s ease",minHeight:"40px"},children:[r&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                          45deg,
                          transparent 0px,
                          transparent 8px,
                          var(--gray-600) 9px,
                          var(--gray-600) 9px
                        )`,pointerEvents:"none",zIndex:1,borderRadius:"4px"}})}),e.jsx("div",{style:{backgroundColor:r?"var(--gray-900)":"var(--bg-card)",border:"1px solid",borderColor:r?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",borderRadius:"50%",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",flexShrink:0,opacity:r?.5:1},children:e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:r?"var(--gray-400)":"var(--text-primary)"},children:s.duplicateNumber||1})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.125rem"},children:[e.jsx("div",{style:{opacity:r?.3:1},children:e.jsx(it,{type:"adversaryHP",value:s.hp||0,maxValue:s.hpMax||1,onPipClick:(M,ae)=>{if(u&&o==="adversary"){const B=s.hp||0,G=s.hpMax||1;ae?g&&g(s.id,1,B):B<G&&u(s.id,1,B,G)}},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})}),s.stressMax>0&&e.jsx("div",{style:{opacity:r?.3:1},children:e.jsx(it,{type:"adversaryStress",value:s.stress||0,maxValue:s.stressMax,onPipClick:(M,ae)=>{Y&&o==="adversary"&&(ae?Y(s.id,-1):Y(s.id,1))},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})})]})]},s.id)},s.id)}),t.type!=="Minion"&&(t.thresholds||v)&&e.jsx("div",{style:{display:"flex",justifyContent:"center",paddingTop:"1px",marginTop:"0.5rem",marginBottom:"0.5rem"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",position:"relative"},children:e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",height:"36px"},children:[e.jsx("svg",{width:"300",height:"36",viewBox:"0 0 300 36",style:{position:"absolute",zIndex:1},children:e.jsx("rect",{x:"20",y:"6",width:"260",height:"24",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4"})}),e.jsx("div",{style:{position:"relative",zIndex:2,display:"flex",alignItems:"center",gap:"0.5rem"},children:v?e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",fontSize:"0.8rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),e.jsx("input",{type:"number",min:"1",max:"99",value:((me=t.thresholds)==null?void 0:me.major)||"",onChange:s=>{const I=s.target.value;(I===""||parseInt(I)>=1&&parseInt(I)<=99)&&x&&x(t.id,{thresholds:{...t.thresholds,major:I===""?null:parseInt(I)}})},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),e.jsx("input",{type:"number",min:"1",max:"99",value:((We=t.thresholds)==null?void 0:We.severe)||"",onChange:s=>{const I=s.target.value;(I===""||parseInt(I)>=1&&parseInt(I)<=99)&&x&&x(t.id,{thresholds:{...t.thresholds,severe:I===""?null:parseInt(I)}})},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),e.jsx(Pt,{value:((Be=t.thresholds)==null?void 0:Be.major)||7}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),e.jsx(Pt,{value:((Je=t.thresholds)==null?void 0:Je.severe)||14}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]})})]})})})]}),(v||p==="expanded"&&t.description&&t.description.trim())&&e.jsxs("div",{style:{padding:"0 8px",textAlign:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Description"})]}),v?e.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-primary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"none",overflow:"hidden",fontFamily:"inherit",marginTop:"0.75rem",marginBottom:"0.75rem"},value:t.description,onChange:s=>{s.target.style.height="auto",s.target.style.height=s.target.scrollHeight+"px",x&&x(t.id,{description:s.target.value})},placeholder:"Description..."}):e.jsx("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,whiteSpace:"pre-wrap",padding:"0.5rem 0"},children:t.description})]})]}),l()]})})};if(U&&(o==="adversary"||o==="adversaries")){const a=o==="adversary",v=a?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:z=>{var D;z.stopPropagation(),(D=le.current)!=null&&D.handleSave&&le.current.handleSave()},style:{background:"var(--purple)",border:"1px solid var(--purple)",color:"white",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:z=>{z.currentTarget.style.opacity="0.9"},onMouseLeave:z=>{z.currentTarget.style.opacity="1"},title:"Save",children:[e.jsx(Rt,{size:16}),e.jsx("span",{children:"Save"})]}),re&&e.jsxs("button",{onClick:z=>{z.stopPropagation(),re()},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:z=>{z.currentTarget.style.backgroundColor="var(--bg-hover)",z.currentTarget.style.borderColor="var(--purple)"},onMouseLeave:z=>{z.currentTarget.style.backgroundColor="var(--bg-secondary)",z.currentTarget.style.borderColor="var(--border)"},title:"Cancel",children:[e.jsx(ot,{size:16}),e.jsx("span",{children:"Cancel"})]})]}):null;return e.jsx(It,{tabContent:v,containerStyle:{padding:0,height:"auto",maxHeight:a?"calc(100vh - 120px)":"calc(100vh - 68px)",minHeight:0},children:e.jsx(Mt,{ref:le,editingAdversary:t,onSave:te,onCancelEdit:re,isStockAdversary:Te,embedded:!0,hideEmbeddedButtons:!0,allAdversaries:W,autoFocus:!t.baseName||t.baseName.trim()===""||t.baseName==="Unknown"})})}const y=U?"edit":p;return(y==="expanded"||y==="edit")&&(o==="adversary"||o==="adversaries")?h():o==="adversary"||o==="adversaries"?null:e.jsxs("div",{className:xe(),style:ce(!0),children:[e.jsxs("div",{style:qe.rowMain,children:[e.jsx("h4",{style:qe.rowTitle,children:Re()}),e.jsx("div",{style:qe.rowMeta,children:Ve()})]}),e.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"12px",margin:0},children:["Expanded view coming soon for ",o]})]})},ht=xr,gr="/Daggerheart/assets/daggerheart-logo-fe7815ad.svg",yr=(t,o)=>{const[p,c]=m.useState("max-content"),S=m.useCallback(()=>{if(!o.current||t<=3)return"max-content";const u=o.current.offsetWidth,Y=Math.floor(u/120);return Y<=1?"max-content":t===4?"max-content max-content":t===5||t===6?Y>=2?"max-content max-content":"max-content":t===7?Y>=3?"max-content max-content max-content":Y>=2?"max-content max-content":"max-content":"repeat(auto-fit, minmax(80px, max-content))"},[t,o]);return m.useEffect(()=>{const u=S();c(u);const g=new ResizeObserver(()=>{const Y=S();c(Y)});return o.current&&g.observe(o.current),()=>{g.disconnect()}},[S]),p},vr=({encounter:t})=>{var S,u;const o=m.useRef(null),p=((S=t.encounterItems)==null?void 0:S.length)||0,c=yr(p,o);return e.jsx("div",{ref:o,className:"saved-encounter-adversary-list",style:{flex:1,fontSize:"0.8rem",color:"var(--text-secondary)",lineHeight:"1.3",display:"grid",gridTemplateColumns:c,gap:"0.25rem 1rem",gridAutoRows:"min-content"},children:((u=t.encounterItems)==null?void 0:u.length)>0?t.encounterItems.map((g,Y)=>{var W;const x=g.item.baseName||((W=g.item.name)==null?void 0:W.replace(/\s+\(\d+\)$/,""))||g.item.name;return e.jsxs("div",{style:{marginBottom:"0.125rem"},children:[g.quantity,"x ",x]},Y)}):e.jsx("div",{children:"No adversaries"})})},dt={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},mt={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1,lowerTierAdversary:1};let nt={adversaries:[]},At={environments:[]},xt=!1;const br=()=>{const t=JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]"),o=JSON.parse(localStorage.getItem("daggerheart-custom-environments")||"[]");return{customAdversaries:t,customEnvironments:o}},Ct=async()=>{if(xt)return;let t={adversaries:[]},o={environments:[]},p={adversaries:[]},c={environments:[]};try{const g=await st(()=>import("./adversaries-9c8932de.js"),[]);t=(g==null?void 0:g.default)||g}catch(g){console.warn("Failed to load adversaries.json:",g)}try{const g=await st(()=>import("./environments-c340637c.js"),[]);o=(g==null?void 0:g.default)||g}catch(g){console.warn("Failed to load environments.json:",g)}try{const g=await st(()=>import("./playtest-adversaries-4a099c10.js"),[]);p=(g==null?void 0:g.default)||g}catch(g){console.warn("Failed to load playtest-adversaries.json:",g)}try{const g=await st(()=>import("./playtest-environments-d9cdffb6.js"),[]);c=(g==null?void 0:g.default)||g}catch(g){console.warn("Failed to load playtest-environments.json:",g)}const{customAdversaries:S,customEnvironments:u}=br();nt={...t,adversaries:[...t.adversaries||[],...p.adversaries||[],...S]},At={...o,environments:[...o.environments||[],...c.environments||[],...u]},xt=!0},Cr=(t,o=[],p=4,c=1,S=!1,u=null)=>{const[g,Y]=m.useState(""),[x,W]=m.useState([{field:"tier",direction:"asc"},{field:"name",direction:"asc"}]),[P,N]=m.useState([]),[_,b]=m.useState(!0),[O,se]=m.useState([]),[q,X]=m.useState([]),[U,te]=m.useState(!1),[re,Te]=m.useState(!1),ze=m.useRef(null),Oe=m.useRef(null);m.useEffect(()=>{(async()=>{await Ct(),b(!1);let R=[];t==="adversary"?R=nt.adversaries||[]:t==="environment"&&(R=At.environments||[]),N(R)})()},[t]),m.useEffect(()=>{t==="adversary"&&u&&(async()=>{xt=!1,await Ct();let R=[];S?R=(nt.adversaries||[]).filter(ce=>{var xe;return ce.source==="Homebrew"||((xe=ce.id)==null?void 0:xe.startsWith("custom-"))}):R=nt.adversaries||[],N(R)})()},[u,t,S]);const ne=ee=>{const R=P.map(ce=>ce[ee]).filter(Boolean);return[...new Set(R)].sort((ce,xe)=>typeof ce=="number"&&typeof xe=="number"?ce-xe:String(ce).localeCompare(String(xe)))},F=m.useCallback(async()=>{xt=!1,await Ct();let ee=[];t==="adversary"?S?ee=(nt.adversaries||[]).filter(R=>{var ce;return R.source==="Homebrew"||((ce=R.id)==null?void 0:ce.startsWith("custom-"))}):ee=nt.adversaries||[]:t==="environment"&&(ee=At.environments||[]),N(ee)},[t,S]);m.useEffect(()=>{F()},[S,F]);const fe=ne("tier"),ke=ne("type"),le=m.useMemo(()=>{let ee=P.filter(R=>{var l,h;const xe=(R.name||R.baseName||"").toLowerCase().includes(g.toLowerCase())||((l=R.type)==null?void 0:l.toLowerCase().includes(g.toLowerCase()))||((h=R.description)==null?void 0:h.toLowerCase().includes(g.toLowerCase())),Re=O.length===0||(O.includes("party-tier")?R.tier===c:O.includes(R.tier.toString())),Ve=q.length===0||q.includes(R.type);return xe&&Re&&Ve});return ee.sort((R,ce)=>{for(const xe of x){const{field:Re,direction:Ve}=xe;let l=R[Re],h=ce[Re];if(Re==="tier")l=parseInt(l)||0,h=parseInt(h)||0;else if(Re==="cost"){const y=f=>{if(t!=="adversary")return 0;const a=dt[f.type]||2;let v=0;const z=o.filter(V=>V.type==="adversary"&&V.item.type==="Solo"&&V.quantity>0).reduce((V,me)=>V+me.quantity,0),D=o.filter(V=>V.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(V.item.type)&&V.quantity>0).reduce((V,me)=>V+me.quantity,0);return f.type==="Solo"&&z===1&&(v+=2),["Bruiser","Horde","Leader","Solo"].includes(f.type)&&D===0&&(v+=1),a+v};l=y(R),h=y(ce)}else if(Re==="difficulty"){const y=parseInt(l),f=parseInt(h);!isNaN(y)&&!isNaN(f)?(l=y,h=f):!isNaN(y)&&isNaN(f)?(l=y,h=999):isNaN(y)&&!isNaN(f)?(l=999,h=f):(l=String(l||"").toLowerCase(),h=String(h||"").toLowerCase())}else typeof l=="string"&&typeof h=="string"?(l=l.toLowerCase(),h=h.toLowerCase()):(l=String(l||"").toLowerCase(),h=String(h||"").toLowerCase());if(Ve==="asc"){if(l>h)return 1;if(l<h)return-1}else{if(l<h)return 1;if(l>h)return-1}}return 0}),ee},[P,g,x,O,q,o,p,c]),E=ee=>{W(R=>{const ce=R.findIndex(xe=>xe.field===ee);if(ce>=0)if(ce===0){const xe=[...R];return xe[0]={...xe[0],direction:xe[0].direction==="asc"?"desc":"asc"},xe}else{const xe=[...R];return xe.splice(ce,1)[0],[{field:ee,direction:"asc"},...xe]}else return[{field:ee,direction:"asc"},...R]})},C=ee=>{se(ee==="clear"?[]:ee==="party-tier"?["party-tier"]:R=>R.includes(ee)?R.filter(ce=>ce!==ee):[...R,ee])},Z=ee=>{X(ee==="clear"?[]:R=>R.includes(ee)?R.filter(ce=>ce!==ee):[...R,ee])},K=O.length>0,$=q.length>0;return m.useEffect(()=>{const ee=ce=>{const xe=ce.target.closest(".filter-dropdown"),Re=ce.target.closest(".header-filter-icon");xe||Re||(te(!1),Te(!1))},R=ce=>{ce.key==="Escape"&&(te(!1),Te(!1))};return document.addEventListener("pointerdown",ee,!0),document.addEventListener("mousedown",ee,!0),document.addEventListener("touchstart",ee,!0),document.addEventListener("click",ee,!0),document.addEventListener("keydown",R,!0),()=>{document.removeEventListener("pointerdown",ee,!0),document.removeEventListener("mousedown",ee,!0),document.removeEventListener("touchstart",ee,!0),document.removeEventListener("click",ee,!0),document.removeEventListener("keydown",R,!0)}},[te,Te]),{searchTerm:g,setSearchTerm:Y,sortFields:x,handleSort:E,filteredAndSortedData:le,loading:_,refreshData:F,selectedTiers:O,selectedTypes:q,showTierDropdown:U,setShowTierDropdown:te,showTypeDropdown:re,setShowTypeDropdown:Te,tierFilterRef:ze,typeFilterRef:Oe,uniqueTiers:fe,uniqueTypes:ke,handleTierSelect:C,handleTypeSelect:Z,isTierFiltered:K,isTypeFiltered:$,getDropdownStyle:ee=>{if(!ee.current)return{};const R=ee.current.getBoundingClientRect();return{position:"fixed",top:R.bottom+4,left:R.left-100,zIndex:99999}}}},wr=({searchTerm:t,onSearchChange:o,type:p,partyControls:c,showCustomToggle:S=!1,onToggleCustom:u,filterCustom:g=!1,onExportCustomAdversaries:Y,onImportCustomAdversaries:x,autoFocus:W=!1,onClose:P=null,placeholder:N="Search"})=>{const _=m.useRef(null);return m.useEffect(()=>{W&&_.current&&setTimeout(()=>{var b;(b=_.current)==null||b.focus()},100)},[W]),e.jsxs("div",{style:ie.browserHeader,children:[e.jsx("div",{style:{display:"flex",alignItems:"center",flex:1,gap:"0.5rem"},children:e.jsx("input",{ref:_,type:"text",placeholder:N,value:t,onChange:b=>o(b.target.value),style:{...ie.searchInput,flex:1,marginRight:0}})}),c&&e.jsx("div",{style:ie.partyControls,children:c})]})},Sr=({showCustomToggle:t=!1,onToggleCustom:o,filterCustom:p=!1,onExportCustomAdversaries:c,onImportCustomAdversaries:S})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)",flexShrink:0},children:[t&&e.jsxs("button",{onClick:()=>o&&o(!p),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:p?"var(--purple)":"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:p?"white":"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:u=>{p||(u.target.style.backgroundColor="var(--bg-hover)",u.target.style.borderColor="var(--purple)")},onMouseLeave:u=>{p||(u.target.style.backgroundColor="var(--bg-primary)",u.target.style.borderColor="var(--border)")},children:[e.jsx("span",{children:p?"✓":"○"}),"Custom Only"]}),e.jsxs("button",{onClick:c,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:u=>{u.target.style.backgroundColor="var(--bg-hover)",u.target.style.borderColor="var(--purple)"},onMouseLeave:u=>{u.target.style.backgroundColor="var(--bg-primary)",u.target.style.borderColor="var(--border)"},children:[e.jsx("span",{children:"↓"}),"Export"]}),e.jsxs("button",{onClick:()=>document.getElementById("import-file-input").click(),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:u=>{u.target.style.backgroundColor="var(--bg-hover)",u.target.style.borderColor="var(--purple)"},onMouseLeave:u=>{u.target.style.backgroundColor="var(--bg-primary)",u.target.style.borderColor="var(--border)"},children:[e.jsx("span",{children:"↑"}),"Import"]}),e.jsx("input",{id:"import-file-input",type:"file",accept:".csv,.json",onChange:S,style:{display:"none"}})]}),jr=({sortFields:t,onSort:o,type:p,uniqueTiers:c,uniqueTypes:S,selectedTiers:u,selectedTypes:g,showTierDropdown:Y,setShowTierDropdown:x,showTypeDropdown:W,setShowTypeDropdown:P,tierFilterRef:N,typeFilterRef:_,handleTierSelect:b,handleTypeSelect:O,isTierFiltered:se,isTypeFiltered:q,getDropdownStyle:X,costFilter:U,showCostDropdown:te,setShowCostDropdown:re,costFilterRef:Te,handleCostFilterSelect:ze,isCostFiltered:Oe})=>{const[ne,F]=m.useState(null),ke=(()=>p==="adversary"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"cost",label:"Cost",hasFilter:!0},{key:"difficulty",label:"Diff"}]:p==="environment"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"}]:[])(),le=()=>{if(!te)return null;const C=[{value:"all",label:"All"},{value:"auto-grey",label:"Auto Grey"},{value:"auto-hide",label:"Auto Hide"}];return jt.createPortal(e.jsx("div",{className:"filter-dropdown",style:{...ie.filterDropdown,...X(Te),maxHeight:"60vh",overflow:"auto"},onMouseDown:Z=>Z.stopPropagation(),onClick:Z=>Z.stopPropagation(),children:C.map(Z=>{const K=U===Z.value;return e.jsxs("div",{style:{...ie.filterOption,...K?ie.filterOptionSelected:{}},onClick:()=>ze(Z.value),children:[e.jsx("span",{style:ie.checkIcon,children:K?e.jsx(pt,{size:16}):e.jsx(ut,{size:16})}),e.jsx("span",{style:ie.filterLabel,children:Z.label})]},Z.value)})}),document.body)},E=(C,Z,K,$,we,ee,R,ce)=>{if(!we)return null;const xe=()=>{(C==="tier"||C==="type")&&$("clear")};return jt.createPortal(e.jsxs("div",{className:"filter-dropdown",style:{...ie.filterDropdown,...X(R),maxHeight:"60vh",overflow:"auto"},onMouseDown:Re=>Re.stopPropagation(),onClick:Re=>Re.stopPropagation(),children:[e.jsxs("div",{style:{...ie.filterOption,...K.length===0?ie.filterOptionSelected:{}},onClick:xe,children:[e.jsx("span",{style:ie.checkIcon,children:K.length===0?e.jsx(pt,{size:16}):e.jsx(ut,{size:16})}),e.jsx("span",{style:ie.filterLabel,children:"All"})]}),C==="tier"&&e.jsxs("div",{style:{...ie.filterOption,...K.includes("party-tier")?ie.filterOptionSelected:{}},onClick:()=>$("party-tier"),children:[e.jsx("span",{style:ie.checkIcon,children:K.includes("party-tier")?e.jsx(pt,{size:16}):e.jsx(ut,{size:16})}),e.jsx("span",{style:ie.filterLabel,children:"Party Tier"})]}),Z.map(Re=>{const Ve=K.includes(Re.toString());return e.jsxs("div",{style:{...ie.filterOption,...Ve?ie.filterOptionSelected:{}},onClick:()=>$(Re.toString()),children:[e.jsx("span",{style:ie.checkIcon,children:Ve?e.jsx(pt,{size:16}):e.jsx(ut,{size:16})}),e.jsx("span",{style:ie.filterLabel,children:Re})]},Re)})]}),document.body)};return e.jsx("tr",{style:ie.tableHeader,children:ke.map(C=>e.jsxs("th",{style:{...ie.tableHeaderCell,...ne===C.key?ie.tableHeaderCellHover:{},position:"relative",...C.key==="name"?{width:"auto",minWidth:"0"}:{},...C.key==="tier"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...C.key==="type"?{width:"80px",minWidth:"80px",maxWidth:"80px"}:{},...C.key==="difficulty"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...C.key==="cost"?{width:"50px",minWidth:"50px",maxWidth:"50px"}:{}},onClick:()=>o(C.key),onMouseEnter:()=>F(C.key),onMouseLeave:()=>F(null),children:[C.hasFilter?e.jsxs("div",{style:ie.headerWithFilter,children:[e.jsx("span",{style:{cursor:"pointer"},onClick:Z=>{Z.stopPropagation(),o(C.key)},children:C.label}),e.jsxs("button",{ref:C.key==="tier"?N:C.key==="type"?_:Te,style:{...ie.headerFilterIcon,...C.key==="tier"&&se?ie.headerFilterIconActive:{},...C.key==="type"&&q?ie.headerFilterIconActive:{},...C.key==="cost"&&Oe?ie.headerFilterIconActive:{}},className:"header-filter-icon",onClick:Z=>{Z.stopPropagation(),C.key==="tier"?(x(!Y),P(!1),re(!1)):C.key==="type"?(P(!W),x(!1),re(!1)):C.key==="cost"&&(re(!te),x(!1),P(!1))},children:[e.jsx(tr,{size:14}),C.key==="tier"&&se||C.key==="type"&&q||C.key==="cost"&&Oe?e.jsx("span",{style:ie.filterActiveDot}):null]})]}):C.label,C.key==="tier"&&E("tier",c,u,b,Y,x,N),C.key==="type"&&E("type",S,g,O,W,P,_),C.key==="cost"&&le()]},C.key))})},kr=({item:t,onAdd:o,type:p,onRowClick:c,encounterItems:S=[],pcCount:u=4,playerTier:g=1,remainingBudget:Y=0,costFilter:x="auto-grey"})=>{const[W,P]=m.useState(!1),N=()=>{o(t)},_=()=>{if(p!=="adversary")return null;const se=dt[t.type]||2;let q=0;const X=S.filter(te=>te.type==="adversary"&&te.item.type==="Solo"&&te.quantity>0).reduce((te,re)=>te+re.quantity,0),U=S.filter(te=>te.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(te.item.type)&&te.quantity>0).reduce((te,re)=>te+re.quantity,0);return t.type==="Solo"&&X===1&&(q+=2),["Bruiser","Horde","Leader","Solo"].includes(t.type)&&U===0&&(q+=1),se+q},O=(()=>{if(p==="adversary"){const se=_();dt[t.type];const q=se>Y||Y<=0;if(x==="auto-hide"&&q)return null;const X=x==="auto-grey"&&q?{opacity:.5,color:"var(--text-secondary)"}:{};return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...ie.rowCell,width:"auto",minWidth:"0",textAlign:"left",...X},children:e.jsxs("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:[e.jsx("div",{style:{fontWeight:"600"},children:t.name||t.baseName||""}),t.description&&e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"0.125rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.description})]})}),e.jsx("td",{style:{...ie.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...X},children:t.tier}),e.jsx("td",{style:{...ie.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center",...X},children:t.type}),e.jsx("td",{style:{...ie.rowCell,width:"50px",minWidth:"50px",maxWidth:"50px",textAlign:"center",...X},children:se}),e.jsx("td",{style:{...ie.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...X},children:t.difficulty})]})}else if(p==="environment")return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...ie.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:t.name||t.baseName||""}),e.jsx("td",{style:{...ie.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:t.tier}),e.jsx("td",{style:{...ie.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:t.type}),e.jsx("td",{style:{...ie.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:t.difficulty})]});return null})();return O===null?null:e.jsx(e.Fragment,{children:e.jsx("tr",{style:{...ie.row,...W?ie.rowHover:{}},onClick:()=>{p==="adversary"?N():c&&c(t,p)},onMouseEnter:()=>P(!0),onMouseLeave:()=>P(!1),children:O})})},Vt=({type:t,onAddItem:o,onCancel:p=null,onRowClick:c,encounterItems:S=[],pcCount:u=4,playerTier:g=1,partyControls:Y=null,showContainer:x=!0,savedEncounters:W=[],onLoadEncounter:P,onDeleteEncounter:N,activeTab:_="adversaries",selectedCustomAdversaryId:b,onSelectCustomAdversary:O,onTabChange:se,selectedAdversary:q,onSelectAdversary:X,filterCustom:U=!1,showCustomToggle:te=!1,onToggleCustom:re,onExportCustomAdversaries:Te,onImportCustomAdversaries:ze,autoFocus:Oe=!1,hideImportExport:ne=!1,onClose:F=null,searchPlaceholder:fe="Search"})=>{const{addCustomAdversary:ke,updateCustomAdversary:le,customContent:E}=Et(),[C,Z]=m.useState(null),[K,$]=m.useState("all"),[we,ee]=m.useState(!1),[R,ce]=m.useState({}),xe=m.useRef({}),Re=m.useRef(null),Ve=()=>{try{const A=E.adversaries||[];if(A.length===0){alert("No custom adversaries to export.");return}const ye=["name","tier","type","difficulty","threshold_major","threshold_severe","hp_max","stress_max","atk","weapon","range","damage","description","motives"],Se=A.map(Ce=>{var oe,Ne;return[Ce.name||"",Ce.tier||"",Ce.type||"",Ce.difficulty||"",((oe=Ce.thresholds)==null?void 0:oe.major)||"",((Ne=Ce.thresholds)==null?void 0:Ne.severe)||"",Ce.hpMax||"",Ce.stressMax||"",Ce.atk||"",Ce.weapon||"",Ce.range||"",Ce.damage||"",Ce.description||"",Ce.motives||""]}),Le=Ce=>{const oe=String(Ce);return oe.includes(",")||oe.includes('"')||oe.includes(`
`)?`"${oe.replace(/"/g,'""')}"`:oe},He=[ye.join(","),...Se.map(Ce=>Ce.map(Le).join(","))].join(`
`),Fe=new Blob([He],{type:"text/csv;charset=utf-8;"}),Pe=URL.createObjectURL(Fe),Ee=document.createElement("a");Ee.href=Pe,Ee.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(Ee),Ee.click(),document.body.removeChild(Ee),URL.revokeObjectURL(Pe),console.log(`Exported ${A.length} custom adversaries to CSV`)}catch(A){console.error("Failed to export custom adversaries:",A),alert("Failed to export custom adversaries. Please try again.")}},l=A=>{const ye=A.target.files[0];if(!ye)return;const Se=ye.name.endsWith(".csv"),Le=ye.name.endsWith(".json");if(!Se&&!Le){alert("Please upload a CSV or JSON file."),A.target.value="";return}const He=new FileReader;He.onload=Fe=>{try{let Pe=[];if(Se){const n=Fe.target.result.split(`
`).filter(T=>T.trim());if(n.length<2)throw new Error("CSV file is empty or invalid.");const i=n[0].split(",").map(T=>T.trim().replace(/^"|"$/g,""));for(let T=1;T<n.length;T++){const k=[];let L="",ve=!1;for(let H=0;H<n[T].length;H++){const be=n[T][H],je=n[T][H+1];be==='"'&&ve&&je==='"'?(L+='"',H++):be==='"'?ve=!ve:be===","&&!ve?(k.push(L.trim()),L=""):L+=be}k.push(L.trim());const de={name:k[i.indexOf("name")]||"",tier:parseInt(k[i.indexOf("tier")])||1,type:k[i.indexOf("type")]||"Standard",difficulty:parseInt(k[i.indexOf("difficulty")])||11,thresholds:{major:parseInt(k[i.indexOf("threshold_major")])||7,severe:parseInt(k[i.indexOf("threshold_severe")])||12},hpMax:parseInt(k[i.indexOf("hp_max")])||3,stressMax:parseInt(k[i.indexOf("stress_max")])||1,atk:parseInt(k[i.indexOf("atk")])||1,weapon:k[i.indexOf("weapon")]||"",range:k[i.indexOf("range")]||"Melee",damage:k[i.indexOf("damage")]||"",description:k[i.indexOf("description")]||"",motives:k[i.indexOf("motives")]||"",source:"Homebrew"};de.name&&Pe.push(de)}}else if(Le){const $e=JSON.parse(Fe.target.result);if(!$e.customAdversaries||!Array.isArray($e.customAdversaries))throw new Error("Invalid JSON format. Expected customAdversaries array.");Pe=$e.customAdversaries}const Ee=E.adversaries||[],Ce=[...Ee];let oe=0,Ne=0;Pe.forEach($e=>{if(Ee.some(i=>i.name===$e.name&&i.source===$e.source))Ne++;else{const i={...$e,id:`custom-adv-${Date.now()}-${Math.random().toString(36).slice(2,10)}`,hp:0,stress:0};Ce.push(i),oe++}}),oe>0?(localStorage.setItem("daggerheart-custom-adversaries",JSON.stringify(Ce)),window.location.reload(),alert(`Import successful! Added ${oe} new adversaries${Ne>0?`, skipped ${Ne} duplicates`:""}.`)):alert("No new adversaries were added. All imported adversaries already exist.")}catch(Pe){console.error("Failed to import custom adversaries:",Pe),alert(`Failed to import custom adversaries: ${Pe.message}`)}},He.readAsText(ye),A.target.value=""},h=()=>{Z(null)},y=async(A,ye)=>{ye?le(ye,A):ke(A)},f=A=>{R[A]?(N&&N(A),ce(ye=>{const Se={...ye};return delete Se[A],Se}),xe.current[A]&&(clearTimeout(xe.current[A]),delete xe.current[A])):(ce(ye=>({...ye,[A]:!0})),xe.current[A]&&clearTimeout(xe.current[A]),xe.current[A]=setTimeout(()=>{ce(ye=>{const Se={...ye};return delete Se[A],Se}),delete xe.current[A]},3e3))};m.useEffect(()=>()=>{Object.values(xe.current).forEach(A=>{clearTimeout(A)})},[]);const{searchTerm:a,setSearchTerm:v,sortFields:z,handleSort:D,filteredAndSortedData:V,loading:me,selectedTiers:We,selectedTypes:Be,showTierDropdown:Je,setShowTierDropdown:s,showTypeDropdown:I,setShowTypeDropdown:r,tierFilterRef:M,typeFilterRef:ae,uniqueTiers:B,uniqueTypes:G,handleTierSelect:d,handleTypeSelect:j,isTierFiltered:w,isTypeFiltered:Q,getDropdownStyle:J}=Cr(t,S,u,g,U,E),ue=(()=>{const A=3*u+2,ye=S.reduce((oe,Ne)=>{if(Ne.type==="adversary"){const $e=dt[Ne.item.type]||2;if(Ne.item.type==="Minion"){const n=Math.ceil(Ne.quantity/u);return oe+n*$e}else return oe+Ne.quantity*$e}return oe},0);let Se=0;S.filter(oe=>oe.type==="adversary"&&oe.item.type==="Solo"&&oe.quantity>0).reduce((oe,Ne)=>oe+Ne.quantity,0)>=2&&(Se+=mt.twoOrMoreSolos);const He=S.some(oe=>oe.type==="adversary"&&oe.item.type==="Bruiser"&&oe.quantity>0),Fe=S.some(oe=>oe.type==="adversary"&&oe.item.type==="Horde"&&oe.quantity>0),Pe=S.some(oe=>oe.type==="adversary"&&oe.item.type==="Leader"&&oe.quantity>0),Ee=S.some(oe=>oe.type==="adversary"&&oe.item.type==="Solo"&&oe.quantity>0);return!He&&!Fe&&!Pe&&!Ee&&(Se+=mt.noBruisersHordesLeadersSolos),A+Se-ye})(),he=A=>{$(A),ee(!1)},pe=K!=="all";return me?e.jsx("div",{style:ie.browser,children:e.jsx("div",{style:ie.loading,children:"Loading..."})}):e.jsx(e.Fragment,{children:e.jsxs("div",{style:x?ie.browserWrapper:ie.browserWrapperNoContainer,children:[_==="adversaries"&&e.jsxs(e.Fragment,{children:[e.jsx(wr,{searchTerm:a,onSearchChange:v,type:t,partyControls:Y,autoFocus:Oe,onClose:F,placeholder:fe}),!ne&&e.jsx(Sr,{showCustomToggle:te,onToggleCustom:re,filterCustom:U,onExportCustomAdversaries:Ve,onImportCustomAdversaries:l}),e.jsx("div",{className:"browser-content invisible-scrollbar",style:ie.browserContent,children:e.jsxs("table",{style:ie.browserTable,children:[e.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,backgroundColor:"var(--bg-primary)"},children:e.jsx(jr,{sortFields:z,onSort:D,type:t,uniqueTiers:B,uniqueTypes:G,selectedTiers:We,selectedTypes:Be,showTierDropdown:Je,setShowTierDropdown:s,showTypeDropdown:I,setShowTypeDropdown:r,tierFilterRef:M,typeFilterRef:ae,handleTierSelect:d,handleTypeSelect:j,isTierFiltered:w,isTypeFiltered:Q,getDropdownStyle:J,costFilter:K,showCostDropdown:we,setShowCostDropdown:ee,costFilterRef:Re,handleCostFilterSelect:he,isCostFiltered:pe})}),e.jsx("tbody",{children:V.map(A=>e.jsx(kr,{item:A,onAdd:o,type:t,onRowClick:c,encounterItems:S,pcCount:u,playerTier:g,remainingBudget:ue,costFilter:K},A.id))})]})})]}),_==="encounters"&&e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:W.length===0?e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",textAlign:"center",padding:"2rem 1rem"},children:"No saved encounters yet"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:W.map(A=>e.jsxs("div",{onClick:()=>P&&P(A.id),className:"saved-encounter-card",style:{border:"1px solid var(--border)",borderRadius:"8px",padding:"8px",backgroundColor:"var(--bg-card)",transition:"background-color 0.2s ease",display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsxs("div",{style:{minWidth:"100px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",flexDirection:"column",justifyContent:"center",minHeight:"60px"},children:[e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Tier: ",(()=>{var Le,He,Fe,Pe;const ye=((Pe=(Fe=(He=(Le=A.encounterItems)==null?void 0:Le.filter(Ee=>Ee.type==="adversary"))==null?void 0:He.map(Ee=>Ee.item.tier))==null?void 0:Fe.filter(Ee=>Ee!=null))==null?void 0:Pe.sort((Ee,Ce)=>Ee-Ce))||[];if(ye.length===0)return"N/A";if(ye.length===1)return ye[0];const Se=[...new Set(ye)];return Se.length===1?Se[0]:`${Math.min(...Se)}-${Math.max(...Se)}`})()]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Party Size: ",A.partySize||4]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)"},children:["Balance: ",(()=>{const ye=A.partySize||4,Se=3*ye+2;let Le=0;const He=A.encounterItems||[];He.filter(n=>n.type==="adversary"&&n.item.type==="Solo"&&n.quantity>0).reduce((n,i)=>n+i.quantity,0)>=2&&(Le+=mt.twoOrMoreSolos);const Pe=He.some(n=>n.type==="adversary"&&n.item.type==="Bruiser"&&n.quantity>0),Ee=He.some(n=>n.type==="adversary"&&n.item.type==="Horde"&&n.quantity>0),Ce=He.some(n=>n.type==="adversary"&&n.item.type==="Leader"&&n.quantity>0),oe=He.some(n=>n.type==="adversary"&&n.item.type==="Solo"&&n.quantity>0);!Pe&&!Ee&&!Ce&&!oe&&(Le+=mt.noBruisersHordesLeadersSolos);const Ne=Se+Le,$e=He.reduce((n,i)=>{if(i.type==="adversary"){const T=dt[i.item.type]||2;if(i.item.type==="Minion"){const k=Math.ceil(i.quantity/ye);return n+k*T}else return n+i.quantity*T}return n},0);return $e>Ne?`+${$e-Ne}`:$e===Ne?"0":`-${Ne-$e}`})()]})]}),e.jsx("div",{style:{minWidth:"120px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",alignItems:"center",minHeight:"60px"},children:e.jsx("div",{style:{fontWeight:"500",color:"var(--text-primary)",fontSize:"0.9rem",wordWrap:"break-word",wordBreak:"break-word",width:"150px",maxWidth:"150px"},children:A.name})}),e.jsx(vr,{encounter:A}),e.jsx("button",{onClick:ye=>{ye.stopPropagation(),f(A.id)},style:{background:R[A.id]?"var(--danger)":"var(--gray-600)",border:"none",color:"white",padding:"0.4rem 0.8rem",borderRadius:"4px",fontSize:"0.75rem",cursor:"pointer",minWidth:"60px",transition:"background-color 0.2s"},children:"Delete"})]},A.id))})}),_==="create"&&e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"1rem",display:"flex",justifyContent:"center",alignItems:"flex-start",height:"100%",minHeight:0},children:e.jsx("div",{style:{maxWidth:"600px",width:"100%",height:"auto",display:"flex",flexDirection:"column",padding:"0",overflowY:"visible",overflowX:"hidden",minHeight:0},children:e.jsx(Mt,{onSave:y,onRefresh:()=>{},onAddItem:o,editingAdversary:C,onCancelEdit:h,embedded:!1})})}),_==="info"&&e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"2rem"},children:[e.jsxs("div",{style:{marginBottom:"2rem",textAlign:"center"},children:[e.jsx("img",{src:gr,alt:"Daggerheart Community Content Logo",style:{width:"100%",maxWidth:"300px",height:"auto",margin:"0 auto 1.5rem auto",display:"block"},onError:A=>{console.error("Failed to load Daggerheart logo:",A.target.src),A.target.style.display="none"}}),e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",textAlign:"left",maxWidth:"600px",margin:"0 auto"},children:[e.jsx("p",{style:{marginTop:0},children:"This product includes materials from the Daggerheart System Reference Document 1.0, © Critical Role, LLC, under the terms of the Darrington Press Community Gaming (DPCGL) License."}),e.jsxs("p",{children:["More information can be found at ",e.jsx("a",{href:"https://www.daggerheart.com",target:"_blank",rel:"noopener noreferrer",style:{color:"var(--purple)",textDecoration:"underline"},children:"daggerheart.com"})]}),e.jsx("p",{style:{marginBottom:0},children:e.jsx("em",{children:"This project is unofficial and not endorsed by Darrington Press or Critical Role."})})]})]}),e.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto",border:"1px solid var(--border)",borderRadius:"8px",overflow:"hidden"},children:[e.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"1rem 1.5rem",color:"var(--text-primary)",border:"none",background:"var(--bg-secondary)",width:"100%",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"0.875rem",borderBottom:"1px solid var(--border)"},onMouseEnter:A=>{A.target.style.backgroundColor="var(--bg-hover)"},onMouseLeave:A=>{A.target.style.backgroundColor="var(--bg-secondary)"},onClick:A=>{A.stopPropagation(),window.open("https://github.com/Splinter714/Daggerheart","_blank")},children:[e.jsx("span",{children:"View on GitHub"}),e.jsx("span",{children:"→"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem 1.5rem",color:"var(--text-secondary)",background:"var(--bg-secondary)",fontSize:"0.875rem"},children:["Version ","0.4.7 (e3953d9)"]})]})]})]})})},ie={browserWrapper:{display:"flex",flexDirection:"column",background:"var(--bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border)",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserWrapperNoContainer:{display:"flex",flexDirection:"column",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserContent:{flex:1,overflowY:"auto",overflowX:"visible",padding:0,width:"100%",scrollbarWidth:"none",msOverflowStyle:"none",borderRadius:"0 0 8px 8px"},tableHeaderContainer:{flexShrink:0,position:"sticky",top:0,zIndex:15,backgroundColor:"var(--bg-secondary)"},browserTable:{width:"100%",minWidth:"100%",borderCollapse:"collapse",tableLayout:"fixed",background:"var(--bg-primary)",margin:0},browserHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--gray-900)",flexShrink:0,position:"sticky",top:0,zIndex:20},browserTitle:{margin:0,color:"var(--text-primary)",fontSize:"18px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"24px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",marginRight:"12px",transition:"all 0.2s ease"},partyControls:{display:"flex",alignItems:"center",gap:"12px",flexShrink:0},searchInputFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 3px rgba(139, 92, 246, 0.1)"},tableHeader:{background:"var(--gray-900)",borderBottom:"1px solid var(--border)",boxShadow:"0 1px 0 var(--border)",position:"sticky",top:"0",zIndex:10},tableHeaderCell:{backgroundColor:"var(--gray-900)",fontWeight:"700",borderBottom:"1px solid var(--border)",cursor:"pointer",userSelect:"none",minWidth:"100px",whiteSpace:"nowrap",padding:"4px 4px",color:"var(--text-primary)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",boxShadow:"0 1px 0 var(--border)",transition:"background-color 0.2s",position:"sticky",top:"0",zIndex:10},tableHeaderCellHover:{backgroundColor:"var(--bg-hover)"},sortIndicator:{fontSize:"12px",color:"var(--text-secondary)"},tableBody:{flex:1,overflowY:"auto",padding:"8px",backgroundColor:"var(--bg-primary)"},row:{height:"35px",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s ease",cursor:"pointer",backgroundColor:"var(--gray-900)"},rowHover:{backgroundColor:"var(--bg-secondary)"},expandedRow:{backgroundColor:"var(--bg-secondary)"},rowCell:{padding:"4px 4px",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid var(--border)"},rowCellName:{fontWeight:"500",minWidth:"150px"},rowCellCenter:{textAlign:"center",justifyContent:"center",minWidth:"80px"},rowActions:{width:"80px",textAlign:"center",padding:"4px 8px",borderBottom:"1px solid var(--border)"},addButton:{width:"2rem",height:"2rem",border:"1px solid var(--purple)",borderRadius:"var(--radius-sm)",background:"var(--purple)",color:"white",cursor:"pointer",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"500"},expandedContent:{padding:"0",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)"},columnName:{width:"auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",paddingLeft:"8px",textAlign:"left"},columnTier:{width:"80px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnType:{width:"100px",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},columnDifficulty:{width:"40px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnAction:{width:"32px",minWidth:"24px",maxWidth:"24px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"visible",textOverflow:"unset"},loading:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"var(--text-primary)",fontSize:"16px"},mobileBrowser:{width:"95vw",height:"90vh",maxWidth:"none"},mobileSearchInput:{fontSize:"16px"},headerWithFilter:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0px",position:"relative"},headerFilterIcon:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"2px 4px",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",position:"relative",marginLeft:"-2px"},headerFilterIconActive:{color:"var(--purple)"},filterIcon:{fontSize:"12px"},filterActiveDot:{position:"absolute",left:"50%",top:"2px",transform:"translateX(-50%)",width:"4px",height:"4px",borderRadius:"50%",background:"var(--purple)",pointerEvents:"none"},filterDropdown:{position:"fixed",background:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",zIndex:99999,marginTop:"4px",overflow:"hidden",width:"max-content",minWidth:"120px",maxWidth:"200px"},filterOption:{padding:"8px 12px",cursor:"pointer",color:"var(--text-primary)",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background-color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},filterOptionSelected:{backgroundColor:"var(--bg-hover)"},checkIcon:{width:"16px",height:"16px",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"12px"},filterLabel:{flex:1}},Ir=()=>e.jsx("div",{className:"pwa-install-prompt",style:{}}),wt=({side:t="left",children:o,className:p="",style:c={}})=>{const S=t==="left",u={flex:1,minWidth:0,background:"var(--bg-primary)",overflowY:"auto",overflowX:S?"auto":"hidden",display:S?"block":"flex",flexDirection:S?"initial":"column",height:"100%",padding:S?"8px 0 8px 0":"0 8px 0 0",...c};return e.jsx("div",{className:p,style:u,children:o})},Ar=t=>3*t+2,Er={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},St={lessDifficult:-1,twoOrMoreSolos:-2,increasedDamage:-2,lowerTierAdversary:1,noBruisersHordesLeadersSolos:1,moreDangerous:2},Mr=({isOpen:t,onClose:o,onAddAdversary:p,onAddAdversariesBulk:c,onAddEnvironment:S,onDeleteAdversary:u,onDeleteEnvironment:g,onDeleteCountdown:Y,adversaries:x=[],environments:W=[],countdowns:P=[],savedEncounters:N=[],onSaveEncounter:_,onLoadEncounter:b,onDeleteEncounter:O})=>{const{partySize:se,updatePartySize:q,currentEncounterName:X,updateCurrentEncounterName:U,customContent:te}=Et(),re=se,Te=q,[ze,Oe]=m.useState({lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),[ne,F]=m.useState([]),[fe,ke]=m.useState(X||"Encounter"),[le,E]=m.useState("adversaries"),[C,Z]=m.useState(null),[K,$]=m.useState(null),[we,ee]=m.useState(null),[R,ce]=m.useState(null),[xe,Re]=m.useState(!1);m.useEffect(()=>{t&&!C&&ke(X||"Encounter")},[t,C,X]);const Ve=()=>K?fe!==K.name||JSON.stringify(ne)!==JSON.stringify(K.encounterItems)||re!==K.partySize||JSON.stringify(ze)!==JSON.stringify(K.battlePointsAdjustments):!1,l=()=>{var d;if(ne.length>0||(fe||"").trim()!=="Encounter")return!0;if(C&&Ve()){if(K){const j=ne.length,w=((d=K.encounterItems)==null?void 0:d.length)||0;if(j!==w||(fe||"").trim()!==(K.name||""))return!0;const Q=JSON.stringify(ze),J=JSON.stringify(K.battlePointsAdjustments||{});return Q!==J}return!0}return!1},h=({onClick:d,children:j,variant:w="secondary",isConfirmation:Q=!1})=>{const J=w==="danger"||w==="secondary"&&Q,ge=w==="purple";return e.jsx("button",{onClick:d,style:{background:J?"var(--danger)":ge?"var(--purple)":"var(--bg-secondary)",border:ge?"none":"1px solid var(--border)",color:J||ge?"white":"var(--text-primary)",padding:"0.375rem 0.75rem",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s",width:"70px",fontSize:"0.875rem"},children:j})},y=rt.useRef(re),f=m.useCallback(d=>!d||d.length===0?null:N.find(w=>{var ue,he;if(((ue=w.encounterItems)==null?void 0:ue.length)!==d.length)return!1;const Q=pe=>{var A;return{type:pe.type,quantity:pe.quantity,item:{name:pe.item.baseName||((A=pe.item.name)==null?void 0:A.replace(/\s+\(\d+\)$/,""))||pe.item.name,type:pe.item.type,tier:pe.item.tier}}},J=(he=w.encounterItems)==null?void 0:he.map(Q).sort((pe,A)=>pe.item.name.localeCompare(A.item.name)||pe.item.type.localeCompare(A.item.type)),ge=d.map(Q).sort((pe,A)=>pe.item.name.localeCompare(A.item.name)||pe.item.type.localeCompare(A.item.type));return JSON.stringify(J)===JSON.stringify(ge)})||null,[N]);rt.useEffect(()=>{if(t&&x.length>0&&ne.length===0){const d={};x.forEach(Q=>{var ge;const J=Q.baseName||((ge=Q.name)==null?void 0:ge.replace(/\s+\(\d+\)$/,""))||Q.name;d[J]||(d[J]={type:"adversary",item:Q,quantity:0}),d[J].quantity+=1});const j=Object.values(d);F(j);const w=f(j);w&&!C&&(Z(w.id),$({name:w.name||"",encounterItems:w.encounterItems||[],partySize:w.partySize||4,battlePointsAdjustments:w.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),ke(w.name||"Encounter"),U(w.name||"Encounter"))}else t&&x.length===0&&ne.length===0&&F([])},[t,f,C,U]);const a=rt.useMemo(()=>{let d=0;ne.filter(ue=>ue.type==="adversary"&&ue.item.type==="Solo"&&ue.quantity>0).reduce((ue,he)=>ue+he.quantity,0)>=2&&(d+=St.twoOrMoreSolos);const w=ne.some(ue=>ue.type==="adversary"&&ue.item.type==="Bruiser"&&ue.quantity>0),Q=ne.some(ue=>ue.type==="adversary"&&ue.item.type==="Horde"&&ue.quantity>0),J=ne.some(ue=>ue.type==="adversary"&&ue.item.type==="Leader"&&ue.quantity>0),ge=ne.some(ue=>ue.type==="adversary"&&ue.item.type==="Solo"&&ue.quantity>0);return!w&&!Q&&!J&&!ge&&(d+=St.noBruisersHordesLeadersSolos),d},[ne]),v=Ar(re),z=Object.entries(ze).filter(([d,j])=>j).reduce((d,[j,w])=>d+St[j],0),D=v+z+a,V=ne.reduce((d,j)=>{if(j.type==="adversary"){const w=Er[j.item.type]||2;return j.item.type==="Minion"?d+Math.ceil(j.quantity/re)*w:d+w*j.quantity}return d},0);rt.useEffect(()=>{const d=y.current;d!==re&&(F(j=>j.map(w=>{if(w.type==="adversary"&&w.item.type==="Minion"){const J=Math.ceil(w.quantity/d)*re;return{...w,quantity:J}}return w})),y.current=re)},[re]);const me=(d,j)=>{const w=ne.findIndex(ge=>ge.item.id===d.id&&ge.type===j),Q=d.type==="Minion"?re:1;let J;w>=0?J=ne.map((ge,ue)=>ue===w?{...ge,quantity:ge.quantity+Q}:ge):J=[...ne,{item:d,type:j,quantity:Q}],F(J),We(J)},We=d=>{const j=x||[],w=[];d.forEach(he=>{for(let pe=0;pe<he.quantity;pe++)he.type==="adversary"&&w.push(he.item)});const Q={};j.forEach(he=>{var A;const pe=he.baseName||((A=he.name)==null?void 0:A.replace(/\s+\(\d+\)$/,""))||he.name;Q[pe]||(Q[pe]=[]),Q[pe].push(he)});const J={};w.forEach(he=>{var A;const pe=he.baseName||((A=he.name)==null?void 0:A.replace(/\s+\(\d+\)$/,""))||he.name;J[pe]||(J[pe]=[]),J[pe].push(he)});const ge=[],ue=[];Object.keys(J).forEach(he=>{var ye;const pe=((ye=Q[he])==null?void 0:ye.length)||0,A=J[he].length;if(A>pe){const Se=A-pe;for(let Le=0;Le<Se;Le++)ge.push(J[he][0])}else if(A<pe){const Se=pe-A,He=[...Q[he]].sort((Fe,Pe)=>{const Ee=Fe.duplicateNumber||1;return(Pe.duplicateNumber||1)-Ee});for(let Fe=0;Fe<Se;Fe++)ue.push(He[Fe].id)}}),Object.keys(Q).forEach(he=>{J[he]||[...Q[he]].sort((ye,Se)=>{const Le=ye.duplicateNumber||1;return(Se.duplicateNumber||1)-Le}).forEach(ye=>{ue.push(ye.id)})}),ue.forEach(he=>{u(he)}),ge.length>0&&c(ge)},Be=(d,j)=>{const w=(()=>{const Q=ne.findIndex(J=>J.item.id===d&&J.type===j);if(Q>=0){const J=ne[Q];if(J.quantity===0)return ne.filter((he,pe)=>pe!==Q);const ge=J.item.type==="Minion"?re:1,ue=Math.max(0,J.quantity-ge);return ne.map((he,pe)=>pe===Q?{...he,quantity:ue}:he)}return ne})();F(w),We(w)},Je=m.useCallback(()=>{if(ne.length===0)return null;const d=(fe||"").trim()||"Encounter",j=N.find(w=>{var ge,ue;if(w.name!==d||((ge=w.encounterItems)==null?void 0:ge.length)!==ne.length)return!1;const Q=JSON.stringify((ue=w.encounterItems)==null?void 0:ue.sort()),J=JSON.stringify([...ne].sort());return Q===J});return(j==null?void 0:j.id)||null},[N,fe,ne]),s=m.useCallback(()=>{let d=(fe||"").trim(),j=C;if(j||(j=Je()),ne.length===0&&(!d||d==="Encounter")&&j){O(j),Z(null),$(null);return}const w={name:d,encounterItems:ne,partySize:re,battlePointsAdjustments:ze};if(j){w.id=j;const Q=_(w);Z(Q)}else{const Q=_(w);Z(Q)}$({name:d,encounterItems:ne,partySize:re,battlePointsAdjustments:ze})},[ne,fe,re,ze,C,_,Je,O]);m.useEffect(()=>{if(C&&Ve()){const d=setTimeout(()=>{s()},2e3);return()=>clearTimeout(d)}else if(!C&&ne.length>0&&fe&&fe.trim()!==""){const d=setTimeout(()=>{s()},2e3);return()=>clearTimeout(d)}},[ne,C,fe,ze,re]);const I=()=>{l()&&(F([]),ke("Encounter"),U("Encounter"),Z(null),$(null),x.forEach(d=>{u(d.id)}),W.forEach(d=>{g(d.id)}),P.forEach(d=>{Y(d.id)}))},r=d=>{const j=b(d);if(j){const w=j.encounterItems||[];F(w),Te(j.partySize||4),Oe(j.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),ke(j.name||""),U(j.name||""),Z(d),$({name:j.name||"",encounterItems:j.encounterItems||[],partySize:j.partySize||4,battlePointsAdjustments:j.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),We(w)}},M=d=>{O(d),C===d&&(F([]),ke("Encounter"),U("Encounter"),Z(null),$(null),x.forEach(j=>{u(j.id)}),W.forEach(j=>{g(j.id)}),P.forEach(j=>{Y(j.id)}))},ae=()=>{try{const d={version:"1.0",exportDate:new Date().toISOString(),customAdversaries:te.adversaries||[]},j=JSON.stringify(d,null,2),w=new Blob([j],{type:"application/json"}),Q=URL.createObjectURL(w),J=document.createElement("a");J.href=Q,J.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(J),J.click(),document.body.removeChild(J),URL.revokeObjectURL(Q),console.log("Custom adversaries exported successfully")}catch(d){console.error("Failed to export custom adversaries:",d),alert("Failed to export custom adversaries. Please try again.")}},B=d=>{const j=d.target.files[0];if(!j)return;const w=new FileReader;w.onload=Q=>{try{const J=JSON.parse(Q.target.result);if(!J.customAdversaries||!Array.isArray(J.customAdversaries))throw new Error("Invalid file format. Expected customAdversaries array.");const ge=te.adversaries||[],ue=J.customAdversaries,he=[...ge];let pe=0;ue.forEach(A=>{ge.some(Se=>Se.name===A.name&&Se.type===A.type)||(he.push({...A,id:`custom-${Date.now()}-${Math.random().toString(36).slice(2,10)}`}),pe++)}),updateCustomContent("adversary",null,he),pe>0?alert(`Successfully imported ${pe} custom adversaries.`):alert("No new adversaries were added. All imported adversaries already exist.")}catch(J){console.error("Failed to import custom adversaries:",J),alert("Failed to import custom adversaries. Please check the file format and try again.")}},w.readAsText(j),d.target.value=""};if(!t)return null;const G=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://");return e.jsx("div",{onClick:o,className:"encounter-builder-modal",style:{position:"fixed",top:0,left:0,right:0,bottom:G?"calc(60px + env(safe-area-inset-bottom) + 1rem)":"calc(60px + env(safe-area-inset-bottom))",backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:1e3,display:"flex",alignItems:"flex-start",justifyContent:"center",padding:"12px"},children:e.jsxs("div",{onClick:d=>d.stopPropagation(),style:{backgroundColor:"var(--bg-primary)",border:"2px solid var(--border)",borderRadius:"12px",width:"100%",maxWidth:"1200px",height:"100%",maxHeight:"100%",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"},children:[e.jsxs("div",{className:"encounter-top-bar",style:{flex:"0 0 auto",display:"flex",alignItems:"center",height:"39px",backgroundColor:"var(--bg-primary)",borderBottom:"1px solid var(--border)"},children:[e.jsx("button",{onClick:()=>E("adversaries"),style:{flex:1,background:le==="adversaries"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:le==="adversaries"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Builder"}),e.jsx("button",{onClick:()=>E("encounters"),style:{flex:1,background:le==="encounters"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:le==="encounters"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Saved Encounters"}),e.jsx("button",{onClick:()=>E("create"),style:{flex:1,background:le==="create"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:le==="create"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Create Adversary"}),e.jsx("button",{onClick:()=>E("info"),style:{flex:1,background:le==="info"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:le==="info"?"500":"400",transition:"all 0.2s ease",position:"relative"},children:"Info"})]}),e.jsxs("div",{className:"encounter-builder-content",style:{flex:1,display:"flex",overflow:"hidden"},children:[e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",borderTop:"1px solid var(--border)"},children:e.jsx(Vt,{type:"adversary",onAddItem:d=>me(d,"adversary"),encounterItems:ne,pcCount:re,showContainer:!1,savedEncounters:N,onLoadEncounter:r,onDeleteEncounter:M,activeTab:le,selectedCustomAdversaryId:we,onSelectCustomAdversary:ee,onTabChange:E,selectedAdversary:R,onSelectAdversary:ce,filterCustom:xe,showCustomToggle:!0,onToggleCustom:Re,onExportCustomAdversaries:ae,onImportCustomAdversaries:B})}),le!=="info"&&e.jsxs("div",{className:"encounter-right-panel",style:{flex:1,borderLeft:"1px solid var(--border)",display:"flex",flexDirection:"column",overflow:"hidden",position:"relative"},children:[R&&e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"var(--bg-primary)",zIndex:10,display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)",flexShrink:0},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:0},children:"Adversary Preview"}),e.jsx("button",{onClick:()=>ce(null),style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease"},onMouseEnter:d=>d.target.style.color="var(--text-primary)",onMouseLeave:d=>d.target.style.color="var(--text-secondary)",title:"Close preview",children:e.jsx(ot,{size:16})})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"0.75rem"},children:e.jsx(ht,{item:{...R,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...R,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}})})]}),(le==="adversaries"||le==="encounters")&&e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-primary)",flexShrink:0},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:fe,onChange:d=>{ke(d.target.value),U(d.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(h,{onClick:I,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:l()?1:.5,cursor:l()?"pointer":"not-allowed"},children:"New"})]})}),(le==="adversaries"||le==="encounters")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"encounter-receipt-buttons-vertical",style:{display:"none",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:fe,onChange:d=>{ke(d.target.value),U(d.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(h,{onClick:I,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:l()?1:.5,cursor:l()?"pointer":"not-allowed"},children:"New"})]})}),e.jsx("div",{className:"receipt-content",style:{padding:"1rem",display:"flex",flexDirection:"column",height:"100%"},children:e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"flex-start",overflowY:"auto",marginBottom:"0.75rem"},children:[e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>Te(Math.max(1,re-1)),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(ft,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:re}),e.jsx("button",{onClick:()=>Te(re+1),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(at,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Party Size"})}),e.jsx("div",{style:{width:"120px",textAlign:"right"}})]}),ne.map(d=>{var j;return d.type!=="adversary"?null:e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>Be(d.item.id,d.type),style:{background:d.quantity===0?"var(--danger)":"var(--bg-secondary)",border:d.quantity===0?"none":"1px solid var(--border)",color:d.quantity===0?"white":"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:d.quantity===0?e.jsx(ot,{size:10}):e.jsx(ft,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:d.quantity}),e.jsx("button",{onClick:()=>me(d.item,d.type),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(at,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:d.item.baseName||((j=d.item.name)==null?void 0:j.replace(/\s+\(\d+\)$/,""))||d.item.name})}),e.jsx("div",{style:{width:"80px",textAlign:"right"},children:e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.8rem"},children:d.item.type})})]},`${d.item.id}-${d.type}`)}),e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Balance"})}),e.jsx("div",{style:{width:"120px",textAlign:"right",display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsx("span",{style:{color:V>D?"var(--danger)":V===D?"var(--purple)":"var(--success)",fontWeight:600},children:V>D?`+${V-D}`:D-V===0?"0":`-${D-V}`})})]})]})})]}),le==="create"&&e.jsxs("div",{style:{padding:"1.5rem",overflowY:"auto",height:"100%"},children:[e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Creating Adversaries"}),e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsx("p",{children:"Use the form to create custom adversaries for your encounters."}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Adversary Types:"}),e.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Minion (1 BP):"})," Weak enemies in groups"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Standard (2 BP):"})," Average threat level"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Leader (3 BP):"})," Commands others"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Bruiser (4 BP):"})," High HP tank"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Solo (5 BP):"})," Boss-level threat"]})]})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Tips:"}),e.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[e.jsx("li",{children:"Match adversary tier to party level"}),e.jsx("li",{children:"Balance encounter difficulty with Battle Points"}),e.jsx("li",{children:"Mix adversary types for variety"}),e.jsx("li",{children:"Add features that create interesting choices"})]})]})]})]}),le==="myAdversaries"&&e.jsx("div",{style:{padding:"0.75rem",overflowY:"auto",height:"100%"},children:we?(()=>{var j;const d=(j=te==null?void 0:te.adversaries)==null?void 0:j.find(w=>w.id===we);return d?e.jsx(ht,{item:{...d,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...d,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}}):e.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Adversary not found"})})():e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Adversary Preview"}),e.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Select an adversary to view details"})]})})]})]})]})})},Tr=t=>3*t+2,zr={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},Dt={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1};class Rr extends rt.Component{constructor(o){super(o),this.state={hasError:!1,error:null}}static getDerivedStateFromError(o){return{hasError:!0,error:o}}componentDidCatch(o,p){console.error("ErrorBoundary caught an error:",o,p)}render(){var o;return this.state.hasError?e.jsxs("div",{className:"p-md text-red",children:[e.jsx("h3",{children:"Something went wrong:"}),e.jsx("pre",{children:(o=this.state.error)==null?void 0:o.toString()}),e.jsx("button",{className:"btn-base btn-text",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try again"})]}):this.props.children}}const Wr=()=>{const{adversaries:t,environments:o,countdowns:p,fear:c,savedEncounters:S,partySize:u,customContent:g,updatePartySize:Y,updateFear:x,createAdversary:W,createAdversariesBulk:P,updateAdversary:N,deleteAdversary:_,addCustomAdversary:b,updateCustomAdversary:O,createEnvironment:se,updateEnvironment:q,deleteEnvironment:X,createCountdown:U,updateCountdown:te,deleteCountdown:re,advanceCountdown:Te,saveEncounter:ze,loadEncounter:Oe,deleteEncounter:ne}=Et(),F=u||4,[fe,ke]=m.useState(!1),[le,E]=m.useState(!1);m.useState(!1),m.useState(!1),m.useState(!0);const[C,Z]=m.useState(null),[K,$]=m.useState(null),[we,ee]=m.useState(null),[R,ce]=m.useState(!1),[xe,Re]=m.useState("adversaries"),[Ve,l]=m.useState(null),[h,y]=m.useState(0),[f,a]=m.useState(0),[v,z]=m.useState(!1);m.useState(new Set);const[D,V]=m.useState(new Set),[me,We]=m.useState(null),[Be,Je]=m.useState(!1),s=m.useRef(null),I=m.useRef(F);m.useEffect(()=>{const n=I.current;if(n!==F&&n>0){const i={};t.forEach(T=>{var L;const k=T.baseName||((L=T.name)==null?void 0:L.replace(/\s+\(\d+\)$/,""))||T.name;i[k]||(i[k]={type:"adversary",baseName:k,instances:[]}),i[k].instances.push(T)}),Object.values(i).forEach(T=>{if(T.type==="adversary"&&T.instances.length>0){const k=T.instances[0];if(k.type==="Minion"){const L=T.instances.length,de=Math.ceil(L/n)*F;if(de!==L)if(de>L){const H=de-L,be=Array(H).fill(null).map(()=>({...k}));P(be)}else{const H=L-de;T.instances.slice(-H).forEach(je=>{_(je.id)})}}}}),I.current=F}else(n===0||I.current===0)&&(I.current=F)},[F]),m.useEffect(()=>{const n=()=>{const T=window.matchMedia("(max-width: 800px)");ke(T.matches)};n();const i=window.matchMedia("(max-width: 800px)");return i.addEventListener("change",n),()=>i.removeEventListener("change",n)},[]);const r=12,M=n=>n===1?200:350,ae=n=>{if(n<=0)return{visibleColumns:1,columnWidth:M(1)};const i=r*2;let T=n-i,k=0,L={visibleColumns:1,columnWidth:T};for(let ve=0;ve<5;ve++){const de=T-k;let H={visibleColumns:1,columnWidth:de};for(let Ie=1;Ie<=5;Ie++){const Ae=(Ie-1)*r,_e=(de-Ae)/Ie;_e>=M(Ie)&&Ie*_e+Ae<=de&&(H={visibleColumns:Ie,columnWidth:_e})}H.visibleColumns*H.columnWidth+(H.visibleColumns-1)*r>de&&(H={visibleColumns:1,columnWidth:de});const je=H.columnWidth+r;if(Math.abs(je-k)<.1)return H;k=je,L=H}return L},{visibleColumns:B,columnWidth:G}=ae(h);m.useEffect(()=>{const n=()=>{y(window.innerWidth)};return n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]);const d=m.useCallback(()=>{E(!1)},[]),j=m.useCallback(n=>{let i=!1;if(s.current){const T=s.current,k=T.scrollLeft,L=T.scrollWidth-T.clientWidth;i=Math.abs(k-L)<1,i&&(T._wasAtMaxScrollOnBrowserOpen=!0)}$(n)},[]);m.useEffect(()=>{K!==null&&s.current&&s.current._wasAtMaxScrollOnBrowserOpen&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(s.current){const T=s.current,k=T.scrollWidth-T.clientWidth;T.scrollLeft=k,T._wasAtMaxScrollOnBrowserOpen=!1}})})},[K,G,r]);const w=m.useCallback(()=>{$(null),Re("adversaries")},[]),Q=m.useCallback((n,i=500,T="unknown")=>{if(console.log("[HORIZONTAL_SCROLL] smoothScrollTo called:",{targetScrollLeft:n,duration:i,reason:T,timestamp:performance.now()}),!s.current){console.log("[HORIZONTAL_SCROLL] No container ref, aborting");return}const k=s.current,L=k.scrollLeft,ve=n-L;if(console.log("[HORIZONTAL_SCROLL] Scroll params:",{startScrollLeft:L,targetScrollLeft:n,distance:ve,containerWidth:k.clientWidth,scrollWidth:k.scrollWidth}),Math.abs(ve)<1){console.log("[HORIZONTAL_SCROLL] Distance too small, skipping animation");return}k._horizontalScrollAnimationId&&(console.log("[HORIZONTAL_SCROLL] Canceling existing animation"),cancelAnimationFrame(k._horizontalScrollAnimationId),k._horizontalScrollAnimationId=null);const H=window.getComputedStyle(k).scrollSnapType!=="none",be=H?"x mandatory":null;console.log("[HORIZONTAL_SCROLL] Scroll-snap state:",{hasScrollSnap:H,originalScrollSnapType:be}),H&&(k.style.scrollSnapType="none");const je=performance.now();console.log("[HORIZONTAL_SCROLL] Starting animation at:",je);const Ie=Ae=>{const _e=Ae-je,Ke=Math.min(_e/i,1),De=1-Ke,Ge=1-De*De*De;if(k){const Me=L+ve*Ge;k.scrollLeft=Me}Ke<1?k._horizontalScrollAnimationId=requestAnimationFrame(Ie):(console.log("[HORIZONTAL_SCROLL] Animation complete, final scrollLeft:",k.scrollLeft),k&&(k.scrollLeft=n,k._horizontalScrollAnimationId=null))};return k._horizontalScrollAnimationId=requestAnimationFrame(Ie),()=>{animationId&&cancelAnimationFrame(animationId),H&&k&&(k.style.scrollSnapType=be||"")}},[]),J=m.useCallback(()=>{const n={};return t.forEach(i=>{var k;const T=i.baseName||((k=i.name)==null?void 0:k.replace(/\s+\(\d+\)$/,""))||i.name;n[T]||(n[T]={type:"adversary",baseName:T,instances:[]}),n[T].instances.push(i)}),p.forEach(i=>{n[`countdown-${i.id}`]={type:"countdown",baseName:i.name,instances:[i]}}),Object.values(n)},[t,p]),ge=J(),ue=m.useCallback(n=>{var Ae,_e,Ke;const i=n.baseName||((Ae=n.name)==null?void 0:Ae.replace(/\s+\(\d+\)$/,""))||n.name,k=!ge.find(De=>De.baseName===i&&De.type==="adversary"),L=n.type==="Minion",ve=L?F:1,de=performance.now(),H=((_e=s.current)==null?void 0:_e.scrollWidth)??0,be=((Ke=s.current)==null?void 0:Ke.scrollLeft)??0,je=s.current;let Ie=!1;if(je&&k&&window.getComputedStyle(je).scrollSnapType!=="none"&&(je.style.scrollSnapType="none",Ie=!0,console.log("[ADVERSARY_ADD] Disabled scroll-snap before adding adversary to prevent auto-scroll")),console.log("[ADVERSARY_ADD] handleAddAdversaryFromBrowser called:",{baseName:i,isNewAdversary:k,isMinion:L,instancesToAdd:ve,timestamp:de,currentScroll:be,scrollWidth:H,scrollSnapDisabled:Ie}),L&&ve>1){const De=Array(ve).fill(null).map(()=>({...n}));P(De)}else W(n);if(Z("adversary"),k){const De=`adversary-${i}`;V(Ge=>new Set(Ge).add(De)),setTimeout(()=>{V(Ge=>{const Me=new Set(Ge);return Me.delete(De),Me})},10)}setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!s.current)return;const De=s.current;if(!(De.scrollWidth<=De.clientWidth))if(k){const Ge=De.scrollWidth;setTimeout(()=>{if(!s.current)return;const Me=s.current;if(Me.scrollWidth!==Ge)requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!s.current)return;const Ye=s.current,Xe=Ye.scrollWidth-Ye.clientWidth,Ue=Ye.scrollLeft,Ze=Xe-be,ct=Ye.scrollWidth>H;console.log("[HORIZONTAL_SCROLL] New adversary added, scrollWidth stabilized:",{maxScroll:Xe,scrollWidth:Ye.scrollWidth,clientWidth:Ye.clientWidth,scrollWidthBeforeAdd:H,scrollLeftBeforeAdd:be,currentScroll:Ue,scrollChanged:Ue!==be,scrollWidthIncreased:ct,distance:Ze}),ct&&Math.abs(Ze)<1?Q(Xe+10,500,"new-adversary"):Math.abs(Ze)>1&&Q(Xe,500,"new-adversary")})});else{const Ye=Me.scrollWidth-Me.clientWidth,Xe=Me.scrollLeft,Ue=Ye-be,Ze=Me.scrollWidth>H;console.log("[HORIZONTAL_SCROLL] New adversary added, scrollWidth stable:",{maxScroll:Ye,scrollWidth:Me.scrollWidth,clientWidth:Me.clientWidth,scrollWidthBeforeAdd:H,scrollLeftBeforeAdd:be,currentScroll:Xe,scrollChanged:Xe!==be,scrollWidthIncreased:Ze,distance:Ue}),Ze&&Math.abs(Ue)<1?Q(Ye+10,500,"new-adversary"):Math.abs(Ue)>1&&Q(Ye,500,"new-adversary")}},10)}else{const Me=J().findIndex(Qe=>Qe.baseName===i&&Qe.type==="adversary");if(Me>=0){const Qe=s.current,Ye=Qe.scrollLeft,Xe=Qe.clientWidth,Ue=K!==null?Xe-(G+r):Xe,Ze=Me*(G+r),ct=Ze+G+r,Tt=10;Ze>=Ye-Tt&&ct<=Ye+Ue+Tt||Q(Ze,500)}}})})},50)},[W,ge,G,r,Q,J,K]),he=m.useCallback(()=>{const i="Standard",T=lt(1,i),k={name:"",baseName:"",tier:1,type:i,description:"",motives:"",difficulty:T.difficulty,thresholds:T.thresholds,hpMax:T.hpMax,stressMax:T.stressMax,atk:T.atk,weapon:"",range:T.range,damage:T.damage,experience:[],features:[],source:"Homebrew",hp:0,stress:0,isVisible:!0};W(k),setTimeout(()=>{const L=J();for(const ve of L)if(ve.type==="adversary"){const de=ve.instances.find(H=>H.source==="Homebrew"&&(!H.baseName||H.baseName.trim()===""||H.baseName==="Unknown"));if(de&&!we){ee(de.id),requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(s.current){s.current;const H=L.findIndex(be=>be.instances.some(je=>je.id===de.id));if(H>=0){const be=H*(G+r);Q(be,600,"new-custom-adversary")}}})});break}}},100)},[W,J,G,r,Q,we]),pe=m.useCallback(n=>{ee(n),ce(!1)},[]),A=m.useCallback(()=>{ee(null),ce(!1)},[]),ye=m.useCallback(async(n,i)=>{var T,k;if(i){const L=t.find(de=>de.id===i);if((L==null?void 0:L.source)==="Homebrew"||(L==null?void 0:L.isCustom)){const de=L==null?void 0:L.customContentId,H=L==null?void 0:L.baseName,be=de?(T=g==null?void 0:g.adversaries)==null?void 0:T.find(je=>je.id===de):(k=g==null?void 0:g.adversaries)==null?void 0:k.find(je=>je.baseName===H&&(je.source==="Homebrew"||je.isCustom));if(be){const je={...n,name:n.baseName||n.name};O(be.id,je);const Ie=n.baseName||(L==null?void 0:L.baseName);t.forEach(Ae=>{(Ae.customContentId===de||Ae.baseName===Ie&&(Ae.source==="Homebrew"||Ae.isCustom))&&N(Ae.id,{...n,customContentId:be.id})})}else{const je={...n,name:n.baseName||n.name},Ie=b(je),Ae=n.baseName||(L==null?void 0:L.baseName);t.forEach(_e=>{_e.baseName===Ae&&(_e.source==="Homebrew"||_e.isCustom)&&N(_e.id,{...n,customContentId:Ie})})}}else{const de={...n,name:n.baseName||n.name},H=b(de);N(i,{...n,source:"Homebrew",isCustom:!0,customContentId:H})}ee(null)}else if(we){const L={...n,name:n.baseName||n.name},ve=b(L),de=W({...n,source:"Homebrew",isCustom:!0,customContentId:ve});return ee(null),de}else{const L={...n,name:n.baseName||n.name},ve=b(L),de=W({...n,source:"Homebrew",isCustom:!0,customContentId:ve});return ce(!1),de}},[we,t,g,W,N,b,O]),Le=m.useCallback(()=>{const n={};return t.forEach(i=>{var k;const T=i.baseName||((k=i.name)==null?void 0:k.replace(/\s+\(\d+\)$/,""))||i.name;n[T]||(n[T]={type:"adversary",item:i,quantity:0}),n[T].quantity+=1}),Object.values(n)},[t])(),He=Tr(F),Fe=Le.filter(n=>n.item.type==="Solo"&&n.quantity>0).reduce((n,i)=>n+i.quantity,0),Pe=Le.some(n=>n.item.type&&["Bruiser","Horde","Leader","Solo"].includes(n.item.type)&&n.quantity>0);let Ee=0;Fe>=2&&(Ee+=Dt.twoOrMoreSolos),Pe||(Ee+=Dt.noBruisersHordesLeadersSolos);const Ce=He+Ee,oe=Le.reduce((n,i)=>{if(i.type==="adversary"){const T=zr[i.item.type]||2;return i.item.type==="Minion"?n+Math.ceil(i.quantity/F)*T:n+T*i.quantity}return n},0),Ne=m.useRef(null),$e=m.useCallback(n=>{a(n.target.scrollLeft),Ne.current&&clearTimeout(Ne.current),Ne.current=setTimeout(()=>{const i=n.target;i&&i.style.scrollSnapType==="none"&&(i.style.scrollSnapType="x mandatory")},150)},[]);return m.useCallback(()=>{z(!0)},[]),m.useCallback(()=>{setTimeout(()=>z(!1),100)},[]),ge.length,e.jsxs("div",{className:"app",onClick:n=>{n.target,n.currentTarget},children:[e.jsx(dr,{position:"top",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",width:"100%",justifyContent:"space-between",padding:"0 1rem"},children:[e.jsx(it,{type:"fear",value:(c==null?void 0:c.value)||0,maxValue:12,onChange:x,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0}),e.jsx("button",{onClick:()=>{K!==null?w():j(ge.length)},title:K!==null?"Close Browser":"Add Adversaries",style:{width:"36px",height:"36px",padding:0,backgroundColor:K!==null?"var(--purple)":"transparent",border:"1px solid var(--border)",borderRadius:"50%",color:K!==null?"white":"var(--text-primary)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",flexShrink:0},onMouseEnter:n=>{K===null&&(n.target.style.borderColor="var(--purple)",n.target.style.backgroundColor="var(--bg-secondary)")},onMouseLeave:n=>{K===null&&(n.target.style.borderColor="var(--border)",n.target.style.backgroundColor="transparent")},children:e.jsx(at,{size:18})})]})}),e.jsxs("div",{className:"main-content",style:{position:"relative",width:"100%"},children:[K!==null&&e.jsx("div",{style:{position:"absolute",top:`${r}px`,right:`${r}px`,bottom:`${r}px`,width:`${G}px`,zIndex:100,overflow:"visible"},children:e.jsx(It,{tabContent:e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:he,style:{padding:"0.375rem 0.75rem",backgroundColor:"var(--purple)",border:"none",color:"white",borderRadius:"4px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",transition:"opacity 0.2s ease"},onMouseEnter:n=>{n.target.style.opacity="0.9"},onMouseLeave:n=>{n.target.style.opacity="1"},children:[e.jsx(at,{size:16}),e.jsx("span",{children:"Add Custom"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:"500"},children:"Party Size:"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",border:"1px solid var(--border)",borderRadius:"4px",padding:"0.125rem 0.25rem",backgroundColor:"var(--bg-secondary)"},children:[e.jsx("button",{onClick:()=>Y(Math.max(1,F-1)),style:{background:"transparent",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:"0",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem"},onMouseEnter:n=>{n.target.style.color="var(--purple)"},onMouseLeave:n=>{n.target.style.color="var(--text-primary)"},children:e.jsx(ft,{size:12})}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:"500",minWidth:"1.5rem",textAlign:"center"},children:F}),e.jsx("button",{onClick:()=>Y(F+1),style:{background:"transparent",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:"0",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem"},onMouseEnter:n=>{n.target.style.color="var(--purple)"},onMouseLeave:n=>{n.target.style.color="var(--text-primary)"},children:e.jsx(at,{size:12})})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:"500"},children:"Balance:"}),e.jsx("span",{style:{color:oe>Ce?"var(--danger)":oe===Ce?"var(--purple)":"var(--success)",fontWeight:600,fontSize:"0.875rem"},children:oe>Ce?`+${oe-Ce}`:Ce-oe===0?"0":`-${Ce-oe}`})]}),w&&e.jsx("button",{onClick:w,style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease",flexShrink:0},onMouseEnter:n=>n.target.style.color="var(--text-primary)",onMouseLeave:n=>n.target.style.color="var(--text-secondary)",title:"Close browser",children:e.jsx(ot,{size:16})})]}),showTab:!0,tabBackgroundColor:"var(--bg-primary)",tabBorderColor:"var(--border)",tabJustifyContent:"space-between",containerBackgroundColor:"var(--bg-primary)",containerBorderColor:"var(--border)",containerBorderRadius:"8px",containerBoxShadow:"-4px 0 12px rgba(0, 0, 0, 0.3)",containerOverflow:"hidden",reserveTabSpace:!0,containerStyle:{height:"100%"},children:e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,display:"flex",flexDirection:"column",width:"100%",minWidth:0},children:e.jsx(Vt,{type:"adversary",onAddItem:ue,showContainer:!1,activeTab:xe,onTabChange:Re,pcCount:F,savedEncounters:S,onLoadEncounter:Oe,onDeleteEncounter:ne,selectedCustomAdversaryId:Ve,onSelectCustomAdversary:l,autoFocus:!0,hideImportExport:!0,onClose:w,searchPlaceholder:"Search adversaries"})})})}),e.jsxs("div",{ref:s,className:"dashboard-scroll-container",style:{display:"flex",flexDirection:"row",overflowX:"auto",overflowY:"hidden",padding:`0 ${r}px 0 0`,scrollSnapType:"x mandatory",height:"100%",width:"100%"},onScroll:$e,children:[ge.length===0?null:(()=>{const n=[];if(ge.forEach((i,T)=>{var L,ve,de;if(me&&me.baseName===i.baseName&&i.type==="adversary"){n.push(e.jsx(wt,{style:{width:Be?"0px":`${G+r}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:Be?"0px":`${r}px`,paddingRight:"0",paddingTop:Be?"0px":`${r}px`,paddingBottom:Be?"0px":`${r}px`,scrollSnapAlign:"none",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"100%",opacity:0,transition:"width 0.3s ease, padding-left 0.3s ease, padding-top 0.3s ease, padding-bottom 0.3s ease"}},`spacer-${me.baseName}`));return}n.push(e.jsx(wt,{style:{width:`${G+r}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:`${r}px`,paddingRight:"0",paddingTop:`${i.type==="adversary"?r+52:r}px`,paddingBottom:`${r}px`,scrollSnapAlign:"start",overflow:i.type==="adversary"?"visible":"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"auto",opacity:D.has(`${i.type}-${i.baseName}`)?0:1,transition:(D.has(`${i.type}-${i.baseName}`),"opacity 0.2s ease")},children:e.jsx(ht,{type:i.type,item:{...i.instances[0],name:((L=i.instances[0])==null?void 0:L.name)||i.baseName,hp:0,stress:0,isDead:!1},mode:"expanded",instances:i.instances,showCustomCreator:i.type==="adversary"&&we&&i.instances.some(H=>H.id===we),onSaveCustomAdversary:i.type==="adversary"&&we&&i.instances.some(H=>H.id===we)?ye:void 0,onCancelEdit:i.type==="adversary"&&we&&i.instances.some(H=>H.id===we)?A:void 0,isStockAdversary:i.type==="adversary"&&we&&i.instances.some(H=>H.id===we)?!((ve=i.instances[0])!=null&&ve.source)||((de=i.instances[0])==null?void 0:de.source)!=="Homebrew":!1,onApplyDamage:i.type==="adversary"?(H,be,je,Ie)=>{const Ae=i.instances.find(_e=>_e.id===H);Ae&&N(H,{hp:Math.min(Ae.hpMax||1,(Ae.hp||0)+be)})}:void 0,onApplyHealing:i.type==="adversary"?(H,be,je)=>{const Ie=i.instances.find(Ae=>Ae.id===H);Ie&&N(H,{hp:Math.max(0,(Ie.hp||0)-be)})}:void 0,onApplyStressChange:i.type==="adversary"?(H,be)=>{var je,Ie;return N(H,{stress:Math.max(0,Math.min(((je=i.instances.find(Ae=>Ae.id===H))==null?void 0:je.stressMax)||6,(((Ie=i.instances.find(Ae=>Ae.id===H))==null?void 0:Ie.stress)||0)+be))})}:void 0,onUpdate:i.type==="adversary"?N:i.type==="environment"?q:te,adversaries:t,showAddRemoveButtons:K!==null&&i.type==="adversary",onEdit:i.type==="adversary"?H=>pe(H):void 0,onAddInstance:i.type==="adversary"?H=>{const be=H.type==="Minion",je=be?F:1;if(be&&je>1){const Ie=Array(je).fill(null).map(()=>({...H}));P(Ie)}else W(H);setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(s.current){const Ie=s.current,Ae=Ie.scrollLeft,_e=Ie.clientWidth,Ke=K!==null?_e-(G+r):_e,Ge=J().findIndex(Me=>Me.baseName===i.baseName&&Me.type==="adversary");if(Ge>=0){const Me=Ge*(G+r),Qe=Me+G+r,Ye=10;Me>=Ae-Ye&&Qe<=Ae+Ke+Ye||Q(Me,500)}}})})},50)}:void 0,onRemoveInstance:i.type==="adversary"?H=>{const be=i.instances[0],Ie=(be==null?void 0:be.type)==="Minion"?F:1,Ae=i.instances.sort((De,Ge)=>{const Me=De.duplicateNumber||1;return(Ge.duplicateNumber||1)-Me}),Ke=Math.max(0,Ae.length-Ie)===0;if(Ae.length>0){const De=Ae.slice(0,Ie);if(Ke){const Ge=ge.findIndex(Me=>Me.baseName===i.baseName&&Me.type==="adversary");We({baseName:i.baseName,groupIndex:Ge}),Je(!1),requestAnimationFrame(()=>{requestAnimationFrame(()=>{De.forEach(Me=>{_(Me.id)}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{Je(!0),setTimeout(()=>{We(null),Je(!1)},300)})})})})}else De.forEach(Ge=>{_(Ge.id)})}}:void 0})},`${i.type}-${i.baseName}`))}),me&&!n.some(i=>(i==null?void 0:i.key)===`spacer-${me.baseName}`)){const i=Math.min(me.groupIndex,n.length);n.splice(i,0,e.jsx(wt,{style:{width:Be?"0px":`${G+r}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:Be?"0px":`${r}px`,paddingRight:"0",paddingTop:Be?"0px":`${r}px`,paddingBottom:Be?"0px":`${r}px`,scrollSnapAlign:"none",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"100%",opacity:0,transition:"width 0.3s ease, padding-left 0.3s ease, padding-top 0.3s ease, padding-bottom 0.3s ease"}},`spacer-${me.baseName}`))}return n})(),K!==null&&e.jsx("div",{style:{width:`${G+r}px`,flexShrink:0,flexGrow:0,flex:"none",height:"100%"}})]})]}),e.jsx(Mr,{isOpen:le,onClose:d,onAddAdversary:n=>{W(n),Z("adversary")},onAddAdversariesBulk:n=>{P(n),Z("adversary")},onAddEnvironment:n=>{se(n),Z("environment")},onDeleteAdversary:_,onDeleteEnvironment:X,onDeleteCountdown:re,adversaries:t,environments:o,countdowns:p,savedEncounters:S,onSaveEncounter:ze,onLoadEncounter:Oe,onDeleteEncounter:ne}),e.jsx(Ir,{})]})},Nr=()=>e.jsx(Rr,{children:e.jsx(Wr,{})});kt.createRoot(document.getElementById("root")).render(e.jsx(rt.StrictMode,{children:e.jsx(lr,{children:e.jsx(Nr,{})})}));
