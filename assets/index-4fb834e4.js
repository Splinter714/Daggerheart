import{r as h,a as pt,R as Ge}from"./dndkit-57209f9c.js";import{F as Nt,f as Bt,a as Dt,b as Pt,c as yt}from"./fa-b4bcccb0.js";import{D as At,A as Ht,C as Ot,X as Xe,M as ut,P as Ke,a as Ft,H as $t,L as _t,b as qt,F as Vt,S as Ue,c as et}from"./lucide-9f8be461.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))d(w);new MutationObserver(w=>{for(const p of w)if(p.type==="childList")for(const v of p.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&d(v)}).observe(document,{childList:!0,subtree:!0});function c(w){const p={};return w.integrity&&(p.integrity=w.integrity),w.referrerPolicy&&(p.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?p.credentials="include":w.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function d(w){if(w.ep)return;w.ep=!0;const p=c(w);fetch(w.href,p)}})();var Et={exports:{}},ot={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gt=h,Yt=Symbol.for("react.element"),Jt=Symbol.for("react.fragment"),Xt=Object.prototype.hasOwnProperty,Kt=Gt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Zt={key:!0,ref:!0,__self:!0,__source:!0};function Mt(t,o,c){var d,w={},p=null,v=null;c!==void 0&&(p=""+c),o.key!==void 0&&(p=""+o.key),o.ref!==void 0&&(v=o.ref);for(d in o)Xt.call(o,d)&&!Zt.hasOwnProperty(d)&&(w[d]=o[d]);if(t&&t.defaultProps)for(d in o=t.defaultProps,o)w[d]===void 0&&(w[d]=o[d]);return{$$typeof:Yt,type:t,key:p,ref:v,props:w,_owner:Kt.current}}ot.Fragment=Jt;ot.jsx=Mt;ot.jsxs=Mt;Et.exports=ot;var e=Et.exports,mt={},vt=pt;mt.createRoot=vt.createRoot,mt.hydrateRoot=vt.hydrateRoot;function qe(t){const o=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return t?`${t}-${o}`:o}const zt=h.createContext();function at(t){if(typeof localStorage>"u")return null;try{const o=localStorage.getItem(t);return o==null?null:JSON.parse(o)}catch{return null}}function Ve(t,o){if(!(typeof localStorage>"u"))try{localStorage.setItem(t,JSON.stringify(o))}catch{}}const Qt=({children:t})=>{const[o,c]=h.useState({fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],currentEncounterName:"Encounter"}),[d,w]=h.useState(!1),[p,v]=h.useState({adversaries:[],environments:[]});h.useEffect(()=>{var a,x,R,N;const l=at("daggerheart-game-state");if(l)try{(((a=l.adversaries)==null?void 0:a.length)>0||((x=l.environments)==null?void 0:x.length)>0||((R=l.countdowns)==null?void 0:R.length)>0||((N=l.savedEncounters)==null?void 0:N.length)>0)&&c(l)}catch(ae){console.error("Failed to load saved state:",ae)}const n=at("daggerheart-custom-adversaries")||[],r=at("daggerheart-custom-environments")||[];v({adversaries:n,environments:r}),w(!0)},[]),h.useEffect(()=>{Ve("daggerheart-game-state",o)},[o]);const L=l=>{c(n=>({...n,fear:{...n.fear,value:l}}))},g=()=>{c(l=>({...l,fear:{...l.fear,visible:!l.fear.visible}}))},E=l=>{c(n=>({...n,partySize:Math.max(1,l)}))},H=l=>{c(n=>({...n,currentEncounterName:l||"Encounter"}))},D=l=>{if(l.id)return c(n=>({...n,savedEncounters:(n.savedEncounters||[]).map(r=>r.id===l.id?{...r,name:l.name||r.name,encounterItems:l.encounterItems||r.encounterItems,partySize:l.partySize||r.partySize,battlePointsAdjustments:l.battlePointsAdjustments||r.battlePointsAdjustments,updatedAt:new Date().toISOString()}:r)})),l.id;{const n={id:qe("encounter"),name:l.name||"Encounter",createdAt:new Date().toISOString(),encounterItems:l.encounterItems||[],partySize:l.partySize||4,battlePointsAdjustments:l.battlePointsAdjustments||{}};return c(r=>({...r,savedEncounters:[...r.savedEncounters||[],n]})),n.id}},T=l=>(o.savedEncounters||[]).find(r=>r.id===l),b=l=>{const n={id:qe("encounter"),name:l.name||`Encounter ${Date.now()}`,createdAt:new Date().toISOString(),encounterItems:l.encounterItems||[],partySize:l.partySize||4,battlePointsAdjustments:l.battlePointsAdjustments||{}};return c(r=>({...r,savedEncounters:[...r.savedEncounters||[],n]})),n.id},V=l=>{c(n=>({...n,savedEncounters:(n.savedEncounters||[]).filter(r=>r.id!==l)}))},ue=h.useRef(o);h.useEffect(()=>{ue.current=o},[o]);const Ce={gameState:o,isLoaded:d,customContent:p,updateFear:L,toggleFearVisibility:g,updatePartySize:E,updateCurrentEncounterName:H,saveEncounter:D,saveEncounterAs:b,loadEncounter:T,deleteEncounter:V,createCountdown:l=>{const n={id:qe("countdown"),name:l.name||"Countdown",max:parseInt(l.max)||1,value:0,visible:!0,type:l.type||"standard",loop:l.loop||"none",source:l.source||"campaign"};c(r=>({...r,countdowns:[...r.countdowns,n]}))},updateCountdown:(l,n)=>{c(r=>({...r,countdowns:r.countdowns.map(a=>a.id===l?{...a,...n}:a)}))},deleteCountdown:l=>{c(n=>({...n,countdowns:n.countdowns.filter(r=>r.id!==l)}))},advanceCountdown:(l,n)=>{c(r=>({...r,countdowns:r.countdowns.map(a=>{if(a.id!==l)return a;let x=n;if(a.loop==="loop")x>a.max?x=(x-1)%a.max+1:x<0&&(x=a.max);else if(a.loop==="increasing"){if(x>a.max)return{...a,max:a.max+1,value:1};if(x<0)return{...a,max:Math.max(1,a.max-1),value:1};x=Math.max(0,x)}else if(a.loop==="decreasing"){if(x>a.max)return{...a,max:Math.max(1,a.max-1),value:1};if(x<0)return{...a,max:a.max+1,value:1};x=Math.min(a.max,x)}else x=Math.max(0,Math.min(x,a.max));return{...a,value:x}})}))},incrementCountdown:(l,n=1)=>{c(r=>({...r,countdowns:r.countdowns.map(a=>{if(a.id!==l)return a;let x=a.value+n;if(a.loop==="loop")x>a.max&&(x=(x-1)%a.max+1);else if(a.loop==="increasing"){if(x>a.max)return{...a,max:a.max+1,value:1}}else if(a.loop==="decreasing"){if(x>a.max)return{...a,max:Math.max(1,a.max-1),value:1}}else x=Math.min(x,a.max);return{...a,value:x}})}))},decrementCountdown:l=>{c(n=>({...n,countdowns:n.countdowns.map(r=>{if(r.id!==l)return r;let a=r.value-1;if(r.loop==="loop")a<0&&(a=r.max);else if(r.loop==="increasing"){if(a<0)return{...r,max:Math.max(1,r.max-1),value:r.max};a=Math.max(0,a)}else if(r.loop==="decreasing"){if(a<0)return{...r,max:r.max+1,value:1}}else a=Math.max(0,a);return{...r,value:a}})}))},reorderCountdowns:l=>{c(n=>{const[r,a]=l,x=[...n.countdowns],[R]=x.splice(r,1);return x.splice(a,0,R),{...n,countdowns:x}})},createAdversary:l=>{var ae;const n=qe("adv"),r=o.adversaries||[],a=l.baseName||((ae=l.name)==null?void 0:ae.replace(/\s+\(\d+\)$/,""))||l.name||"Unknown",x=r.filter(be=>be.baseName===a);let R=1;if(x.length===0)R=1;else{const be=x.map(s=>s.duplicateNumber||1);let Me=1;for(;be.includes(Me);)Me++;R=Me}const N={...l,id:n,baseName:a,duplicateNumber:R,name:`${a} (${R})`,hp:0,stress:0,isVisible:!0};c(be=>({...be,adversaries:[...be.adversaries,N]}))},createAdversariesBulk:l=>{const n=[],r={};l.forEach(a=>{var j;const x=a.baseName||((j=a.name)==null?void 0:j.replace(/\s+\(\d+\)$/,""))||a.name||"Unknown",ae=(o.adversaries||[]).filter(i=>i.baseName===x).length,be=r[x]||0,Me=ae+be+1;r[x]=be+1;const s={...a,id:qe("adv"),baseName:x,duplicateNumber:Me,name:`${x} (${Me})`,hp:0,stress:0,isVisible:!0};n.push(s)}),c(a=>({...a,adversaries:[...a.adversaries,...n]}))},updateAdversary:(l,n)=>{c(r=>({...r,adversaries:r.adversaries.map(a=>{if(a.id===l){const x={...a,...n};if(n.baseName!==void 0){const R=n.baseName,N=x.duplicateNumber||1;x.name=N===1?R:`${R} (${N})`}return x}return a})}))},deleteAdversary:l=>{c(n=>({...n,adversaries:n.adversaries.filter(r=>r.id!==l)}))},clearAllAdversaries:()=>{c(l=>({...l,adversaries:[]}))},reorderAdversaries:l=>{c(n=>{const[r,a]=l,x=[...n.adversaries],[R]=x.splice(r,1);return x.splice(a,0,R),{...n,adversaries:x}})},bulkReorderAdversaries:l=>{c(n=>({...n,adversaries:l}))},createEnvironment:l=>{const n=qe("env"),a=(o.environments||[]).filter(N=>N.name.replace(/\s+\(\d+\)$/,"")===l.name);let x=l.name||"Unknown";if(a.length===0)x=l.name;else if(a.length===1){const N=a[0],ae=N.name.replace(/\s+\(\d+\)$/,""),be=o.environments.map(Me=>Me.id===N.id?{...Me,name:`${ae} (1)`}:Me);c(Me=>({...Me,environments:be})),x=`${l.name} (2)`}else{const N=a.map(be=>{const Me=be.name.match(/\((\d+)\)$/);return Me?parseInt(Me[1]):null}).filter(be=>be!==null);let ae=1;for(;N.includes(ae);)ae++;x=`${l.name} (${ae})`}const R={...l,id:n,name:x,isVisible:!0};c(N=>({...N,environments:[...N.environments,R]}))},updateEnvironment:(l,n)=>{c(r=>({...r,environments:r.environments.map(a=>a.id===l?{...a,...n}:a)}))},deleteEnvironment:l=>{c(n=>({...n,environments:n.environments.filter(r=>r.id!==l)}))},reorderEnvironments:l=>{c(n=>{const[r,a]=l,x=[...n.environments],[R]=x.splice(r,1);return x.splice(a,0,R),{...n,environments:x}})},addCustomAdversary:l=>{const n={...l,id:qe("custom-adv"),source:l.source||"Homebrew",isCustom:!0};return v(r=>({...r,adversaries:[...r.adversaries,n]})),Ve("daggerheart-custom-adversaries",[...p.adversaries,n]),n.id},addCustomEnvironment:l=>{const n={...l,id:qe("custom-env"),source:l.source||"Homebrew",isCustom:!0};return v(r=>({...r,environments:[...r.environments,n]})),Ve("daggerheart-custom-environments",[...p.environments,n]),n.id},updateCustomAdversary:(l,n)=>{v(a=>({...a,adversaries:a.adversaries.map(x=>x.id===l?{...x,...n}:x)}));const r=p.adversaries.map(a=>a.id===l?{...a,...n}:a);Ve("daggerheart-custom-adversaries",r)},updateCustomEnvironment:(l,n)=>{v(a=>({...a,environments:a.environments.map(x=>x.id===l?{...x,...n}:x)}));const r=p.environments.map(a=>a.id===l?{...a,...n}:a);Ve("daggerheart-custom-environments",r)},deleteCustomAdversary:l=>{v(r=>({...r,adversaries:r.adversaries.filter(a=>a.id!==l)}));const n=p.adversaries.filter(r=>r.id!==l);Ve("daggerheart-custom-adversaries",n)},deleteCustomEnvironment:l=>{v(r=>({...r,environments:r.environments.filter(a=>a.id!==l)}));const n=p.environments.filter(r=>r.id!==l);Ve("daggerheart-custom-environments",n)}};return e.jsx(zt.Provider,{value:Ce,children:t})},xt=()=>{const t=h.useContext(zt);if(!t)return console.warn("useGameState: Context not available yet, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{gameState:o,customContent:c,...d}=t;if(!o)return console.warn("useGameState: gameState not available, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],customContent:{adversaries:[],environments:[]},updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},addCustomAdversary:()=>{},addCustomEnvironment:()=>{},updateCustomAdversary:()=>{},updateCustomEnvironment:()=>{},deleteCustomAdversary:()=>{},deleteCustomEnvironment:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{fear:w,countdowns:p,adversaries:v,environments:L,partySize:g,savedEncounters:E}=o;return{gameState:o,fear:w,countdowns:p,adversaries:v,environments:L,partySize:g,savedEncounters:E,customContent:c,...d,hasCountdowns:p.length>0,hasAdversaries:v.length>0,hasEnvironments:L.length>0,getCountdownById:H=>p.find(D=>D.id===H),getAdversaryById:H=>v.find(D=>D.id===H),getEnvironmentById:H=>L.find(D=>D.id===H)}},bt={fear:{icon:Bt,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"0.125rem",maxWidth:"none"},pipStyle:{fontSize:"var(--text-lg)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0,imageRendering:"crisp-edges"},filledColor:"var(--purple)",emptyColor:"var(--gray-dark)",tooltipTitle:"Click anywhere in header to adjust fear:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease fear by 1"},{text:"Right of boundary:",description:"Click to increase fear by 1"}]},hp:{icon:Dt,maxValue:20,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stress:{icon:Pt,maxValue:12,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},countdown:{icon:yt,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust countdown:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease countdown by 1"},{text:"Right of boundary:",description:"Click to increase countdown by 1"}]},hpDots:{maxValue:20,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--red)",borderColor:"var(--red)",boxShadow:"0 0 4px rgba(239, 68, 68, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stressDots:{maxValue:12,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--purple)",borderColor:"var(--purple)",boxShadow:"0 0 4px rgba(139, 92, 246, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},adversaryHP:{icon:At,maxValue:20,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust HP:",tooltipInstructions:[{text:"Filled pip:",description:"Click to heal (reduce damage)"},{text:"Empty pip:",description:"Click to take damage"}]},adversaryStress:{icon:Ht,maxValue:12,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust stress:",tooltipInstructions:[{text:"Filled pip:",description:"Click to reduce stress"},{text:"Empty pip:",description:"Click to increase stress"}]},countdownDistributed:{icon:yt,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Countdown progress:",tooltipInstructions:[{text:"Progress:",description:"Current countdown value"}]}},Je=({type:t="fear",value:o=0,maxValue:c,onChange:d,size:w="lg",showTooltip:p=!0,containerStyle:v={},pipStyle:L={},countdownType:g=null,distributedGroups:E=null,onPipClick:H=null,enableBoundaryClick:D=!1,clickContainerWidth:T="auto",centerPips:b=!0})=>{const[V,ue]=h.useState(!1),P=bt[t]||bt.fear,_=c||P.maxValue,F=Math.max(0,Math.min(_,o));let we=P.filledColor;t==="countdown"&&g&&(["progress","dynamic-progress","simple-hope"].includes(g)?we="var(--gold)":["consequence","dynamic-consequence","simple-fear"].includes(g)?we="var(--purple)":["long-term","standard"].includes(g)&&(we="var(--text-secondary)"));const q=(te,he)=>{if(H)H(te,he);else if(d){const xe=te+1;d(xe)}},Ie=te=>{if(!D||!d||H)return;te.currentTarget.getBoundingClientRect();const he=te.currentTarget.querySelector(".pip-container");if(!he)return;const xe=he.getBoundingClientRect(),m=te.clientX-xe.left;if(m<0){F>0&&d(F-1);return}if(m>xe.width){F<_&&d(F+1);return}const X=xe.width,S=X*.05,de=X-2*S,Q=m-S,me=F/_,K=de*me;Q<K?F>0&&d(F-1):F<_&&d(F+1)},Le=(()=>{if(!E||t!=="countdownDistributed")return[{start:0,end:_,groupIndex:0}];let te=0;return E.map((he,xe)=>{const m={start:te,end:te+he,groupIndex:xe};return te+=he,m})})(),ee=()=>e.jsxs(e.Fragment,{children:[Le.map(te=>e.jsx(Ge.Fragment,{children:[...Array(te.end-te.start)].map((he,xe)=>{const m=te.start+xe,X=m<F;if(P.isDots)return e.jsx("div",{style:{...P.pipStyle,...X?P.filledStyle:P.emptyStyle,...L,cursor:d||H?"pointer":"default"},onClick:D?void 0:()=>q(m,X),title:`${m+1} of ${_}`},m);{const S=P.icon,de=S&&typeof S=="object"&&S.iconName,Q=X?we:P.emptyColor;return e.jsx("span",{className:`fear-pip ${X?"filled":"empty"}`,style:{...P.pipStyle,color:Q,cursor:d||H?"pointer":"default",...L},onClick:D?void 0:()=>q(m,X),title:`${m+1} of ${_}`,children:de?e.jsx(Nt,{icon:S,size:w}):e.jsx(S,{size:w==="lg"?18:16})},m)}})},te.groupIndex)),p&&e.jsx("div",{style:{position:"relative",cursor:"help",pointerEvents:"none"},children:e.jsxs("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:V?"translateX(-50%) translateY(-5px)":"translateX(-50%)",background:"rgba(15, 23, 42, 0.95)",border:"1px solid var(--gray)",borderRadius:"var(--radius-md)",padding:"var(--space-md)",minWidth:"250px",zIndex:1e3,opacity:V?1:0,visibility:V?"visible":"hidden",transition:"all 0.2s ease",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.5)"},children:[e.jsx("div",{style:{fontWeight:600,color:"var(--gray-200)",marginBottom:"0.75rem",fontSize:"var(--text-sm)"},children:P.tooltipTitle}),P.tooltipInstructions.map((te,he)=>e.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.8rem",color:"var(--gray-300)",lineHeight:1.4},children:[e.jsx("strong",{style:{color:"var(--gray-200)"},children:te.text})," ",te.description]},he))]})})]});return e.jsx("div",{style:{width:T,height:"100%",cursor:d||H?"pointer":"default",touchAction:"manipulation",userSelect:"none",display:b?"flex":"block",alignItems:b?"center":"stretch",justifyContent:b?"center":"flex-start",...v},onClick:te=>{te.stopPropagation(),te.preventDefault(),D&&Ie(te)},onMouseEnter:()=>ue(p),onMouseLeave:()=>ue(!1),children:e.jsx("div",{className:"pip-container",style:{...P.containerStyle,width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},children:ee()})})},Ut=({position:t="top",children:o,onClick:c,className:d="",style:w={}})=>{const p=t==="top",v=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://"),L={background:"var(--bg-primary)",borderTop:p?"none":"1px solid var(--border)",borderBottom:p?"1px solid var(--border)":"none",padding:p?"0.25rem 0":"0.5rem",paddingBottom:p?"0.25rem":v?"calc(0.5rem + env(safe-area-inset-bottom) + 1rem)":"calc(0.5rem + env(safe-area-inset-bottom))",position:p?"relative":"sticky",[p?"top":"bottom"]:0,zIndex:p?10:100,order:p?1:3,flexShrink:0,touchAction:"manipulation",userSelect:"none",display:"flex",flexDirection:p?"column":"row",justifyContent:p?"stretch":"center",alignItems:p?"stretch":"center",gap:p?"0":"1rem",height:p?"auto":"60px",...w};return e.jsx("div",{className:d,style:L,onClick:c,children:o})},it=52,Tt=({tabContent:t,children:o,containerStyle:c={},tabStyle:d={},showTab:w=!0,tabBackgroundColor:p="var(--bg-primary)",tabBorderColor:v="var(--border)",tabJustifyContent:L="center",containerBackgroundColor:g,containerBorderColor:E,containerBorderRadius:H="8px",containerBoxShadow:D,containerOverflow:T="hidden",reserveTabSpace:b=!1,style:V={},...ue})=>{const P={display:"flex",flexDirection:"column",position:"relative",height:"100%",width:"100%",borderRadius:H,overflow:T};g&&(P.backgroundColor=g),E&&(P.border=`2px solid ${E}`),D&&(P.boxShadow=D);const _={position:"relative",overflow:"visible",height:"100%",width:"100%",display:"flex",flexDirection:"column",boxSizing:"border-box"},F=b?"0":`-${it}px`,we=b&&w&&t?`${it}px`:"0";return e.jsxs("div",{style:{..._,...V},...ue,children:[w&&t&&e.jsx("div",{style:{position:"absolute",top:F,left:"7px",right:"7px",width:"calc(100% - 14px)",display:"flex",alignItems:"center",gap:"0.5rem",justifyContent:L,flexShrink:0,zIndex:0,padding:"0.5rem 0.75rem",paddingBottom:"calc(0.5rem + 4px)",minHeight:`${it}px`,backgroundColor:p,border:`1.5px solid ${v}`,borderBottom:"none",borderRadius:"8px 8px 0 0",boxSizing:"border-box",marginBottom:"-4px",...d},children:t}),e.jsx("div",{style:{...P,...c,zIndex:1,marginTop:we},children:o})]})},wt=({value:t})=>e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"44px",height:"32px",zIndex:3},children:[e.jsx("svg",{width:"40",height:"32",viewBox:"0 0 40 32",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",style:{position:"absolute",zIndex:1},children:e.jsx("path",{d:"M2 2h28l6 14-6 14H2l6-14-6-14z"})}),e.jsx("span",{style:{position:"absolute",fontSize:"0.8rem",fontWeight:500,color:"var(--text-primary)",textAlign:"center",zIndex:2,left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:t})]}),er=({type:t,tier:o,isEditMode:c,onUpdate:d,itemId:w})=>{const v=(D=>{if(!D)return 0;const b=document.createElement("canvas").getContext("2d");return b.font="600 11px system-ui, -apple-system, sans-serif",b.measureText(D.toUpperCase()).width})(t),L=4,g=18,E=Math.max(50,v+L+g),H=E+15;return c?e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",gap:"8px",height:"32px"},children:[e.jsxs("select",{value:t||"",onChange:D=>{d&&d(w,{type:D.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",outline:"none",borderRadius:"4px",padding:"4px 8px",width:"95px",height:"24px"},children:[e.jsx("option",{value:"Standard",children:"Standard"}),e.jsx("option",{value:"Solo",children:"Solo"}),e.jsx("option",{value:"Bruiser",children:"Bruiser"}),e.jsx("option",{value:"Horde",children:"Horde"}),e.jsx("option",{value:"Minion",children:"Minion"}),e.jsx("option",{value:"Ranged",children:"Ranged"}),e.jsx("option",{value:"Leader",children:"Leader"}),e.jsx("option",{value:"Skulk",children:"Skulk"}),e.jsx("option",{value:"Social",children:"Social"}),e.jsx("option",{value:"Support",children:"Support"})]}),e.jsxs("div",{style:{position:"relative",width:"24px",height:"24px"},children:[e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",width:"20px",height:"20px",backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",borderRadius:"2px"}}),e.jsx("input",{type:"text",value:o||"",onChange:D=>{const T=D.target.value.replace(/[^1-4]/g,"");T.length<=1&&d&&d(w,{tier:T===""?"":parseInt(T)})},onKeyDown:D=>{if(D.key==="ArrowUp"){D.preventDefault();const T=parseInt(o)||1;d&&d(w,{tier:Math.min(T+1,4)})}else if(D.key==="ArrowDown"){D.preventDefault();const T=parseInt(o)||1;d&&d(w,{tier:Math.max(T-1,1)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"transparent",border:"none",color:"var(--text-primary)",fontSize:"0.8rem",fontWeight:600,width:"24px",height:"24px",textAlign:"center",outline:"none",zIndex:1},maxLength:"1"})]})]}):e.jsxs("div",{style:{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"center",height:"32px",width:`${H}px`},children:[e.jsxs("svg",{width:H,height:"32",viewBox:`0 0 ${H} 32`,style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1},children:[e.jsx("rect",{x:"1",y:"6",width:E-1,height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4",ry:"4"}),e.jsx("rect",{x:E-10,y:"6",width:"20",height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"2",ry:"2",transform:`rotate(45 ${E-1} 16)`})]}),e.jsx("span",{style:{position:"absolute",top:"50%",left:"4px",transform:"translateY(-50%)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",color:"var(--text-primary)",zIndex:2,pointerEvents:"none"},children:t}),e.jsx("span",{style:{position:"absolute",top:"50%",left:`${E-.5}px`,transform:"translate(-50%, -50%)",fontSize:"0.8rem",fontWeight:600,color:"white",zIndex:2,pointerEvents:"none",textAlign:"center",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",width:"20px",height:"20px"},children:o})]})},lt=({feature:t,featureType:o,item:c,onUpdate:d,handleFeatureDeleteClick:w,deleteConfirmations:p,getFeatureKey:v})=>{var D,T;const L=()=>{try{const V=[...(c==null?void 0:c.features)||[]],ue=V.filter(_=>_.type===o),P=ue.findIndex(_=>_===t);if(P>0&&P<ue.length){const _=ue[P],F=ue[P-1];if(_&&F){const we=V.findIndex(Ie=>Ie===_),q=V.findIndex(Ie=>Ie===F);we>=0&&q>=0&&(V[we]=F,V[q]=_,d&&d(c.id,{features:V}))}}}catch(b){console.error(`Error in ${o.toLowerCase()} up button:`,b)}},g=()=>{try{const V=[...(c==null?void 0:c.features)||[]],ue=V.filter(_=>_.type===o),P=ue.findIndex(_=>_===t);if(P<ue.length-1&&P>=0){const _=ue[P],F=ue[P+1];if(_&&F){const we=V.findIndex(Ie=>Ie===_),q=V.findIndex(Ie=>Ie===F);we>=0&&q>=0&&(V[we]=F,V[q]=_,d&&d(c.id,{features:V}))}}}catch(b){console.error(`Error in ${o.toLowerCase()} down button:`,b)}},E=b=>b.type===o,H=b=>b.type===o&&b.name.trim();return e.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",alignSelf:"stretch"},children:[e.jsx("button",{onClick:L,disabled:(c.features||[]).filter(E).findIndex(b=>b===t)===0,tabIndex:"-1",style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(c.features||[]).filter(H).length>=2&&(c.features||[]).filter(E).findIndex(b=>b===t)!==0&&t.name.trim()?"white":"var(--text-secondary)",cursor:(c.features||[]).filter(H).length>=2&&(c.features||[]).filter(E).findIndex(b=>b===t)!==0&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↑"}),e.jsx("button",{onClick:()=>w(t),disabled:!t.name.trim()&&!t.description.trim(),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:p[v(t)]?"var(--danger)":"var(--gray-700)",color:!t.name.trim()&&!t.description.trim()?"var(--text-secondary)":"white",cursor:!t.name.trim()&&!t.description.trim()?"not-allowed":"pointer",opacity:!t.name.trim()&&!t.description.trim()?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"×"}),e.jsx("button",{onClick:g,disabled:(c.features||[]).filter(E).findIndex(b=>b===t)===(c.features||[]).filter(E).length-1,style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(c.features||[]).filter(H).length>=2&&(c.features||[]).filter(E).findIndex(b=>b===t)<(c.features||[]).filter(E).length-1&&((D=(c.features||[]).filter(E)[(c.features||[]).filter(E).findIndex(b=>b===t)+1])!=null&&D.name.trim())&&t.name.trim()?"white":"var(--text-secondary)",cursor:(c.features||[]).filter(H).length>=2&&(c.features||[]).filter(E).findIndex(b=>b===t)<(c.features||[]).filter(E).length-1&&((T=(c.features||[]).filter(E)[(c.features||[]).filter(E).findIndex(b=>b===t)+1])!=null&&T.name.trim())&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↓"})]})},He={transitions:{hoverIn:"all 0.1s ease",hoverOut:"all 0.3s ease"},card:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"8px",cursor:"pointer",transition:"all 0.1s ease",position:"relative",border:"none"},cardHover:{backgroundColor:"var(--bg-card-hover)"},cardDead:{opacity:.6,backgroundColor:"var(--gray-800)",borderColor:"var(--border)"},cardAtMax:{backgroundColor:"var(--success)",borderColor:"var(--success)"},rowMain:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},rowTitle:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",margin:0},rowMeta:{display:"flex",gap:"8px",alignItems:"center"},badge:{padding:"2px 6px",borderRadius:"3px",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},typeBadge:{backgroundColor:"var(--purple)",color:"var(--text-primary)"},tierBadge:{backgroundColor:"var(--info)",color:"var(--text-primary)"},damageInputPopup:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,borderRadius:"8px"},damageInputContent:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"8px",padding:"8px",display:"flex",flexDirection:"row",gap:"8px",minWidth:"200px",alignItems:"center",position:"absolute",right:"1rem",top:"50%",transform:"translateY(-50%)"},damageInput:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"4px",padding:"4px 6px",color:"var(--text-primary)",fontSize:"16px",width:"80px",textAlign:"center"},damageIndicators:{display:"flex",gap:"8px",alignItems:"center",justifyContent:"center"},damageDrop:{fontSize:"16px",color:"var(--text-secondary)",cursor:"pointer",transition:"color 0.1s ease"},applyButton:{backgroundColor:"var(--gray-600)",color:"white",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"32px",minHeight:"32px"}},tr=(t,o,c,d)=>{const[w,p]=h.useState(!1),[v,L]=h.useState("");h.useEffect(()=>{if(w){const b=V=>{V.target.closest(".damage-input-popup")||(p(!1),L(""))};return document.addEventListener("click",b),()=>document.removeEventListener("click",b)}},[w]);const g=b=>{b.stopPropagation(),b.preventDefault();const V=t.hp||0,ue=t.hpMax||1,P=b.currentTarget.getBoundingClientRect(),_=b.clientX-P.left,F=P.width/ue;Math.floor(_/F)<V?c&&c(t.id,1,t.hp):o&&o(t.id,1,t.hp,t.hpMax)},E=b=>{b.stopPropagation(),b.preventDefault();const V=t.stress||0,ue=t.stressMax||1,P=b.currentTarget.getBoundingClientRect(),_=b.clientX-P.left,F=P.width/ue;Math.floor(_/F)<V?d&&d(t.id,-1,t.stress,t.stressMax):d&&d(t.id,1,t.stress,t.stressMax)},H=b=>{b.stopPropagation(),(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")&&(p(!0),L(t.type==="Minion"?"1":""))},D=()=>{const b=parseInt(v);if(b>0){if(t.type==="Minion")o&&o(t.id,b,t.hp,t.hpMax);else{let V=0;b>=t.thresholds.severe?V=3:b>=t.thresholds.major?V=2:b>=1&&(V=1),o&&o(t.id,V,t.hp,t.hpMax)}p(!1),L("")}};return{showDamageInput:w,damageValue:v,setDamageValue:L,setShowDamageInput:p,handleHpClick:g,handleStressClick:E,handleDifficultyClick:H,applyDamage:D,handleKeyDown:b=>{b.key==="Enter"?D():b.key==="Escape"&&(p(!1),L(""))}}},st=({item:t,type:o,mode:c="expanded",onClick:d,onDelete:w,onApplyDamage:p,onApplyHealing:v,onApplyStressChange:L,onUpdate:g,adversaries:E=[],isSelected:H=!1,isEditMode:D=!1,instances:T=[],isEmbedded:b=!1,showAddRemoveButtons:V=!1,onAddInstance:ue=null,onRemoveInstance:P=null,onEdit:_=null,showCustomCreator:F=!1,onSaveCustomAdversary:we=null,onCancelEdit:q=null,isStockAdversary:Ie=!1})=>{const Te=h.useRef(null),Le=h.useRef(T.length),ee=h.useRef(null),te=h.useRef(null),he=h.useRef(null);h.useEffect(()=>{const n=Te.current;if(!n)return;const r=()=>{ee.current=n.scrollHeight,te.current=n.scrollTop};n.addEventListener("scroll",r,{passive:!0});const a=setInterval(r,100);return()=>{n.removeEventListener("scroll",r),clearInterval(a)}},[]),h.useEffect(()=>()=>{Te.current&&(ee.current=Te.current.scrollHeight,te.current=Te.current.scrollTop)},[T.length,T]);const[xe,m]=h.useState({});h.useLayoutEffect(()=>{const n=T.length,r=Le.current;if(n!==r&&Te.current){const a=ee.current,x=te.current;if(!a||x===null){Le.current=n;return}const R=Te.current,N=R.scrollHeight,ae=R.clientHeight;if(!(n<r)){if(n>r){const be=N-ae,Me=R.scrollTop,s=be-Me;if(Math.abs(s)>.5){he.current&&(cancelAnimationFrame(he.current),he.current=null);const j=400,i=performance.now(),k=Z=>{if(!R){he.current=null;return}const I=Z-i,U=Math.min(I/j,1),ce=1-U,Ee=1-ce*ce*ce,ye=Me+s*Ee;R.scrollTop=ye,U<1?he.current=requestAnimationFrame(k):(R.scrollTop=be,he.current=null)};he.current=requestAnimationFrame(k)}}}Le.current=n}else Le.current=n},[T.length,T]);const X=n=>{const a=(t.features||[]).filter(x=>x.type===n.type).findIndex(x=>x===n);return`${n.type}-${a}-${n.name||"blank"}`},S=(n,r)=>`experience-${r}-${typeof n=="string"?n:n.name||"blank"}`,de=n=>{const r=X(n);if(xe[r]){const a=t.features.filter(x=>x!==n);g&&g(t.id,{features:a}),m(x=>{const R={...x};return delete R[r],R})}else m(a=>({...a,[r]:!0})),setTimeout(()=>{m(a=>{const x={...a};return delete x[r],x})},3e3)},Q=(n,r)=>{const a=S(n,r);if(xe[a]){const x=[...t.experience||[]];x.splice(r,1),g&&g(t.id,{experience:x}),m(R=>{const N={...R};return delete N[a],N})}else m(x=>({...x,[a]:!0})),setTimeout(()=>{m(x=>{const R={...x};return delete R[a],R})},3e3)},me=tr(t,p,v,L);(o==="adversary"||o==="adversaries")&&me.handleDifficultyClick;const K=(n=!1)=>{let r={...He.card};if(H?r.transition="none":r.transition=He.transitions.hoverOut,n){const{marginTop:a,...x}=r;r=x}return H&&(r={...r,...He.cardHover}),o==="adversary"&&(t.hp||0)>=(t.hpMax||1)&&(r={...r,...He.cardDead}),r},ne=()=>{if(b)return"";let n="border rounded-lg";return H&&(n+=" border-hover"),n},ge=()=>{var n;if(o==="adversary"||o==="adversaries"){const r=t.baseName||((n=t.name)==null?void 0:n.replace(/\s+\(\d+\)$/,""))||"",a=t.duplicateNumber||1,x=[...E];return E.some(ae=>ae.id===t.id)||x.push(t),x.filter(ae=>ae.baseName===r).length>1?`${r} (${a})`:r}return t.name},Ae=()=>{const n=[];return t.type&&n.push(e.jsx("span",{style:{...He.badge,...He.typeBadge},children:t.type},"type")),n},ze=()=>o!=="adversary"||!me.showDamageInput||!(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")?null:e.jsx("div",{className:"damage-input-popup",style:He.damageInputPopup,onClick:n=>{n.stopPropagation(),n.target===n.currentTarget&&(o==="adversary"||o==="adversaries")&&(me.setShowDamageInput(!1),me.setDamageValue(""))},children:e.jsxs("div",{className:"border rounded-lg",style:{...He.damageInputContent,borderColor:"var(--border)"},onClick:n=>n.stopPropagation(),children:[e.jsx("input",{type:"number",inputMode:"numeric",enterKeyHint:"done",placeholder:"dmg",min:(t.type==="Minion","0"),value:o==="adversary"||o==="adversaries"?me.damageValue:"",onChange:n=>{(o==="adversary"||o==="adversaries")&&me.setDamageValue(n.target.value)},onKeyDown:o==="adversary"||o==="adversaries"?me.handleKeyDown:void 0,className:"border rounded-sm",style:{...He.damageInput,borderColor:"var(--border)"},autoFocus:!0}),e.jsxs("div",{style:He.damageIndicators,children:[t.type==="Minion"?(()=>{var R,N;const n=parseInt(o==="adversary"||o==="adversaries"?me.damageValue:"0")||0,r=(R=t.features)==null?void 0:R.find(ae=>{var be;return(be=ae.name)==null?void 0:be.startsWith("Minion (")}),a=r?parseInt(((N=r.name.match(/\((\d+)\)/))==null?void 0:N[1])||"1"):1,x=Math.floor(n/a);return n>=a&&x>0?e.jsxs("span",{style:{...He.damageDrop,color:"var(--red)"},title:`${n} damage can defeat ${x+1} minion${x+1!==1?"s":""} (1 + ${x} additional)`,children:["+",x," additional minion(s)"]}):e.jsx("span",{style:He.damageDrop,title:`${n} damage defeats this minion only`,children:"+0 additional minion(s)"})})():[1,2,3].map(n=>{const r=parseInt(o==="adversary"||o==="adversaries"?me.damageValue:"0")||0;let a=!1;return n===1&&r>=1&&(a=!0),n===2&&r>=t.thresholds.major&&(a=!0),n===3&&r>=t.thresholds.severe&&(a=!0),e.jsx("span",{style:{...He.damageDrop,color:a?"var(--red)":"var(--text-secondary)"},onClick:x=>{x.stopPropagation(),(o==="adversary"||o==="adversaries")&&(n===1?me.setDamageValue("1"):n===2?me.setDamageValue(t.thresholds.major.toString()):n===3&&me.setDamageValue(t.thresholds.severe.toString()))},title:`Click to set damage to ${n===1?"1":n===2?t.thresholds.major:t.thresholds.severe}`,children:e.jsx(At,{size:16})},n)}),e.jsx("button",{style:{...He.applyButton,backgroundColor:"var(--gray-600)"},onClick:n=>{n.stopPropagation(),(o==="adversary"||o==="adversaries")&&(!me.damageValue||parseInt(me.damageValue)<1?(me.setShowDamageInput(!1),me.setDamageValue("")):me.applyDamage())},title:!me.damageValue||parseInt(me.damageValue)<1?"Close damage input":"Apply damage",children:!me.damageValue||parseInt(me.damageValue)<1?e.jsx(Xe,{size:16}):e.jsx(qt,{size:16})})]})]})}),Re=()=>{var R,N,ae,be,Me;const n=(t.hp||0)>=(t.hpMax||1),r=Ce==="edit"||F,a=V&&o==="adversary"||F&&o==="adversary",x=a?F?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:s=>{s.stopPropagation(),we&&(we(t,t.id),q&&q())},style:{background:"var(--purple)",border:"1px solid var(--purple)",color:"white",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:s=>{s.target.style.opacity="0.9"},onMouseLeave:s=>{s.target.style.opacity="1"},title:"Save",children:[e.jsx(Ot,{size:16}),e.jsx("span",{children:"Save"})]}),q&&e.jsxs("button",{onClick:s=>{s.stopPropagation(),q()},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:s=>{s.target.style.backgroundColor="var(--bg-hover)",s.target.style.borderColor="var(--purple)"},onMouseLeave:s=>{s.target.style.backgroundColor="var(--bg-secondary)",s.target.style.borderColor="var(--border)"},title:"Cancel",children:[e.jsx(Xe,{size:16}),e.jsx("span",{children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:s=>{s.stopPropagation(),P&&P(t.id)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease"},onMouseEnter:s=>{s.target.style.backgroundColor="var(--bg-hover)",s.target.style.borderColor="var(--purple)"},onMouseLeave:s=>{s.target.style.backgroundColor="var(--bg-secondary)",s.target.style.borderColor="var(--border)"},title:"Remove one",children:e.jsx(ut,{size:16})}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"1rem",fontWeight:"500",minWidth:"24px",textAlign:"center"},children:T.length}),e.jsx("button",{onClick:s=>{s.stopPropagation(),ue&&ue(t)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease"},onMouseEnter:s=>{s.target.style.backgroundColor="var(--purple)",s.target.style.borderColor="var(--purple)",s.target.style.color="white"},onMouseLeave:s=>{s.target.style.backgroundColor="var(--bg-secondary)",s.target.style.borderColor="var(--border)",s.target.style.color="var(--text-primary)"},title:"Add another",children:e.jsx(Ke,{size:16})}),_&&e.jsx("button",{onClick:s=>{s.stopPropagation(),_(t.id)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease",marginLeft:"0.25rem"},onMouseEnter:s=>{s.target.style.backgroundColor="var(--purple)",s.target.style.borderColor="var(--purple)",s.target.style.color="white"},onMouseLeave:s=>{s.target.style.backgroundColor="var(--bg-secondary)",s.target.style.borderColor="var(--border)",s.target.style.color="var(--text-primary)"},title:"Edit",children:e.jsx(Ft,{size:16})})]}):null;return e.jsx(Tt,{tabContent:x,showTab:a,tabBorderColor:H?"var(--purple)":"var(--border)",containerBackgroundColor:n?"var(--gray-900)":K(!0).backgroundColor,containerBorderColor:n?"color-mix(in srgb, var(--gray-600) 40%, transparent)":H?"var(--purple)":"var(--border)",containerBorderRadius:"8px",containerOverflow:"hidden",containerStyle:{padding:0,opacity:n?.7:1,height:"auto",maxHeight:a?"calc(100vh - 120px)":"calc(100vh - 68px)",minHeight:0},children:e.jsxs("div",{className:ne(),style:{...K(!0),padding:0,display:"flex",flexDirection:"column",position:"relative",height:"100%",minHeight:0,border:"none",borderRadius:0},onClick:d,children:[n&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                  45deg,
                  transparent,
                  transparent 8px,
                  var(--gray-600) 1px,
                  var(--gray-600) 9px
                )`,pointerEvents:"none",zIndex:9999}})}),e.jsx("div",{className:"border-b",style:{padding:"8px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative",zIndex:n?1:"auto",borderBottomColor:H?"var(--purple)":"var(--border)"},children:e.jsx("div",{style:{display:"flex",flexDirection:"column",position:"relative",zIndex:n?1:"auto",padding:"2px",gap:0},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",minHeight:"40px"},children:[r?e.jsx("input",{type:"text",value:t.name||"",onChange:s=>{g&&g(t.id,{name:s.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"4px",color:"var(--text-primary)",fontSize:"1.1rem",fontWeight:"600",padding:"0.5rem",width:"100%",maxWidth:"300px",paddingRight:"0.625rem"},placeholder:"Name"}):e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flex:1},children:e.jsx("h4",{style:{...He.rowTitle,color:n?"color-mix(in srgb, var(--gray-400) 80%, transparent)":He.rowTitle.color,textAlign:"left",margin:0,fontSize:"1.1rem",paddingRight:"6px",flex:1},children:((R=t.name)==null?void 0:R.replace(/\s+\(\d+\)$/,""))||t.name})}),(t.type||t.tier||r)&&e.jsx(er,{type:t.type,tier:t.tier,isEditMode:r,onUpdate:g,itemId:t.id})]})})}),e.jsxs("div",{ref:Te,style:{borderRadius:"0 0 8px 8px",flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0},className:"invisible-scrollbar",children:[(t.motives||r)&&e.jsx("div",{style:{padding:"0.5rem 8px",textAlign:"center"},children:r?e.jsx("input",{type:"text",value:t.motives||"",onChange:s=>g&&g(t.id,{motives:s.target.value}),placeholder:"Motives...",style:{width:"100%",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}):e.jsxs("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,textAlign:"center"},children:[t.motives,t.motives&&!t.motives.endsWith(".")?".":""]})}),(t.difficulty||t.atk!==void 0||t.thresholds&&t.type!=="Minion"||t.experience&&t.experience.length>0||r)&&e.jsxs("div",{style:{padding:"0.5rem 8px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[(t.difficulty||r)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[e.jsx($t,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(0deg)"}}),r?e.jsx("input",{type:"text",value:t.difficulty||"",onChange:s=>{const j=s.target.value.replace(/[^0-9]/g,"");j.length<=2&&g&&g(t.id,{difficulty:parseInt(j)||0})},onKeyDown:s=>{if(s.key==="ArrowUp"){s.preventDefault();const j=parseInt(t.difficulty)||0;g&&g(t.id,{difficulty:Math.min(j+1,99)})}else if(s.key==="ArrowDown"){s.preventDefault();const j=parseInt(t.difficulty)||0;g&&g(t.id,{difficulty:Math.max(j-1,0)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"2"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:t.difficulty})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Difficulty"})]}),(t.atk!==void 0||r)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[e.jsx(_t,{size:38,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(45deg)"}}),r?e.jsx("input",{type:"text",value:(()=>{const s=typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0;return s>=0?`+${s}`:s.toString()})(),onChange:s=>{const j=s.target.value.replace(/[^0-9+\-]/g,"");if(j.length<=4){const i=parseInt(j.replace(/[^0-9\-]/g,""))||0;g&&g(t.id,{atk:i})}},onKeyDown:s=>{if(s.key==="ArrowUp"){s.preventDefault();const i=(typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0)+1;g&&g(t.id,{atk:i})}else if(s.key==="ArrowDown"){s.preventDefault();const i=(typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0)-1;g&&g(t.id,{atk:i})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"3"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:(()=>{const s=typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk;return s>=0?`+${s}`:s})()})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Attack"})]})]}),e.jsx("div",{style:{paddingTop:"0"},children:r?e.jsx("div",{style:{display:"flex",flexDirection:"column",marginTop:"-0.25rem"},children:(()=>{const s=t.experience||[],j=s.length===0?[{name:"",modifier:1}]:s;return j.map((i,k)=>{var Z,I,U,ce,Ee,ye,y,M,O,ie,Y,ke,pe,fe,le,C,se,Se,We,f,u,$,z,re,B;return e.jsxs("div",{style:{position:"relative",marginBottom:"0.5rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("input",{type:"text",value:typeof i=="object"&&i.modifier>=1?`+${i.modifier}`:"+1",onChange:A=>{const G=[...t.experience||[]],W=parseInt(A.target.value.replace(/[^0-9+-]/g,""))||1,J=Math.max(1,W);G[k]={name:typeof i=="string"?i:i.name||"",modifier:J},g&&g(t.id,{experience:G})},onKeyDown:A=>{if(A.key==="ArrowUp"){A.preventDefault();const G=[...t.experience||[]],W=typeof i=="object"?Math.max(1,i.modifier):1;G[k]={name:typeof i=="string"?i:i.name||"",modifier:W+1},g&&g(t.id,{experience:G})}else if(A.key==="ArrowDown"){A.preventDefault();const G=[...t.experience||[]],W=typeof i=="object"?Math.max(1,i.modifier):1;G[k]={name:typeof i=="string"?i:i.name||"",modifier:Math.max(1,W-1)},g&&g(t.id,{experience:G})}},style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)",textAlign:"center",outline:"none"}})}),e.jsxs("div",{style:{marginLeft:"32px",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:typeof i=="string"?i:i.name||"",onChange:A=>{const G=[...t.experience||[]],W=typeof i=="object"?i.modifier:1;G[k]={name:A.target.value,modifier:W};const J=G[G.length-1];J&&J.name.trim()&&G.push({name:"",modifier:1}),g&&g(t.id,{experience:G})},placeholder:"Experience name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsxs("div",{style:{display:"flex",gap:"0.125rem"},children:[e.jsx("button",{onClick:()=>{var ve,je;const A=[...t.experience||[]],G=typeof i=="string"?i.trim():(ve=i.name)==null?void 0:ve.trim(),W=A[k-1],J=typeof W=="string"?W.trim():(je=W.name)==null?void 0:je.trim();k>0&&k<A.length&&G&&J&&(A[k]=W,A[k-1]=i,g&&g(t.id,{experience:A}))},disabled:k===0||!(typeof i=="string"?i.trim():(Z=i.name)!=null&&Z.trim())||!(typeof j[k-1]=="string"?j[k-1].trim():(I=j[k-1].name)!=null&&I.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:k===0||!(typeof i=="string"?i.trim():(U=i.name)!=null&&U.trim())||!(typeof j[k-1]=="string"?j[k-1].trim():(ce=j[k-1].name)!=null&&ce.trim())?"var(--gray-800)":"var(--gray-700)",color:k===0||!(typeof i=="string"?i.trim():(Ee=i.name)!=null&&Ee.trim())||!(typeof j[k-1]=="string"?j[k-1].trim():(ye=j[k-1].name)!=null&&ye.trim())?"var(--text-secondary)":"white",cursor:k===0||!(typeof i=="string"?i.trim():(y=i.name)!=null&&y.trim())||!(typeof j[k-1]=="string"?j[k-1].trim():(M=j[k-1].name)!=null&&M.trim())?"not-allowed":"pointer",opacity:k===0||!(typeof i=="string"?i.trim():(O=i.name)!=null&&O.trim())||!(typeof j[k-1]=="string"?j[k-1].trim():(ie=j[k-1].name)!=null&&ie.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move up",children:"↑"}),e.jsx("button",{onClick:()=>{var ve,je;const A=[...t.experience||[]],G=typeof i=="string"?i.trim():(ve=i.name)==null?void 0:ve.trim(),W=A[k+1],J=typeof W=="string"?W.trim():(je=W.name)==null?void 0:je.trim();k<A.length-1&&k>=0&&G&&J&&(A[k]=W,A[k+1]=i,g&&g(t.id,{experience:A}))},disabled:k===j.length-1||!(typeof i=="string"?i.trim():(Y=i.name)!=null&&Y.trim())||!(typeof j[k+1]=="string"?j[k+1].trim():(ke=j[k+1].name)!=null&&ke.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:k===j.length-1||!(typeof i=="string"?i.trim():(pe=i.name)!=null&&pe.trim())||!(typeof j[k+1]=="string"?j[k+1].trim():(fe=j[k+1].name)!=null&&fe.trim())?"var(--gray-800)":"var(--gray-700)",color:k===j.length-1||!(typeof i=="string"?i.trim():(le=i.name)!=null&&le.trim())||!(typeof j[k+1]=="string"?j[k+1].trim():(C=j[k+1].name)!=null&&C.trim())?"var(--text-secondary)":"white",cursor:k===j.length-1||!(typeof i=="string"?i.trim():(se=i.name)!=null&&se.trim())||!(typeof j[k+1]=="string"?j[k+1].trim():(Se=j[k+1].name)!=null&&Se.trim())?"not-allowed":"pointer",opacity:k===j.length-1||!(typeof i=="string"?i.trim():(We=i.name)!=null&&We.trim())||!(typeof j[k+1]=="string"?j[k+1].trim():(f=j[k+1].name)!=null&&f.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move down",children:"↓"}),e.jsx("button",{onClick:()=>Q(i,k),disabled:!(typeof i=="string"?i.trim():(u=i.name)!=null&&u.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:xe[S(i,k)]?"var(--danger)":(typeof i=="string"?i.trim():($=i.name)!=null&&$.trim())?"var(--gray-700)":"var(--gray-800)",color:(typeof i=="string"?i.trim():(z=i.name)!=null&&z.trim())?"white":"var(--text-secondary)",cursor:(typeof i=="string"?i.trim():(re=i.name)!=null&&re.trim())?"pointer":"not-allowed",opacity:(typeof i=="string"?i.trim():(B=i.name)!=null&&B.trim())?1:.5,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:xe[S(i,k)]?"Click again to confirm delete":"Delete experience",children:"×"})]})]})]},k)})})()}):e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:t.experience&&t.experience.length>0?t.experience.map((s,j)=>{if(typeof s=="string"){const i=s.match(/^(.+?)\s*([+-]?\d+)$/);if(i){const[,k,Z]=i;return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:Z})})}),e.jsx("span",{style:{marginLeft:"32px"},children:k})]},j)}else return e.jsx("div",{style:{marginBottom:"0.25rem"},children:s},j)}else return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:e.jsxs("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:[s.modifier>=0?"+":"",s.modifier]})})}),e.jsx("span",{style:{marginLeft:"32px"},children:s.name})]},j)}):null})})]}),(t.features&&t.features.length>0||r)&&e.jsxs("div",{style:{padding:"0 8px 8px 8px"},children:[(t.atk!==void 0&&t.weapon||r)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Standard Attack"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:r?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",marginTop:"0.75rem",marginBottom:"0.75rem"},children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[e.jsx("input",{type:"text",value:t.weapon||"",onChange:s=>g&&g(t.id,{weapon:s.target.value}),placeholder:"Standard attack name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}}),e.jsxs("select",{value:t.range||"",onChange:s=>g&&g(t.id,{range:s.target.value}),style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",appearance:"none",backgroundImage:`url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",backgroundSize:"1rem",paddingRight:"2rem"},children:[e.jsx("option",{value:""}),e.jsx("option",{value:"Melee",children:"Melee"}),e.jsx("option",{value:"Very Close",children:"Very Close"}),e.jsx("option",{value:"Close",children:"Close"}),e.jsx("option",{value:"Far",children:"Far"}),e.jsx("option",{value:"Very Far",children:"Very Far"})]}),e.jsx("input",{type:"text",value:t.damage||"",onChange:s=>g&&g(t.id,{damage:s.target.value}),placeholder:"Damage (e.g., 1d6+2)",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}})]})}):t.atk!==void 0&&t.weapon&&e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:t.weapon}),e.jsxs("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:["Make an attack against a target within ",t.range||"Melee"," range. On a success, deal ",t.damage||"damage varies","."]})]})})]}),(t.features.filter(s=>s.type==="Action").length>0||r)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Actions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const s=t.features.filter(i=>i.type==="Action");return(r&&s.length===0?[{type:"Action",name:"",description:""}]:s).map((i,k)=>r?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:i.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false","data-lpignore":"true","data-form-type":"other",name:`feature-name-${i.type.toLowerCase()}`,onChange:Z=>{const I=[...t.features||[]],U=I.findIndex(ye=>ye.type==="Action"&&ye===i);U>=0?I[U]={...I[U],name:Z.target.value}:I.push({type:"Action",name:Z.target.value,description:i.description||""});const ce=I.filter(ye=>ye.type==="Action"),Ee=ce[ce.length-1];Ee&&Ee.name.trim()&&I.push({type:"Action",name:"",description:""}),g&&g(t.id,{features:I})},placeholder:"Action name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:i.description||"",onChange:Z=>{const I=[...t.features||[]],U=I.findIndex(ye=>ye.type==="Action"&&ye===i);U>=0?I[U]={...I[U],description:Z.target.value}:I.push({type:"Action",name:i.name||"",description:Z.target.value});const ce=I.filter(ye=>ye.type==="Action"),Ee=ce[ce.length-1];Ee&&Ee.name.trim()&&I.push({type:"Action",name:"",description:""}),g&&g(t.id,{features:I})},onInput:Z=>{const I=Z.target.offsetHeight;Z.target.style.height="auto";const U=Z.target.scrollHeight,ce=U>I?U:I;Z.target.style.height=ce+"px"},placeholder:"Action description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(lt,{feature:i,featureType:"Action",item:t,onUpdate:g,handleFeatureDeleteClick:de,deleteConfirmations:xe,getFeatureKey:X})]},k):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:i.name}),i.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:i.description})]},k))})()})]}),(t.features.filter(s=>s.type==="Passive").length>0||r)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Passives"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const s=t.features.filter(i=>i.type==="Passive");return(r&&s.length===0?[{type:"Passive",name:"",description:""}]:s).map((i,k)=>r?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:i.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:Z=>{const I=[...t.features||[]],U=I.findIndex(ye=>ye.type==="Passive"&&ye===i);U>=0?I[U]={...I[U],name:Z.target.value}:I.push({type:"Passive",name:Z.target.value,description:i.description||""});const ce=I.filter(ye=>ye.type==="Passive"),Ee=ce[ce.length-1];Ee&&Ee.name.trim()&&I.push({type:"Passive",name:"",description:""}),g&&g(t.id,{features:I})},placeholder:"Passive name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:i.description||"",onChange:Z=>{const I=[...t.features||[]],U=I.findIndex(ye=>ye.type==="Passive"&&ye===i);U>=0?I[U]={...I[U],description:Z.target.value}:I.push({type:"Passive",name:i.name||"",description:Z.target.value});const ce=I.filter(ye=>ye.type==="Passive"),Ee=ce[ce.length-1];Ee&&Ee.name.trim()&&I.push({type:"Passive",name:"",description:""}),g&&g(t.id,{features:I})},onInput:Z=>{const I=Z.target.offsetHeight;Z.target.style.height="auto";const U=Z.target.scrollHeight,ce=U>I?U:I;Z.target.style.height=ce+"px"},placeholder:"Passive description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(lt,{feature:i,featureType:"Passive",item:t,onUpdate:g,handleFeatureDeleteClick:de,deleteConfirmations:xe,getFeatureKey:X})]},k):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:i.name}),i.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:i.description})]},k))})()})]}),(t.features.filter(s=>s.type==="Reaction").length>0||r)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Reactions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const s=t.features.filter(i=>i.type==="Reaction");return(r&&s.length===0?[{type:"Reaction",name:"",description:""}]:s).map((i,k)=>r?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:i.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:Z=>{const I=[...t.features||[]],U=I.findIndex(ye=>ye.type==="Reaction"&&ye===i);U>=0?I[U]={...I[U],name:Z.target.value}:I.push({type:"Reaction",name:Z.target.value,description:i.description||""});const ce=I.filter(ye=>ye.type==="Reaction"),Ee=ce[ce.length-1];Ee&&Ee.name.trim()&&I.push({type:"Reaction",name:"",description:""}),g&&g(t.id,{features:I})},placeholder:"Reaction name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:i.description||"",onChange:Z=>{const I=[...t.features||[]],U=I.findIndex(ye=>ye.type==="Reaction"&&ye===i);U>=0?I[U]={...I[U],description:Z.target.value}:I.push({type:"Reaction",name:i.name||"",description:Z.target.value});const ce=I.filter(ye=>ye.type==="Reaction"),Ee=ce[ce.length-1];Ee&&Ee.name.trim()&&I.push({type:"Reaction",name:"",description:""}),g&&g(t.id,{features:I})},onInput:Z=>{const I=Z.target.offsetHeight;Z.target.style.height="auto";const U=Z.target.scrollHeight,ce=U>I?U:I;Z.target.style.height=ce+"px"},placeholder:"Reaction description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(lt,{feature:i,featureType:"Reaction",item:t,onUpdate:g,handleFeatureDeleteClick:de,deleteConfirmations:xe,getFeatureKey:X})]},k):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:i.name}),i.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:i.description})]},k))})()})]})]}),(T&&T.length>0||t.type!=="Minion"&&(t.thresholds||r))&&e.jsxs("div",{style:{padding:"0 8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Status"})]}),r?e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border)"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"number",value:t.hpMax||"",onChange:s=>{const j=parseInt(s.target.value)||1;g&&g(t.id,{hpMax:j})},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),e.jsx(Je,{type:"adversaryHP",value:0,maxValue:t.hpMax||1,showTooltip:!1}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:"HP"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"number",value:t.stressMax||"",onChange:s=>{const j=parseInt(s.target.value)||1;g&&g(t.id,{stressMax:j})},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),e.jsx(Je,{type:"adversaryStress",value:0,maxValue:t.stressMax||1,showTooltip:!1}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:"Stress"})]})]})})}):T&&T.length>0&&T.map((s,j)=>{const i=(s.hp||0)>=(s.hpMax||1);return e.jsx("div",{"data-instance-id":s.id,style:{marginBottom:"0.5rem"},children:e.jsxs("div",{style:{backgroundColor:i?"var(--gray-900)":"var(--bg-primary)",borderRadius:"6px",padding:"0.25rem 0.5rem",border:"1px solid",borderColor:i?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",display:"flex",justifyContent:"flex-start",alignItems:"center",gap:"0.5rem",opacity:i?.7:1,position:"relative",transition:"all 0.2s ease",minHeight:"40px"},children:[i&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                          45deg,
                          transparent 0px,
                          transparent 8px,
                          var(--gray-600) 9px,
                          var(--gray-600) 9px
                        )`,pointerEvents:"none",zIndex:1,borderRadius:"4px"}})}),e.jsx("div",{style:{backgroundColor:i?"var(--gray-900)":"var(--bg-card)",border:"1px solid",borderColor:i?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",borderRadius:"50%",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",flexShrink:0,opacity:i?.5:1},children:e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:i?"var(--gray-400)":"var(--text-primary)"},children:s.duplicateNumber||1})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.125rem"},children:[e.jsx("div",{style:{opacity:i?.3:1},children:e.jsx(Je,{type:"adversaryHP",value:s.hp||0,maxValue:s.hpMax||1,onPipClick:(k,Z)=>{if(p&&o==="adversary"){const I=s.hp||0,U=s.hpMax||1;Z?v&&v(s.id,1,I):I<U&&p(s.id,1,I,U)}},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})}),s.stressMax>0&&e.jsx("div",{style:{opacity:i?.3:1},children:e.jsx(Je,{type:"adversaryStress",value:s.stress||0,maxValue:s.stressMax,onPipClick:(k,Z)=>{L&&o==="adversary"&&(Z?L(s.id,-1):L(s.id,1))},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})})]})]},s.id)},s.id)}),t.type!=="Minion"&&(t.thresholds||r)&&e.jsx("div",{style:{display:"flex",justifyContent:"center",paddingTop:"1px",marginTop:"0.5rem",marginBottom:"0.5rem"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",position:"relative"},children:e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",height:"36px"},children:[e.jsx("svg",{width:"300",height:"36",viewBox:"0 0 300 36",style:{position:"absolute",zIndex:1},children:e.jsx("rect",{x:"20",y:"6",width:"260",height:"24",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4"})}),e.jsx("div",{style:{position:"relative",zIndex:2,display:"flex",alignItems:"center",gap:"0.5rem"},children:r?e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",fontSize:"0.8rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),e.jsx("input",{type:"number",min:"1",max:"99",value:((N=t.thresholds)==null?void 0:N.major)||"",onChange:s=>{const j=s.target.value;(j===""||parseInt(j)>=1&&parseInt(j)<=99)&&g&&g(t.id,{thresholds:{...t.thresholds,major:j===""?null:parseInt(j)}})},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),e.jsx("input",{type:"number",min:"1",max:"99",value:((ae=t.thresholds)==null?void 0:ae.severe)||"",onChange:s=>{const j=s.target.value;(j===""||parseInt(j)>=1&&parseInt(j)<=99)&&g&&g(t.id,{thresholds:{...t.thresholds,severe:j===""?null:parseInt(j)}})},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),e.jsx(wt,{value:((be=t.thresholds)==null?void 0:be.major)||7}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),e.jsx(wt,{value:((Me=t.thresholds)==null?void 0:Me.severe)||14}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]})})]})})})]}),(r||c==="expanded"&&t.description&&t.description.trim())&&e.jsxs("div",{style:{padding:"0 8px",textAlign:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Description"})]}),r?e.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-primary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"none",overflow:"hidden",fontFamily:"inherit",marginTop:"0.75rem",marginBottom:"0.75rem"},value:t.description,onChange:s=>{s.target.style.height="auto",s.target.style.height=s.target.scrollHeight+"px",g&&g(t.id,{description:s.target.value})},placeholder:"Description..."}):e.jsx("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,whiteSpace:"pre-wrap",padding:"0.5rem 0"},children:t.description})]})]}),ze()]})})},Ce=F?"edit":c;return(Ce==="expanded"||Ce==="edit")&&(o==="adversary"||o==="adversaries")?Re():o==="adversary"||o==="adversaries"?null:e.jsxs("div",{className:ne(),style:K(!0),children:[e.jsxs("div",{style:He.rowMain,children:[e.jsx("h4",{style:He.rowTitle,children:ge()}),e.jsx("div",{style:He.rowMeta,children:Ae()})]}),e.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"12px",margin:0},children:["Expanded view coming soon for ",o]})]})},rr="modulepreload",nr=function(t){return"/Daggerheart/"+t},Ct={},Ye=function(o,c,d){if(!c||c.length===0)return o();const w=document.getElementsByTagName("link");return Promise.all(c.map(p=>{if(p=nr(p),p in Ct)return;Ct[p]=!0;const v=p.endsWith(".css"),L=v?'[rel="stylesheet"]':"";if(!!d)for(let H=w.length-1;H>=0;H--){const D=w[H];if(D.href===p&&(!v||D.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${p}"]${L}`))return;const E=document.createElement("link");if(E.rel=v?"stylesheet":rr,v||(E.as="script",E.crossOrigin=""),E.href=p,document.head.appendChild(E),v)return new Promise((H,D)=>{E.addEventListener("load",H),E.addEventListener("error",()=>D(new Error(`Unable to preload CSS for ${p}`)))})})).then(()=>o()).catch(p=>{const v=new Event("vite:preloadError",{cancelable:!0});if(v.payload=p,window.dispatchEvent(v),!v.defaultPrevented)throw p})},sr="/Daggerheart/assets/daggerheart-logo-fe7815ad.svg",St={Minion:{difficulty:t=>[9,12,15,18][t-1],thresholds:t=>({major:0,severe:0}),hpMax:t=>1,stressMax:t=>1,atk:t=>[-1,0,1,2][t-1],damage:t=>["2","5","8","11"][t-1],range:"Melee"},Standard:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[7,10,20,25][t-1],severe:[12,20,32,45][t-1]}),hpMax:t=>[4,5,6,7][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[1,2,3,4][t-1],damage:t=>["1d8+1","2d8+2","3d8+3","4d8+4"][t-1],range:"Melee"},Bruiser:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[8,14,22,38][t-1],severe:[15,28,40,70][t-1]}),hpMax:t=>[6,7,8,9][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[-1,0,1,2][t-1],damage:t=>["1d12+2","2d12+4","3d12+6","4d12+8"][t-1],range:"Melee"},Horde:{difficulty:t=>[10,13,16,19][t-1],thresholds:t=>({major:[7,10,20,25][t-1],severe:[12,20,32,45][t-1]}),hpMax:t=>[5,6,7,8][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[-1,0,1,2][t-1],damage:t=>["1d8+2","2d8+4","3d8+6","4d8+8"][t-1],range:"Melee"},Leader:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[7,13,21,35][t-1],severe:[14,26,38,65][t-1]}),hpMax:t=>[5,6,7,8][t-1],stressMax:t=>[5,5,6,6][t-1],atk:t=>[2,4,6,8][t-1],damage:t=>["1d10+2","2d10+4","3d10+6","4d10+8"][t-1],range:"Melee"},Ranged:{difficulty:t=>[10,13,16,19][t-1],thresholds:t=>({major:[4,8,18,22][t-1],severe:[7,16,30,42][t-1]}),hpMax:t=>[3,4,5,6][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d8+2","2d8+4","3d8+6","4d8+8"][t-1],range:"Close"},Skulk:{difficulty:t=>[12,15,18,21][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,5,6,7][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d6+2","2d6+4","3d6+6","4d6+8"][t-1],range:"Melee"},Solo:{difficulty:t=>[12,15,18,21][t-1],thresholds:t=>({major:[7,13,21,35][t-1],severe:[14,26,38,65][t-1]}),hpMax:t=>[8,9,10,11][t-1],stressMax:t=>[5,5,6,6][t-1],atk:t=>[3,5,7,9][t-1],damage:t=>["1d10+3","2d10+6","3d10+9","4d10+12"][t-1],range:"Melee"},Support:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,4,5,5][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d4+2","2d4+4","3d4+6","4d4+8"][t-1],range:"Melee"},Social:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,4,5,5][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d4+2","2d4+4","3d4+6","4d4+8"][t-1],range:"Melee"}},tt=(t,o)=>{const c=St[o]||St.Standard;return{difficulty:c.difficulty(t),thresholds:c.thresholds(t),hpMax:c.hpMax(t),stressMax:c.stressMax(t),atk:c.atk(t),damage:c.damage(t),range:c.range}};let Rt={adversaries:[]},jt=!1;const or=()=>({customAdversaries:JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]")}),ar=async()=>{if(jt)return;let t={adversaries:[]},o={adversaries:[]};try{const d=await Ye(()=>import("./adversaries-9c8932de.js"),[]);t=(d==null?void 0:d.default)||d}catch(d){console.warn("Failed to load adversaries.json:",d)}try{const d=await Ye(()=>import("./playtest-adversaries-4a099c10.js"),[]);o=(d==null?void 0:d.default)||d}catch(d){console.warn("Failed to load playtest-adversaries.json:",d)}const{customAdversaries:c}=or();Rt={...t,adversaries:[...t.adversaries||[],...o.adversaries||[],...c]},jt=!0},Wt=h.forwardRef(({onSave:t,onRefresh:o,onAddItem:c,editingAdversary:d,onCancelEdit:w,isStockAdversary:p=!1,autoFocus:v=!1,allAdversaries:L=[],embedded:g=!1,hideEmbeddedButtons:E=!1},H)=>{const D=h.useRef(null),[T,b]=h.useState(()=>{const m=tt(1,"Standard");return{name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:m.difficulty,thresholds:m.thresholds,hpMax:m.hpMax,stressMax:m.stressMax,atk:m.atk,weapon:"",range:m.range,damage:m.damage,experience:[],features:[]}}),[V,ue]=h.useState(!1),[P,_]=h.useState(!1),[F,we]=h.useState([]),[q,Ie]=h.useState(!1),[Te,Le]=h.useState([]);h.useEffect(()=>{(async()=>{await ar(),L.length>0?Le(L):Le(Rt.adversaries||[])})()},[L]),h.useEffect(()=>{v&&D.current&&setTimeout(()=>{var m;(m=D.current)==null||m.focus()},100)},[v]),h.useEffect(()=>{if(d)b({name:d.name||"",tier:d.tier||1,type:d.type||"Standard",description:d.description||"",motives:d.motives||"",difficulty:d.difficulty||11,thresholds:d.thresholds||{major:7,severe:12},hpMax:d.hpMax||3,stressMax:d.stressMax||1,atk:d.atk||1,weapon:d.weapon||"",range:d.range||"Melee",damage:d.damage||"",experience:d.experience||[],features:d.features||[]}),_(!1);else{const m=tt(1,"Standard");b({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:m.difficulty,thresholds:m.thresholds,hpMax:m.hpMax,stressMax:m.stressMax,atk:m.atk,weapon:"",range:m.range,damage:m.damage,experience:[],features:[]}),_(!1)}},[d]),h.useEffect(()=>{if(!d&&!P){const m=tt(T.tier,T.type);b(X=>({...X,difficulty:m.difficulty,thresholds:m.thresholds,hpMax:m.hpMax,stressMax:m.stressMax,atk:m.atk,range:m.range,damage:m.damage}))}},[T.tier,T.type,d,P]);const ee=m=>{if(b(X=>({...X,name:m})),m.trim().length>0){const X=Te.filter(S=>{var Q;return(((Q=S.name)==null?void 0:Q.replace(/\s+\(\d+\)$/,""))||S.name||"").toLowerCase().includes(m.toLowerCase())}).slice(0,5);we(X),Ie(X.length>0)}else we([]),Ie(!1)},te=async()=>{if(!T.name.trim()){alert("Please enter a name for the adversary");return}ue(!0);try{const m={...T,hp:d?d.hp:0,stress:d?d.stress:0,source:"Homebrew"};if(d)p?(await t(m),alert("Custom adversary created successfully!")):(m.id=d.id,await t(m,d.id),alert("Adversary updated successfully!")),w&&w();else{await t(m),o&&await o();const X=tt(1,"Standard");b({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:X.difficulty,thresholds:X.thresholds,hpMax:X.hpMax,stressMax:X.stressMax,atk:X.atk,weapon:"",range:X.range,damage:X.damage,experience:[],features:[]}),_(!1),alert("Custom adversary created successfully!")}}catch(m){console.error("Error saving adversary:",m),alert("Error saving adversary. Please try again.")}finally{ue(!1)}};h.useImperativeHandle(H,()=>({handleSave:te,isSaving:V,canSave:T.name.trim().length>0}));const he={...T,id:"new-adversary",hp:0,stress:0,source:"Homebrew"},xe=()=>V?d?p?"Creating...":"Saving...":"Creating...":d?p?"Save As Custom":"Save":"Create";return e.jsxs(e.Fragment,{children:[!g&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h2",{style:{color:"var(--text-primary)",fontSize:"1.5rem",fontWeight:"600",margin:0},children:d?p?"Edit Adversary (Save As Custom)":"Edit Custom Adversary":"Create Custom Adversary"}),e.jsx("button",{onClick:te,disabled:V||!T.name.trim(),style:{padding:"0.75rem 1.5rem",backgroundColor:V||!T.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"8px",cursor:V||!T.name.trim()?"not-allowed":"pointer",fontSize:"1rem",fontWeight:"600",opacity:V||!T.name.trim()?.6:1},children:xe()})]}),g&&!E&&e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",marginBottom:"0.5rem",padding:"0.5rem",borderBottom:"1px solid var(--border)"},children:[e.jsx("button",{onClick:te,disabled:V||!T.name.trim(),style:{padding:"0.5rem 1rem",backgroundColor:V||!T.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"6px",cursor:V||!T.name.trim()?"not-allowed":"pointer",fontSize:"0.875rem",fontWeight:"600",opacity:V||!T.name.trim()?.6:1,marginRight:"0.5rem"},children:xe()}),w&&e.jsx("button",{onClick:w,style:{padding:"0.5rem 1rem",backgroundColor:"transparent",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"6px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600"},children:"Cancel"})]}),!d&&e.jsxs("div",{style:{marginBottom:"1rem",position:"relative"},children:[e.jsx("input",{ref:D,type:"text",value:T.name,onChange:m=>{const X=m.target.value;b(S=>({...S,name:X})),ee(X)},placeholder:"Adversary name",style:{width:"100%",padding:"0.75rem",border:"1px solid var(--border)",borderRadius:"8px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"1rem",outline:"none"}}),q&&F.length>0&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"0 0 8px 8px",borderTop:"none",maxHeight:"200px",overflowY:"auto",zIndex:1e3,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)"},children:F.map((m,X)=>{var de;const S=m.baseName||((de=m.name)==null?void 0:de.replace(/\s+\(\d+\)$/,""))||m.name;return e.jsxs("div",{onClick:()=>{b(Q=>({...Q,name:S,tier:m.tier||Q.tier,type:m.type||Q.type,difficulty:m.difficulty||Q.difficulty,thresholds:m.thresholds||Q.thresholds,hpMax:m.hpMax||Q.hpMax,stressMax:m.stressMax||Q.stressMax,atk:m.atk||Q.atk,range:m.range||Q.range,damage:m.damage||Q.damage})),Ie(!1),_(!0),D.current&&D.current.blur()},style:{padding:"0.75rem",cursor:"pointer",borderBottom:X<F.length-1?"1px solid var(--border)":"none",transition:"background-color 0.2s"},onMouseEnter:Q=>{Q.target.style.backgroundColor="var(--bg-secondary)"},onMouseLeave:Q=>{Q.target.style.backgroundColor="transparent"},onMouseDown:Q=>Q.preventDefault(),children:[e.jsx("div",{style:{fontWeight:"600"},children:S}),e.jsxs("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",marginTop:"2px"},children:[m.type," • Tier ",m.tier]})]},X)})})]}),e.jsx(st,{item:he,type:"adversary",mode:"edit",onUpdate:(m,X)=>{b(S=>({...S,...X}))}})]})});Wt.displayName="CustomAdversaryCreator";const ir=(t,o)=>{const[c,d]=h.useState("max-content"),w=h.useCallback(()=>{if(!o.current||t<=3)return"max-content";const p=o.current.offsetWidth,L=Math.floor(p/120);return L<=1?"max-content":t===4?"max-content max-content":t===5||t===6?L>=2?"max-content max-content":"max-content":t===7?L>=3?"max-content max-content max-content":L>=2?"max-content max-content":"max-content":"repeat(auto-fit, minmax(80px, max-content))"},[t,o]);return h.useEffect(()=>{const p=w();d(p);const v=new ResizeObserver(()=>{const L=w();d(L)});return o.current&&v.observe(o.current),()=>{v.disconnect()}},[w]),c},lr=({encounter:t})=>{var w,p;const o=h.useRef(null),c=((w=t.encounterItems)==null?void 0:w.length)||0,d=ir(c,o);return e.jsx("div",{ref:o,className:"saved-encounter-adversary-list",style:{flex:1,fontSize:"0.8rem",color:"var(--text-secondary)",lineHeight:"1.3",display:"grid",gridTemplateColumns:d,gap:"0.25rem 1rem",gridAutoRows:"min-content"},children:((p=t.encounterItems)==null?void 0:p.length)>0?t.encounterItems.map((v,L)=>{var E;const g=v.item.baseName||((E=v.item.name)==null?void 0:E.replace(/\s+\(\d+\)$/,""))||v.item.name;return e.jsxs("div",{style:{marginBottom:"0.125rem"},children:[v.quantity,"x ",g]},L)}):e.jsx("div",{children:"No adversaries"})})},Ze={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},rt={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1,lowerTierAdversary:1};let nt={adversaries:[]},ft={environments:[]},ht=!1;const dr=()=>{const t=JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]"),o=JSON.parse(localStorage.getItem("daggerheart-custom-environments")||"[]");return{customAdversaries:t,customEnvironments:o}},kt=async()=>{if(ht)return;let t={adversaries:[]},o={environments:[]},c={adversaries:[]},d={environments:[]};try{const v=await Ye(()=>import("./adversaries-9c8932de.js"),[]);t=(v==null?void 0:v.default)||v}catch(v){console.warn("Failed to load adversaries.json:",v)}try{const v=await Ye(()=>import("./environments-c340637c.js"),[]);o=(v==null?void 0:v.default)||v}catch(v){console.warn("Failed to load environments.json:",v)}try{const v=await Ye(()=>import("./playtest-adversaries-4a099c10.js"),[]);c=(v==null?void 0:v.default)||v}catch(v){console.warn("Failed to load playtest-adversaries.json:",v)}try{const v=await Ye(()=>import("./playtest-environments-d9cdffb6.js"),[]);d=(v==null?void 0:v.default)||v}catch(v){console.warn("Failed to load playtest-environments.json:",v)}const{customAdversaries:w,customEnvironments:p}=dr();nt={...t,adversaries:[...t.adversaries||[],...c.adversaries||[],...w]},ft={...o,environments:[...o.environments||[],...d.environments||[],...p]},ht=!0},cr=(t,o=[],c=4,d=1,w=!1)=>{const[p,v]=h.useState(""),[L,g]=h.useState([{field:"tier",direction:"asc"},{field:"name",direction:"asc"}]),[E,H]=h.useState([]),[D,T]=h.useState(!0),[b,V]=h.useState([]),[ue,P]=h.useState([]),[_,F]=h.useState(!1),[we,q]=h.useState(!1),Ie=h.useRef(null),Te=h.useRef(null);h.useEffect(()=>{(async()=>{await kt(),T(!1);let ne=[];t==="adversary"?ne=nt.adversaries||[]:t==="environment"&&(ne=ft.environments||[]),H(ne)})()},[t]);const Le=K=>{const ne=E.map(ge=>ge[K]).filter(Boolean);return[...new Set(ne)].sort((ge,Ae)=>typeof ge=="number"&&typeof Ae=="number"?ge-Ae:String(ge).localeCompare(String(Ae)))},ee=h.useCallback(async()=>{ht=!1,await kt();let K=[];t==="adversary"?w?K=(nt.adversaries||[]).filter(ne=>{var ge;return ne.source==="Homebrew"||((ge=ne.id)==null?void 0:ge.startsWith("custom-"))}):K=nt.adversaries||[]:t==="environment"&&(K=ft.environments||[]),H(K)},[t,w]);h.useEffect(()=>{ee()},[w,ee]);const te=Le("tier"),he=Le("type"),xe=h.useMemo(()=>{let K=E.filter(ne=>{var Re,Ce;const ge=ne.name.toLowerCase().includes(p.toLowerCase())||((Re=ne.type)==null?void 0:Re.toLowerCase().includes(p.toLowerCase()))||((Ce=ne.description)==null?void 0:Ce.toLowerCase().includes(p.toLowerCase())),Ae=b.length===0||(b.includes("party-tier")?ne.tier===d:b.includes(ne.tier.toString())),ze=ue.length===0||ue.includes(ne.type);return ge&&Ae&&ze});return K.sort((ne,ge)=>{for(const Ae of L){const{field:ze,direction:Re}=Ae;let Ce=ne[ze],l=ge[ze];if(ze==="tier")Ce=parseInt(Ce)||0,l=parseInt(l)||0;else if(ze==="cost"){const n=r=>{if(t!=="adversary")return 0;const a=Ze[r.type]||2;let x=0;const R=o.filter(ae=>ae.type==="adversary"&&ae.item.type==="Solo"&&ae.quantity>0).reduce((ae,be)=>ae+be.quantity,0),N=o.filter(ae=>ae.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(ae.item.type)&&ae.quantity>0).reduce((ae,be)=>ae+be.quantity,0);return r.type==="Solo"&&R===1&&(x+=2),["Bruiser","Horde","Leader","Solo"].includes(r.type)&&N===0&&(x+=1),a+x};Ce=n(ne),l=n(ge)}else if(ze==="difficulty"){const n=parseInt(Ce),r=parseInt(l);!isNaN(n)&&!isNaN(r)?(Ce=n,l=r):!isNaN(n)&&isNaN(r)?(Ce=n,l=999):isNaN(n)&&!isNaN(r)?(Ce=999,l=r):(Ce=String(Ce||"").toLowerCase(),l=String(l||"").toLowerCase())}else typeof Ce=="string"&&typeof l=="string"?(Ce=Ce.toLowerCase(),l=l.toLowerCase()):(Ce=String(Ce||"").toLowerCase(),l=String(l||"").toLowerCase());if(Re==="asc"){if(Ce>l)return 1;if(Ce<l)return-1}else{if(Ce<l)return 1;if(Ce>l)return-1}}return 0}),K},[E,p,L,b,ue,o,c,d]),m=K=>{g(ne=>{const ge=ne.findIndex(Ae=>Ae.field===K);if(ge>=0)if(ge===0){const Ae=[...ne];return Ae[0]={...Ae[0],direction:Ae[0].direction==="asc"?"desc":"asc"},Ae}else{const Ae=[...ne];return Ae.splice(ge,1)[0],[{field:K,direction:"asc"},...Ae]}else return[{field:K,direction:"asc"},...ne]})},X=K=>{V(K==="clear"?[]:K==="party-tier"?["party-tier"]:ne=>ne.includes(K)?ne.filter(ge=>ge!==K):[...ne,K])},S=K=>{P(K==="clear"?[]:ne=>ne.includes(K)?ne.filter(ge=>ge!==K):[...ne,K])},de=b.length>0,Q=ue.length>0;return h.useEffect(()=>{const K=ge=>{const Ae=ge.target.closest(".filter-dropdown"),ze=ge.target.closest(".header-filter-icon");Ae||ze||(F(!1),q(!1))},ne=ge=>{ge.key==="Escape"&&(F(!1),q(!1))};return document.addEventListener("pointerdown",K,!0),document.addEventListener("mousedown",K,!0),document.addEventListener("touchstart",K,!0),document.addEventListener("click",K,!0),document.addEventListener("keydown",ne,!0),()=>{document.removeEventListener("pointerdown",K,!0),document.removeEventListener("mousedown",K,!0),document.removeEventListener("touchstart",K,!0),document.removeEventListener("click",K,!0),document.removeEventListener("keydown",ne,!0)}},[F,q]),{searchTerm:p,setSearchTerm:v,sortFields:L,handleSort:m,filteredAndSortedData:xe,loading:D,refreshData:ee,selectedTiers:b,selectedTypes:ue,showTierDropdown:_,setShowTierDropdown:F,showTypeDropdown:we,setShowTypeDropdown:q,tierFilterRef:Ie,typeFilterRef:Te,uniqueTiers:te,uniqueTypes:he,handleTierSelect:X,handleTypeSelect:S,isTierFiltered:de,isTypeFiltered:Q,getDropdownStyle:K=>{if(!K.current)return{};const ne=K.current.getBoundingClientRect();return{position:"fixed",top:ne.bottom+4,left:ne.left-100,zIndex:99999}}}},pr=({searchTerm:t,onSearchChange:o,type:c,partyControls:d,showCustomToggle:w=!1,onToggleCustom:p,filterCustom:v=!1,onExportCustomAdversaries:L,onImportCustomAdversaries:g,autoFocus:E=!1,onClose:H=null,placeholder:D="Search"})=>{const T=h.useRef(null);return h.useEffect(()=>{E&&T.current&&setTimeout(()=>{var b;(b=T.current)==null||b.focus()},100)},[E]),e.jsxs("div",{style:oe.browserHeader,children:[e.jsx("div",{style:{display:"flex",alignItems:"center",flex:1,gap:"0.5rem"},children:e.jsx("input",{ref:T,type:"text",placeholder:D,value:t,onChange:b=>o(b.target.value),style:{...oe.searchInput,flex:1,marginRight:0}})}),d&&e.jsx("div",{style:oe.partyControls,children:d})]})},ur=({showCustomToggle:t=!1,onToggleCustom:o,filterCustom:c=!1,onExportCustomAdversaries:d,onImportCustomAdversaries:w})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)",flexShrink:0},children:[t&&e.jsxs("button",{onClick:()=>o&&o(!c),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:c?"var(--purple)":"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:c?"white":"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:p=>{c||(p.target.style.backgroundColor="var(--bg-hover)",p.target.style.borderColor="var(--purple)")},onMouseLeave:p=>{c||(p.target.style.backgroundColor="var(--bg-primary)",p.target.style.borderColor="var(--border)")},children:[e.jsx("span",{children:c?"✓":"○"}),"Custom Only"]}),e.jsxs("button",{onClick:d,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:p=>{p.target.style.backgroundColor="var(--bg-hover)",p.target.style.borderColor="var(--purple)"},onMouseLeave:p=>{p.target.style.backgroundColor="var(--bg-primary)",p.target.style.borderColor="var(--border)"},children:[e.jsx("span",{children:"↓"}),"Export"]}),e.jsxs("button",{onClick:()=>document.getElementById("import-file-input").click(),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:p=>{p.target.style.backgroundColor="var(--bg-hover)",p.target.style.borderColor="var(--purple)"},onMouseLeave:p=>{p.target.style.backgroundColor="var(--bg-primary)",p.target.style.borderColor="var(--border)"},children:[e.jsx("span",{children:"↑"}),"Import"]}),e.jsx("input",{id:"import-file-input",type:"file",accept:".csv,.json",onChange:w,style:{display:"none"}})]}),mr=({sortFields:t,onSort:o,type:c,uniqueTiers:d,uniqueTypes:w,selectedTiers:p,selectedTypes:v,showTierDropdown:L,setShowTierDropdown:g,showTypeDropdown:E,setShowTypeDropdown:H,tierFilterRef:D,typeFilterRef:T,handleTierSelect:b,handleTypeSelect:V,isTierFiltered:ue,isTypeFiltered:P,getDropdownStyle:_,costFilter:F,showCostDropdown:we,setShowCostDropdown:q,costFilterRef:Ie,handleCostFilterSelect:Te,isCostFiltered:Le})=>{const[ee,te]=h.useState(null),xe=(()=>c==="adversary"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"cost",label:"Cost",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:c==="environment"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:[])(),m=()=>{if(!we)return null;const S=[{value:"all",label:"All"},{value:"auto-grey",label:"Auto Grey"},{value:"auto-hide",label:"Auto Hide"}];return pt.createPortal(e.jsx("div",{className:"filter-dropdown",style:{...oe.filterDropdown,..._(Ie),maxHeight:"60vh",overflow:"auto"},onMouseDown:de=>de.stopPropagation(),onClick:de=>de.stopPropagation(),children:S.map(de=>{const Q=F===de.value;return e.jsxs("div",{style:{...oe.filterOption,...Q?oe.filterOptionSelected:{}},onClick:()=>Te(de.value),children:[e.jsx("span",{style:oe.checkIcon,children:Q?e.jsx(Ue,{size:16}):e.jsx(et,{size:16})}),e.jsx("span",{style:oe.filterLabel,children:de.label})]},de.value)})}),document.body)},X=(S,de,Q,me,K,ne,ge,Ae)=>{if(!K)return null;const ze=()=>{(S==="tier"||S==="type")&&me("clear")};return pt.createPortal(e.jsxs("div",{className:"filter-dropdown",style:{...oe.filterDropdown,..._(ge),maxHeight:"60vh",overflow:"auto"},onMouseDown:Re=>Re.stopPropagation(),onClick:Re=>Re.stopPropagation(),children:[e.jsxs("div",{style:{...oe.filterOption,...Q.length===0?oe.filterOptionSelected:{}},onClick:ze,children:[e.jsx("span",{style:oe.checkIcon,children:Q.length===0?e.jsx(Ue,{size:16}):e.jsx(et,{size:16})}),e.jsx("span",{style:oe.filterLabel,children:"All"})]}),S==="tier"&&e.jsxs("div",{style:{...oe.filterOption,...Q.includes("party-tier")?oe.filterOptionSelected:{}},onClick:()=>me("party-tier"),children:[e.jsx("span",{style:oe.checkIcon,children:Q.includes("party-tier")?e.jsx(Ue,{size:16}):e.jsx(et,{size:16})}),e.jsx("span",{style:oe.filterLabel,children:"Party Tier"})]}),de.map(Re=>{const Ce=Q.includes(Re.toString());return e.jsxs("div",{style:{...oe.filterOption,...Ce?oe.filterOptionSelected:{}},onClick:()=>me(Re.toString()),children:[e.jsx("span",{style:oe.checkIcon,children:Ce?e.jsx(Ue,{size:16}):e.jsx(et,{size:16})}),e.jsx("span",{style:oe.filterLabel,children:Re})]},Re)})]}),document.body)};return e.jsx("tr",{style:oe.tableHeader,children:xe.map(S=>e.jsxs("th",{style:{...oe.tableHeaderCell,...ee===S.key?oe.tableHeaderCellHover:{},position:"relative",...S.key==="name"?{width:"auto",minWidth:"0"}:{},...S.key==="tier"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...S.key==="type"?{width:"80px",minWidth:"80px",maxWidth:"80px"}:{},...S.key==="difficulty"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...S.key==="cost"?{width:"50px",minWidth:"50px",maxWidth:"50px"}:{},...S.key==="action"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{}},onClick:()=>o(S.key),onMouseEnter:()=>te(S.key),onMouseLeave:()=>te(null),children:[S.hasFilter?e.jsxs("div",{style:oe.headerWithFilter,children:[e.jsx("span",{style:{cursor:"pointer"},onClick:de=>{de.stopPropagation(),o(S.key)},children:S.label}),e.jsxs("button",{ref:S.key==="tier"?D:S.key==="type"?T:Ie,style:{...oe.headerFilterIcon,...S.key==="tier"&&ue?oe.headerFilterIconActive:{},...S.key==="type"&&P?oe.headerFilterIconActive:{},...S.key==="cost"&&Le?oe.headerFilterIconActive:{}},className:"header-filter-icon",onClick:de=>{de.stopPropagation(),S.key==="tier"?(g(!L),H(!1),q(!1)):S.key==="type"?(H(!E),g(!1),q(!1)):S.key==="cost"&&(q(!we),g(!1),H(!1))},children:[e.jsx(Vt,{size:14}),S.key==="tier"&&ue||S.key==="type"&&P||S.key==="cost"&&Le?e.jsx("span",{style:oe.filterActiveDot}):null]})]}):S.label,S.key==="tier"&&X("tier",d,p,b,L,g,D),S.key==="type"&&X("type",w,v,V,E,H,T),S.key==="cost"&&m()]},S.key))})},fr=({item:t,onAdd:o,type:c,onRowClick:d,encounterItems:w=[],pcCount:p=4,playerTier:v=1,remainingBudget:L=0,costFilter:g="auto-grey",onAdversaryClick:E})=>{const[H,D]=h.useState(!1),T=()=>{o(t)},b=()=>{if(c!=="adversary")return null;const P=Ze[t.type]||2;let _=0;const F=w.filter(q=>q.type==="adversary"&&q.item.type==="Solo"&&q.quantity>0).reduce((q,Ie)=>q+Ie.quantity,0),we=w.filter(q=>q.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(q.item.type)&&q.quantity>0).reduce((q,Ie)=>q+Ie.quantity,0);return t.type==="Solo"&&F===1&&(_+=2),["Bruiser","Horde","Leader","Solo"].includes(t.type)&&we===0&&(_+=1),P+_},ue=(()=>{if(c==="adversary"){const P=b();Ze[t.type];const _=P>L||L<=0;if(g==="auto-hide"&&_)return null;const F=g==="auto-grey"&&_?{opacity:.5,color:"var(--text-secondary)"}:{};return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...oe.rowCell,width:"auto",minWidth:"0",textAlign:"left",...F},children:e.jsxs("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:[e.jsx("div",{style:{fontWeight:"600"},children:t.name}),t.description&&e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"0.125rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.description})]})}),e.jsx("td",{style:{...oe.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...F},children:t.tier}),e.jsx("td",{style:{...oe.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center",...F},children:t.type}),e.jsx("td",{style:{...oe.rowCell,width:"50px",minWidth:"50px",maxWidth:"50px",textAlign:"center",...F},children:P}),e.jsx("td",{style:{...oe.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...F},children:t.difficulty})]})}else if(c==="environment")return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...oe.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:t.name}),e.jsx("td",{style:{...oe.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:t.tier}),e.jsx("td",{style:{...oe.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:t.type}),e.jsx("td",{style:{...oe.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:t.difficulty})]});return null})();return ue===null?null:e.jsx(e.Fragment,{children:e.jsxs("tr",{style:{...oe.row,...H?oe.rowHover:{}},onClick:()=>{c==="adversary"&&E?E(t):d&&d(t,c)},onMouseEnter:()=>D(!0),onMouseLeave:()=>D(!1),children:[ue,e.jsx("td",{style:{width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",boxSizing:"border-box",overflow:"visible",textOverflow:"unset",whiteSpace:"nowrap"},children:e.jsx("button",{style:oe.addButton,onClick:P=>{P.stopPropagation(),T()},onMouseEnter:P=>{P.target.style.background="var(--bg-secondary)"},onMouseLeave:P=>{P.target.style.background="var(--purple)"},children:"+"})})]})})},Lt=({type:t,onAddItem:o,onCancel:c=null,onRowClick:d,encounterItems:w=[],pcCount:p=4,playerTier:v=1,partyControls:L=null,showContainer:g=!0,savedEncounters:E=[],onLoadEncounter:H,onDeleteEncounter:D,activeTab:T="adversaries",selectedCustomAdversaryId:b,onSelectCustomAdversary:V,onTabChange:ue,selectedAdversary:P,onSelectAdversary:_,filterCustom:F=!1,showCustomToggle:we=!1,onToggleCustom:q,onExportCustomAdversaries:Ie,onImportCustomAdversaries:Te,autoFocus:Le=!1,hideImportExport:ee=!1,onClose:te=null,searchPlaceholder:he="Search"})=>{const{addCustomAdversary:xe,updateCustomAdversary:m,customContent:X}=xt(),[S,de]=h.useState(null),[Q,me]=h.useState("all"),[K,ne]=h.useState(!1),[ge,Ae]=h.useState({}),ze=h.useRef({}),Re=h.useRef(null),Ce=()=>{try{const C=X.adversaries||[];if(C.length===0){alert("No custom adversaries to export.");return}const se=["name","tier","type","difficulty","threshold_major","threshold_severe","hp_max","stress_max","atk","weapon","range","damage","description","motives"],Se=C.map(re=>{var B,A;return[re.name||"",re.tier||"",re.type||"",re.difficulty||"",((B=re.thresholds)==null?void 0:B.major)||"",((A=re.thresholds)==null?void 0:A.severe)||"",re.hpMax||"",re.stressMax||"",re.atk||"",re.weapon||"",re.range||"",re.damage||"",re.description||"",re.motives||""]}),We=re=>{const B=String(re);return B.includes(",")||B.includes('"')||B.includes(`
`)?`"${B.replace(/"/g,'""')}"`:B},f=[se.join(","),...Se.map(re=>re.map(We).join(","))].join(`
`),u=new Blob([f],{type:"text/csv;charset=utf-8;"}),$=URL.createObjectURL(u),z=document.createElement("a");z.href=$,z.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(z),z.click(),document.body.removeChild(z),URL.revokeObjectURL($),console.log(`Exported ${C.length} custom adversaries to CSV`)}catch(C){console.error("Failed to export custom adversaries:",C),alert("Failed to export custom adversaries. Please try again.")}},l=C=>{const se=C.target.files[0];if(!se)return;const Se=se.name.endsWith(".csv"),We=se.name.endsWith(".json");if(!Se&&!We){alert("Please upload a CSV or JSON file."),C.target.value="";return}const f=new FileReader;f.onload=u=>{try{let $=[];if(Se){const W=u.target.result.split(`
`).filter(ve=>ve.trim());if(W.length<2)throw new Error("CSV file is empty or invalid.");const J=W[0].split(",").map(ve=>ve.trim().replace(/^"|"$/g,""));for(let ve=1;ve<W.length;ve++){const je=[];let Ne="",Pe=!1;for(let Oe=0;Oe<W[ve].length;Oe++){const De=W[ve][Oe],Fe=W[ve][Oe+1];De==='"'&&Pe&&Fe==='"'?(Ne+='"',Oe++):De==='"'?Pe=!Pe:De===","&&!Pe?(je.push(Ne.trim()),Ne=""):Ne+=De}je.push(Ne.trim());const Be={name:je[J.indexOf("name")]||"",tier:parseInt(je[J.indexOf("tier")])||1,type:je[J.indexOf("type")]||"Standard",difficulty:parseInt(je[J.indexOf("difficulty")])||11,thresholds:{major:parseInt(je[J.indexOf("threshold_major")])||7,severe:parseInt(je[J.indexOf("threshold_severe")])||12},hpMax:parseInt(je[J.indexOf("hp_max")])||3,stressMax:parseInt(je[J.indexOf("stress_max")])||1,atk:parseInt(je[J.indexOf("atk")])||1,weapon:je[J.indexOf("weapon")]||"",range:je[J.indexOf("range")]||"Melee",damage:je[J.indexOf("damage")]||"",description:je[J.indexOf("description")]||"",motives:je[J.indexOf("motives")]||"",source:"Homebrew"};Be.name&&$.push(Be)}}else if(We){const G=JSON.parse(u.target.result);if(!G.customAdversaries||!Array.isArray(G.customAdversaries))throw new Error("Invalid JSON format. Expected customAdversaries array.");$=G.customAdversaries}const z=X.adversaries||[],re=[...z];let B=0,A=0;$.forEach(G=>{if(z.some(J=>J.name===G.name&&J.source===G.source))A++;else{const J={...G,id:`custom-adv-${Date.now()}-${Math.random().toString(36).slice(2,10)}`,hp:0,stress:0};re.push(J),B++}}),B>0?(localStorage.setItem("daggerheart-custom-adversaries",JSON.stringify(re)),window.location.reload(),alert(`Import successful! Added ${B} new adversaries${A>0?`, skipped ${A} duplicates`:""}.`)):alert("No new adversaries were added. All imported adversaries already exist.")}catch($){console.error("Failed to import custom adversaries:",$),alert(`Failed to import custom adversaries: ${$.message}`)}},f.readAsText(se),C.target.value=""},n=()=>{de(null)},r=async(C,se)=>{se?m(se,C):xe(C)},a=C=>{ge[C]?(D&&D(C),Ae(se=>{const Se={...se};return delete Se[C],Se}),ze.current[C]&&(clearTimeout(ze.current[C]),delete ze.current[C])):(Ae(se=>({...se,[C]:!0})),ze.current[C]&&clearTimeout(ze.current[C]),ze.current[C]=setTimeout(()=>{Ae(se=>{const Se={...se};return delete Se[C],Se}),delete ze.current[C]},3e3))};h.useEffect(()=>()=>{Object.values(ze.current).forEach(C=>{clearTimeout(C)})},[]);const{searchTerm:x,setSearchTerm:R,sortFields:N,handleSort:ae,filteredAndSortedData:be,loading:Me,selectedTiers:s,selectedTypes:j,showTierDropdown:i,setShowTierDropdown:k,showTypeDropdown:Z,setShowTypeDropdown:I,tierFilterRef:U,typeFilterRef:ce,uniqueTiers:Ee,uniqueTypes:ye,handleTierSelect:y,handleTypeSelect:M,isTierFiltered:O,isTypeFiltered:ie,getDropdownStyle:Y}=cr(t,w,p,v,F),pe=(()=>{const C=3*p+2,se=w.reduce((B,A)=>{if(A.type==="adversary"){const G=Ze[A.item.type]||2;if(A.item.type==="Minion"){const W=Math.ceil(A.quantity/p);return B+W*G}else return B+A.quantity*G}return B},0);let Se=0;w.filter(B=>B.type==="adversary"&&B.item.type==="Solo"&&B.quantity>0).reduce((B,A)=>B+A.quantity,0)>=2&&(Se+=rt.twoOrMoreSolos);const f=w.some(B=>B.type==="adversary"&&B.item.type==="Bruiser"&&B.quantity>0),u=w.some(B=>B.type==="adversary"&&B.item.type==="Horde"&&B.quantity>0),$=w.some(B=>B.type==="adversary"&&B.item.type==="Leader"&&B.quantity>0),z=w.some(B=>B.type==="adversary"&&B.item.type==="Solo"&&B.quantity>0);return!f&&!u&&!$&&!z&&(Se+=rt.noBruisersHordesLeadersSolos),C+Se-se})(),fe=C=>{me(C),ne(!1)},le=Q!=="all";return Me?e.jsx("div",{style:oe.browser,children:e.jsx("div",{style:oe.loading,children:"Loading..."})}):e.jsx(e.Fragment,{children:e.jsxs("div",{style:g?oe.browserWrapper:oe.browserWrapperNoContainer,children:[T==="adversaries"&&e.jsxs(e.Fragment,{children:[e.jsx(pr,{searchTerm:x,onSearchChange:R,type:t,partyControls:L,autoFocus:Le,onClose:te,placeholder:he}),!ee&&e.jsx(ur,{showCustomToggle:we,onToggleCustom:q,filterCustom:F,onExportCustomAdversaries:Ce,onImportCustomAdversaries:l}),e.jsx("div",{className:"browser-content invisible-scrollbar",style:oe.browserContent,children:e.jsxs("table",{style:oe.browserTable,children:[e.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,backgroundColor:"var(--bg-primary)"},children:e.jsx(mr,{sortFields:N,onSort:ae,type:t,uniqueTiers:Ee,uniqueTypes:ye,selectedTiers:s,selectedTypes:j,showTierDropdown:i,setShowTierDropdown:k,showTypeDropdown:Z,setShowTypeDropdown:I,tierFilterRef:U,typeFilterRef:ce,handleTierSelect:y,handleTypeSelect:M,isTierFiltered:O,isTypeFiltered:ie,getDropdownStyle:Y,costFilter:Q,showCostDropdown:K,setShowCostDropdown:ne,costFilterRef:Re,handleCostFilterSelect:fe,isCostFiltered:le})}),e.jsx("tbody",{children:be.map(C=>e.jsx(fr,{item:C,onAdd:o,type:t,onRowClick:d,encounterItems:w,pcCount:p,playerTier:v,remainingBudget:pe,costFilter:Q,onAdversaryClick:se=>{t==="adversary"&&(P&&P.id===se.id?_&&_(null):_&&_(se))}},C.id))})]})})]}),T==="encounters"&&e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:E.length===0?e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",textAlign:"center",padding:"2rem 1rem"},children:"No saved encounters yet"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:E.map(C=>e.jsxs("div",{onClick:()=>H&&H(C.id),className:"saved-encounter-card",style:{border:"1px solid var(--border)",borderRadius:"8px",padding:"8px",backgroundColor:"var(--bg-card)",transition:"background-color 0.2s ease",display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsxs("div",{style:{minWidth:"100px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",flexDirection:"column",justifyContent:"center",minHeight:"60px"},children:[e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Tier: ",(()=>{var We,f,u,$;const se=(($=(u=(f=(We=C.encounterItems)==null?void 0:We.filter(z=>z.type==="adversary"))==null?void 0:f.map(z=>z.item.tier))==null?void 0:u.filter(z=>z!=null))==null?void 0:$.sort((z,re)=>z-re))||[];if(se.length===0)return"N/A";if(se.length===1)return se[0];const Se=[...new Set(se)];return Se.length===1?Se[0]:`${Math.min(...Se)}-${Math.max(...Se)}`})()]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Party Size: ",C.partySize||4]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)"},children:["Balance: ",(()=>{const se=C.partySize||4,Se=3*se+2;let We=0;const f=C.encounterItems||[];f.filter(W=>W.type==="adversary"&&W.item.type==="Solo"&&W.quantity>0).reduce((W,J)=>W+J.quantity,0)>=2&&(We+=rt.twoOrMoreSolos);const $=f.some(W=>W.type==="adversary"&&W.item.type==="Bruiser"&&W.quantity>0),z=f.some(W=>W.type==="adversary"&&W.item.type==="Horde"&&W.quantity>0),re=f.some(W=>W.type==="adversary"&&W.item.type==="Leader"&&W.quantity>0),B=f.some(W=>W.type==="adversary"&&W.item.type==="Solo"&&W.quantity>0);!$&&!z&&!re&&!B&&(We+=rt.noBruisersHordesLeadersSolos);const A=Se+We,G=f.reduce((W,J)=>{if(J.type==="adversary"){const ve=Ze[J.item.type]||2;if(J.item.type==="Minion"){const je=Math.ceil(J.quantity/se);return W+je*ve}else return W+J.quantity*ve}return W},0);return G>A?`+${G-A}`:G===A?"0":`-${A-G}`})()]})]}),e.jsx("div",{style:{minWidth:"120px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",alignItems:"center",minHeight:"60px"},children:e.jsx("div",{style:{fontWeight:"500",color:"var(--text-primary)",fontSize:"0.9rem",wordWrap:"break-word",wordBreak:"break-word",width:"150px",maxWidth:"150px"},children:C.name})}),e.jsx(lr,{encounter:C}),e.jsx("button",{onClick:se=>{se.stopPropagation(),a(C.id)},style:{background:ge[C.id]?"var(--danger)":"var(--gray-600)",border:"none",color:"white",padding:"0.4rem 0.8rem",borderRadius:"4px",fontSize:"0.75rem",cursor:"pointer",minWidth:"60px",transition:"background-color 0.2s"},children:"Delete"})]},C.id))})}),T==="create"&&e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"1rem",display:"flex",justifyContent:"center",alignItems:"flex-start",height:"100%",minHeight:0},children:e.jsx("div",{style:{maxWidth:"600px",width:"100%",height:"auto",display:"flex",flexDirection:"column",padding:"0",overflowY:"visible",overflowX:"hidden",minHeight:0},children:e.jsx(Wt,{onSave:r,onRefresh:()=>{},onAddItem:o,editingAdversary:S,onCancelEdit:n,embedded:!1})})}),T==="info"&&e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"2rem"},children:[e.jsxs("div",{style:{marginBottom:"2rem",textAlign:"center"},children:[e.jsx("img",{src:sr,alt:"Daggerheart Community Content Logo",style:{width:"100%",maxWidth:"300px",height:"auto",margin:"0 auto 1.5rem auto",display:"block"},onError:C=>{console.error("Failed to load Daggerheart logo:",C.target.src),C.target.style.display="none"}}),e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",textAlign:"left",maxWidth:"600px",margin:"0 auto"},children:[e.jsx("p",{style:{marginTop:0},children:"This product includes materials from the Daggerheart System Reference Document 1.0, © Critical Role, LLC, under the terms of the Darrington Press Community Gaming (DPCGL) License."}),e.jsxs("p",{children:["More information can be found at ",e.jsx("a",{href:"https://www.daggerheart.com",target:"_blank",rel:"noopener noreferrer",style:{color:"var(--purple)",textDecoration:"underline"},children:"daggerheart.com"})]}),e.jsx("p",{style:{marginBottom:0},children:e.jsx("em",{children:"This project is unofficial and not endorsed by Darrington Press or Critical Role."})})]})]}),e.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto",border:"1px solid var(--border)",borderRadius:"8px",overflow:"hidden"},children:[e.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"1rem 1.5rem",color:"var(--text-primary)",border:"none",background:"var(--bg-secondary)",width:"100%",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"0.875rem",borderBottom:"1px solid var(--border)"},onMouseEnter:C=>{C.target.style.backgroundColor="var(--bg-hover)"},onMouseLeave:C=>{C.target.style.backgroundColor="var(--bg-secondary)"},onClick:C=>{C.stopPropagation(),window.open("https://github.com/Splinter714/Daggerheart","_blank")},children:[e.jsx("span",{children:"View on GitHub"}),e.jsx("span",{children:"→"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem 1.5rem",color:"var(--text-secondary)",background:"var(--bg-secondary)",fontSize:"0.875rem"},children:["Version ","0.4.4 (84e7f09)"]})]})]})]})})},oe={browserWrapper:{display:"flex",flexDirection:"column",background:"var(--bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border)",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserWrapperNoContainer:{display:"flex",flexDirection:"column",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserContent:{flex:1,overflowY:"auto",overflowX:"visible",padding:0,width:"100%",scrollbarWidth:"none",msOverflowStyle:"none",borderRadius:"0 0 8px 8px"},tableHeaderContainer:{flexShrink:0,position:"sticky",top:0,zIndex:15,backgroundColor:"var(--bg-secondary)"},browserTable:{width:"100%",minWidth:"100%",borderCollapse:"collapse",tableLayout:"fixed",background:"var(--bg-primary)",margin:0},browserHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--gray-900)",flexShrink:0,position:"sticky",top:0,zIndex:20},browserTitle:{margin:0,color:"var(--text-primary)",fontSize:"18px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"24px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",marginRight:"12px",transition:"all 0.2s ease"},partyControls:{display:"flex",alignItems:"center",gap:"12px",flexShrink:0},searchInputFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 3px rgba(139, 92, 246, 0.1)"},tableHeader:{background:"var(--gray-900)",borderBottom:"1px solid var(--border)",boxShadow:"0 1px 0 var(--border)",position:"sticky",top:"0",zIndex:10},tableHeaderCell:{backgroundColor:"var(--gray-900)",fontWeight:"700",borderBottom:"1px solid var(--border)",cursor:"pointer",userSelect:"none",minWidth:"100px",whiteSpace:"nowrap",padding:"4px 4px",color:"var(--text-primary)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",boxShadow:"0 1px 0 var(--border)",transition:"background-color 0.2s",position:"sticky",top:"0",zIndex:10},tableHeaderCellHover:{backgroundColor:"var(--bg-hover)"},sortIndicator:{fontSize:"12px",color:"var(--text-secondary)"},tableBody:{flex:1,overflowY:"auto",padding:"8px",backgroundColor:"var(--bg-primary)"},row:{height:"35px",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s ease",cursor:"pointer",backgroundColor:"var(--gray-900)"},rowHover:{backgroundColor:"var(--bg-secondary)"},expandedRow:{backgroundColor:"var(--bg-secondary)"},rowCell:{padding:"4px 4px",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid var(--border)"},rowCellName:{fontWeight:"500",minWidth:"150px"},rowCellCenter:{textAlign:"center",justifyContent:"center",minWidth:"80px"},rowActions:{width:"80px",textAlign:"center",padding:"4px 8px",borderBottom:"1px solid var(--border)"},addButton:{width:"2rem",height:"2rem",border:"1px solid var(--purple)",borderRadius:"var(--radius-sm)",background:"var(--purple)",color:"white",cursor:"pointer",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"500"},expandedContent:{padding:"0",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)"},columnName:{width:"auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",paddingLeft:"8px",textAlign:"left"},columnTier:{width:"80px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnType:{width:"100px",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},columnDifficulty:{width:"40px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnAction:{width:"32px",minWidth:"24px",maxWidth:"24px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"visible",textOverflow:"unset"},loading:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"var(--text-primary)",fontSize:"16px"},mobileBrowser:{width:"95vw",height:"90vh",maxWidth:"none"},mobileSearchInput:{fontSize:"16px"},headerWithFilter:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0px",position:"relative"},headerFilterIcon:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"2px 4px",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",position:"relative",marginLeft:"-2px"},headerFilterIconActive:{color:"var(--purple)"},filterIcon:{fontSize:"12px"},filterActiveDot:{position:"absolute",left:"50%",top:"2px",transform:"translateX(-50%)",width:"4px",height:"4px",borderRadius:"50%",background:"var(--purple)",pointerEvents:"none"},filterDropdown:{position:"fixed",background:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",zIndex:99999,marginTop:"4px",overflow:"hidden",width:"max-content",minWidth:"120px",maxWidth:"200px"},filterOption:{padding:"8px 12px",cursor:"pointer",color:"var(--text-primary)",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background-color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},filterOptionSelected:{backgroundColor:"var(--bg-hover)"},checkIcon:{width:"16px",height:"16px",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"12px"},filterLabel:{flex:1}},hr=()=>e.jsx("div",{className:"pwa-install-prompt",style:{}}),dt=({side:t="left",children:o,className:c="",style:d={}})=>{const w=t==="left",p={flex:1,minWidth:0,background:"var(--bg-primary)",overflowY:"auto",overflowX:w?"auto":"hidden",display:w?"block":"flex",flexDirection:w?"initial":"column",height:"100%",padding:w?"8px 0 8px 0":"0 8px 0 0",...d};return e.jsx("div",{className:c,style:p,children:o})},xr=t=>3*t+2,gr={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},ct={lessDifficult:-1,twoOrMoreSolos:-2,increasedDamage:-2,lowerTierAdversary:1,noBruisersHordesLeadersSolos:1,moreDangerous:2},yr=({isOpen:t,onClose:o,onAddAdversary:c,onAddAdversariesBulk:d,onAddEnvironment:w,onDeleteAdversary:p,onDeleteEnvironment:v,onDeleteCountdown:L,adversaries:g=[],environments:E=[],countdowns:H=[],savedEncounters:D=[],onSaveEncounter:T,onLoadEncounter:b,onDeleteEncounter:V})=>{const{partySize:ue,updatePartySize:P,currentEncounterName:_,updateCurrentEncounterName:F,customContent:we}=xt(),q=ue,Ie=P,[Te,Le]=h.useState({lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),[ee,te]=h.useState([]),[he,xe]=h.useState(_||"Encounter"),[m,X]=h.useState("adversaries"),[S,de]=h.useState(null),[Q,me]=h.useState(null),[K,ne]=h.useState(null),[ge,Ae]=h.useState(null),[ze,Re]=h.useState(!1);h.useEffect(()=>{t&&!S&&xe(_||"Encounter")},[t,S,_]);const Ce=()=>Q?he!==Q.name||JSON.stringify(ee)!==JSON.stringify(Q.encounterItems)||q!==Q.partySize||JSON.stringify(Te)!==JSON.stringify(Q.battlePointsAdjustments):!1,l=()=>{var y;if(ee.length>0||(he||"").trim()!=="Encounter")return!0;if(S&&Ce()){if(Q){const M=ee.length,O=((y=Q.encounterItems)==null?void 0:y.length)||0;if(M!==O||(he||"").trim()!==(Q.name||""))return!0;const ie=JSON.stringify(Te),Y=JSON.stringify(Q.battlePointsAdjustments||{});return ie!==Y}return!0}return!1},n=({onClick:y,children:M,variant:O="secondary",isConfirmation:ie=!1})=>{const Y=O==="danger"||O==="secondary"&&ie,ke=O==="purple";return e.jsx("button",{onClick:y,style:{background:Y?"var(--danger)":ke?"var(--purple)":"var(--bg-secondary)",border:ke?"none":"1px solid var(--border)",color:Y||ke?"white":"var(--text-primary)",padding:"0.375rem 0.75rem",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s",width:"70px",fontSize:"0.875rem"},children:M})},r=Ge.useRef(q),a=h.useCallback(y=>!y||y.length===0?null:D.find(O=>{var pe,fe;if(((pe=O.encounterItems)==null?void 0:pe.length)!==y.length)return!1;const ie=le=>{var C;return{type:le.type,quantity:le.quantity,item:{name:le.item.baseName||((C=le.item.name)==null?void 0:C.replace(/\s+\(\d+\)$/,""))||le.item.name,type:le.item.type,tier:le.item.tier}}},Y=(fe=O.encounterItems)==null?void 0:fe.map(ie).sort((le,C)=>le.item.name.localeCompare(C.item.name)||le.item.type.localeCompare(C.item.type)),ke=y.map(ie).sort((le,C)=>le.item.name.localeCompare(C.item.name)||le.item.type.localeCompare(C.item.type));return JSON.stringify(Y)===JSON.stringify(ke)})||null,[D]);Ge.useEffect(()=>{if(t&&g.length>0&&ee.length===0){const y={};g.forEach(ie=>{var ke;const Y=ie.baseName||((ke=ie.name)==null?void 0:ke.replace(/\s+\(\d+\)$/,""))||ie.name;y[Y]||(y[Y]={type:"adversary",item:ie,quantity:0}),y[Y].quantity+=1});const M=Object.values(y);te(M);const O=a(M);O&&!S&&(de(O.id),me({name:O.name||"",encounterItems:O.encounterItems||[],partySize:O.partySize||4,battlePointsAdjustments:O.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),xe(O.name||"Encounter"),F(O.name||"Encounter"))}else t&&g.length===0&&ee.length===0&&te([])},[t,a,S,F]);const x=Ge.useMemo(()=>{let y=0;ee.filter(pe=>pe.type==="adversary"&&pe.item.type==="Solo"&&pe.quantity>0).reduce((pe,fe)=>pe+fe.quantity,0)>=2&&(y+=ct.twoOrMoreSolos);const O=ee.some(pe=>pe.type==="adversary"&&pe.item.type==="Bruiser"&&pe.quantity>0),ie=ee.some(pe=>pe.type==="adversary"&&pe.item.type==="Horde"&&pe.quantity>0),Y=ee.some(pe=>pe.type==="adversary"&&pe.item.type==="Leader"&&pe.quantity>0),ke=ee.some(pe=>pe.type==="adversary"&&pe.item.type==="Solo"&&pe.quantity>0);return!O&&!ie&&!Y&&!ke&&(y+=ct.noBruisersHordesLeadersSolos),y},[ee]),R=xr(q),N=Object.entries(Te).filter(([y,M])=>M).reduce((y,[M,O])=>y+ct[M],0),ae=R+N+x,be=ee.reduce((y,M)=>{if(M.type==="adversary"){const O=gr[M.item.type]||2;return M.item.type==="Minion"?y+Math.ceil(M.quantity/q)*O:y+O*M.quantity}return y},0);Ge.useEffect(()=>{const y=r.current;y!==q&&(te(M=>M.map(O=>{if(O.type==="adversary"&&O.item.type==="Minion"){const Y=Math.ceil(O.quantity/y)*q;return{...O,quantity:Y}}return O})),r.current=q)},[q]);const Me=(y,M)=>{const O=ee.findIndex(ke=>ke.item.id===y.id&&ke.type===M),ie=y.type==="Minion"?q:1;let Y;O>=0?Y=ee.map((ke,pe)=>pe===O?{...ke,quantity:ke.quantity+ie}:ke):Y=[...ee,{item:y,type:M,quantity:ie}],te(Y),s(Y)},s=y=>{const M=g||[],O=[];y.forEach(fe=>{for(let le=0;le<fe.quantity;le++)fe.type==="adversary"&&O.push(fe.item)});const ie={};M.forEach(fe=>{var C;const le=fe.baseName||((C=fe.name)==null?void 0:C.replace(/\s+\(\d+\)$/,""))||fe.name;ie[le]||(ie[le]=[]),ie[le].push(fe)});const Y={};O.forEach(fe=>{var C;const le=fe.baseName||((C=fe.name)==null?void 0:C.replace(/\s+\(\d+\)$/,""))||fe.name;Y[le]||(Y[le]=[]),Y[le].push(fe)});const ke=[],pe=[];Object.keys(Y).forEach(fe=>{var se;const le=((se=ie[fe])==null?void 0:se.length)||0,C=Y[fe].length;if(C>le){const Se=C-le;for(let We=0;We<Se;We++)ke.push(Y[fe][0])}else if(C<le){const Se=le-C,f=[...ie[fe]].sort((u,$)=>{const z=u.duplicateNumber||1;return($.duplicateNumber||1)-z});for(let u=0;u<Se;u++)pe.push(f[u].id)}}),Object.keys(ie).forEach(fe=>{Y[fe]||[...ie[fe]].sort((se,Se)=>{const We=se.duplicateNumber||1;return(Se.duplicateNumber||1)-We}).forEach(se=>{pe.push(se.id)})}),pe.forEach(fe=>{p(fe)}),ke.length>0&&d(ke)},j=(y,M)=>{const O=(()=>{const ie=ee.findIndex(Y=>Y.item.id===y&&Y.type===M);if(ie>=0){const Y=ee[ie];if(Y.quantity===0)return ee.filter((fe,le)=>le!==ie);const ke=Y.item.type==="Minion"?q:1,pe=Math.max(0,Y.quantity-ke);return ee.map((fe,le)=>le===ie?{...fe,quantity:pe}:fe)}return ee})();te(O),s(O)},i=h.useCallback(()=>{if(ee.length===0)return null;const y=(he||"").trim()||"Encounter",M=D.find(O=>{var ke,pe;if(O.name!==y||((ke=O.encounterItems)==null?void 0:ke.length)!==ee.length)return!1;const ie=JSON.stringify((pe=O.encounterItems)==null?void 0:pe.sort()),Y=JSON.stringify([...ee].sort());return ie===Y});return(M==null?void 0:M.id)||null},[D,he,ee]),k=h.useCallback(()=>{let y=(he||"").trim(),M=S;if(M||(M=i()),ee.length===0&&(!y||y==="Encounter")&&M){V(M),de(null),me(null);return}const O={name:y,encounterItems:ee,partySize:q,battlePointsAdjustments:Te};if(M){O.id=M;const ie=T(O);de(ie)}else{const ie=T(O);de(ie)}me({name:y,encounterItems:ee,partySize:q,battlePointsAdjustments:Te})},[ee,he,q,Te,S,T,i,V]);h.useEffect(()=>{if(S&&Ce()){const y=setTimeout(()=>{k()},2e3);return()=>clearTimeout(y)}else if(!S&&ee.length>0&&he&&he.trim()!==""){const y=setTimeout(()=>{k()},2e3);return()=>clearTimeout(y)}},[ee,S,he,Te,q]);const Z=()=>{l()&&(te([]),xe("Encounter"),F("Encounter"),de(null),me(null),g.forEach(y=>{p(y.id)}),E.forEach(y=>{v(y.id)}),H.forEach(y=>{L(y.id)}))},I=y=>{const M=b(y);if(M){const O=M.encounterItems||[];te(O),Ie(M.partySize||4),Le(M.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),xe(M.name||""),F(M.name||""),de(y),me({name:M.name||"",encounterItems:M.encounterItems||[],partySize:M.partySize||4,battlePointsAdjustments:M.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),s(O)}},U=y=>{V(y),S===y&&(te([]),xe("Encounter"),F("Encounter"),de(null),me(null),g.forEach(M=>{p(M.id)}),E.forEach(M=>{v(M.id)}),H.forEach(M=>{L(M.id)}))},ce=()=>{try{const y={version:"1.0",exportDate:new Date().toISOString(),customAdversaries:we.adversaries||[]},M=JSON.stringify(y,null,2),O=new Blob([M],{type:"application/json"}),ie=URL.createObjectURL(O),Y=document.createElement("a");Y.href=ie,Y.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(Y),Y.click(),document.body.removeChild(Y),URL.revokeObjectURL(ie),console.log("Custom adversaries exported successfully")}catch(y){console.error("Failed to export custom adversaries:",y),alert("Failed to export custom adversaries. Please try again.")}},Ee=y=>{const M=y.target.files[0];if(!M)return;const O=new FileReader;O.onload=ie=>{try{const Y=JSON.parse(ie.target.result);if(!Y.customAdversaries||!Array.isArray(Y.customAdversaries))throw new Error("Invalid file format. Expected customAdversaries array.");const ke=we.adversaries||[],pe=Y.customAdversaries,fe=[...ke];let le=0;pe.forEach(C=>{ke.some(Se=>Se.name===C.name&&Se.type===C.type)||(fe.push({...C,id:`custom-${Date.now()}-${Math.random().toString(36).slice(2,10)}`}),le++)}),updateCustomContent("adversary",null,fe),le>0?alert(`Successfully imported ${le} custom adversaries.`):alert("No new adversaries were added. All imported adversaries already exist.")}catch(Y){console.error("Failed to import custom adversaries:",Y),alert("Failed to import custom adversaries. Please check the file format and try again.")}},O.readAsText(M),y.target.value=""};if(!t)return null;const ye=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://");return e.jsx("div",{onClick:o,className:"encounter-builder-modal",style:{position:"fixed",top:0,left:0,right:0,bottom:ye?"calc(60px + env(safe-area-inset-bottom) + 1rem)":"calc(60px + env(safe-area-inset-bottom))",backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:1e3,display:"flex",alignItems:"flex-start",justifyContent:"center",padding:"12px"},children:e.jsxs("div",{onClick:y=>y.stopPropagation(),style:{backgroundColor:"var(--bg-primary)",border:"2px solid var(--border)",borderRadius:"12px",width:"100%",maxWidth:"1200px",height:"100%",maxHeight:"100%",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"},children:[e.jsxs("div",{className:"encounter-top-bar",style:{flex:"0 0 auto",display:"flex",alignItems:"center",height:"39px",backgroundColor:"var(--bg-primary)",borderBottom:"1px solid var(--border)"},children:[e.jsx("button",{onClick:()=>X("adversaries"),style:{flex:1,background:m==="adversaries"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:m==="adversaries"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Builder"}),e.jsx("button",{onClick:()=>X("encounters"),style:{flex:1,background:m==="encounters"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:m==="encounters"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Saved Encounters"}),e.jsx("button",{onClick:()=>X("create"),style:{flex:1,background:m==="create"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:m==="create"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Create Adversary"}),e.jsx("button",{onClick:()=>X("info"),style:{flex:1,background:m==="info"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:m==="info"?"500":"400",transition:"all 0.2s ease",position:"relative"},children:"Info"})]}),e.jsxs("div",{className:"encounter-builder-content",style:{flex:1,display:"flex",overflow:"hidden"},children:[e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",borderTop:"1px solid var(--border)"},children:e.jsx(Lt,{type:"adversary",onAddItem:y=>Me(y,"adversary"),encounterItems:ee,pcCount:q,showContainer:!1,savedEncounters:D,onLoadEncounter:I,onDeleteEncounter:U,activeTab:m,selectedCustomAdversaryId:K,onSelectCustomAdversary:ne,onTabChange:X,selectedAdversary:ge,onSelectAdversary:Ae,filterCustom:ze,showCustomToggle:!0,onToggleCustom:Re,onExportCustomAdversaries:ce,onImportCustomAdversaries:Ee})}),m!=="info"&&e.jsxs("div",{className:"encounter-right-panel",style:{flex:1,borderLeft:"1px solid var(--border)",display:"flex",flexDirection:"column",overflow:"hidden",position:"relative"},children:[ge&&e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"var(--bg-primary)",zIndex:10,display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)",flexShrink:0},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:0},children:"Adversary Preview"}),e.jsx("button",{onClick:()=>Ae(null),style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease"},onMouseEnter:y=>y.target.style.color="var(--text-primary)",onMouseLeave:y=>y.target.style.color="var(--text-secondary)",title:"Close preview",children:e.jsx(Xe,{size:16})})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"0.75rem"},children:e.jsx(st,{item:{...ge,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...ge,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}})})]}),(m==="adversaries"||m==="encounters")&&e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-primary)",flexShrink:0},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:he,onChange:y=>{xe(y.target.value),F(y.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(n,{onClick:Z,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:l()?1:.5,cursor:l()?"pointer":"not-allowed"},children:"New"})]})}),(m==="adversaries"||m==="encounters")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"encounter-receipt-buttons-vertical",style:{display:"none",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:he,onChange:y=>{xe(y.target.value),F(y.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(n,{onClick:Z,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:l()?1:.5,cursor:l()?"pointer":"not-allowed"},children:"New"})]})}),e.jsx("div",{className:"receipt-content",style:{padding:"1rem",display:"flex",flexDirection:"column",height:"100%"},children:e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"flex-start",overflowY:"auto",marginBottom:"0.75rem"},children:[e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>Ie(Math.max(1,q-1)),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(ut,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:q}),e.jsx("button",{onClick:()=>Ie(q+1),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(Ke,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Party Size"})}),e.jsx("div",{style:{width:"120px",textAlign:"right"}})]}),ee.map(y=>{var M;return y.type!=="adversary"?null:e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>j(y.item.id,y.type),style:{background:y.quantity===0?"var(--danger)":"var(--bg-secondary)",border:y.quantity===0?"none":"1px solid var(--border)",color:y.quantity===0?"white":"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:y.quantity===0?e.jsx(Xe,{size:10}):e.jsx(ut,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:y.quantity}),e.jsx("button",{onClick:()=>Me(y.item,y.type),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(Ke,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:y.item.baseName||((M=y.item.name)==null?void 0:M.replace(/\s+\(\d+\)$/,""))||y.item.name})}),e.jsx("div",{style:{width:"80px",textAlign:"right"},children:e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.8rem"},children:y.item.type})})]},`${y.item.id}-${y.type}`)}),e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Balance"})}),e.jsx("div",{style:{width:"120px",textAlign:"right",display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsx("span",{style:{color:be>ae?"var(--danger)":be===ae?"var(--purple)":"var(--success)",fontWeight:600},children:be>ae?`+${be-ae}`:ae-be===0?"0":`-${ae-be}`})})]})]})})]}),m==="create"&&e.jsxs("div",{style:{padding:"1.5rem",overflowY:"auto",height:"100%"},children:[e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Creating Adversaries"}),e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsx("p",{children:"Use the form to create custom adversaries for your encounters."}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Adversary Types:"}),e.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Minion (1 BP):"})," Weak enemies in groups"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Standard (2 BP):"})," Average threat level"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Leader (3 BP):"})," Commands others"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Bruiser (4 BP):"})," High HP tank"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Solo (5 BP):"})," Boss-level threat"]})]})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Tips:"}),e.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[e.jsx("li",{children:"Match adversary tier to party level"}),e.jsx("li",{children:"Balance encounter difficulty with Battle Points"}),e.jsx("li",{children:"Mix adversary types for variety"}),e.jsx("li",{children:"Add features that create interesting choices"})]})]})]})]}),m==="myAdversaries"&&e.jsx("div",{style:{padding:"0.75rem",overflowY:"auto",height:"100%"},children:K?(()=>{var M;const y=(M=we==null?void 0:we.adversaries)==null?void 0:M.find(O=>O.id===K);return y?e.jsx(st,{item:{...y,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...y,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}}):e.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Adversary not found"})})():e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Adversary Preview"}),e.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Select an adversary to view details"})]})})]})]})]})})},vr=t=>3*t+2,br={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},It={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1};class wr extends Ge.Component{constructor(o){super(o),this.state={hasError:!1,error:null}}static getDerivedStateFromError(o){return{hasError:!0,error:o}}componentDidCatch(o,c){console.error("ErrorBoundary caught an error:",o,c)}render(){var o;return this.state.hasError?e.jsxs("div",{className:"p-md text-red",children:[e.jsx("h3",{children:"Something went wrong:"}),e.jsx("pre",{children:(o=this.state.error)==null?void 0:o.toString()}),e.jsx("button",{className:"btn-base btn-text",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try again"})]}):this.props.children}}const Cr=()=>{const{adversaries:t,environments:o,countdowns:c,fear:d,savedEncounters:w,partySize:p,updateFear:v,createAdversary:L,createAdversariesBulk:g,updateAdversary:E,deleteAdversary:H,createEnvironment:D,updateEnvironment:T,deleteEnvironment:b,createCountdown:V,updateCountdown:ue,deleteCountdown:P,advanceCountdown:_,saveEncounter:F,loadEncounter:we,deleteEncounter:q}=xt(),Ie=p||4,[Te,Le]=h.useState(!1),[ee,te]=h.useState(!1);h.useState(!1),h.useState(!1),h.useState(!0);const[he,xe]=h.useState(null),[m,X]=h.useState(null),[S,de]=h.useState(null),[Q,me]=h.useState(!1),[K,ne]=h.useState(0),[ge,Ae]=h.useState(0),[ze,Re]=h.useState(!1);h.useState(new Set);const[Ce,l]=h.useState(new Set),[n,r]=h.useState(null),[a,x]=h.useState(!1),R=h.useRef(null);h.useEffect(()=>{const f=()=>{const $=window.matchMedia("(max-width: 800px)");Le($.matches)};f();const u=window.matchMedia("(max-width: 800px)");return u.addEventListener("change",f),()=>u.removeEventListener("change",f)},[]);const N=12,ae=f=>f===1?200:350,be=f=>{if(f<=0)return{visibleColumns:1,columnWidth:ae(1)};const u=N*2,$=f-u;let z={visibleColumns:1,columnWidth:$};for(let B=1;B<=5;B++){const A=(B-1)*N,G=($-A)/B;G>=ae(B)&&B*G+A<=$&&(z={visibleColumns:B,columnWidth:G})}return z.visibleColumns*z.columnWidth+(z.visibleColumns-1)*N>$&&(z={visibleColumns:1,columnWidth:$}),z},{visibleColumns:Me,columnWidth:s}=be(K);h.useEffect(()=>{const f=()=>{ne(window.innerWidth)};return f(),window.addEventListener("resize",f),()=>window.removeEventListener("resize",f)},[]);const j=()=>{te(!0)},i=h.useCallback(()=>{te(!1)},[]),k=h.useCallback(f=>{let u=!1;if(R.current){const $=R.current,z=$.scrollLeft,re=$.scrollWidth-$.clientWidth;u=Math.abs(z-re)<1,u&&($._wasAtMaxScrollOnBrowserOpen=!0)}X(f)},[]);h.useEffect(()=>{m!==null&&R.current&&R.current._wasAtMaxScrollOnBrowserOpen&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(R.current){const $=R.current,z=$.scrollWidth-$.clientWidth;$.scrollLeft=z,$._wasAtMaxScrollOnBrowserOpen=!1}})})},[m,s,N]);const Z=h.useCallback(()=>{X(null)},[]),I=h.useCallback((f,u=500,$="unknown")=>{if(console.log("[HORIZONTAL_SCROLL] smoothScrollTo called:",{targetScrollLeft:f,duration:u,reason:$,timestamp:performance.now()}),!R.current){console.log("[HORIZONTAL_SCROLL] No container ref, aborting");return}const z=R.current,re=z.scrollLeft,B=f-re;if(console.log("[HORIZONTAL_SCROLL] Scroll params:",{startScrollLeft:re,targetScrollLeft:f,distance:B,containerWidth:z.clientWidth,scrollWidth:z.scrollWidth}),Math.abs(B)<1){console.log("[HORIZONTAL_SCROLL] Distance too small, skipping animation");return}z._horizontalScrollAnimationId&&(console.log("[HORIZONTAL_SCROLL] Canceling existing animation"),cancelAnimationFrame(z._horizontalScrollAnimationId),z._horizontalScrollAnimationId=null);const G=window.getComputedStyle(z).scrollSnapType!=="none",W=G?"x mandatory":null;console.log("[HORIZONTAL_SCROLL] Scroll-snap state:",{hasScrollSnap:G,originalScrollSnapType:W}),G&&(z.style.scrollSnapType="none");const J=performance.now();console.log("[HORIZONTAL_SCROLL] Starting animation at:",J);const ve=je=>{const Ne=je-J,Pe=Math.min(Ne/u,1),Be=1-Pe,Oe=1-Be*Be*Be;if(z){const De=re+B*Oe;z.scrollLeft=De}Pe<1?z._horizontalScrollAnimationId=requestAnimationFrame(ve):(console.log("[HORIZONTAL_SCROLL] Animation complete, final scrollLeft:",z.scrollLeft),z&&(z.scrollLeft=f,z._horizontalScrollAnimationId=null))};return z._horizontalScrollAnimationId=requestAnimationFrame(ve),()=>{animationId&&cancelAnimationFrame(animationId),G&&z&&(z.style.scrollSnapType=W||"")}},[]),U=h.useCallback(()=>{const f={};return t.forEach(u=>{var z;const $=u.baseName||((z=u.name)==null?void 0:z.replace(/\s+\(\d+\)$/,""))||u.name;f[$]||(f[$]={type:"adversary",baseName:$,instances:[]}),f[$].instances.push(u)}),c.forEach(u=>{f[`countdown-${u.id}`]={type:"countdown",baseName:u.name,instances:[u]}}),Object.values(f)},[t,c]),ce=U(),Ee=h.useCallback(f=>{var J,ve,je;const u=f.baseName||((J=f.name)==null?void 0:J.replace(/\s+\(\d+\)$/,""))||f.name,z=!ce.find(Ne=>Ne.baseName===u&&Ne.type==="adversary"),re=performance.now(),B=((ve=R.current)==null?void 0:ve.scrollWidth)??0,A=((je=R.current)==null?void 0:je.scrollLeft)??0,G=R.current;let W=!1;if(G&&z&&window.getComputedStyle(G).scrollSnapType!=="none"&&(G.style.scrollSnapType="none",W=!0,console.log("[ADVERSARY_ADD] Disabled scroll-snap before adding adversary to prevent auto-scroll")),console.log("[ADVERSARY_ADD] handleAddAdversaryFromBrowser called:",{baseName:u,isNewAdversary:z,timestamp:re,currentScroll:A,scrollWidth:B,scrollSnapDisabled:W}),L(f),xe("adversary"),z){const Ne=`adversary-${u}`;l(Pe=>new Set(Pe).add(Ne)),setTimeout(()=>{l(Pe=>{const Be=new Set(Pe);return Be.delete(Ne),Be})},10)}setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!R.current)return;const Ne=R.current;if(!(Ne.scrollWidth<=Ne.clientWidth))if(z){const Pe=Ne.scrollWidth;setTimeout(()=>{if(!R.current)return;const Be=R.current;if(Be.scrollWidth!==Pe)requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!R.current)return;const De=R.current,Fe=De.scrollWidth-De.clientWidth,_e=De.scrollLeft,$e=Fe-A,Qe=De.scrollWidth>B;console.log("[HORIZONTAL_SCROLL] New adversary added, scrollWidth stabilized:",{maxScroll:Fe,scrollWidth:De.scrollWidth,clientWidth:De.clientWidth,scrollWidthBeforeAdd:B,scrollLeftBeforeAdd:A,currentScroll:_e,scrollChanged:_e!==A,scrollWidthIncreased:Qe,distance:$e}),Qe&&Math.abs($e)<1?I(Fe+10,500,"new-adversary"):Math.abs($e)>1&&I(Fe,500,"new-adversary")})});else{const De=Be.scrollWidth-Be.clientWidth,Fe=Be.scrollLeft,_e=De-A,$e=Be.scrollWidth>B;console.log("[HORIZONTAL_SCROLL] New adversary added, scrollWidth stable:",{maxScroll:De,scrollWidth:Be.scrollWidth,clientWidth:Be.clientWidth,scrollWidthBeforeAdd:B,scrollLeftBeforeAdd:A,currentScroll:Fe,scrollChanged:Fe!==A,scrollWidthIncreased:$e,distance:_e}),$e&&Math.abs(_e)<1?I(De+10,500,"new-adversary"):Math.abs(_e)>1&&I(De,500,"new-adversary")}},10)}else{const Be=U().findIndex(Oe=>Oe.baseName===u&&Oe.type==="adversary");if(Be>=0){const Oe=R.current,De=Oe.scrollLeft,Fe=Oe.clientWidth,_e=m!==null?Fe-(s+N):Fe,$e=Be*(s+N),Qe=$e+s+N,gt=10;$e>=De-gt&&Qe<=De+_e+gt||I($e,500)}}})})},50)},[L,ce,s,N,I,U,m]),ye=h.useCallback(()=>{L({name:"",baseName:"",tier:1,type:"Standard",description:"",motives:"",difficulty:11,thresholds:{major:7,severe:12},hpMax:3,stressMax:1,atk:1,weapon:"",range:"Melee",damage:"",experience:[],features:[],source:"Homebrew",hp:0,stress:0,isVisible:!0}),setTimeout(()=>{const u=U();for(const $ of u)if($.type==="adversary"){const z=$.instances.find(re=>re.source==="Homebrew"&&(!re.baseName||re.baseName.trim()===""||re.baseName==="Unknown"));if(z&&!S){de(z.id),requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(R.current){R.current;const re=u.findIndex(B=>B.instances.some(A=>A.id===z.id));if(re>=0){const B=re*(s+N);I(B,600,"new-custom-adversary")}}})});break}}},100)},[L,U,s,N,I,S]),y=h.useCallback(f=>{de(f),me(!1)},[]),M=h.useCallback(()=>{de(null),me(!1)},[]),O=h.useCallback(async(f,u)=>{if(u)E(u,f),de(null);else if(S){const $=L({...f,id:void 0});return de(null),$}else{const $=L({...f,id:void 0});return me(!1),$}},[S,L,E]),Y=h.useCallback(()=>{const f={};return t.forEach(u=>{var z;const $=u.baseName||((z=u.name)==null?void 0:z.replace(/\s+\(\d+\)$/,""))||u.name;f[$]||(f[$]={type:"adversary",item:u,quantity:0}),f[$].quantity+=1}),Object.values(f)},[t])(),ke=vr(Ie),pe=Y.filter(f=>f.item.type==="Solo"&&f.quantity>0).reduce((f,u)=>f+u.quantity,0),fe=Y.some(f=>f.item.type&&["Bruiser","Horde","Leader","Solo"].includes(f.item.type)&&f.quantity>0);let le=0;pe>=2&&(le+=It.twoOrMoreSolos),fe||(le+=It.noBruisersHordesLeadersSolos);const C=ke+le,se=Y.reduce((f,u)=>{if(u.type==="adversary"){const $=br[u.item.type]||2;return u.item.type==="Minion"?f+Math.ceil(u.quantity/Ie)*$:f+$*u.quantity}return f},0),Se=h.useRef(null),We=h.useCallback(f=>{Ae(f.target.scrollLeft),Se.current&&clearTimeout(Se.current),Se.current=setTimeout(()=>{const u=f.target;u&&u.style.scrollSnapType==="none"&&(u.style.scrollSnapType="x mandatory")},150)},[]);return h.useCallback(()=>{Re(!0)},[]),h.useCallback(()=>{setTimeout(()=>Re(!1),100)},[]),ce.length,e.jsxs("div",{className:"app",onClick:f=>{f.target,f.currentTarget},children:[e.jsx(Ut,{position:"top",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",width:"100%",justifyContent:"space-between",padding:"0 1rem"},children:[e.jsx(Je,{type:"fear",value:(d==null?void 0:d.value)||0,maxValue:12,onChange:v,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0}),e.jsx("button",{onClick:()=>{m!==null?Z():k(ce.length)},title:m!==null?"Close Browser":"Add Adversaries",style:{width:"36px",height:"36px",padding:0,backgroundColor:m!==null?"var(--purple)":"transparent",border:"1px solid var(--border)",borderRadius:"50%",color:m!==null?"white":"var(--text-primary)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",flexShrink:0},onMouseEnter:f=>{m===null&&(f.target.style.borderColor="var(--purple)",f.target.style.backgroundColor="var(--bg-secondary)")},onMouseLeave:f=>{m===null&&(f.target.style.borderColor="var(--border)",f.target.style.backgroundColor="transparent")},children:e.jsx(Ke,{size:18})})]})}),e.jsxs("div",{className:"main-content",style:{position:"relative",width:"100%"},children:[m!==null&&e.jsx("div",{style:{position:"absolute",top:`${N}px`,right:`${N}px`,bottom:`${N}px`,width:`${s}px`,zIndex:100,overflow:"visible"},children:e.jsx(Tt,{tabContent:e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:ye,style:{padding:"0.375rem 0.75rem",backgroundColor:"var(--purple)",border:"none",color:"white",borderRadius:"4px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",transition:"opacity 0.2s ease"},onMouseEnter:f=>{f.target.style.opacity="0.9"},onMouseLeave:f=>{f.target.style.opacity="1"},children:[e.jsx(Ke,{size:16}),e.jsx("span",{children:"Add Custom"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:"500"},children:"Balance:"}),e.jsx("span",{style:{color:se>C?"var(--danger)":se===C?"var(--purple)":"var(--success)",fontWeight:600,fontSize:"0.875rem"},children:se>C?`+${se-C}`:C-se===0?"0":`-${C-se}`})]}),Z&&e.jsx("button",{onClick:Z,style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease",flexShrink:0},onMouseEnter:f=>f.target.style.color="var(--text-primary)",onMouseLeave:f=>f.target.style.color="var(--text-secondary)",title:"Close browser",children:e.jsx(Xe,{size:16})})]}),showTab:!0,tabBackgroundColor:"var(--bg-primary)",tabBorderColor:"var(--border)",tabJustifyContent:"space-between",containerBackgroundColor:"var(--bg-primary)",containerBorderColor:"var(--border)",containerBorderRadius:"8px",containerBoxShadow:"-4px 0 12px rgba(0, 0, 0, 0.3)",containerOverflow:"hidden",reserveTabSpace:!0,containerStyle:{height:"100%"},children:e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,display:"flex",flexDirection:"column",width:"100%",minWidth:0},children:e.jsx(Lt,{type:"adversary",onAddItem:Ee,showContainer:!1,activeTab:"adversaries",autoFocus:!0,hideImportExport:!0,onClose:Z,searchPlaceholder:"Search adversaries"})})})}),e.jsxs("div",{ref:R,className:"dashboard-scroll-container",style:{display:"flex",flexDirection:"row",overflowX:"auto",overflowY:"hidden",padding:`0 ${N}px 0 0`,scrollSnapType:"x mandatory",height:"100%",width:"100%"},onScroll:We,children:[ce.length===0?e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",width:"100%",padding:"2rem"},children:e.jsx("button",{onClick:j,style:{backgroundColor:"transparent",color:"var(--text-secondary)",border:"2px dashed var(--border)",borderRadius:"var(--radius-md)",padding:"1rem 2rem",fontSize:"1rem",fontWeight:"500",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:f=>{f.target.style.borderColor="var(--purple)",f.target.style.color="var(--purple)"},onMouseLeave:f=>{f.target.style.borderColor="var(--border)",f.target.style.color="var(--text-secondary)"},children:"Create Encounter"})}):(()=>{const f=[];if(ce.forEach((u,$)=>{var re,B;if(n&&n.baseName===u.baseName&&u.type==="adversary"){f.push(e.jsx(dt,{style:{width:a?"0px":`${s+N}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:a?"0px":`${N}px`,paddingRight:"0",paddingTop:a?"0px":`${N}px`,paddingBottom:a?"0px":`${N}px`,scrollSnapAlign:"none",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"100%",opacity:0,transition:"width 0.3s ease, padding-left 0.3s ease, padding-top 0.3s ease, padding-bottom 0.3s ease"}},`spacer-${n.baseName}`));return}f.push(e.jsx(dt,{style:{width:`${s+N}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:`${N}px`,paddingRight:"0",paddingTop:`${m!==null&&u.type==="adversary"?N+52:N}px`,paddingBottom:`${N}px`,scrollSnapAlign:"start",overflow:m!==null&&u.type==="adversary"?"visible":"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"auto",opacity:Ce.has(`${u.type}-${u.baseName}`)?0:1,transition:(Ce.has(`${u.type}-${u.baseName}`),"opacity 0.2s ease")},children:e.jsx(st,{type:u.type,item:{...u.instances[0],name:u.baseName,hp:0,stress:0,isDead:!1},mode:"expanded",instances:u.instances,showCustomCreator:u.type==="adversary"&&S&&u.instances.some(A=>A.id===S),onSaveCustomAdversary:u.type==="adversary"&&S&&u.instances.some(A=>A.id===S)?O:void 0,onCancelEdit:u.type==="adversary"&&S&&u.instances.some(A=>A.id===S)?M:void 0,isStockAdversary:u.type==="adversary"&&S&&u.instances.some(A=>A.id===S)?!((re=u.instances[0])!=null&&re.source)||((B=u.instances[0])==null?void 0:B.source)!=="Homebrew":!1,onApplyDamage:u.type==="adversary"?(A,G,W,J)=>{const ve=u.instances.find(je=>je.id===A);ve&&E(A,{hp:Math.min(ve.hpMax||1,(ve.hp||0)+G)})}:void 0,onApplyHealing:u.type==="adversary"?(A,G,W)=>{const J=u.instances.find(ve=>ve.id===A);J&&E(A,{hp:Math.max(0,(J.hp||0)-G)})}:void 0,onApplyStressChange:u.type==="adversary"?(A,G)=>{var W,J;return E(A,{stress:Math.max(0,Math.min(((W=u.instances.find(ve=>ve.id===A))==null?void 0:W.stressMax)||6,(((J=u.instances.find(ve=>ve.id===A))==null?void 0:J.stress)||0)+G))})}:void 0,onUpdate:u.type==="adversary"?E:u.type==="environment"?T:ue,adversaries:t,showAddRemoveButtons:m!==null&&u.type==="adversary",onEdit:u.type==="adversary"?A=>y(A):void 0,onAddInstance:u.type==="adversary"?A=>{L(A),setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(R.current){const G=R.current,W=G.scrollLeft,J=G.clientWidth,ve=m!==null?J-(s+N):J,Ne=U().findIndex(Pe=>Pe.baseName===u.baseName&&Pe.type==="adversary");if(Ne>=0){const Pe=Ne*(s+N),Be=Pe+s+N,Oe=10;Pe>=W-Oe&&Be<=W+ve+Oe||I(Pe,500)}}})})},50)}:void 0,onRemoveInstance:u.type==="adversary"?A=>{const G=u.instances.length===1;ce.length>0&&(ce[ce.length-1].baseName,u.baseName),`${u.type}${u.baseName}`;const W=u.instances.sort((J,ve)=>{const je=J.duplicateNumber||1;return(ve.duplicateNumber||1)-je});if(W.length>0){const J=W[0];if(G){const ve=ce.findIndex(je=>je.baseName===u.baseName&&je.type==="adversary");r({baseName:u.baseName,groupIndex:ve}),x(!1),requestAnimationFrame(()=>{requestAnimationFrame(()=>{H(J.id),requestAnimationFrame(()=>{requestAnimationFrame(()=>{x(!0),setTimeout(()=>{r(null),x(!1)},300)})})})})}else H(J.id)}}:void 0})},`${u.type}-${u.baseName}`))}),n&&!f.some(u=>(u==null?void 0:u.key)===`spacer-${n.baseName}`)){const u=Math.min(n.groupIndex,f.length);f.splice(u,0,e.jsx(dt,{style:{width:a?"0px":`${s+N}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:a?"0px":`${N}px`,paddingRight:"0",paddingTop:a?"0px":`${N}px`,paddingBottom:a?"0px":`${N}px`,scrollSnapAlign:"none",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"100%",opacity:0,transition:"width 0.3s ease, padding-left 0.3s ease, padding-top 0.3s ease, padding-bottom 0.3s ease"}},`spacer-${n.baseName}`))}return f})(),m!==null&&e.jsx("div",{style:{width:`${s+N}px`,flexShrink:0,flexGrow:0,flex:"none",height:"100%"}})]})]}),e.jsx(yr,{isOpen:ee,onClose:i,onAddAdversary:f=>{L(f),xe("adversary")},onAddAdversariesBulk:f=>{g(f),xe("adversary")},onAddEnvironment:f=>{D(f),xe("environment")},onDeleteAdversary:H,onDeleteEnvironment:b,onDeleteCountdown:P,adversaries:t,environments:o,countdowns:c,savedEncounters:w,onSaveEncounter:F,onLoadEncounter:we,onDeleteEncounter:q}),e.jsx(hr,{})]})},Sr=()=>e.jsx(wr,{children:e.jsx(Cr,{})});mt.createRoot(document.getElementById("root")).render(e.jsx(Ge.StrictMode,{children:e.jsx(Qt,{children:e.jsx(Sr,{})})}));
