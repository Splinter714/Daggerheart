import{r as h,a as Ae,R as he}from"./dndkit-57209f9c.js";import{F as Ge,f as Xe,a as Ye,b as Je,c as Ne}from"./fa-b4bcccb0.js";import{D as xe,A as He,C as Ue,T as Ke,S as Qe,M as Ze,X as Te,E as et,H as tt,L as rt,a as nt,F as st,b as ve,c as be,d as Be,P as Re}from"./lucide-c371f2a3.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))y(f);new MutationObserver(f=>{for(const c of f)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&y(a)}).observe(document,{childList:!0,subtree:!0});function x(f){const c={};return f.integrity&&(c.integrity=f.integrity),f.referrerPolicy&&(c.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?c.credentials="include":f.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function y(f){if(f.ep)return;f.ep=!0;const c=x(f);fetch(f.href,c)}})();var Fe={exports:{}},Ce={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ot=h,it=Symbol.for("react.element"),at=Symbol.for("react.fragment"),lt=Object.prototype.hasOwnProperty,dt=ot.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ct={key:!0,ref:!0,__self:!0,__source:!0};function $e(t,r,x){var y,f={},c=null,a=null;x!==void 0&&(c=""+x),r.key!==void 0&&(c=""+r.key),r.ref!==void 0&&(a=r.ref);for(y in r)lt.call(r,y)&&!ct.hasOwnProperty(y)&&(f[y]=r[y]);if(t&&t.defaultProps)for(y in r=t.defaultProps,r)f[y]===void 0&&(f[y]=r[y]);return{$$typeof:it,type:t,key:c,ref:a,props:f,_owner:dt.current}}Ce.Fragment=at;Ce.jsx=$e;Ce.jsxs=$e;Fe.exports=Ce;var e=Fe.exports,Ie={},Le=Ae;Ie.createRoot=Le.createRoot,Ie.hydrateRoot=Le.hydrateRoot;function me(t){const r=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return t?`${t}-${r}`:r}const qe=h.createContext();function ke(t){if(typeof localStorage>"u")return null;try{const r=localStorage.getItem(t);return r==null?null:JSON.parse(r)}catch{return null}}function fe(t,r){if(!(typeof localStorage>"u"))try{localStorage.setItem(t,JSON.stringify(r))}catch{}}const pt=({children:t})=>{const[r,x]=h.useState({fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[]}),[y,f]=h.useState(!1),[c,a]=h.useState({adversaries:[],environments:[]});h.useEffect(()=>{var o,n,F,W;const s=ke("daggerheart-game-state");if(s)try{(((o=s.adversaries)==null?void 0:o.length)>0||((n=s.environments)==null?void 0:n.length)>0||((F=s.countdowns)==null?void 0:F.length)>0||((W=s.savedEncounters)==null?void 0:W.length)>0)&&x(s)}catch(K){console.error("Failed to load saved state:",K)}const l=ke("daggerheart-custom-adversaries")||[],p=ke("daggerheart-custom-environments")||[];a({adversaries:l,environments:p}),f(!0)},[]),h.useEffect(()=>{fe("daggerheart-game-state",r)},[r]);const j=s=>{x(l=>({...l,fear:{...l.fear,value:s}}))},v=()=>{x(s=>({...s,fear:{...s.fear,visible:!s.fear.visible}}))},B=s=>{x(l=>({...l,partySize:Math.max(1,s)}))},A=s=>{if(s.id)return x(l=>({...l,savedEncounters:(l.savedEncounters||[]).map(p=>p.id===s.id?{...p,name:s.name||p.name,encounterItems:s.encounterItems||p.encounterItems,partySize:s.partySize||p.partySize,battlePointsAdjustments:s.battlePointsAdjustments||p.battlePointsAdjustments,updatedAt:new Date().toISOString()}:p)})),s.id;{const l={id:me("encounter"),name:s.name||`Encounter ${Date.now()}`,createdAt:new Date().toISOString(),encounterItems:s.encounterItems||[],partySize:s.partySize||4,battlePointsAdjustments:s.battlePointsAdjustments||{}};return x(p=>({...p,savedEncounters:[...p.savedEncounters||[],l]})),l.id}},L=s=>(r.savedEncounters||[]).find(p=>p.id===s),Y=s=>{const l={id:me("encounter"),name:s.name||`Encounter ${Date.now()}`,createdAt:new Date().toISOString(),encounterItems:s.encounterItems||[],partySize:s.partySize||4,battlePointsAdjustments:s.battlePointsAdjustments||{}};return x(p=>({...p,savedEncounters:[...p.savedEncounters||[],l]})),l.id},I=s=>{x(l=>({...l,savedEncounters:(l.savedEncounters||[]).filter(p=>p.id!==s)}))},S=h.useRef(r);h.useEffect(()=>{S.current=r},[r]);const O={gameState:r,isLoaded:y,customContent:c,updateFear:j,toggleFearVisibility:v,updatePartySize:B,saveEncounter:A,saveEncounterAs:Y,loadEncounter:L,deleteEncounter:I,createCountdown:s=>{const l={id:me("countdown"),name:s.name||"Countdown",max:parseInt(s.max)||1,value:0,visible:!0,type:s.type||"standard",loop:s.loop||"none",source:s.source||"campaign"};x(p=>({...p,countdowns:[...p.countdowns,l]}))},updateCountdown:(s,l)=>{x(p=>({...p,countdowns:p.countdowns.map(o=>o.id===s?{...o,...l}:o)}))},deleteCountdown:s=>{x(l=>({...l,countdowns:l.countdowns.filter(p=>p.id!==s)}))},advanceCountdown:(s,l)=>{x(p=>({...p,countdowns:p.countdowns.map(o=>{if(o.id!==s)return o;let n=l;if(o.loop==="loop")n>o.max?n=(n-1)%o.max+1:n<0&&(n=o.max);else if(o.loop==="increasing"){if(n>o.max)return{...o,max:o.max+1,value:1};if(n<0)return{...o,max:Math.max(1,o.max-1),value:1};n=Math.max(0,n)}else if(o.loop==="decreasing"){if(n>o.max)return{...o,max:Math.max(1,o.max-1),value:1};if(n<0)return{...o,max:o.max+1,value:1};n=Math.min(o.max,n)}else n=Math.max(0,Math.min(n,o.max));return{...o,value:n}})}))},incrementCountdown:(s,l=1)=>{x(p=>({...p,countdowns:p.countdowns.map(o=>{if(o.id!==s)return o;let n=o.value+l;if(o.loop==="loop")n>o.max&&(n=(n-1)%o.max+1);else if(o.loop==="increasing"){if(n>o.max)return{...o,max:o.max+1,value:1}}else if(o.loop==="decreasing"){if(n>o.max)return{...o,max:Math.max(1,o.max-1),value:1}}else n=Math.min(n,o.max);return{...o,value:n}})}))},decrementCountdown:s=>{x(l=>({...l,countdowns:l.countdowns.map(p=>{if(p.id!==s)return p;let o=p.value-1;if(p.loop==="loop")o<0&&(o=p.max);else if(p.loop==="increasing"){if(o<0)return{...p,max:Math.max(1,p.max-1),value:p.max};o=Math.max(0,o)}else if(p.loop==="decreasing"){if(o<0)return{...p,max:p.max+1,value:1}}else o=Math.max(0,o);return{...p,value:o}})}))},reorderCountdowns:s=>{x(l=>{const[p,o]=s,n=[...l.countdowns],[F]=n.splice(p,1);return n.splice(o,0,F),{...l,countdowns:n}})},createAdversary:s=>{var K;const l=me("adv"),p=r.adversaries||[],o=s.baseName||((K=s.name)==null?void 0:K.replace(/\s+\(\d+\)$/,""))||s.name||"Unknown",n=p.filter(d=>d.baseName===o);let F=1;if(n.length===0)F=1;else{const d=n.map(m=>m.duplicateNumber||1);let i=1;for(;d.includes(i);)i++;F=i}const W={...s,id:l,baseName:o,duplicateNumber:F,name:`${o} (${F})`,hp:0,stress:0,isVisible:!0};x(d=>({...d,adversaries:[...d.adversaries,W]}))},createAdversariesBulk:s=>{const l=[],p={};s.forEach(o=>{var z;const n=o.baseName||((z=o.name)==null?void 0:z.replace(/\s+\(\d+\)$/,""))||o.name||"Unknown",K=(r.adversaries||[]).filter($=>$.baseName===n).length,d=p[n]||0,i=K+d+1;p[n]=d+1;const m={...o,id:me("adv"),baseName:n,duplicateNumber:i,name:`${n} (${i})`,hp:0,stress:0,isVisible:!0};l.push(m)}),x(o=>({...o,adversaries:[...o.adversaries,...l]}))},updateAdversary:(s,l)=>{x(p=>({...p,adversaries:p.adversaries.map(o=>{if(o.id===s){const n={...o,...l};if(l.baseName!==void 0){const F=l.baseName,W=n.duplicateNumber||1;n.name=W===1?F:`${F} (${W})`}return n}return o})}))},deleteAdversary:s=>{x(l=>({...l,adversaries:l.adversaries.filter(p=>p.id!==s)}))},clearAllAdversaries:()=>{x(s=>({...s,adversaries:[]}))},reorderAdversaries:s=>{x(l=>{const[p,o]=s,n=[...l.adversaries],[F]=n.splice(p,1);return n.splice(o,0,F),{...l,adversaries:n}})},bulkReorderAdversaries:s=>{x(l=>({...l,adversaries:s}))},createEnvironment:s=>{const l=me("env"),o=(r.environments||[]).filter(W=>W.name.replace(/\s+\(\d+\)$/,"")===s.name);let n=s.name||"Unknown";if(o.length===0)n=s.name;else if(o.length===1){const W=o[0],K=W.name.replace(/\s+\(\d+\)$/,""),d=r.environments.map(i=>i.id===W.id?{...i,name:`${K} (1)`}:i);x(i=>({...i,environments:d})),n=`${s.name} (2)`}else{const W=o.map(d=>{const i=d.name.match(/\((\d+)\)$/);return i?parseInt(i[1]):null}).filter(d=>d!==null);let K=1;for(;W.includes(K);)K++;n=`${s.name} (${K})`}const F={...s,id:l,name:n,isVisible:!0};x(W=>({...W,environments:[...W.environments,F]}))},updateEnvironment:(s,l)=>{x(p=>({...p,environments:p.environments.map(o=>o.id===s?{...o,...l}:o)}))},deleteEnvironment:s=>{x(l=>({...l,environments:l.environments.filter(p=>p.id!==s)}))},reorderEnvironments:s=>{x(l=>{const[p,o]=s,n=[...l.environments],[F]=n.splice(p,1);return n.splice(o,0,F),{...l,environments:n}})},addCustomAdversary:s=>{const l={...s,id:me("custom-adv"),source:s.source||"Homebrew",isCustom:!0};return a(p=>({...p,adversaries:[...p.adversaries,l]})),fe("daggerheart-custom-adversaries",[...c.adversaries,l]),l.id},addCustomEnvironment:s=>{const l={...s,id:me("custom-env"),source:s.source||"Homebrew",isCustom:!0};return a(p=>({...p,environments:[...p.environments,l]})),fe("daggerheart-custom-environments",[...c.environments,l]),l.id},updateCustomAdversary:(s,l)=>{a(o=>({...o,adversaries:o.adversaries.map(n=>n.id===s?{...n,...l}:n)}));const p=c.adversaries.map(o=>o.id===s?{...o,...l}:o);fe("daggerheart-custom-adversaries",p)},updateCustomEnvironment:(s,l)=>{a(o=>({...o,environments:o.environments.map(n=>n.id===s?{...n,...l}:n)}));const p=c.environments.map(o=>o.id===s?{...o,...l}:o);fe("daggerheart-custom-environments",p)},deleteCustomAdversary:s=>{a(p=>({...p,adversaries:p.adversaries.filter(o=>o.id!==s)}));const l=c.adversaries.filter(p=>p.id!==s);fe("daggerheart-custom-adversaries",l)},deleteCustomEnvironment:s=>{a(p=>({...p,environments:p.environments.filter(o=>o.id!==s)}));const l=c.environments.filter(p=>p.id!==s);fe("daggerheart-custom-environments",l)}};return e.jsx(qe.Provider,{value:O,children:t})},_e=()=>{const t=h.useContext(qe);if(!t)return console.warn("useGameState: Context not available yet, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{gameState:r,customContent:x,...y}=t;if(!r)return console.warn("useGameState: gameState not available, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],customContent:{adversaries:[],environments:[]},updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},addCustomAdversary:()=>{},addCustomEnvironment:()=>{},updateCustomAdversary:()=>{},updateCustomEnvironment:()=>{},deleteCustomAdversary:()=>{},deleteCustomEnvironment:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{fear:f,countdowns:c,adversaries:a,environments:j,partySize:v,savedEncounters:B}=r;return{gameState:r,fear:f,countdowns:c,adversaries:a,environments:j,partySize:v,savedEncounters:B,customContent:x,...y,hasCountdowns:c.length>0,hasAdversaries:a.length>0,hasEnvironments:j.length>0,getCountdownById:A=>c.find(L=>L.id===A),getAdversaryById:A=>a.find(L=>L.id===A),getEnvironmentById:A=>j.find(L=>L.id===A)}},Me={fear:{icon:Xe,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"0.125rem",maxWidth:"none"},pipStyle:{fontSize:"var(--text-lg)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0,imageRendering:"crisp-edges"},filledColor:"var(--purple)",emptyColor:"var(--gray-dark)",tooltipTitle:"Click anywhere in header to adjust fear:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease fear by 1"},{text:"Right of boundary:",description:"Click to increase fear by 1"}]},hp:{icon:Ye,maxValue:20,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stress:{icon:Je,maxValue:12,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},countdown:{icon:Ne,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust countdown:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease countdown by 1"},{text:"Right of boundary:",description:"Click to increase countdown by 1"}]},hpDots:{maxValue:20,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--red)",borderColor:"var(--red)",boxShadow:"0 0 4px rgba(239, 68, 68, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stressDots:{maxValue:12,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--purple)",borderColor:"var(--purple)",boxShadow:"0 0 4px rgba(139, 92, 246, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},adversaryHP:{icon:xe,maxValue:20,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust HP:",tooltipInstructions:[{text:"Filled pip:",description:"Click to heal (reduce damage)"},{text:"Empty pip:",description:"Click to take damage"}]},adversaryStress:{icon:He,maxValue:12,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust stress:",tooltipInstructions:[{text:"Filled pip:",description:"Click to reduce stress"},{text:"Empty pip:",description:"Click to increase stress"}]},countdownDistributed:{icon:Ne,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Countdown progress:",tooltipInstructions:[{text:"Progress:",description:"Current countdown value"}]}},ut=({type:t="fear",value:r=0,maxValue:x,onChange:y,size:f="lg",showTooltip:c=!0,containerStyle:a={},pipStyle:j={},countdownType:v=null,distributedGroups:B=null,onPipClick:A=null,enableBoundaryClick:L=!1,clickContainerWidth:Y="auto",centerPips:I=!0})=>{const[S,Z]=h.useState(!1),P=Me[t]||Me.fear,T=x||P.maxValue,M=Math.max(0,Math.min(T,r));let G=P.filledColor;t==="countdown"&&v&&(["progress","dynamic-progress","simple-hope"].includes(v)?G="var(--gold)":["consequence","dynamic-consequence","simple-fear"].includes(v)?G="var(--purple)":["long-term","standard"].includes(v)&&(G="var(--text-secondary)"));const k=(_,C)=>{if(A)A(_,C);else if(y){const N=_+1;y(N)}},b=_=>{if(!L||!y||A)return;_.currentTarget.getBoundingClientRect();const C=_.currentTarget.querySelector(".pip-container");if(!C)return;const N=C.getBoundingClientRect(),H=_.clientX-N.left;if(H<0){M>0&&y(M-1);return}if(H>N.width){M<T&&y(M+1);return}const u=N.width,w=u*.05,J=u-2*w,g=H-w,E=M/T,R=J*E;g<R?M>0&&y(M-1):M<T&&y(M+1)},se=(()=>{if(!B||t!=="countdownDistributed")return[{start:0,end:T,groupIndex:0}];let _=0;return B.map((C,N)=>{const H={start:_,end:_+C,groupIndex:N};return _+=C,H})})(),ae=()=>e.jsxs(e.Fragment,{children:[se.map(_=>e.jsx(he.Fragment,{children:[...Array(_.end-_.start)].map((C,N)=>{const H=_.start+N,u=H<M;if(P.isDots)return e.jsx("div",{style:{...P.pipStyle,...u?P.filledStyle:P.emptyStyle,...j,cursor:y||A?"pointer":"default"},onClick:L?void 0:()=>k(H,u),title:`${H+1} of ${T}`},H);{const w=P.icon,J=w&&typeof w=="object"&&w.iconName,g=u?G:P.emptyColor;return e.jsx("span",{className:`fear-pip ${u?"filled":"empty"}`,style:{...P.pipStyle,color:g,cursor:y||A?"pointer":"default",...j},onClick:L?void 0:()=>k(H,u),title:`${H+1} of ${T}`,children:J?e.jsx(Ge,{icon:w,size:f}):e.jsx(w,{size:16})},H)}})},_.groupIndex)),c&&e.jsx("div",{style:{position:"relative",cursor:"help",pointerEvents:"none"},children:e.jsxs("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:S?"translateX(-50%) translateY(-5px)":"translateX(-50%)",background:"rgba(15, 23, 42, 0.95)",border:"1px solid var(--gray)",borderRadius:"var(--radius-md)",padding:"var(--space-md)",minWidth:"250px",zIndex:1e3,opacity:S?1:0,visibility:S?"visible":"hidden",transition:"all 0.2s ease",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.5)"},children:[e.jsx("div",{style:{fontWeight:600,color:"var(--gray-200)",marginBottom:"0.75rem",fontSize:"var(--text-sm)"},children:P.tooltipTitle}),P.tooltipInstructions.map((_,C)=>e.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.8rem",color:"var(--gray-300)",lineHeight:1.4},children:[e.jsx("strong",{style:{color:"var(--gray-200)"},children:_.text})," ",_.description]},C))]})})]});return e.jsx("div",{style:{width:Y,height:"100%",cursor:y||A?"pointer":"default",touchAction:"manipulation",userSelect:"none",display:I?"flex":"block",alignItems:I?"center":"stretch",justifyContent:I?"center":"flex-start",...a},onClick:_=>{_.stopPropagation(),_.preventDefault(),L&&b(_)},onMouseEnter:()=>Z(c),onMouseLeave:()=>Z(!1),children:e.jsx("div",{className:"pip-container",style:{...P.containerStyle,width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},children:ae()})})},xt="/Daggerheart/assets/daggerheart-logo-fe7815ad.svg",mt=({showFlyout:t,onFlyoutChange:r})=>{const[x,y]=h.useState(!1),[f,c]=h.useState(!1),a=t!==void 0?t:x,j=r||y;return h.useEffect(()=>{const v=B=>{B.target.closest(".help-button")||j(!1)};return document.addEventListener("click",v),()=>document.removeEventListener("click",v)},[j]),h.useEffect(()=>{const v=window.matchMedia("(max-width: 800px)"),B=A=>c(A.matches);return c(v.matches),v.addEventListener("change",B),()=>v.removeEventListener("change",B)},[]),e.jsxs("div",{className:"help-button",style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",padding:"0.5rem",color:a?"white":"var(--text-primary)",borderRadius:"50%",cursor:"pointer",transition:"all 0.2s ease",minWidth:"44px",minHeight:"44px",backgroundColor:a?"var(--purple)":"transparent"},onMouseEnter:v=>{a||(v.currentTarget.style.backgroundColor="var(--bg-secondary)")},onMouseLeave:v=>{a||(v.currentTarget.style.backgroundColor="transparent")},onClick:v=>{v.stopPropagation(),j(!a)},title:"Help & Info",children:[e.jsx("div",{style:{width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center",color:"inherit",backgroundColor:"transparent",border:"none",outline:"none"},children:e.jsx(Ue,{size:20})}),e.jsxs("div",{style:{position:"absolute",top:"50%",right:"100%",left:"auto",transform:"translateY(-50%)",background:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,opacity:a?1:0,visibility:a?"visible":"hidden",transition:"opacity 0.2s ease, visibility 0.2s ease, transform 0.2s ease",pointerEvents:a?"auto":"none",minWidth:"280px",maxWidth:f?"calc(100vw - 2rem)":"320px",marginRight:"0.5rem"},children:[e.jsxs("div",{style:{padding:"0.75rem",borderTop:"1px solid rgba(255, 255, 255, 0.1)",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",background:"var(--bg-primary)",maxWidth:"280px"},children:[e.jsx("img",{src:xt,alt:"Daggerheart Community Content Logo",style:{width:"100%",maxWidth:"200px",height:"auto",margin:"0 auto 0.75rem auto",display:"block"},onError:v=>{console.error("Failed to load Daggerheart logo:",v.target.src),v.target.style.display="none";const B=document.createElement("div");B.style.cssText="text-align: center; margin-bottom: 0.75rem; font-size: 1.5rem; font-weight: bold; color: var(--purple);",B.textContent="⚔️ DAGGERHEART ⚔️",v.target.parentNode.insertBefore(B,v.target)},onLoad:()=>{}}),e.jsxs("div",{style:{fontSize:"0.7rem",lineHeight:1.3,color:"var(--text-secondary)",textAlign:"left",wordWrap:"break-word",overflowWrap:"break-word"},children:[e.jsx("p",{children:"This product includes materials from the Daggerheart System Reference Document 1.0, © Critical Role, LLC, under the terms of the Darrington Press Community Gaming (DPCGL) License."}),e.jsxs("p",{children:["More information can be found at ",e.jsx("a",{href:"https://www.daggerheart.com",target:"_blank",rel:"noopener noreferrer",children:"daggerheart.com"})]}),e.jsx("p",{children:e.jsx("em",{children:"This project is unofficial and not endorsed by Darrington Press or Critical Role."})})]})]}),e.jsx("button",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"0.25rem 1rem",color:"var(--text-primary)",border:"none",background:"none",width:"100%",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"0.875rem",minHeight:"32px",borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},onMouseEnter:v=>{v.target.style.backgroundColor="var(--gray-dark)"},onMouseLeave:v=>{v.target.style.backgroundColor="transparent"},onClick:v=>{v.stopPropagation(),j(!1),window.open("https://github.com/Splinter714/Daggerheart","_blank")},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.25rem"},children:e.jsx("span",{children:"GitHub"})})}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"0.25rem 1rem",color:"var(--text-secondary)",border:"none",background:"none",width:"100%",textAlign:"left",cursor:"default",fontSize:"0.875rem",minHeight:"32px"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.25rem"},children:e.jsxs("span",{children:["Version ","0.3.7 (efb3692)"]})})})]})]})},ft=({adversaries:t,environments:r,countdowns:x,deleteAdversary:y,deleteEnvironment:f,deleteCountdown:c,isClearMode:a,setIsClearMode:j,showFlyout:v,onFlyoutChange:B})=>{const[A,L]=h.useState(!1),Y=v!==void 0?v:A,I=B||L,S=((t==null?void 0:t.length)||0)>0||((r==null?void 0:r.length)||0)>0||((x==null?void 0:x.length)||0)>0,Z=(t||[]).some(k=>(k.hp||0)>=(k.hpMax||1));h.useEffect(()=>{const k=b=>{b.target.closest(".delete-clear-container")||(I(!1),a&&j(!1))};return document.addEventListener("click",k),()=>document.removeEventListener("click",k)},[a,I]),h.useEffect(()=>{a&&!S&&(j(!1),I(!1))},[a,S,j,I]);const P={position:"absolute",top:"50%",right:"100%",left:"auto",transform:"translateY(-50%)",backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",padding:"0.5rem",minWidth:"200px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,display:Y?"block":"none",marginRight:"0.5rem"},T={background:a||Y?"var(--red)":"none",border:"none",color:a||Y?"white":S?"var(--text-primary)":"var(--text-secondary)",cursor:S?"pointer":"not-allowed",padding:"0.5rem",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s",opacity:S?1:.5,minWidth:"44px",minHeight:"44px"},M={background:"none",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:"0.5rem",borderRadius:"var(--radius-sm)",width:"100%",textAlign:"left",display:"flex",alignItems:"center",gap:"0.5rem",transition:"background-color 0.2s"},G={backgroundColor:"var(--bg-hover)"};return e.jsxs("div",{className:"delete-clear-container",style:{position:"relative"},children:[e.jsx("button",{style:T,onClick:k=>{k.stopPropagation(),S&&(a?(j(!1),I(!1)):(j(!0),I(!0)))},title:S?a?"Clear Items":"Enter Clear Mode":"Nothing to clear",children:e.jsx(Ke,{size:20})}),e.jsxs("div",{style:P,children:[t&&t.length>0&&e.jsxs("button",{style:M,onMouseEnter:k=>Object.assign(k.target.style,G),onMouseLeave:k=>Object.assign(k.target.style,M),onClick:k=>{k.stopPropagation(),L(!1),t.forEach(b=>y(b.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Adversaries"})]}),t&&t.length>0&&Z&&e.jsxs("button",{style:M,onMouseEnter:k=>Object.assign(k.target.style,G),onMouseLeave:k=>Object.assign(k.target.style,M),onClick:k=>{k.stopPropagation(),L(!1),t.filter(q=>(q.hp||0)>=(q.hpMax||1)).forEach(q=>y(q.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"Dead Adversaries"})]}),r&&r.length>0&&e.jsxs("button",{style:M,onMouseEnter:k=>Object.assign(k.target.style,G),onMouseLeave:k=>Object.assign(k.target.style,M),onClick:k=>{k.stopPropagation(),L(!1),r.forEach(b=>f(b.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Environments"})]}),x&&x.length>0&&e.jsxs("button",{style:M,onMouseEnter:k=>Object.assign(k.target.style,G),onMouseLeave:k=>Object.assign(k.target.style,M),onClick:k=>{k.stopPropagation(),L(!1),x.forEach(b=>c(b.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Countdowns"})]})]})]})},ht=({adversaries:t,environments:r,countdowns:x,deleteAdversary:y,deleteEnvironment:f,deleteCountdown:c,isClearMode:a,setIsClearMode:j,sortAdversaries:v,onOpenDatabase:B})=>{const[A,L]=h.useState(!1),[Y,I]=h.useState(!1),[S,Z]=h.useState(!1);h.useEffect(()=>{const q=se=>{se.target.closest(".floating-menu-container")||(L(!1),I(!1),Z(!1),a&&j(!1))};return document.addEventListener("click",q),()=>document.removeEventListener("click",q)},[a,j]),h.useEffect(()=>{A||(I(!1),Z(!1),a&&j(!1))},[A,a,j]);const P=q=>{I(q),q&&(Z(!1),a&&j(!1))},T=q=>{Z(q),q&&I(!1)},G={position:"fixed",bottom:window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://")?"calc(60px + env(safe-area-inset-bottom) + 2rem)":"calc(60px + env(safe-area-inset-bottom) + 1rem)",right:"1rem",zIndex:1100,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",pointerEvents:"none",width:"56px",height:"56px"},k={width:"56px",height:"56px",borderRadius:"50%",background:A?"var(--red)":"var(--bg-secondary)",border:"2px solid var(--border)",color:A?"white":"var(--text-primary)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"all 0.3s ease",pointerEvents:"auto"},b=(q,se)=>{const N=135+q*135/(se-1),H=70,u=N*Math.PI/180,w=Math.cos(u)*H,J=Math.sin(u)*H;return{width:"48px",height:"48px",borderRadius:"50%",background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.2)",transition:"all 0.3s ease",position:"absolute",pointerEvents:"auto",transform:A?`translate(${w}px, ${J}px)`:"translate(0px, 0px)",opacity:A?1:0,visibility:A?"visible":"hidden"}};return e.jsxs("div",{className:"floating-menu-container",style:G,children:[e.jsxs("div",{style:{position:"absolute",top:"0",left:"0",width:"56px",height:"56px",pointerEvents:"none"},children:[e.jsx("div",{style:b(0,4),children:e.jsx("button",{onClick:q=>{q.stopPropagation(),B("adversaries"),L(!1)},style:{width:"100%",height:"100%",background:"none",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Browse Adversaries",children:e.jsx(Qe,{size:20})})}),e.jsx("div",{style:b(1,4),children:e.jsx("button",{onClick:q=>{q.stopPropagation(),B("environments"),L(!1)},style:{width:"100%",height:"100%",background:"none",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Browse Environments",children:e.jsx(Ze,{size:20})})}),e.jsx("div",{style:b(2,4),children:e.jsx(ft,{adversaries:t,environments:r,countdowns:x,deleteAdversary:y,deleteEnvironment:f,deleteCountdown:c,isClearMode:a,setIsClearMode:j,showFlyout:S,onFlyoutChange:T})}),e.jsx("div",{style:b(3,4),children:e.jsx(mt,{showFlyout:Y,onFlyoutChange:P})})]}),e.jsx("button",{style:k,onClick:q=>{q.stopPropagation(),L(!A)},title:A?"Close Menu":"Open Menu",children:A?e.jsx(Te,{size:24}):e.jsx(et,{size:24})})]})},yt=({position:t="top",children:r,onClick:x,className:y="",style:f={}})=>{const c=t==="top",a=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://"),j={background:"var(--bg-primary)",borderTop:c?"none":"1px solid var(--border)",borderBottom:c?"1px solid var(--border)":"none",padding:c?"0.25rem 0":"0.5rem",paddingBottom:c?"0.25rem":a?"calc(0.5rem + env(safe-area-inset-bottom) + 1rem)":"calc(0.5rem + env(safe-area-inset-bottom))",position:c?"relative":"sticky",[c?"top":"bottom"]:0,zIndex:c?10:100,order:c?1:3,flexShrink:0,touchAction:"manipulation",userSelect:"none",display:"flex",flexDirection:c?"column":"row",justifyContent:c?"stretch":"center",alignItems:c?"stretch":"center",gap:c?"0":"1rem",height:c?"auto":"60px",...f};return e.jsx("div",{className:y,style:j,onClick:x,children:r})},Pe=({value:t})=>e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"36px",height:"24px"},children:[e.jsx("svg",{width:"32",height:"24",viewBox:"0 0 32 24",fill:"none",stroke:"var(--text-secondary)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",style:{position:"absolute"},children:e.jsx("path",{d:"M2 2h20l4 10-4 10H2l4-10-4-10z"})}),e.jsx("span",{style:{position:"absolute",fontSize:"0.7rem",fontWeight:500,color:"var(--text-primary)",textAlign:"center",zIndex:1,left:"45%",top:"50%",transform:"translate(-50%, -50%)"},children:t})]}),le={transitions:{hoverIn:"all 0.1s ease",hoverOut:"all 0.3s ease"},card:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"8px",cursor:"pointer",transition:"all 0.1s ease",position:"relative"},cardHover:{backgroundColor:"var(--bg-card-hover)"},cardDead:{opacity:.6,backgroundColor:"var(--gray-800)",borderColor:"var(--border)"},cardAtMax:{backgroundColor:"var(--success)",borderColor:"var(--success)"},rowMain:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},rowTitle:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",margin:0},rowMeta:{display:"flex",gap:"8px",alignItems:"center"},badge:{padding:"2px 6px",borderRadius:"3px",fontSize:"10px",fontWeight:"600",textTransform:"uppercase"},typeBadge:{backgroundColor:"var(--purple)",color:"var(--text-primary)"},tierBadge:{backgroundColor:"var(--info)",color:"var(--text-primary)"},damageInputPopup:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,borderRadius:"8px"},damageInputContent:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"8px",padding:"8px",display:"flex",flexDirection:"row",gap:"8px",minWidth:"200px",alignItems:"center",position:"absolute",right:"1rem",top:"50%",transform:"translateY(-50%)"},damageInput:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"4px",padding:"4px 6px",color:"var(--text-primary)",fontSize:"16px",width:"80px",textAlign:"center"},damageIndicators:{display:"flex",gap:"8px",alignItems:"center",justifyContent:"center"},damageDrop:{fontSize:"16px",color:"var(--text-secondary)",cursor:"pointer",transition:"color 0.1s ease"},applyButton:{backgroundColor:"var(--gray-600)",color:"white",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"32px",minHeight:"32px"}},gt=(t,r,x,y)=>{const[f,c]=h.useState(!1),[a,j]=h.useState("");h.useEffect(()=>{if(f){const I=S=>{S.target.closest(".damage-input-popup")||(c(!1),j(""))};return document.addEventListener("click",I),()=>document.removeEventListener("click",I)}},[f]);const v=I=>{I.stopPropagation(),I.preventDefault();const S=t.hp||0,Z=t.hpMax||1,P=I.currentTarget.getBoundingClientRect(),T=I.clientX-P.left,M=P.width/Z;Math.floor(T/M)<S?x&&x(t.id,1,t.hp):r&&r(t.id,1,t.hp,t.hpMax)},B=I=>{I.stopPropagation(),I.preventDefault();const S=t.stress||0,Z=t.stressMax||1,P=I.currentTarget.getBoundingClientRect(),T=I.clientX-P.left,M=P.width/Z;Math.floor(T/M)<S?y&&y(t.id,-1,t.stress,t.stressMax):y&&y(t.id,1,t.stress,t.stressMax)},A=I=>{I.stopPropagation(),(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")&&(c(!0),j(t.type==="Minion"?"1":""))},L=()=>{const I=parseInt(a);if(I>0){if(t.type==="Minion")r&&r(t.id,I,t.hp,t.hpMax);else{let S=0;I>=t.thresholds.severe?S=3:I>=t.thresholds.major?S=2:I>=1&&(S=1),r&&r(t.id,S,t.hp,t.hpMax)}c(!1),j("")}};return{showDamageInput:f,damageValue:a,setDamageValue:j,setShowDamageInput:c,handleHpClick:v,handleStressClick:B,handleDifficultyClick:A,applyDamage:L,handleKeyDown:I=>{I.key==="Enter"?L():I.key==="Escape"&&(c(!1),j(""))}}},Ve=({item:t,type:r,mode:x="expanded",onClick:y,onDelete:f,onApplyDamage:c,onApplyHealing:a,onApplyStressChange:j,onUpdate:v,adversaries:B=[],isSelected:A=!1,isEditMode:L=!1,instances:Y=[],isEmbedded:I=!1})=>{const S=gt(t,c,a,j);(r==="adversary"||r==="adversaries")&&S.handleDifficultyClick;const[Z,P]=h.useState(!1),T=()=>{P(!0)},M=()=>{P(!1)},G=(C=!1)=>{let N={...le.card};if(A?N.transition="none":N.transition=Z?le.transitions.hoverIn:le.transitions.hoverOut,C){const{marginTop:H,...u}=N;N=u}return(Z&&x!=="expanded"||A)&&(N={...N,...le.cardHover}),r==="adversary"&&(t.hp||0)>=(t.hpMax||1)&&(N={...N,...le.cardDead}),N},k=()=>{if(I)return"";let C="border rounded-lg";return(Z&&x!=="expanded"||A)&&(C+=" border-hover"),C},b=()=>{var C;if(r==="adversary"||r==="adversaries"){const N=t.baseName||((C=t.name)==null?void 0:C.replace(/\s+\(\d+\)$/,""))||"",H=t.duplicateNumber||1,u=[...B];return B.some(g=>g.id===t.id)||u.push(t),u.filter(g=>g.baseName===N).length>1?`${N} (${H})`:N}return t.name},q=()=>{const C=[];return t.type&&C.push(e.jsx("span",{style:{...le.badge,...le.typeBadge},children:t.type},"type")),C},se=()=>r!=="adversary"||!S.showDamageInput||!(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")?null:e.jsx("div",{className:"damage-input-popup",style:le.damageInputPopup,onClick:C=>{C.stopPropagation(),C.target===C.currentTarget&&(r==="adversary"||r==="adversaries")&&(S.setShowDamageInput(!1),S.setDamageValue(""))},children:e.jsxs("div",{className:"border rounded-lg",style:{...le.damageInputContent,borderColor:"var(--border)"},onClick:C=>C.stopPropagation(),children:[e.jsx("input",{type:"number",inputMode:"numeric",enterKeyHint:"done",placeholder:"dmg",min:(t.type==="Minion","0"),value:r==="adversary"||r==="adversaries"?S.damageValue:"",onChange:C=>{(r==="adversary"||r==="adversaries")&&S.setDamageValue(C.target.value)},onKeyDown:r==="adversary"||r==="adversaries"?S.handleKeyDown:void 0,className:"border rounded-sm",style:{...le.damageInput,borderColor:"var(--border)"},autoFocus:!0}),e.jsxs("div",{style:le.damageIndicators,children:[t.type==="Minion"?(()=>{var w,J;const C=parseInt(r==="adversary"||r==="adversaries"?S.damageValue:"0")||0,N=(w=t.features)==null?void 0:w.find(g=>{var E;return(E=g.name)==null?void 0:E.startsWith("Minion (")}),H=N?parseInt(((J=N.name.match(/\((\d+)\)/))==null?void 0:J[1])||"1"):1,u=Math.floor(C/H);return C>=H&&u>0?e.jsxs("span",{style:{...le.damageDrop,color:"var(--red)"},title:`${C} damage can defeat ${u+1} minion${u+1!==1?"s":""} (1 + ${u} additional)`,children:["+",u," additional minion(s)"]}):e.jsx("span",{style:le.damageDrop,title:`${C} damage defeats this minion only`,children:"+0 additional minion(s)"})})():[1,2,3].map(C=>{const N=parseInt(r==="adversary"||r==="adversaries"?S.damageValue:"0")||0;let H=!1;return C===1&&N>=1&&(H=!0),C===2&&N>=t.thresholds.major&&(H=!0),C===3&&N>=t.thresholds.severe&&(H=!0),e.jsx("span",{style:{...le.damageDrop,color:H?"var(--red)":"var(--text-secondary)"},onClick:u=>{u.stopPropagation(),(r==="adversary"||r==="adversaries")&&(C===1?S.setDamageValue("1"):C===2?S.setDamageValue(t.thresholds.major.toString()):C===3&&S.setDamageValue(t.thresholds.severe.toString()))},title:`Click to set damage to ${C===1?"1":C===2?t.thresholds.major:t.thresholds.severe}`,children:e.jsx(xe,{size:16})},C)}),e.jsx("button",{style:{...le.applyButton,backgroundColor:"var(--gray-600)"},onClick:C=>{C.stopPropagation(),(r==="adversary"||r==="adversaries")&&(!S.damageValue||parseInt(S.damageValue)<1?(S.setShowDamageInput(!1),S.setDamageValue("")):S.applyDamage())},title:!S.damageValue||parseInt(S.damageValue)<1?"Close damage input":"Apply damage",children:!S.damageValue||parseInt(S.damageValue)<1?e.jsx(Te,{size:16}):e.jsx(nt,{size:16})})]})]})}),ae=()=>{var H;const C=(t.hp||0)>=(t.hpMax||1),N=x==="edit";return e.jsxs("div",{className:k(),style:{...G(!0),padding:0,minHeight:"400px",opacity:C?.7:1,backgroundColor:C?"var(--gray-900)":G(!0).backgroundColor,borderColor:C?"color-mix(in srgb, var(--gray-600) 40%, transparent)":A?"var(--purple)":Z&&x!=="expanded"?"var(--border-hover)":"var(--border)",borderWidth:"2px",display:"flex",flexDirection:"column",position:"relative"},onClick:y,...x!=="expanded"&&{onMouseEnter:T,onMouseLeave:M},children:[C&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                45deg,
                transparent,
                transparent 8px,
                var(--gray-600) 1px,
                var(--gray-600) 9px
              )`,pointerEvents:"none",zIndex:9999}}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"var(--text-secondary)",fontSize:"1rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em",zIndex:1e4,pointerEvents:"none",textShadow:"1px 1px 2px rgba(0, 0, 0, 0.5)",backgroundColor:"var(--gray-900)",padding:"0.25rem 0.5rem",borderRadius:"0.5rem",border:"0.5px solid var(--gray-600)"},children:"DEFEATED"})]}),e.jsx("div",{className:"border-b",style:{padding:"8px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative",zIndex:C?1:"auto",borderBottomColor:A?"var(--purple)":"var(--border)"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",position:"relative",zIndex:C?1:"auto"},children:[e.jsx("h4",{style:{...le.rowTitle,color:C?"color-mix(in srgb, var(--gray-400) 80%, transparent)":le.rowTitle.color,textAlign:"left",margin:0,fontSize:"1.1rem"},children:((H=t.name)==null?void 0:H.replace(/\s+\(\d+\)$/,""))||t.name}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.difficulty&&e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[e.jsx(tt,{size:24,style:{color:"var(--text-secondary)",transform:"rotate(0deg)"}}),e.jsx("span",{style:{position:"absolute",fontSize:"0.625rem",fontWeight:600,color:"white",pointerEvents:"none"},children:t.difficulty})]}),t.atk!==void 0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[e.jsx(rt,{size:24,strokeWidth:1,style:{color:"var(--text-secondary)"}}),e.jsxs("span",{style:{position:"absolute",fontSize:"0.625rem",fontWeight:600,color:"white",pointerEvents:"none"},children:[t.atk>=0?"+":"",t.atk]})]})]})]})}),e.jsxs("div",{style:{borderRadius:"0 0 8px 8px"},children:[(t.motives||t.experience&&t.experience.length>0)&&e.jsxs("div",{style:{padding:"0.75rem 8px",marginBottom:"1rem"},children:[t.motives&&e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",marginBottom:t.experience&&t.experience.length>0?"0.75rem":"0"},children:t.motives}),t.experience&&t.experience.length>0&&e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)"},children:t.experience.map(u=>typeof u=="string"?u:`${u.name} ${u.modifier>=0?"+":""}${u.modifier}`).join(", ")})]}),t.features&&t.features.length>0&&e.jsxs("div",{style:{marginBottom:"1rem",padding:"0 8px"},children:[(t.atk!==void 0&&t.weapon||t.features.filter(u=>u.type==="Action").length>0)&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px",textAlign:"center",minWidth:"80px"},children:"Actions"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[t.atk!==void 0&&t.weapon&&e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsxs("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:[t.weapon," (Standard)"]}),e.jsxs("span",{children:[" - Make an attack against a target within ",t.range||"Melee"," range. On a success, deal ",t.damage||"damage varies","."]})]}),t.features.filter(u=>u.type==="Action").map((u,w)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:u.name}),u.description&&e.jsxs("span",{children:[" - ",u.description]})]},w))]})]}),t.features.filter(u=>u.type==="Passive").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px",textAlign:"center",minWidth:"80px"},children:"Passives"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:t.features.filter(u=>u.type==="Passive").map((u,w)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:u.name}),u.description&&e.jsxs("span",{children:[" - ",u.description]})]},w))})]}),t.features.filter(u=>u.type==="Reaction").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px",textAlign:"center",minWidth:"80px"},children:"Reactions"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:t.features.filter(u=>u.type==="Reaction").map((u,w)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:u.name}),u.description&&e.jsxs("span",{children:[" - ",u.description]})]},w))})]})]})]}),t.type!=="Minion"&&t.thresholds&&e.jsxs("div",{style:{marginBottom:"1rem",padding:"0 8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px",textAlign:"center",minWidth:"80px"},children:"Status"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{padding:"0.75rem 0 0 0"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",fontSize:"0.875rem"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"2px",marginTop:"-3px"},children:e.jsx(xe,{size:16,style:{color:"var(--red)"}})}),e.jsx(Pe,{value:t.thresholds.major||"7"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"2px",marginTop:"-3px"},children:[e.jsx(xe,{size:16,style:{color:"var(--red)"}}),e.jsx(xe,{size:16,style:{color:"var(--red)"}})]}),e.jsx(Pe,{value:t.thresholds.severe||"14"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"2px",marginTop:"-3px"},children:[e.jsx(xe,{size:16,style:{color:"var(--red)"}}),e.jsx(xe,{size:16,style:{color:"var(--red)"}}),e.jsx(xe,{size:16,style:{color:"var(--red)"}})]})]})})]}),Y&&Y.length>0&&e.jsx("div",{style:{marginTop:"1rem",borderTop:"1px solid var(--border)"},children:Y.map((u,w)=>{const J=(u.hp||0)>=(u.hpMax||1);return e.jsx("div",{children:e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",borderRadius:"4px",padding:"4px",border:"1px solid var(--border)",marginBottom:"4px",display:"flex",justifyContent:"flex-start",alignItems:"center",gap:"8px",opacity:J?.7:1,backgroundColor:J?"var(--gray-900)":"var(--bg-secondary)",borderColor:J?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--border)",position:"relative"},children:[J&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                          45deg,
                          transparent 0px,
                          transparent 8px,
                          var(--gray-600) 9px,
                          var(--gray-600) 9px
                        )`,pointerEvents:"none",zIndex:1,borderRadius:"4px"}}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"var(--text-secondary)",fontSize:"0.75rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em",zIndex:2,backgroundColor:"var(--gray-900)",padding:"0.125rem 0.25rem",borderRadius:"0.25rem",border:"0.5px solid var(--gray-600)"},children:"DEFEATED"})]}),e.jsx("div",{style:{backgroundColor:"var(--bg-secondary)",borderRadius:"6px",border:"1px solid var(--border-hover)",width:"32px",textAlign:"center",flexShrink:0,padding:"2px"},children:e.jsx("span",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)"},children:u.duplicateNumber||1})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"2px"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:g=>{if(g.stopPropagation(),!c||r!=="adversary")return;g.currentTarget.getBoundingClientRect();const E=g.currentTarget.querySelector(".pip-container");if(!E)return;const R=E.getBoundingClientRect(),U=g.clientX-R.left,ee=u.hp||0,ie=u.hpMax||1;if(U<0){ee>0&&a&&a(u.id,1,ee);return}if(U>R.width){ee<ie&&c(u.id,1,ee,ie);return}const V=R.width,O=V*.05,s=V-2*O,l=U-O,p=ee/ie,o=s*p;l<o?ee>0&&a&&a(u.id,1,ee):ee<ie&&c(u.id,1,ee,ie)},children:e.jsx("div",{className:"pip-container",style:{display:"flex",gap:"2px",alignItems:"center"},children:Array.from({length:u.hpMax||1},(g,E)=>e.jsx("span",{style:{fontSize:"0.75rem",color:E<(u.hp||0)?"var(--red)":"var(--text-secondary)",transition:"all 0.1s ease"},children:e.jsx(xe,{size:16})},E))})}),u.stressMax>0&&e.jsx("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:g=>{if(g.stopPropagation(),!j||r!=="adversary")return;g.currentTarget.getBoundingClientRect();const E=g.currentTarget.querySelector(".pip-container");if(!E)return;const R=E.getBoundingClientRect(),U=g.clientX-R.left,ee=u.stress||0,ie=u.stressMax;if(U<0){ee>0&&j(u.id,-1);return}if(U>R.width){ee<ie&&j(u.id,1);return}const V=R.width,O=V*.05,s=V-2*O,l=U-O,p=ee/ie,o=s*p;l<o?ee>0&&j(u.id,-1):ee<ie&&j(u.id,1)},children:e.jsx("div",{className:"pip-container",style:{display:"flex",gap:"2px",alignItems:"center"},children:Array.from({length:u.stressMax},(g,E)=>e.jsx("span",{style:{fontSize:"0.75rem",color:E<(u.stress||0)?"var(--gold)":"var(--text-secondary)",transition:"all 0.1s ease"},children:e.jsx(He,{size:16})},E))})})]})]},u.id)},u.id)})}),t.description&&e.jsxs("div",{style:{marginBottom:"1rem",padding:"0 8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px",textAlign:"center",minWidth:"80px"},children:"Description"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),N?e.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-secondary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"vertical",fontFamily:"inherit"},value:t.description,onChange:u=>{v&&v(t.id,{description:u.target.value})},placeholder:"Enter adversary description..."}):e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",whiteSpace:"pre-wrap"},children:t.description})]}),se()]})};return(x==="expanded"||x==="edit")&&(r==="adversary"||r==="adversaries")?ae():r==="adversary"||r==="adversaries"?null:e.jsxs("div",{className:k(),style:G(!0),children:[e.jsxs("div",{style:le.rowMain,children:[e.jsx("h4",{style:le.rowTitle,children:b()}),e.jsx("div",{style:le.rowMeta,children:q()})]}),e.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"12px",margin:0},children:["Expanded view coming soon for ",r]})]})},vt="modulepreload",bt=function(t){return"/Daggerheart/"+t},De={},je=function(r,x,y){if(!x||x.length===0)return r();const f=document.getElementsByTagName("link");return Promise.all(x.map(c=>{if(c=bt(c),c in De)return;De[c]=!0;const a=c.endsWith(".css"),j=a?'[rel="stylesheet"]':"";if(!!y)for(let A=f.length-1;A>=0;A--){const L=f[A];if(L.href===c&&(!a||L.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${j}`))return;const B=document.createElement("link");if(B.rel=a?"stylesheet":vt,a||(B.as="script",B.crossOrigin=""),B.href=c,document.head.appendChild(B),a)return new Promise((A,L)=>{B.addEventListener("load",A),B.addEventListener("error",()=>L(new Error(`Unable to preload CSS for ${c}`)))})})).then(()=>r()).catch(c=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=c,window.dispatchEvent(a),!a.defaultPrevented)throw c})},jt=(t,r)=>{const[x,y]=h.useState("max-content"),f=h.useCallback(()=>{if(!r.current||t<=3)return"max-content";const c=r.current.offsetWidth,j=Math.floor(c/120);return j<=1?"max-content":t===4?"max-content max-content":t===5||t===6?j>=2?"max-content max-content":"max-content":t===7?j>=3?"max-content max-content max-content":j>=2?"max-content max-content":"max-content":"repeat(auto-fit, minmax(80px, max-content))"},[t,r]);return h.useEffect(()=>{const c=f();y(c);const a=new ResizeObserver(()=>{const j=f();y(j)});return r.current&&a.observe(r.current),()=>{a.disconnect()}},[f]),x},wt=({encounter:t})=>{var f,c;const r=h.useRef(null),x=((f=t.encounterItems)==null?void 0:f.length)||0,y=jt(x,r);return e.jsx("div",{ref:r,className:"saved-encounter-adversary-list",style:{flex:1,fontSize:"0.8rem",color:"var(--text-secondary)",lineHeight:"1.3",display:"grid",gridTemplateColumns:y,gap:"0.25rem 1rem",gridAutoRows:"min-content"},children:((c=t.encounterItems)==null?void 0:c.length)>0?t.encounterItems.map((a,j)=>{var B;const v=a.item.baseName||((B=a.item.name)==null?void 0:B.replace(/\s+\(\d+\)$/,""))||a.item.name;return e.jsxs("div",{style:{marginBottom:"0.125rem"},children:[a.quantity,"x ",v]},j)}):e.jsx("div",{children:"No adversaries"})})},ye={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},we={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1,lowerTierAdversary:1};let ze={adversaries:[]},We={environments:[]},Oe=!1;const Ct=()=>{const t=JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]"),r=JSON.parse(localStorage.getItem("daggerheart-custom-environments")||"[]");return{customAdversaries:t,customEnvironments:r}},St=async()=>{if(Oe)return;let t={adversaries:[]},r={environments:[]},x={adversaries:[]},y={environments:[]};try{const a=await je(()=>import("./adversaries-9c8932de.js"),[]);t=(a==null?void 0:a.default)||a}catch(a){console.warn("Failed to load adversaries.json:",a)}try{const a=await je(()=>import("./environments-c340637c.js"),[]);r=(a==null?void 0:a.default)||a}catch(a){console.warn("Failed to load environments.json:",a)}try{const a=await je(()=>import("./playtest-adversaries-4a099c10.js"),[]);x=(a==null?void 0:a.default)||a}catch(a){console.warn("Failed to load playtest-adversaries.json:",a)}try{const a=await je(()=>import("./playtest-environments-d9cdffb6.js"),[]);y=(a==null?void 0:a.default)||a}catch(a){console.warn("Failed to load playtest-environments.json:",a)}const{customAdversaries:f,customEnvironments:c}=Ct();ze={...t,adversaries:[...t.adversaries||[],...x.adversaries||[],...f]},We={...r,environments:[...r.environments||[],...y.environments||[],...c]},Oe=!0,console.log(`Loaded ${ze.adversaries.length} adversaries and ${We.environments.length} environments`)},kt=(t,r=[],x=4,y=1)=>{const[f,c]=h.useState(""),[a,j]=h.useState([{field:"tier",direction:"asc"},{field:"name",direction:"asc"}]),[v,B]=h.useState([]),[A,L]=h.useState(!0),[Y,I]=h.useState([]),[S,Z]=h.useState([]),[P,T]=h.useState(!1),[M,G]=h.useState(!1),k=h.useRef(null),b=h.useRef(null);h.useEffect(()=>{(async()=>{await St(),L(!1);let E=[];t==="adversary"?E=ze.adversaries||[]:t==="environment"&&(E=We.environments||[]),B(E)})()},[t]);const q=g=>{const E=v.map(R=>R[g]).filter(Boolean);return[...new Set(E)].sort((R,U)=>typeof R=="number"&&typeof U=="number"?R-U:String(R).localeCompare(String(U)))},se=q("tier"),ae=q("type"),_=h.useMemo(()=>{let g=v.filter(E=>{var ie,V;const R=E.name.toLowerCase().includes(f.toLowerCase())||((ie=E.type)==null?void 0:ie.toLowerCase().includes(f.toLowerCase()))||((V=E.description)==null?void 0:V.toLowerCase().includes(f.toLowerCase())),U=Y.length===0||(Y.includes("party-tier")?E.tier===y:Y.includes(E.tier.toString())),ee=S.length===0||S.includes(E.type);return R&&U&&ee});return g.sort((E,R)=>{for(const U of a){const{field:ee,direction:ie}=U;let V=E[ee],O=R[ee];if(ee==="tier")V=parseInt(V)||0,O=parseInt(O)||0;else if(ee==="cost"){const s=l=>{if(t!=="adversary")return 0;const p=ye[l.type]||2;let o=0;const n=r.filter(W=>W.type==="adversary"&&W.item.type==="Solo"&&W.quantity>0).reduce((W,K)=>W+K.quantity,0),F=r.filter(W=>W.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(W.item.type)&&W.quantity>0).reduce((W,K)=>W+K.quantity,0);return l.type==="Solo"&&n===1&&(o+=2),["Bruiser","Horde","Leader","Solo"].includes(l.type)&&F===0&&(o+=1),p+o};V=s(E),O=s(R)}else if(ee==="difficulty"){const s=parseInt(V),l=parseInt(O);!isNaN(s)&&!isNaN(l)?(V=s,O=l):!isNaN(s)&&isNaN(l)?(V=s,O=999):isNaN(s)&&!isNaN(l)?(V=999,O=l):(V=String(V||"").toLowerCase(),O=String(O||"").toLowerCase())}else typeof V=="string"&&typeof O=="string"?(V=V.toLowerCase(),O=O.toLowerCase()):(V=String(V||"").toLowerCase(),O=String(O||"").toLowerCase());if(ie==="asc"){if(V>O)return 1;if(V<O)return-1}else{if(V<O)return 1;if(V>O)return-1}}return 0}),g},[v,f,a,Y,S,r,x,y]),C=g=>{j(E=>{const R=E.findIndex(U=>U.field===g);if(R>=0)if(R===0){const U=[...E];return U[0]={...U[0],direction:U[0].direction==="asc"?"desc":"asc"},U}else{const U=[...E];return U.splice(R,1)[0],[{field:g,direction:"asc"},...U]}else return[{field:g,direction:"asc"},...E]})},N=g=>{I(g==="clear"?[]:g==="party-tier"?["party-tier"]:E=>E.includes(g)?E.filter(R=>R!==g):[...E,g])},H=g=>{Z(g==="clear"?[]:E=>E.includes(g)?E.filter(R=>R!==g):[...E,g])},u=Y.length>0,w=S.length>0;return h.useEffect(()=>{const g=R=>{const U=R.target.closest(".filter-dropdown"),ee=R.target.closest(".header-filter-icon");U||ee||(T(!1),G(!1))},E=R=>{R.key==="Escape"&&(T(!1),G(!1))};return document.addEventListener("pointerdown",g,!0),document.addEventListener("mousedown",g,!0),document.addEventListener("touchstart",g,!0),document.addEventListener("click",g,!0),document.addEventListener("keydown",E,!0),()=>{document.removeEventListener("pointerdown",g,!0),document.removeEventListener("mousedown",g,!0),document.removeEventListener("touchstart",g,!0),document.removeEventListener("click",g,!0),document.removeEventListener("keydown",E,!0)}},[T,G]),{searchTerm:f,setSearchTerm:c,sortFields:a,handleSort:C,filteredAndSortedData:_,loading:A,selectedTiers:Y,selectedTypes:S,showTierDropdown:P,setShowTierDropdown:T,showTypeDropdown:M,setShowTypeDropdown:G,tierFilterRef:k,typeFilterRef:b,uniqueTiers:se,uniqueTypes:ae,handleTierSelect:N,handleTypeSelect:H,isTierFiltered:u,isTypeFiltered:w,getDropdownStyle:g=>{if(!g.current)return{};const E=g.current.getBoundingClientRect();return{position:"fixed",top:E.bottom+4,left:E.left-100,zIndex:99999}}}},Et=({searchTerm:t,onSearchChange:r,type:x,partyControls:y})=>e.jsxs("div",{style:D.browserHeader,children:[e.jsx("input",{type:"text",placeholder:"Search",value:t,onChange:f=>r(f.target.value),style:D.searchInput}),y&&e.jsx("div",{style:D.partyControls,children:y})]}),At=({sortFields:t,onSort:r,type:x,uniqueTiers:y,uniqueTypes:f,selectedTiers:c,selectedTypes:a,showTierDropdown:j,setShowTierDropdown:v,showTypeDropdown:B,setShowTypeDropdown:A,tierFilterRef:L,typeFilterRef:Y,handleTierSelect:I,handleTypeSelect:S,isTierFiltered:Z,isTypeFiltered:P,getDropdownStyle:T,costFilter:M,showCostDropdown:G,setShowCostDropdown:k,costFilterRef:b,handleCostFilterSelect:q,isCostFiltered:se})=>{const[ae,_]=h.useState(null),N=(()=>x==="adversary"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"cost",label:"Cost",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:x==="environment"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:[])(),H=()=>{if(!G)return null;const w=[{value:"all",label:"All"},{value:"auto-grey",label:"Auto Grey"},{value:"auto-hide",label:"Auto Hide"}];return Ae.createPortal(e.jsx("div",{className:"filter-dropdown",style:{...D.filterDropdown,...T(b),maxHeight:"60vh",overflow:"auto"},onMouseDown:J=>J.stopPropagation(),onClick:J=>J.stopPropagation(),children:w.map(J=>{const g=M===J.value;return e.jsxs("div",{style:{...D.filterOption,...g?D.filterOptionSelected:{}},onClick:()=>q(J.value),children:[e.jsx("span",{style:D.checkIcon,children:g?e.jsx(ve,{size:16}):e.jsx(be,{size:16})}),e.jsx("span",{style:D.filterLabel,children:J.label})]},J.value)})}),document.body)},u=(w,J,g,E,R,U,ee,ie)=>{if(!R)return null;const V=()=>{(w==="tier"||w==="type")&&E("clear")};return Ae.createPortal(e.jsxs("div",{className:"filter-dropdown",style:{...D.filterDropdown,...T(ee),maxHeight:"60vh",overflow:"auto"},onMouseDown:O=>O.stopPropagation(),onClick:O=>O.stopPropagation(),children:[e.jsxs("div",{style:{...D.filterOption,...g.length===0?D.filterOptionSelected:{}},onClick:V,children:[e.jsx("span",{style:D.checkIcon,children:g.length===0?e.jsx(ve,{size:16}):e.jsx(be,{size:16})}),e.jsx("span",{style:D.filterLabel,children:"All"})]}),w==="tier"&&e.jsxs("div",{style:{...D.filterOption,...g.includes("party-tier")?D.filterOptionSelected:{}},onClick:()=>E("party-tier"),children:[e.jsx("span",{style:D.checkIcon,children:g.includes("party-tier")?e.jsx(ve,{size:16}):e.jsx(be,{size:16})}),e.jsx("span",{style:D.filterLabel,children:"Party Tier"})]}),J.map(O=>{const s=g.includes(O.toString());return e.jsxs("div",{style:{...D.filterOption,...s?D.filterOptionSelected:{}},onClick:()=>E(O.toString()),children:[e.jsx("span",{style:D.checkIcon,children:s?e.jsx(ve,{size:16}):e.jsx(be,{size:16})}),e.jsx("span",{style:D.filterLabel,children:O})]},O)})]}),document.body)};return e.jsx("tr",{style:D.tableHeader,children:N.map(w=>e.jsxs("th",{style:{...D.tableHeaderCell,...ae===w.key?D.tableHeaderCellHover:{},position:"relative",...w.key==="name"?{width:"auto",minWidth:"0"}:{},...w.key==="tier"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...w.key==="type"?{width:"80px",minWidth:"80px",maxWidth:"80px"}:{},...w.key==="difficulty"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...w.key==="cost"?{width:"50px",minWidth:"50px",maxWidth:"50px"}:{},...w.key==="action"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{}},onClick:()=>r(w.key),onMouseEnter:()=>_(w.key),onMouseLeave:()=>_(null),children:[w.hasFilter?e.jsxs("div",{style:D.headerWithFilter,children:[e.jsx("span",{style:{cursor:"pointer"},onClick:J=>{J.stopPropagation(),r(w.key)},children:w.label}),e.jsxs("button",{ref:w.key==="tier"?L:w.key==="type"?Y:b,style:{...D.headerFilterIcon,...w.key==="tier"&&Z?D.headerFilterIconActive:{},...w.key==="type"&&P?D.headerFilterIconActive:{},...w.key==="cost"&&se?D.headerFilterIconActive:{}},className:"header-filter-icon",onClick:J=>{J.stopPropagation(),w.key==="tier"?(v(!j),A(!1),k(!1)):w.key==="type"?(A(!B),v(!1),k(!1)):w.key==="cost"&&(k(!G),v(!1),A(!1))},children:[e.jsx(st,{size:14}),w.key==="tier"&&Z||w.key==="type"&&P||w.key==="cost"&&se?e.jsx("span",{style:D.filterActiveDot}):null]})]}):w.label,w.key==="tier"&&u("tier",y,c,I,j,v,L),w.key==="type"&&u("type",f,a,S,B,A,Y),w.key==="cost"&&H()]},w.key))})},It=({item:t,onAdd:r,type:x,onRowClick:y,encounterItems:f=[],pcCount:c=4,playerTier:a=1,remainingBudget:j=0,costFilter:v="auto-grey",onAdversaryClick:B})=>{const[A,L]=h.useState(!1),Y=()=>{r(t)},I=()=>{if(x!=="adversary")return null;const P=ye[t.type]||2;let T=0;const M=f.filter(k=>k.type==="adversary"&&k.item.type==="Solo"&&k.quantity>0).reduce((k,b)=>k+b.quantity,0),G=f.filter(k=>k.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(k.item.type)&&k.quantity>0).reduce((k,b)=>k+b.quantity,0);return t.type==="Solo"&&M===1&&(T+=2),["Bruiser","Horde","Leader","Solo"].includes(t.type)&&G===0&&(T+=1),P+T},Z=(()=>{if(x==="adversary"){const P=I();ye[t.type];const T=P>j||j<=0;if(v==="auto-hide"&&T)return null;const M=v==="auto-grey"&&T?{opacity:.5,color:"var(--text-secondary)"}:{};return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...D.rowCell,width:"auto",minWidth:"0",textAlign:"left",...M},children:e.jsxs("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:[e.jsx("div",{style:{fontWeight:"600"},children:t.name}),t.description&&e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"0.125rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.description})]})}),e.jsx("td",{style:{...D.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...M},children:t.tier}),e.jsx("td",{style:{...D.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center",...M},children:t.type}),e.jsx("td",{style:{...D.rowCell,width:"50px",minWidth:"50px",maxWidth:"50px",textAlign:"center",...M},children:P}),e.jsx("td",{style:{...D.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...M},children:t.difficulty})]})}else if(x==="environment")return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...D.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:t.name}),e.jsx("td",{style:{...D.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:t.tier}),e.jsx("td",{style:{...D.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:t.type}),e.jsx("td",{style:{...D.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:t.difficulty})]});return null})();return Z===null?null:e.jsx(e.Fragment,{children:e.jsxs("tr",{style:{...D.row,...A?D.rowHover:{}},onClick:()=>{x==="adversary"&&B?B(t):y&&y(t,x)},onMouseEnter:()=>L(!0),onMouseLeave:()=>L(!1),children:[Z,e.jsx("td",{style:{width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",boxSizing:"border-box",overflow:"visible",textOverflow:"unset",whiteSpace:"nowrap"},children:e.jsx("button",{style:D.addButton,onClick:P=>{P.stopPropagation(),Y()},onMouseEnter:P=>{P.target.style.background="var(--bg-secondary)"},onMouseLeave:P=>{P.target.style.background="var(--purple)"},children:"+"})})]})})},zt=({type:t,onAddItem:r,onCancel:x=null,onRowClick:y,encounterItems:f=[],pcCount:c=4,playerTier:a=1,partyControls:j=null,showContainer:v=!0,savedEncounters:B=[],onLoadEncounter:A,onDeleteEncounter:L,activeTab:Y="adversaries"})=>{const[I,S]=h.useState("all"),[Z,P]=h.useState(!1),[T,M]=h.useState(null),[G,k]=h.useState({}),b=h.useRef({}),q=h.useRef(null),se=i=>{G[i]?(L&&L(i),k(m=>{const z={...m};return delete z[i],z}),b.current[i]&&(clearTimeout(b.current[i]),delete b.current[i])):(k(m=>({...m,[i]:!0})),b.current[i]&&clearTimeout(b.current[i]),b.current[i]=setTimeout(()=>{k(m=>{const z={...m};return delete z[i],z}),delete b.current[i]},3e3))};h.useEffect(()=>()=>{Object.values(b.current).forEach(i=>{clearTimeout(i)})},[]);const{searchTerm:ae,setSearchTerm:_,sortFields:C,handleSort:N,filteredAndSortedData:H,loading:u,selectedTiers:w,selectedTypes:J,showTierDropdown:g,setShowTierDropdown:E,showTypeDropdown:R,setShowTypeDropdown:U,tierFilterRef:ee,typeFilterRef:ie,uniqueTiers:V,uniqueTypes:O,handleTierSelect:s,handleTypeSelect:l,isTierFiltered:p,isTypeFiltered:o,getDropdownStyle:n}=kt(t,f,c,a),W=(()=>{const i=3*c+2,m=f.reduce((te,de)=>{if(de.type==="adversary"){const pe=ye[de.item.type]||2;if(de.item.type==="Minion"){const oe=Math.ceil(de.quantity/c);return te+oe*pe}else return te+de.quantity*pe}return te},0);let z=0;f.filter(te=>te.type==="adversary"&&te.item.type==="Solo"&&te.quantity>0).reduce((te,de)=>te+de.quantity,0)>=2&&(z+=we.twoOrMoreSolos);const re=f.some(te=>te.type==="adversary"&&te.item.type==="Bruiser"&&te.quantity>0),X=f.some(te=>te.type==="adversary"&&te.item.type==="Horde"&&te.quantity>0),Q=f.some(te=>te.type==="adversary"&&te.item.type==="Leader"&&te.quantity>0),ne=f.some(te=>te.type==="adversary"&&te.item.type==="Solo"&&te.quantity>0);return!re&&!X&&!Q&&!ne&&(z+=we.noBruisersHordesLeadersSolos),i+z-m})(),K=i=>{S(i),P(!1)},d=I!=="all";return u?e.jsx("div",{style:D.browser,children:e.jsx("div",{style:D.loading,children:"Loading..."})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:v?D.browserWrapper:D.browserWrapperNoContainer,children:[Y==="adversaries"&&e.jsxs(e.Fragment,{children:[e.jsx(Et,{searchTerm:ae,onSearchChange:_,type:t,partyControls:j}),e.jsx("div",{className:"browser-content invisible-scrollbar",style:D.browserContent,children:e.jsxs("table",{style:D.browserTable,children:[e.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,backgroundColor:"var(--bg-primary)"},children:e.jsx(At,{sortFields:C,onSort:N,type:t,uniqueTiers:V,uniqueTypes:O,selectedTiers:w,selectedTypes:J,showTierDropdown:g,setShowTierDropdown:E,showTypeDropdown:R,setShowTypeDropdown:U,tierFilterRef:ee,typeFilterRef:ie,handleTierSelect:s,handleTypeSelect:l,isTierFiltered:p,isTypeFiltered:o,getDropdownStyle:n,costFilter:I,showCostDropdown:Z,setShowCostDropdown:P,costFilterRef:q,handleCostFilterSelect:K,isCostFiltered:d})}),e.jsx("tbody",{children:H.map(i=>e.jsx(It,{item:i,onAdd:r,type:t,onRowClick:y,encounterItems:f,pcCount:c,playerTier:a,remainingBudget:W,costFilter:I,onAdversaryClick:m=>{t==="adversary"&&M(m)}},i.id))})]})})]}),Y==="encounters"&&e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:B.length===0?e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",textAlign:"center",padding:"2rem 1rem"},children:"No saved encounters yet"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:B.map(i=>e.jsxs("div",{onClick:()=>A&&A(i.id),style:{border:"1px solid var(--border)",borderRadius:"8px",padding:"8px",backgroundColor:"var(--bg-card)",transition:"all 0.2s",display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},onMouseEnter:m=>{m.target.style.backgroundColor="var(--bg-secondary)"},onMouseLeave:m=>{m.target.style.backgroundColor="var(--bg-card)"},children:[e.jsxs("div",{style:{minWidth:"100px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",flexDirection:"column",justifyContent:"center",minHeight:"60px"},children:[e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Tier: ",(()=>{var $,re,X,Q;const m=((Q=(X=(re=($=i.encounterItems)==null?void 0:$.filter(ne=>ne.type==="adversary"))==null?void 0:re.map(ne=>ne.item.tier))==null?void 0:X.filter(ne=>ne!=null))==null?void 0:Q.sort((ne,ce)=>ne-ce))||[];if(m.length===0)return"N/A";if(m.length===1)return m[0];const z=[...new Set(m)];return z.length===1?z[0]:`${Math.min(...z)}-${Math.max(...z)}`})()]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Party Size: ",i.partySize||4]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)"},children:["Balance: ",(()=>{const m=i.partySize||4,z=3*m+2;let $=0;const re=i.encounterItems||[];re.filter(oe=>oe.type==="adversary"&&oe.item.type==="Solo"&&oe.quantity>0).reduce((oe,ue)=>oe+ue.quantity,0)>=2&&($+=we.twoOrMoreSolos);const Q=re.some(oe=>oe.type==="adversary"&&oe.item.type==="Bruiser"&&oe.quantity>0),ne=re.some(oe=>oe.type==="adversary"&&oe.item.type==="Horde"&&oe.quantity>0),ce=re.some(oe=>oe.type==="adversary"&&oe.item.type==="Leader"&&oe.quantity>0),te=re.some(oe=>oe.type==="adversary"&&oe.item.type==="Solo"&&oe.quantity>0);!Q&&!ne&&!ce&&!te&&($+=we.noBruisersHordesLeadersSolos);const de=z+$,pe=re.reduce((oe,ue)=>{if(ue.type==="adversary"){const ge=ye[ue.item.type]||2;if(ue.item.type==="Minion"){const Se=Math.ceil(ue.quantity/m);return oe+Se*ge}else return oe+ue.quantity*ge}return oe},0);return pe>de?`+${pe-de}`:pe===de?"0":`-${de-pe}`})()]})]}),e.jsx("div",{style:{minWidth:"120px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",alignItems:"center",minHeight:"60px"},children:e.jsx("div",{style:{fontWeight:"500",color:"var(--text-primary)",fontSize:"0.9rem",wordWrap:"break-word",wordBreak:"break-word",width:"150px",maxWidth:"150px"},children:i.name})}),e.jsx(wt,{encounter:i}),e.jsx("button",{onClick:m=>{m.stopPropagation(),se(i.id)},style:{background:G[i.id]?"var(--danger)":"var(--gray-600)",border:"none",color:"white",padding:"0.4rem 0.8rem",borderRadius:"4px",fontSize:"0.75rem",cursor:"pointer",minWidth:"60px",transition:"background-color 0.2s"},children:"Delete"})]},i.id))})}),Y==="custom"&&e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"1rem",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("div",{style:{textAlign:"center",color:"var(--text-secondary)",fontSize:"1rem",marginBottom:"1rem"},children:"🛠️ Custom Adversary Creator"}),e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",textAlign:"center",maxWidth:"300px",lineHeight:"1.4"},children:"Create your own custom adversaries with unique stats, abilities, and features. This feature will be available soon!"}),e.jsx("button",{style:{marginTop:"1.5rem",padding:"0.75rem 1.5rem",backgroundColor:"var(--purple)",border:"none",color:"white",borderRadius:"6px",cursor:"pointer",fontSize:"0.9rem",opacity:.6,cursor:"not-allowed"},disabled:!0,children:"Coming Soon"})]})]}),T&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:2e3,display:"flex",alignItems:"center",justifyContent:"center",padding:"2rem"},onClick:()=>M(null),children:e.jsx("div",{style:{maxWidth:"600px",width:"90vw",maxHeight:"80vh",overflowY:"auto"},onClick:i=>i.stopPropagation(),children:e.jsx(Ve,{item:T,type:"adversary",mode:"expanded",onClose:()=>M(null)})})})]})},D={browserWrapper:{display:"flex",flexDirection:"column",background:"var(--bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border)",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserWrapperNoContainer:{display:"flex",flexDirection:"column",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserContent:{flex:1,overflowY:"auto",overflowX:"visible",padding:0,width:"100%",scrollbarWidth:"none",msOverflowStyle:"none"},tableHeaderContainer:{flexShrink:0,position:"sticky",top:0,zIndex:15,backgroundColor:"var(--bg-secondary)"},browserTable:{width:"100%",minWidth:"100%",borderCollapse:"collapse",tableLayout:"fixed",background:"var(--bg-primary)",margin:0},browserHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--gray-900)",flexShrink:0,position:"sticky",top:0,zIndex:20},browserTitle:{margin:0,color:"var(--text-primary)",fontSize:"18px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"24px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",marginRight:"12px",transition:"all 0.2s ease"},partyControls:{display:"flex",alignItems:"center",gap:"12px",flexShrink:0},searchInputFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 3px rgba(139, 92, 246, 0.1)"},tableHeader:{background:"var(--gray-900)",borderBottom:"1px solid var(--border)",boxShadow:"0 1px 0 var(--border)",position:"sticky",top:"0",zIndex:10},tableHeaderCell:{backgroundColor:"var(--gray-900)",fontWeight:"700",borderBottom:"1px solid var(--border)",cursor:"pointer",userSelect:"none",minWidth:"100px",whiteSpace:"nowrap",padding:"4px 4px",color:"var(--text-primary)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",boxShadow:"0 1px 0 var(--border)",transition:"background-color 0.2s",position:"sticky",top:"0",zIndex:10},tableHeaderCellHover:{backgroundColor:"var(--bg-hover)"},sortIndicator:{fontSize:"12px",color:"var(--text-secondary)"},tableBody:{flex:1,overflowY:"auto",padding:"8px",backgroundColor:"var(--bg-primary)"},row:{height:"35px",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s ease",cursor:"pointer",backgroundColor:"var(--gray-900)"},rowHover:{backgroundColor:"var(--bg-secondary)"},expandedRow:{backgroundColor:"var(--bg-secondary)"},rowCell:{padding:"4px 4px",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid var(--border)"},rowCellName:{fontWeight:"500",minWidth:"150px"},rowCellCenter:{textAlign:"center",justifyContent:"center",minWidth:"80px"},rowActions:{width:"80px",textAlign:"center",padding:"4px 8px",borderBottom:"1px solid var(--border)"},addButton:{width:"2rem",height:"2rem",border:"1px solid var(--purple)",borderRadius:"var(--radius-sm)",background:"var(--purple)",color:"white",cursor:"pointer",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"500"},expandedContent:{padding:"0",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)"},columnName:{width:"auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",paddingLeft:"8px",textAlign:"left"},columnTier:{width:"80px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnType:{width:"100px",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},columnDifficulty:{width:"40px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnAction:{width:"32px",minWidth:"24px",maxWidth:"24px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"visible",textOverflow:"unset"},loading:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"var(--text-primary)",fontSize:"16px"},mobileBrowser:{width:"95vw",height:"90vh",maxWidth:"none"},mobileSearchInput:{fontSize:"16px"},headerWithFilter:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0px",position:"relative"},headerFilterIcon:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"2px 4px",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",position:"relative",marginLeft:"-2px"},headerFilterIconActive:{color:"var(--purple)"},filterIcon:{fontSize:"12px"},filterActiveDot:{position:"absolute",left:"50%",top:"2px",transform:"translateX(-50%)",width:"4px",height:"4px",borderRadius:"50%",background:"var(--purple)",pointerEvents:"none"},filterDropdown:{position:"fixed",background:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",zIndex:99999,marginTop:"4px",overflow:"hidden",width:"max-content",minWidth:"120px",maxWidth:"200px"},filterOption:{padding:"8px 12px",cursor:"pointer",color:"var(--text-primary)",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background-color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},filterOptionSelected:{backgroundColor:"var(--bg-hover)"},checkIcon:{width:"16px",height:"16px",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"12px"},filterLabel:{flex:1}},Wt=()=>e.jsx("div",{className:"pwa-install-prompt",style:{}}),Tt=({side:t="left",children:r,className:x="",style:y={}})=>{const f=t==="left",c={flex:1,minWidth:0,background:"var(--bg-primary)",overflowY:"auto",overflowX:f?"auto":"hidden",display:f?"block":"flex",flexDirection:f?"initial":"column",height:"100%",padding:f?"8px 0 8px 0":"0 8px 0 0",...y};return e.jsx("div",{className:x,style:c,children:r})},Nt=t=>3*t+2,Bt={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},Ee={lessDifficult:-1,twoOrMoreSolos:-2,increasedDamage:-2,lowerTierAdversary:1,noBruisersHordesLeadersSolos:1,moreDangerous:2},Rt=({isOpen:t,onClose:r,onAddAdversary:x,onAddAdversariesBulk:y,onAddEnvironment:f,onDeleteAdversary:c,onDeleteEnvironment:a,onDeleteCountdown:j,adversaries:v=[],environments:B=[],countdowns:A=[],savedEncounters:L=[],onSaveEncounter:Y,onLoadEncounter:I,onDeleteEncounter:S})=>{const{partySize:Z,updatePartySize:P}=_e(),T=Z,M=P,[G,k]=h.useState({lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),[b,q]=h.useState([]),[se,ae]=h.useState(""),[_,C]=h.useState("adversaries"),[N,H]=h.useState(null),[u,w]=h.useState(null);h.useEffect(()=>{t&&!N&&se===""&&ae("Encounter")},[t,N,se]);const J=()=>u?se!==u.name||JSON.stringify(b)!==JSON.stringify(u.encounterItems)||T!==u.partySize||JSON.stringify(G)!==JSON.stringify(u.battlePointsAdjustments):!1,g=()=>{var d;if(b.length>0||se.trim()!=="Encounter")return!0;if(N&&J()){if(u){const i=b.length,m=((d=u.encounterItems)==null?void 0:d.length)||0;if(i!==m||se.trim()!==(u.name||""))return!0;const z=JSON.stringify(G),$=JSON.stringify(u.battlePointsAdjustments||{});return z!==$}return!0}return!1},E=({onClick:d,children:i,variant:m="secondary",isConfirmation:z=!1})=>{const $=m==="danger"||m==="secondary"&&z,re=m==="purple";return e.jsx("button",{onClick:d,style:{background:$?"var(--danger)":re?"var(--purple)":"var(--bg-secondary)",border:re?"none":"1px solid var(--border)",color:$||re?"white":"var(--text-primary)",padding:"0.375rem 0.75rem",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s",width:"70px",fontSize:"0.875rem"},children:i})},R=he.useRef(T);he.useEffect(()=>{if(t&&v.length>0&&b.length===0){const d={};v.forEach(m=>{var $;const z=m.baseName||(($=m.name)==null?void 0:$.replace(/\s+\(\d+\)$/,""))||m.name;d[z]||(d[z]={type:"adversary",item:m,quantity:0}),d[z].quantity+=1});const i=Object.values(d);q(i)}else t&&v.length===0&&q([])},[t]);const U=he.useMemo(()=>{let d=0;b.filter(X=>X.type==="adversary"&&X.item.type==="Solo"&&X.quantity>0).reduce((X,Q)=>X+Q.quantity,0)>=2&&(d+=Ee.twoOrMoreSolos);const m=b.some(X=>X.type==="adversary"&&X.item.type==="Bruiser"&&X.quantity>0),z=b.some(X=>X.type==="adversary"&&X.item.type==="Horde"&&X.quantity>0),$=b.some(X=>X.type==="adversary"&&X.item.type==="Leader"&&X.quantity>0),re=b.some(X=>X.type==="adversary"&&X.item.type==="Solo"&&X.quantity>0);return!m&&!z&&!$&&!re&&(d+=Ee.noBruisersHordesLeadersSolos),d},[b]),ee=Nt(T),ie=Object.entries(G).filter(([d,i])=>i).reduce((d,[i,m])=>d+Ee[i],0),V=ee+ie+U,O=b.reduce((d,i)=>{if(i.type==="adversary"){const m=Bt[i.item.type]||2;return i.item.type==="Minion"?d+Math.ceil(i.quantity/T)*m:d+m*i.quantity}return d},0);he.useEffect(()=>{const d=R.current;d!==T&&(q(i=>i.map(m=>{if(m.type==="adversary"&&m.item.type==="Minion"){const $=Math.ceil(m.quantity/d)*T;return{...m,quantity:$}}return m})),R.current=T)},[T]);const s=(d,i)=>{const m=b.findIndex(re=>re.item.id===d.id&&re.type===i),z=d.type==="Minion"?T:1;let $;m>=0?$=b.map((re,X)=>X===m?{...re,quantity:re.quantity+z}:re):$=[...b,{item:d,type:i,quantity:z}],q($),l($)},l=d=>{const i=v||[],m=[];d.forEach(Q=>{for(let ne=0;ne<Q.quantity;ne++)Q.type==="adversary"&&m.push(Q.item)});const z={};i.forEach(Q=>{var ce;const ne=Q.baseName||((ce=Q.name)==null?void 0:ce.replace(/\s+\(\d+\)$/,""))||Q.name;z[ne]||(z[ne]=[]),z[ne].push(Q)});const $={};m.forEach(Q=>{var ce;const ne=Q.baseName||((ce=Q.name)==null?void 0:ce.replace(/\s+\(\d+\)$/,""))||Q.name;$[ne]||($[ne]=[]),$[ne].push(Q)});const re=[],X=[];Object.keys($).forEach(Q=>{var te;const ne=((te=z[Q])==null?void 0:te.length)||0,ce=$[Q].length;if(ce>ne){const de=ce-ne;for(let pe=0;pe<de;pe++)re.push($[Q][0])}else if(ce<ne){const de=ne-ce,oe=[...z[Q]].sort((ue,ge)=>{const Se=ue.duplicateNumber||1;return(ge.duplicateNumber||1)-Se});for(let ue=0;ue<de;ue++)X.push(oe[ue].id)}}),Object.keys(z).forEach(Q=>{$[Q]||[...z[Q]].sort((te,de)=>{const pe=te.duplicateNumber||1;return(de.duplicateNumber||1)-pe}).forEach(te=>{X.push(te.id)})}),X.forEach(Q=>{c(Q)}),re.length>0&&y(re)},p=(d,i)=>{const m=(()=>{const z=b.findIndex($=>$.item.id===d&&$.type===i);if(z>=0){const $=b[z];if($.quantity===0)return b.filter((Q,ne)=>ne!==z);const re=$.item.type==="Minion"?T:1,X=Math.max(0,$.quantity-re);return b.map((Q,ne)=>ne===z?{...Q,quantity:X}:Q)}return b})();q(m),l(m)},o=h.useCallback(()=>{if(b.length===0)return null;const d=se.trim()||"Encounter",i=L.find(m=>{var re,X;if(m.name!==d||((re=m.encounterItems)==null?void 0:re.length)!==b.length)return!1;const z=JSON.stringify((X=m.encounterItems)==null?void 0:X.sort()),$=JSON.stringify([...b].sort());return z===$});return(i==null?void 0:i.id)||null},[L,se,b]),n=h.useCallback(()=>{let d=se.trim(),i=N;if(i||(i=o()),b.length===0&&(!d||d==="Encounter")&&i){S(i),H(null),w(null);return}const m={name:d,encounterItems:b,partySize:T,battlePointsAdjustments:G};if(i){m.id=i;const z=Y(m);H(z)}else{const z=Y(m);H(z)}w({name:d,encounterItems:b,partySize:T,battlePointsAdjustments:G})},[b,se,T,G,N,Y,o,S]);h.useEffect(()=>{if(N){const d=setTimeout(()=>{n()},1e3);return()=>clearTimeout(d)}else if(b.length>0){const d=setTimeout(()=>{n()},1e3);return()=>clearTimeout(d)}},[b,N,n]);const F=()=>{g()&&(q([]),ae("Encounter"),H(null),w(null),v.forEach(d=>{c(d.id)}),B.forEach(d=>{a(d.id)}),A.forEach(d=>{j(d.id)}))},W=d=>{const i=I(d);if(i){const m=i.encounterItems||[];q(m),M(i.partySize||4),k(i.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),ae(i.name||""),H(d),w({name:i.name||"",encounterItems:i.encounterItems||[],partySize:i.partySize||4,battlePointsAdjustments:i.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),l(m)}},K=d=>{S(d),N===d&&(q([]),ae("Encounter"),H(null),w(null),v.forEach(i=>{c(i.id)}),B.forEach(i=>{a(i.id)}),A.forEach(i=>{j(i.id)}))};return t?e.jsx("div",{onClick:r,className:"encounter-builder-modal",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:1e3,display:"flex",alignItems:"flex-start",justifyContent:"center",padding:"12px"},children:e.jsxs("div",{onClick:d=>d.stopPropagation(),style:{backgroundColor:"var(--bg-primary)",border:"2px solid var(--border)",borderRadius:"12px",width:"100%",maxWidth:"1200px",height:"calc(100vh - 24px)",maxHeight:"800px",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"},children:[e.jsxs("div",{className:"encounter-top-bar",style:{flex:"0 0 auto",display:"flex",alignItems:"center",height:"39px",backgroundColor:"var(--bg-primary)"},children:[e.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center"},children:[e.jsx("button",{onClick:()=>C("adversaries"),style:{flex:1,background:_==="adversaries"?"var(--gray-900)":"transparent",border:"none",borderBottom:"1px solid var(--border)",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:_==="adversaries"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Adversaries"}),e.jsx("button",{onClick:()=>C("encounters"),style:{flex:1,background:_==="encounters"?"var(--gray-900)":"transparent",border:"none",borderBottom:"1px solid var(--border)",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:_==="encounters"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Encounters"}),e.jsx("button",{onClick:()=>C("custom"),style:{flex:1,background:_==="custom"?"var(--gray-900)":"transparent",border:"none",borderBottom:"1px solid var(--border)",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:_==="custom"?"500":"400",transition:"all 0.2s ease",position:"relative"},children:"Custom Adversary"})]}),e.jsx("div",{className:"encounter-receipt-buttons",style:{flex:"0 0 350px",display:"flex",alignItems:"flex-start",justifyContent:"center",borderLeft:"1px solid var(--border)",height:"100%",padding:"1rem 0.75rem"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:se,onChange:d=>ae(d.target.value),placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(E,{onClick:F,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:g()?1:.5,cursor:g()?"pointer":"not-allowed"},children:"New"})]})})]}),e.jsxs("div",{className:"encounter-builder-content",style:{flex:1,display:"flex",overflow:"hidden"},children:[e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",borderTop:"1px solid var(--border)"},children:e.jsx(zt,{type:"adversary",onAddItem:d=>s(d,"adversary"),encounterItems:b,pcCount:T,showContainer:!1,savedEncounters:L,onLoadEncounter:W,onDeleteEncounter:K,activeTab:_})}),e.jsxs("div",{className:"encounter-right-panel",style:{flex:"0 0 350px",borderLeft:"1px solid var(--border)",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx("div",{className:"receipt-content",style:{padding:"1rem",display:"flex",flexDirection:"column",height:"100%"},children:e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"flex-start",overflowY:"auto",marginBottom:"0.75rem"},children:[e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>M(Math.max(1,T-1)),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(Be,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:T}),e.jsx("button",{onClick:()=>M(T+1),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(Re,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Party Size"})}),e.jsx("div",{style:{width:"120px",textAlign:"right"}})]}),b.map(d=>{var i;return d.type!=="adversary"?null:e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>p(d.item.id,d.type),style:{background:d.quantity===0?"var(--danger)":"var(--bg-secondary)",border:d.quantity===0?"none":"1px solid var(--border)",color:d.quantity===0?"white":"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:d.quantity===0?e.jsx(Te,{size:10}):e.jsx(Be,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:d.quantity}),e.jsx("button",{onClick:()=>s(d.item,d.type),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(Re,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:d.item.baseName||((i=d.item.name)==null?void 0:i.replace(/\s+\(\d+\)$/,""))||d.item.name})}),e.jsx("div",{style:{width:"80px",textAlign:"right"},children:e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.8rem"},children:d.item.type})})]},`${d.item.id}-${d.type}`)}),e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Balance"})}),e.jsx("div",{style:{width:"120px",textAlign:"right",display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsx("span",{style:{color:O>V?"var(--danger)":O===V?"var(--purple)":"var(--success)",fontWeight:600},children:O>V?`+${O-V}`:V-O===0?"0":`-${V-O}`})})]})]})}),e.jsx("div",{className:"encounter-receipt-buttons-vertical",style:{display:"none",padding:"0.75rem",borderTop:"1px solid var(--border)",backgroundColor:"var(--bg-primary)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:se,onChange:d=>ae(d.target.value),placeholder:"Encounter Name",style:{flex:1,padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",color:"var(--text-primary)",fontSize:"0.875rem"}}),e.jsx(E,{onClick:F,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:g()?1:.5,cursor:g()?"pointer":"not-allowed"},children:"New"})]})})]})]})]})}):null};class Lt extends he.Component{constructor(r){super(r),this.state={hasError:!1,error:null}}static getDerivedStateFromError(r){return{hasError:!0,error:r}}componentDidCatch(r,x){console.error("ErrorBoundary caught an error:",r,x)}render(){var r;return this.state.hasError?e.jsxs("div",{className:"p-md text-red",children:[e.jsx("h3",{children:"Something went wrong:"}),e.jsx("pre",{children:(r=this.state.error)==null?void 0:r.toString()}),e.jsx("button",{className:"btn-base btn-text",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try again"})]}):this.props.children}}const Mt=()=>{const{adversaries:t,environments:r,countdowns:x,fear:y,savedEncounters:f,updateFear:c,createAdversary:a,createAdversariesBulk:j,updateAdversary:v,deleteAdversary:B,createEnvironment:A,updateEnvironment:L,deleteEnvironment:Y,createCountdown:I,updateCountdown:S,deleteCountdown:Z,advanceCountdown:P,saveEncounter:T,loadEncounter:M,deleteEncounter:G}=_e(),[k,b]=h.useState(!1),[q,se]=h.useState(!1);h.useState(!1);const[ae,_]=h.useState(!1);h.useState(!0);const[C,N]=h.useState(null),[H,u]=h.useState(0),[w,J]=h.useState(0),[g,E]=h.useState(!1);h.useEffect(()=>{const n=()=>{const W=window.matchMedia("(max-width: 800px)");b(W.matches)};n();const F=window.matchMedia("(max-width: 800px)");return F.addEventListener("change",n),()=>F.removeEventListener("change",n)},[]);const R=12,U=n=>n===1?200:350,ee=n=>{if(n<=0)return{visibleColumns:1,columnWidth:U(1)};const F=R*2,W=n-F;let K={visibleColumns:1,columnWidth:W};for(let i=1;i<=5;i++){const m=(i-1)*R,z=(W-m)/i;z>=U(i)&&i*z+m<=W&&(K={visibleColumns:i,columnWidth:z})}return K.visibleColumns*K.columnWidth+(K.visibleColumns-1)*R>W&&(K={visibleColumns:1,columnWidth:W}),K},{visibleColumns:ie,columnWidth:V}=ee(H);h.useEffect(()=>{const n=()=>{u(window.innerWidth)};return n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]);const O=()=>{se(!0)},s=h.useCallback(()=>{se(!1)},[]),l=h.useCallback(n=>{J(n.target.scrollLeft)},[]);h.useCallback(()=>{E(!0)},[]),h.useCallback(()=>{setTimeout(()=>E(!1),100)},[]);const o=(()=>{const n={};return t.forEach(F=>{var K;const W=F.baseName||((K=F.name)==null?void 0:K.replace(/\s+\(\d+\)$/,""))||F.name;n[W]||(n[W]={type:"adversary",baseName:W,instances:[]}),n[W].instances.push(F)}),r.forEach(F=>{n[F.name]||(n[F.name]={type:"environment",baseName:F.name,instances:[]}),n[F.name].instances.push(F)}),x.forEach(F=>{n[`countdown-${F.id}`]={type:"countdown",baseName:F.name,instances:[F]}}),Object.values(n)})();return o.length,e.jsxs("div",{className:"app",onClick:n=>{n.target,n.currentTarget},children:[e.jsx(ht,{adversaries:t,environments:r,countdowns:x,deleteAdversary:B,deleteEnvironment:Y,deleteCountdown:Z,isClearMode:ae,setIsClearMode:_,sortAdversaries:()=>{},onOpenDatabase:O}),e.jsx("div",{className:"main-content",style:{position:"relative",width:"100%"},children:e.jsx("div",{className:"dashboard-scroll-container",style:{display:"flex",flexDirection:"row",overflowX:"auto",overflowY:"hidden",padding:`0 ${R}px`,scrollSnapType:"x mandatory",height:"100%",width:"100%"},onScroll:l,children:o.length===0?e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",width:"100%",padding:"2rem"},children:e.jsx("button",{onClick:O,style:{backgroundColor:"transparent",color:"var(--text-secondary)",border:"2px dashed var(--border)",borderRadius:"var(--radius-md)",padding:"1rem 2rem",fontSize:"1rem",fontWeight:"500",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:n=>{n.target.style.borderColor="var(--purple)",n.target.style.color="var(--purple)"},onMouseLeave:n=>{n.target.style.borderColor="var(--border)",n.target.style.color="var(--text-secondary)"},children:"Create Encounter"})}):o.map((n,F)=>e.jsx(Tt,{className:"invisible-scrollbar",style:{width:`${V+R}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:`${R}px`,paddingRight:"0",paddingTop:`${R}px`,paddingBottom:`${R}px`,scrollSnapAlign:"start",overflowY:"auto",overflowX:"hidden"},children:e.jsx(Ve,{type:n.type,item:{...n.instances[0],name:n.baseName,hp:0,stress:0,isDead:!1},mode:"expanded",instances:n.instances,onApplyDamage:n.type==="adversary"?(W,K,d,i)=>{const m=n.instances.find(z=>z.id===W);m&&v(W,{hp:Math.min(m.hpMax||1,(m.hp||0)+K)})}:void 0,onApplyHealing:n.type==="adversary"?(W,K,d)=>{const i=n.instances.find(m=>m.id===W);i&&v(W,{hp:Math.max(0,(i.hp||0)-K)})}:void 0,onApplyStressChange:n.type==="adversary"?(W,K)=>{var d,i;return v(W,{stress:Math.max(0,Math.min(((d=n.instances.find(m=>m.id===W))==null?void 0:d.stressMax)||6,(((i=n.instances.find(m=>m.id===W))==null?void 0:i.stress)||0)+K))})}:void 0,onUpdate:n.type==="adversary"?v:n.type==="environment"?L:S,adversaries:t})},`${n.type}-${n.baseName}`))})}),e.jsx(yt,{position:"bottom",children:e.jsx(ut,{type:"fear",value:(y==null?void 0:y.value)||0,maxValue:12,onChange:c,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0})}),e.jsx(Rt,{isOpen:q,onClose:s,onAddAdversary:n=>{a(n),N("adversary")},onAddAdversariesBulk:n=>{j(n),N("adversary")},onAddEnvironment:n=>{A(n),N("environment")},onDeleteAdversary:B,onDeleteEnvironment:Y,onDeleteCountdown:Z,adversaries:t,environments:r,countdowns:x,savedEncounters:f,onSaveEncounter:T,onLoadEncounter:M,onDeleteEncounter:G}),e.jsx(Wt,{})]})},Pt=()=>e.jsx(Lt,{children:e.jsx(Mt,{})});Ie.createRoot(document.getElementById("root")).render(e.jsx(he.StrictMode,{children:e.jsx(pt,{children:e.jsx(Pt,{})})}));
