import{r as y,a as ue,R as pe}from"./dndkit-57209f9c.js";import{X as je,D as G,C as ke,A as fe,M as Se,P as K,a as Ee,T as Ie,b as Ae,c as ee,F as De,S as te,d as re}from"./lucide-9be9e5df.js";import{F as Me,f as We,a as Le,b as Re,c as ne}from"./fa-b4bcccb0.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))i(d);new MutationObserver(d=>{for(const c of d)if(c.type==="childList")for(const h of c.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function s(d){const c={};return d.integrity&&(c.integrity=d.integrity),d.referrerPolicy&&(c.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?c.credentials="include":d.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(d){if(d.ep)return;d.ep=!0;const c=s(d);fetch(d.href,c)}})();var he={exports:{}},U={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Te=y,Ne=Symbol.for("react.element"),Be=Symbol.for("react.fragment"),Pe=Object.prototype.hasOwnProperty,ze=Te.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Oe={key:!0,ref:!0,__self:!0,__source:!0};function xe(e,r,s){var i,d={},c=null,h=null;s!==void 0&&(c=""+s),r.key!==void 0&&(c=""+r.key),r.ref!==void 0&&(h=r.ref);for(i in r)Pe.call(r,i)&&!Oe.hasOwnProperty(i)&&(d[i]=r[i]);if(e&&e.defaultProps)for(i in r=e.defaultProps,r)d[i]===void 0&&(d[i]=r[i]);return{$$typeof:Ne,type:e,key:c,ref:h,props:d,_owner:ze.current}}U.Fragment=Be;U.jsx=xe;U.jsxs=xe;he.exports=U;var t=he.exports,J={},oe=ue;J.createRoot=oe.createRoot,J.hydrateRoot=oe.hydrateRoot;function Z(e){const r=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return e?`${e}-${r}`:r}const Fe=(e,r)=>({createAdversary:h=>{const u=Z("adv"),a=e().adversaries||[],p=h.name||"Unknown",l=a.filter(g=>g.baseName===p);let n=1;if(l.length===0)n=1;else{const g=l.map(w=>w.duplicateNumber||1);let f=1;for(;g.includes(f);)f++;n=f}const o={...h,id:u,baseName:p,duplicateNumber:n,name:`${p} (${n})`,hp:0,stress:0,isVisible:!0};r(g=>({...g,adversaries:[...g.adversaries,o]}))},updateAdversary:(h,u)=>{r(a=>({...a,adversaries:a.adversaries.map(p=>{if(p.id===h){const l={...p,...u};if(u.baseName!==void 0){const n=u.baseName,o=l.duplicateNumber||1;l.name=o===1?n:`${n} (${o})`}return l}return p})}))},deleteAdversary:h=>{r(u=>({...u,adversaries:u.adversaries.filter(a=>a.id!==h)}))},reorderAdversaries:h=>{r(u=>{const[a,p]=h,l=[...u.adversaries],[n]=l.splice(a,1);return l.splice(p,0,n),{...u,adversaries:l}})}}),He=e=>({createCountdown:a=>{const p={id:Z("countdown"),name:a.name||"Countdown",max:parseInt(a.max)||1,value:0,visible:!0,type:a.type||"standard",loop:a.loop||"none",source:a.source||"campaign"};e(l=>({...l,countdowns:[...l.countdowns,p]}))},updateCountdown:(a,p)=>{e(l=>({...l,countdowns:l.countdowns.map(n=>n.id===a?{...n,...p}:n)}))},deleteCountdown:a=>{e(p=>({...p,countdowns:p.countdowns.filter(l=>l.id!==a)}))},advanceCountdown:(a,p)=>{e(l=>({...l,countdowns:l.countdowns.map(n=>{if(n.id!==a)return n;let o=p;if(n.loop==="loop")o>n.max?o=(o-1)%n.max+1:o<0&&(o=n.max);else if(n.loop==="increasing"){if(o>n.max)return{...n,max:n.max+1,value:1};if(o<0)return{...n,max:Math.max(1,n.max-1),value:1};o=Math.max(0,o)}else if(n.loop==="decreasing"){if(o>n.max)return{...n,max:Math.max(1,n.max-1),value:1};if(o<0)return{...n,max:n.max+1,value:1};o=Math.min(n.max,o)}else o=Math.max(0,Math.min(o,n.max));return{...n,value:o}})}))},incrementCountdown:(a,p=1)=>{e(l=>({...l,countdowns:l.countdowns.map(n=>{if(n.id!==a)return n;let o=n.value+p;if(n.loop==="loop")o>n.max&&(o=(o-1)%n.max+1);else if(n.loop==="increasing"){if(o>n.max)return{...n,max:n.max+1,value:1}}else if(n.loop==="decreasing"){if(o>n.max)return{...n,max:Math.max(1,n.max-1),value:1}}else o=Math.min(o,n.max);return{...n,value:o}})}))},decrementCountdown:a=>{e(p=>({...p,countdowns:p.countdowns.map(l=>{if(l.id!==a)return l;let n=l.value-1;if(l.loop==="loop")n<0&&(n=l.max);else if(l.loop==="increasing"){if(n<0)return{...l,max:Math.max(1,l.max-1),value:l.max};n=Math.max(0,n)}else if(l.loop==="decreasing"){if(n<0)return{...l,max:l.max+1,value:1}}else n=Math.max(0,n);return{...l,value:n}})}))},reorderCountdowns:a=>{e(p=>{const[l,n]=a,o=[...p.countdowns],[g]=o.splice(l,1);return o.splice(n,0,g),{...p,countdowns:o}})}}),Ve=(e,r)=>({createEnvironment:h=>{const u=Z("env"),p=(e().environments||[]).filter(o=>o.name.replace(/\s+\(\d+\)$/,"")===h.name);let l=h.name||"Unknown";if(p.length===0)l=h.name;else if(p.length===1){const o=p[0],g=o.name.replace(/\s+\(\d+\)$/,""),f=e().environments.map(w=>w.id===o.id?{...w,name:`${g} (1)`}:w);r(w=>({...w,environments:f})),l=`${h.name} (2)`}else{const o=p.map(f=>{const w=f.name.match(/\((\d+)\)$/);return w?parseInt(w[1]):null}).filter(f=>f!==null);let g=1;for(;o.includes(g);)g++;l=`${h.name} (${g})`}const n={...h,id:u,name:l,isVisible:!0};r(o=>({...o,environments:[...o.environments,n]}))},updateEnvironment:(h,u)=>{r(a=>({...a,environments:a.environments.map(p=>p.id===h?{...p,...u}:p)}))},deleteEnvironment:h=>{r(u=>({...u,environments:u.environments.filter(a=>a.id!==h)}))},reorderEnvironments:h=>{r(u=>{const[a,p]=h,l=[...u.environments],[n]=l.splice(a,1);return l.splice(p,0,n),{...u,environments:l}})}});function $e(e,r){const s=(e==null?void 0:e.type)||"standard";if(s==="standard")return 1;if(s==="progress"||s==="dynamic-progress")switch(r){case"success-hope":return 2;case"success-fear":return 1;case"critical-success":return 3;default:return 0}if(s==="consequence"||s==="dynamic-consequence")switch(r){case"success-fear":return 1;case"failure-hope":return 2;case"failure-fear":return 3;default:return 0}return s==="simple-fear"?r==="simple-fear"||r==="success-fear"||r==="failure-fear"?1:0:s==="simple-hope"&&(r==="simple-hope"||r==="success-hope"||r==="failure-hope"||r==="critical-success")?1:0}function _e(e){return((e==null?void 0:e.type)||"standard")==="standard"?1:0}function qe({adversaries:e,updateAdversary:r,deleteAdversary:s,selectedItem:i,setSelectedItem:d}){const c=y.useCallback((a,p,l,n)=>{var I,S;const o=e.find(A=>A.id===a);if(!o)return;const g=o.type==="Minion",f=(I=o.features)==null?void 0:I.find(A=>{var T;return(T=A.name)==null?void 0:T.startsWith("Minion (")}),w=f?parseInt(((S=f.name.match(/\((\d+)\)/))==null?void 0:S[1])||"1"):1;if(g){s(a);const A=Math.floor(p/w);if(A>0){const T=e.filter(N=>N.type==="Minion"&&N.id!==a&&N.name===o.name);for(let N=0;N<Math.min(A,T.length);N++)s(T[N].id)}return}const b=Math.min(l+p,n);i&&i.id===a&&d(A=>({...A,hp:b})),r(a,{hp:b})},[e,r,s,i,d]),h=y.useCallback((a,p,l)=>{const n=Math.max(0,l-p);i&&i.id===a&&d(o=>({...o,hp:n})),r(a,{hp:n})},[r,i,d]),u=y.useCallback((a,p,l,n)=>{const o=e.find(w=>w.id===a);if(!o)return;let g=l+p,f=o.hp||0;if(g>n){const w=g-n;g=n,f=Math.min(o.hpMax||0,f+w)}g=Math.max(0,g),i&&i.id===a&&d(w=>({...w,stress:g,hp:f})),r(a,{stress:g,hp:f})},[e,r,i,d]);return{handleAdversaryDamage:c,handleAdversaryHealing:h,handleAdversaryStressChange:u}}const R={card:{backgroundColor:"#1a1a1a",borderWidth:"1px",borderStyle:"solid",borderColor:"#333",borderRadius:"8px",padding:"12px",margin:"4px 0",cursor:"pointer",transition:"all 0.2s ease",position:"relative"},cardHover:{borderColor:"#555",backgroundColor:"#222"},cardDead:{opacity:.6,backgroundColor:"#0f0f0f",borderColor:"#444"},cardAtMax:{backgroundColor:"#0d4f0d",borderColor:"#28a745"},rowMain:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},rowTitle:{fontSize:"16px",fontWeight:"600",color:"#fff",margin:0},rowMeta:{display:"flex",gap:"8px",alignItems:"center"},cardActions:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px"},controlButtons:{display:"flex",gap:"8px",alignItems:"center"},pipSymbols:{display:"flex",gap:"4px",alignItems:"center",cursor:"pointer",padding:"2px"},pipSymbol:{fontSize:"16px",transition:"color 0.2s ease"},pipGroup:{display:"flex",gap:"4px",marginBottom:"4px"},badge:{padding:"2px 6px",borderRadius:"3px",fontSize:"10px",fontWeight:"600",textTransform:"uppercase"},typeBadge:{backgroundColor:"#6f42c1",color:"#fff"},difficultyBadge:{backgroundColor:"#4a5568",color:"#fff",cursor:"pointer",transition:"background-color 0.2s ease"},tierBadge:{backgroundColor:"#17a2b8",color:"#fff"},inputBase:{padding:"8px",borderWidth:"1px",borderStyle:"solid",borderColor:"#6b7280",borderRadius:"4px",backgroundColor:"#1a1a1a",color:"#ffffff",fontSize:"14px",transition:"all 0.2s ease"},inputBaseFocus:{outline:"none",borderColor:"#4f46e5",boxShadow:"0 0 0 2px rgba(79, 70, 229, 0.1)"},inputBaseDisabled:{opacity:.6,cursor:"not-allowed"},button:{backgroundColor:"#dc3545",color:"#fff",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.2s ease"},incrementButton:{backgroundColor:"#28a745",color:"#fff",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.2s ease"},decrementButton:{backgroundColor:"#ffc107",color:"#000",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.2s ease"},damageInputPopup:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,borderRadius:"8px"},damageInputContent:{backgroundColor:"#2a2a2a",borderWidth:"1px",borderStyle:"solid",borderColor:"#555",borderRadius:"8px",padding:"16px",display:"flex",flexDirection:"column",gap:"12px",minWidth:"200px"},damageInput:{backgroundColor:"#1a1a1a",borderWidth:"1px",borderStyle:"solid",borderColor:"#555",borderRadius:"4px",padding:"8px",color:"#fff",fontSize:"14px"},damageIndicators:{display:"flex",gap:"8px",alignItems:"center",justifyContent:"center"},damageDrop:{fontSize:"16px",color:"#666",cursor:"pointer",transition:"color 0.2s ease"},applyButton:{backgroundColor:"#28a745",color:"#fff",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.2s ease"}},Xe=(e,r,s,i)=>{const[d,c]=y.useState(!1),[h,u]=y.useState(""),a=g=>{g.stopPropagation(),g.preventDefault();const f=e.hp||0,w=e.hpMax||1,b=g.currentTarget.getBoundingClientRect(),I=g.clientX-b.left,S=b.width/w;Math.floor(I/S)<f?s&&s(e.id,1,e.hp):r&&r(e.id,1,e.hp,e.hpMax)},p=g=>{g.stopPropagation(),g.preventDefault();const f=e.stress||0,w=e.stressMax||1,b=g.currentTarget.getBoundingClientRect(),I=g.clientX-b.left,S=b.width/w;Math.floor(I/S)<f?i&&i(e.id,-1,e.stress,e.stressMax):i&&i(e.id,1,e.stress,e.stressMax)},l=g=>{g.stopPropagation(),(e.thresholds&&e.thresholds.major&&e.thresholds.severe||e.type==="Minion")&&(c(!0),u(e.type==="Minion"?"1":""))},n=()=>{const g=parseInt(h);if(g>0){if(e.type==="Minion")r&&r(e.id,g,e.hp,e.hpMax);else{let f=0;g>=e.thresholds.severe?f=3:g>=e.thresholds.major?f=2:g>=1&&(f=1),r&&r(e.id,f,e.hp,e.hpMax)}c(!1),u("")}};return{showDamageInput:d,damageValue:h,setDamageValue:u,setShowDamageInput:c,handleHpClick:a,handleStressClick:p,handleDifficultyClick:l,applyDamage:n,handleKeyDown:g=>{g.key==="Enter"?n():g.key==="Escape"&&(c(!1),u(""))}}},Ue=(e,r,s)=>({renderDistributedPips:()=>{const d=e.max,c=[];for(let h=0;h<d;h+=5){const u=Math.min(5,d-h);c.push(u)}return c.map((h,u)=>t.jsx("div",{style:R.pipGroup,children:Array.from({length:h},(a,p)=>{const l=u*5+p;return t.jsx("span",{style:{...R.pipSymbol,color:l<(e.value||0)?"#ff6b6b":"#666"},title:`${l+1} of ${e.max}`,children:l<(e.value||0)?"●":"○"},l)})},u))}}),X=({item:e,type:r,mode:s="compact",onClick:i,onDelete:d,onApplyDamage:c,onApplyHealing:h,onApplyStressChange:u,onIncrement:a,onDecrement:p,dragAttributes:l,dragListeners:n})=>{const o=r==="adversary"?Xe(e,c,h,u):null,g=r==="countdown"?Ue(e):null,[f,w]=y.useState(!1),b=()=>{let x={...R.card};return f&&(x={...x,...R.cardHover}),r==="adversary"&&(e.hp||0)>=(e.hpMax||1)&&(x={...x,...R.cardDead}),r==="countdown"&&(e.value||0)>=e.max&&(x={...x,...R.cardAtMax}),x},I=()=>{var x,j;if(r==="adversary"){const W=e.baseName||((x=e.name)==null?void 0:x.replace(/\s+\(\d+\)$/,""))||"",L=e.duplicateNumber||((j=e.name)!=null&&j.match(/\((\d+)\)$/)?parseInt(e.name.match(/\((\d+)\)$/)[1]):1);return`${W} (${L})`}return e.name},S=()=>{const x=[];return e.type&&x.push(t.jsx("span",{style:{...R.badge,...R.typeBadge},children:e.type},"type")),r==="environment"&&e.tier&&x.push(t.jsxs("span",{style:{...R.badge,...R.tierBadge},children:["Tier ",e.tier]},"tier")),x},A=()=>t.jsxs(t.Fragment,{children:[t.jsx("div",{style:R.pipSymbols,onClick:o.handleHpClick,children:Array.from({length:e.hpMax||1},(x,j)=>t.jsx("span",{style:{...R.pipSymbol,color:j<(e.hp||0)?"#ff6b6b":"#666"},title:j<(e.hp||0)?"Click to heal (reduce damage)":"Click to take damage",children:t.jsx(G,{size:16})},j))}),e.stressMax>0&&t.jsx("div",{style:R.pipSymbols,onClick:o.handleStressClick,children:Array.from({length:e.stressMax},(x,j)=>t.jsx("span",{style:{...R.pipSymbol,color:j<(e.stress||0)?"#ffd700":"#666"},title:j<(e.stress||0)?"Click to reduce stress":"Click to increase stress",children:t.jsx(fe,{size:16})},j))}),e.difficulty&&t.jsx("div",{onClick:o.handleDifficultyClick,style:{...R.badge,...R.difficultyBadge,cursor:e.thresholds&&e.thresholds.major&&e.thresholds.severe||e.type==="Minion"?"pointer":"default"},title:e.thresholds&&e.thresholds.major&&e.thresholds.severe?`Click to enter damage (thresholds: ${e.thresholds.major}/${e.thresholds.severe})`:e.type==="Minion"?"Click to enter damage (minion mechanics)":"",children:e.difficulty})]}),T=()=>null,N=()=>t.jsxs(t.Fragment,{children:[t.jsx("button",{style:R.decrementButton,onClick:x=>{x.stopPropagation(),x.preventDefault(),p&&p(e.id)},title:"Decrease progress",children:t.jsx(Se,{size:16})}),t.jsx("button",{style:R.incrementButton,onClick:x=>{x.stopPropagation(),x.preventDefault(),a&&a(e.id)},title:e.value>=e.max?e.loop&&e.loop!=="none"?"Loop countdown":"Countdown at max":"Increase progress",children:e.value>=e.max?e.loop&&e.loop!=="none"?"⟳":t.jsx(K,{size:16}):t.jsx(K,{size:16})})]}),P=()=>{switch(r){case"adversary":return A();case"environment":return T();case"countdown":return N();default:return null}},D=()=>r==="countdown"?t.jsx("div",{style:R.pipSymbols,children:g.renderDistributedPips()}):null,$=()=>r!=="adversary"||!o.showDamageInput||!(e.thresholds&&e.thresholds.major&&e.thresholds.severe||e.type==="Minion")?null:t.jsx("div",{style:R.damageInputPopup,onClick:x=>{x.stopPropagation(),x.target===x.currentTarget&&(o.setShowDamageInput(!1),o.setDamageValue(""))},children:t.jsxs("div",{style:R.damageInputContent,onClick:x=>x.stopPropagation(),children:[t.jsx("input",{type:"number",inputMode:"numeric",enterKeyHint:"done",placeholder:"Damage",min:e.type==="Minion"?"1":"0",value:o.damageValue,onChange:x=>o.setDamageValue(x.target.value),onKeyDown:o.handleKeyDown,style:R.damageInput,autoFocus:!0}),t.jsxs("div",{style:R.damageIndicators,children:[e.type==="Minion"?(()=>{var B,V;const x=parseInt(o.damageValue)||0,j=(B=e.features)==null?void 0:B.find(F=>{var v;return(v=F.name)==null?void 0:v.startsWith("Minion (")}),W=j?parseInt(((V=j.name.match(/\((\d+)\)/))==null?void 0:V[1])||"1"):1,L=Math.floor(x/W);return x>=W&&L>0?t.jsxs("span",{style:{...R.damageDrop,color:"#28a745"},title:`${x} damage can defeat ${L+1} minion${L+1!==1?"s":""} (1 + ${L} additional)`,children:["+",L," additional minion(s)"]}):t.jsx("span",{style:R.damageDrop,title:`${x} damage defeats this minion only`,children:"+0 additional minion(s)"})})():[1,2,3].map(x=>{const j=parseInt(o.damageValue)||0;let W=!1;return x===1&&j>=1&&(W=!0),x===2&&j>=e.thresholds.major&&(W=!0),x===3&&j>=e.thresholds.severe&&(W=!0),t.jsx("span",{style:{...R.damageDrop,color:W?"#ff6b6b":"#666"},onClick:L=>{L.stopPropagation(),x===1?o.setDamageValue("1"):x===2?o.setDamageValue(e.thresholds.major.toString()):x===3&&o.setDamageValue(e.thresholds.severe.toString())},title:`Click to set damage to ${x===1?"1":x===2?e.thresholds.major:e.thresholds.severe}`,children:t.jsx(G,{size:16})},x)}),t.jsx("button",{style:{...R.applyButton,backgroundColor:!o.damageValue||parseInt(o.damageValue)<1?"#666":"#28a745"},onClick:x=>{x.stopPropagation(),o.applyDamage()},title:"Apply damage",disabled:!o.damageValue||parseInt(o.damageValue)<1,children:t.jsx(ke,{size:16})})]})]})});return s!=="compact"?t.jsxs("div",{style:b(),children:[t.jsxs("div",{style:R.rowMain,children:[t.jsx("h4",{style:R.rowTitle,children:I()}),t.jsx("div",{style:R.rowMeta,children:S()})]}),t.jsx("p",{style:{color:"#666",fontSize:"12px",margin:0},children:"Expanded view coming soon"})]}):t.jsxs("div",{style:b(),onClick:i,onMouseEnter:()=>w(!0),onMouseLeave:()=>w(!1),...l,...n,children:[t.jsxs("div",{style:R.rowMain,children:[t.jsx("h4",{style:R.rowTitle,children:I()}),t.jsx("div",{style:R.rowMeta,children:S()})]}),D(),t.jsxs("div",{style:R.cardActions,children:[t.jsx("div",{style:R.controlButtons,children:P()}),t.jsx("div",{style:{display:"flex",alignItems:"center"},children:l&&n&&t.jsx("button",{style:R.button,onClick:x=>{x.stopPropagation(),x.preventDefault(),d&&d(e.id)},title:`Delete ${r}`,children:t.jsx(je,{size:16})})})]}),$()]})},ge=y.createContext();function Q(e){if(typeof localStorage>"u")return null;try{const r=localStorage.getItem(e);return r==null?null:JSON.parse(r)}catch{return null}}function me(e,r){if(!(typeof localStorage>"u"))try{localStorage.setItem(e,JSON.stringify(r))}catch{}}const ye=({children:e})=>{const[r,s]=y.useState({fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[]});y.useEffect(()=>{var W,L,B;const j=Q("daggerheart-game-state");if(j)try{(((W=j.adversaries)==null?void 0:W.length)>0||((L=j.environments)==null?void 0:L.length)>0||((B=j.countdowns)==null?void 0:B.length)>0)&&s(j)}catch(V){console.error("Failed to load saved state:",V)}},[]),y.useEffect(()=>{me("daggerheart-game-state",r)},[r]);const i=j=>{s(W=>({...W,fear:{...W.fear,value:j}}))},d=()=>{s(j=>({...j,fear:{...j.fear,visible:!j.fear.visible}}))},c=y.useRef(r);y.useEffect(()=>{c.current=r},[r]);const h=()=>c.current,u=He(s),a=Fe(h,s),p=Ve(h,s),{createCountdown:l,updateCountdown:n,deleteCountdown:o,advanceCountdown:g,incrementCountdown:f,decrementCountdown:w,reorderCountdowns:b}=u,{createAdversary:I,updateAdversary:S,deleteAdversary:A,reorderAdversaries:T}=a,{createEnvironment:N,updateEnvironment:P,deleteEnvironment:D,reorderEnvironments:$}=p,x={gameState:r,updateFear:i,toggleFearVisibility:d,createCountdown:l,updateCountdown:n,deleteCountdown:o,advanceCountdown:g,incrementCountdown:f,decrementCountdown:w,reorderCountdowns:b,createAdversary:I,updateAdversary:S,deleteAdversary:A,reorderAdversaries:T,createEnvironment:N,updateEnvironment:P,deleteEnvironment:D,reorderEnvironments:$};return t.jsx(ge.Provider,{value:x,children:e})},be=()=>{const e=y.useContext(ge);if(!e)return console.warn("useGameState: Context not available yet, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],updateFear:()=>{},toggleFearVisibility:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{gameState:r,...s}=e;if(!r)return console.warn("useGameState: gameState not available, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],updateFear:()=>{},toggleFearVisibility:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{fear:i,countdowns:d,adversaries:c,environments:h}=r;return{gameState:r,fear:i,countdowns:d,adversaries:c,environments:h,...s,hasCountdowns:d.length>0,hasAdversaries:c.length>0,hasEnvironments:h.length>0,getCountdownById:u=>d.find(a=>a.id===u),getAdversaryById:u=>c.find(a=>a.id===u),getEnvironmentById:u=>h.find(a=>a.id===u)}},Ye=(e,r)=>{const[s,i]=y.useState(()=>{const d=Q(e);return d??r});return y.useEffect(()=>{const d=Q(e);i(d??r)},[e]),y.useEffect(()=>{me(e,s)},[e,s]),[s,i]},se={fear:{icon:We,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"0.125rem",maxWidth:"none"},pipStyle:{fontSize:"var(--text-lg)",fontWeight:600,transition:"color 0.2s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0,imageRendering:"crisp-edges"},filledColor:"var(--purple)",emptyColor:"var(--gray-dark)",tooltipTitle:"Click anywhere in header to adjust fear:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease fear by 1"},{text:"Right of boundary:",description:"Click to increase fear by 1"}]},hp:{icon:Le,maxValue:20,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.2s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stress:{icon:Re,maxValue:12,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.2s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},countdown:{icon:ne,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.2s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust countdown:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease countdown by 1"},{text:"Right of boundary:",description:"Click to increase countdown by 1"}]},hpDots:{maxValue:20,containerStyle:{display:"flex",flexWrap:"wrap",gap:"2px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"all 0.2s ease"},filledStyle:{background:"var(--red)",borderColor:"var(--red)",boxShadow:"0 0 4px rgba(239, 68, 68, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stressDots:{maxValue:12,containerStyle:{display:"flex",flexWrap:"wrap",gap:"2px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"all 0.2s ease"},filledStyle:{background:"var(--purple)",borderColor:"var(--purple)",boxShadow:"0 0 4px rgba(139, 92, 246, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},adversaryHP:{icon:G,maxValue:20,containerStyle:{display:"flex",gap:"0.125rem",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"all 0.2s ease",cursor:"pointer"},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click to adjust HP:",tooltipInstructions:[{text:"Filled pip:",description:"Click to heal (reduce damage)"},{text:"Empty pip:",description:"Click to take damage"}]},adversaryStress:{icon:fe,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"all 0.2s ease",cursor:"pointer"},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click to adjust stress:",tooltipInstructions:[{text:"Filled pip:",description:"Click to reduce stress"},{text:"Empty pip:",description:"Click to increase stress"}]},countdownDistributed:{icon:ne,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.2s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Countdown progress:",tooltipInstructions:[{text:"Progress:",description:"Current countdown value"}]}},Ge=({type:e="fear",value:r=0,maxValue:s,onChange:i,size:d="lg",showTooltip:c=!0,containerStyle:h={},pipStyle:u={},countdownType:a=null,distributedGroups:p=null,onPipClick:l=null,enableBoundaryClick:n=!1,clickContainerWidth:o="auto",centerPips:g=!0})=>{const[f,w]=y.useState(!1),b=se[e]||se.fear,I=s||b.maxValue,S=Math.max(0,Math.min(I,r));let A=b.filledColor;e==="countdown"&&a&&(["progress","dynamic-progress","simple-hope"].includes(a)?A="var(--gold)":["consequence","dynamic-consequence","simple-fear"].includes(a)?A="var(--purple)":["long-term","standard"].includes(a)&&(A="var(--text-secondary)"));const T=(x,j)=>{if(l)l(x,j);else if(i){const W=x+1;i(W)}},N=x=>{if(!n||!i||l)return;x.currentTarget.getBoundingClientRect();const j=x.currentTarget.querySelector(".pip-container");if(!j){console.warn("Could not find .pip-container element");return}const W=j.getBoundingClientRect(),L=x.clientX-W.left;if(L<0){S>0&&i(S-1);return}if(L>W.width){S<I&&i(S+1);return}const B=W.width,V=B*.05,F=B-2*V,v=L-V,C=S/I,z=F*C;v<z?S>0&&i(S-1):S<I&&i(S+1)},D=(()=>{if(!p||e!=="countdownDistributed")return[{start:0,end:I,groupIndex:0}];let x=0;return p.map((j,W)=>{const L={start:x,end:x+j,groupIndex:W};return x+=j,L})})(),$=()=>t.jsxs(t.Fragment,{children:[D.map(x=>t.jsx("div",{style:{display:"inline-block"},children:[...Array(x.end-x.start)].map((j,W)=>{const L=x.start+W,B=L<S;if(b.isDots)return t.jsx("div",{style:{...b.pipStyle,...B?b.filledStyle:b.emptyStyle,...u,cursor:i||l?"pointer":"default"},onClick:n?void 0:()=>T(L,B),title:`${L+1} of ${I}`},L);{const V=b.icon,F=V&&typeof V=="object"&&V.iconName;return t.jsx("span",{className:`fear-pip ${B?"filled":"empty"}`,style:{...b.pipStyle,color:B?A:b.emptyColor,cursor:i||l?"pointer":"default",...u},onClick:n?void 0:()=>T(L,B),title:`${L+1} of ${I}`,children:F?t.jsx(Me,{icon:V,size:d}):t.jsx(V,{size:16})},L)}})},x.groupIndex)),c&&t.jsx("div",{style:{position:"relative",cursor:"help",pointerEvents:"none"},children:t.jsxs("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:f?"translateX(-50%) translateY(-5px)":"translateX(-50%)",background:"rgba(15, 23, 42, 0.95)",border:"1px solid var(--gray)",borderRadius:"var(--radius-md)",padding:"var(--space-md)",minWidth:"250px",zIndex:1e3,opacity:f?1:0,visibility:f?"visible":"hidden",transition:"all 0.2s ease",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.5)"},children:[t.jsx("div",{style:{fontWeight:600,color:"#e2e8f0",marginBottom:"0.75rem",fontSize:"var(--text-sm)"},children:b.tooltipTitle}),b.tooltipInstructions.map((x,j)=>t.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.8rem",color:"#cbd5e1",lineHeight:1.4},children:[t.jsx("strong",{style:{color:"#e2e8f0"},children:x.text})," ",x.description]},j))]})})]});return t.jsx("div",{style:{width:o,height:"100%",cursor:i||l?"pointer":"default",touchAction:"manipulation",userSelect:"none",display:g?"flex":"block",alignItems:g?"center":"stretch",justifyContent:g?"center":"flex-start",...h},onClick:n?N:void 0,onMouseEnter:()=>w(c),onMouseLeave:()=>w(!1),children:t.jsx("div",{className:"pip-container",style:{...b.containerStyle,display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},children:$()})})},Ke="/Daggerheart/assets/daggerheart-logo-fe7815ad.svg",Je=()=>{const[e,r]=y.useState(!1);return y.useEffect(()=>{const s=i=>{i.target.closest(".help-button")||r(!1)};return document.addEventListener("click",s),()=>document.removeEventListener("click",s)},[]),t.jsxs("div",{className:"help-button",style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",padding:"0.5rem",color:"var(--text-primary)",borderRadius:"var(--radius-md)",cursor:"pointer",transition:"background-color 0.2s ease",minWidth:"44px",minHeight:"44px",backgroundColor:e?"var(--purple)":"transparent"},onMouseEnter:s=>{e||(s.target.style.backgroundColor="var(--gray-dark)")},onMouseLeave:s=>{e||(s.target.style.backgroundColor="transparent")},onClick:s=>{s.stopPropagation(),r(!e)},title:"Help & Info",children:[t.jsx("div",{style:{width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center",color:"inherit"},children:t.jsx(Ee,{size:20})}),t.jsxs("div",{style:{position:"absolute",bottom:"100%",left:window.innerWidth<=800?"auto":"50%",right:window.innerWidth<=800?"0":"auto",transform:window.innerWidth<=800?"none":"translateX(-50%)",background:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,opacity:e?1:0,visibility:e?"visible":"hidden",transition:"opacity 0.2s ease, visibility 0.2s ease, transform 0.2s ease",pointerEvents:e?"auto":"none",minWidth:"280px",maxWidth:window.innerWidth<=800?"calc(100vw - 2rem)":"320px",marginBottom:window.innerWidth<=800?"0.5rem":"0"},children:[t.jsxs("div",{style:{padding:"0.75rem",borderTop:"1px solid rgba(255, 255, 255, 0.1)",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",background:"var(--bg-primary)",maxWidth:"280px"},children:[t.jsx("img",{src:Ke,alt:"Daggerheart Community Content Logo",style:{width:"100%",maxWidth:"200px",height:"auto",margin:"0 auto 0.75rem auto",display:"block"},onError:s=>{console.error("Failed to load Daggerheart logo:",s.target.src),s.target.style.display="none";const i=document.createElement("div");i.style.cssText="text-align: center; margin-bottom: 0.75rem; font-size: 1.5rem; font-weight: bold; color: var(--purple);",i.textContent="⚔️ DAGGERHEART ⚔️",s.target.parentNode.insertBefore(i,s.target)},onLoad:()=>{}}),t.jsxs("div",{style:{fontSize:"0.7rem",lineHeight:1.3,color:"var(--text-secondary)",textAlign:"left",wordWrap:"break-word",overflowWrap:"break-word"},children:[t.jsx("p",{children:"This product includes materials from the Daggerheart System Reference Document 1.0, © Critical Role, LLC, under the terms of the Darrington Press Community Gaming (DPCGL) License."}),t.jsxs("p",{children:["More information can be found at ",t.jsx("a",{href:"https://www.daggerheart.com",target:"_blank",rel:"noopener noreferrer",children:"daggerheart.com"})]}),t.jsx("p",{children:t.jsx("em",{children:"This project is unofficial and not endorsed by Darrington Press or Critical Role."})})]})]}),t.jsx("button",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"0.25rem 1rem",color:"var(--text-primary)",border:"none",background:"none",width:"100%",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"0.875rem",minHeight:"32px",borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},onMouseEnter:s=>{s.target.style.backgroundColor="var(--gray-dark)"},onMouseLeave:s=>{s.target.style.backgroundColor="transparent"},onClick:s=>{s.stopPropagation(),r(!1),window.open("https://github.com/Splinter714/Daggerheart","_blank")},children:t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.25rem"},children:t.jsx("span",{children:"GitHub"})})}),t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"0.25rem 1rem",color:"var(--text-secondary)",border:"none",background:"none",width:"100%",textAlign:"left",cursor:"default",fontSize:"0.875rem",minHeight:"32px"},children:t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.25rem"},children:t.jsxs("span",{children:["Version ","dev (c370af4)"]})})})]})]})},Qe=({adversaries:e,environments:r,countdowns:s,deleteAdversary:i,deleteEnvironment:d,deleteCountdown:c})=>{const[h,u]=y.useState(!1);y.useEffect(()=>{const f=w=>{w.target.closest(".delete-clear-container")||u(!1)};return document.addEventListener("click",f),()=>document.removeEventListener("click",f)},[]);const a=((e==null?void 0:e.length)||0)>0||((r==null?void 0:r.length)||0)>0||((s==null?void 0:s.length)||0)>0,p=(e||[]).some(f=>(f.hp||0)<=0),l={position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",padding:"0.5rem",minWidth:"200px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,display:h?"block":"none"},n={background:"none",border:"none",color:a?"var(--text-primary)":"var(--text-secondary)",cursor:a?"pointer":"not-allowed",padding:"0.5rem",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s",opacity:a?1:.5},o={background:"none",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:"0.5rem",borderRadius:"var(--radius-sm)",width:"100%",textAlign:"left",display:"flex",alignItems:"center",gap:"0.5rem",transition:"background-color 0.2s"},g={backgroundColor:"var(--bg-hover)"};return t.jsxs("div",{className:"delete-clear-container",style:{position:"relative"},children:[t.jsx("button",{style:n,onClick:f=>{f.stopPropagation(),a&&u(!h)},title:a?"Clear Items":"Nothing to clear",children:t.jsx(Ie,{size:20})}),t.jsxs("div",{style:l,children:[e&&e.length>0&&t.jsxs("button",{style:o,onMouseEnter:f=>Object.assign(f.target.style,g),onMouseLeave:f=>Object.assign(f.target.style,o),onClick:f=>{f.stopPropagation(),u(!1),e.forEach(w=>i(w.id))},children:[t.jsx("span",{children:"×"}),t.jsx("span",{children:"All Adversaries"})]}),e&&e.length>0&&p&&t.jsxs("button",{style:o,onMouseEnter:f=>Object.assign(f.target.style,g),onMouseLeave:f=>Object.assign(f.target.style,o),onClick:f=>{f.stopPropagation(),u(!1),e.filter(b=>(b.hp||0)<=0).forEach(b=>i(b.id))},children:[t.jsx("span",{children:"×"}),t.jsx("span",{children:"Dead Adversaries"})]}),r&&r.length>0&&t.jsxs("button",{style:o,onMouseEnter:f=>Object.assign(f.target.style,g),onMouseLeave:f=>Object.assign(f.target.style,o),onClick:f=>{f.stopPropagation(),u(!1),r.forEach(w=>d(w.id))},children:[t.jsx("span",{children:"×"}),t.jsx("span",{children:"All Environments"})]}),s&&s.length>0&&t.jsxs("button",{style:o,onMouseEnter:f=>Object.assign(f.target.style,g),onMouseLeave:f=>Object.assign(f.target.style,o),onClick:f=>{f.stopPropagation(),u(!1),s.forEach(w=>c(w.id))},children:[t.jsx("span",{children:"×"}),t.jsx("span",{children:"All Countdowns"})]})]})]})},ie=({position:e="top",children:r,onClick:s,className:i="",style:d={}})=>{const c=e==="top",h={background:"var(--bg-primary)",borderTop:c?"none":"1px solid var(--border)",borderBottom:c?"1px solid var(--border)":"none",padding:c?"0.25rem 0":"0.5rem",position:"sticky",[c?"top":"bottom"]:0,zIndex:c?10:100,order:c?1:3,flexShrink:0,touchAction:"manipulation",userSelect:"none",display:"flex",flexDirection:c?"column":"row",justifyContent:c?"stretch":"center",alignItems:c?"stretch":"center",height:c?"auto":"100%",...d};return t.jsx("div",{className:i,style:h,onClick:s,children:r})},ae=({side:e="left",children:r,className:s="",style:i={}})=>{const d=e==="left",c={flex:1,minWidth:0,background:"var(--bg-primary)",overflowY:"auto",overflowX:d?"auto":"hidden",display:d?"block":"flex",flexDirection:d?"initial":"column",height:"100%",...i};return t.jsx("div",{className:s,style:c,children:r})},le=({items:e,onDelete:r,onEdit:s,onToggleVisibility:i,onReorder:d,onItemSelect:c,selectedItem:h,selectedType:u,onApplyDamage:a,onApplyHealing:p,onApplyStressChange:l,onIncrement:n,onDecrement:o,isEditMode:g,elementType:f})=>{if(!e||e.length===0)return null;const w=b=>{const I={item:b,mode:"compact",onClick:()=>c(b,f),onDelete:r,dragAttributes:g?{draggable:!0}:null,dragListeners:g?{onDragStart:S=>{S.dataTransfer.setData("text/plain",b.id)}}:null};switch(f){case"adversaries":return t.jsx(X,{...I,type:"adversary",onApplyDamage:a,onApplyHealing:p,onApplyStressChange:l},b.id);case"environments":return t.jsx(X,{...I,type:"environment",onEdit:s},b.id);case"countdowns":return t.jsx(X,{...I,type:"countdown",onIncrement:n,onDecrement:o},b.id);default:return null}};return t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:e.map(w)})},Y=({elementType:e,title:r,sectionKey:s,items:i=[],sectionVisibility:d,toggleSection:c,onOpenDatabase:h,onDeleteItem:u,onEditItem:a,onToggleVisibility:p,onReorder:l,onItemSelect:n,selectedItem:o,selectedType:g,isEditMode:f,onApplyDamage:w,onApplyHealing:b,onApplyStressChange:I,onIncrement:S,onDecrement:A,showInlineCreator:T,onToggleInlineCreator:N,onCreateCountdown:P,fear:D,updateFear:$,handleRollOutcome:x,handleActionRoll:j,showLongTermCountdowns:W,setShowLongTermCountdowns:L,onRestTrigger:B,triggers:V})=>{const F=i&&i.length>0,v=!!(d!=null&&d[s]);return t.jsxs("div",{style:{marginBottom:"2rem"},children:[t.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.25rem",marginBottom:"0.25rem",position:"relative",paddingLeft:"0.25rem",paddingTop:"0.75rem"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",position:"relative",width:"100%"},children:[t.jsxs("button",{onClick:()=>c(s),title:F?v?"Collapse section":"Expand section":"No items to expand",disabled:!F,style:{display:"flex",alignItems:"center",gap:"0.75rem",background:"none",border:"none",color:F?"var(--text-primary)":"var(--text-secondary)",cursor:F?"pointer":"default",padding:"0.25rem 0.5rem",fontSize:"inherit",fontWeight:"inherit",transition:"opacity 0.2s ease",borderRadius:"var(--radius-sm)",opacity:F?1:.6},children:[F?t.jsx("div",{style:{width:"16px",height:"16px",transition:"transform 0.2s ease",transform:v?"rotate(0deg)":"rotate(-90deg)"},children:t.jsx(Ae,{size:16})}):t.jsx("div",{style:{width:"16px",height:"16px",flexShrink:0}}),t.jsx("h3",{style:{fontSize:"var(--text-base)",fontWeight:600,color:"var(--text-primary)",margin:0,padding:0,lineHeight:1.2,textTransform:"uppercase",letterSpacing:"0.05em",whiteSpace:"nowrap",width:"140px",flexShrink:0,textAlign:"left"},children:r})]}),t.jsx("button",{className:"btn-icon","data-color":"purple",onClick:()=>h(e),title:`Browse ${r}`,"aria-label":`Browse ${r}`,children:t.jsx(K,{size:16})})]})}),e==="countdowns"&&(T==null?void 0:T.campaign)&&t.jsxs("div",{className:"inline-countdown-creator",children:[t.jsx("p",{children:"Inline Countdown Creator - Coming Soon"}),t.jsx("button",{className:"btn-text",onClick:()=>N("campaign"),children:"Cancel"})]}),e==="countdowns"&&v&&i&&i.length>0&&t.jsx("div",{className:"countdown-trigger-controls",children:t.jsx("p",{children:"Countdown Trigger Controls - Coming Soon"})}),v&&t.jsx(le,{items:i,onDelete:C=>u(C,e),onEdit:C=>a(C,e),onToggleVisibility:p,onReorder:l,onItemSelect:n,selectedItem:o,selectedType:g,onApplyDamage:w,onApplyHealing:b,onApplyStressChange:I,onIncrement:S,onDecrement:A,isEditMode:f,elementType:e}),e==="countdowns"&&v&&W&&i&&i.filter(C=>C.type==="long-term").length>0&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"long-term-rest-controls",children:[t.jsxs("button",{className:"btn-text",onClick:C=>{C.stopPropagation(),B("short")},title:"Short Rest",children:[t.jsx(ee,{size:16})," Short Rest"]}),t.jsxs("button",{className:"btn-text",onClick:C=>{C.stopPropagation(),B("long")},title:"Long Rest",children:[t.jsx(ee,{size:16})," Long Rest"]})]}),t.jsx(le,{items:i.filter(C=>C.type==="long-term"),onDelete:C=>u(C,e),onEdit:C=>a(C,e),onReorder:l,onItemSelect:n,selectedItem:o,selectedType:g,onIncrement:S,onDecrement:A,isEditMode:f,elementType:e})]})]})},Ze=({onItemSelect:e,selectedItem:r,selectedType:s,onOpenDatabase:i,isEditMode:d,showLongTermCountdowns:c,fear:h,updateFear:u,handleRollOutcome:a,handleActionRoll:p,setShowLongTermCountdowns:l,lastAddedItemType:n})=>{const{adversaries:o,environments:g,updateAdversary:f,deleteAdversary:w,reorderAdversaries:b,updateEnvironment:I,deleteEnvironment:S,reorderEnvironments:A,countdowns:T,createCountdown:N,deleteCountdown:P,reorderCountdowns:D,incrementCountdown:$,decrementCountdown:x}=be(),[j,W]=y.useState({adversary:!1,environment:!1,campaign:!1}),[L,B]=Ye("sectionVisibility",{countdowns:!1,environments:!1,adversaries:!1});y.useEffect(()=>{n&&(n==="environment"?B(E=>({...E,environments:!0})):n==="adversary"?B(E=>({...E,adversaries:!0})):n==="countdown"&&B(E=>({...E,countdowns:!0})))},[n,B]);const V=E=>{const m=E==="adversaries"?o:E==="environments"?g:E==="countdowns"?T:[];m&&m.length>0&&B(k=>({...k,[E]:!k[E]}))},F=(E,m)=>{},v=E=>{W(m=>({...m,[E]:!m[E]}))},C=E=>{N(E),W(m=>({...m,[E.source]:!1})),B(m=>({...m,countdowns:!0}))},z=E=>{i(E)},H=(E,m)=>{m==="environment"?S(E):m==="adversary"?w(E):m==="countdown"&&P(E),r&&r.id===E&&e(null,null)},q=E=>{};return t.jsx("div",{style:{display:"flex",flexDirection:"column",height:"100%",background:"var(--bg-primary)"},children:t.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:[t.jsx(Y,{elementType:"countdowns",title:"Countdowns",sectionKey:"countdowns",items:T,sectionVisibility:L,toggleSection:V,showInlineCreator:j,onToggleInlineCreator:v,onCreateCountdown:C,fear:h,updateFear:u,handleRollOutcome:a,handleActionRoll:p,showLongTermCountdowns:c,setShowLongTermCountdowns:l,onDeleteItem:H,onEditItem:F,onReorder:D,onItemSelect:e,selectedItem:r,selectedType:s,onIncrement:$,onDecrement:x,isEditMode:d,onRestTrigger:q}),t.jsx(Y,{elementType:"environments",title:"Environments",sectionKey:"environments",items:g,sectionVisibility:L,toggleSection:V,onOpenDatabase:z,onDeleteItem:H,onEditItem:F,onToggleVisibility:E=>{const m=g.find(k=>k.id===E);m&&I(E,{isVisible:!m.isVisible})},onReorder:A,onItemSelect:e,selectedItem:r,selectedType:s,isEditMode:d}),t.jsx(Y,{elementType:"adversaries",title:"Adversaries",sectionKey:"adversaries",items:o,sectionVisibility:L,toggleSection:V,onOpenDatabase:z,onDeleteItem:H,onEditItem:F,onToggleVisibility:E=>{const m=o.find(k=>k.id===E);m&&f(E,{isVisible:!m.isVisible})},onReorder:b,onItemSelect:e,selectedItem:r,selectedType:s,onApplyDamage:(E,m,k,O)=>{const _=Math.min(O,k+m);f(E,{hp:_})},onApplyHealing:(E,m,k)=>{if(o.find(_=>_.id===E)){const _=Math.max(0,k-m);f(E,{hp:_})}},onApplyStressChange:(E,m)=>{const k=o.find(O=>O.id===E);if(k){let O=k.stress+m,_=k.hp||0;if(O>k.stressMax){const Ce=O-k.stressMax;O=k.stressMax,_=Math.min(k.hpMax,_+Ce)}else O<0&&(O=0);f(E,{stress:O,hp:_})}},isEditMode:d})]})})};function et({headerSelector:e=".drawer-header",closeThreshold:r=100,snapThreshold:s=30,onClose:i}={}){const[d,c]=y.useState(null),[h,u]=y.useState(null),[a,p]=y.useState(0),[l,n]=y.useState(!1),o=y.useCallback(b=>{var T,N;const I=b.target;if(!(e?I.closest(e):!1))return;const A=((N=(T=b.targetTouches)==null?void 0:T[0])==null?void 0:N.clientY)??0;c(A),u(A),p(0),n(!1)},[e]),g=y.useCallback(b=>{var T,N;if(d==null)return;const I=((N=(T=b.targetTouches)==null?void 0:T[0])==null?void 0:N.clientY)??0,S=I-d,A=6;!l&&Math.abs(S)>A&&n(!0),l&&(b.preventDefault(),b.stopPropagation(),u(I),p(Math.max(0,S)))},[d,l]),f=y.useCallback(b=>{if(d==null||h==null)return;const I=h-d;l?(b.preventDefault(),b.stopPropagation(),I>r?(p(window.innerHeight),typeof i=="function"&&setTimeout(()=>i(),300)):I>s?(p(0),setTimeout(()=>{c(null),u(null),n(!1)},50)):(p(0),c(null),u(null),n(!1))):(p(0),c(null),u(null),n(!1))},[d,h,l,r,s,i]),w=y.useCallback(()=>{p(0),c(null),u(null)},[]);return{drawerOffset:a,setDrawerOffset:p,touchHandlers:{onTouchStart:o,onTouchMove:g,onTouchEnd:f},resetSwipeState:w}}const tt=({isOpen:e,onClose:r,children:s})=>{const{drawerOffset:i,setDrawerOffset:d,touchHandlers:c,resetSwipeState:h}=et({headerSelector:".drawer-header",closeThreshold:100,snapThreshold:30,onClose:r});return t.jsx("div",{className:"mobile-drawer",children:t.jsxs("div",{className:"drawer-content",style:{transform:`translateY(${i}px)`,transition:i===0?"transform 0.3s ease-out":"none"},...c,children:[t.jsx("div",{className:"drawer-header",children:"Mobile Drawer - Coming Soon"}),s]})})},rt=()=>t.jsx("div",{className:"pwa-install-prompt",style:{}}),nt="modulepreload",ot=function(e){return"/Daggerheart/"+e},de={},ce=function(r,s,i){if(!s||s.length===0)return r();const d=document.getElementsByTagName("link");return Promise.all(s.map(c=>{if(c=ot(c),c in de)return;de[c]=!0;const h=c.endsWith(".css"),u=h?'[rel="stylesheet"]':"";if(!!i)for(let l=d.length-1;l>=0;l--){const n=d[l];if(n.href===c&&(!h||n.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${u}`))return;const p=document.createElement("link");if(p.rel=h?"stylesheet":nt,h||(p.as="script",p.crossOrigin=""),p.href=c,document.head.appendChild(p),h)return new Promise((l,n)=>{p.addEventListener("load",l),p.addEventListener("error",()=>n(new Error(`Unable to preload CSS for ${c}`)))})})).then(()=>r()).catch(c=>{const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=c,window.dispatchEvent(h),!h.defaultPrevented)throw c})};let ve={adversaries:[]},we={environments:[]};const st=async()=>{try{const e=await ce(()=>import("./adversaries-39098dcd.js"),[]);ve=(e==null?void 0:e.default)||e}catch(e){console.warn("Failed to load adversaries.json:",e)}try{const e=await ce(()=>import("./environments-f019e73d.js"),[]);we=(e==null?void 0:e.default)||e}catch(e){console.warn("Failed to load environments.json:",e)}},it=e=>{const[r,s]=y.useState(""),[i,d]=y.useState([{field:"name",direction:"asc"}]),[c,h]=y.useState(null),[u,a]=y.useState([]),[p,l]=y.useState(!0),[n,o]=y.useState([]),[g,f]=y.useState([]),[w,b]=y.useState(!1),[I,S]=y.useState(!1),A=y.useRef(null),T=y.useRef(null);y.useEffect(()=>{(async()=>{await st(),l(!1);let C=[];e==="adversary"?C=ve.adversaries||[]:e==="environment"&&(C=we.environments||[]),a(C)})()},[e]);const N=v=>{const C=u.map(z=>z[v]).filter(Boolean);return[...new Set(C)].sort((z,H)=>typeof z=="number"&&typeof H=="number"?z-H:String(z).localeCompare(String(H)))},P=N("tier"),D=N("type"),$=y.useMemo(()=>{let v=u.filter(C=>{var E,m;const z=C.name.toLowerCase().includes(r.toLowerCase())||((E=C.type)==null?void 0:E.toLowerCase().includes(r.toLowerCase()))||((m=C.description)==null?void 0:m.toLowerCase().includes(r.toLowerCase())),H=n.length===0||n.includes(C.tier.toString()),q=g.length===0||g.includes(C.type);return z&&H&&q});return v.sort((C,z)=>{for(const H of i){const{field:q,direction:E}=H;let m=C[q],k=z[q];if(q==="tier")m=parseInt(m)||0,k=parseInt(k)||0;else if(q==="difficulty"){const O=parseInt(m),_=parseInt(k);!isNaN(O)&&!isNaN(_)?(m=O,k=_):!isNaN(O)&&isNaN(_)?(m=O,k=999):isNaN(O)&&!isNaN(_)?(m=999,k=_):(m=String(m||"").toLowerCase(),k=String(k||"").toLowerCase())}else typeof m=="string"&&typeof k=="string"?(m=m.toLowerCase(),k=k.toLowerCase()):(m=String(m||"").toLowerCase(),k=String(k||"").toLowerCase());if(E==="asc"){if(m>k)return 1;if(m<k)return-1}else{if(m<k)return 1;if(m>k)return-1}}return 0}),v},[u,r,i,n,g]),x=v=>{d(C=>{const z=C.findIndex(H=>H.field===v);if(z>=0)if(z===0){const H=[...C];return H[0]={...H[0],direction:H[0].direction==="asc"?"desc":"asc"},H}else{const H=[...C];return H.splice(z,1)[0],[{field:v,direction:"asc"},...H]}else return[{field:v,direction:"asc"},...C]})},j=v=>{h(c===v?null:v)},W=v=>{o(v==="clear"?[]:C=>C.includes(v)?C.filter(z=>z!==v):[...C,v])},L=v=>{f(v==="clear"?[]:C=>C.includes(v)?C.filter(z=>z!==v):[...C,v])},B=n.length>0,V=g.length>0;return y.useEffect(()=>{const v=z=>{const H=z.target.closest(".filter-dropdown"),q=z.target.closest(".header-filter-icon");H||q||(b(!1),S(!1))},C=z=>{z.key==="Escape"&&(b(!1),S(!1))};return document.addEventListener("pointerdown",v,!0),document.addEventListener("mousedown",v,!0),document.addEventListener("touchstart",v,!0),document.addEventListener("click",v,!0),document.addEventListener("keydown",C,!0),()=>{document.removeEventListener("pointerdown",v,!0),document.removeEventListener("mousedown",v,!0),document.removeEventListener("touchstart",v,!0),document.removeEventListener("click",v,!0),document.removeEventListener("keydown",C,!0)}},[b,S]),{searchTerm:r,setSearchTerm:s,sortFields:i,handleSort:x,expandedCard:c,toggleExpanded:j,filteredAndSortedData:$,loading:p,selectedTiers:n,selectedTypes:g,showTierDropdown:w,setShowTierDropdown:b,showTypeDropdown:I,setShowTypeDropdown:S,tierFilterRef:A,typeFilterRef:T,uniqueTiers:P,uniqueTypes:D,handleTierSelect:W,handleTypeSelect:L,isTierFiltered:B,isTypeFiltered:V,getDropdownStyle:v=>{if(!v.current)return{};const C=v.current.getBoundingClientRect();return{position:"fixed",top:C.bottom+4,left:C.left,zIndex:99999}}}},at=({searchTerm:e,onSearchChange:r,type:s})=>t.jsx("div",{style:M.browserHeader,children:t.jsx("input",{type:"text",placeholder:"Search",value:e,onChange:i=>r(i.target.value),style:M.searchInput})}),lt=({sortFields:e,onSort:r,type:s,uniqueTiers:i,uniqueTypes:d,selectedTiers:c,selectedTypes:h,showTierDropdown:u,setShowTierDropdown:a,showTypeDropdown:p,setShowTypeDropdown:l,tierFilterRef:n,typeFilterRef:o,handleTierSelect:g,handleTypeSelect:f,isTierFiltered:w,isTypeFiltered:b,getDropdownStyle:I})=>{const[S,A]=y.useState(null),N=(()=>s==="adversary"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:s==="environment"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:[])(),P=(D,$,x,j,W,L,B,V)=>{if(!W)return null;const F=()=>{(D==="tier"||D==="type")&&j("clear")};return ue.createPortal(t.jsxs("div",{className:"filter-dropdown",style:{...M.filterDropdown,...I(B),maxHeight:"60vh",overflow:"auto"},onMouseDown:v=>v.stopPropagation(),onClick:v=>v.stopPropagation(),children:[t.jsxs("div",{style:{...M.filterOption,...x.length===0?M.filterOptionSelected:{}},onClick:F,children:[t.jsx("span",{style:M.checkIcon,children:x.length===0?t.jsx(te,{size:16}):t.jsx(re,{size:16})}),t.jsx("span",{style:M.filterLabel,children:"All"})]}),$.map(v=>{const C=x.includes(v.toString());return t.jsxs("div",{style:{...M.filterOption,...C?M.filterOptionSelected:{}},onClick:()=>j(v.toString()),children:[t.jsx("span",{style:M.checkIcon,children:C?t.jsx(te,{size:16}):t.jsx(re,{size:16})}),t.jsx("span",{style:M.filterLabel,children:v})]},v)})]}),document.body)};return t.jsx("tr",{style:M.tableHeader,children:N.map(D=>t.jsxs("th",{style:{...M.tableHeaderCell,...S===D.key?M.tableHeaderCellHover:{},position:"relative",...D.key==="name"?{width:"auto",minWidth:"0"}:{},...D.key==="tier"?{width:"80px",minWidth:"80px",maxWidth:"80px"}:{},...D.key==="type"?{width:"100px",minWidth:"100px",maxWidth:"100px"}:{},...D.key==="difficulty"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...D.key==="action"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{}},onClick:()=>r(D.key),onMouseEnter:()=>A(D.key),onMouseLeave:()=>A(null),children:[D.hasFilter?t.jsxs("div",{style:M.headerWithFilter,children:[t.jsx("span",{style:{cursor:"pointer"},onClick:$=>{$.stopPropagation(),r(D.key)},children:D.label}),t.jsxs("button",{ref:D.key==="tier"?n:o,style:{...M.headerFilterIcon,...D.key==="tier"&&w?M.headerFilterIconActive:{},...D.key==="type"&&b?M.headerFilterIconActive:{}},className:"header-filter-icon",onClick:$=>{$.stopPropagation(),D.key==="tier"?(a(!u),l(!1)):D.key==="type"&&(l(!p),a(!1))},children:[t.jsx(De,{size:14}),D.key==="tier"&&w||D.key==="type"&&b?t.jsx("span",{style:M.filterActiveDot}):null]})]}):D.label,D.key==="tier"&&P("tier",i,c,g,u,a,n),D.key==="type"&&P("type",d,h,f,p,l,o)]},D.key))})},dt=({item:e,isExpanded:r,onToggleExpanded:s,onAdd:i,type:d})=>{const[c,h]=y.useState(!1),u=()=>{i(e)},a=()=>d==="adversary"?t.jsxs(t.Fragment,{children:[t.jsx("td",{style:{...M.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:e.name}),t.jsx("td",{style:{...M.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:e.tier}),t.jsx("td",{style:{...M.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:e.type}),t.jsx("td",{style:{...M.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:e.difficulty})]}):d==="environment"?t.jsxs(t.Fragment,{children:[t.jsx("td",{style:{...M.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:e.name}),t.jsx("td",{style:{...M.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:e.tier}),t.jsx("td",{style:{...M.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:e.type}),t.jsx("td",{style:{...M.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:e.difficulty})]}):null;return t.jsxs(t.Fragment,{children:[t.jsxs("tr",{style:{...M.row,...c?M.rowHover:{}},onClick:()=>s(e.id),onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),children:[a(),t.jsx("td",{style:{width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",boxSizing:"border-box",overflow:"visible",textOverflow:"unset",whiteSpace:"nowrap"},children:t.jsx("button",{style:M.addButton,onClick:p=>{p.stopPropagation(),u()},onMouseEnter:p=>{p.target.style.background="var(--gray-dark)"},onMouseLeave:p=>{p.target.style.background="var(--purple)"},children:"+"})})]}),r&&t.jsx("tr",{style:M.expandedRow,children:t.jsx("td",{colSpan:"5",style:M.expandedContent,children:t.jsx(X,{item:e,type:d,mode:"expanded",onClick:()=>{},onDelete:()=>{}})})})]})},ct=({type:e,onAddItem:r,onCancel:s})=>{const{searchTerm:i,setSearchTerm:d,sortFields:c,handleSort:h,expandedCard:u,toggleExpanded:a,filteredAndSortedData:p,loading:l,selectedTiers:n,selectedTypes:o,showTierDropdown:g,setShowTierDropdown:f,showTypeDropdown:w,setShowTypeDropdown:b,tierFilterRef:I,typeFilterRef:S,uniqueTiers:A,uniqueTypes:T,handleTierSelect:N,handleTypeSelect:P,isTierFiltered:D,isTypeFiltered:$,getDropdownStyle:x}=it(e);return l?t.jsx("div",{style:M.browser,children:t.jsx("div",{style:M.loading,children:"Loading..."})}):t.jsxs("div",{style:M.browserWrapper,children:[t.jsx(at,{searchTerm:i,onSearchChange:d,type:e}),t.jsx("div",{className:"browser-content",style:M.browserContent,children:t.jsxs("table",{style:M.browserTable,children:[t.jsx("thead",{children:t.jsx(lt,{sortFields:c,onSort:h,type:e,uniqueTiers:A,uniqueTypes:T,selectedTiers:n,selectedTypes:o,showTierDropdown:g,setShowTierDropdown:f,showTypeDropdown:w,setShowTypeDropdown:b,tierFilterRef:I,typeFilterRef:S,handleTierSelect:N,handleTypeSelect:P,isTierFiltered:D,isTypeFiltered:$,getDropdownStyle:x})}),t.jsx("tbody",{children:p.map(j=>t.jsx(dt,{item:j,isExpanded:u===j.id,onToggleExpanded:a,onAdd:r,type:e},j.id))})]})})]})},M={browserWrapper:{display:"flex",flexDirection:"column",background:"var(--bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border)",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserContent:{flex:1,overflowY:"auto",overflowX:"visible",padding:0,width:"100%"},tableHeaderContainer:{flexShrink:0,position:"sticky",top:0,zIndex:15,backgroundColor:"#1a1a1a"},browserTable:{width:"100%",minWidth:"100%",borderCollapse:"collapse",tableLayout:"fixed",background:"var(--bg-primary)",margin:0},browserHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-secondary)",flexShrink:0,position:"sticky",top:0,zIndex:20},browserTitle:{margin:0,color:"var(--text-primary)",fontSize:"18px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"24px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"14px",marginRight:"12px",transition:"all 0.2s ease"},searchInputFocus:{outline:"none",borderColor:"#8b5cf6",boxShadow:"0 0 0 3px rgba(139, 92, 246, 0.1)"},tableHeader:{background:"#1a1a1a",borderBottom:"1px solid var(--border)",boxShadow:"0 1px 0 var(--border)",position:"sticky",top:"0",zIndex:10},tableHeaderCell:{backgroundColor:"#1a1a1a",fontWeight:"700",borderBottom:"1px solid var(--border)",cursor:"pointer",userSelect:"none",minWidth:"100px",whiteSpace:"nowrap",padding:"4px 4px",color:"var(--text-primary)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",boxShadow:"0 1px 0 var(--border)",transition:"background-color 0.2s",position:"sticky",top:"0",zIndex:10},tableHeaderCellHover:{backgroundColor:"var(--bg-hover)"},sortIndicator:{fontSize:"12px",color:"#4a90e2"},tableBody:{flex:1,overflowY:"auto",padding:"8px",backgroundColor:"#1a1a1a"},row:{height:"35px",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s ease",cursor:"pointer"},rowHover:{backgroundColor:"var(--bg-hover)"},expandedRow:{backgroundColor:"var(--bg-secondary)"},rowCell:{padding:"4px 4px",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid var(--border)"},rowCellName:{fontWeight:"500",minWidth:"150px"},rowCellCenter:{textAlign:"center",justifyContent:"center",minWidth:"80px"},rowActions:{width:"80px",textAlign:"center",padding:"4px 8px",borderBottom:"1px solid var(--border)"},addButton:{width:"1.5rem",height:"1.5rem",border:"1px solid var(--purple)",borderRadius:"var(--radius-sm)",background:"var(--purple)",color:"white",cursor:"pointer",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"500"},expandedContent:{padding:"16px",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)"},columnName:{width:"auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",paddingLeft:"8px",textAlign:"left"},columnTier:{width:"80px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnType:{width:"100px",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},columnDifficulty:{width:"40px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnAction:{width:"24px",minWidth:"24px",maxWidth:"24px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"visible",textOverflow:"unset"},loading:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"#fff",fontSize:"16px"},mobileBrowser:{width:"95vw",height:"90vh",maxWidth:"none"},mobileSearchInput:{fontSize:"16px"},headerWithFilter:{display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",position:"relative"},headerFilterIcon:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"2px 4px",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",position:"relative"},headerFilterIconActive:{color:"var(--purple)"},filterIcon:{fontSize:"12px"},filterActiveDot:{position:"absolute",left:"50%",top:"2px",transform:"translateX(-50%)",width:"4px",height:"4px",borderRadius:"50%",background:"var(--purple)",pointerEvents:"none"},filterDropdown:{position:"absolute",top:"100%",left:"0",background:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",zIndex:99999,marginTop:"4px",overflow:"hidden",width:"max-content",minWidth:"120px",maxWidth:"200px"},filterOption:{padding:"8px 12px",cursor:"pointer",color:"var(--text-primary)",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background-color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},filterOptionSelected:{backgroundColor:"var(--bg-hover)"},checkIcon:{width:"16px",height:"16px",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"12px"},filterLabel:{flex:1}};function ut({selectedItem:e,selectedType:r,countdowns:s,adversaries:i,environments:d,setSelectedItem:c,handleCloseRightColumn:h}){y.useEffect(()=>{if(!e||!r)return;let u=!1;r==="adversaries"||r==="adversary"?u=i.some(a=>a.id===e.id):r==="environments"||r==="environment"?u=d.some(a=>a.id===e.id):(r==="countdowns"||r==="countdown")&&(u=s.some(a=>a.id===e.id)),u||h()},[e,r,s,i,d,c,h]),y.useEffect(()=>{if(!e||!r)return;let u=null;r==="adversaries"||r==="adversary"?u=i.find(a=>a.id===e.id):r==="environments"||r==="environment"?u=d.find(a=>a.id===e.id):(r==="countdowns"||r==="countdown")&&(u=s.find(a=>a.id===e.id)),u&&JSON.stringify(u)!==JSON.stringify(e)&&c(u)},[e,r,s,i,d,c])}class pt extends pe.Component{constructor(r){super(r),this.state={hasError:!1,error:null}}static getDerivedStateFromError(r){return{hasError:!0,error:r}}componentDidCatch(r,s){console.error("ErrorBoundary caught an error:",r,s)}render(){var r;return this.state.hasError?t.jsxs("div",{className:"p-md text-red",children:[t.jsx("h3",{children:"Something went wrong:"}),t.jsx("pre",{children:(r=this.state.error)==null?void 0:r.toString()}),t.jsx("button",{className:"btn-base btn-text",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try again"})]}):this.props.children}}const ft=()=>{const{adversaries:e,environments:r,countdowns:s,fear:i,updateFear:d,createAdversary:c,updateAdversary:h,deleteAdversary:u,createEnvironment:a,updateEnvironment:p,deleteEnvironment:l,createCountdown:n,deleteCountdown:o,advanceCountdown:g}=be(),[f,w]=y.useState(null),[b,I]=y.useState(null),[S,A]=y.useState(null),[T,N]=y.useState("unified"),[P,D]=y.useState(!1),[$,x]=y.useState(!1),[j]=y.useState("left"),[W,L]=y.useState(!0);y.useState(!1);const[B,V]=y.useState(null),[F,v]=y.useState(!1),C=(m,k)=>{y.startTransition(()=>{f&&f.id===m.id&&b===k&&S==="item"?(w(null),I(null),A(null),P&&v(!1)):(w(m),I(k),A("item"),P&&v(!0))})},z=(m="unified")=>{let k=m;m==="adversaries"?k="adversary":m==="environments"&&(k="environment"),S==="database"&&T===k?y.startTransition(()=>{A(null),N("unified"),P&&v(!1)}):y.startTransition(()=>{N(k),A("database"),P&&v(!0)})},H=m=>{s.forEach(k=>{const O=$e(k,m);if(O>0){const _=k.value||0;g(k.id,_+O)}})},q=()=>{s.forEach(m=>{const k=_e(m);if(k>0){const O=m.value||0;g(m.id,O+k)}})},E=y.useCallback(()=>{A(null),w(null),I(null),P&&v(!1)},[P]);return y.useEffect(()=>{const m=()=>{const k=P,O=window.innerWidth<=800;D(O),!k&&O&&(S==="database"||S==="creator"||S==="item")&&v(!0),k&&!O&&F&&v(!1)};return m(),window.addEventListener("resize",m),()=>window.removeEventListener("resize",m)},[P,S,F]),y.useEffect(()=>(F||P&&f?(document.body.classList.add("mobile-drawer-open"),document.documentElement.classList.add("mobile-drawer-open")):(document.body.classList.remove("mobile-drawer-open"),document.documentElement.classList.remove("mobile-drawer-open")),()=>{document.body.classList.remove("mobile-drawer-open"),document.documentElement.classList.remove("mobile-drawer-open")}),[P,F,f]),ut({selectedItem:f,selectedType:b,countdowns:s,adversaries:e,environments:r,setSelectedItem:w,handleCloseRightColumn:E}),qe({adversaries:e,updateAdversary:h,deleteAdversary:u,selectedItem:f,setSelectedItem:w}),t.jsxs("div",{className:"app",onClick:m=>{m.target===m.currentTarget&&E()},children:[t.jsx(ie,{position:"top",style:{display:"flex",alignItems:"center",justifyContent:"center",height:"var(--topbar-height)",touchAction:"manipulation",userSelect:"none"},children:t.jsx(Ge,{type:"fear",value:(i==null?void 0:i.value)||0,maxValue:12,onChange:d,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0})}),t.jsx("div",{className:"bottom-bar-container",children:t.jsxs(ie,{position:"bottom",children:[t.jsx(Qe,{adversaries:e,environments:r,countdowns:s,deleteAdversary:u,deleteEnvironment:l,deleteCountdown:o}),t.jsx(Je,{})]})}),t.jsxs("div",{className:"main-content",children:[t.jsx(ae,{side:"left",className:`${P&&j==="right"?"mobile-hidden":""}`,children:t.jsx(Ze,{onItemSelect:C,onOpenDatabase:z,isEditMode:$,onEditModeChange:x,showLongTermCountdowns:W,fear:i,updateFear:d,handleRollOutcome:H,handleActionRoll:q,setShowLongTermCountdowns:L,lastAddedItemType:B})}),t.jsx(ae,{side:"right",className:`${P&&j==="left"?"mobile-hidden":""}`,style:S==="database"?{overflowY:"hidden"}:{},children:t.jsx("div",{className:"right-panel-shell",children:t.jsxs("div",{className:"panel-content",children:[S==="database"&&t.jsx("div",{className:"database-display",children:t.jsx(ct,{type:T,onAddItem:m=>{T==="adversary"?(c(m),V("adversary")):T==="environment"&&(a(m),V("environment"))},onCancel:E})}),S==="item"&&f&&t.jsx("div",{className:"item-display",children:t.jsx(X,{type:b,item:f,mode:"expanded"})}),!S&&t.jsx("div",{className:"panel-content"})]})})})]},`mobile-${P}`),P&&t.jsx(tt,{isOpen:F,onClose:E}),t.jsx(rt,{})]})},ht=()=>t.jsx(pt,{children:t.jsx(ye,{children:t.jsx(ft,{})})});J.createRoot(document.getElementById("root")).render(t.jsx(pe.StrictMode,{children:t.jsx(ye,{children:t.jsx(ht,{})})}));
