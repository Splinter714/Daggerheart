import{r as b,a as Re,R as ge}from"./dndkit-57209f9c.js";import{F as Ze,f as Ue,a as et,b as tt,c as De}from"./fa-b4bcccb0.js";import{D as _e,A as rt,C as nt,T as ot,S as st,M as at,X as Me,E as it,H as lt,L as dt,a as ct,F as pt,b as be,c as je,d as He,P as Fe}from"./lucide-c371f2a3.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))m(f);new MutationObserver(f=>{for(const u of f)if(u.type==="childList")for(const l of u.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&m(l)}).observe(document,{childList:!0,subtree:!0});function i(f){const u={};return f.integrity&&(u.integrity=f.integrity),f.referrerPolicy&&(u.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?u.credentials="include":f.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function m(f){if(f.ep)return;f.ep=!0;const u=i(f);fetch(f.href,u)}})();var Ve={exports:{}},Ae={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ut=b,xt=Symbol.for("react.element"),mt=Symbol.for("react.fragment"),ht=Object.prototype.hasOwnProperty,ft=ut.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,gt={key:!0,ref:!0,__self:!0,__source:!0};function Ge(t,s,i){var m,f={},u=null,l=null;i!==void 0&&(u=""+i),s.key!==void 0&&(u=""+s.key),s.ref!==void 0&&(l=s.ref);for(m in s)ht.call(s,m)&&!gt.hasOwnProperty(m)&&(f[m]=s[m]);if(t&&t.defaultProps)for(m in s=t.defaultProps,s)f[m]===void 0&&(f[m]=s[m]);return{$$typeof:xt,type:t,key:u,ref:l,props:f,_owner:ft.current}}Ae.Fragment=mt;Ae.jsx=Ge;Ae.jsxs=Ge;Ve.exports=Ae;var e=Ve.exports,Ne={},Oe=Re;Ne.createRoot=Oe.createRoot,Ne.hydrateRoot=Oe.hydrateRoot;function me(t){const s=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return t?`${t}-${s}`:s}const Ye=b.createContext();function ze(t){if(typeof localStorage>"u")return null;try{const s=localStorage.getItem(t);return s==null?null:JSON.parse(s)}catch{return null}}function fe(t,s){if(!(typeof localStorage>"u"))try{localStorage.setItem(t,JSON.stringify(s))}catch{}}const yt=({children:t})=>{const[s,i]=b.useState({fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],currentEncounterName:"Encounter"}),[m,f]=b.useState(!1),[u,l]=b.useState({adversaries:[],environments:[]});b.useEffect(()=>{var r,p,E,O;const o=ze("daggerheart-game-state");if(o)try{(((r=o.adversaries)==null?void 0:r.length)>0||((p=o.environments)==null?void 0:p.length)>0||((E=o.countdowns)==null?void 0:E.length)>0||((O=o.savedEncounters)==null?void 0:O.length)>0)&&i(o)}catch(de){console.error("Failed to load saved state:",de)}const n=ze("daggerheart-custom-adversaries")||[],a=ze("daggerheart-custom-environments")||[];l({adversaries:n,environments:a}),f(!0)},[]),b.useEffect(()=>{fe("daggerheart-game-state",s)},[s]);const A=o=>{i(n=>({...n,fear:{...n.fear,value:o}}))},x=()=>{i(o=>({...o,fear:{...o.fear,visible:!o.fear.visible}}))},v=o=>{i(n=>({...n,partySize:Math.max(1,o)}))},k=o=>{i(n=>({...n,currentEncounterName:o||"Encounter"}))},z=o=>{if(o.id)return i(n=>({...n,savedEncounters:(n.savedEncounters||[]).map(a=>a.id===o.id?{...a,name:o.name||a.name,encounterItems:o.encounterItems||a.encounterItems,partySize:o.partySize||a.partySize,battlePointsAdjustments:o.battlePointsAdjustments||a.battlePointsAdjustments,updatedAt:new Date().toISOString()}:a)})),o.id;{const n={id:me("encounter"),name:o.name||"Encounter",createdAt:new Date().toISOString(),encounterItems:o.encounterItems||[],partySize:o.partySize||4,battlePointsAdjustments:o.battlePointsAdjustments||{}};return i(a=>({...a,savedEncounters:[...a.savedEncounters||[],n]})),n.id}},F=o=>(s.savedEncounters||[]).find(a=>a.id===o),y=o=>{const n={id:me("encounter"),name:o.name||`Encounter ${Date.now()}`,createdAt:new Date().toISOString(),encounterItems:o.encounterItems||[],partySize:o.partySize||4,battlePointsAdjustments:o.battlePointsAdjustments||{}};return i(a=>({...a,savedEncounters:[...a.savedEncounters||[],n]})),n.id},T=o=>{i(n=>({...n,savedEncounters:(n.savedEncounters||[]).filter(a=>a.id!==o)}))},Y=b.useRef(s);b.useEffect(()=>{Y.current=s},[s]);const J={gameState:s,isLoaded:m,customContent:u,updateFear:A,toggleFearVisibility:x,updatePartySize:v,updateCurrentEncounterName:k,saveEncounter:z,saveEncounterAs:y,loadEncounter:F,deleteEncounter:T,createCountdown:o=>{const n={id:me("countdown"),name:o.name||"Countdown",max:parseInt(o.max)||1,value:0,visible:!0,type:o.type||"standard",loop:o.loop||"none",source:o.source||"campaign"};i(a=>({...a,countdowns:[...a.countdowns,n]}))},updateCountdown:(o,n)=>{i(a=>({...a,countdowns:a.countdowns.map(r=>r.id===o?{...r,...n}:r)}))},deleteCountdown:o=>{i(n=>({...n,countdowns:n.countdowns.filter(a=>a.id!==o)}))},advanceCountdown:(o,n)=>{i(a=>({...a,countdowns:a.countdowns.map(r=>{if(r.id!==o)return r;let p=n;if(r.loop==="loop")p>r.max?p=(p-1)%r.max+1:p<0&&(p=r.max);else if(r.loop==="increasing"){if(p>r.max)return{...r,max:r.max+1,value:1};if(p<0)return{...r,max:Math.max(1,r.max-1),value:1};p=Math.max(0,p)}else if(r.loop==="decreasing"){if(p>r.max)return{...r,max:Math.max(1,r.max-1),value:1};if(p<0)return{...r,max:r.max+1,value:1};p=Math.min(r.max,p)}else p=Math.max(0,Math.min(p,r.max));return{...r,value:p}})}))},incrementCountdown:(o,n=1)=>{i(a=>({...a,countdowns:a.countdowns.map(r=>{if(r.id!==o)return r;let p=r.value+n;if(r.loop==="loop")p>r.max&&(p=(p-1)%r.max+1);else if(r.loop==="increasing"){if(p>r.max)return{...r,max:r.max+1,value:1}}else if(r.loop==="decreasing"){if(p>r.max)return{...r,max:Math.max(1,r.max-1),value:1}}else p=Math.min(p,r.max);return{...r,value:p}})}))},decrementCountdown:o=>{i(n=>({...n,countdowns:n.countdowns.map(a=>{if(a.id!==o)return a;let r=a.value-1;if(a.loop==="loop")r<0&&(r=a.max);else if(a.loop==="increasing"){if(r<0)return{...a,max:Math.max(1,a.max-1),value:a.max};r=Math.max(0,r)}else if(a.loop==="decreasing"){if(r<0)return{...a,max:a.max+1,value:1}}else r=Math.max(0,r);return{...a,value:r}})}))},reorderCountdowns:o=>{i(n=>{const[a,r]=o,p=[...n.countdowns],[E]=p.splice(a,1);return p.splice(r,0,E),{...n,countdowns:p}})},createAdversary:o=>{var de;const n=me("adv"),a=s.adversaries||[],r=o.baseName||((de=o.name)==null?void 0:de.replace(/\s+\(\d+\)$/,""))||o.name||"Unknown",p=a.filter(te=>te.baseName===r);let E=1;if(p.length===0)E=1;else{const te=p.map(d=>d.duplicateNumber||1);let R=1;for(;te.includes(R);)R++;E=R}const O={...o,id:n,baseName:r,duplicateNumber:E,name:`${r} (${E})`,hp:0,stress:0,isVisible:!0};i(te=>({...te,adversaries:[...te.adversaries,O]}))},createAdversariesBulk:o=>{const n=[],a={};o.forEach(r=>{var S;const p=r.baseName||((S=r.name)==null?void 0:S.replace(/\s+\(\d+\)$/,""))||r.name||"Unknown",de=(s.adversaries||[]).filter(P=>P.baseName===p).length,te=a[p]||0,R=de+te+1;a[p]=te+1;const d={...r,id:me("adv"),baseName:p,duplicateNumber:R,name:`${p} (${R})`,hp:0,stress:0,isVisible:!0};n.push(d)}),i(r=>({...r,adversaries:[...r.adversaries,...n]}))},updateAdversary:(o,n)=>{i(a=>({...a,adversaries:a.adversaries.map(r=>{if(r.id===o){const p={...r,...n};if(n.baseName!==void 0){const E=n.baseName,O=p.duplicateNumber||1;p.name=O===1?E:`${E} (${O})`}return p}return r})}))},deleteAdversary:o=>{i(n=>({...n,adversaries:n.adversaries.filter(a=>a.id!==o)}))},clearAllAdversaries:()=>{i(o=>({...o,adversaries:[]}))},reorderAdversaries:o=>{i(n=>{const[a,r]=o,p=[...n.adversaries],[E]=p.splice(a,1);return p.splice(r,0,E),{...n,adversaries:p}})},bulkReorderAdversaries:o=>{i(n=>({...n,adversaries:o}))},createEnvironment:o=>{const n=me("env"),r=(s.environments||[]).filter(O=>O.name.replace(/\s+\(\d+\)$/,"")===o.name);let p=o.name||"Unknown";if(r.length===0)p=o.name;else if(r.length===1){const O=r[0],de=O.name.replace(/\s+\(\d+\)$/,""),te=s.environments.map(R=>R.id===O.id?{...R,name:`${de} (1)`}:R);i(R=>({...R,environments:te})),p=`${o.name} (2)`}else{const O=r.map(te=>{const R=te.name.match(/\((\d+)\)$/);return R?parseInt(R[1]):null}).filter(te=>te!==null);let de=1;for(;O.includes(de);)de++;p=`${o.name} (${de})`}const E={...o,id:n,name:p,isVisible:!0};i(O=>({...O,environments:[...O.environments,E]}))},updateEnvironment:(o,n)=>{i(a=>({...a,environments:a.environments.map(r=>r.id===o?{...r,...n}:r)}))},deleteEnvironment:o=>{i(n=>({...n,environments:n.environments.filter(a=>a.id!==o)}))},reorderEnvironments:o=>{i(n=>{const[a,r]=o,p=[...n.environments],[E]=p.splice(a,1);return p.splice(r,0,E),{...n,environments:p}})},addCustomAdversary:o=>{const n={...o,id:me("custom-adv"),source:o.source||"Homebrew",isCustom:!0};return l(a=>({...a,adversaries:[...a.adversaries,n]})),fe("daggerheart-custom-adversaries",[...u.adversaries,n]),n.id},addCustomEnvironment:o=>{const n={...o,id:me("custom-env"),source:o.source||"Homebrew",isCustom:!0};return l(a=>({...a,environments:[...a.environments,n]})),fe("daggerheart-custom-environments",[...u.environments,n]),n.id},updateCustomAdversary:(o,n)=>{l(r=>({...r,adversaries:r.adversaries.map(p=>p.id===o?{...p,...n}:p)}));const a=u.adversaries.map(r=>r.id===o?{...r,...n}:r);fe("daggerheart-custom-adversaries",a)},updateCustomEnvironment:(o,n)=>{l(r=>({...r,environments:r.environments.map(p=>p.id===o?{...p,...n}:p)}));const a=u.environments.map(r=>r.id===o?{...r,...n}:r);fe("daggerheart-custom-environments",a)},deleteCustomAdversary:o=>{l(a=>({...a,adversaries:a.adversaries.filter(r=>r.id!==o)}));const n=u.adversaries.filter(a=>a.id!==o);fe("daggerheart-custom-adversaries",n)},deleteCustomEnvironment:o=>{l(a=>({...a,environments:a.environments.filter(r=>r.id!==o)}));const n=u.environments.filter(a=>a.id!==o);fe("daggerheart-custom-environments",n)}};return e.jsx(Ye.Provider,{value:J,children:t})},Je=()=>{const t=b.useContext(Ye);if(!t)return console.warn("useGameState: Context not available yet, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{gameState:s,customContent:i,...m}=t;if(!s)return console.warn("useGameState: gameState not available, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],customContent:{adversaries:[],environments:[]},updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},addCustomAdversary:()=>{},addCustomEnvironment:()=>{},updateCustomAdversary:()=>{},updateCustomEnvironment:()=>{},deleteCustomAdversary:()=>{},deleteCustomEnvironment:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{fear:f,countdowns:u,adversaries:l,environments:A,partySize:x,savedEncounters:v}=s;return{gameState:s,fear:f,countdowns:u,adversaries:l,environments:A,partySize:x,savedEncounters:v,customContent:i,...m,hasCountdowns:u.length>0,hasAdversaries:l.length>0,hasEnvironments:A.length>0,getCountdownById:k=>u.find(z=>z.id===k),getAdversaryById:k=>l.find(z=>z.id===k),getEnvironmentById:k=>A.find(z=>z.id===k)}},$e={fear:{icon:Ue,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"0.125rem",maxWidth:"none"},pipStyle:{fontSize:"var(--text-lg)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0,imageRendering:"crisp-edges"},filledColor:"var(--purple)",emptyColor:"var(--gray-dark)",tooltipTitle:"Click anywhere in header to adjust fear:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease fear by 1"},{text:"Right of boundary:",description:"Click to increase fear by 1"}]},hp:{icon:et,maxValue:20,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stress:{icon:tt,maxValue:12,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},countdown:{icon:De,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust countdown:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease countdown by 1"},{text:"Right of boundary:",description:"Click to increase countdown by 1"}]},hpDots:{maxValue:20,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--red)",borderColor:"var(--red)",boxShadow:"0 0 4px rgba(239, 68, 68, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stressDots:{maxValue:12,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--purple)",borderColor:"var(--purple)",boxShadow:"0 0 4px rgba(139, 92, 246, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},adversaryHP:{icon:_e,maxValue:20,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust HP:",tooltipInstructions:[{text:"Filled pip:",description:"Click to heal (reduce damage)"},{text:"Empty pip:",description:"Click to take damage"}]},adversaryStress:{icon:rt,maxValue:12,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust stress:",tooltipInstructions:[{text:"Filled pip:",description:"Click to reduce stress"},{text:"Empty pip:",description:"Click to increase stress"}]},countdownDistributed:{icon:De,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Countdown progress:",tooltipInstructions:[{text:"Progress:",description:"Current countdown value"}]}},Be=({type:t="fear",value:s=0,maxValue:i,onChange:m,size:f="lg",showTooltip:u=!0,containerStyle:l={},pipStyle:A={},countdownType:x=null,distributedGroups:v=null,onPipClick:k=null,enableBoundaryClick:z=!1,clickContainerWidth:F="auto",centerPips:y=!0})=>{const[T,Y]=b.useState(!1),B=$e[t]||$e.fear,L=i||B.maxValue,j=Math.max(0,Math.min(L,s));let M=B.filledColor;t==="countdown"&&x&&(["progress","dynamic-progress","simple-hope"].includes(x)?M="var(--gold)":["consequence","dynamic-consequence","simple-fear"].includes(x)?M="var(--purple)":["long-term","standard"].includes(x)&&(M="var(--text-secondary)"));const I=($,le)=>{if(k)k($,le);else if(m){const se=$+1;m(se)}},D=$=>{if(!z||!m||k)return;$.currentTarget.getBoundingClientRect();const le=$.currentTarget.querySelector(".pip-container");if(!le)return;const se=le.getBoundingClientRect(),ae=$.clientX-se.left;if(ae<0){j>0&&m(j-1);return}if(ae>se.width){j<L&&m(j+1);return}const ee=se.width,c=ee*.05,g=ee-2*c,G=ae-c,C=j/L,W=g*C;G<W?j>0&&m(j-1):j<L&&m(j+1)},H=(()=>{if(!v||t!=="countdownDistributed")return[{start:0,end:L,groupIndex:0}];let $=0;return v.map((le,se)=>{const ae={start:$,end:$+le,groupIndex:se};return $+=le,ae})})(),ce=()=>e.jsxs(e.Fragment,{children:[H.map($=>e.jsx(ge.Fragment,{children:[...Array($.end-$.start)].map((le,se)=>{const ae=$.start+se,ee=ae<j;if(B.isDots)return e.jsx("div",{style:{...B.pipStyle,...ee?B.filledStyle:B.emptyStyle,...A,cursor:m||k?"pointer":"default"},onClick:z?void 0:()=>I(ae,ee),title:`${ae+1} of ${L}`},ae);{const c=B.icon,g=c&&typeof c=="object"&&c.iconName,G=ee?M:B.emptyColor;return e.jsx("span",{className:`fear-pip ${ee?"filled":"empty"}`,style:{...B.pipStyle,color:G,cursor:m||k?"pointer":"default",...A},onClick:z?void 0:()=>I(ae,ee),title:`${ae+1} of ${L}`,children:g?e.jsx(Ze,{icon:c,size:f}):e.jsx(c,{size:f==="lg"?18:16})},ae)}})},$.groupIndex)),u&&e.jsx("div",{style:{position:"relative",cursor:"help",pointerEvents:"none"},children:e.jsxs("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:T?"translateX(-50%) translateY(-5px)":"translateX(-50%)",background:"rgba(15, 23, 42, 0.95)",border:"1px solid var(--gray)",borderRadius:"var(--radius-md)",padding:"var(--space-md)",minWidth:"250px",zIndex:1e3,opacity:T?1:0,visibility:T?"visible":"hidden",transition:"all 0.2s ease",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.5)"},children:[e.jsx("div",{style:{fontWeight:600,color:"var(--gray-200)",marginBottom:"0.75rem",fontSize:"var(--text-sm)"},children:B.tooltipTitle}),B.tooltipInstructions.map(($,le)=>e.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.8rem",color:"var(--gray-300)",lineHeight:1.4},children:[e.jsx("strong",{style:{color:"var(--gray-200)"},children:$.text})," ",$.description]},le))]})})]});return e.jsx("div",{style:{width:F,height:"100%",cursor:m||k?"pointer":"default",touchAction:"manipulation",userSelect:"none",display:y?"flex":"block",alignItems:y?"center":"stretch",justifyContent:y?"center":"flex-start",...l},onClick:$=>{$.stopPropagation(),$.preventDefault(),z&&D($)},onMouseEnter:()=>Y(u),onMouseLeave:()=>Y(!1),children:e.jsx("div",{className:"pip-container",style:{...B.containerStyle,width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},children:ce()})})},vt="/Daggerheart/assets/daggerheart-logo-fe7815ad.svg",bt=({showFlyout:t,onFlyoutChange:s})=>{const[i,m]=b.useState(!1),[f,u]=b.useState(!1),l=t!==void 0?t:i,A=s||m;return b.useEffect(()=>{const x=v=>{v.target.closest(".help-button")||A(!1)};return document.addEventListener("click",x),()=>document.removeEventListener("click",x)},[A]),b.useEffect(()=>{const x=window.matchMedia("(max-width: 800px)"),v=k=>u(k.matches);return u(x.matches),x.addEventListener("change",v),()=>x.removeEventListener("change",v)},[]),e.jsxs("div",{className:"help-button",style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",padding:"0.5rem",color:l?"white":"var(--text-primary)",borderRadius:"50%",cursor:"pointer",transition:"all 0.2s ease",minWidth:"44px",minHeight:"44px",backgroundColor:l?"var(--purple)":"transparent"},onMouseEnter:x=>{l||(x.currentTarget.style.backgroundColor="var(--bg-secondary)")},onMouseLeave:x=>{l||(x.currentTarget.style.backgroundColor="transparent")},onClick:x=>{x.stopPropagation(),A(!l)},title:"Help & Info",children:[e.jsx("div",{style:{width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center",color:"inherit",backgroundColor:"transparent",border:"none",outline:"none"},children:e.jsx(nt,{size:20})}),e.jsxs("div",{style:{position:"absolute",top:"50%",right:"100%",left:"auto",transform:"translateY(-50%)",background:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,opacity:l?1:0,visibility:l?"visible":"hidden",transition:"opacity 0.2s ease, visibility 0.2s ease, transform 0.2s ease",pointerEvents:l?"auto":"none",minWidth:"280px",maxWidth:f?"calc(100vw - 2rem)":"320px",marginRight:"0.5rem"},children:[e.jsxs("div",{style:{padding:"0.75rem",borderTop:"1px solid rgba(255, 255, 255, 0.1)",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",background:"var(--bg-primary)",maxWidth:"280px"},children:[e.jsx("img",{src:vt,alt:"Daggerheart Community Content Logo",style:{width:"100%",maxWidth:"200px",height:"auto",margin:"0 auto 0.75rem auto",display:"block"},onError:x=>{console.error("Failed to load Daggerheart logo:",x.target.src),x.target.style.display="none";const v=document.createElement("div");v.style.cssText="text-align: center; margin-bottom: 0.75rem; font-size: 1.5rem; font-weight: bold; color: var(--purple);",v.textContent="⚔️ DAGGERHEART ⚔️",x.target.parentNode.insertBefore(v,x.target)},onLoad:()=>{}}),e.jsxs("div",{style:{fontSize:"0.7rem",lineHeight:1.3,color:"var(--text-secondary)",textAlign:"left",wordWrap:"break-word",overflowWrap:"break-word"},children:[e.jsx("p",{children:"This product includes materials from the Daggerheart System Reference Document 1.0, © Critical Role, LLC, under the terms of the Darrington Press Community Gaming (DPCGL) License."}),e.jsxs("p",{children:["More information can be found at ",e.jsx("a",{href:"https://www.daggerheart.com",target:"_blank",rel:"noopener noreferrer",children:"daggerheart.com"})]}),e.jsx("p",{children:e.jsx("em",{children:"This project is unofficial and not endorsed by Darrington Press or Critical Role."})})]})]}),e.jsx("button",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"0.25rem 1rem",color:"var(--text-primary)",border:"none",background:"none",width:"100%",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"0.875rem",minHeight:"32px",borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},onMouseEnter:x=>{x.target.style.backgroundColor="var(--gray-dark)"},onMouseLeave:x=>{x.target.style.backgroundColor="transparent"},onClick:x=>{x.stopPropagation(),A(!1),window.open("https://github.com/Splinter714/Daggerheart","_blank")},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.25rem"},children:e.jsx("span",{children:"GitHub"})})}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"0.25rem 1rem",color:"var(--text-secondary)",border:"none",background:"none",width:"100%",textAlign:"left",cursor:"default",fontSize:"0.875rem",minHeight:"32px"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.25rem"},children:e.jsxs("span",{children:["Version ","0.3.12 (eed9e4e)"]})})})]})]})},jt=({adversaries:t,environments:s,countdowns:i,deleteAdversary:m,deleteEnvironment:f,deleteCountdown:u,isClearMode:l,setIsClearMode:A,showFlyout:x,onFlyoutChange:v})=>{const[k,z]=b.useState(!1),F=x!==void 0?x:k,y=v||z,T=((t==null?void 0:t.length)||0)>0||((s==null?void 0:s.length)||0)>0||((i==null?void 0:i.length)||0)>0,Y=(t||[]).some(I=>(I.hp||0)>=(I.hpMax||1));b.useEffect(()=>{const I=D=>{D.target.closest(".delete-clear-container")||(y(!1),l&&A(!1))};return document.addEventListener("click",I),()=>document.removeEventListener("click",I)},[l,y]),b.useEffect(()=>{l&&!T&&(A(!1),y(!1))},[l,T,A,y]);const B={position:"absolute",top:"50%",right:"100%",left:"auto",transform:"translateY(-50%)",backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",padding:"0.5rem",minWidth:"200px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,display:F?"block":"none",marginRight:"0.5rem"},L={background:l||F?"var(--red)":"none",border:"none",color:l||F?"white":T?"var(--text-primary)":"var(--text-secondary)",cursor:T?"pointer":"not-allowed",padding:"0.5rem",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s",opacity:T?1:.5,minWidth:"44px",minHeight:"44px"},j={background:"none",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:"0.5rem",borderRadius:"var(--radius-sm)",width:"100%",textAlign:"left",display:"flex",alignItems:"center",gap:"0.5rem",transition:"background-color 0.2s"},M={backgroundColor:"var(--bg-hover)"};return e.jsxs("div",{className:"delete-clear-container",style:{position:"relative"},children:[e.jsx("button",{style:L,onClick:I=>{I.stopPropagation(),T&&(l?(A(!1),y(!1)):(A(!0),y(!0)))},title:T?l?"Clear Items":"Enter Clear Mode":"Nothing to clear",children:e.jsx(ot,{size:20})}),e.jsxs("div",{style:B,children:[t&&t.length>0&&e.jsxs("button",{style:j,onMouseEnter:I=>Object.assign(I.target.style,M),onMouseLeave:I=>Object.assign(I.target.style,j),onClick:I=>{I.stopPropagation(),z(!1),t.forEach(D=>m(D.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Adversaries"})]}),t&&t.length>0&&Y&&e.jsxs("button",{style:j,onMouseEnter:I=>Object.assign(I.target.style,M),onMouseLeave:I=>Object.assign(I.target.style,j),onClick:I=>{I.stopPropagation(),z(!1),t.filter(U=>(U.hp||0)>=(U.hpMax||1)).forEach(U=>m(U.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"Dead Adversaries"})]}),s&&s.length>0&&e.jsxs("button",{style:j,onMouseEnter:I=>Object.assign(I.target.style,M),onMouseLeave:I=>Object.assign(I.target.style,j),onClick:I=>{I.stopPropagation(),z(!1),s.forEach(D=>f(D.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Environments"})]}),i&&i.length>0&&e.jsxs("button",{style:j,onMouseEnter:I=>Object.assign(I.target.style,M),onMouseLeave:I=>Object.assign(I.target.style,j),onClick:I=>{I.stopPropagation(),z(!1),i.forEach(D=>u(D.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Countdowns"})]})]})]})},wt=({adversaries:t,environments:s,countdowns:i,deleteAdversary:m,deleteEnvironment:f,deleteCountdown:u,isClearMode:l,setIsClearMode:A,sortAdversaries:x,onOpenDatabase:v})=>{const[k,z]=b.useState(!1),[F,y]=b.useState(!1),[T,Y]=b.useState(!1);b.useEffect(()=>{const U=H=>{H.target.closest(".floating-menu-container")||(z(!1),y(!1),Y(!1),l&&A(!1))};return document.addEventListener("click",U),()=>document.removeEventListener("click",U)},[l,A]),b.useEffect(()=>{k||(y(!1),Y(!1),l&&A(!1))},[k,l,A]);const B=U=>{y(U),U&&(Y(!1),l&&A(!1))},L=U=>{Y(U),U&&y(!1)},M={position:"fixed",bottom:window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://")?"calc(60px + env(safe-area-inset-bottom) + 2rem)":"calc(60px + env(safe-area-inset-bottom) + 1rem)",right:"1rem",zIndex:1100,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",pointerEvents:"none",width:"56px",height:"56px"},I={width:"56px",height:"56px",borderRadius:"50%",background:k?"var(--red)":"var(--bg-secondary)",border:"2px solid var(--border)",color:k?"white":"var(--text-primary)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"all 0.3s ease",pointerEvents:"auto"},D=(U,H)=>{const se=135+U*135/(H-1),ae=70,ee=se*Math.PI/180,c=Math.cos(ee)*ae,g=Math.sin(ee)*ae;return{width:"48px",height:"48px",borderRadius:"50%",background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.2)",transition:"all 0.3s ease",position:"absolute",pointerEvents:"auto",transform:k?`translate(${c}px, ${g}px)`:"translate(0px, 0px)",opacity:k?1:0,visibility:k?"visible":"hidden"}};return e.jsxs("div",{className:"floating-menu-container",style:M,children:[e.jsxs("div",{style:{position:"absolute",top:"0",left:"0",width:"56px",height:"56px",pointerEvents:"none"},children:[e.jsx("div",{style:D(0,4),children:e.jsx("button",{onClick:U=>{U.stopPropagation(),v("adversaries"),z(!1)},style:{width:"100%",height:"100%",background:"none",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Browse Adversaries",children:e.jsx(st,{size:20})})}),e.jsx("div",{style:D(1,4),children:e.jsx("button",{onClick:U=>{U.stopPropagation(),v("environments"),z(!1)},style:{width:"100%",height:"100%",background:"none",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Browse Environments",children:e.jsx(at,{size:20})})}),e.jsx("div",{style:D(2,4),children:e.jsx(jt,{adversaries:t,environments:s,countdowns:i,deleteAdversary:m,deleteEnvironment:f,deleteCountdown:u,isClearMode:l,setIsClearMode:A,showFlyout:T,onFlyoutChange:L})}),e.jsx("div",{style:D(3,4),children:e.jsx(bt,{showFlyout:F,onFlyoutChange:B})})]}),e.jsx("button",{style:I,onClick:U=>{U.stopPropagation(),z(!k)},title:k?"Close Menu":"Open Menu",children:k?e.jsx(Me,{size:24}):e.jsx(it,{size:24})})]})},Ct=({position:t="top",children:s,onClick:i,className:m="",style:f={}})=>{const u=t==="top",l=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://"),A={background:"var(--bg-primary)",borderTop:u?"none":"1px solid var(--border)",borderBottom:u?"1px solid var(--border)":"none",padding:u?"0.25rem 0":"0.5rem",paddingBottom:u?"0.25rem":l?"calc(0.5rem + env(safe-area-inset-bottom) + 1rem)":"calc(0.5rem + env(safe-area-inset-bottom))",position:u?"relative":"sticky",[u?"top":"bottom"]:0,zIndex:u?10:100,order:u?1:3,flexShrink:0,touchAction:"manipulation",userSelect:"none",display:"flex",flexDirection:u?"column":"row",justifyContent:u?"stretch":"center",alignItems:u?"stretch":"center",gap:u?"0":"1rem",height:u?"auto":"60px",...f};return e.jsx("div",{className:m,style:A,onClick:i,children:s})},we=({value:t})=>e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"44px",height:"32px",zIndex:3},children:[e.jsx("svg",{width:"40",height:"32",viewBox:"0 0 40 32",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",style:{position:"absolute",zIndex:1},children:e.jsx("path",{d:"M2 2h28l6 14-6 14H2l6-14-6-14z"})}),e.jsx("span",{style:{position:"absolute",fontSize:"0.8rem",fontWeight:500,color:"var(--text-primary)",textAlign:"center",zIndex:2,left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:t})]}),St=({type:t,tier:s,isEditMode:i,onUpdate:m,itemId:f})=>{const l=(z=>{if(!z)return 0;const y=document.createElement("canvas").getContext("2d");y.font="600 11px system-ui, -apple-system, sans-serif";const T=y.measureText(z.toUpperCase()).width;return console.log("Text measurement:",{text:z,font:y.font,width:T}),T})(t),A=4,x=18,v=Math.max(50,l+A+x),k=v+15;return i?e.jsxs("div",{style:{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"center",height:"32px",width:`${k}px`},children:[e.jsxs("svg",{width:k,height:"32",viewBox:`0 0 ${k} 32`,style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1},children:[e.jsx("rect",{x:"1",y:"6",width:v-1,height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4",ry:"4"}),e.jsx("rect",{x:v-10,y:"6",width:"20",height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"2",ry:"2",transform:`rotate(45 ${v-1} 16)`})]}),e.jsxs("select",{value:t||"",onChange:z=>{m&&m(f,{type:z.target.value})},style:{position:"absolute",top:"50%",left:"4px",transform:"translateY(-50%)",backgroundColor:"transparent",border:"none",color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",outline:"none",zIndex:2,width:`${v-16}px`},children:[e.jsx("option",{value:"Standard",children:"Standard"}),e.jsx("option",{value:"Solo",children:"Solo"}),e.jsx("option",{value:"Bruiser",children:"Bruiser"}),e.jsx("option",{value:"Horde",children:"Horde"}),e.jsx("option",{value:"Minion",children:"Minion"}),e.jsx("option",{value:"Ranged",children:"Ranged"}),e.jsx("option",{value:"Leader",children:"Leader"}),e.jsx("option",{value:"Skulk",children:"Skulk"}),e.jsx("option",{value:"Social",children:"Social"}),e.jsx("option",{value:"Support",children:"Support"})]}),e.jsx("input",{type:"text",value:s||"",onChange:z=>{const F=z.target.value.replace(/[^1-4]/g,"");F.length<=1&&m&&m(f,{tier:F===""?"":parseInt(F)})},onKeyDown:z=>{if(z.key==="ArrowUp"){z.preventDefault();const F=parseInt(s)||1;m&&m(f,{tier:Math.min(F+1,4)})}else if(z.key==="ArrowDown"){z.preventDefault();const F=parseInt(s)||1;m&&m(f,{tier:Math.max(F-1,1)})}},style:{position:"absolute",top:"50%",left:`${v-.5}px`,transform:"translate(-50%, -50%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",height:"20px",textAlign:"center",outline:"none",zIndex:2,lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},maxLength:"1"})]}):e.jsxs("div",{style:{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"center",height:"32px",width:`${k}px`},children:[e.jsxs("svg",{width:k,height:"32",viewBox:`0 0 ${k} 32`,style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1},children:[e.jsx("rect",{x:"1",y:"6",width:v-1,height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4",ry:"4"}),e.jsx("rect",{x:v-10,y:"6",width:"20",height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"2",ry:"2",transform:`rotate(45 ${v-1} 16)`})]}),e.jsx("span",{style:{position:"absolute",top:"50%",left:"4px",transform:"translateY(-50%)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",color:"var(--text-primary)",zIndex:2,pointerEvents:"none"},children:t}),e.jsx("span",{style:{position:"absolute",top:"50%",left:`${v-.5}px`,transform:"translate(-50%, -50%)",fontSize:"0.8rem",fontWeight:600,color:"white",zIndex:2,pointerEvents:"none",textAlign:"center",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",width:"20px",height:"20px"},children:s})]})},We=({feature:t,featureType:s,item:i,onUpdate:m,handleFeatureDeleteClick:f,deleteConfirmations:u,getFeatureKey:l})=>{var z,F;const A=()=>{try{const T=[...(i==null?void 0:i.features)||[]],Y=T.filter(L=>L.type===s),B=Y.findIndex(L=>L===t);if(B>0&&B<Y.length){const L=Y[B],j=Y[B-1];if(L&&j){const M=T.findIndex(D=>D===L),I=T.findIndex(D=>D===j);M>=0&&I>=0&&(T[M]=j,T[I]=L,m&&m(i.id,{features:T}))}}}catch(y){console.error(`Error in ${s.toLowerCase()} up button:`,y)}},x=()=>{try{const T=[...(i==null?void 0:i.features)||[]],Y=T.filter(L=>L.type===s),B=Y.findIndex(L=>L===t);if(B<Y.length-1&&B>=0){const L=Y[B],j=Y[B+1];if(L&&j){const M=T.findIndex(D=>D===L),I=T.findIndex(D=>D===j);M>=0&&I>=0&&(T[M]=j,T[I]=L,m&&m(i.id,{features:T}))}}}catch(y){console.error(`Error in ${s.toLowerCase()} down button:`,y)}},v=y=>y.type===s,k=y=>y.type===s&&y.name.trim();return e.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",alignSelf:"stretch"},children:[e.jsx("button",{onClick:A,disabled:(i.features||[]).filter(v).findIndex(y=>y===t)===0,tabIndex:"-1",style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(i.features||[]).filter(k).length>=2&&(i.features||[]).filter(v).findIndex(y=>y===t)!==0&&t.name.trim()?"white":"var(--text-secondary)",cursor:(i.features||[]).filter(k).length>=2&&(i.features||[]).filter(v).findIndex(y=>y===t)!==0&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↑"}),e.jsx("button",{onClick:()=>f(t),disabled:!t.name.trim()&&!t.description.trim(),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:u[l(t)]?"var(--danger)":"var(--gray-700)",color:!t.name.trim()&&!t.description.trim()?"var(--text-secondary)":"white",cursor:!t.name.trim()&&!t.description.trim()?"not-allowed":"pointer",opacity:!t.name.trim()&&!t.description.trim()?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"×"}),e.jsx("button",{onClick:x,disabled:(i.features||[]).filter(v).findIndex(y=>y===t)===(i.features||[]).filter(v).length-1,style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(i.features||[]).filter(k).length>=2&&(i.features||[]).filter(v).findIndex(y=>y===t)<(i.features||[]).filter(v).length-1&&((z=(i.features||[]).filter(v)[(i.features||[]).filter(v).findIndex(y=>y===t)+1])!=null&&z.name.trim())&&t.name.trim()?"white":"var(--text-secondary)",cursor:(i.features||[]).filter(k).length>=2&&(i.features||[]).filter(v).findIndex(y=>y===t)<(i.features||[]).filter(v).length-1&&((F=(i.features||[]).filter(v)[(i.features||[]).filter(v).findIndex(y=>y===t)+1])!=null&&F.name.trim())&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↓"})]})},pe={transitions:{hoverIn:"all 0.1s ease",hoverOut:"all 0.3s ease"},card:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"8px",cursor:"pointer",transition:"all 0.1s ease",position:"relative"},cardHover:{backgroundColor:"var(--bg-card-hover)"},cardDead:{opacity:.6,backgroundColor:"var(--gray-800)",borderColor:"var(--border)"},cardAtMax:{backgroundColor:"var(--success)",borderColor:"var(--success)"},rowMain:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},rowTitle:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",margin:0},rowMeta:{display:"flex",gap:"8px",alignItems:"center"},badge:{padding:"2px 6px",borderRadius:"3px",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},typeBadge:{backgroundColor:"var(--purple)",color:"var(--text-primary)"},tierBadge:{backgroundColor:"var(--info)",color:"var(--text-primary)"},damageInputPopup:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,borderRadius:"8px"},damageInputContent:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"8px",padding:"8px",display:"flex",flexDirection:"row",gap:"8px",minWidth:"200px",alignItems:"center",position:"absolute",right:"1rem",top:"50%",transform:"translateY(-50%)"},damageInput:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"4px",padding:"4px 6px",color:"var(--text-primary)",fontSize:"16px",width:"80px",textAlign:"center"},damageIndicators:{display:"flex",gap:"8px",alignItems:"center",justifyContent:"center"},damageDrop:{fontSize:"16px",color:"var(--text-secondary)",cursor:"pointer",transition:"color 0.1s ease"},applyButton:{backgroundColor:"var(--gray-600)",color:"white",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"32px",minHeight:"32px"}},kt=(t,s,i,m)=>{const[f,u]=b.useState(!1),[l,A]=b.useState("");b.useEffect(()=>{if(f){const y=T=>{T.target.closest(".damage-input-popup")||(u(!1),A(""))};return document.addEventListener("click",y),()=>document.removeEventListener("click",y)}},[f]);const x=y=>{y.stopPropagation(),y.preventDefault();const T=t.hp||0,Y=t.hpMax||1,B=y.currentTarget.getBoundingClientRect(),L=y.clientX-B.left,j=B.width/Y;Math.floor(L/j)<T?i&&i(t.id,1,t.hp):s&&s(t.id,1,t.hp,t.hpMax)},v=y=>{y.stopPropagation(),y.preventDefault();const T=t.stress||0,Y=t.stressMax||1,B=y.currentTarget.getBoundingClientRect(),L=y.clientX-B.left,j=B.width/Y;Math.floor(L/j)<T?m&&m(t.id,-1,t.stress,t.stressMax):m&&m(t.id,1,t.stress,t.stressMax)},k=y=>{y.stopPropagation(),(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")&&(u(!0),A(t.type==="Minion"?"1":""))},z=()=>{const y=parseInt(l);if(y>0){if(t.type==="Minion")s&&s(t.id,y,t.hp,t.hpMax);else{let T=0;y>=t.thresholds.severe?T=3:y>=t.thresholds.major?T=2:y>=1&&(T=1),s&&s(t.id,T,t.hp,t.hpMax)}u(!1),A("")}};return{showDamageInput:f,damageValue:l,setDamageValue:A,setShowDamageInput:u,handleHpClick:x,handleStressClick:v,handleDifficultyClick:k,applyDamage:z,handleKeyDown:y=>{y.key==="Enter"?z():y.key==="Escape"&&(u(!1),A(""))}}},Pe=({item:t,type:s,mode:i="expanded",onClick:m,onDelete:f,onApplyDamage:u,onApplyHealing:l,onApplyStressChange:A,onUpdate:x,adversaries:v=[],isSelected:k=!1,isEditMode:z=!1,instances:F=[],isEmbedded:y=!1})=>{const[T,Y]=b.useState({}),B=c=>{const G=(t.features||[]).filter(C=>C.type===c.type).findIndex(C=>C===c);return`${c.type}-${G}-${c.name||"blank"}`},L=c=>{const g=B(c);if(T[g]){const G=t.features.filter(C=>C!==c);x&&x(t.id,{features:G}),Y(C=>{const W={...C};return delete W[g],W})}else Y(G=>({...G,[g]:!0})),setTimeout(()=>{Y(G=>{const C={...G};return delete C[g],C})},3e3)},j=kt(t,u,l,A);(s==="adversary"||s==="adversaries")&&j.handleDifficultyClick;const[M,I]=b.useState(!1),D=()=>{I(!0)},U=()=>{I(!1)},H=(c=!1)=>{let g={...pe.card};if(k?g.transition="none":g.transition=M?pe.transitions.hoverIn:pe.transitions.hoverOut,c){const{marginTop:G,...C}=g;g=C}return(M&&i!=="expanded"||k)&&(g={...g,...pe.cardHover}),s==="adversary"&&(t.hp||0)>=(t.hpMax||1)&&(g={...g,...pe.cardDead}),g},ce=()=>{if(y)return"";let c="border rounded-lg";return(M&&i!=="expanded"||k)&&(c+=" border-hover"),c},$=()=>{var c;if(s==="adversary"||s==="adversaries"){const g=t.baseName||((c=t.name)==null?void 0:c.replace(/\s+\(\d+\)$/,""))||"",G=t.duplicateNumber||1,C=[...v];return v.some(Q=>Q.id===t.id)||C.push(t),C.filter(Q=>Q.baseName===g).length>1?`${g} (${G})`:g}return t.name},le=()=>{const c=[];return t.type&&c.push(e.jsx("span",{style:{...pe.badge,...pe.typeBadge},children:t.type},"type")),c},se=()=>s!=="adversary"||!j.showDamageInput||!(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")?null:e.jsx("div",{className:"damage-input-popup",style:pe.damageInputPopup,onClick:c=>{c.stopPropagation(),c.target===c.currentTarget&&(s==="adversary"||s==="adversaries")&&(j.setShowDamageInput(!1),j.setDamageValue(""))},children:e.jsxs("div",{className:"border rounded-lg",style:{...pe.damageInputContent,borderColor:"var(--border)"},onClick:c=>c.stopPropagation(),children:[e.jsx("input",{type:"number",inputMode:"numeric",enterKeyHint:"done",placeholder:"dmg",min:(t.type==="Minion","0"),value:s==="adversary"||s==="adversaries"?j.damageValue:"",onChange:c=>{(s==="adversary"||s==="adversaries")&&j.setDamageValue(c.target.value)},onKeyDown:s==="adversary"||s==="adversaries"?j.handleKeyDown:void 0,className:"border rounded-sm",style:{...pe.damageInput,borderColor:"var(--border)"},autoFocus:!0}),e.jsxs("div",{style:pe.damageIndicators,children:[t.type==="Minion"?(()=>{var W,K;const c=parseInt(s==="adversary"||s==="adversaries"?j.damageValue:"0")||0,g=(W=t.features)==null?void 0:W.find(Q=>{var w;return(w=Q.name)==null?void 0:w.startsWith("Minion (")}),G=g?parseInt(((K=g.name.match(/\((\d+)\)/))==null?void 0:K[1])||"1"):1,C=Math.floor(c/G);return c>=G&&C>0?e.jsxs("span",{style:{...pe.damageDrop,color:"var(--red)"},title:`${c} damage can defeat ${C+1} minion${C+1!==1?"s":""} (1 + ${C} additional)`,children:["+",C," additional minion(s)"]}):e.jsx("span",{style:pe.damageDrop,title:`${c} damage defeats this minion only`,children:"+0 additional minion(s)"})})():[1,2,3].map(c=>{const g=parseInt(s==="adversary"||s==="adversaries"?j.damageValue:"0")||0;let G=!1;return c===1&&g>=1&&(G=!0),c===2&&g>=t.thresholds.major&&(G=!0),c===3&&g>=t.thresholds.severe&&(G=!0),e.jsx("span",{style:{...pe.damageDrop,color:G?"var(--red)":"var(--text-secondary)"},onClick:C=>{C.stopPropagation(),(s==="adversary"||s==="adversaries")&&(c===1?j.setDamageValue("1"):c===2?j.setDamageValue(t.thresholds.major.toString()):c===3&&j.setDamageValue(t.thresholds.severe.toString()))},title:`Click to set damage to ${c===1?"1":c===2?t.thresholds.major:t.thresholds.severe}`,children:e.jsx(_e,{size:16})},c)}),e.jsx("button",{style:{...pe.applyButton,backgroundColor:"var(--gray-600)"},onClick:c=>{c.stopPropagation(),(s==="adversary"||s==="adversaries")&&(!j.damageValue||parseInt(j.damageValue)<1?(j.setShowDamageInput(!1),j.setDamageValue("")):j.applyDamage())},title:!j.damageValue||parseInt(j.damageValue)<1?"Close damage input":"Apply damage",children:!j.damageValue||parseInt(j.damageValue)<1?e.jsx(Me,{size:16}):e.jsx(ct,{size:16})})]})]})}),ae=()=>{var G,C,W,K,Q;const c=(t.hp||0)>=(t.hpMax||1),g=i==="edit";return e.jsxs("div",{className:ce(),style:{...H(!0),padding:0,minHeight:"400px",opacity:c?.7:1,backgroundColor:c?"var(--gray-900)":H(!0).backgroundColor,borderColor:c?"color-mix(in srgb, var(--gray-600) 40%, transparent)":k?"var(--purple)":M&&i!=="expanded"?"var(--border-hover)":"var(--border)",borderWidth:"2px",display:"flex",flexDirection:"column",position:"relative"},onClick:m,...i!=="expanded"&&{onMouseEnter:D,onMouseLeave:U},children:[c&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                45deg,
                transparent,
                transparent 8px,
                var(--gray-600) 1px,
                var(--gray-600) 9px
              )`,pointerEvents:"none",zIndex:9999}}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"var(--text-secondary)",fontSize:"1rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em",zIndex:1e4,pointerEvents:"none",textShadow:"1px 1px 2px rgba(0, 0, 0, 0.5)",backgroundColor:"var(--gray-900)",padding:"0.25rem 0.5rem",borderRadius:"0.5rem",border:"0.5px solid var(--gray-600)"},children:"DEFEATED"})]}),e.jsx("div",{className:"border-b",style:{padding:"8px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative",zIndex:c?1:"auto",borderBottomColor:k?"var(--purple)":"var(--border)"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",position:"relative",zIndex:c?1:"auto",padding:"2px",minHeight:"40px"},children:[g?e.jsx("input",{type:"text",value:t.name||"",onChange:w=>{x&&x(t.id,{name:w.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"4px",color:"var(--text-primary)",fontSize:"1.1rem",fontWeight:"600",padding:"0.5rem",width:"100%",maxWidth:"300px",paddingRight:"0.625rem"},placeholder:"Adversary name"}):e.jsx("h4",{style:{...pe.rowTitle,color:c?"color-mix(in srgb, var(--gray-400) 80%, transparent)":pe.rowTitle.color,textAlign:"left",margin:0,fontSize:"1.1rem",paddingRight:"6px"},children:((G=t.name)==null?void 0:G.replace(/\s+\(\d+\)$/,""))||t.name}),(t.type||t.tier||g)&&e.jsx(St,{type:t.type,tier:t.tier,isEditMode:g,onUpdate:x,itemId:t.id})]})}),e.jsxs("div",{style:{borderRadius:"0 0 8px 8px"},children:[(t.motives||g)&&e.jsx("div",{style:{padding:"0.5rem 8px",textAlign:"left"},children:g?e.jsx("input",{type:"text",value:t.motives||"",onChange:w=>x&&x(t.id,{motives:w.target.value}),placeholder:"Enter motives (e.g., Hunt, defend, patrol)",style:{width:"100%",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}):e.jsxs("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4},children:[t.motives,t.motives&&!t.motives.endsWith(".")?".":""]})}),(t.difficulty||t.atk!==void 0||t.thresholds&&t.type!=="Minion"||t.experience&&t.experience.length>0||g)&&e.jsxs("div",{style:{padding:"0.5rem 8px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[(t.difficulty||g)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[e.jsx(lt,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(0deg)"}}),g?e.jsx("input",{type:"text",value:t.difficulty||"",onChange:w=>{const ie=w.target.value.replace(/[^0-9]/g,"");ie.length<=2&&x&&x(t.id,{difficulty:parseInt(ie)||0})},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"2"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:t.difficulty})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Difficulty"})]}),(t.atk!==void 0||g)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[e.jsx(dt,{size:38,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(45deg)"}}),g?e.jsx("input",{type:"text",value:t.atk||"",onChange:w=>{const ie=w.target.value.replace(/[^0-9+\-d]/g,"");ie.length<=3&&x&&x(t.id,{atk:ie})},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"3"}):e.jsxs("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:[t.atk>=0?"+":"",t.atk]})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Attack"})]})]}),e.jsx("div",{children:g?e.jsx("textarea",{value:(t.experience||[]).join(", ")||"",onChange:w=>{const ie=w.target.value.split(",").map(h=>h.trim()).filter(h=>h.length>0);x&&x(t.id,{experience:ie})},placeholder:"Enter experience tags (e.g., Battle Hardened +3, Keen Senses +2)",rows:3,style:{width:"100%",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"vertical"}}):e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:t.experience&&t.experience.length>0?t.experience.map((w,ie)=>{if(typeof w=="string"){const h=w.match(/^(.+?)\s*([+-]?\d+)$/);if(h){const[,J,o]=h;return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:o})})}),e.jsx("span",{style:{marginLeft:"32px"},children:J})]},ie)}else return e.jsx("div",{style:{marginBottom:"0.25rem"},children:w},ie)}else return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:e.jsxs("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:[w.modifier>=0?"+":"",w.modifier]})})}),e.jsx("span",{style:{marginLeft:"32px"},children:w.name})]},ie)}):null})})]}),(t.features&&t.features.length>0||g)&&e.jsxs("div",{style:{padding:"0 8px 8px 8px"},children:[t.atk!==void 0&&t.weapon&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Standard Attack"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:g?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)"},children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[e.jsx("input",{type:"text",value:t.weapon||"",onChange:w=>x&&x(t.id,{weapon:w.target.value}),placeholder:"Standard attack name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}}),e.jsxs("select",{value:t.range||"",onChange:w=>x&&x(t.id,{range:w.target.value}),style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",appearance:"none",backgroundImage:`url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",backgroundSize:"1rem",paddingRight:"2rem"},children:[e.jsx("option",{value:"",children:"Range"}),e.jsx("option",{value:"Melee",children:"Melee"}),e.jsx("option",{value:"Very Close",children:"Very Close"}),e.jsx("option",{value:"Close",children:"Close"}),e.jsx("option",{value:"Far",children:"Far"}),e.jsx("option",{value:"Very Far",children:"Very Far"})]}),e.jsx("input",{type:"text",value:t.damage||"",onChange:w=>x&&x(t.id,{damage:w.target.value}),placeholder:"Damage (e.g., 1d6+2)",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}})]})}):t.atk!==void 0&&t.weapon&&e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:t.weapon}),e.jsxs("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:["Make an attack against a target within ",t.range||"Melee"," range. On a success, deal ",t.damage||"damage varies","."]})]})})]}),(t.features.filter(w=>w.type==="Action").length>0||g)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Actions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const w=t.features.filter(h=>h.type==="Action");return(g&&w.length===0?[{type:"Action",name:"",description:""}]:w).map((h,J)=>g?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:h.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false","data-lpignore":"true","data-form-type":"other",name:`feature-name-${h.type.toLowerCase()}`,onChange:o=>{const n=[...t.features||[]],a=n.findIndex(E=>E.type==="Action"&&E===h);a>=0?n[a]={...n[a],name:o.target.value}:n.push({type:"Action",name:o.target.value,description:h.description||""});const r=n.filter(E=>E.type==="Action"),p=r[r.length-1];p&&p.name.trim()&&n.push({type:"Action",name:"",description:""}),x&&x(t.id,{features:n})},placeholder:"Action name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:h.description||"",onChange:o=>{const n=[...t.features||[]],a=n.findIndex(E=>E.type==="Action"&&E===h);a>=0?n[a]={...n[a],description:o.target.value}:n.push({type:"Action",name:h.name||"",description:o.target.value});const r=n.filter(E=>E.type==="Action"),p=r[r.length-1];p&&p.name.trim()&&n.push({type:"Action",name:"",description:""}),x&&x(t.id,{features:n})},onInput:o=>{const n=o.target.offsetHeight;o.target.style.height="auto";const a=o.target.scrollHeight,r=a>n?a:n;o.target.style.height=r+"px"},placeholder:"Action description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(We,{feature:h,featureType:"Action",item:t,onUpdate:x,handleFeatureDeleteClick:L,deleteConfirmations:T,getFeatureKey:B})]},J):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:h.name}),h.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:h.description})]},J))})()})]}),(t.features.filter(w=>w.type==="Passive").length>0||g)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Passives"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const w=t.features.filter(h=>h.type==="Passive");return(g&&w.length===0?[{type:"Passive",name:"",description:""}]:w).map((h,J)=>g?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:h.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:o=>{const n=[...t.features||[]],a=n.findIndex(E=>E.type==="Passive"&&E===h);a>=0?n[a]={...n[a],name:o.target.value}:n.push({type:"Passive",name:o.target.value,description:h.description||""});const r=n.filter(E=>E.type==="Passive"),p=r[r.length-1];p&&p.name.trim()&&n.push({type:"Passive",name:"",description:""}),x&&x(t.id,{features:n})},placeholder:"Passive name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:h.description||"",onChange:o=>{const n=[...t.features||[]],a=n.findIndex(E=>E.type==="Passive"&&E===h);a>=0?n[a]={...n[a],description:o.target.value}:n.push({type:"Passive",name:h.name||"",description:o.target.value});const r=n.filter(E=>E.type==="Passive"),p=r[r.length-1];p&&p.name.trim()&&n.push({type:"Passive",name:"",description:""}),x&&x(t.id,{features:n})},onInput:o=>{const n=o.target.offsetHeight;o.target.style.height="auto";const a=o.target.scrollHeight,r=a>n?a:n;o.target.style.height=r+"px"},placeholder:"Passive description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(We,{feature:h,featureType:"Passive",item:t,onUpdate:x,handleFeatureDeleteClick:L,deleteConfirmations:T,getFeatureKey:B})]},J):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:h.name}),h.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:h.description})]},J))})()})]}),(t.features.filter(w=>w.type==="Reaction").length>0||g)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Reactions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const w=t.features.filter(h=>h.type==="Reaction");return(g&&w.length===0?[{type:"Reaction",name:"",description:""}]:w).map((h,J)=>g?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:h.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:o=>{const n=[...t.features||[]],a=n.findIndex(E=>E.type==="Reaction"&&E===h);a>=0?n[a]={...n[a],name:o.target.value}:n.push({type:"Reaction",name:o.target.value,description:h.description||""});const r=n.filter(E=>E.type==="Reaction"),p=r[r.length-1];p&&p.name.trim()&&n.push({type:"Reaction",name:"",description:""}),x&&x(t.id,{features:n})},placeholder:"Reaction name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:h.description||"",onChange:o=>{const n=[...t.features||[]],a=n.findIndex(E=>E.type==="Reaction"&&E===h);a>=0?n[a]={...n[a],description:o.target.value}:n.push({type:"Reaction",name:h.name||"",description:o.target.value});const r=n.filter(E=>E.type==="Reaction"),p=r[r.length-1];p&&p.name.trim()&&n.push({type:"Reaction",name:"",description:""}),x&&x(t.id,{features:n})},onInput:o=>{const n=o.target.offsetHeight;o.target.style.height="auto";const a=o.target.scrollHeight,r=a>n?a:n;o.target.style.height=r+"px"},placeholder:"Reaction description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(We,{feature:h,featureType:"Reaction",item:t,onUpdate:x,handleFeatureDeleteClick:L,deleteConfirmations:T,getFeatureKey:B})]},J):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:h.name}),h.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:h.description})]},J))})()})]})]})]}),(F&&F.length>0||t.type!=="Minion"&&(t.thresholds||g))&&e.jsxs("div",{style:{padding:"0 8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.8rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Status"})]}),F&&F.length>0&&F.map((w,ie)=>{const h=(w.hp||0)>=(w.hpMax||1);return e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsxs("div",{style:{backgroundColor:h?"var(--gray-900)":"var(--bg-primary)",borderRadius:"6px",padding:"0.25rem 0.5rem",border:"1px solid",borderColor:h?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",display:"flex",justifyContent:"flex-start",alignItems:"center",gap:"0.5rem",opacity:h?.7:1,position:"relative",transition:"all 0.2s ease",minHeight:"40px"},children:[h&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                          45deg,
                          transparent 0px,
                          transparent 8px,
                          var(--gray-600) 9px,
                          var(--gray-600) 9px
                        )`,pointerEvents:"none",zIndex:1,borderRadius:"4px"}}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"var(--text-secondary)",fontSize:"0.8rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em",zIndex:2,backgroundColor:"var(--gray-900)",padding:"0.125rem 0.25rem",borderRadius:"0.25rem",border:"0.5px solid var(--gray-600)"},children:"DEFEATED"})]}),e.jsx("div",{style:{backgroundColor:h?"var(--gray-900)":"var(--bg-card)",border:"1px solid",borderColor:h?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",borderRadius:"50%",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",flexShrink:0,opacity:h?.5:1},children:e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:h?"var(--gray-400)":"var(--text-primary)"},children:w.duplicateNumber||1})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.125rem"},children:[e.jsx("div",{style:{opacity:h?.3:1},children:e.jsx(Be,{type:"adversaryHP",value:w.hp||0,maxValue:w.hpMax||1,onPipClick:(J,o)=>{if(u&&s==="adversary"){const n=w.hp||0,a=w.hpMax||1;o?l&&l(w.id,1,n):n<a&&u(w.id,1,n,a)}},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})}),w.stressMax>0&&e.jsx("div",{style:{opacity:h?.3:1},children:e.jsx(Be,{type:"adversaryStress",value:w.stress||0,maxValue:w.stressMax,onPipClick:(J,o)=>{A&&s==="adversary"&&(o?A(w.id,-1):A(w.id,1))},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})})]})]},w.id)},w.id)}),t.type!=="Minion"&&(t.thresholds||g)&&e.jsx("div",{style:{display:"flex",justifyContent:"center",paddingTop:"1px",marginTop:"0.5rem",marginBottom:"0.5rem"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",position:"relative"},children:e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",height:"36px"},children:[e.jsx("svg",{width:"300",height:"36",viewBox:"0 0 300 36",style:{position:"absolute",zIndex:1},children:e.jsx("rect",{x:"20",y:"6",width:"260",height:"24",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4"})}),e.jsx("div",{style:{position:"relative",zIndex:2,display:"flex",alignItems:"center",gap:"0.5rem"},children:g?e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",fontSize:"0.8rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),e.jsx(we,{value:((C=t.thresholds)==null?void 0:C.major)||"7"}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),e.jsx(we,{value:((W=t.thresholds)==null?void 0:W.severe)||"14"}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),e.jsx(we,{value:((K=t.thresholds)==null?void 0:K.major)||"7"}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),e.jsx(we,{value:((Q=t.thresholds)==null?void 0:Q.severe)||"14"}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]})})]})})})]}),g&&e.jsxs("div",{style:{marginBottom:"1rem",padding:"0 8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px",textAlign:"center",minWidth:"80px"},children:"Description"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),g?e.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-primary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"none",overflow:"hidden",fontFamily:"inherit"},value:t.description,onChange:w=>{w.target.style.height="auto",w.target.style.height=w.target.scrollHeight+"px",x&&x(t.id,{description:w.target.value})},placeholder:"Enter adversary description..."}):e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",whiteSpace:"pre-wrap"},children:t.description})]}),se()]})};return(i==="expanded"||i==="edit")&&(s==="adversary"||s==="adversaries")?ae():s==="adversary"||s==="adversaries"?null:e.jsxs("div",{className:ce(),style:H(!0),children:[e.jsxs("div",{style:pe.rowMain,children:[e.jsx("h4",{style:pe.rowTitle,children:$()}),e.jsx("div",{style:pe.rowMeta,children:le()})]}),e.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"12px",margin:0},children:["Expanded view coming soon for ",s]})]})},Et="modulepreload",It=function(t){return"/Daggerheart/"+t},qe={},Ce=function(s,i,m){if(!i||i.length===0)return s();const f=document.getElementsByTagName("link");return Promise.all(i.map(u=>{if(u=It(u),u in qe)return;qe[u]=!0;const l=u.endsWith(".css"),A=l?'[rel="stylesheet"]':"";if(!!m)for(let k=f.length-1;k>=0;k--){const z=f[k];if(z.href===u&&(!l||z.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${A}`))return;const v=document.createElement("link");if(v.rel=l?"stylesheet":Et,l||(v.as="script",v.crossOrigin=""),v.href=u,document.head.appendChild(v),l)return new Promise((k,z)=>{v.addEventListener("load",k),v.addEventListener("error",()=>z(new Error(`Unable to preload CSS for ${u}`)))})})).then(()=>s()).catch(u=>{const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=u,window.dispatchEvent(l),!l.defaultPrevented)throw u})},At=({onSave:t,onRefresh:s,onAddItem:i})=>{const[m,f]=b.useState({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:11,thresholds:{major:7,severe:12},hpMax:3,stressMax:1,atk:1,weapon:"",range:"Melee",damage:"",experience:[],features:[]}),[u,l]=b.useState(!1),A=async()=>{if(!m.name.trim()){alert("Please enter a name for the adversary");return}l(!0);try{const v={...m,hp:0,stress:0,source:"Homebrew"},k=await t(v);i&&k&&i(k),s&&await s(),f({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:11,thresholds:{major:7,severe:12},hpMax:3,stressMax:1,atk:1,weapon:"",range:"Melee",damage:"",experience:[],features:[]}),alert("Custom adversary created successfully!")}catch(v){console.error("Error saving adversary:",v),alert("Error saving adversary. Please try again.")}finally{l(!1)}},x={...m,id:"new-adversary",hp:0,stress:0,source:"Homebrew"};return e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem",display:"flex",justifyContent:"center",alignItems:"flex-start"},children:e.jsxs("div",{style:{maxWidth:"600px",width:"100%"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h2",{style:{color:"var(--text-primary)",fontSize:"1.5rem",fontWeight:"600",margin:0},children:"Create Custom Adversary"}),e.jsx("button",{onClick:A,disabled:u||!m.name.trim(),style:{padding:"0.75rem 1.5rem",backgroundColor:u||!m.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"8px",cursor:u||!m.name.trim()?"not-allowed":"pointer",fontSize:"1rem",fontWeight:"600",opacity:u||!m.name.trim()?.6:1},children:u?"Creating...":"Create and Add"})]}),e.jsx(Pe,{item:x,type:"adversary",mode:"edit",onUpdate:(v,k)=>{f(z=>({...z,...k}))}})]})})},zt=(t,s)=>{const[i,m]=b.useState("max-content"),f=b.useCallback(()=>{if(!s.current||t<=3)return"max-content";const u=s.current.offsetWidth,A=Math.floor(u/120);return A<=1?"max-content":t===4?"max-content max-content":t===5||t===6?A>=2?"max-content max-content":"max-content":t===7?A>=3?"max-content max-content max-content":A>=2?"max-content max-content":"max-content":"repeat(auto-fit, minmax(80px, max-content))"},[t,s]);return b.useEffect(()=>{const u=f();m(u);const l=new ResizeObserver(()=>{const A=f();m(A)});return s.current&&l.observe(s.current),()=>{l.disconnect()}},[f]),i},Wt=({encounter:t})=>{var f,u;const s=b.useRef(null),i=((f=t.encounterItems)==null?void 0:f.length)||0,m=zt(i,s);return e.jsx("div",{ref:s,className:"saved-encounter-adversary-list",style:{flex:1,fontSize:"0.8rem",color:"var(--text-secondary)",lineHeight:"1.3",display:"grid",gridTemplateColumns:m,gap:"0.25rem 1rem",gridAutoRows:"min-content"},children:((u=t.encounterItems)==null?void 0:u.length)>0?t.encounterItems.map((l,A)=>{var v;const x=l.item.baseName||((v=l.item.name)==null?void 0:v.replace(/\s+\(\d+\)$/,""))||l.item.name;return e.jsxs("div",{style:{marginBottom:"0.125rem"},children:[l.quantity,"x ",x]},A)}):e.jsx("div",{children:"No adversaries"})})},ve={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},Se={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1,lowerTierAdversary:1};let ke={adversaries:[]},Ee={environments:[]},Ie=!1;const Xe=()=>{const t=JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]"),s=JSON.parse(localStorage.getItem("daggerheart-custom-environments")||"[]");return{customAdversaries:t,customEnvironments:s}},Tt=(t,s)=>{t==="adversary"?localStorage.setItem("daggerheart-custom-adversaries",JSON.stringify(s)):t==="environment"&&localStorage.setItem("daggerheart-custom-environments",JSON.stringify(s))},Le=async()=>{if(Ie)return;let t={adversaries:[]},s={environments:[]},i={adversaries:[]},m={environments:[]};try{const l=await Ce(()=>import("./adversaries-9c8932de.js"),[]);t=(l==null?void 0:l.default)||l}catch(l){console.warn("Failed to load adversaries.json:",l)}try{const l=await Ce(()=>import("./environments-c340637c.js"),[]);s=(l==null?void 0:l.default)||l}catch(l){console.warn("Failed to load environments.json:",l)}try{const l=await Ce(()=>import("./playtest-adversaries-4a099c10.js"),[]);i=(l==null?void 0:l.default)||l}catch(l){console.warn("Failed to load playtest-adversaries.json:",l)}try{const l=await Ce(()=>import("./playtest-environments-d9cdffb6.js"),[]);m=(l==null?void 0:l.default)||l}catch(l){console.warn("Failed to load playtest-environments.json:",l)}const{customAdversaries:f,customEnvironments:u}=Xe();ke={...t,adversaries:[...t.adversaries||[],...i.adversaries||[],...f]},Ee={...s,environments:[...s.environments||[],...m.environments||[],...u]},Ie=!0,console.log(`Loaded ${ke.adversaries.length} adversaries and ${Ee.environments.length} environments`)},Rt=t=>{const{customAdversaries:s}=Xe(),i={...t,id:`custom-${Date.now()}-${Math.random().toString(36).slice(2,10)}`,source:t.source||"Homebrew"},m=[...s,i];return Tt("adversary",m),Ie=!1,Le(),i},Nt=(t,s=[],i=4,m=1)=>{const[f,u]=b.useState(""),[l,A]=b.useState([{field:"tier",direction:"asc"},{field:"name",direction:"asc"}]),[x,v]=b.useState([]),[k,z]=b.useState(!0),[F,y]=b.useState([]),[T,Y]=b.useState([]),[B,L]=b.useState(!1),[j,M]=b.useState(!1),I=b.useRef(null),D=b.useRef(null);b.useEffect(()=>{(async()=>{await Le(),z(!1);let W=[];t==="adversary"?W=ke.adversaries||[]:t==="environment"&&(W=Ee.environments||[]),v(W)})()},[t]);const U=b.useCallback(async()=>{Ie=!1,await Le();let C=[];t==="adversary"?C=ke.adversaries||[]:t==="environment"&&(C=Ee.environments||[]),v(C)},[t]),H=C=>{const W=x.map(K=>K[C]).filter(Boolean);return[...new Set(W)].sort((K,Q)=>typeof K=="number"&&typeof Q=="number"?K-Q:String(K).localeCompare(String(Q)))},ce=H("tier"),$=H("type"),le=b.useMemo(()=>{let C=x.filter(W=>{var ie,h;const K=W.name.toLowerCase().includes(f.toLowerCase())||((ie=W.type)==null?void 0:ie.toLowerCase().includes(f.toLowerCase()))||((h=W.description)==null?void 0:h.toLowerCase().includes(f.toLowerCase())),Q=F.length===0||(F.includes("party-tier")?W.tier===m:F.includes(W.tier.toString())),w=T.length===0||T.includes(W.type);return K&&Q&&w});return C.sort((W,K)=>{for(const Q of l){const{field:w,direction:ie}=Q;let h=W[w],J=K[w];if(w==="tier")h=parseInt(h)||0,J=parseInt(J)||0;else if(w==="cost"){const o=n=>{if(t!=="adversary")return 0;const a=ve[n.type]||2;let r=0;const p=s.filter(O=>O.type==="adversary"&&O.item.type==="Solo"&&O.quantity>0).reduce((O,de)=>O+de.quantity,0),E=s.filter(O=>O.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(O.item.type)&&O.quantity>0).reduce((O,de)=>O+de.quantity,0);return n.type==="Solo"&&p===1&&(r+=2),["Bruiser","Horde","Leader","Solo"].includes(n.type)&&E===0&&(r+=1),a+r};h=o(W),J=o(K)}else if(w==="difficulty"){const o=parseInt(h),n=parseInt(J);!isNaN(o)&&!isNaN(n)?(h=o,J=n):!isNaN(o)&&isNaN(n)?(h=o,J=999):isNaN(o)&&!isNaN(n)?(h=999,J=n):(h=String(h||"").toLowerCase(),J=String(J||"").toLowerCase())}else typeof h=="string"&&typeof J=="string"?(h=h.toLowerCase(),J=J.toLowerCase()):(h=String(h||"").toLowerCase(),J=String(J||"").toLowerCase());if(ie==="asc"){if(h>J)return 1;if(h<J)return-1}else{if(h<J)return 1;if(h>J)return-1}}return 0}),C},[x,f,l,F,T,s,i,m]),se=C=>{A(W=>{const K=W.findIndex(Q=>Q.field===C);if(K>=0)if(K===0){const Q=[...W];return Q[0]={...Q[0],direction:Q[0].direction==="asc"?"desc":"asc"},Q}else{const Q=[...W];return Q.splice(K,1)[0],[{field:C,direction:"asc"},...Q]}else return[{field:C,direction:"asc"},...W]})},ae=C=>{y(C==="clear"?[]:C==="party-tier"?["party-tier"]:W=>W.includes(C)?W.filter(K=>K!==C):[...W,C])},ee=C=>{Y(C==="clear"?[]:W=>W.includes(C)?W.filter(K=>K!==C):[...W,C])},c=F.length>0,g=T.length>0;return b.useEffect(()=>{const C=K=>{const Q=K.target.closest(".filter-dropdown"),w=K.target.closest(".header-filter-icon");Q||w||(L(!1),M(!1))},W=K=>{K.key==="Escape"&&(L(!1),M(!1))};return document.addEventListener("pointerdown",C,!0),document.addEventListener("mousedown",C,!0),document.addEventListener("touchstart",C,!0),document.addEventListener("click",C,!0),document.addEventListener("keydown",W,!0),()=>{document.removeEventListener("pointerdown",C,!0),document.removeEventListener("mousedown",C,!0),document.removeEventListener("touchstart",C,!0),document.removeEventListener("click",C,!0),document.removeEventListener("keydown",W,!0)}},[L,M]),{searchTerm:f,setSearchTerm:u,sortFields:l,handleSort:se,filteredAndSortedData:le,loading:k,refreshData:U,selectedTiers:F,selectedTypes:T,showTierDropdown:B,setShowTierDropdown:L,showTypeDropdown:j,setShowTypeDropdown:M,tierFilterRef:I,typeFilterRef:D,uniqueTiers:ce,uniqueTypes:$,handleTierSelect:ae,handleTypeSelect:ee,isTierFiltered:c,isTypeFiltered:g,getDropdownStyle:C=>{if(!C.current)return{};const W=C.current.getBoundingClientRect();return{position:"fixed",top:W.bottom+4,left:W.left-100,zIndex:99999}}}},Bt=({searchTerm:t,onSearchChange:s,type:i,partyControls:m})=>e.jsxs("div",{style:V.browserHeader,children:[e.jsx("input",{type:"text",placeholder:"Search",value:t,onChange:f=>s(f.target.value),style:V.searchInput}),m&&e.jsx("div",{style:V.partyControls,children:m})]}),Lt=({sortFields:t,onSort:s,type:i,uniqueTiers:m,uniqueTypes:f,selectedTiers:u,selectedTypes:l,showTierDropdown:A,setShowTierDropdown:x,showTypeDropdown:v,setShowTypeDropdown:k,tierFilterRef:z,typeFilterRef:F,handleTierSelect:y,handleTypeSelect:T,isTierFiltered:Y,isTypeFiltered:B,getDropdownStyle:L,costFilter:j,showCostDropdown:M,setShowCostDropdown:I,costFilterRef:D,handleCostFilterSelect:U,isCostFiltered:H})=>{const[ce,$]=b.useState(null),se=(()=>i==="adversary"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"cost",label:"Cost",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:i==="environment"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:[])(),ae=()=>{if(!M)return null;const c=[{value:"all",label:"All"},{value:"auto-grey",label:"Auto Grey"},{value:"auto-hide",label:"Auto Hide"}];return Re.createPortal(e.jsx("div",{className:"filter-dropdown",style:{...V.filterDropdown,...L(D),maxHeight:"60vh",overflow:"auto"},onMouseDown:g=>g.stopPropagation(),onClick:g=>g.stopPropagation(),children:c.map(g=>{const G=j===g.value;return e.jsxs("div",{style:{...V.filterOption,...G?V.filterOptionSelected:{}},onClick:()=>U(g.value),children:[e.jsx("span",{style:V.checkIcon,children:G?e.jsx(be,{size:16}):e.jsx(je,{size:16})}),e.jsx("span",{style:V.filterLabel,children:g.label})]},g.value)})}),document.body)},ee=(c,g,G,C,W,K,Q,w)=>{if(!W)return null;const ie=()=>{(c==="tier"||c==="type")&&C("clear")};return Re.createPortal(e.jsxs("div",{className:"filter-dropdown",style:{...V.filterDropdown,...L(Q),maxHeight:"60vh",overflow:"auto"},onMouseDown:h=>h.stopPropagation(),onClick:h=>h.stopPropagation(),children:[e.jsxs("div",{style:{...V.filterOption,...G.length===0?V.filterOptionSelected:{}},onClick:ie,children:[e.jsx("span",{style:V.checkIcon,children:G.length===0?e.jsx(be,{size:16}):e.jsx(je,{size:16})}),e.jsx("span",{style:V.filterLabel,children:"All"})]}),c==="tier"&&e.jsxs("div",{style:{...V.filterOption,...G.includes("party-tier")?V.filterOptionSelected:{}},onClick:()=>C("party-tier"),children:[e.jsx("span",{style:V.checkIcon,children:G.includes("party-tier")?e.jsx(be,{size:16}):e.jsx(je,{size:16})}),e.jsx("span",{style:V.filterLabel,children:"Party Tier"})]}),g.map(h=>{const J=G.includes(h.toString());return e.jsxs("div",{style:{...V.filterOption,...J?V.filterOptionSelected:{}},onClick:()=>C(h.toString()),children:[e.jsx("span",{style:V.checkIcon,children:J?e.jsx(be,{size:16}):e.jsx(je,{size:16})}),e.jsx("span",{style:V.filterLabel,children:h})]},h)})]}),document.body)};return e.jsx("tr",{style:V.tableHeader,children:se.map(c=>e.jsxs("th",{style:{...V.tableHeaderCell,...ce===c.key?V.tableHeaderCellHover:{},position:"relative",...c.key==="name"?{width:"auto",minWidth:"0"}:{},...c.key==="tier"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...c.key==="type"?{width:"80px",minWidth:"80px",maxWidth:"80px"}:{},...c.key==="difficulty"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...c.key==="cost"?{width:"50px",minWidth:"50px",maxWidth:"50px"}:{},...c.key==="action"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{}},onClick:()=>s(c.key),onMouseEnter:()=>$(c.key),onMouseLeave:()=>$(null),children:[c.hasFilter?e.jsxs("div",{style:V.headerWithFilter,children:[e.jsx("span",{style:{cursor:"pointer"},onClick:g=>{g.stopPropagation(),s(c.key)},children:c.label}),e.jsxs("button",{ref:c.key==="tier"?z:c.key==="type"?F:D,style:{...V.headerFilterIcon,...c.key==="tier"&&Y?V.headerFilterIconActive:{},...c.key==="type"&&B?V.headerFilterIconActive:{},...c.key==="cost"&&H?V.headerFilterIconActive:{}},className:"header-filter-icon",onClick:g=>{g.stopPropagation(),c.key==="tier"?(x(!A),k(!1),I(!1)):c.key==="type"?(k(!v),x(!1),I(!1)):c.key==="cost"&&(I(!M),x(!1),k(!1))},children:[e.jsx(pt,{size:14}),c.key==="tier"&&Y||c.key==="type"&&B||c.key==="cost"&&H?e.jsx("span",{style:V.filterActiveDot}):null]})]}):c.label,c.key==="tier"&&ee("tier",m,u,y,A,x,z),c.key==="type"&&ee("type",f,l,T,v,k,F),c.key==="cost"&&ae()]},c.key))})},Mt=({item:t,onAdd:s,type:i,onRowClick:m,encounterItems:f=[],pcCount:u=4,playerTier:l=1,remainingBudget:A=0,costFilter:x="auto-grey",onAdversaryClick:v})=>{const[k,z]=b.useState(!1),F=()=>{s(t)},y=()=>{if(i!=="adversary")return null;const B=ve[t.type]||2;let L=0;const j=f.filter(I=>I.type==="adversary"&&I.item.type==="Solo"&&I.quantity>0).reduce((I,D)=>I+D.quantity,0),M=f.filter(I=>I.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(I.item.type)&&I.quantity>0).reduce((I,D)=>I+D.quantity,0);return t.type==="Solo"&&j===1&&(L+=2),["Bruiser","Horde","Leader","Solo"].includes(t.type)&&M===0&&(L+=1),B+L},Y=(()=>{if(i==="adversary"){const B=y();ve[t.type];const L=B>A||A<=0;if(x==="auto-hide"&&L)return null;const j=x==="auto-grey"&&L?{opacity:.5,color:"var(--text-secondary)"}:{};return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...V.rowCell,width:"auto",minWidth:"0",textAlign:"left",...j},children:e.jsxs("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:[e.jsx("div",{style:{fontWeight:"600"},children:t.name}),t.description&&e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"0.125rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.description})]})}),e.jsx("td",{style:{...V.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...j},children:t.tier}),e.jsx("td",{style:{...V.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center",...j},children:t.type}),e.jsx("td",{style:{...V.rowCell,width:"50px",minWidth:"50px",maxWidth:"50px",textAlign:"center",...j},children:B}),e.jsx("td",{style:{...V.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...j},children:t.difficulty})]})}else if(i==="environment")return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...V.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:t.name}),e.jsx("td",{style:{...V.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:t.tier}),e.jsx("td",{style:{...V.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:t.type}),e.jsx("td",{style:{...V.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:t.difficulty})]});return null})();return Y===null?null:e.jsx(e.Fragment,{children:e.jsxs("tr",{style:{...V.row,...k?V.rowHover:{}},onClick:()=>{i==="adversary"&&v?v(t):m&&m(t,i)},onMouseEnter:()=>z(!0),onMouseLeave:()=>z(!1),children:[Y,e.jsx("td",{style:{width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",boxSizing:"border-box",overflow:"visible",textOverflow:"unset",whiteSpace:"nowrap"},children:e.jsx("button",{style:V.addButton,onClick:B=>{B.stopPropagation(),F()},onMouseEnter:B=>{B.target.style.background="var(--bg-secondary)"},onMouseLeave:B=>{B.target.style.background="var(--purple)"},children:"+"})})]})})},Pt=({type:t,onAddItem:s,onCancel:i=null,onRowClick:m,encounterItems:f=[],pcCount:u=4,playerTier:l=1,partyControls:A=null,showContainer:x=!0,savedEncounters:v=[],onLoadEncounter:k,onDeleteEncounter:z,activeTab:F="adversaries"})=>{const[y,T]=b.useState("all"),[Y,B]=b.useState(!1),[L,j]=b.useState(null),[M,I]=b.useState({}),D=b.useRef({}),U=b.useRef(null),H=R=>{M[R]?(z&&z(R),I(d=>{const S={...d};return delete S[R],S}),D.current[R]&&(clearTimeout(D.current[R]),delete D.current[R])):(I(d=>({...d,[R]:!0})),D.current[R]&&clearTimeout(D.current[R]),D.current[R]=setTimeout(()=>{I(d=>{const S={...d};return delete S[R],S}),delete D.current[R]},3e3))};b.useEffect(()=>()=>{Object.values(D.current).forEach(R=>{clearTimeout(R)})},[]);const{searchTerm:ce,setSearchTerm:$,sortFields:le,handleSort:se,filteredAndSortedData:ae,loading:ee,refreshData:c,selectedTiers:g,selectedTypes:G,showTierDropdown:C,setShowTierDropdown:W,showTypeDropdown:K,setShowTypeDropdown:Q,tierFilterRef:w,typeFilterRef:ie,uniqueTiers:h,uniqueTypes:J,handleTierSelect:o,handleTypeSelect:n,isTierFiltered:a,isTypeFiltered:r,getDropdownStyle:p}=Nt(t,f,u,l),O=(()=>{const R=3*u+2,d=f.reduce((N,ne)=>{if(ne.type==="adversary"){const ue=ve[ne.item.type]||2;if(ne.item.type==="Minion"){const oe=Math.ceil(ne.quantity/u);return N+oe*ue}else return N+ne.quantity*ue}return N},0);let S=0;f.filter(N=>N.type==="adversary"&&N.item.type==="Solo"&&N.quantity>0).reduce((N,ne)=>N+ne.quantity,0)>=2&&(S+=Se.twoOrMoreSolos);const q=f.some(N=>N.type==="adversary"&&N.item.type==="Bruiser"&&N.quantity>0),X=f.some(N=>N.type==="adversary"&&N.item.type==="Horde"&&N.quantity>0),re=f.some(N=>N.type==="adversary"&&N.item.type==="Leader"&&N.quantity>0),_=f.some(N=>N.type==="adversary"&&N.item.type==="Solo"&&N.quantity>0);return!q&&!X&&!re&&!_&&(S+=Se.noBruisersHordesLeadersSolos),R+S-d})(),de=R=>{T(R),B(!1)},te=y!=="all";return ee?e.jsx("div",{style:V.browser,children:e.jsx("div",{style:V.loading,children:"Loading..."})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:x?V.browserWrapper:V.browserWrapperNoContainer,children:[F==="adversaries"&&e.jsxs(e.Fragment,{children:[e.jsx(Bt,{searchTerm:ce,onSearchChange:$,type:t,partyControls:A}),e.jsx("div",{className:"browser-content invisible-scrollbar",style:V.browserContent,children:e.jsxs("table",{style:V.browserTable,children:[e.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,backgroundColor:"var(--bg-primary)"},children:e.jsx(Lt,{sortFields:le,onSort:se,type:t,uniqueTiers:h,uniqueTypes:J,selectedTiers:g,selectedTypes:G,showTierDropdown:C,setShowTierDropdown:W,showTypeDropdown:K,setShowTypeDropdown:Q,tierFilterRef:w,typeFilterRef:ie,handleTierSelect:o,handleTypeSelect:n,isTierFiltered:a,isTypeFiltered:r,getDropdownStyle:p,costFilter:y,showCostDropdown:Y,setShowCostDropdown:B,costFilterRef:U,handleCostFilterSelect:de,isCostFiltered:te})}),e.jsx("tbody",{children:ae.map(R=>e.jsx(Mt,{item:R,onAdd:s,type:t,onRowClick:m,encounterItems:f,pcCount:u,playerTier:l,remainingBudget:O,costFilter:y,onAdversaryClick:d=>{t==="adversary"&&j(d)}},R.id))})]})})]}),F==="encounters"&&e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:v.length===0?e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",textAlign:"center",padding:"2rem 1rem"},children:"No saved encounters yet"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:v.map(R=>e.jsxs("div",{onClick:()=>k&&k(R.id),className:"saved-encounter-card",style:{border:"1px solid var(--border)",borderRadius:"8px",padding:"8px",backgroundColor:"var(--bg-card)",transition:"background-color 0.2s ease",display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsxs("div",{style:{minWidth:"100px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",flexDirection:"column",justifyContent:"center",minHeight:"60px"},children:[e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Tier: ",(()=>{var P,q,X,re;const d=((re=(X=(q=(P=R.encounterItems)==null?void 0:P.filter(_=>_.type==="adversary"))==null?void 0:q.map(_=>_.item.tier))==null?void 0:X.filter(_=>_!=null))==null?void 0:re.sort((_,Z)=>_-Z))||[];if(d.length===0)return"N/A";if(d.length===1)return d[0];const S=[...new Set(d)];return S.length===1?S[0]:`${Math.min(...S)}-${Math.max(...S)}`})()]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Party Size: ",R.partySize||4]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)"},children:["Balance: ",(()=>{const d=R.partySize||4,S=3*d+2;let P=0;const q=R.encounterItems||[];q.filter(oe=>oe.type==="adversary"&&oe.item.type==="Solo"&&oe.quantity>0).reduce((oe,xe)=>oe+xe.quantity,0)>=2&&(P+=Se.twoOrMoreSolos);const re=q.some(oe=>oe.type==="adversary"&&oe.item.type==="Bruiser"&&oe.quantity>0),_=q.some(oe=>oe.type==="adversary"&&oe.item.type==="Horde"&&oe.quantity>0),Z=q.some(oe=>oe.type==="adversary"&&oe.item.type==="Leader"&&oe.quantity>0),N=q.some(oe=>oe.type==="adversary"&&oe.item.type==="Solo"&&oe.quantity>0);!re&&!_&&!Z&&!N&&(P+=Se.noBruisersHordesLeadersSolos);const ne=S+P,ue=q.reduce((oe,xe)=>{if(xe.type==="adversary"){const ye=ve[xe.item.type]||2;if(xe.item.type==="Minion"){const he=Math.ceil(xe.quantity/d);return oe+he*ye}else return oe+xe.quantity*ye}return oe},0);return ue>ne?`+${ue-ne}`:ue===ne?"0":`-${ne-ue}`})()]})]}),e.jsx("div",{style:{minWidth:"120px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",alignItems:"center",minHeight:"60px"},children:e.jsx("div",{style:{fontWeight:"500",color:"var(--text-primary)",fontSize:"0.9rem",wordWrap:"break-word",wordBreak:"break-word",width:"150px",maxWidth:"150px"},children:R.name})}),e.jsx(Wt,{encounter:R}),e.jsx("button",{onClick:d=>{d.stopPropagation(),H(R.id)},style:{background:M[R.id]?"var(--danger)":"var(--gray-600)",border:"none",color:"white",padding:"0.4rem 0.8rem",borderRadius:"4px",fontSize:"0.75rem",cursor:"pointer",minWidth:"60px",transition:"background-color 0.2s"},children:"Delete"})]},R.id))})}),F==="custom"&&e.jsx(At,{onSave:Rt,onRefresh:c,onAddItem:s})]}),L&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:2e3,display:"flex",alignItems:"center",justifyContent:"center",padding:"2rem"},onClick:()=>j(null),children:e.jsx("div",{style:{maxWidth:"600px",width:"90vw",maxHeight:"80vh",overflowY:"auto"},onClick:R=>R.stopPropagation(),children:e.jsx(Pe,{item:L,type:"adversary",mode:"expanded",onClose:()=>j(null)})})})]})},V={browserWrapper:{display:"flex",flexDirection:"column",background:"var(--bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border)",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserWrapperNoContainer:{display:"flex",flexDirection:"column",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserContent:{flex:1,overflowY:"auto",overflowX:"visible",padding:0,width:"100%",scrollbarWidth:"none",msOverflowStyle:"none"},tableHeaderContainer:{flexShrink:0,position:"sticky",top:0,zIndex:15,backgroundColor:"var(--bg-secondary)"},browserTable:{width:"100%",minWidth:"100%",borderCollapse:"collapse",tableLayout:"fixed",background:"var(--bg-primary)",margin:0},browserHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--gray-900)",flexShrink:0,position:"sticky",top:0,zIndex:20},browserTitle:{margin:0,color:"var(--text-primary)",fontSize:"18px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"24px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",marginRight:"12px",transition:"all 0.2s ease"},partyControls:{display:"flex",alignItems:"center",gap:"12px",flexShrink:0},searchInputFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 3px rgba(139, 92, 246, 0.1)"},tableHeader:{background:"var(--gray-900)",borderBottom:"1px solid var(--border)",boxShadow:"0 1px 0 var(--border)",position:"sticky",top:"0",zIndex:10},tableHeaderCell:{backgroundColor:"var(--gray-900)",fontWeight:"700",borderBottom:"1px solid var(--border)",cursor:"pointer",userSelect:"none",minWidth:"100px",whiteSpace:"nowrap",padding:"4px 4px",color:"var(--text-primary)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",boxShadow:"0 1px 0 var(--border)",transition:"background-color 0.2s",position:"sticky",top:"0",zIndex:10},tableHeaderCellHover:{backgroundColor:"var(--bg-hover)"},sortIndicator:{fontSize:"12px",color:"var(--text-secondary)"},tableBody:{flex:1,overflowY:"auto",padding:"8px",backgroundColor:"var(--bg-primary)"},row:{height:"35px",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s ease",cursor:"pointer",backgroundColor:"var(--gray-900)"},rowHover:{backgroundColor:"var(--bg-secondary)"},expandedRow:{backgroundColor:"var(--bg-secondary)"},rowCell:{padding:"4px 4px",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid var(--border)"},rowCellName:{fontWeight:"500",minWidth:"150px"},rowCellCenter:{textAlign:"center",justifyContent:"center",minWidth:"80px"},rowActions:{width:"80px",textAlign:"center",padding:"4px 8px",borderBottom:"1px solid var(--border)"},addButton:{width:"2rem",height:"2rem",border:"1px solid var(--purple)",borderRadius:"var(--radius-sm)",background:"var(--purple)",color:"white",cursor:"pointer",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"500"},expandedContent:{padding:"0",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)"},columnName:{width:"auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",paddingLeft:"8px",textAlign:"left"},columnTier:{width:"80px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnType:{width:"100px",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},columnDifficulty:{width:"40px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnAction:{width:"32px",minWidth:"24px",maxWidth:"24px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"visible",textOverflow:"unset"},loading:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"var(--text-primary)",fontSize:"16px"},mobileBrowser:{width:"95vw",height:"90vh",maxWidth:"none"},mobileSearchInput:{fontSize:"16px"},headerWithFilter:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0px",position:"relative"},headerFilterIcon:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"2px 4px",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",position:"relative",marginLeft:"-2px"},headerFilterIconActive:{color:"var(--purple)"},filterIcon:{fontSize:"12px"},filterActiveDot:{position:"absolute",left:"50%",top:"2px",transform:"translateX(-50%)",width:"4px",height:"4px",borderRadius:"50%",background:"var(--purple)",pointerEvents:"none"},filterDropdown:{position:"fixed",background:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",zIndex:99999,marginTop:"4px",overflow:"hidden",width:"max-content",minWidth:"120px",maxWidth:"200px"},filterOption:{padding:"8px 12px",cursor:"pointer",color:"var(--text-primary)",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background-color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},filterOptionSelected:{backgroundColor:"var(--bg-hover)"},checkIcon:{width:"16px",height:"16px",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"12px"},filterLabel:{flex:1}},Dt=()=>e.jsx("div",{className:"pwa-install-prompt",style:{}}),Ht=({side:t="left",children:s,className:i="",style:m={}})=>{const f=t==="left",u={flex:1,minWidth:0,background:"var(--bg-primary)",overflowY:"auto",overflowX:f?"auto":"hidden",display:f?"block":"flex",flexDirection:f?"initial":"column",height:"100%",padding:f?"8px 0 8px 0":"0 8px 0 0",...m};return e.jsx("div",{className:i,style:u,children:s})},Ft=t=>3*t+2,Ot={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},Te={lessDifficult:-1,twoOrMoreSolos:-2,increasedDamage:-2,lowerTierAdversary:1,noBruisersHordesLeadersSolos:1,moreDangerous:2},$t=({isOpen:t,onClose:s,onAddAdversary:i,onAddAdversariesBulk:m,onAddEnvironment:f,onDeleteAdversary:u,onDeleteEnvironment:l,onDeleteCountdown:A,adversaries:x=[],environments:v=[],countdowns:k=[],savedEncounters:z=[],onSaveEncounter:F,onLoadEncounter:y,onDeleteEncounter:T})=>{const{partySize:Y,updatePartySize:B,currentEncounterName:L,updateCurrentEncounterName:j}=Je(),M=Y,I=B,[D,U]=b.useState({lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),[H,ce]=b.useState([]),[$,le]=b.useState(L||"Encounter"),[se,ae]=b.useState("adversaries"),[ee,c]=b.useState(null),[g,G]=b.useState(null);b.useEffect(()=>{t&&!ee&&le(L||"Encounter")},[t,ee,L]);const C=()=>g?$!==g.name||JSON.stringify(H)!==JSON.stringify(g.encounterItems)||M!==g.partySize||JSON.stringify(D)!==JSON.stringify(g.battlePointsAdjustments):!1,W=()=>{var d;if(H.length>0||($||"").trim()!=="Encounter")return!0;if(ee&&C()){if(g){const S=H.length,P=((d=g.encounterItems)==null?void 0:d.length)||0;if(S!==P||($||"").trim()!==(g.name||""))return!0;const q=JSON.stringify(D),X=JSON.stringify(g.battlePointsAdjustments||{});return q!==X}return!0}return!1},K=({onClick:d,children:S,variant:P="secondary",isConfirmation:q=!1})=>{const X=P==="danger"||P==="secondary"&&q,re=P==="purple";return e.jsx("button",{onClick:d,style:{background:X?"var(--danger)":re?"var(--purple)":"var(--bg-secondary)",border:re?"none":"1px solid var(--border)",color:X||re?"white":"var(--text-primary)",padding:"0.375rem 0.75rem",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s",width:"70px",fontSize:"0.875rem"},children:S})},Q=ge.useRef(M),w=b.useCallback(d=>!d||d.length===0?null:z.find(P=>{var _,Z;if(((_=P.encounterItems)==null?void 0:_.length)!==d.length)return!1;const q=N=>{var ne;return{type:N.type,quantity:N.quantity,item:{name:N.item.baseName||((ne=N.item.name)==null?void 0:ne.replace(/\s+\(\d+\)$/,""))||N.item.name,type:N.item.type,tier:N.item.tier}}},X=(Z=P.encounterItems)==null?void 0:Z.map(q).sort((N,ne)=>N.item.name.localeCompare(ne.item.name)||N.item.type.localeCompare(ne.item.type)),re=d.map(q).sort((N,ne)=>N.item.name.localeCompare(ne.item.name)||N.item.type.localeCompare(ne.item.type));return JSON.stringify(X)===JSON.stringify(re)})||null,[z]);ge.useEffect(()=>{if(t&&x.length>0&&H.length===0){const d={};x.forEach(q=>{var re;const X=q.baseName||((re=q.name)==null?void 0:re.replace(/\s+\(\d+\)$/,""))||q.name;d[X]||(d[X]={type:"adversary",item:q,quantity:0}),d[X].quantity+=1});const S=Object.values(d);ce(S);const P=w(S);P&&!ee&&(c(P.id),G({name:P.name||"",encounterItems:P.encounterItems||[],partySize:P.partySize||4,battlePointsAdjustments:P.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),le(P.name||"Encounter"),j(P.name||"Encounter"))}else t&&x.length===0&&H.length===0&&ce([])},[t,w,ee,j]);const ie=ge.useMemo(()=>{let d=0;H.filter(_=>_.type==="adversary"&&_.item.type==="Solo"&&_.quantity>0).reduce((_,Z)=>_+Z.quantity,0)>=2&&(d+=Te.twoOrMoreSolos);const P=H.some(_=>_.type==="adversary"&&_.item.type==="Bruiser"&&_.quantity>0),q=H.some(_=>_.type==="adversary"&&_.item.type==="Horde"&&_.quantity>0),X=H.some(_=>_.type==="adversary"&&_.item.type==="Leader"&&_.quantity>0),re=H.some(_=>_.type==="adversary"&&_.item.type==="Solo"&&_.quantity>0);return!P&&!q&&!X&&!re&&(d+=Te.noBruisersHordesLeadersSolos),d},[H]),h=Ft(M),J=Object.entries(D).filter(([d,S])=>S).reduce((d,[S,P])=>d+Te[S],0),o=h+J+ie,n=H.reduce((d,S)=>{if(S.type==="adversary"){const P=Ot[S.item.type]||2;return S.item.type==="Minion"?d+Math.ceil(S.quantity/M)*P:d+P*S.quantity}return d},0);ge.useEffect(()=>{const d=Q.current;d!==M&&(ce(S=>S.map(P=>{if(P.type==="adversary"&&P.item.type==="Minion"){const X=Math.ceil(P.quantity/d)*M;return{...P,quantity:X}}return P})),Q.current=M)},[M]);const a=(d,S)=>{const P=H.findIndex(re=>re.item.id===d.id&&re.type===S),q=d.type==="Minion"?M:1;let X;P>=0?X=H.map((re,_)=>_===P?{...re,quantity:re.quantity+q}:re):X=[...H,{item:d,type:S,quantity:q}],ce(X),r(X)},r=d=>{const S=x||[],P=[];d.forEach(Z=>{for(let N=0;N<Z.quantity;N++)Z.type==="adversary"&&P.push(Z.item)});const q={};S.forEach(Z=>{var ne;const N=Z.baseName||((ne=Z.name)==null?void 0:ne.replace(/\s+\(\d+\)$/,""))||Z.name;q[N]||(q[N]=[]),q[N].push(Z)});const X={};P.forEach(Z=>{var ne;const N=Z.baseName||((ne=Z.name)==null?void 0:ne.replace(/\s+\(\d+\)$/,""))||Z.name;X[N]||(X[N]=[]),X[N].push(Z)});const re=[],_=[];Object.keys(X).forEach(Z=>{var ue;const N=((ue=q[Z])==null?void 0:ue.length)||0,ne=X[Z].length;if(ne>N){const oe=ne-N;for(let xe=0;xe<oe;xe++)re.push(X[Z][0])}else if(ne<N){const oe=N-ne,ye=[...q[Z]].sort((he,Ke)=>{const Qe=he.duplicateNumber||1;return(Ke.duplicateNumber||1)-Qe});for(let he=0;he<oe;he++)_.push(ye[he].id)}}),Object.keys(q).forEach(Z=>{X[Z]||[...q[Z]].sort((ue,oe)=>{const xe=ue.duplicateNumber||1;return(oe.duplicateNumber||1)-xe}).forEach(ue=>{_.push(ue.id)})}),_.forEach(Z=>{u(Z)}),re.length>0&&m(re)},p=(d,S)=>{const P=(()=>{const q=H.findIndex(X=>X.item.id===d&&X.type===S);if(q>=0){const X=H[q];if(X.quantity===0)return H.filter((Z,N)=>N!==q);const re=X.item.type==="Minion"?M:1,_=Math.max(0,X.quantity-re);return H.map((Z,N)=>N===q?{...Z,quantity:_}:Z)}return H})();ce(P),r(P)},E=b.useCallback(()=>{if(H.length===0)return null;const d=($||"").trim()||"Encounter",S=z.find(P=>{var re,_;if(P.name!==d||((re=P.encounterItems)==null?void 0:re.length)!==H.length)return!1;const q=JSON.stringify((_=P.encounterItems)==null?void 0:_.sort()),X=JSON.stringify([...H].sort());return q===X});return(S==null?void 0:S.id)||null},[z,$,H]),O=b.useCallback(()=>{let d=($||"").trim(),S=ee;if(S||(S=E()),H.length===0&&(!d||d==="Encounter")&&S){T(S),c(null),G(null);return}const P={name:d,encounterItems:H,partySize:M,battlePointsAdjustments:D};if(S){P.id=S;const q=F(P);c(q)}else{const q=F(P);c(q)}G({name:d,encounterItems:H,partySize:M,battlePointsAdjustments:D})},[H,$,M,D,ee,F,E,T]);b.useEffect(()=>{if(ee&&C()){const d=setTimeout(()=>{O()},2e3);return()=>clearTimeout(d)}else if(!ee&&H.length>0&&$&&$.trim()!==""){const d=setTimeout(()=>{O()},2e3);return()=>clearTimeout(d)}},[H,ee,$,D,M]);const de=()=>{W()&&(ce([]),le("Encounter"),j("Encounter"),c(null),G(null),x.forEach(d=>{u(d.id)}),v.forEach(d=>{l(d.id)}),k.forEach(d=>{A(d.id)}))},te=d=>{const S=y(d);if(S){const P=S.encounterItems||[];ce(P),I(S.partySize||4),U(S.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),le(S.name||""),j(S.name||""),c(d),G({name:S.name||"",encounterItems:S.encounterItems||[],partySize:S.partySize||4,battlePointsAdjustments:S.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),r(P)}},R=d=>{T(d),ee===d&&(ce([]),le("Encounter"),j("Encounter"),c(null),G(null),x.forEach(S=>{u(S.id)}),v.forEach(S=>{l(S.id)}),k.forEach(S=>{A(S.id)}))};return t?e.jsx("div",{onClick:s,className:"encounter-builder-modal",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:1e3,display:"flex",alignItems:"flex-start",justifyContent:"center",padding:"12px"},children:e.jsxs("div",{onClick:d=>d.stopPropagation(),style:{backgroundColor:"var(--bg-primary)",border:"2px solid var(--border)",borderRadius:"12px",width:"100%",maxWidth:"1200px",height:"calc(100vh - 24px)",height:"calc(100dvh - 24px)",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"},children:[e.jsxs("div",{className:"encounter-top-bar",style:{flex:"0 0 auto",display:"flex",alignItems:"center",height:"39px",backgroundColor:"var(--bg-primary)"},children:[e.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center"},children:[e.jsx("button",{onClick:()=>ae("adversaries"),style:{flex:1,background:se==="adversaries"?"var(--gray-900)":"transparent",border:"none",borderBottom:"1px solid var(--border)",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:se==="adversaries"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Adversaries"}),e.jsx("button",{onClick:()=>ae("encounters"),style:{flex:1,background:se==="encounters"?"var(--gray-900)":"transparent",border:"none",borderBottom:"1px solid var(--border)",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:se==="encounters"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Encounters"}),e.jsx("button",{onClick:()=>ae("custom"),style:{flex:1,background:se==="custom"?"var(--gray-900)":"transparent",border:"none",borderBottom:"1px solid var(--border)",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:se==="custom"?"500":"400",transition:"all 0.2s ease",position:"relative"},children:"Custom Adversary"})]}),e.jsx("div",{className:"encounter-receipt-buttons",style:{flex:"0 0 350px",display:"flex",alignItems:"flex-start",justifyContent:"center",borderLeft:"1px solid var(--border)",height:"100%",padding:"1rem 0.75rem"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:$,onChange:d=>{le(d.target.value),j(d.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(K,{onClick:de,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:W()?1:.5,cursor:W()?"pointer":"not-allowed"},children:"New"})]})})]}),e.jsxs("div",{className:"encounter-builder-content",style:{flex:1,display:"flex",overflow:"hidden"},children:[e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",borderTop:"1px solid var(--border)"},children:e.jsx(Pt,{type:"adversary",onAddItem:d=>a(d,"adversary"),encounterItems:H,pcCount:M,showContainer:!1,savedEncounters:z,onLoadEncounter:te,onDeleteEncounter:R,activeTab:se})}),e.jsxs("div",{className:"encounter-right-panel",style:{flex:"0 0 350px",borderLeft:"1px solid var(--border)",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx("div",{className:"receipt-content",style:{padding:"1rem",display:"flex",flexDirection:"column",height:"100%"},children:e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"flex-start",overflowY:"auto",marginBottom:"0.75rem"},children:[e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>I(Math.max(1,M-1)),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(He,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:M}),e.jsx("button",{onClick:()=>I(M+1),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(Fe,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Party Size"})}),e.jsx("div",{style:{width:"120px",textAlign:"right"}})]}),H.map(d=>{var S;return d.type!=="adversary"?null:e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>p(d.item.id,d.type),style:{background:d.quantity===0?"var(--danger)":"var(--bg-secondary)",border:d.quantity===0?"none":"1px solid var(--border)",color:d.quantity===0?"white":"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:d.quantity===0?e.jsx(Me,{size:10}):e.jsx(He,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:d.quantity}),e.jsx("button",{onClick:()=>a(d.item,d.type),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(Fe,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:d.item.baseName||((S=d.item.name)==null?void 0:S.replace(/\s+\(\d+\)$/,""))||d.item.name})}),e.jsx("div",{style:{width:"80px",textAlign:"right"},children:e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.8rem"},children:d.item.type})})]},`${d.item.id}-${d.type}`)}),e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Balance"})}),e.jsx("div",{style:{width:"120px",textAlign:"right",display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsx("span",{style:{color:n>o?"var(--danger)":n===o?"var(--purple)":"var(--success)",fontWeight:600},children:n>o?`+${n-o}`:o-n===0?"0":`-${o-n}`})})]})]})}),e.jsx("div",{className:"encounter-receipt-buttons-vertical",style:{display:"none",padding:"0.75rem",borderTop:"1px solid var(--border)",backgroundColor:"var(--bg-primary)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:$,onChange:d=>{le(d.target.value),j(d.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",color:"var(--text-primary)",fontSize:"0.875rem"}}),e.jsx(K,{onClick:de,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:W()?1:.5,cursor:W()?"pointer":"not-allowed"},children:"New"})]})})]})]})]})}):null};class qt extends ge.Component{constructor(s){super(s),this.state={hasError:!1,error:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,i){console.error("ErrorBoundary caught an error:",s,i)}render(){var s;return this.state.hasError?e.jsxs("div",{className:"p-md text-red",children:[e.jsx("h3",{children:"Something went wrong:"}),e.jsx("pre",{children:(s=this.state.error)==null?void 0:s.toString()}),e.jsx("button",{className:"btn-base btn-text",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try again"})]}):this.props.children}}const _t=()=>{const{adversaries:t,environments:s,countdowns:i,fear:m,savedEncounters:f,updateFear:u,createAdversary:l,createAdversariesBulk:A,updateAdversary:x,deleteAdversary:v,createEnvironment:k,updateEnvironment:z,deleteEnvironment:F,createCountdown:y,updateCountdown:T,deleteCountdown:Y,advanceCountdown:B,saveEncounter:L,loadEncounter:j,deleteEncounter:M}=Je(),[I,D]=b.useState(!1),[U,H]=b.useState(!1);b.useState(!1);const[ce,$]=b.useState(!1);b.useState(!0);const[le,se]=b.useState(null),[ae,ee]=b.useState(0),[c,g]=b.useState(0),[G,C]=b.useState(!1);b.useEffect(()=>{const r=()=>{const E=window.matchMedia("(max-width: 800px)");D(E.matches)};r();const p=window.matchMedia("(max-width: 800px)");return p.addEventListener("change",r),()=>p.removeEventListener("change",r)},[]);const W=12,K=r=>r===1?200:350,Q=r=>{if(r<=0)return{visibleColumns:1,columnWidth:K(1)};const p=W*2,E=r-p;let O={visibleColumns:1,columnWidth:E};for(let te=1;te<=5;te++){const R=(te-1)*W,d=(E-R)/te;d>=K(te)&&te*d+R<=E&&(O={visibleColumns:te,columnWidth:d})}return O.visibleColumns*O.columnWidth+(O.visibleColumns-1)*W>E&&(O={visibleColumns:1,columnWidth:E}),O},{visibleColumns:w,columnWidth:ie}=Q(ae);b.useEffect(()=>{const r=()=>{ee(window.innerWidth)};return r(),window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]);const h=()=>{H(!0)},J=b.useCallback(()=>{H(!1)},[]),o=b.useCallback(r=>{g(r.target.scrollLeft)},[]);b.useCallback(()=>{C(!0)},[]),b.useCallback(()=>{setTimeout(()=>C(!1),100)},[]);const a=(()=>{const r={};return t.forEach(p=>{var O;const E=p.baseName||((O=p.name)==null?void 0:O.replace(/\s+\(\d+\)$/,""))||p.name;r[E]||(r[E]={type:"adversary",baseName:E,instances:[]}),r[E].instances.push(p)}),s.forEach(p=>{r[p.name]||(r[p.name]={type:"environment",baseName:p.name,instances:[]}),r[p.name].instances.push(p)}),i.forEach(p=>{r[`countdown-${p.id}`]={type:"countdown",baseName:p.name,instances:[p]}}),Object.values(r)})();return a.length,e.jsxs("div",{className:"app",onClick:r=>{r.target,r.currentTarget},children:[e.jsx(wt,{adversaries:t,environments:s,countdowns:i,deleteAdversary:v,deleteEnvironment:F,deleteCountdown:Y,isClearMode:ce,setIsClearMode:$,sortAdversaries:()=>{},onOpenDatabase:h}),e.jsx("div",{className:"main-content",style:{position:"relative",width:"100%"},children:e.jsx("div",{className:"dashboard-scroll-container",style:{display:"flex",flexDirection:"row",overflowX:"auto",overflowY:"hidden",padding:`0 ${W}px`,scrollSnapType:"x mandatory",height:"100%",width:"100%"},onScroll:o,children:a.length===0?e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",width:"100%",padding:"2rem"},children:e.jsx("button",{onClick:h,style:{backgroundColor:"transparent",color:"var(--text-secondary)",border:"2px dashed var(--border)",borderRadius:"var(--radius-md)",padding:"1rem 2rem",fontSize:"1rem",fontWeight:"500",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:r=>{r.target.style.borderColor="var(--purple)",r.target.style.color="var(--purple)"},onMouseLeave:r=>{r.target.style.borderColor="var(--border)",r.target.style.color="var(--text-secondary)"},children:"Create Encounter"})}):a.map((r,p)=>e.jsx(Ht,{className:"invisible-scrollbar",style:{width:`${ie+W}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:`${W}px`,paddingRight:"0",paddingTop:`${W}px`,paddingBottom:`${W}px`,scrollSnapAlign:"start",overflowY:"auto",overflowX:"hidden"},children:e.jsx(Pe,{type:r.type,item:{...r.instances[0],name:r.baseName,hp:0,stress:0,isDead:!1},mode:"expanded",instances:r.instances,onApplyDamage:r.type==="adversary"?(E,O,de,te)=>{const R=r.instances.find(d=>d.id===E);R&&x(E,{hp:Math.min(R.hpMax||1,(R.hp||0)+O)})}:void 0,onApplyHealing:r.type==="adversary"?(E,O,de)=>{const te=r.instances.find(R=>R.id===E);te&&x(E,{hp:Math.max(0,(te.hp||0)-O)})}:void 0,onApplyStressChange:r.type==="adversary"?(E,O)=>{var de,te;return x(E,{stress:Math.max(0,Math.min(((de=r.instances.find(R=>R.id===E))==null?void 0:de.stressMax)||6,(((te=r.instances.find(R=>R.id===E))==null?void 0:te.stress)||0)+O))})}:void 0,onUpdate:r.type==="adversary"?x:r.type==="environment"?z:T,adversaries:t})},`${r.type}-${r.baseName}`))})}),e.jsx(Ct,{position:"bottom",children:e.jsx(Be,{type:"fear",value:(m==null?void 0:m.value)||0,maxValue:12,onChange:u,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0})}),e.jsx($t,{isOpen:U,onClose:J,onAddAdversary:r=>{l(r),se("adversary")},onAddAdversariesBulk:r=>{A(r),se("adversary")},onAddEnvironment:r=>{k(r),se("environment")},onDeleteAdversary:v,onDeleteEnvironment:F,onDeleteCountdown:Y,adversaries:t,environments:s,countdowns:i,savedEncounters:f,onSaveEncounter:L,onLoadEncounter:j,onDeleteEncounter:M}),e.jsx(Dt,{})]})},Vt=()=>e.jsx(qt,{children:e.jsx(_t,{})});Ne.createRoot(document.getElementById("root")).render(e.jsx(ge.StrictMode,{children:e.jsx(yt,{children:e.jsx(Vt,{})})}));
