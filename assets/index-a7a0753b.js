import{r as u,a as kt,R as nt}from"./dndkit-57209f9c.js";import{F as Xt,f as Qt,a as Zt,b as Ut,c as Rt}from"./fa-b4bcccb0.js";import{D as _t,A as er,C as Wt,X as at,M as mt,P as it,a as tr,H as rr,L as nr,b as or,F as sr,S as xt,c as yt,T as zt,d as Nt,B as Bt}from"./lucide-6ba57bd1.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const k of document.querySelectorAll('link[rel="modulepreload"]'))d(k);new MutationObserver(k=>{for(const f of k)if(f.type==="childList")for(const b of f.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&d(b)}).observe(document,{childList:!0,subtree:!0});function m(k){const f={};return k.integrity&&(f.integrity=k.integrity),k.referrerPolicy&&(f.referrerPolicy=k.referrerPolicy),k.crossOrigin==="use-credentials"?f.credentials="include":k.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function d(k){if(k.ep)return;k.ep=!0;const f=m(k);fetch(k.href,f)}})();var qt={exports:{}},gt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ar=u,ir=Symbol.for("react.element"),lr=Symbol.for("react.fragment"),dr=Object.prototype.hasOwnProperty,cr=ar.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ur={key:!0,ref:!0,__self:!0,__source:!0};function Vt(t,o,m){var d,k={},f=null,b=null;m!==void 0&&(f=""+m),o.key!==void 0&&(f=""+o.key),o.ref!==void 0&&(b=o.ref);for(d in o)dr.call(o,d)&&!ur.hasOwnProperty(d)&&(k[d]=o[d]);if(t&&t.defaultProps)for(d in o=t.defaultProps,o)k[d]===void 0&&(k[d]=o[d]);return{$$typeof:ir,type:t,key:f,ref:b,props:k,_owner:cr.current}}gt.Fragment=lr;gt.jsx=Vt;gt.jsxs=Vt;qt.exports=gt;var e=qt.exports,It={},Lt=kt;It.createRoot=Lt.createRoot,It.hydrateRoot=Lt.hydrateRoot;function tt(t){const o=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return t?`${t}-${o}`:o}const Kt=u.createContext();function vt(t){if(typeof localStorage>"u")return null;try{const o=localStorage.getItem(t);return o==null?null:JSON.parse(o)}catch{return null}}function rt(t,o){if(!(typeof localStorage>"u"))try{localStorage.setItem(t,JSON.stringify(o))}catch{}}const pr=({children:t})=>{const[o,m]=u.useState({fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],currentEncounterName:"Encounter"}),[d,k]=u.useState(!1),[f,b]=u.useState({adversaries:[],environments:[]});u.useEffect(()=>{var h,a,C,N;const p=vt("daggerheart-game-state");if(p)try{(((h=p.adversaries)==null?void 0:h.length)>0||((a=p.environments)==null?void 0:a.length)>0||((C=p.countdowns)==null?void 0:C.length)>0||((N=p.savedEncounters)==null?void 0:N.length)>0)&&m(p)}catch(G){console.error("Failed to load saved state:",G)}const v=vt("daggerheart-custom-adversaries")||[],w=vt("daggerheart-custom-environments")||[];b({adversaries:v,environments:w}),k(!0)},[]),u.useEffect(()=>{rt("daggerheart-game-state",o)},[o]);const K=p=>{m(v=>({...v,fear:{...v.fear,value:p}}))},x=()=>{m(p=>({...p,fear:{...p.fear,visible:!p.fear.visible}}))},R=p=>{m(v=>({...v,partySize:Math.max(1,p)}))},F=p=>{m(v=>({...v,currentEncounterName:p||"Encounter"}))},g=p=>{if(p.id)return m(v=>({...v,savedEncounters:(v.savedEncounters||[]).map(w=>w.id===p.id?{...w,name:p.name||w.name,encounterItems:p.encounterItems||w.encounterItems,partySize:p.partySize||w.partySize,battlePointsAdjustments:p.battlePointsAdjustments||w.battlePointsAdjustments,updatedAt:new Date().toISOString()}:w)})),p.id;{const v={id:tt("encounter"),name:p.name||"Encounter",createdAt:new Date().toISOString(),encounterItems:p.encounterItems||[],partySize:p.partySize||4,battlePointsAdjustments:p.battlePointsAdjustments||{}};return m(w=>({...w,savedEncounters:[...w.savedEncounters||[],v]})),v.id}},z=p=>(o.savedEncounters||[]).find(w=>w.id===p),j=p=>{const v={id:tt("encounter"),name:p.name||`Encounter ${Date.now()}`,createdAt:new Date().toISOString(),encounterItems:p.encounterItems||[],partySize:p.partySize||4,battlePointsAdjustments:p.battlePointsAdjustments||{}};return m(w=>({...w,savedEncounters:[...w.savedEncounters||[],v]})),v.id},J=p=>{m(v=>({...v,savedEncounters:(v.savedEncounters||[]).filter(w=>w.id!==p)}))},me=u.useRef(o);u.useEffect(()=>{me.current=o},[o]);const He={gameState:o,isLoaded:d,customContent:f,updateFear:K,toggleFearVisibility:x,updatePartySize:R,updateCurrentEncounterName:F,saveEncounter:g,saveEncounterAs:j,loadEncounter:z,deleteEncounter:J,createCountdown:p=>{const v={id:tt("countdown"),name:p.name||"Countdown",max:parseInt(p.max)||1,value:0,visible:!0,type:p.type||"standard",loop:p.loop||"none",source:p.source||"campaign"};m(w=>({...w,countdowns:[...w.countdowns,v]}))},updateCountdown:(p,v)=>{m(w=>({...w,countdowns:w.countdowns.map(h=>h.id===p?{...h,...v}:h)}))},deleteCountdown:p=>{m(v=>({...v,countdowns:v.countdowns.filter(w=>w.id!==p)}))},advanceCountdown:(p,v)=>{m(w=>({...w,countdowns:w.countdowns.map(h=>{if(h.id!==p)return h;let a=v;if(h.loop==="loop")a>h.max?a=(a-1)%h.max+1:a<0&&(a=h.max);else if(h.loop==="increasing"){if(a>h.max)return{...h,max:h.max+1,value:1};if(a<0)return{...h,max:Math.max(1,h.max-1),value:1};a=Math.max(0,a)}else if(h.loop==="decreasing"){if(a>h.max)return{...h,max:Math.max(1,h.max-1),value:1};if(a<0)return{...h,max:h.max+1,value:1};a=Math.min(h.max,a)}else a=Math.max(0,Math.min(a,h.max));return{...h,value:a}})}))},incrementCountdown:(p,v=1)=>{m(w=>({...w,countdowns:w.countdowns.map(h=>{if(h.id!==p)return h;let a=h.value+v;if(h.loop==="loop")a>h.max&&(a=(a-1)%h.max+1);else if(h.loop==="increasing"){if(a>h.max)return{...h,max:h.max+1,value:1}}else if(h.loop==="decreasing"){if(a>h.max)return{...h,max:Math.max(1,h.max-1),value:1}}else a=Math.min(a,h.max);return{...h,value:a}})}))},decrementCountdown:p=>{m(v=>({...v,countdowns:v.countdowns.map(w=>{if(w.id!==p)return w;let h=w.value-1;if(w.loop==="loop")h<0&&(h=w.max);else if(w.loop==="increasing"){if(h<0)return{...w,max:Math.max(1,w.max-1),value:w.max};h=Math.max(0,h)}else if(w.loop==="decreasing"){if(h<0)return{...w,max:w.max+1,value:1}}else h=Math.max(0,h);return{...w,value:h}})}))},reorderCountdowns:p=>{m(v=>{const[w,h]=p,a=[...v.countdowns],[C]=a.splice(w,1);return a.splice(h,0,C),{...v,countdowns:a}})},createAdversary:p=>{var G;const v=tt("adv"),w=o.adversaries||[],h=p.baseName||((G=p.name)==null?void 0:G.replace(/\s+\(\d+\)$/,""))||p.name||"Unknown",a=w.filter(X=>X.baseName===h);let C=1;if(a.length===0)C=1;else{const X=a.map(Be=>Be.duplicateNumber||1);let be=1;for(;X.includes(be);)be++;C=be}const N={...p,id:v,baseName:h,duplicateNumber:C,name:`${h} (${C})`,hp:0,stress:0,isVisible:!0};m(X=>({...X,adversaries:[...X.adversaries,N]}))},createAdversariesBulk:p=>{const v=[],w={};p.forEach(h=>{var Le;const a=h.baseName||((Le=h.name)==null?void 0:Le.replace(/\s+\(\d+\)$/,""))||h.name||"Unknown",G=(o.adversaries||[]).filter(Fe=>Fe.baseName===a).length,X=w[a]||0,be=G+X+1;w[a]=X+1;const Be={...h,id:tt("adv"),baseName:a,duplicateNumber:be,name:`${a} (${be})`,hp:0,stress:0,isVisible:!0};v.push(Be)}),m(h=>({...h,adversaries:[...h.adversaries,...v]}))},updateAdversary:(p,v)=>{m(w=>({...w,adversaries:w.adversaries.map(h=>{if(h.id===p){const a={...h,...v};if(v.baseName!==void 0){const C=v.baseName,N=a.duplicateNumber||1;a.name=N===1?C:`${C} (${N})`}return a}return h})}))},deleteAdversary:p=>{m(v=>({...v,adversaries:v.adversaries.filter(w=>w.id!==p)}))},clearAllAdversaries:()=>{m(p=>({...p,adversaries:[]}))},reorderAdversaries:p=>{m(v=>{const[w,h]=p,a=[...v.adversaries],[C]=a.splice(w,1);return a.splice(h,0,C),{...v,adversaries:a}})},bulkReorderAdversaries:p=>{m(v=>({...v,adversaries:p}))},createEnvironment:p=>{const v=tt("env"),h=(o.environments||[]).filter(N=>N.name.replace(/\s+\(\d+\)$/,"")===p.name);let a=p.name||"Unknown";if(h.length===0)a=p.name;else if(h.length===1){const N=h[0],G=N.name.replace(/\s+\(\d+\)$/,""),X=o.environments.map(be=>be.id===N.id?{...be,name:`${G} (1)`}:be);m(be=>({...be,environments:X})),a=`${p.name} (2)`}else{const N=h.map(X=>{const be=X.name.match(/\((\d+)\)$/);return be?parseInt(be[1]):null}).filter(X=>X!==null);let G=1;for(;N.includes(G);)G++;a=`${p.name} (${G})`}const C={...p,id:v,name:a,isVisible:!0};m(N=>({...N,environments:[...N.environments,C]}))},updateEnvironment:(p,v)=>{m(w=>({...w,environments:w.environments.map(h=>h.id===p?{...h,...v}:h)}))},deleteEnvironment:p=>{m(v=>({...v,environments:v.environments.filter(w=>w.id!==p)}))},reorderEnvironments:p=>{m(v=>{const[w,h]=p,a=[...v.environments],[C]=a.splice(w,1);return a.splice(h,0,C),{...v,environments:a}})},addCustomAdversary:p=>{const v={...p,id:tt("custom-adv"),source:p.source||"Homebrew",isCustom:!0};return b(w=>({...w,adversaries:[...w.adversaries,v]})),rt("daggerheart-custom-adversaries",[...f.adversaries,v]),v.id},addCustomEnvironment:p=>{const v={...p,id:tt("custom-env"),source:p.source||"Homebrew",isCustom:!0};return b(w=>({...w,environments:[...w.environments,v]})),rt("daggerheart-custom-environments",[...f.environments,v]),v.id},updateCustomAdversary:(p,v)=>{b(h=>({...h,adversaries:h.adversaries.map(a=>a.id===p?{...a,...v}:a)}));const w=f.adversaries.map(h=>h.id===p?{...h,...v}:h);rt("daggerheart-custom-adversaries",w)},updateCustomEnvironment:(p,v)=>{b(h=>({...h,environments:h.environments.map(a=>a.id===p?{...a,...v}:a)}));const w=f.environments.map(h=>h.id===p?{...h,...v}:h);rt("daggerheart-custom-environments",w)},deleteCustomAdversary:p=>{b(w=>({...w,adversaries:w.adversaries.filter(h=>h.id!==p)}));const v=f.adversaries.filter(w=>w.id!==p);rt("daggerheart-custom-adversaries",v)},deleteCustomEnvironment:p=>{b(w=>({...w,environments:w.environments.filter(h=>h.id!==p)}));const v=f.environments.filter(w=>w.id!==p);rt("daggerheart-custom-environments",v)}};return e.jsx(Kt.Provider,{value:He,children:t})},Tt=()=>{const t=u.useContext(Kt);if(!t)return console.warn("useGameState: Context not available yet, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{gameState:o,customContent:m,...d}=t;if(!o)return console.warn("useGameState: gameState not available, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],customContent:{adversaries:[],environments:[]},updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},addCustomAdversary:()=>{},addCustomEnvironment:()=>{},updateCustomAdversary:()=>{},updateCustomEnvironment:()=>{},deleteCustomAdversary:()=>{},deleteCustomEnvironment:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{fear:k,countdowns:f,adversaries:b,environments:K,partySize:x,savedEncounters:R}=o;return{gameState:o,fear:k,countdowns:f,adversaries:b,environments:K,partySize:x,savedEncounters:R,customContent:m,...d,hasCountdowns:f.length>0,hasAdversaries:b.length>0,hasEnvironments:K.length>0,getCountdownById:F=>f.find(g=>g.id===F),getAdversaryById:F=>b.find(g=>g.id===F),getEnvironmentById:F=>K.find(g=>g.id===F)}},Pt={fear:{icon:Qt,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"0.125rem",maxWidth:"none"},pipStyle:{fontSize:"var(--text-lg)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0,imageRendering:"crisp-edges"},filledColor:"var(--purple)",emptyColor:"var(--gray-dark)",tooltipTitle:"Click anywhere in header to adjust fear:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease fear by 1"},{text:"Right of boundary:",description:"Click to increase fear by 1"}]},hp:{icon:Zt,maxValue:20,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stress:{icon:Ut,maxValue:12,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},countdown:{icon:Rt,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust countdown:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease countdown by 1"},{text:"Right of boundary:",description:"Click to increase countdown by 1"}]},hpDots:{maxValue:20,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--red)",borderColor:"var(--red)",boxShadow:"0 0 4px rgba(239, 68, 68, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stressDots:{maxValue:12,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--purple)",borderColor:"var(--purple)",boxShadow:"0 0 4px rgba(139, 92, 246, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},adversaryHP:{icon:_t,maxValue:20,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust HP:",tooltipInstructions:[{text:"Filled pip:",description:"Click to heal (reduce damage)"},{text:"Empty pip:",description:"Click to take damage"}]},adversaryStress:{icon:er,maxValue:12,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust stress:",tooltipInstructions:[{text:"Filled pip:",description:"Click to reduce stress"},{text:"Empty pip:",description:"Click to increase stress"}]},countdownDistributed:{icon:Rt,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Countdown progress:",tooltipInstructions:[{text:"Progress:",description:"Current countdown value"}]}},dt=({type:t="fear",value:o=0,maxValue:m,onChange:d,size:k="lg",showTooltip:f=!0,containerStyle:b={},pipStyle:K={},countdownType:x=null,distributedGroups:R=null,onPipClick:F=null,enableBoundaryClick:g=!1,clickContainerWidth:z="auto",centerPips:j=!0})=>{const[J,me]=u.useState(!1),ae=Pt[t]||Pt.fear,de=m||ae.maxValue,Q=Math.max(0,Math.min(de,o));let ge=ae.filledColor;t==="countdown"&&x&&(["progress","dynamic-progress","simple-hope"].includes(x)?ge="var(--gold)":["consequence","dynamic-consequence","simple-fear"].includes(x)?ge="var(--purple)":["long-term","standard"].includes(x)&&(ge="var(--text-secondary)"));const Z=(O,ve)=>{if(F)F(O,ve);else if(d){const Te=O+1;d(Te)}},ye=O=>{if(!g||!d||F)return;O.currentTarget.getBoundingClientRect();const ve=O.currentTarget.querySelector(".pip-container");if(!ve)return;const Te=ve.getBoundingClientRect(),ie=O.clientX-Te.left;if(ie<0){Q>0&&d(Q-1);return}if(ie>Te.width){Q<de&&d(Q+1);return}const A=Te.width,S=A*.05,ee=A-2*S,U=ie-S,Y=Q/de,Re=ee*Y;U<Re?Q>0&&d(Q-1):Q<de&&d(Q+1)},Se=(()=>{if(!R||t!=="countdownDistributed")return[{start:0,end:de,groupIndex:0}];let O=0;return R.map((ve,Te)=>{const ie={start:O,end:O+ve,groupIndex:Te};return O+=ve,ie})})(),$=()=>e.jsxs(e.Fragment,{children:[Se.map(O=>e.jsx(nt.Fragment,{children:[...Array(O.end-O.start)].map((ve,Te)=>{const ie=O.start+Te,A=ie<Q;if(ae.isDots)return e.jsx("div",{style:{...ae.pipStyle,...A?ae.filledStyle:ae.emptyStyle,...K,cursor:d||F?"pointer":"default"},onClick:g?void 0:()=>Z(ie,A),title:`${ie+1} of ${de}`},ie);{const S=ae.icon,ee=S&&typeof S=="object"&&S.iconName,U=A?ge:ae.emptyColor;return e.jsx("span",{className:`fear-pip ${A?"filled":"empty"}`,style:{...ae.pipStyle,color:U,cursor:d||F?"pointer":"default",...K},onClick:g?void 0:()=>Z(ie,A),title:`${ie+1} of ${de}`,children:ee?e.jsx(Xt,{icon:S,size:k}):e.jsx(S,{size:k==="lg"?18:16})},ie)}})},O.groupIndex)),f&&e.jsx("div",{style:{position:"relative",cursor:"help",pointerEvents:"none"},children:e.jsxs("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:J?"translateX(-50%) translateY(-5px)":"translateX(-50%)",background:"rgba(15, 23, 42, 0.95)",border:"1px solid var(--gray)",borderRadius:"var(--radius-md)",padding:"var(--space-md)",minWidth:"250px",zIndex:1e3,opacity:J?1:0,visibility:J?"visible":"hidden",transition:"all 0.2s ease",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.5)"},children:[e.jsx("div",{style:{fontWeight:600,color:"var(--gray-200)",marginBottom:"0.75rem",fontSize:"var(--text-sm)"},children:ae.tooltipTitle}),ae.tooltipInstructions.map((O,ve)=>e.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.8rem",color:"var(--gray-300)",lineHeight:1.4},children:[e.jsx("strong",{style:{color:"var(--gray-200)"},children:O.text})," ",O.description]},ve))]})})]});return e.jsx("div",{style:{width:z,height:"100%",cursor:d||F?"pointer":"default",touchAction:"manipulation",userSelect:"none",display:j?"flex":"block",alignItems:j?"center":"stretch",justifyContent:j?"center":"flex-start",...b},onClick:O=>{O.stopPropagation(),O.preventDefault(),g&&ye(O)},onMouseEnter:()=>me(f),onMouseLeave:()=>me(!1),children:e.jsx("div",{className:"pip-container",style:{...ae.containerStyle,width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},children:$()})})},mr=({position:t="top",children:o,onClick:m,className:d="",style:k={}})=>{const f=t==="top",b=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://"),K={background:"var(--bg-primary)",borderTop:f?"none":"1px solid var(--border)",borderBottom:f?"1px solid var(--border)":"none",padding:f?"0.25rem 0":"0.5rem",paddingBottom:f?"0.25rem":b?"calc(0.5rem + env(safe-area-inset-bottom) + 1rem)":"calc(0.5rem + env(safe-area-inset-bottom))",position:f?"relative":"sticky",[f?"top":"bottom"]:0,zIndex:f?10:100,order:f?1:3,flexShrink:0,touchAction:"manipulation",userSelect:"none",display:"flex",flexDirection:f?"column":"row",justifyContent:f?"stretch":"center",alignItems:f?"stretch":"center",gap:f?"0":"1rem",height:f?"auto":"60px",...k};return e.jsx("div",{className:d,style:K,onClick:m,children:o})},bt=52,Et=({tabContent:t,children:o,containerStyle:m={},tabStyle:d={},showTab:k=!0,tabBackgroundColor:f="var(--bg-primary)",tabBorderColor:b="var(--border)",tabJustifyContent:K="center",containerBackgroundColor:x,containerBorderColor:R,containerBorderRadius:F="8px",containerBoxShadow:g,containerOverflow:z="hidden",reserveTabSpace:j=!1,style:J={},...me})=>{const ae={display:"flex",flexDirection:"column",position:"relative",height:"100%",width:"100%",borderRadius:F,overflow:z};x&&(ae.backgroundColor=x),R&&(ae.border=`2px solid ${R}`),g&&(ae.boxShadow=g);const de={position:"relative",overflow:"visible",height:"100%",width:"100%",display:"flex",flexDirection:"column",boxSizing:"border-box"},Q=j?"0":`-${bt}px`,ge=j&&k&&t?`${bt}px`:"0";return e.jsxs("div",{style:{...de,...J},...me,children:[k&&t&&e.jsx("div",{style:{position:"absolute",top:Q,left:"7px",right:"7px",width:"calc(100% - 14px)",display:"flex",alignItems:"center",gap:"0.5rem",justifyContent:K,flexShrink:0,zIndex:0,padding:"0.5rem 0.75rem",paddingBottom:"calc(0.5rem + 4px)",minHeight:`${bt}px`,backgroundColor:f,border:`1.5px solid ${b}`,borderBottom:"none",borderRadius:"8px 8px 0 0",boxSizing:"border-box",marginBottom:"-4px",...d},children:t}),e.jsx("div",{style:{...ae,...m,zIndex:1,marginTop:ge},children:o})]})},fr="modulepreload",hr=function(t){return"/Daggerheart/"+t},Dt={},st=function(o,m,d){if(!m||m.length===0)return o();const k=document.getElementsByTagName("link");return Promise.all(m.map(f=>{if(f=hr(f),f in Dt)return;Dt[f]=!0;const b=f.endsWith(".css"),K=b?'[rel="stylesheet"]':"";if(!!d)for(let F=k.length-1;F>=0;F--){const g=k[F];if(g.href===f&&(!b||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${f}"]${K}`))return;const R=document.createElement("link");if(R.rel=b?"stylesheet":fr,b||(R.as="script",R.crossOrigin=""),R.href=f,document.head.appendChild(R),b)return new Promise((F,g)=>{R.addEventListener("load",F),R.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${f}`)))})})).then(()=>o()).catch(f=>{const b=new Event("vite:preloadError",{cancelable:!0});if(b.payload=f,window.dispatchEvent(b),!b.defaultPrevented)throw f})},Ht={Minion:{difficulty:t=>[9,12,15,18][t-1],thresholds:t=>({major:0,severe:0}),hpMax:t=>1,stressMax:t=>1,atk:t=>[-1,0,1,2][t-1],damage:t=>["2","5","8","11"][t-1],range:"Melee"},Standard:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[7,10,20,25][t-1],severe:[12,20,32,45][t-1]}),hpMax:t=>[4,5,6,7][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[1,2,3,4][t-1],damage:t=>["1d8+1","2d8+2","3d8+3","4d8+4"][t-1],range:"Melee"},Bruiser:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[8,14,22,38][t-1],severe:[15,28,40,70][t-1]}),hpMax:t=>[6,7,8,9][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[-1,0,1,2][t-1],damage:t=>["1d12+2","2d12+4","3d12+6","4d12+8"][t-1],range:"Melee"},Horde:{difficulty:t=>[10,13,16,19][t-1],thresholds:t=>({major:[7,10,20,25][t-1],severe:[12,20,32,45][t-1]}),hpMax:t=>[5,6,7,8][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[-1,0,1,2][t-1],damage:t=>["1d8+2","2d8+4","3d8+6","4d8+8"][t-1],range:"Melee"},Leader:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[7,13,21,35][t-1],severe:[14,26,38,65][t-1]}),hpMax:t=>[5,6,7,8][t-1],stressMax:t=>[5,5,6,6][t-1],atk:t=>[2,4,6,8][t-1],damage:t=>["1d10+2","2d10+4","3d10+6","4d10+8"][t-1],range:"Melee"},Ranged:{difficulty:t=>[10,13,16,19][t-1],thresholds:t=>({major:[4,8,18,22][t-1],severe:[7,16,30,42][t-1]}),hpMax:t=>[3,4,5,6][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d8+2","2d8+4","3d8+6","4d8+8"][t-1],range:"Close"},Skulk:{difficulty:t=>[12,15,18,21][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,5,6,7][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d6+2","2d6+4","3d6+6","4d6+8"][t-1],range:"Melee"},Solo:{difficulty:t=>[12,15,18,21][t-1],thresholds:t=>({major:[7,13,21,35][t-1],severe:[14,26,38,65][t-1]}),hpMax:t=>[8,9,10,11][t-1],stressMax:t=>[5,5,6,6][t-1],atk:t=>[3,5,7,9][t-1],damage:t=>["1d10+3","2d10+6","3d10+9","4d10+12"][t-1],range:"Melee"},Support:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,4,5,5][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d4+2","2d4+4","3d4+6","4d4+8"][t-1],range:"Melee"},Social:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,4,5,5][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d4+2","2d4+4","3d4+6","4d4+8"][t-1],range:"Melee"}},ct=(t,o)=>{const m=Ht[o]||Ht.Standard;return{difficulty:m.difficulty(t),thresholds:m.thresholds(t),hpMax:m.hpMax(t),stressMax:m.stressMax(t),atk:m.atk(t),damage:m.damage(t),range:m.range}};let Gt={adversaries:[]},Ot=!1;const gr=()=>({customAdversaries:JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]")}),xr=async()=>{if(Ot)return;let t={adversaries:[]},o={adversaries:[]};try{const d=await st(()=>import("./adversaries-9c8932de.js"),[]);t=(d==null?void 0:d.default)||d}catch(d){console.warn("Failed to load adversaries.json:",d)}try{const d=await st(()=>import("./playtest-adversaries-4a099c10.js"),[]);o=(d==null?void 0:d.default)||d}catch(d){console.warn("Failed to load playtest-adversaries.json:",d)}const{customAdversaries:m}=gr();Gt={...t,adversaries:[...t.adversaries||[],...o.adversaries||[],...m]},Ot=!0},Mt=u.forwardRef(({onSave:t,onRefresh:o,onAddItem:m,editingAdversary:d,onCancelEdit:k,isStockAdversary:f=!1,autoFocus:b=!1,allAdversaries:K=[],embedded:x=!1,hideEmbeddedButtons:R=!1},F)=>{const g=u.useRef(null),z=u.useRef(null),[j,J]=u.useState(()=>{const A=ct(1,"Standard");return{name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:A.difficulty,thresholds:A.thresholds,hpMax:A.hpMax,stressMax:A.stressMax,atk:A.atk,weapon:"",range:A.range,damage:A.damage,experience:[],features:[]}}),[me,ae]=u.useState(!1),[de,Q]=u.useState(!1),[ge,Z]=u.useState([]),[ye,fe]=u.useState(!1),[Se,$]=u.useState([]);u.useEffect(()=>{(async()=>{await xr(),K.length>0?$(K):$(Gt.adversaries||[])})()},[K]),u.useEffect(()=>{b&&setTimeout(()=>{var A,S,ee;d&&z.current?((A=z.current)==null||A.focus(),(S=z.current)==null||S.select()):g.current&&((ee=g.current)==null||ee.focus())},650)},[b,d]),u.useEffect(()=>{var A;if(d){const S=d.baseName||((A=d.name)==null?void 0:A.replace(/\s+\(\d+\)$/,""))||d.name||"";J({name:S,tier:d.tier||1,type:d.type||"Standard",description:d.description||"",motives:d.motives||"",difficulty:d.difficulty||11,thresholds:d.thresholds||{major:7,severe:12},hpMax:d.hpMax||3,stressMax:d.stressMax||1,atk:d.atk||1,weapon:d.weapon||"",range:d.range||"Melee",damage:d.damage||"",experience:d.experience||[],features:d.features||[]}),Q(!1)}else{const S=ct(1,"Standard");J({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:S.difficulty,thresholds:S.thresholds,hpMax:S.hpMax,stressMax:S.stressMax,atk:S.atk,weapon:"",range:S.range,damage:S.damage,experience:[],features:[]}),Q(!1)}},[d]),u.useEffect(()=>{if(!d&&!de){const A=ct(j.tier,j.type);J(S=>({...S,difficulty:A.difficulty,thresholds:A.thresholds,hpMax:A.hpMax,stressMax:A.stressMax,atk:A.atk,range:A.range,damage:A.damage}))}},[j.tier,j.type,d,de]);const O=A=>{if(J(S=>({...S,name:A})),A.trim().length>0){const S=Se.filter(ee=>{var Y;return(((Y=ee.name)==null?void 0:Y.replace(/\s+\(\d+\)$/,""))||ee.name||"").toLowerCase().includes(A.toLowerCase())}).slice(0,5);Z(S),fe(S.length>0)}else Z([]),fe(!1)},ve=async()=>{if(!j.name.trim()){alert("Please enter a name for the adversary");return}ae(!0);try{const A=Y=>(Y||[]).filter(Re=>Re.name&&Re.name.trim()!==""||Re.modifier!==void 0&&Re.modifier!==0),S=j.name.trim()||"Unknown",ee=A(j.experience||[]),U={...j,experience:ee,baseName:S,name:S,hp:d?d.hp:0,stress:d?d.stress:0,source:"Homebrew"};if(d){if(f){const{id:Y,name:Re,...ce}=U;await t(ce),alert("Custom adversary created successfully!")}else{const Y={...U,name:U.baseName};await t(Y,d.id),alert("Adversary updated successfully!")}k&&k()}else{await t(U),o&&await o();const Y=ct(1,"Standard");J({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:Y.difficulty,thresholds:Y.thresholds,hpMax:Y.hpMax,stressMax:Y.stressMax,atk:Y.atk,weapon:"",range:Y.range,damage:Y.damage,experience:[],features:[]}),Q(!1),alert("Custom adversary created successfully!")}}catch(A){console.error("Error saving adversary:",A),alert("Error saving adversary. Please try again.")}finally{ae(!1)}};u.useImperativeHandle(F,()=>({handleSave:ve,isSaving:me,canSave:j.name.trim().length>0}));const Te={...j,id:"new-adversary",hp:0,stress:0,source:"Homebrew"},ie=()=>me?d?f?"Creating...":"Saving...":"Creating...":d?f?"Save As Custom":"Save":"Create";return e.jsxs(e.Fragment,{children:[!x&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h2",{style:{color:"var(--text-primary)",fontSize:"1.5rem",fontWeight:"600",margin:0},children:d?f?"Edit Adversary (Save As Custom)":"Edit Custom Adversary":"Create Custom Adversary"}),e.jsx("button",{onClick:ve,disabled:me||!j.name.trim(),style:{padding:"0.75rem 1.5rem",backgroundColor:me||!j.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"8px",cursor:me||!j.name.trim()?"not-allowed":"pointer",fontSize:"1rem",fontWeight:"600",opacity:me||!j.name.trim()?.6:1},children:ie()})]}),x&&!R&&e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",marginBottom:"0.5rem",padding:"0.5rem",borderBottom:"1px solid var(--border)"},children:[e.jsx("button",{onClick:ve,disabled:me||!j.name.trim(),style:{padding:"0.5rem 1rem",backgroundColor:me||!j.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"6px",cursor:me||!j.name.trim()?"not-allowed":"pointer",fontSize:"0.875rem",fontWeight:"600",opacity:me||!j.name.trim()?.6:1,marginRight:"0.5rem"},children:ie()}),k&&e.jsx("button",{onClick:k,style:{padding:"0.5rem 1rem",backgroundColor:"transparent",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"6px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600"},children:"Cancel"})]}),!d&&e.jsxs("div",{style:{marginBottom:"1rem",position:"relative"},children:[e.jsx("input",{ref:g,type:"text",value:j.name,onChange:A=>{const S=A.target.value;J(ee=>({...ee,name:S})),O(S)},placeholder:"Adversary name",style:{width:"100%",padding:"0.75rem",border:"1px solid var(--border)",borderRadius:"8px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"1rem",outline:"none"}}),ye&&ge.length>0&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"0 0 8px 8px",borderTop:"none",maxHeight:"200px",overflowY:"auto",zIndex:1e3,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)"},children:ge.map((A,S)=>{var U;const ee=A.baseName||((U=A.name)==null?void 0:U.replace(/\s+\(\d+\)$/,""))||A.name;return e.jsxs("div",{onClick:()=>{J(Y=>({...Y,name:ee,tier:A.tier||Y.tier,type:A.type||Y.type,difficulty:A.difficulty||Y.difficulty,thresholds:A.thresholds||Y.thresholds,hpMax:A.hpMax||Y.hpMax,stressMax:A.stressMax||Y.stressMax,atk:A.atk||Y.atk,range:A.range||Y.range,damage:A.damage||Y.damage})),fe(!1),Q(!0),g.current&&g.current.blur()},style:{padding:"0.75rem",cursor:"pointer",borderBottom:S<ge.length-1?"1px solid var(--border)":"none",transition:"background-color 0.2s"},onMouseEnter:Y=>{Y.target.style.backgroundColor="var(--bg-secondary)"},onMouseLeave:Y=>{Y.target.style.backgroundColor="transparent"},onMouseDown:Y=>Y.preventDefault(),children:[e.jsx("div",{style:{fontWeight:"600"},children:ee}),e.jsxs("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",marginTop:"2px"},children:[A.type," • Tier ",A.tier]})]},S)})})]}),e.jsx(ft,{item:Te,type:"adversary",mode:"edit",nameInputRef:d?z:void 0,autoFocusNameInput:b&&d,onUpdate:(A,S)=>{J(ee=>({...ee,...S}))}})]})});Mt.displayName="CustomAdversaryCreator";const Ft=({value:t})=>e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"44px",height:"32px",zIndex:3},children:[e.jsx("svg",{width:"40",height:"32",viewBox:"0 0 40 32",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",style:{position:"absolute",zIndex:1},children:e.jsx("path",{d:"M2 2h28l6 14-6 14H2l6-14-6-14z"})}),e.jsx("span",{style:{position:"absolute",fontSize:"0.8rem",fontWeight:500,color:"var(--text-primary)",textAlign:"center",zIndex:2,left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:t})]}),yr=({type:t,tier:o,isEditMode:m,onUpdate:d,itemId:k})=>{const b=(g=>{if(!g)return 0;const j=document.createElement("canvas").getContext("2d");return j.font="600 11px system-ui, -apple-system, sans-serif",j.measureText(g.toUpperCase()).width})(t),K=4,x=18,R=Math.max(50,b+K+x),F=R+15;return m?e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",gap:"8px",height:"32px"},children:[e.jsxs("select",{value:t||"",onChange:g=>{d&&d(k,{type:g.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",outline:"none",borderRadius:"4px",padding:"4px 8px",width:"95px",height:"24px"},children:[e.jsx("option",{value:"Standard",children:"Standard"}),e.jsx("option",{value:"Solo",children:"Solo"}),e.jsx("option",{value:"Bruiser",children:"Bruiser"}),e.jsx("option",{value:"Horde",children:"Horde"}),e.jsx("option",{value:"Minion",children:"Minion"}),e.jsx("option",{value:"Ranged",children:"Ranged"}),e.jsx("option",{value:"Leader",children:"Leader"}),e.jsx("option",{value:"Skulk",children:"Skulk"}),e.jsx("option",{value:"Social",children:"Social"}),e.jsx("option",{value:"Support",children:"Support"})]}),e.jsxs("div",{style:{position:"relative",width:"24px",height:"24px"},children:[e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",width:"20px",height:"20px",backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",borderRadius:"2px"}}),e.jsx("input",{type:"text",value:o||"",onChange:g=>{const z=g.target.value.replace(/[^1-4]/g,"");z.length<=1&&d&&d(k,{tier:z===""?"":parseInt(z)})},onKeyDown:g=>{if(g.key==="ArrowUp"){g.preventDefault();const z=parseInt(o)||1;d&&d(k,{tier:Math.min(z+1,4)})}else if(g.key==="ArrowDown"){g.preventDefault();const z=parseInt(o)||1;d&&d(k,{tier:Math.max(z-1,1)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"transparent",border:"none",color:"var(--text-primary)",fontSize:"0.8rem",fontWeight:600,width:"24px",height:"24px",textAlign:"center",outline:"none",zIndex:1},maxLength:"1"})]})]}):e.jsxs("div",{style:{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"center",height:"32px",width:`${F}px`},children:[e.jsxs("svg",{width:F,height:"32",viewBox:`0 0 ${F} 32`,style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1},children:[e.jsx("rect",{x:"1",y:"6",width:R-1,height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4",ry:"4"}),e.jsx("rect",{x:R-10,y:"6",width:"20",height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"2",ry:"2",transform:`rotate(45 ${R-1} 16)`})]}),e.jsx("span",{style:{position:"absolute",top:"50%",left:"4px",transform:"translateY(-50%)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",color:"var(--text-primary)",zIndex:2,pointerEvents:"none"},children:t}),e.jsx("span",{style:{position:"absolute",top:"50%",left:`${R-.5}px`,transform:"translate(-50%, -50%)",fontSize:"0.8rem",fontWeight:600,color:"white",zIndex:2,pointerEvents:"none",textAlign:"center",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",width:"20px",height:"20px"},children:o})]})},wt=({feature:t,featureType:o,item:m,onUpdate:d,handleFeatureDeleteClick:k,deleteConfirmations:f,getFeatureKey:b})=>{var g,z;const K=()=>{try{const J=[...(m==null?void 0:m.features)||[]],me=J.filter(de=>de.type===o),ae=me.findIndex(de=>de===t);if(ae>0&&ae<me.length){const de=me[ae],Q=me[ae-1];if(de&&Q){const ge=J.findIndex(ye=>ye===de),Z=J.findIndex(ye=>ye===Q);ge>=0&&Z>=0&&(J[ge]=Q,J[Z]=de,d&&d(m.id,{features:J}))}}}catch(j){console.error(`Error in ${o.toLowerCase()} up button:`,j)}},x=()=>{try{const J=[...(m==null?void 0:m.features)||[]],me=J.filter(de=>de.type===o),ae=me.findIndex(de=>de===t);if(ae<me.length-1&&ae>=0){const de=me[ae],Q=me[ae+1];if(de&&Q){const ge=J.findIndex(ye=>ye===de),Z=J.findIndex(ye=>ye===Q);ge>=0&&Z>=0&&(J[ge]=Q,J[Z]=de,d&&d(m.id,{features:J}))}}}catch(j){console.error(`Error in ${o.toLowerCase()} down button:`,j)}},R=j=>j.type===o,F=j=>j.type===o&&j.name.trim();return e.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",alignSelf:"stretch"},children:[e.jsx("button",{onClick:K,disabled:(m.features||[]).filter(R).findIndex(j=>j===t)===0,tabIndex:"-1",style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(m.features||[]).filter(F).length>=2&&(m.features||[]).filter(R).findIndex(j=>j===t)!==0&&t.name.trim()?"white":"var(--text-secondary)",cursor:(m.features||[]).filter(F).length>=2&&(m.features||[]).filter(R).findIndex(j=>j===t)!==0&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↑"}),e.jsx("button",{onClick:()=>k(t),disabled:!t.name.trim()&&!t.description.trim(),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:f[b(t)]?"var(--danger)":"var(--gray-700)",color:!t.name.trim()&&!t.description.trim()?"var(--text-secondary)":"white",cursor:!t.name.trim()&&!t.description.trim()?"not-allowed":"pointer",opacity:!t.name.trim()&&!t.description.trim()?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"×"}),e.jsx("button",{onClick:x,disabled:(m.features||[]).filter(R).findIndex(j=>j===t)===(m.features||[]).filter(R).length-1,style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(m.features||[]).filter(F).length>=2&&(m.features||[]).filter(R).findIndex(j=>j===t)<(m.features||[]).filter(R).length-1&&((g=(m.features||[]).filter(R)[(m.features||[]).filter(R).findIndex(j=>j===t)+1])!=null&&g.name.trim())&&t.name.trim()?"white":"var(--text-secondary)",cursor:(m.features||[]).filter(F).length>=2&&(m.features||[]).filter(R).findIndex(j=>j===t)<(m.features||[]).filter(R).length-1&&((z=(m.features||[]).filter(R)[(m.features||[]).filter(R).findIndex(j=>j===t)+1])!=null&&z.name.trim())&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↓"})]})},Oe={transitions:{hoverIn:"all 0.1s ease",hoverOut:"all 0.3s ease"},card:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"8px",cursor:"pointer",transition:"all 0.1s ease",position:"relative",border:"none"},cardHover:{backgroundColor:"var(--bg-card-hover)"},cardDead:{opacity:.6,backgroundColor:"var(--gray-800)",borderColor:"var(--border)"},cardAtMax:{backgroundColor:"var(--success)",borderColor:"var(--success)"},rowMain:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},rowTitle:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",margin:0},rowMeta:{display:"flex",gap:"8px",alignItems:"center"},badge:{padding:"2px 6px",borderRadius:"3px",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},typeBadge:{backgroundColor:"var(--purple)",color:"var(--text-primary)"},tierBadge:{backgroundColor:"var(--info)",color:"var(--text-primary)"},damageInputPopup:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,borderRadius:"8px"},damageInputContent:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"8px",padding:"8px",display:"flex",flexDirection:"row",gap:"8px",minWidth:"200px",alignItems:"center",position:"absolute",right:"1rem",top:"50%",transform:"translateY(-50%)"},damageInput:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"4px",padding:"4px 6px",color:"var(--text-primary)",fontSize:"16px",width:"80px",textAlign:"center"},damageIndicators:{display:"flex",gap:"8px",alignItems:"center",justifyContent:"center"},damageDrop:{fontSize:"16px",color:"var(--text-secondary)",cursor:"pointer",transition:"color 0.1s ease"},applyButton:{backgroundColor:"var(--gray-600)",color:"white",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"32px",minHeight:"32px"}},vr=(t,o,m,d)=>{const[k,f]=u.useState(!1),[b,K]=u.useState("");u.useEffect(()=>{if(k){const j=J=>{J.target.closest(".damage-input-popup")||(f(!1),K(""))};return document.addEventListener("click",j),()=>document.removeEventListener("click",j)}},[k]);const x=j=>{j.stopPropagation(),j.preventDefault();const J=t.hp||0,me=t.hpMax||1,ae=j.currentTarget.getBoundingClientRect(),de=j.clientX-ae.left,Q=ae.width/me;Math.floor(de/Q)<J?m&&m(t.id,1,t.hp):o&&o(t.id,1,t.hp,t.hpMax)},R=j=>{j.stopPropagation(),j.preventDefault();const J=t.stress||0,me=t.stressMax||1,ae=j.currentTarget.getBoundingClientRect(),de=j.clientX-ae.left,Q=ae.width/me;Math.floor(de/Q)<J?d&&d(t.id,-1,t.stress,t.stressMax):d&&d(t.id,1,t.stress,t.stressMax)},F=j=>{j.stopPropagation(),(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")&&(f(!0),K(t.type==="Minion"?"1":""))},g=()=>{const j=parseInt(b);if(j>0){if(t.type==="Minion")o&&o(t.id,j,t.hp,t.hpMax);else{let J=0;j>=t.thresholds.severe?J=3:j>=t.thresholds.major?J=2:j>=1&&(J=1),o&&o(t.id,J,t.hp,t.hpMax)}f(!1),K("")}};return{showDamageInput:k,damageValue:b,setDamageValue:K,setShowDamageInput:f,handleHpClick:x,handleStressClick:R,handleDifficultyClick:F,applyDamage:g,handleKeyDown:j=>{j.key==="Enter"?g():j.key==="Escape"&&(f(!1),K(""))}}},br=({item:t,type:o,mode:m="expanded",onClick:d,onDelete:k,onApplyDamage:f,onApplyHealing:b,onApplyStressChange:K,onUpdate:x,adversaries:R=[],isSelected:F=!1,isEditMode:g=!1,instances:z=[],isEmbedded:j=!1,showAddRemoveButtons:J=!1,onAddInstance:me=null,onRemoveInstance:ae=null,onEdit:de=null,showCustomCreator:Q=!1,onSaveCustomAdversary:ge=null,onCancelEdit:Z=null,isStockAdversary:ye=!1})=>{const fe=u.useRef(null),Se=u.useRef(z.length),$=u.useRef(null),O=u.useRef(null),ve=u.useRef(null),Te=u.useRef(null),ie=u.useRef(null);u.useEffect(()=>{const a=fe.current;if(!a)return;const C=()=>{$.current=a.scrollHeight,O.current=a.scrollTop};a.addEventListener("scroll",C,{passive:!0});const N=setInterval(C,100);return()=>{a.removeEventListener("scroll",C),clearInterval(N)}},[]),u.useEffect(()=>()=>{fe.current&&($.current=fe.current.scrollHeight,O.current=fe.current.scrollTop)},[z.length,z]);const[A,S]=u.useState({});u.useEffect(()=>{if(Q&&Te.current){const a=setTimeout(()=>{var C,N;(C=Te.current)==null||C.focus(),(N=Te.current)==null||N.select()},650);return()=>clearTimeout(a)}},[Q]),u.useLayoutEffect(()=>{const a=z.length,C=Se.current;if(a!==C&&fe.current){const N=$.current,G=O.current;if(!N||G===null){Se.current=a;return}const X=fe.current,be=X.scrollHeight,Be=X.clientHeight;if(!(a<C)){if(a>C){const Le=be-Be,Fe=X.scrollTop,n=Le-Fe;if(Math.abs(n)>.5){ve.current&&(cancelAnimationFrame(ve.current),ve.current=null);const M=400,r=performance.now(),T=xe=>{if(!X){ve.current=null;return}const _=xe-r,V=Math.min(_/M,1),l=1-V,E=1-l*l*l,I=Fe+n*E;X.scrollTop=I,V<1?ve.current=requestAnimationFrame(T):(X.scrollTop=Le,ve.current=null)};ve.current=requestAnimationFrame(T)}}}Se.current=a}else Se.current=a},[z.length,z]);const ee=a=>{const N=(t.features||[]).filter(G=>G.type===a.type).findIndex(G=>G===a);return`${a.type}-${N}-${a.name||"blank"}`},U=(a,C)=>`experience-${C}-${typeof a=="string"?a:a.name||"blank"}`,Y=a=>!a||!Array.isArray(a)?[]:a.filter(C=>{if(typeof C=="string")return C.trim().length>0;const N=C.name||"",G=C.modifier||0;return N.trim().length>0||G>0}),Re=a=>{const C=ee(a);if(A[C]){const N=t.features.filter(G=>G!==a);x&&x(t.id,{features:N}),S(G=>{const X={...G};return delete X[C],X})}else S(N=>({...N,[C]:!0})),setTimeout(()=>{S(N=>{const G={...N};return delete G[C],G})},3e3)},ce=(a,C)=>{const N=U(a,C);if(A[N]){const G=[...t.experience||[]];G.splice(C,1);const X=Y(G);x&&x(t.id,{experience:X}),S(be=>{const Be={...be};return delete Be[N],Be})}else S(G=>({...G,[N]:!0})),setTimeout(()=>{S(G=>{const X={...G};return delete X[N],X})},3e3)},H=vr(t,f,b,K);(o==="adversary"||o==="adversaries")&&H.handleDifficultyClick;const ke=(a=!1)=>{let C={...Oe.card};if(F?C.transition="none":C.transition=Oe.transitions.hoverOut,a){const{marginTop:N,...G}=C;C=G}return F&&(C={...C,...Oe.cardHover}),o==="adversary"&&(t.hp||0)>=(t.hpMax||1)&&(C={...C,...Oe.cardDead}),C},Me=()=>{if(j)return"";let a="border rounded-lg";return F&&(a+=" border-hover"),a},Ne=()=>{var a;if(o==="adversary"||o==="adversaries"){const C=t.baseName||((a=t.name)==null?void 0:a.replace(/\s+\(\d+\)$/,""))||"",N=t.duplicateNumber||1,G=[...R];return R.some(Be=>Be.id===t.id)||G.push(t),G.filter(Be=>Be.baseName===C).length>1?`${C} (${N})`:C}return t.name},He=()=>{const a=[];return t.type&&a.push(e.jsx("span",{style:{...Oe.badge,...Oe.typeBadge},children:t.type},"type")),a},p=()=>o!=="adversary"||!H.showDamageInput||!(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")?null:e.jsx("div",{className:"damage-input-popup",style:Oe.damageInputPopup,onClick:a=>{a.stopPropagation(),a.target===a.currentTarget&&(o==="adversary"||o==="adversaries")&&(H.setShowDamageInput(!1),H.setDamageValue(""))},children:e.jsxs("div",{className:"border rounded-lg",style:{...Oe.damageInputContent,borderColor:"var(--border)"},onClick:a=>a.stopPropagation(),children:[e.jsx("input",{type:"number",inputMode:"numeric",enterKeyHint:"done",placeholder:"dmg",min:(t.type==="Minion","0"),value:o==="adversary"||o==="adversaries"?H.damageValue:"",onChange:a=>{(o==="adversary"||o==="adversaries")&&H.setDamageValue(a.target.value)},onKeyDown:o==="adversary"||o==="adversaries"?H.handleKeyDown:void 0,className:"border rounded-sm",style:{...Oe.damageInput,borderColor:"var(--border)"},autoFocus:!0}),e.jsxs("div",{style:Oe.damageIndicators,children:[t.type==="Minion"?(()=>{var X,be;const a=parseInt(o==="adversary"||o==="adversaries"?H.damageValue:"0")||0,C=(X=t.features)==null?void 0:X.find(Be=>{var Le;return(Le=Be.name)==null?void 0:Le.startsWith("Minion (")}),N=C?parseInt(((be=C.name.match(/\((\d+)\)/))==null?void 0:be[1])||"1"):1,G=Math.floor(a/N);return a>=N&&G>0?e.jsxs("span",{style:{...Oe.damageDrop,color:"var(--red)"},title:`${a} damage can defeat ${G+1} minion${G+1!==1?"s":""} (1 + ${G} additional)`,children:["+",G," additional minion(s)"]}):e.jsx("span",{style:Oe.damageDrop,title:`${a} damage defeats this minion only`,children:"+0 additional minion(s)"})})():[1,2,3].map(a=>{const C=parseInt(o==="adversary"||o==="adversaries"?H.damageValue:"0")||0;let N=!1;return a===1&&C>=1&&(N=!0),a===2&&C>=t.thresholds.major&&(N=!0),a===3&&C>=t.thresholds.severe&&(N=!0),e.jsx("span",{style:{...Oe.damageDrop,color:N?"var(--red)":"var(--text-secondary)"},onClick:G=>{G.stopPropagation(),(o==="adversary"||o==="adversaries")&&(a===1?H.setDamageValue("1"):a===2?H.setDamageValue(t.thresholds.major.toString()):a===3&&H.setDamageValue(t.thresholds.severe.toString()))},title:`Click to set damage to ${a===1?"1":a===2?t.thresholds.major:t.thresholds.severe}`,children:e.jsx(_t,{size:16})},a)}),e.jsx("button",{style:{...Oe.applyButton,backgroundColor:"var(--gray-600)"},onClick:a=>{a.stopPropagation(),(o==="adversary"||o==="adversaries")&&(!H.damageValue||parseInt(H.damageValue)<1?(H.setShowDamageInput(!1),H.setDamageValue("")):H.applyDamage())},title:!H.damageValue||parseInt(H.damageValue)<1?"Close damage input":"Apply damage",children:!H.damageValue||parseInt(H.damageValue)<1?e.jsx(at,{size:16}):e.jsx(or,{size:16})})]})]})}),v=()=>{var X,be,Be,Le,Fe;const a=(t.hp||0)>=(t.hpMax||1),C=w==="edit"||Q,N=o==="adversary",G=N?Q?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:n=>{n.stopPropagation(),ge&&(ge(t,t.id),Z&&Z())},style:{background:"var(--purple)",border:"1px solid var(--purple)",color:"white",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:n=>{n.target.style.opacity="0.9"},onMouseLeave:n=>{n.target.style.opacity="1"},title:"Save",children:[e.jsx(Wt,{size:16}),e.jsx("span",{children:"Save"})]}),Z&&e.jsxs("button",{onClick:n=>{n.stopPropagation(),Z()},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:n=>{n.target.style.backgroundColor="var(--bg-hover)",n.target.style.borderColor="var(--purple)"},onMouseLeave:n=>{n.target.style.backgroundColor="var(--bg-secondary)",n.target.style.borderColor="var(--border)"},title:"Cancel",children:[e.jsx(at,{size:16}),e.jsx("span",{children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:n=>{n.stopPropagation(),ae&&ae(t.id)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease"},onMouseEnter:n=>{n.currentTarget.style.backgroundColor="var(--bg-hover)",n.currentTarget.style.borderColor="var(--purple)"},onMouseLeave:n=>{n.currentTarget.style.backgroundColor="var(--bg-secondary)",n.currentTarget.style.borderColor="var(--border)"},title:"Remove one",children:e.jsx(mt,{size:16})}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"1rem",fontWeight:"500",minWidth:"24px",textAlign:"center"},children:z.length}),e.jsx("button",{onClick:n=>{n.stopPropagation(),me&&me(t)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease"},onMouseEnter:n=>{n.currentTarget.style.backgroundColor="var(--purple)",n.currentTarget.style.borderColor="var(--purple)",n.currentTarget.style.color="white"},onMouseLeave:n=>{n.currentTarget.style.backgroundColor="var(--bg-secondary)",n.currentTarget.style.borderColor="var(--border)",n.currentTarget.style.color="var(--text-primary)"},title:"Add another",children:e.jsx(it,{size:16})}),de&&e.jsx("button",{onClick:n=>{n.stopPropagation(),de(t.id)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease",marginLeft:"0.25rem"},onMouseEnter:n=>{n.currentTarget.style.backgroundColor="var(--purple)",n.currentTarget.style.borderColor="var(--purple)",n.currentTarget.style.color="white"},onMouseLeave:n=>{n.currentTarget.style.backgroundColor="var(--bg-secondary)",n.currentTarget.style.borderColor="var(--border)",n.currentTarget.style.color="var(--text-primary)"},title:"Edit",children:e.jsx(tr,{size:16})})]}):null;return e.jsx(Et,{tabContent:G,showTab:N,tabBorderColor:F?"var(--purple)":"var(--border)",containerBackgroundColor:a?"var(--gray-900)":ke(!0).backgroundColor,containerBorderColor:a?"color-mix(in srgb, var(--gray-600) 40%, transparent)":F?"var(--purple)":"var(--border)",containerBorderRadius:"8px",containerOverflow:"hidden",containerStyle:{padding:0,opacity:a?.7:1,height:"auto",maxHeight:N?"calc(100vh - 120px)":"calc(100vh - 68px)",minHeight:0},children:e.jsxs("div",{className:Me(),style:{...ke(!0),padding:0,display:"flex",flexDirection:"column",position:"relative",height:"100%",minHeight:0,border:"none",borderRadius:0},onClick:d,children:[a&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                45deg,
                transparent,
                transparent 8px,
                var(--gray-600) 1px,
                var(--gray-600) 9px
              )`,pointerEvents:"none",zIndex:9999}})}),e.jsx("div",{className:"border-b",style:{padding:"8px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative",zIndex:a?1:"auto",borderBottomColor:F?"var(--purple)":"var(--border)"},children:e.jsx("div",{style:{display:"flex",flexDirection:"column",position:"relative",zIndex:a?1:"auto",padding:"2px",gap:0},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",minHeight:"40px"},children:[C?e.jsx("input",{ref:Te,type:"text",value:t.name||"",onChange:n=>{x&&t.id&&x(t.id,{name:n.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"4px",color:"var(--text-primary)",fontSize:"1.1rem",fontWeight:"600",padding:"0.5rem",width:"100%",maxWidth:"300px",paddingRight:"0.625rem"},placeholder:"Name"}):e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flex:1},children:e.jsx("h4",{style:{...Oe.rowTitle,color:a?"color-mix(in srgb, var(--gray-400) 80%, transparent)":Oe.rowTitle.color,textAlign:"left",margin:0,fontSize:"1.1rem",paddingRight:"6px",flex:1},children:((X=t.name)==null?void 0:X.replace(/\s+\(\d+\)$/,""))||t.name})}),(t.type||t.tier||C)&&e.jsx(yr,{type:t.type,tier:t.tier,isEditMode:C,onUpdate:x,itemId:t.id})]})})}),e.jsxs("div",{ref:fe,style:{borderRadius:"0 0 8px 8px",flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0},className:"invisible-scrollbar",children:[(t.motives||C)&&e.jsx("div",{style:{padding:"0.5rem 8px",textAlign:"center"},children:C?e.jsx("input",{type:"text",value:t.motives||"",onChange:n=>x&&x(t.id,{motives:n.target.value}),placeholder:"Motives...",style:{width:"100%",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}):e.jsxs("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,textAlign:"center"},children:[t.motives,t.motives&&!t.motives.endsWith(".")?".":""]})}),(t.difficulty||t.atk!==void 0||t.thresholds&&t.type!=="Minion"||t.experience&&t.experience.length>0||C)&&e.jsxs("div",{style:{padding:"0.5rem 8px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[(t.difficulty||C)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[e.jsx(rr,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(0deg)"}}),C?e.jsx("input",{type:"text",value:t.difficulty||"",onChange:n=>{const M=n.target.value.replace(/[^0-9]/g,"");M.length<=2&&x&&x(t.id,{difficulty:parseInt(M)||0})},onKeyDown:n=>{if(n.key==="ArrowUp"){n.preventDefault();const M=parseInt(t.difficulty)||0;x&&x(t.id,{difficulty:Math.min(M+1,99)})}else if(n.key==="ArrowDown"){n.preventDefault();const M=parseInt(t.difficulty)||0;x&&x(t.id,{difficulty:Math.max(M-1,0)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"2"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:t.difficulty})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Difficulty"})]}),(t.atk!==void 0||C)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[e.jsx(nr,{size:38,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(45deg)"}}),C?e.jsx("input",{type:"text",value:(()=>{if(typeof t.atk=="string"&&t.atk.includes("d"))return t.atk;const n=typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0;return n>=0?`+${n}`:n.toString()})(),onChange:n=>{const M=n.target.value;if(M.includes("d"))x&&x(t.id,{atk:M});else{const r=M.replace(/[^0-9+\-]/g,"");if(r.length<=4){const T=parseInt(r.replace(/[^0-9\-]/g,""))||0;x&&x(t.id,{atk:T})}}},onKeyDown:n=>{if(!(typeof t.atk=="string"&&t.atk.includes("d"))){if(n.key==="ArrowUp"){n.preventDefault();const r=(typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0)+1;x&&x(t.id,{atk:r})}else if(n.key==="ArrowDown"){n.preventDefault();const r=(typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0)-1;x&&x(t.id,{atk:r})}}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"3"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:(()=>{if(typeof t.atk=="string"&&t.atk.includes("d"))return t.atk;const n=typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk;return n>=0?`+${n}`:n})()})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Attack"})]})]}),e.jsx("div",{style:{paddingTop:"0"},children:C?e.jsx("div",{style:{display:"flex",flexDirection:"column",marginTop:"-0.25rem"},children:(()=>{const n=t.experience||[],M=n.length===0?[{name:"",modifier:0}]:n;return M.map((r,T)=>{var xe,_,V,l,E,I,re,te,Ie,je,Ee,Ce,ze,_e,qe,Ve,Qe,Ge,Ue,Xe,Ke,Je,Ze,lt,s;return e.jsxs("div",{style:{position:"relative",marginBottom:"0.5rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("input",{type:"text",value:typeof r=="object"&&r.modifier>0?`+${r.modifier}`:"",onChange:c=>{const L=[...t.experience||[]],i=c.target.value.replace(/[^0-9+-]/g,""),y=i===""||i==="+"?0:parseInt(i)||0,B=Math.max(0,y);L[T]={name:typeof r=="string"?r:r.name||"",modifier:B};const ne=Y(L);x&&x(t.id,{experience:ne})},onKeyDown:c=>{if(c.key==="ArrowUp"){c.preventDefault();const L=[...t.experience||[]],i=typeof r=="object"&&r.modifier||0;L[T]={name:typeof r=="string"?r:r.name||"",modifier:i+1};const y=Y(L);x&&x(t.id,{experience:y})}else if(c.key==="ArrowDown"){c.preventDefault();const L=[...t.experience||[]],i=typeof r=="object"&&r.modifier||0;L[T]={name:typeof r=="string"?r:r.name||"",modifier:Math.max(0,i-1)};const y=Y(L);x&&x(t.id,{experience:y})}},style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)",textAlign:"center",outline:"none"}})}),e.jsxs("div",{style:{marginLeft:"32px",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:typeof r=="string"?r:r.name||"",onChange:c=>{var ne;const L=[...t.experience||[]],i=typeof r=="object"&&r.modifier||0;L[T]={name:c.target.value,modifier:i};let y=Y(L);const B=y[y.length-1];B&&(typeof B=="string"?B.trim():(ne=B.name)!=null&&ne.trim())&&y.push({name:"",modifier:0}),x&&x(t.id,{experience:y})},placeholder:"Experience name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsxs("div",{style:{display:"flex",gap:"0.125rem"},children:[e.jsx("button",{onClick:()=>{var B,ne;const c=[...t.experience||[]],L=typeof r=="string"?r.trim():(B=r.name)==null?void 0:B.trim(),i=c[T-1],y=typeof i=="string"?i.trim():(ne=i.name)==null?void 0:ne.trim();if(T>0&&T<c.length&&L&&y){c[T]=i,c[T-1]=r;const W=Y(c);x&&x(t.id,{experience:W})}},disabled:T===0||!(typeof r=="string"?r.trim():(xe=r.name)!=null&&xe.trim())||!(typeof M[T-1]=="string"?M[T-1].trim():(_=M[T-1].name)!=null&&_.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:T===0||!(typeof r=="string"?r.trim():(V=r.name)!=null&&V.trim())||!(typeof M[T-1]=="string"?M[T-1].trim():(l=M[T-1].name)!=null&&l.trim())?"var(--gray-800)":"var(--gray-700)",color:T===0||!(typeof r=="string"?r.trim():(E=r.name)!=null&&E.trim())||!(typeof M[T-1]=="string"?M[T-1].trim():(I=M[T-1].name)!=null&&I.trim())?"var(--text-secondary)":"white",cursor:T===0||!(typeof r=="string"?r.trim():(re=r.name)!=null&&re.trim())||!(typeof M[T-1]=="string"?M[T-1].trim():(te=M[T-1].name)!=null&&te.trim())?"not-allowed":"pointer",opacity:T===0||!(typeof r=="string"?r.trim():(Ie=r.name)!=null&&Ie.trim())||!(typeof M[T-1]=="string"?M[T-1].trim():(je=M[T-1].name)!=null&&je.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move up",children:"↑"}),e.jsx("button",{onClick:()=>{var B,ne;const c=[...t.experience||[]],L=typeof r=="string"?r.trim():(B=r.name)==null?void 0:B.trim(),i=c[T+1],y=typeof i=="string"?i.trim():(ne=i.name)==null?void 0:ne.trim();if(T<c.length-1&&T>=0&&L&&y){c[T]=i,c[T+1]=r;const W=Y(c);x&&x(t.id,{experience:W})}},disabled:T===M.length-1||!(typeof r=="string"?r.trim():(Ee=r.name)!=null&&Ee.trim())||!(typeof M[T+1]=="string"?M[T+1].trim():(Ce=M[T+1].name)!=null&&Ce.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:T===M.length-1||!(typeof r=="string"?r.trim():(ze=r.name)!=null&&ze.trim())||!(typeof M[T+1]=="string"?M[T+1].trim():(_e=M[T+1].name)!=null&&_e.trim())?"var(--gray-800)":"var(--gray-700)",color:T===M.length-1||!(typeof r=="string"?r.trim():(qe=r.name)!=null&&qe.trim())||!(typeof M[T+1]=="string"?M[T+1].trim():(Ve=M[T+1].name)!=null&&Ve.trim())?"var(--text-secondary)":"white",cursor:T===M.length-1||!(typeof r=="string"?r.trim():(Qe=r.name)!=null&&Qe.trim())||!(typeof M[T+1]=="string"?M[T+1].trim():(Ge=M[T+1].name)!=null&&Ge.trim())?"not-allowed":"pointer",opacity:T===M.length-1||!(typeof r=="string"?r.trim():(Ue=r.name)!=null&&Ue.trim())||!(typeof M[T+1]=="string"?M[T+1].trim():(Xe=M[T+1].name)!=null&&Xe.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move down",children:"↓"}),e.jsx("button",{onClick:()=>ce(r,T),disabled:!(typeof r=="string"?r.trim():(Ke=r.name)!=null&&Ke.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:A[U(r,T)]?"var(--danger)":(typeof r=="string"?r.trim():(Je=r.name)!=null&&Je.trim())?"var(--gray-700)":"var(--gray-800)",color:(typeof r=="string"?r.trim():(Ze=r.name)!=null&&Ze.trim())?"white":"var(--text-secondary)",cursor:(typeof r=="string"?r.trim():(lt=r.name)!=null&&lt.trim())?"pointer":"not-allowed",opacity:(typeof r=="string"?r.trim():(s=r.name)!=null&&s.trim())?1:.5,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:A[U(r,T)]?"Click again to confirm delete":"Delete experience",children:"×"})]})]})]},T)})})()}):e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:t.experience&&t.experience.length>0?t.experience.map((n,M)=>{if(typeof n=="string"){const r=n.match(/^(.+?)\s*([+-]?\d+)$/);if(r){const[,T,xe]=r;return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:xe})})}),e.jsx("span",{style:{marginLeft:"32px"},children:T})]},M)}else return e.jsx("div",{style:{marginBottom:"0.25rem"},children:n},M)}else return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:e.jsxs("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:[n.modifier>=0?"+":"",n.modifier]})})}),e.jsx("span",{style:{marginLeft:"32px"},children:n.name})]},M)}):null})})]}),(t.features&&t.features.length>0||C)&&e.jsxs("div",{style:{padding:"0 8px 8px 8px"},children:[(t.atk!==void 0&&t.weapon||C)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Standard Attack"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:C?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",marginTop:"0.75rem",marginBottom:"0.75rem"},children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[e.jsx("input",{type:"text",value:t.weapon||"",onChange:n=>x&&x(t.id,{weapon:n.target.value}),placeholder:"Standard attack name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}}),e.jsxs("select",{value:t.range||"",onChange:n=>x&&x(t.id,{range:n.target.value}),style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",appearance:"none",backgroundImage:`url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",backgroundSize:"1rem",paddingRight:"2rem"},children:[e.jsx("option",{value:""}),e.jsx("option",{value:"Melee",children:"Melee"}),e.jsx("option",{value:"Very Close",children:"Very Close"}),e.jsx("option",{value:"Close",children:"Close"}),e.jsx("option",{value:"Far",children:"Far"}),e.jsx("option",{value:"Very Far",children:"Very Far"})]}),e.jsx("input",{type:"text",value:t.damage||"",onChange:n=>x&&x(t.id,{damage:n.target.value}),placeholder:"Damage (e.g., 1d6+2)",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}})]})}):t.atk!==void 0&&t.weapon&&e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:t.weapon}),e.jsxs("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:["Make an attack against a target within ",t.range||"Melee"," range. On a success, deal ",t.damage||"damage varies","."]})]})})]}),(t.features.filter(n=>n.type==="Action").length>0||C)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Actions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const n=t.features.filter(r=>r.type==="Action");return(C&&n.length===0?[{type:"Action",name:"",description:""}]:n).map((r,T)=>C?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:r.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false","data-lpignore":"true","data-form-type":"other",name:`feature-name-${r.type.toLowerCase()}`,onChange:xe=>{const _=[...t.features||[]],V=_.findIndex(I=>I.type==="Action"&&I===r);V>=0?_[V]={..._[V],name:xe.target.value}:_.push({type:"Action",name:xe.target.value,description:r.description||""});const l=_.filter(I=>I.type==="Action"),E=l[l.length-1];E&&E.name.trim()&&_.push({type:"Action",name:"",description:""}),x&&x(t.id,{features:_})},placeholder:"Action name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:r.description||"",onChange:xe=>{const _=[...t.features||[]],V=_.findIndex(I=>I.type==="Action"&&I===r);V>=0?_[V]={..._[V],description:xe.target.value}:_.push({type:"Action",name:r.name||"",description:xe.target.value});const l=_.filter(I=>I.type==="Action"),E=l[l.length-1];E&&E.name.trim()&&_.push({type:"Action",name:"",description:""}),x&&x(t.id,{features:_})},onInput:xe=>{const _=xe.target.offsetHeight;xe.target.style.height="auto";const V=xe.target.scrollHeight,l=V>_?V:_;xe.target.style.height=l+"px"},placeholder:"Action description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(wt,{feature:r,featureType:"Action",item:t,onUpdate:x,handleFeatureDeleteClick:Re,deleteConfirmations:A,getFeatureKey:ee})]},T):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:r.name}),r.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:r.description})]},T))})()})]}),(t.features.filter(n=>n.type==="Passive").length>0||C)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Passives"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const n=t.features.filter(r=>r.type==="Passive");return(C&&n.length===0?[{type:"Passive",name:"",description:""}]:n).map((r,T)=>C?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:r.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:xe=>{const _=[...t.features||[]],V=_.findIndex(I=>I.type==="Passive"&&I===r);V>=0?_[V]={..._[V],name:xe.target.value}:_.push({type:"Passive",name:xe.target.value,description:r.description||""});const l=_.filter(I=>I.type==="Passive"),E=l[l.length-1];E&&E.name.trim()&&_.push({type:"Passive",name:"",description:""}),x&&x(t.id,{features:_})},placeholder:"Passive name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:r.description||"",onChange:xe=>{const _=[...t.features||[]],V=_.findIndex(I=>I.type==="Passive"&&I===r);V>=0?_[V]={..._[V],description:xe.target.value}:_.push({type:"Passive",name:r.name||"",description:xe.target.value});const l=_.filter(I=>I.type==="Passive"),E=l[l.length-1];E&&E.name.trim()&&_.push({type:"Passive",name:"",description:""}),x&&x(t.id,{features:_})},onInput:xe=>{const _=xe.target.offsetHeight;xe.target.style.height="auto";const V=xe.target.scrollHeight,l=V>_?V:_;xe.target.style.height=l+"px"},placeholder:"Passive description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(wt,{feature:r,featureType:"Passive",item:t,onUpdate:x,handleFeatureDeleteClick:Re,deleteConfirmations:A,getFeatureKey:ee})]},T):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:r.name}),r.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:r.description})]},T))})()})]}),(t.features.filter(n=>n.type==="Reaction").length>0||C)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Reactions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const n=t.features.filter(r=>r.type==="Reaction");return(C&&n.length===0?[{type:"Reaction",name:"",description:""}]:n).map((r,T)=>C?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:r.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:xe=>{const _=[...t.features||[]],V=_.findIndex(I=>I.type==="Reaction"&&I===r);V>=0?_[V]={..._[V],name:xe.target.value}:_.push({type:"Reaction",name:xe.target.value,description:r.description||""});const l=_.filter(I=>I.type==="Reaction"),E=l[l.length-1];E&&E.name.trim()&&_.push({type:"Reaction",name:"",description:""}),x&&x(t.id,{features:_})},placeholder:"Reaction name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:r.description||"",onChange:xe=>{const _=[...t.features||[]],V=_.findIndex(I=>I.type==="Reaction"&&I===r);V>=0?_[V]={..._[V],description:xe.target.value}:_.push({type:"Reaction",name:r.name||"",description:xe.target.value});const l=_.filter(I=>I.type==="Reaction"),E=l[l.length-1];E&&E.name.trim()&&_.push({type:"Reaction",name:"",description:""}),x&&x(t.id,{features:_})},onInput:xe=>{const _=xe.target.offsetHeight;xe.target.style.height="auto";const V=xe.target.scrollHeight,l=V>_?V:_;xe.target.style.height=l+"px"},placeholder:"Reaction description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(wt,{feature:r,featureType:"Reaction",item:t,onUpdate:x,handleFeatureDeleteClick:Re,deleteConfirmations:A,getFeatureKey:ee})]},T):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:r.name}),r.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:r.description})]},T))})()})]})]}),(z&&z.length>0||t.type!=="Minion"&&(t.thresholds||C))&&e.jsxs("div",{style:{padding:"0 8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Status"})]}),C?e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border)"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"number",value:t.hpMax||"",onChange:n=>{const M=parseInt(n.target.value)||1;x&&x(t.id,{hpMax:M})},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),e.jsx(dt,{type:"adversaryHP",value:0,maxValue:t.hpMax||1,showTooltip:!1}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:"HP"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"number",value:t.stressMax||"",onChange:n=>{const M=parseInt(n.target.value)||1;x&&x(t.id,{stressMax:M})},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),e.jsx(dt,{type:"adversaryStress",value:0,maxValue:t.stressMax||1,showTooltip:!1}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:"Stress"})]})]})})}):z&&z.length>0&&z.map((n,M)=>{const r=(n.hp||0)>=(n.hpMax||1);return e.jsx("div",{"data-instance-id":n.id,style:{marginBottom:"0.5rem"},children:e.jsxs("div",{style:{backgroundColor:r?"var(--gray-900)":"var(--bg-primary)",borderRadius:"6px",padding:"0.25rem 0.5rem",border:"1px solid",borderColor:r?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",display:"flex",justifyContent:"flex-start",alignItems:"center",gap:"0.5rem",opacity:r?.7:1,position:"relative",transition:"all 0.2s ease",minHeight:"40px"},children:[r&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                          45deg,
                          transparent 0px,
                          transparent 8px,
                          var(--gray-600) 9px,
                          var(--gray-600) 9px
                        )`,pointerEvents:"none",zIndex:1,borderRadius:"4px"}})}),e.jsx("div",{style:{backgroundColor:r?"var(--gray-900)":"var(--bg-card)",border:"1px solid",borderColor:r?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",borderRadius:"50%",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",flexShrink:0,opacity:r?.5:1},children:e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:r?"var(--gray-400)":"var(--text-primary)"},children:n.duplicateNumber||1})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.125rem"},children:[e.jsx("div",{style:{opacity:r?.3:1},children:e.jsx(dt,{type:"adversaryHP",value:n.hp||0,maxValue:n.hpMax||1,onPipClick:(T,xe)=>{if(f&&o==="adversary"){const _=n.hp||0,V=n.hpMax||1;xe?b&&b(n.id,1,_):_<V&&f(n.id,1,_,V)}},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})}),n.stressMax>0&&e.jsx("div",{style:{opacity:r?.3:1},children:e.jsx(dt,{type:"adversaryStress",value:n.stress||0,maxValue:n.stressMax,onPipClick:(T,xe)=>{K&&o==="adversary"&&(xe?K(n.id,-1):K(n.id,1))},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})})]})]},n.id)},n.id)}),t.type!=="Minion"&&(t.thresholds||C)&&e.jsx("div",{style:{display:"flex",justifyContent:"center",paddingTop:"1px",marginTop:"0.5rem",marginBottom:"0.5rem"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",position:"relative"},children:e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",height:"36px"},children:[e.jsx("svg",{width:"300",height:"36",viewBox:"0 0 300 36",style:{position:"absolute",zIndex:1},children:e.jsx("rect",{x:"20",y:"6",width:"260",height:"24",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4"})}),e.jsx("div",{style:{position:"relative",zIndex:2,display:"flex",alignItems:"center",gap:"0.5rem"},children:C?e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",fontSize:"0.8rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),e.jsx("input",{type:"number",min:"1",max:"99",value:((be=t.thresholds)==null?void 0:be.major)||"",onChange:n=>{const M=n.target.value;(M===""||parseInt(M)>=1&&parseInt(M)<=99)&&x&&x(t.id,{thresholds:{...t.thresholds,major:M===""?null:parseInt(M)}})},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),e.jsx("input",{type:"number",min:"1",max:"99",value:((Be=t.thresholds)==null?void 0:Be.severe)||"",onChange:n=>{const M=n.target.value;(M===""||parseInt(M)>=1&&parseInt(M)<=99)&&x&&x(t.id,{thresholds:{...t.thresholds,severe:M===""?null:parseInt(M)}})},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),e.jsx(Ft,{value:((Le=t.thresholds)==null?void 0:Le.major)||7}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),e.jsx(Ft,{value:((Fe=t.thresholds)==null?void 0:Fe.severe)||14}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]})})]})})})]}),(C||m==="expanded"&&t.description&&t.description.trim())&&e.jsxs("div",{style:{padding:"0 8px",textAlign:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Description"})]}),C?e.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-primary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"none",overflow:"hidden",fontFamily:"inherit",marginTop:"0.75rem",marginBottom:"0.75rem"},value:t.description,onChange:n=>{n.target.style.height="auto",n.target.style.height=n.target.scrollHeight+"px",x&&x(t.id,{description:n.target.value})},placeholder:"Description..."}):e.jsx("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,whiteSpace:"pre-wrap",padding:"0.5rem 0"},children:t.description})]})]}),p()]})})};if(Q&&(o==="adversary"||o==="adversaries")){const a=o==="adversary",C=a?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:N=>{var G;N.stopPropagation(),(G=ie.current)!=null&&G.handleSave&&ie.current.handleSave()},style:{background:"var(--purple)",border:"1px solid var(--purple)",color:"white",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:N=>{N.currentTarget.style.opacity="0.9"},onMouseLeave:N=>{N.currentTarget.style.opacity="1"},title:"Save",children:[e.jsx(Wt,{size:16}),e.jsx("span",{children:"Save"})]}),Z&&e.jsxs("button",{onClick:N=>{N.stopPropagation(),Z()},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:N=>{N.currentTarget.style.backgroundColor="var(--bg-hover)",N.currentTarget.style.borderColor="var(--purple)"},onMouseLeave:N=>{N.currentTarget.style.backgroundColor="var(--bg-secondary)",N.currentTarget.style.borderColor="var(--border)"},title:"Cancel",children:[e.jsx(at,{size:16}),e.jsx("span",{children:"Cancel"})]})]}):null;return e.jsx(Et,{tabContent:C,containerStyle:{padding:0,height:"auto",maxHeight:a?"calc(100vh - 120px)":"calc(100vh - 68px)",minHeight:0},children:e.jsx(Mt,{ref:ie,editingAdversary:t,onSave:ge,onCancelEdit:Z,isStockAdversary:ye,embedded:!0,hideEmbeddedButtons:!0,allAdversaries:R,autoFocus:!t.baseName||t.baseName.trim()===""||t.baseName==="Unknown"})})}const w=Q?"edit":m;return(w==="expanded"||w==="edit")&&(o==="adversary"||o==="adversaries")?v():o==="adversary"||o==="adversaries"?null:e.jsxs("div",{className:Me(),style:ke(!0),children:[e.jsxs("div",{style:Oe.rowMain,children:[e.jsx("h4",{style:Oe.rowTitle,children:Ne()}),e.jsx("div",{style:Oe.rowMeta,children:He()})]}),e.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"12px",margin:0},children:["Expanded view coming soon for ",o]})]})},ft=br,wr="/Daggerheart/assets/daggerheart-logo-fe7815ad.svg",Sr=(t,o)=>{const[m,d]=u.useState("max-content"),k=u.useCallback(()=>{if(!o.current||t<=3)return"max-content";const f=o.current.offsetWidth,K=Math.floor(f/120);return K<=1?"max-content":t===4?"max-content max-content":t===5||t===6?K>=2?"max-content max-content":"max-content":t===7?K>=3?"max-content max-content max-content":K>=2?"max-content max-content":"max-content":"repeat(auto-fit, minmax(80px, max-content))"},[t,o]);return u.useEffect(()=>{const f=k();d(f);const b=new ResizeObserver(()=>{const K=k();d(K)});return o.current&&b.observe(o.current),()=>{b.disconnect()}},[k]),m},Cr=({encounter:t})=>{var k,f;const o=u.useRef(null),m=((k=t.encounterItems)==null?void 0:k.length)||0,d=Sr(m,o);return e.jsx("div",{ref:o,className:"saved-encounter-adversary-list",style:{flex:1,fontSize:"0.8rem",color:"var(--text-secondary)",lineHeight:"1.3",display:"grid",gridTemplateColumns:d,gap:"0.25rem 1rem",gridAutoRows:"min-content"},children:((f=t.encounterItems)==null?void 0:f.length)>0?t.encounterItems.map((b,K)=>{var R;const x=b.item.baseName||((R=b.item.name)==null?void 0:R.replace(/\s+\(\d+\)$/,""))||b.item.name;return e.jsxs("div",{style:{marginBottom:"0.125rem"},children:[b.quantity,"x ",x]},K)}):e.jsx("div",{children:"No adversaries"})})},ut={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},pt={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1,lowerTierAdversary:1};let ot={adversaries:[]},At={environments:[]},ht=!1;const jr=()=>{const t=JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]"),o=JSON.parse(localStorage.getItem("daggerheart-custom-environments")||"[]");return{customAdversaries:t,customEnvironments:o}},St=async()=>{if(ht)return;let t={adversaries:[]},o={environments:[]},m={adversaries:[]},d={environments:[]};try{const b=await st(()=>import("./adversaries-9c8932de.js"),[]);t=(b==null?void 0:b.default)||b}catch(b){console.warn("Failed to load adversaries.json:",b)}try{const b=await st(()=>import("./environments-c340637c.js"),[]);o=(b==null?void 0:b.default)||b}catch(b){console.warn("Failed to load environments.json:",b)}try{const b=await st(()=>import("./playtest-adversaries-4a099c10.js"),[]);m=(b==null?void 0:b.default)||b}catch(b){console.warn("Failed to load playtest-adversaries.json:",b)}try{const b=await st(()=>import("./playtest-environments-d9cdffb6.js"),[]);d=(b==null?void 0:b.default)||b}catch(b){console.warn("Failed to load playtest-environments.json:",b)}const{customAdversaries:k,customEnvironments:f}=jr();ot={...t,adversaries:[...t.adversaries||[],...m.adversaries||[],...k]},At={...o,environments:[...o.environments||[],...d.environments||[],...f]},ht=!0},kr=(t,o=[],m=4,d=1,k=!1,f=null)=>{const[b,K]=u.useState(""),[x,R]=u.useState([{field:"tier",direction:"asc"},{field:"name",direction:"asc"}]),[F,g]=u.useState([]),[z,j]=u.useState(!0),[J,me]=u.useState([]),[ae,de]=u.useState([]),[Q,ge]=u.useState(!1),[Z,ye]=u.useState(!1),fe=u.useRef(null),Se=u.useRef(null);u.useEffect(()=>{(async()=>{await St(),j(!1);let H=[];t==="adversary"?H=ot.adversaries||[]:t==="environment"&&(H=At.environments||[]),g(H)})()},[t]),u.useEffect(()=>{t==="adversary"&&f&&(async()=>{ht=!1,await St();let H=[];k?H=(ot.adversaries||[]).filter(ke=>{var Me;return ke.source==="Homebrew"||((Me=ke.id)==null?void 0:Me.startsWith("custom-"))}):H=ot.adversaries||[],g(H)})()},[f,t,k]);const $=ce=>{const H=F.map(ke=>ke[ce]).filter(Boolean);return[...new Set(H)].sort((ke,Me)=>typeof ke=="number"&&typeof Me=="number"?ke-Me:String(ke).localeCompare(String(Me)))},O=u.useCallback(async()=>{ht=!1,await St();let ce=[];t==="adversary"?k?ce=(ot.adversaries||[]).filter(H=>{var ke;return H.source==="Homebrew"||((ke=H.id)==null?void 0:ke.startsWith("custom-"))}):ce=ot.adversaries||[]:t==="environment"&&(ce=At.environments||[]),g(ce)},[t,k]);u.useEffect(()=>{O()},[k,O]);const ve=$("tier"),Te=$("type"),ie=u.useMemo(()=>{let ce=F.filter(H=>{var p,v;const Me=(H.name||H.baseName||"").toLowerCase().includes(b.toLowerCase())||((p=H.type)==null?void 0:p.toLowerCase().includes(b.toLowerCase()))||((v=H.description)==null?void 0:v.toLowerCase().includes(b.toLowerCase())),Ne=J.length===0||J.includes(H.tier.toString()),He=ae.length===0||ae.includes(H.type);return Me&&Ne&&He});return ce.sort((H,ke)=>{for(const Me of x){const{field:Ne,direction:He}=Me;let p=H[Ne],v=ke[Ne];if(Ne==="tier")p=parseInt(p)||0,v=parseInt(v)||0;else if(Ne==="atk")p=parseInt(p)||0,v=parseInt(v)||0;else if(Ne==="cost"){const w=h=>{if(t!=="adversary")return 0;const a=ut[h.type]||2;let C=0;const N=o.filter(X=>X.type==="adversary"&&X.item.type==="Solo"&&X.quantity>0).reduce((X,be)=>X+be.quantity,0),G=o.filter(X=>X.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(X.item.type)&&X.quantity>0).reduce((X,be)=>X+be.quantity,0);return h.type==="Solo"&&N===1&&(C+=2),["Bruiser","Horde","Leader","Solo"].includes(h.type)&&G===0&&(C+=1),a+C};p=w(H),v=w(ke)}else if(Ne==="difficulty"){const w=parseInt(p),h=parseInt(v);!isNaN(w)&&!isNaN(h)?(p=w,v=h):!isNaN(w)&&isNaN(h)?(p=w,v=999):isNaN(w)&&!isNaN(h)?(p=999,v=h):(p=String(p||"").toLowerCase(),v=String(v||"").toLowerCase())}else typeof p=="string"&&typeof v=="string"?(p=p.toLowerCase(),v=v.toLowerCase()):(p=String(p||"").toLowerCase(),v=String(v||"").toLowerCase());if(He==="asc"){if(p>v)return 1;if(p<v)return-1}else{if(p<v)return 1;if(p>v)return-1}}return 0}),ce},[F,b,x,J,ae,o,m,d]),A=ce=>{R(H=>{const ke=H.findIndex(Me=>Me.field===ce);if(ke>=0)if(ke===0){const Me=[...H];return Me[0]={...Me[0],direction:Me[0].direction==="asc"?"desc":"asc"},Me}else{const Me=[...H];return Me.splice(ke,1)[0],[{field:ce,direction:"asc"},...Me]}else return[{field:ce,direction:"asc"},...H]})},S=ce=>{me(ce==="clear"?[]:H=>H.includes(ce)?H.filter(ke=>ke!==ce):[...H,ce])},ee=ce=>{de(ce==="clear"?[]:H=>H.includes(ce)?H.filter(ke=>ke!==ce):[...H,ce])},U=J.length>0,Y=ae.length>0;return u.useEffect(()=>{const ce=ke=>{const Me=ke.target.closest(".filter-dropdown"),Ne=ke.target.closest(".header-filter-icon");Me||Ne||(ge(!1),ye(!1))},H=ke=>{ke.key==="Escape"&&(ge(!1),ye(!1))};return document.addEventListener("pointerdown",ce,!0),document.addEventListener("mousedown",ce,!0),document.addEventListener("touchstart",ce,!0),document.addEventListener("click",ce,!0),document.addEventListener("keydown",H,!0),()=>{document.removeEventListener("pointerdown",ce,!0),document.removeEventListener("mousedown",ce,!0),document.removeEventListener("touchstart",ce,!0),document.removeEventListener("click",ce,!0),document.removeEventListener("keydown",H,!0)}},[ge,ye]),{searchTerm:b,setSearchTerm:K,sortFields:x,handleSort:A,filteredAndSortedData:ie,loading:z,refreshData:O,selectedTiers:J,selectedTypes:ae,showTierDropdown:Q,setShowTierDropdown:ge,showTypeDropdown:Z,setShowTypeDropdown:ye,tierFilterRef:fe,typeFilterRef:Se,uniqueTiers:ve,uniqueTypes:Te,handleTierSelect:S,handleTypeSelect:ee,isTierFiltered:U,isTypeFiltered:Y,getDropdownStyle:ce=>{if(!ce.current)return{};const H=ce.current.getBoundingClientRect();return{position:"fixed",top:H.bottom+4,left:H.left-100,zIndex:99999}}}},Ir=({searchTerm:t,onSearchChange:o,type:m,partyControls:d,showCustomToggle:k=!1,onToggleCustom:f,filterCustom:b=!1,onExportCustomAdversaries:K,onImportCustomAdversaries:x,autoFocus:R=!1,onClose:F=null,placeholder:g="Search"})=>{const z=u.useRef(null);return u.useEffect(()=>{R&&z.current&&setTimeout(()=>{var j;(j=z.current)==null||j.focus()},100)},[R]),e.jsxs("div",{className:"browser-header",style:he.browserHeader,children:[e.jsx("div",{style:{display:"flex",alignItems:"center",flex:1,gap:"0.5rem"},children:e.jsx("input",{ref:z,type:"text",placeholder:g,value:t,onChange:j=>o(j.target.value),style:{...he.searchInput,flex:1,marginRight:0}})}),d&&e.jsx("div",{style:he.partyControls,children:d})]})},Er=({showCustomToggle:t=!1,onToggleCustom:o,filterCustom:m=!1,onExportCustomAdversaries:d,onImportCustomAdversaries:k})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)",flexShrink:0},children:[t&&e.jsxs("button",{onClick:()=>o&&o(!m),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:m?"var(--purple)":"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:m?"white":"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:f=>{m||(f.target.style.backgroundColor="var(--bg-hover)",f.target.style.borderColor="var(--purple)")},onMouseLeave:f=>{m||(f.target.style.backgroundColor="var(--bg-primary)",f.target.style.borderColor="var(--border)")},children:[e.jsx("span",{children:m?"✓":"○"}),"Custom Only"]}),e.jsxs("button",{onClick:d,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:f=>{f.target.style.backgroundColor="var(--bg-hover)",f.target.style.borderColor="var(--purple)"},onMouseLeave:f=>{f.target.style.backgroundColor="var(--bg-primary)",f.target.style.borderColor="var(--border)"},children:[e.jsx("span",{children:"↓"}),"Export"]}),e.jsxs("button",{onClick:()=>document.getElementById("import-file-input").click(),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:f=>{f.target.style.backgroundColor="var(--bg-hover)",f.target.style.borderColor="var(--purple)"},onMouseLeave:f=>{f.target.style.backgroundColor="var(--bg-primary)",f.target.style.borderColor="var(--border)"},children:[e.jsx("span",{children:"↑"}),"Import"]}),e.jsx("input",{id:"import-file-input",type:"file",accept:".csv,.json",onChange:k,style:{display:"none"}})]}),Ar=({sortFields:t,onSort:o,type:m,uniqueTiers:d,uniqueTypes:k,selectedTiers:f,selectedTypes:b,showTierDropdown:K,setShowTierDropdown:x,showTypeDropdown:R,setShowTypeDropdown:F,tierFilterRef:g,typeFilterRef:z,handleTierSelect:j,handleTypeSelect:J,isTierFiltered:me,isTypeFiltered:ae,getDropdownStyle:de,costFilter:Q,showCostDropdown:ge,setShowCostDropdown:Z,costFilterRef:ye,handleCostFilterSelect:fe,isCostFiltered:Se})=>{const[$,O]=u.useState(null),Te=(()=>m==="adversary"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0,hasCostFilter:!0},{key:"source",label:"Src"}]:m==="environment"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"}]:[])(),ie=()=>{if(!ge)return null;const S=[{value:"all",label:"All"},{value:"auto-grey",label:"Auto Grey"},{value:"auto-hide",label:"Auto Hide"}];return kt.createPortal(e.jsx("div",{className:"filter-dropdown",style:{...he.filterDropdown,...de(ye),maxHeight:"60vh",overflow:"auto"},onMouseDown:ee=>ee.stopPropagation(),onClick:ee=>ee.stopPropagation(),children:S.map(ee=>{const U=Q===ee.value;return e.jsxs("div",{style:{...he.filterOption,...U?he.filterOptionSelected:{}},onClick:()=>fe(ee.value),children:[e.jsx("span",{style:he.checkIcon,children:U?e.jsx(xt,{size:16}):e.jsx(yt,{size:16})}),e.jsx("span",{style:he.filterLabel,children:ee.label})]},ee.value)})}),document.body)},A=(S,ee,U,Y,Re,ce,H,ke)=>{if(!Re)return null;const Me=()=>{(S==="tier"||S==="type")&&Y("clear")};return kt.createPortal(e.jsxs("div",{className:"filter-dropdown",style:{...he.filterDropdown,...de(H),maxHeight:"60vh",overflow:"auto"},onMouseDown:Ne=>Ne.stopPropagation(),onClick:Ne=>Ne.stopPropagation(),children:[e.jsxs("div",{style:{...he.filterOption,...U.length===0?he.filterOptionSelected:{}},onClick:Me,children:[e.jsx("span",{style:he.checkIcon,children:U.length===0?e.jsx(xt,{size:16}):e.jsx(yt,{size:16})}),e.jsx("span",{style:he.filterLabel,children:"All"})]}),ee.map(Ne=>{const He=U.includes(Ne.toString());return e.jsxs("div",{style:{...he.filterOption,...He?he.filterOptionSelected:{}},onClick:()=>Y(Ne.toString()),children:[e.jsx("span",{style:he.checkIcon,children:He?e.jsx(xt,{size:16}):e.jsx(yt,{size:16})}),e.jsx("span",{style:he.filterLabel,children:Ne})]},Ne)})]}),document.body)};return e.jsx("tr",{style:he.tableHeader,children:Te.map(S=>e.jsxs("th",{style:{...he.tableHeaderCell,...$===S.key?he.tableHeaderCellHover:{},position:"relative",...S.key==="name"?{width:"auto",minWidth:"0"}:{},...S.key==="tier"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...S.key==="type"?{width:"80px",minWidth:"80px",maxWidth:"80px"}:{},...S.key==="source"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{}},onClick:()=>o(S.key),onMouseEnter:()=>O(S.key),onMouseLeave:()=>O(null),children:[S.hasFilter?e.jsxs("div",{style:he.headerWithFilter,children:[e.jsx("span",{style:{cursor:"pointer"},onClick:ee=>{ee.stopPropagation(),o(S.key)},children:S.label}),e.jsxs("button",{ref:S.key==="tier"?g:S.key==="type"&&S.hasCostFilter?ye:S.key==="type"?z:ye,style:{...he.headerFilterIcon,...S.key==="tier"&&me?he.headerFilterIconActive:{},...S.key==="type"&&(ae||Se)?he.headerFilterIconActive:{},...S.key==="cost"&&Se?he.headerFilterIconActive:{}},className:"header-filter-icon",onClick:ee=>{ee.stopPropagation(),S.key==="tier"?(x(!K),F(!1),Z(!1)):S.key==="type"&&(S.hasCostFilter?(Z(!ge),x(!1),F(!1)):(F(!R),x(!1),Z(!1)))},children:[e.jsx(sr,{size:14}),S.key==="tier"&&me||S.key==="type"&&(ae||Se)||S.key==="cost"&&Se?e.jsx("span",{style:he.filterActiveDot}):null]})]}):S.label,S.key==="tier"&&A("tier",d,f,j,K,x,g),S.key==="type"&&!S.hasCostFilter&&A("type",k,b,J,R,F,z),S.key==="type"&&S.hasCostFilter&&ie()]},S.key))})},Tr=({item:t,onAdd:o,type:m,onRowClick:d,encounterItems:k=[],pcCount:f=4,playerTier:b=1,remainingBudget:K=0,costFilter:x="auto-grey",isFocused:R=!1,rowRef:F=null,onDeleteCustomAdversary:g=null,isDeleteConfirmed:z=!1})=>{const[j,J]=u.useState(!1),me=()=>{o(t)},ae=()=>{if(m!=="adversary")return null;const ge=ut[t.type]||2;let Z=0;const ye=k.filter(Se=>Se.type==="adversary"&&Se.item.type==="Solo"&&Se.quantity>0).reduce((Se,$)=>Se+$.quantity,0),fe=k.filter(Se=>Se.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(Se.item.type)&&Se.quantity>0).reduce((Se,$)=>Se+$.quantity,0);return t.type==="Solo"&&ye===1&&(Z+=2),["Bruiser","Horde","Leader","Solo"].includes(t.type)&&fe===0&&(Z+=1),ge+Z},Q=(()=>{if(m==="adversary"){const ge=ae();ut[t.type];const Z=ge>K||K<=0;if(x==="auto-hide"&&Z)return null;const ye=x==="auto-grey"&&Z?{opacity:.5,color:"var(--text-secondary)"}:{};return t.description||t.motives?[[e.jsx("td",{style:{...he.rowCell,width:"auto",minWidth:"0",textAlign:"left",...ye,borderBottom:"none",padding:"0.25rem 0.25rem 0 0.5rem",outline:"none"},children:e.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%",display:"flex",alignItems:"center",gap:"0.5rem"},children:e.jsx("div",{style:{flex:1,minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx("div",{style:{fontWeight:"600"},children:t.name||t.baseName||""})})})},"name"),e.jsx("td",{style:{...he.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...ye,borderBottom:"none",padding:"0.25rem 0.25rem 0 0.25rem",outline:"none"},children:t.tier},"tier"),e.jsx("td",{style:{...he.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center",...ye,borderBottom:"none",padding:"0.25rem 0.25rem 0 0.25rem",outline:"none"},children:t.type},"type"),e.jsx("td",{style:{...he.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...ye,borderBottom:"none",outline:"none"},rowSpan:2,children:t.source==="Homebrew"||t.isCustom?(j||R||z)&&g?e.jsx("button",{onClick:fe=>{fe.stopPropagation(),g(t.id)},style:{background:z?"var(--danger)":"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"4px",padding:"0.25rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:z?"var(--text-primary)":"var(--danger)",transition:"all 0.2s ease",flexShrink:0,width:"24px",height:"24px",margin:"0 auto"},title:z?"Click again to confirm delete":"Delete custom adversary",children:e.jsx(zt,{size:14})}):e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",margin:"0 auto"},children:e.jsx(Nt,{size:14,style:{color:"var(--text-secondary)",opacity:.7},title:"Custom adversary"})}):e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",margin:"0 auto"},children:e.jsx(Bt,{size:14,style:{color:"var(--text-secondary)",opacity:.7},title:"Stock adversary"})})},"source")],[e.jsx("td",{colSpan:3,style:{...he.rowCell,textAlign:"left",...ye,padding:"0 0.25rem 0.25rem 0.5rem",borderTop:"none",borderBottom:"none",outline:"none"},children:e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.description||t.motives||""})},"desc")]]:e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...he.rowCell,width:"auto",minWidth:"0",textAlign:"left",...ye,paddingLeft:"0.5rem"},children:e.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%",display:"flex",alignItems:"center",gap:"0.5rem"},children:e.jsx("div",{style:{flex:1,minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx("div",{style:{fontWeight:"600"},children:t.name||t.baseName||""})})})}),e.jsx("td",{style:{...he.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...ye},children:t.tier}),e.jsx("td",{style:{...he.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center",...ye},children:t.type}),e.jsx("td",{style:{...he.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...ye},children:t.source==="Homebrew"||t.isCustom?(j||R||z)&&g?e.jsx("button",{onClick:fe=>{fe.stopPropagation(),g(t.id)},style:{background:z?"var(--danger)":"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"4px",padding:"0.25rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:z?"var(--text-primary)":"var(--danger)",transition:"all 0.2s ease",flexShrink:0,width:"24px",height:"24px",margin:"0 auto"},title:z?"Click again to confirm delete":"Delete custom adversary",children:e.jsx(zt,{size:14})}):e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",margin:"0 auto"},children:e.jsx(Nt,{size:14,style:{color:"var(--text-secondary)",opacity:.7},title:"Custom adversary"})}):e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",margin:"0 auto"},children:e.jsx(Bt,{size:14,style:{color:"var(--text-secondary)",opacity:.7},title:"Stock adversary"})})})]})}else if(m==="environment")return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...he.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:t.name||t.baseName||""}),e.jsx("td",{style:{...he.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:t.tier}),e.jsx("td",{style:{...he.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:t.type}),e.jsx("td",{style:{...he.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:t.difficulty})]});return null})();return Q===null?null:Array.isArray(Q)?e.jsx(e.Fragment,{children:Q.map((ge,Z)=>e.jsx("tr",{ref:Z===0?F:null,style:{...he.row,...j?he.rowHover:{},...R?he.rowFocused:{},...Z===0?{borderBottom:"none"}:{},...Z===1?{borderTop:"none",height:"auto",outline:"none"}:{}},onClick:()=>{m==="adversary"?me():d&&d(t,m)},onMouseEnter:()=>J(!0),onMouseLeave:()=>J(!1),children:ge},Z))}):e.jsx(e.Fragment,{children:e.jsx("tr",{ref:F,style:{...he.row,...j?he.rowHover:{},...R?he.rowFocused:{}},onClick:()=>{m==="adversary"?me():d&&d(t,m)},onMouseEnter:()=>J(!0),onMouseLeave:()=>J(!1),children:Q})})},Jt=({type:t,onAddItem:o,onCancel:m=null,onRowClick:d,encounterItems:k=[],pcCount:f=4,playerTier:b=1,partyControls:K=null,showContainer:x=!0,savedEncounters:R=[],onLoadEncounter:F,onDeleteEncounter:g,activeTab:z="adversaries",selectedCustomAdversaryId:j,onSelectCustomAdversary:J,onTabChange:me,selectedAdversary:ae,onSelectAdversary:de,filterCustom:Q=!1,showCustomToggle:ge=!1,onToggleCustom:Z,onExportCustomAdversaries:ye,onImportCustomAdversaries:fe,autoFocus:Se=!1,hideImportExport:$=!1,onClose:O=null,searchPlaceholder:ve="Search"})=>{const{addCustomAdversary:Te,updateCustomAdversary:ie,deleteCustomAdversary:A,customContent:S,adversaries:ee,deleteAdversary:U}=Tt(),[Y,Re]=u.useState(null),[ce,H]=u.useState("all"),[ke,Me]=u.useState(!1),[Ne,He]=u.useState({}),[p,v]=u.useState({}),w=u.useRef({}),h=u.useRef({}),a=u.useRef(null),[C,N]=u.useState(-1),[G,X]=u.useState(null),be=u.useRef({}),Be=()=>{try{const i=S.adversaries||[];if(i.length===0){alert("No custom adversaries to export.");return}const y=["name","tier","type","difficulty","threshold_major","threshold_severe","hp_max","stress_max","atk","weapon","range","damage","description","motives"],B=i.map(q=>{var D,Ae;return[q.name||"",q.tier||"",q.type||"",q.difficulty||"",((D=q.thresholds)==null?void 0:D.major)||"",((Ae=q.thresholds)==null?void 0:Ae.severe)||"",q.hpMax||"",q.stressMax||"",q.atk||"",q.weapon||"",q.range||"",q.damage||"",q.description||"",q.motives||""]}),ne=q=>{const D=String(q);return D.includes(",")||D.includes('"')||D.includes(`
`)?`"${D.replace(/"/g,'""')}"`:D},W=[y.join(","),...B.map(q=>q.map(ne).join(","))].join(`
`),le=new Blob([W],{type:"text/csv;charset=utf-8;"}),pe=URL.createObjectURL(le),P=document.createElement("a");P.href=pe,P.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(P),P.click(),document.body.removeChild(P),URL.revokeObjectURL(pe),console.log(`Exported ${i.length} custom adversaries to CSV`)}catch(i){console.error("Failed to export custom adversaries:",i),alert("Failed to export custom adversaries. Please try again.")}},Le=i=>{const y=i.target.files[0];if(!y)return;const B=y.name.endsWith(".csv"),ne=y.name.endsWith(".json");if(!B&&!ne){alert("Please upload a CSV or JSON file."),i.target.value="";return}const W=new FileReader;W.onload=le=>{try{let pe=[];if(B){const oe=le.target.result.split(`
`).filter(We=>We.trim());if(oe.length<2)throw new Error("CSV file is empty or invalid.");const se=oe[0].split(",").map(We=>We.trim().replace(/^"|"$/g,""));for(let We=1;We<oe.length;We++){const ue=[];let Pe="",$e=!1;for(let De=0;De<oe[We].length;De++){const et=oe[We][De],Yt=oe[We][De+1];et==='"'&&$e&&Yt==='"'?(Pe+='"',De++):et==='"'?$e=!$e:et===","&&!$e?(ue.push(Pe.trim()),Pe=""):Pe+=et}ue.push(Pe.trim());const Ye={name:ue[se.indexOf("name")]||"",tier:parseInt(ue[se.indexOf("tier")])||1,type:ue[se.indexOf("type")]||"Standard",difficulty:parseInt(ue[se.indexOf("difficulty")])||11,thresholds:{major:parseInt(ue[se.indexOf("threshold_major")])||7,severe:parseInt(ue[se.indexOf("threshold_severe")])||12},hpMax:parseInt(ue[se.indexOf("hp_max")])||3,stressMax:parseInt(ue[se.indexOf("stress_max")])||1,atk:parseInt(ue[se.indexOf("atk")])||1,weapon:ue[se.indexOf("weapon")]||"",range:ue[se.indexOf("range")]||"Melee",damage:ue[se.indexOf("damage")]||"",description:ue[se.indexOf("description")]||"",motives:ue[se.indexOf("motives")]||"",source:"Homebrew"};Ye.name&&pe.push(Ye)}}else if(ne){const we=JSON.parse(le.target.result);if(!we.customAdversaries||!Array.isArray(we.customAdversaries))throw new Error("Invalid JSON format. Expected customAdversaries array.");pe=we.customAdversaries}const P=S.adversaries||[],q=[...P];let D=0,Ae=0;pe.forEach(we=>{if(P.some(se=>se.name===we.name&&se.source===we.source))Ae++;else{const se={...we,id:`custom-adv-${Date.now()}-${Math.random().toString(36).slice(2,10)}`,hp:0,stress:0};q.push(se),D++}}),D>0?(localStorage.setItem("daggerheart-custom-adversaries",JSON.stringify(q)),window.location.reload(),alert(`Import successful! Added ${D} new adversaries${Ae>0?`, skipped ${Ae} duplicates`:""}.`)):alert("No new adversaries were added. All imported adversaries already exist.")}catch(pe){console.error("Failed to import custom adversaries:",pe),alert(`Failed to import custom adversaries: ${pe.message}`)}},W.readAsText(y),i.target.value=""},Fe=()=>{Re(null)},n=async(i,y)=>{y?ie(y,i):Te(i)},M=i=>{Ne[i]?(g&&g(i),He(y=>{const B={...y};return delete B[i],B}),w.current[i]&&(clearTimeout(w.current[i]),delete w.current[i])):(He(y=>({...y,[i]:!0})),w.current[i]&&clearTimeout(w.current[i]),w.current[i]=setTimeout(()=>{He(y=>{const B={...y};return delete B[i],B}),delete w.current[i]},3e3))},r=i=>{p[i]?(ee.filter(B=>B.customContentId===i).forEach(B=>{U(B.id)}),A(i),v(B=>{const ne={...B};return delete ne[i],ne}),h.current[i]&&(clearTimeout(h.current[i]),delete h.current[i])):(v(y=>({...y,[i]:!0})),h.current[i]&&clearTimeout(h.current[i]),h.current[i]=setTimeout(()=>{v(y=>{const B={...y};return delete B[i],B}),delete h.current[i]},3e3))};u.useEffect(()=>()=>{Object.values(w.current).forEach(i=>{clearTimeout(i)}),Object.values(h.current).forEach(i=>{clearTimeout(i)})},[]);const{searchTerm:T,setSearchTerm:xe,sortFields:_,handleSort:V,filteredAndSortedData:l,loading:E,selectedTiers:I,selectedTypes:re,showTierDropdown:te,setShowTierDropdown:Ie,showTypeDropdown:je,setShowTypeDropdown:Ee,tierFilterRef:Ce,typeFilterRef:ze,uniqueTiers:_e,uniqueTypes:qe,handleTierSelect:Ve,handleTypeSelect:Qe,isTierFiltered:Ge,isTypeFiltered:Ue,getDropdownStyle:Xe}=kr(t,k,f,b,Q,S),Ke=u.useRef(T),Je=u.useRef(JSON.stringify(I)),Ze=u.useRef(JSON.stringify(re));u.useEffect(()=>{const i=Ke.current!==T,y=Je.current!==JSON.stringify(I),B=Ze.current!==JSON.stringify(re);(i||y||B)&&(N(-1),X(null),Ke.current=T,Je.current=JSON.stringify(I),Ze.current=JSON.stringify(re))},[T,I,re]),u.useEffect(()=>{if(z!=="adversaries")return;const i=y=>{const B=document.activeElement;if(B&&["INPUT","TEXTAREA","SELECT"].includes(B.tagName))if(y.key==="ArrowDown"||y.key==="ArrowUp"||y.key==="Enter")(y.key!=="Enter"||B.tagName!=="INPUT")&&B.blur();else return;const ne=l.length-1;if(y.key==="ArrowDown")y.preventDefault(),N(W=>{var pe;const le=W<ne?W+1:W;return le>=0&&le<l.length&&(X(((pe=l[le])==null?void 0:pe.id)||null),be.current[le]&&setTimeout(()=>{const P=be.current[le];if(P){const q=P.closest(".browser-content");if(q){const D=q.getBoundingClientRect(),Ae=P.getBoundingClientRect(),we=P.nextElementSibling,oe=we&&we.tagName==="TR"&&we.querySelector("td[colspan]");let se=Ae.height;oe&&(se+=we.getBoundingClientRect().height);const We=Ae.bottom-D.top,ue=D.height,Pe=We>=ue-1,$e=Ae.bottom>D.bottom;if(Pe||$e){let De=P.offsetTop+se-ue;const et=q.scrollHeight-ue;De=Math.min(De,et),De=Math.max(0,De),q.scrollTo({top:De,behavior:"smooth"})}}else P.scrollIntoView({behavior:"smooth",block:"end"})}},0)),le});else if(y.key==="ArrowUp")y.preventDefault(),N(W=>{var pe;if(W<=0)return X(null),setTimeout(()=>{const P=document.querySelector('.browser-header input[type="text"]');P==null||P.focus()},0),-1;const le=W-1;return le>=0&&le<l.length?(X(((pe=l[le])==null?void 0:pe.id)||null),be.current[le]&&setTimeout(()=>{const P=be.current[le];if(P){const q=P.closest(".browser-content");if(q){const D=q.getBoundingClientRect(),Ae=P.getBoundingClientRect(),we=(()=>{const ue=P.closest("table"),Pe=ue==null?void 0:ue.querySelector("thead");return Pe?Pe.getBoundingClientRect().height:0})(),oe=Ae.top-D.top,se=Math.abs(oe-we)<=1;if(Ae.top<D.top||se){const ue=P.nextElementSibling,Pe=ue&&ue.tagName==="TR"&&ue.querySelector("td[colspan]");let $e=Ae.height;Pe&&($e+=ue.getBoundingClientRect().height);let De=P.offsetTop-we;const et=q.scrollHeight-q.clientHeight;De=Math.min(De,et),De=Math.max(0,De),q.scrollTo({top:De,behavior:"smooth"})}}else P.scrollIntoView({behavior:"smooth",block:"start"})}},0)):X(null),le});else if(y.key==="Enter"&&C>=0&&C<=ne){y.preventDefault();const W=l[C];W&&o&&o(W)}};return document.addEventListener("keydown",i),()=>{document.removeEventListener("keydown",i)}},[z,l,C,o]);const s=(()=>{const i=3*f+2,y=k.reduce((D,Ae)=>{if(Ae.type==="adversary"){const we=ut[Ae.item.type]||2;if(Ae.item.type==="Minion"){const oe=Math.ceil(Ae.quantity/f);return D+oe*we}else return D+Ae.quantity*we}return D},0);let B=0;k.filter(D=>D.type==="adversary"&&D.item.type==="Solo"&&D.quantity>0).reduce((D,Ae)=>D+Ae.quantity,0)>=2&&(B+=pt.twoOrMoreSolos);const W=k.some(D=>D.type==="adversary"&&D.item.type==="Bruiser"&&D.quantity>0),le=k.some(D=>D.type==="adversary"&&D.item.type==="Horde"&&D.quantity>0),pe=k.some(D=>D.type==="adversary"&&D.item.type==="Leader"&&D.quantity>0),P=k.some(D=>D.type==="adversary"&&D.item.type==="Solo"&&D.quantity>0);return!W&&!le&&!pe&&!P&&(B+=pt.noBruisersHordesLeadersSolos),i+B-y})(),c=i=>{H(i),Me(!1)},L=ce!=="all";return E?e.jsx("div",{style:he.browser,children:e.jsx("div",{style:he.loading,children:"Loading..."})}):e.jsx(e.Fragment,{children:e.jsxs("div",{style:x?he.browserWrapper:he.browserWrapperNoContainer,children:[z==="adversaries"&&e.jsxs(e.Fragment,{children:[e.jsx(Ir,{searchTerm:T,onSearchChange:xe,type:t,partyControls:K,autoFocus:Se,onClose:O,placeholder:ve}),!$&&e.jsx(Er,{showCustomToggle:ge,onToggleCustom:Z,filterCustom:Q,onExportCustomAdversaries:Be,onImportCustomAdversaries:Le}),e.jsx("div",{className:"browser-content invisible-scrollbar",style:he.browserContent,children:e.jsxs("table",{style:he.browserTable,children:[e.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,backgroundColor:"var(--bg-primary)"},children:e.jsx(Ar,{sortFields:_,onSort:V,type:t,uniqueTiers:_e,uniqueTypes:qe,selectedTiers:I,selectedTypes:re,showTierDropdown:te,setShowTierDropdown:Ie,showTypeDropdown:je,setShowTypeDropdown:Ee,tierFilterRef:Ce,typeFilterRef:ze,handleTierSelect:Ve,handleTypeSelect:Qe,isTierFiltered:Ge,isTypeFiltered:Ue,getDropdownStyle:Xe,costFilter:ce,showCostDropdown:ke,setShowCostDropdown:Me,costFilterRef:a,handleCostFilterSelect:c,isCostFiltered:L})}),e.jsx("tbody",{children:l.map((i,y)=>e.jsx(Tr,{item:i,onAdd:o,type:t,onRowClick:d,encounterItems:k,pcCount:f,playerTier:b,remainingBudget:s,costFilter:ce,isFocused:G===i.id||C===y,onDeleteCustomAdversary:t==="adversary"?r:null,isDeleteConfirmed:p[i.id]||!1,rowRef:B=>{B?be.current[y]=B:delete be.current[y]}},i.id))})]})})]}),z==="encounters"&&e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:R.length===0?e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",textAlign:"center",padding:"2rem 1rem"},children:"No saved encounters yet"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:R.map(i=>e.jsxs("div",{onClick:()=>F&&F(i.id),className:"saved-encounter-card",style:{border:"1px solid var(--border)",borderRadius:"8px",padding:"8px",backgroundColor:"var(--bg-card)",transition:"background-color 0.2s ease",display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsxs("div",{style:{minWidth:"100px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",flexDirection:"column",justifyContent:"center",minHeight:"60px"},children:[e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Tier: ",(()=>{var ne,W,le,pe;const y=((pe=(le=(W=(ne=i.encounterItems)==null?void 0:ne.filter(P=>P.type==="adversary"))==null?void 0:W.map(P=>P.item.tier))==null?void 0:le.filter(P=>P!=null))==null?void 0:pe.sort((P,q)=>P-q))||[];if(y.length===0)return"N/A";if(y.length===1)return y[0];const B=[...new Set(y)];return B.length===1?B[0]:`${Math.min(...B)}-${Math.max(...B)}`})()]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Party Size: ",i.partySize||4]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)"},children:["Balance: ",(()=>{const y=i.partySize||4,B=3*y+2;let ne=0;const W=i.encounterItems||[];W.filter(oe=>oe.type==="adversary"&&oe.item.type==="Solo"&&oe.quantity>0).reduce((oe,se)=>oe+se.quantity,0)>=2&&(ne+=pt.twoOrMoreSolos);const pe=W.some(oe=>oe.type==="adversary"&&oe.item.type==="Bruiser"&&oe.quantity>0),P=W.some(oe=>oe.type==="adversary"&&oe.item.type==="Horde"&&oe.quantity>0),q=W.some(oe=>oe.type==="adversary"&&oe.item.type==="Leader"&&oe.quantity>0),D=W.some(oe=>oe.type==="adversary"&&oe.item.type==="Solo"&&oe.quantity>0);!pe&&!P&&!q&&!D&&(ne+=pt.noBruisersHordesLeadersSolos);const Ae=B+ne,we=W.reduce((oe,se)=>{if(se.type==="adversary"){const We=ut[se.item.type]||2;if(se.item.type==="Minion"){const ue=Math.ceil(se.quantity/y);return oe+ue*We}else return oe+se.quantity*We}return oe},0);return we>Ae?`+${we-Ae}`:we===Ae?"0":`-${Ae-we}`})()]})]}),e.jsx("div",{style:{minWidth:"120px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",alignItems:"center",minHeight:"60px"},children:e.jsx("div",{style:{fontWeight:"500",color:"var(--text-primary)",fontSize:"0.9rem",wordWrap:"break-word",wordBreak:"break-word",width:"150px",maxWidth:"150px"},children:i.name})}),e.jsx(Cr,{encounter:i}),e.jsx("button",{onClick:y=>{y.stopPropagation(),M(i.id)},style:{background:Ne[i.id]?"var(--danger)":"var(--gray-600)",border:"none",color:"white",padding:"0.4rem 0.8rem",borderRadius:"4px",fontSize:"0.75rem",cursor:"pointer",minWidth:"60px",transition:"background-color 0.2s"},children:"Delete"})]},i.id))})}),z==="create"&&e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"1rem",display:"flex",justifyContent:"center",alignItems:"flex-start",height:"100%",minHeight:0},children:e.jsx("div",{style:{maxWidth:"600px",width:"100%",height:"auto",display:"flex",flexDirection:"column",padding:"0",overflowY:"visible",overflowX:"hidden",minHeight:0},children:e.jsx(Mt,{onSave:n,onRefresh:()=>{},onAddItem:o,editingAdversary:Y,onCancelEdit:Fe,embedded:!1})})}),z==="info"&&e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"2rem"},children:[e.jsxs("div",{style:{marginBottom:"2rem",textAlign:"center"},children:[e.jsx("img",{src:wr,alt:"Daggerheart Community Content Logo",style:{width:"100%",maxWidth:"300px",height:"auto",margin:"0 auto 1.5rem auto",display:"block"},onError:i=>{console.error("Failed to load Daggerheart logo:",i.target.src),i.target.style.display="none"}}),e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",textAlign:"left",maxWidth:"600px",margin:"0 auto"},children:[e.jsx("p",{style:{marginTop:0},children:"This product includes materials from the Daggerheart System Reference Document 1.0, © Critical Role, LLC, under the terms of the Darrington Press Community Gaming (DPCGL) License."}),e.jsxs("p",{children:["More information can be found at ",e.jsx("a",{href:"https://www.daggerheart.com",target:"_blank",rel:"noopener noreferrer",style:{color:"var(--purple)",textDecoration:"underline"},children:"daggerheart.com"})]}),e.jsx("p",{style:{marginBottom:0},children:e.jsx("em",{children:"This project is unofficial and not endorsed by Darrington Press or Critical Role."})})]})]}),e.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto",border:"1px solid var(--border)",borderRadius:"8px",overflow:"hidden"},children:[e.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"1rem 1.5rem",color:"var(--text-primary)",border:"none",background:"var(--bg-secondary)",width:"100%",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"0.875rem",borderBottom:"1px solid var(--border)"},onMouseEnter:i=>{i.target.style.backgroundColor="var(--bg-hover)"},onMouseLeave:i=>{i.target.style.backgroundColor="var(--bg-secondary)"},onClick:i=>{i.stopPropagation(),window.open("https://github.com/Splinter714/Daggerheart","_blank")},children:[e.jsx("span",{children:"View on GitHub"}),e.jsx("span",{children:"→"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem 1.5rem",color:"var(--text-secondary)",background:"var(--bg-secondary)",fontSize:"0.875rem"},children:["Version ","0.4.13 (188035f)"]})]})]})]})})},he={browserWrapper:{display:"flex",flexDirection:"column",background:"var(--bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border)",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserWrapperNoContainer:{display:"flex",flexDirection:"column",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserContent:{flex:1,overflowY:"auto",overflowX:"visible",padding:0,width:"100%",scrollbarWidth:"none",msOverflowStyle:"none",borderRadius:"0 0 8px 8px"},tableHeaderContainer:{flexShrink:0,position:"sticky",top:0,zIndex:15,backgroundColor:"var(--bg-secondary)"},browserTable:{width:"100%",minWidth:"100%",borderCollapse:"collapse",tableLayout:"fixed",background:"var(--bg-primary)",margin:0},browserHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--gray-900)",flexShrink:0,position:"sticky",top:0,zIndex:20},browserTitle:{margin:0,color:"var(--text-primary)",fontSize:"18px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"24px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",marginRight:"12px",transition:"all 0.2s ease"},partyControls:{display:"flex",alignItems:"center",gap:"12px",flexShrink:0},searchInputFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 3px rgba(139, 92, 246, 0.1)"},tableHeader:{background:"var(--gray-900)",borderBottom:"1px solid var(--border)",boxShadow:"0 1px 0 var(--border)",position:"sticky",top:"0",zIndex:10},tableHeaderCell:{backgroundColor:"var(--gray-900)",fontWeight:"700",borderBottom:"1px solid var(--border)",cursor:"pointer",userSelect:"none",minWidth:"100px",whiteSpace:"nowrap",padding:"4px 4px",color:"var(--text-primary)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",boxShadow:"0 1px 0 var(--border)",transition:"background-color 0.2s",position:"sticky",top:"0",zIndex:10},tableHeaderCellHover:{backgroundColor:"var(--bg-hover)"},sortIndicator:{fontSize:"12px",color:"var(--text-secondary)"},tableBody:{flex:1,overflowY:"auto",padding:"8px",backgroundColor:"var(--bg-primary)"},row:{height:"auto",minHeight:"35px",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s ease",cursor:"pointer",backgroundColor:"var(--gray-900)"},rowHover:{backgroundColor:"var(--bg-secondary)"},rowFocused:{backgroundColor:"var(--bg-secondary)",boxShadow:"inset 0 0 0 2px var(--purple)"},expandedRow:{backgroundColor:"var(--bg-secondary)"},rowCell:{padding:"4px 4px",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid var(--border)"},rowCellName:{fontWeight:"500",minWidth:"150px"},rowCellCenter:{textAlign:"center",justifyContent:"center",minWidth:"80px"},rowActions:{width:"80px",textAlign:"center",padding:"4px 8px",borderBottom:"1px solid var(--border)"},addButton:{width:"2rem",height:"2rem",border:"1px solid var(--purple)",borderRadius:"var(--radius-sm)",background:"var(--purple)",color:"white",cursor:"pointer",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"500"},expandedContent:{padding:"0",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)"},columnName:{width:"auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",paddingLeft:"8px",textAlign:"left"},columnTier:{width:"80px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnType:{width:"100px",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},columnDifficulty:{width:"40px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnAction:{width:"32px",minWidth:"24px",maxWidth:"24px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"visible",textOverflow:"unset"},loading:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"var(--text-primary)",fontSize:"16px"},mobileBrowser:{width:"95vw",height:"90vh",maxWidth:"none"},mobileSearchInput:{fontSize:"16px"},headerWithFilter:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0px",position:"relative"},headerFilterIcon:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"2px 4px",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",position:"relative",marginLeft:"-2px"},headerFilterIconActive:{color:"var(--purple)"},filterIcon:{fontSize:"12px"},filterActiveDot:{position:"absolute",left:"50%",top:"2px",transform:"translateX(-50%)",width:"4px",height:"4px",borderRadius:"50%",background:"var(--purple)",pointerEvents:"none"},filterDropdown:{position:"fixed",background:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",zIndex:99999,marginTop:"4px",overflow:"hidden",width:"max-content",minWidth:"120px",maxWidth:"200px"},filterOption:{padding:"8px 12px",cursor:"pointer",color:"var(--text-primary)",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background-color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},filterOptionSelected:{backgroundColor:"var(--bg-hover)"},checkIcon:{width:"16px",height:"16px",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"12px"},filterLabel:{flex:1}},Mr=()=>e.jsx("div",{className:"pwa-install-prompt",style:{}}),Ct=({side:t="left",children:o,className:m="",style:d={}})=>{const k=t==="left",f={flex:1,minWidth:0,background:"var(--bg-primary)",overflowY:"auto",overflowX:k?"auto":"hidden",display:k?"block":"flex",flexDirection:k?"initial":"column",height:"100%",padding:k?"8px 0 8px 0":"0 8px 0 0",...d};return e.jsx("div",{className:m,style:f,children:o})},Rr=t=>3*t+2,Wr={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},jt={lessDifficult:-1,twoOrMoreSolos:-2,increasedDamage:-2,lowerTierAdversary:1,noBruisersHordesLeadersSolos:1,moreDangerous:2},zr=({isOpen:t,onClose:o,onAddAdversary:m,onAddAdversariesBulk:d,onAddEnvironment:k,onDeleteAdversary:f,onDeleteEnvironment:b,onDeleteCountdown:K,adversaries:x=[],environments:R=[],countdowns:F=[],savedEncounters:g=[],onSaveEncounter:z,onLoadEncounter:j,onDeleteEncounter:J})=>{const{partySize:me,updatePartySize:ae,currentEncounterName:de,updateCurrentEncounterName:Q,customContent:ge}=Tt(),Z=me,ye=ae,[fe,Se]=u.useState({lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),[$,O]=u.useState([]),[ve,Te]=u.useState(de||"Encounter"),[ie,A]=u.useState("adversaries"),[S,ee]=u.useState(null),[U,Y]=u.useState(null),[Re,ce]=u.useState(null),[H,ke]=u.useState(null),[Me,Ne]=u.useState(!1);u.useEffect(()=>{t&&!S&&Te(de||"Encounter")},[t,S,de]);const He=()=>U?ve!==U.name||JSON.stringify($)!==JSON.stringify(U.encounterItems)||Z!==U.partySize||JSON.stringify(fe)!==JSON.stringify(U.battlePointsAdjustments):!1,p=()=>{var l;if($.length>0||(ve||"").trim()!=="Encounter")return!0;if(S&&He()){if(U){const E=$.length,I=((l=U.encounterItems)==null?void 0:l.length)||0;if(E!==I||(ve||"").trim()!==(U.name||""))return!0;const re=JSON.stringify(fe),te=JSON.stringify(U.battlePointsAdjustments||{});return re!==te}return!0}return!1},v=({onClick:l,children:E,variant:I="secondary",isConfirmation:re=!1})=>{const te=I==="danger"||I==="secondary"&&re,Ie=I==="purple";return e.jsx("button",{onClick:l,style:{background:te?"var(--danger)":Ie?"var(--purple)":"var(--bg-secondary)",border:Ie?"none":"1px solid var(--border)",color:te||Ie?"white":"var(--text-primary)",padding:"0.375rem 0.75rem",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s",width:"70px",fontSize:"0.875rem"},children:E})},w=nt.useRef(Z),h=u.useCallback(l=>!l||l.length===0?null:g.find(I=>{var je,Ee;if(((je=I.encounterItems)==null?void 0:je.length)!==l.length)return!1;const re=Ce=>{var ze;return{type:Ce.type,quantity:Ce.quantity,item:{name:Ce.item.baseName||((ze=Ce.item.name)==null?void 0:ze.replace(/\s+\(\d+\)$/,""))||Ce.item.name,type:Ce.item.type,tier:Ce.item.tier}}},te=(Ee=I.encounterItems)==null?void 0:Ee.map(re).sort((Ce,ze)=>Ce.item.name.localeCompare(ze.item.name)||Ce.item.type.localeCompare(ze.item.type)),Ie=l.map(re).sort((Ce,ze)=>Ce.item.name.localeCompare(ze.item.name)||Ce.item.type.localeCompare(ze.item.type));return JSON.stringify(te)===JSON.stringify(Ie)})||null,[g]);nt.useEffect(()=>{if(t&&x.length>0&&$.length===0){const l={};x.forEach(re=>{var Ie;const te=re.baseName||((Ie=re.name)==null?void 0:Ie.replace(/\s+\(\d+\)$/,""))||re.name;l[te]||(l[te]={type:"adversary",item:re,quantity:0}),l[te].quantity+=1});const E=Object.values(l);O(E);const I=h(E);I&&!S&&(ee(I.id),Y({name:I.name||"",encounterItems:I.encounterItems||[],partySize:I.partySize||4,battlePointsAdjustments:I.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),Te(I.name||"Encounter"),Q(I.name||"Encounter"))}else t&&x.length===0&&$.length===0&&O([])},[t,h,S,Q]);const a=nt.useMemo(()=>{let l=0;$.filter(je=>je.type==="adversary"&&je.item.type==="Solo"&&je.quantity>0).reduce((je,Ee)=>je+Ee.quantity,0)>=2&&(l+=jt.twoOrMoreSolos);const I=$.some(je=>je.type==="adversary"&&je.item.type==="Bruiser"&&je.quantity>0),re=$.some(je=>je.type==="adversary"&&je.item.type==="Horde"&&je.quantity>0),te=$.some(je=>je.type==="adversary"&&je.item.type==="Leader"&&je.quantity>0),Ie=$.some(je=>je.type==="adversary"&&je.item.type==="Solo"&&je.quantity>0);return!I&&!re&&!te&&!Ie&&(l+=jt.noBruisersHordesLeadersSolos),l},[$]),C=Rr(Z),N=Object.entries(fe).filter(([l,E])=>E).reduce((l,[E,I])=>l+jt[E],0),G=C+N+a,X=$.reduce((l,E)=>{if(E.type==="adversary"){const I=Wr[E.item.type]||2;return E.item.type==="Minion"?l+Math.ceil(E.quantity/Z)*I:l+I*E.quantity}return l},0);nt.useEffect(()=>{const l=w.current;l!==Z&&(O(E=>E.map(I=>{if(I.type==="adversary"&&I.item.type==="Minion"){const te=Math.ceil(I.quantity/l)*Z;return{...I,quantity:te}}return I})),w.current=Z)},[Z]);const be=(l,E)=>{const I=$.findIndex(Ie=>Ie.item.id===l.id&&Ie.type===E),re=l.type==="Minion"?Z:1;let te;I>=0?te=$.map((Ie,je)=>je===I?{...Ie,quantity:Ie.quantity+re}:Ie):te=[...$,{item:l,type:E,quantity:re}],O(te),Be(te)},Be=l=>{const E=x||[],I=[];l.forEach(Ee=>{for(let Ce=0;Ce<Ee.quantity;Ce++)Ee.type==="adversary"&&I.push(Ee.item)});const re={};E.forEach(Ee=>{var ze;const Ce=Ee.baseName||((ze=Ee.name)==null?void 0:ze.replace(/\s+\(\d+\)$/,""))||Ee.name;re[Ce]||(re[Ce]=[]),re[Ce].push(Ee)});const te={};I.forEach(Ee=>{var ze;const Ce=Ee.baseName||((ze=Ee.name)==null?void 0:ze.replace(/\s+\(\d+\)$/,""))||Ee.name;te[Ce]||(te[Ce]=[]),te[Ce].push(Ee)});const Ie=[],je=[];Object.keys(te).forEach(Ee=>{var _e;const Ce=((_e=re[Ee])==null?void 0:_e.length)||0,ze=te[Ee].length;if(ze>Ce){const qe=ze-Ce;for(let Ve=0;Ve<qe;Ve++)Ie.push(te[Ee][0])}else if(ze<Ce){const qe=Ce-ze,Qe=[...re[Ee]].sort((Ge,Ue)=>{const Xe=Ge.duplicateNumber||1;return(Ue.duplicateNumber||1)-Xe});for(let Ge=0;Ge<qe;Ge++)je.push(Qe[Ge].id)}}),Object.keys(re).forEach(Ee=>{te[Ee]||[...re[Ee]].sort((_e,qe)=>{const Ve=_e.duplicateNumber||1;return(qe.duplicateNumber||1)-Ve}).forEach(_e=>{je.push(_e.id)})}),je.forEach(Ee=>{f(Ee)}),Ie.length>0&&d(Ie)},Le=(l,E)=>{const I=(()=>{const re=$.findIndex(te=>te.item.id===l&&te.type===E);if(re>=0){const te=$[re];if(te.quantity===0)return $.filter((Ee,Ce)=>Ce!==re);const Ie=te.item.type==="Minion"?Z:1,je=Math.max(0,te.quantity-Ie);return $.map((Ee,Ce)=>Ce===re?{...Ee,quantity:je}:Ee)}return $})();O(I),Be(I)},Fe=u.useCallback(()=>{if($.length===0)return null;const l=(ve||"").trim()||"Encounter",E=g.find(I=>{var Ie,je;if(I.name!==l||((Ie=I.encounterItems)==null?void 0:Ie.length)!==$.length)return!1;const re=JSON.stringify((je=I.encounterItems)==null?void 0:je.sort()),te=JSON.stringify([...$].sort());return re===te});return(E==null?void 0:E.id)||null},[g,ve,$]),n=u.useCallback(()=>{let l=(ve||"").trim(),E=S;if(E||(E=Fe()),$.length===0&&(!l||l==="Encounter")&&E){J(E),ee(null),Y(null);return}const I={name:l,encounterItems:$,partySize:Z,battlePointsAdjustments:fe};if(E){I.id=E;const re=z(I);ee(re)}else{const re=z(I);ee(re)}Y({name:l,encounterItems:$,partySize:Z,battlePointsAdjustments:fe})},[$,ve,Z,fe,S,z,Fe,J]);u.useEffect(()=>{if(S&&He()){const l=setTimeout(()=>{n()},2e3);return()=>clearTimeout(l)}else if(!S&&$.length>0&&ve&&ve.trim()!==""){const l=setTimeout(()=>{n()},2e3);return()=>clearTimeout(l)}},[$,S,ve,fe,Z]);const M=()=>{p()&&(O([]),Te("Encounter"),Q("Encounter"),ee(null),Y(null),x.forEach(l=>{f(l.id)}),R.forEach(l=>{b(l.id)}),F.forEach(l=>{K(l.id)}))},r=l=>{const E=j(l);if(E){const I=E.encounterItems||[];O(I),ye(E.partySize||4),Se(E.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),Te(E.name||""),Q(E.name||""),ee(l),Y({name:E.name||"",encounterItems:E.encounterItems||[],partySize:E.partySize||4,battlePointsAdjustments:E.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),Be(I)}},T=l=>{J(l),S===l&&(O([]),Te("Encounter"),Q("Encounter"),ee(null),Y(null),x.forEach(E=>{f(E.id)}),R.forEach(E=>{b(E.id)}),F.forEach(E=>{K(E.id)}))},xe=()=>{try{const l={version:"1.0",exportDate:new Date().toISOString(),customAdversaries:ge.adversaries||[]},E=JSON.stringify(l,null,2),I=new Blob([E],{type:"application/json"}),re=URL.createObjectURL(I),te=document.createElement("a");te.href=re,te.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(te),te.click(),document.body.removeChild(te),URL.revokeObjectURL(re),console.log("Custom adversaries exported successfully")}catch(l){console.error("Failed to export custom adversaries:",l),alert("Failed to export custom adversaries. Please try again.")}},_=l=>{const E=l.target.files[0];if(!E)return;const I=new FileReader;I.onload=re=>{try{const te=JSON.parse(re.target.result);if(!te.customAdversaries||!Array.isArray(te.customAdversaries))throw new Error("Invalid file format. Expected customAdversaries array.");const Ie=ge.adversaries||[],je=te.customAdversaries,Ee=[...Ie];let Ce=0;je.forEach(ze=>{Ie.some(qe=>qe.name===ze.name&&qe.type===ze.type)||(Ee.push({...ze,id:`custom-${Date.now()}-${Math.random().toString(36).slice(2,10)}`}),Ce++)}),updateCustomContent("adversary",null,Ee),Ce>0?alert(`Successfully imported ${Ce} custom adversaries.`):alert("No new adversaries were added. All imported adversaries already exist.")}catch(te){console.error("Failed to import custom adversaries:",te),alert("Failed to import custom adversaries. Please check the file format and try again.")}},I.readAsText(E),l.target.value=""};if(!t)return null;const V=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://");return e.jsx("div",{onClick:o,className:"encounter-builder-modal",style:{position:"fixed",top:0,left:0,right:0,bottom:V?"calc(60px + env(safe-area-inset-bottom) + 1rem)":"calc(60px + env(safe-area-inset-bottom))",backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:1e3,display:"flex",alignItems:"flex-start",justifyContent:"center",padding:"12px"},children:e.jsxs("div",{onClick:l=>l.stopPropagation(),style:{backgroundColor:"var(--bg-primary)",border:"2px solid var(--border)",borderRadius:"12px",width:"100%",maxWidth:"1200px",height:"100%",maxHeight:"100%",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"},children:[e.jsxs("div",{className:"encounter-top-bar",style:{flex:"0 0 auto",display:"flex",alignItems:"center",height:"39px",backgroundColor:"var(--bg-primary)",borderBottom:"1px solid var(--border)"},children:[e.jsx("button",{onClick:()=>A("adversaries"),style:{flex:1,background:ie==="adversaries"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:ie==="adversaries"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Builder"}),e.jsx("button",{onClick:()=>A("encounters"),style:{flex:1,background:ie==="encounters"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:ie==="encounters"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Saved Encounters"}),e.jsx("button",{onClick:()=>A("create"),style:{flex:1,background:ie==="create"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:ie==="create"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Create Adversary"}),e.jsx("button",{onClick:()=>A("info"),style:{flex:1,background:ie==="info"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:ie==="info"?"500":"400",transition:"all 0.2s ease",position:"relative"},children:"Info"})]}),e.jsxs("div",{className:"encounter-builder-content",style:{flex:1,display:"flex",overflow:"hidden"},children:[e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",borderTop:"1px solid var(--border)"},children:e.jsx(Jt,{type:"adversary",onAddItem:l=>be(l,"adversary"),encounterItems:$,pcCount:Z,showContainer:!1,savedEncounters:g,onLoadEncounter:r,onDeleteEncounter:T,activeTab:ie,selectedCustomAdversaryId:Re,onSelectCustomAdversary:ce,onTabChange:A,selectedAdversary:H,onSelectAdversary:ke,filterCustom:Me,showCustomToggle:!0,onToggleCustom:Ne,onExportCustomAdversaries:xe,onImportCustomAdversaries:_})}),ie!=="info"&&e.jsxs("div",{className:"encounter-right-panel",style:{flex:1,borderLeft:"1px solid var(--border)",display:"flex",flexDirection:"column",overflow:"hidden",position:"relative"},children:[H&&e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"var(--bg-primary)",zIndex:10,display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)",flexShrink:0},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:0},children:"Adversary Preview"}),e.jsx("button",{onClick:()=>ke(null),style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease"},onMouseEnter:l=>l.target.style.color="var(--text-primary)",onMouseLeave:l=>l.target.style.color="var(--text-secondary)",title:"Close preview",children:e.jsx(at,{size:16})})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"0.75rem"},children:e.jsx(ft,{item:{...H,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...H,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}})})]}),(ie==="adversaries"||ie==="encounters")&&e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-primary)",flexShrink:0},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:ve,onChange:l=>{Te(l.target.value),Q(l.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(v,{onClick:M,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:p()?1:.5,cursor:p()?"pointer":"not-allowed"},children:"New"})]})}),(ie==="adversaries"||ie==="encounters")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"encounter-receipt-buttons-vertical",style:{display:"none",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:ve,onChange:l=>{Te(l.target.value),Q(l.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(v,{onClick:M,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:p()?1:.5,cursor:p()?"pointer":"not-allowed"},children:"New"})]})}),e.jsx("div",{className:"receipt-content",style:{padding:"1rem",display:"flex",flexDirection:"column",height:"100%"},children:e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"flex-start",overflowY:"auto",marginBottom:"0.75rem"},children:[e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>ye(Math.max(1,Z-1)),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(mt,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:Z}),e.jsx("button",{onClick:()=>ye(Z+1),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(it,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Party Size"})}),e.jsx("div",{style:{width:"120px",textAlign:"right"}})]}),$.map(l=>{var E;return l.type!=="adversary"?null:e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>Le(l.item.id,l.type),style:{background:l.quantity===0?"var(--danger)":"var(--bg-secondary)",border:l.quantity===0?"none":"1px solid var(--border)",color:l.quantity===0?"white":"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:l.quantity===0?e.jsx(at,{size:10}):e.jsx(mt,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:l.quantity}),e.jsx("button",{onClick:()=>be(l.item,l.type),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(it,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:l.item.baseName||((E=l.item.name)==null?void 0:E.replace(/\s+\(\d+\)$/,""))||l.item.name})}),e.jsx("div",{style:{width:"80px",textAlign:"right"},children:e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.8rem"},children:l.item.type})})]},`${l.item.id}-${l.type}`)}),e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Balance"})}),e.jsx("div",{style:{width:"120px",textAlign:"right",display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsx("span",{style:{color:X>G?"var(--danger)":X===G?"var(--purple)":"var(--success)",fontWeight:600},children:X>G?`+${X-G}`:G-X===0?"0":`-${G-X}`})})]})]})})]}),ie==="create"&&e.jsxs("div",{style:{padding:"1.5rem",overflowY:"auto",height:"100%"},children:[e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Creating Adversaries"}),e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsx("p",{children:"Use the form to create custom adversaries for your encounters."}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Adversary Types:"}),e.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Minion (1 BP):"})," Weak enemies in groups"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Standard (2 BP):"})," Average threat level"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Leader (3 BP):"})," Commands others"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Bruiser (4 BP):"})," High HP tank"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Solo (5 BP):"})," Boss-level threat"]})]})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Tips:"}),e.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[e.jsx("li",{children:"Match adversary tier to party level"}),e.jsx("li",{children:"Balance encounter difficulty with Battle Points"}),e.jsx("li",{children:"Mix adversary types for variety"}),e.jsx("li",{children:"Add features that create interesting choices"})]})]})]})]}),ie==="myAdversaries"&&e.jsx("div",{style:{padding:"0.75rem",overflowY:"auto",height:"100%"},children:Re?(()=>{var E;const l=(E=ge==null?void 0:ge.adversaries)==null?void 0:E.find(I=>I.id===Re);return l?e.jsx(ft,{item:{...l,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...l,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}}):e.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Adversary not found"})})():e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Adversary Preview"}),e.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Select an adversary to view details"})]})})]})]})]})})},Nr=({browserOpenAtPosition:t,handleCloseBrowser:o,handleOpenBrowser:m,getEntityGroups:d,fear:k,updateFear:f})=>{const b=u.useRef(!1),K=u.useRef(null),x=u.useRef(null),R=u.useMemo(()=>({"shift+space":()=>{if(t!==null)o();else{const g=d();m(g.length)}},escape:()=>{t!==null&&o()},"+":()=>{const g=(k==null?void 0:k.value)||0,z=Math.min(12,g+1);f(z)},"=":()=>{const g=(k==null?void 0:k.value)||0,z=Math.min(12,g+1);f(z)},"-":()=>{const g=(k==null?void 0:k.value)||0,z=Math.max(0,g-1);f(z)},_:()=>{const g=(k==null?void 0:k.value)||0,z=Math.max(0,g-1);f(z)}}),[t,o,m,d,k,f]),F=u.useCallback(g=>{var Z;if(window.matchMedia("(max-width: 800px)").matches)return;const j=g.key===" "||g.key==="Space"||g.code==="Space";if(g.shiftKey&&j&&!g.ctrlKey&&!g.metaKey&&!g.altKey){if(console.log("[Keyboard] Shift+Space detected, toggling browser"),g.preventDefault(),g.stopPropagation(),g.stopImmediatePropagation(),t!==null)o();else{const ye=d();m(ye.length)}return}const me=document.activeElement;if(me&&["INPUT","TEXTAREA","SELECT"].includes(me.tagName)){const ye=g.key==="Escape",fe=g.shiftKey&&j&&!g.ctrlKey&&!g.metaKey&&!g.altKey;if(!ye&&!fe)return}const de=[];(g.ctrlKey||g.metaKey)&&de.push("ctrl"),g.shiftKey&&de.push("shift"),g.altKey&&de.push("alt");let Q=g.key.toLowerCase();Q===" "&&(Q="space"),de.push(Q);const ge=de.join("+");if(R[ge]){g.preventDefault(),R[ge](g);return}if(!g.ctrlKey&&!g.metaKey&&!g.shiftKey&&!g.altKey&&R[Q]){g.preventDefault(),R[Q](g);return}if(!g.ctrlKey&&!g.metaKey&&!g.shiftKey&&!g.altKey&&(g.key==="ArrowLeft"||g.key==="ArrowRight")){const ye=document.activeElement;if(ye&&["INPUT","TEXTAREA","SELECT"].includes(ye.tagName))return;const fe=document.querySelector(".dashboard-scroll-container");if(fe){g.preventDefault(),console.log("[Keyboard] Dashboard scroll requested:",{key:g.key,currentScrollLeft:fe.scrollLeft,containerWidth:fe.clientWidth,scrollWidth:fe.scrollWidth,scrollInProgress:b.current,browserOpen:t!==null});const Se=Array.from(fe.children).filter($=>getComputedStyle($).scrollSnapAlign!=="none");if(console.log("[Keyboard] Found panels:",{totalPanels:Se.length,panelDetails:Se.map(($,O)=>({index:O,offsetLeft:$.offsetLeft,offsetWidth:$.offsetWidth,scrollSnapAlign:getComputedStyle($).scrollSnapAlign}))}),Se.length>0){const $=fe.scrollLeft;let O=0,ve=1/0;Se.forEach((A,S)=>{const ee=A.offsetLeft,U=Math.abs(ee-$);U<ve&&(ve=U,O=S)}),console.log("[Keyboard] Panel detection:",{currentScroll:$,currentPanelIndex:O,currentPanelOffsetLeft:(Z=Se[O])==null?void 0:Z.offsetLeft,minDistance:ve,allPanels:Se.map((A,S)=>({index:S,offsetLeft:A.offsetLeft,distance:Math.abs(A.offsetLeft-$)}))});const Te=g.key==="ArrowLeft"?-1:1,ie=O+Te;if(console.log("[Keyboard] Scrolling decision:",{scrollDirection:Te,currentPanelIndex:O,nextPanelIndex:ie,canScroll:ie>=0&&ie<Se.length}),ie>=0&&ie<Se.length){const A=Se[ie],S=A.offsetLeft;console.log("[Keyboard] Scrolling to panel:",{index:ie,offsetLeft:A.offsetLeft,offsetWidth:A.offsetWidth,targetScrollPosition:S,currentScroll:$,scrollInProgress:b.current}),K.current&&(clearTimeout(K.current),K.current=null),x.current=ie,b.current?(console.log("[Keyboard] Redirecting scroll to new target",{previousTarget:x.current,newTarget:ie,targetScrollPosition:S}),fe.scrollTo({left:S,behavior:"smooth"})):(b.current=!0,A.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"})),K.current=setTimeout(()=>{if(x.current===ie){const ee=fe.scrollLeft,U=A.offsetLeft,Y=Math.abs(ee-U);Y>.5&&(console.log("[Keyboard] Correcting misalignment:",{finalScroll:ee,expectedScroll:U,misalignment:Y}),fe.scrollTo({left:U,behavior:"auto"})),b.current=!1,x.current=null,console.log("[Keyboard] Scroll after action:",{newScrollLeft:fe.scrollLeft,targetScrollPosition:S,difference:fe.scrollLeft-$,actualDifference:fe.scrollLeft-S,misalignment:Y})}K.current=null},600)}else console.log("[Keyboard] Cannot scroll - panel index out of bounds")}else{console.log("[Keyboard] No panels found, using fallback scroll");const $=fe.firstElementChild;if($){const O=$.offsetWidth,ve=g.key==="ArrowLeft"?-1:1;fe.scrollBy({left:O*ve,behavior:"smooth"})}}}else console.log("[Keyboard] Scroll container not found")}},[R,t,o,m,d]);u.useEffect(()=>(document.addEventListener("keydown",F,!0),()=>{document.removeEventListener("keydown",F,!0)}),[F])},Br=t=>3*t+2,Lr={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},$t={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1};class Pr extends nt.Component{constructor(o){super(o),this.state={hasError:!1,error:null}}static getDerivedStateFromError(o){return{hasError:!0,error:o}}componentDidCatch(o,m){console.error("ErrorBoundary caught an error:",o,m)}render(){var o;return this.state.hasError?e.jsxs("div",{className:"p-md text-red",children:[e.jsx("h3",{children:"Something went wrong:"}),e.jsx("pre",{children:(o=this.state.error)==null?void 0:o.toString()}),e.jsx("button",{className:"btn-base btn-text",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try again"})]}):this.props.children}}const Dr=()=>{const{adversaries:t,environments:o,countdowns:m,fear:d,savedEncounters:k,partySize:f,customContent:b,updatePartySize:K,updateFear:x,createAdversary:R,createAdversariesBulk:F,updateAdversary:g,deleteAdversary:z,addCustomAdversary:j,updateCustomAdversary:J,createEnvironment:me,updateEnvironment:ae,deleteEnvironment:de,createCountdown:Q,updateCountdown:ge,deleteCountdown:Z,advanceCountdown:ye,saveEncounter:fe,loadEncounter:Se,deleteEncounter:$}=Tt(),O=f||4,[ve,Te]=u.useState(!1),[ie,A]=u.useState(!1);u.useState(!1),u.useState(!1),u.useState(!0);const[S,ee]=u.useState(null),[U,Y]=u.useState(null),[Re,ce]=u.useState(null),[H,ke]=u.useState(!1),[Me,Ne]=u.useState("adversaries"),[He,p]=u.useState(null),[v,w]=u.useState(0),[h,a]=u.useState(0),[C,N]=u.useState(!1);u.useState(new Set);const[G,X]=u.useState(new Set),[be,Be]=u.useState(null),[Le,Fe]=u.useState(!1),n=u.useRef(null),M=u.useRef(O);u.useEffect(()=>{const s=M.current;if(s!==O&&s>0){const c={};t.forEach(L=>{var y;const i=L.baseName||((y=L.name)==null?void 0:y.replace(/\s+\(\d+\)$/,""))||L.name;c[i]||(c[i]={type:"adversary",baseName:i,instances:[]}),c[i].instances.push(L)}),Object.values(c).forEach(L=>{if(L.type==="adversary"&&L.instances.length>0){const i=L.instances[0];if(i.type==="Minion"){const y=L.instances.length,ne=Math.ceil(y/s)*O;if(ne!==y)if(ne>y){const W=ne-y,le=Array(W).fill(null).map(()=>({...i}));F(le)}else{const W=y-ne;L.instances.slice(-W).forEach(pe=>{z(pe.id)})}}}}),M.current=O}else(s===0||M.current===0)&&(M.current=O)},[O]),u.useEffect(()=>{const s=()=>{const L=window.matchMedia("(max-width: 800px)");Te(L.matches)};s();const c=window.matchMedia("(max-width: 800px)");return c.addEventListener("change",s),()=>c.removeEventListener("change",s)},[]);const r=12,T=s=>s===1?200:350,xe=s=>{if(s<=0)return{visibleColumns:1,columnWidth:T(1)};const c=r*2,L=s-c;let i={visibleColumns:1,columnWidth:L};for(let B=1;B<=5;B++){const ne=(B-1)*r,W=(L-ne)/B;W>=T(B)&&B*W+ne<=L&&(i={visibleColumns:B,columnWidth:W})}return i.visibleColumns*i.columnWidth+(i.visibleColumns-1)*r>L&&(i={visibleColumns:1,columnWidth:L}),i},{visibleColumns:_,columnWidth:V}=xe(v);u.useEffect(()=>{const s=()=>{w(window.innerWidth)};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]);const l=u.useCallback(()=>{A(!1)},[]),E=u.useCallback(s=>{if(n.current){const c=n.current,L=c.scrollLeft,i=c.scrollWidth-c.clientWidth,y=Math.abs(L-i)<1;console.log("[BROWSER_OPEN] Capturing scroll state:",{currentScroll:L,maxScroll:i,scrollWidth:c.scrollWidth,clientWidth:c.clientWidth,wasAtMaxScroll:y,position:s}),c._scrollBeforeBrowserOpen=L,c._scrollWidthBeforeOpen=c.scrollWidth,c._wasAtMaxScrollBeforeBrowserOpen=y}Y(s)},[]);u.useEffect(()=>{U!==null?console.log("[SPACER] Spacer added, dimensions:",{width:V+r,columnWidth:V,gap:r}):console.log("[SPACER] Spacer removed")},[U,V,r]),u.useEffect(()=>{n.current&&(n.current,console.log("[SCROLL_ADJUST] useEffect triggered, browserOpenAtPosition:",U,"columnWidth:",V,"gap:",r),U!==null?(console.log("[BROWSER_OPEN] useEffect triggered, waiting for DOM update..."),requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!n.current)return;const s=n.current,c=s._wasAtMaxScrollBeforeBrowserOpen,L=s._scrollBeforeBrowserOpen||0,i=s.scrollLeft,y=s.scrollWidth-s.clientWidth;console.log("[BROWSER_OPEN] After DOM update:",{wasAtMaxScroll:c,scrollBeforeOpen:L,currentScroll:i,newMaxScroll:y,scrollWidth:s.scrollWidth,clientWidth:s.clientWidth,scrollDelta:i-L,expectedSpacerWidth:V+r,actualWidthIncrease:s.scrollWidth-(s._scrollWidthBeforeOpen||s.scrollWidth)}),c?(console.log("[BROWSER_OPEN] Was at max scroll, maintaining position to prevent shift:",L),s.scrollLeft=L,console.log("[BROWSER_OPEN] After maintaining position, scrollLeft:",s.scrollLeft)):(console.log("[BROWSER_OPEN] Not at max scroll, maintaining position:",L),s.scrollLeft=L),delete s._scrollBeforeBrowserOpen,delete s._wasAtMaxScrollBeforeBrowserOpen})})):(console.log("[BROWSER_CLOSE] useEffect triggered, waiting for DOM update..."),requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!n.current)return;const s=n.current,c=s._scrollBeforeBrowserClose||0,L=s.scrollLeft,i=s.scrollWidth-s.clientWidth;console.log("[BROWSER_CLOSE] After DOM update:",{scrollBeforeClose:c,currentScroll:L,newMaxScroll:i,scrollWidth:s.scrollWidth,clientWidth:s.clientWidth,scrollDelta:L-c,expectedSpacerWidth:V+r,actualWidthDecrease:(s._scrollWidthBeforeClose||s.scrollWidth)-s.scrollWidth});const y=Math.min(c,i);console.log("[BROWSER_CLOSE] Setting scroll to:",y,"(min of",c,"and",i,")"),s.scrollLeft=y,console.log("[BROWSER_CLOSE] After adjustment, scrollLeft:",s.scrollLeft),delete s._scrollBeforeBrowserClose})})))},[U,V,r]);const I=u.useCallback(()=>{if(n.current){const s=n.current,c=s.scrollLeft,L=s.scrollWidth-s.clientWidth;console.log("[BROWSER_CLOSE] Capturing scroll state:",{currentScroll:c,maxScroll:L,scrollWidth:s.scrollWidth,clientWidth:s.clientWidth}),s._scrollBeforeBrowserClose=c,s._scrollWidthBeforeClose=s.scrollWidth}Y(null),Ne("adversaries")},[]),re=u.useCallback((s,c=500,L="unknown")=>{if(!n.current)return;const i=n.current,y=i.scrollLeft,B=s-y;if(Math.abs(B)<1)return;i._horizontalScrollAnimationId&&(cancelAnimationFrame(i._horizontalScrollAnimationId),i._horizontalScrollAnimationId=null);const W=window.getComputedStyle(i).scrollSnapType!=="none",le=W?"x mandatory":null;W&&(i.style.scrollSnapType="none");const pe=performance.now(),P=q=>{const D=q-pe,Ae=Math.min(D/c,1),we=1-Ae,oe=1-we*we*we;if(i){const se=y+B*oe;i.scrollLeft=se}Ae<1?i._horizontalScrollAnimationId=requestAnimationFrame(P):i&&(i.scrollLeft=s,i._horizontalScrollAnimationId=null)};return i._horizontalScrollAnimationId=requestAnimationFrame(P),()=>{animationId&&cancelAnimationFrame(animationId),W&&i&&(i.style.scrollSnapType=le||"")}},[]),te=u.useCallback(()=>{const s={};return t.forEach(c=>{var i;const L=c.baseName||((i=c.name)==null?void 0:i.replace(/\s+\(\d+\)$/,""))||c.name;s[L]||(s[L]={type:"adversary",baseName:L,instances:[]}),s[L].instances.push(c)}),m.forEach(c=>{s[`countdown-${c.id}`]={type:"countdown",baseName:c.name,instances:[c]}}),Object.values(s)},[t,m]),Ie=te();Nr({browserOpenAtPosition:U,handleCloseBrowser:I,handleOpenBrowser:E,getEntityGroups:te,fear:d,updateFear:x});const je=u.useCallback(s=>{var pe,P,q;const c=s.baseName||((pe=s.name)==null?void 0:pe.replace(/\s+\(\d+\)$/,""))||s.name,i=!Ie.find(D=>D.baseName===c&&D.type==="adversary"),y=s.type==="Minion",B=y?O:1;performance.now();const ne=((P=n.current)==null?void 0:P.scrollWidth)??0,W=((q=n.current)==null?void 0:q.scrollLeft)??0,le=n.current;if(le&&i&&window.getComputedStyle(le).scrollSnapType!=="none"&&(le.style.scrollSnapType="none"),y&&B>1){const D=Array(B).fill(null).map(()=>({...s}));F(D)}else R(s);if(ee("adversary"),i){const D=`adversary-${c}`;X(Ae=>new Set(Ae).add(D)),setTimeout(()=>{X(Ae=>{const we=new Set(Ae);return we.delete(D),we})},10)}setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!n.current)return;const D=n.current;if(!(D.scrollWidth<=D.clientWidth))if(i){const Ae=D.scrollWidth;setTimeout(()=>{if(!n.current)return;const we=n.current;if(we.scrollWidth!==Ae)requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!n.current)return;const se=n.current,We=se.scrollWidth-se.clientWidth;se.scrollLeft;const ue=We-W;se.scrollWidth>ne&&Math.abs(ue)<1?re(We+10,500,"new-adversary"):Math.abs(ue)>1&&re(We,500,"new-adversary")})});else{const se=we.scrollWidth-we.clientWidth;we.scrollLeft;const We=se-W;we.scrollWidth>ne&&Math.abs(We)<1?re(se+10,500,"new-adversary"):Math.abs(We)>1&&re(se,500,"new-adversary")}},10)}else{const we=te().findIndex(oe=>oe.baseName===c&&oe.type==="adversary");if(we>=0){const oe=n.current,se=oe.scrollLeft,We=oe.clientWidth,ue=U!==null?We-(V+r):We,Pe=we*(V+r),$e=Pe+V+r,Ye=10;Pe>=se-Ye&&$e<=se+ue+Ye||re(Pe,500)}}})})},50)},[R,Ie,V,r,re,te,U]),Ee=u.useCallback(()=>{const c="Standard",L=ct(1,c),i={name:"",baseName:"",tier:1,type:c,description:"",motives:"",difficulty:L.difficulty,thresholds:L.thresholds,hpMax:L.hpMax,stressMax:L.stressMax,atk:L.atk,weapon:"",range:L.range,damage:L.damage,experience:[],features:[],source:"Homebrew",hp:0,stress:0,isVisible:!0};R(i),setTimeout(()=>{const y=te();for(const B of y)if(B.type==="adversary"){const ne=B.instances.find(W=>W.source==="Homebrew"&&(!W.baseName||W.baseName.trim()===""||W.baseName==="Unknown"));if(ne&&!Re){ce(ne.id),requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(n.current){n.current;const W=y.findIndex(le=>le.instances.some(pe=>pe.id===ne.id));if(W>=0){const le=W*(V+r);re(le,600,"new-custom-adversary")}}})});break}}},100)},[R,te,V,r,re,Re]),Ce=u.useCallback(s=>{ce(s),ke(!1)},[]),ze=u.useCallback(()=>{ce(null),ke(!1)},[]),_e=u.useCallback(async(s,c)=>{var L,i;if(c){const y=t.find(ne=>ne.id===c);if((y==null?void 0:y.source)==="Homebrew"||(y==null?void 0:y.isCustom)){const ne=y==null?void 0:y.customContentId,W=y==null?void 0:y.baseName,le=ne?(L=b==null?void 0:b.adversaries)==null?void 0:L.find(pe=>pe.id===ne):(i=b==null?void 0:b.adversaries)==null?void 0:i.find(pe=>pe.baseName===W&&(pe.source==="Homebrew"||pe.isCustom));if(le){const pe={...s,name:s.baseName||s.name};J(le.id,pe);const P=s.baseName||(y==null?void 0:y.baseName);t.forEach(q=>{(q.customContentId===ne||q.baseName===P&&(q.source==="Homebrew"||q.isCustom))&&g(q.id,{...s,customContentId:le.id})})}else{const pe={...s,name:s.baseName||s.name},P=j(pe),q=s.baseName||(y==null?void 0:y.baseName);t.forEach(D=>{D.baseName===q&&(D.source==="Homebrew"||D.isCustom)&&g(D.id,{...s,customContentId:P})})}}else{const ne=y==null?void 0:y.baseName,W=t.filter(P=>{const q=P.baseName===ne,D=!P.source||P.source!=="Homebrew"&&!P.isCustom;return q&&D}),le={...s,name:s.baseName||s.name},pe=j(le);W.forEach(P=>{z(P.id)}),setTimeout(()=>{const P=W.map(()=>({...s,source:"Homebrew",isCustom:!0,customContentId:pe,hp:0,stress:0}));P.length>0&&F(P)},0)}ce(null)}else if(Re){const y={...s,name:s.baseName||s.name},B=j(y),ne=R({...s,source:"Homebrew",isCustom:!0,customContentId:B});return ce(null),ne}else{const y={...s,name:s.baseName||s.name},B=j(y),ne=R({...s,source:"Homebrew",isCustom:!0,customContentId:B});return ke(!1),ne}},[Re,t,b,R,g,j,J]),Ve=u.useCallback(()=>{const s={};return t.forEach(c=>{var i;const L=c.baseName||((i=c.name)==null?void 0:i.replace(/\s+\(\d+\)$/,""))||c.name;s[L]||(s[L]={type:"adversary",item:c,quantity:0}),s[L].quantity+=1}),Object.values(s)},[t])(),Qe=Br(O),Ge=Ve.filter(s=>s.item.type==="Solo"&&s.quantity>0).reduce((s,c)=>s+c.quantity,0),Ue=Ve.some(s=>s.item.type&&["Bruiser","Horde","Leader","Solo"].includes(s.item.type)&&s.quantity>0);let Xe=0;Ge>=2&&(Xe+=$t.twoOrMoreSolos),Ue||(Xe+=$t.noBruisersHordesLeadersSolos);const Ke=Qe+Xe,Je=Ve.reduce((s,c)=>{if(c.type==="adversary"){const L=Lr[c.item.type]||2;return c.item.type==="Minion"?s+Math.ceil(c.quantity/O)*L:s+L*c.quantity}return s},0),Ze=u.useRef(null),lt=u.useCallback(s=>{a(s.target.scrollLeft),Ze.current&&clearTimeout(Ze.current),Ze.current=setTimeout(()=>{const c=s.target;c&&c.style.scrollSnapType==="none"&&(c.style.scrollSnapType="x mandatory")},150)},[]);return u.useCallback(()=>{N(!0)},[]),u.useCallback(()=>{setTimeout(()=>N(!1),100)},[]),Ie.length,e.jsxs("div",{className:"app",onClick:s=>{s.target,s.currentTarget},children:[e.jsx(mr,{position:"top",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",width:"100%",justifyContent:"space-between",padding:"0 1rem"},children:[e.jsx(dt,{type:"fear",value:(d==null?void 0:d.value)||0,maxValue:12,onChange:x,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0}),e.jsx("button",{onClick:()=>{U!==null?I():E(Ie.length)},title:U!==null?"Close Browser":"Add Adversaries",style:{width:"36px",height:"36px",padding:0,backgroundColor:U!==null?"var(--purple)":"transparent",border:"1px solid var(--border)",borderRadius:"50%",color:U!==null?"white":"var(--text-primary)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",flexShrink:0},onMouseEnter:s=>{U===null&&(s.target.style.borderColor="var(--purple)",s.target.style.backgroundColor="var(--bg-secondary)")},onMouseLeave:s=>{U===null&&(s.target.style.borderColor="var(--border)",s.target.style.backgroundColor="transparent")},children:e.jsx(it,{size:18})})]})}),e.jsxs("div",{className:"main-content",style:{position:"relative",width:"100%"},children:[U!==null&&e.jsx("div",{style:{position:"absolute",top:`${r}px`,right:`${r}px`,bottom:`${r}px`,width:`${V}px`,zIndex:100,overflow:"visible"},children:e.jsx(Et,{tabContent:e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:Ee,style:{padding:"0.375rem 0.75rem",backgroundColor:"var(--purple)",border:"none",color:"white",borderRadius:"4px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",transition:"opacity 0.2s ease"},onMouseEnter:s=>{s.target.style.opacity="0.9"},onMouseLeave:s=>{s.target.style.opacity="1"},children:[e.jsx(it,{size:16}),e.jsx("span",{children:"Add Custom"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:"500"},children:"Party Size:"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",border:"1px solid var(--border)",borderRadius:"4px",padding:"0.125rem 0.25rem",backgroundColor:"var(--bg-secondary)"},children:[e.jsx("button",{onClick:()=>K(Math.max(1,O-1)),style:{background:"transparent",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:"0",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem"},onMouseEnter:s=>{s.target.style.color="var(--purple)"},onMouseLeave:s=>{s.target.style.color="var(--text-primary)"},children:e.jsx(mt,{size:12})}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:"500",minWidth:"1.5rem",textAlign:"center"},children:O}),e.jsx("button",{onClick:()=>K(O+1),style:{background:"transparent",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:"0",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem"},onMouseEnter:s=>{s.target.style.color="var(--purple)"},onMouseLeave:s=>{s.target.style.color="var(--text-primary)"},children:e.jsx(it,{size:12})})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:"500"},children:"Balance:"}),e.jsx("span",{style:{color:Je>Ke?"var(--danger)":Je===Ke?"var(--purple)":"var(--success)",fontWeight:600,fontSize:"0.875rem"},children:Je>Ke?`+${Je-Ke}`:Ke-Je===0?"0":`-${Ke-Je}`})]}),I&&e.jsx("button",{onClick:I,style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease",flexShrink:0},onMouseEnter:s=>s.target.style.color="var(--text-primary)",onMouseLeave:s=>s.target.style.color="var(--text-secondary)",title:"Close browser",children:e.jsx(at,{size:16})})]}),showTab:!0,tabBackgroundColor:"var(--bg-primary)",tabBorderColor:"var(--border)",tabJustifyContent:"space-between",containerBackgroundColor:"var(--bg-primary)",containerBorderColor:"var(--border)",containerBorderRadius:"8px",containerBoxShadow:"-4px 0 12px rgba(0, 0, 0, 0.3)",containerOverflow:"hidden",reserveTabSpace:!0,containerStyle:{height:"100%"},children:e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,display:"flex",flexDirection:"column",width:"100%",minWidth:0},children:e.jsx(Jt,{type:"adversary",onAddItem:je,showContainer:!1,activeTab:Me,onTabChange:Ne,pcCount:O,savedEncounters:k,onLoadEncounter:Se,onDeleteEncounter:$,selectedCustomAdversaryId:He,onSelectCustomAdversary:p,autoFocus:!0,hideImportExport:!0,onClose:I,searchPlaceholder:"Search adversaries"})})})}),e.jsxs("div",{ref:n,className:"dashboard-scroll-container",style:{display:"flex",flexDirection:"row",overflowX:"auto",overflowY:"hidden",padding:`0 ${r}px 0 0`,scrollSnapType:"x mandatory",height:"100%",width:"100%"},onScroll:lt,children:[Ie.length===0?null:(()=>{const s=[];if(Ie.forEach((c,L)=>{var y,B,ne;if(be&&be.baseName===c.baseName&&c.type==="adversary"){s.push(e.jsx(Ct,{style:{width:Le?"0px":`${V+r}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:Le?"0px":`${r}px`,paddingRight:"0",paddingTop:Le?"0px":`${r}px`,paddingBottom:Le?"0px":`${r}px`,scrollSnapAlign:"none",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"100%",opacity:0,transition:"width 0.3s ease, padding-left 0.3s ease, padding-top 0.3s ease, padding-bottom 0.3s ease"}},`spacer-${be.baseName}`));return}s.push(e.jsx(Ct,{style:{width:`${V+r}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:`${r}px`,paddingRight:"0",paddingTop:`${c.type==="adversary"?r+52:r}px`,paddingBottom:`${r}px`,scrollSnapAlign:"start",overflow:c.type==="adversary"?"visible":"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"auto",opacity:G.has(`${c.type}-${c.baseName}`)?0:1,transition:(G.has(`${c.type}-${c.baseName}`),"opacity 0.2s ease")},children:e.jsx(ft,{type:c.type,item:{...c.instances[0],name:((y=c.instances[0])==null?void 0:y.name)||c.baseName,hp:0,stress:0,isDead:!1},mode:"expanded",instances:c.instances,showCustomCreator:c.type==="adversary"&&Re&&c.instances.some(W=>W.id===Re),onSaveCustomAdversary:c.type==="adversary"&&Re&&c.instances.some(W=>W.id===Re)?_e:void 0,onCancelEdit:c.type==="adversary"&&Re&&c.instances.some(W=>W.id===Re)?ze:void 0,isStockAdversary:c.type==="adversary"&&Re&&c.instances.some(W=>W.id===Re)?!((B=c.instances[0])!=null&&B.source)||((ne=c.instances[0])==null?void 0:ne.source)!=="Homebrew":!1,onApplyDamage:c.type==="adversary"?(W,le,pe,P)=>{const q=c.instances.find(D=>D.id===W);q&&g(W,{hp:Math.min(q.hpMax||1,(q.hp||0)+le)})}:void 0,onApplyHealing:c.type==="adversary"?(W,le,pe)=>{const P=c.instances.find(q=>q.id===W);P&&g(W,{hp:Math.max(0,(P.hp||0)-le)})}:void 0,onApplyStressChange:c.type==="adversary"?(W,le)=>{var pe,P;return g(W,{stress:Math.max(0,Math.min(((pe=c.instances.find(q=>q.id===W))==null?void 0:pe.stressMax)||6,(((P=c.instances.find(q=>q.id===W))==null?void 0:P.stress)||0)+le))})}:void 0,onUpdate:c.type==="adversary"?g:c.type==="environment"?ae:ge,adversaries:t,showAddRemoveButtons:U!==null&&c.type==="adversary",onEdit:c.type==="adversary"?W=>Ce(W):void 0,onAddInstance:c.type==="adversary"?W=>{const le=W.type==="Minion",pe=le?O:1;if(le&&pe>1){const P=Array(pe).fill(null).map(()=>({...W}));F(P)}else R(W);setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(n.current){const P=n.current,q=P.scrollLeft,D=P.clientWidth,Ae=U!==null?D-(V+r):D,oe=te().findIndex(se=>se.baseName===c.baseName&&se.type==="adversary");if(oe>=0){const se=oe*(V+r),We=se+V+r,ue=10;se>=q-ue&&We<=q+Ae+ue||re(se,500)}}})})},50)}:void 0,onRemoveInstance:c.type==="adversary"?W=>{const le=c.instances[0],P=(le==null?void 0:le.type)==="Minion"?O:1,q=c.instances.sort((we,oe)=>{const se=we.duplicateNumber||1;return(oe.duplicateNumber||1)-se}),Ae=Math.max(0,q.length-P)===0;if(q.length>0){const we=q.slice(0,P);if(Ae){const oe=Ie.findIndex(ue=>ue.baseName===c.baseName&&ue.type==="adversary"),se=oe===0;let We=!1;if(n.current){const ue=n.current,Pe=ue.scrollLeft,$e=ue.scrollWidth-ue.clientWidth;We=Math.abs(Pe-$e)<1}Be({baseName:c.baseName,groupIndex:oe}),Fe(!1),se&&n.current&&(n.current.style.scrollSnapType="none"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{n.current&&n.current.offsetHeight,we.forEach(ue=>{z(ue.id)}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{n.current&&n.current.offsetHeight,setTimeout(()=>{if(Fe(!0),We&&n.current){const ue=performance.now(),Pe=300,$e=()=>{if(!n.current)return;const Ye=n.current,De=Ye.scrollWidth-Ye.clientWidth;Ye.scrollLeft=De,performance.now()-ue<Pe&&requestAnimationFrame($e)};requestAnimationFrame($e)}setTimeout(()=>{if(Be(null),Fe(!1),se&&n.current&&(n.current.style.scrollSnapType="x mandatory"),We&&n.current){const ue=n.current;ue.scrollLeft=ue.scrollWidth-ue.clientWidth}},300)},50)})})})})}else we.forEach(oe=>{z(oe.id)})}}:void 0})},`${c.type}-${c.baseName}`))}),be&&!s.some(c=>(c==null?void 0:c.key)===`spacer-${be.baseName}`)){const c=Math.min(be.groupIndex,s.length);s.splice(c,0,e.jsx(Ct,{style:{width:Le?"0px":`${V+r}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:Le?"0px":`${r}px`,paddingRight:"0",paddingTop:Le?"0px":`${r}px`,paddingBottom:Le?"0px":`${r}px`,scrollSnapAlign:"none",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"100%",opacity:0,transition:"width 0.3s ease, padding-left 0.3s ease, padding-top 0.3s ease, padding-bottom 0.3s ease"}},`spacer-${be.baseName}`))}return s})(),U!==null&&e.jsx("div",{style:{width:`${V+r}px`,flexShrink:0,flexGrow:0,flex:"none",height:"100%"}})]})]}),e.jsx(zr,{isOpen:ie,onClose:l,onAddAdversary:s=>{R(s),ee("adversary")},onAddAdversariesBulk:s=>{F(s),ee("adversary")},onAddEnvironment:s=>{me(s),ee("environment")},onDeleteAdversary:z,onDeleteEnvironment:de,onDeleteCountdown:Z,adversaries:t,environments:o,countdowns:m,savedEncounters:k,onSaveEncounter:fe,onLoadEncounter:Se,onDeleteEncounter:$}),e.jsx(Mr,{})]})},Hr=()=>e.jsx(Pr,{children:e.jsx(Dr,{})});It.createRoot(document.getElementById("root")).render(e.jsx(nt.StrictMode,{children:e.jsx(pr,{children:e.jsx(Hr,{})})}));
