import{u as W,j as e,B as te,C as Y,_ as Z}from"./index-210cb10d.js";import{r as h,a as ee}from"./dndkit-fdc06b07.js";import{F as se,f as Q,g as U,d as ce}from"./lucide-a8a5326a.js";import"./fa-8ab3eb90.js";function de(s){const[l,f]=W(`browser-search-${s}`,""),[d,v]=W(`browser-filters-tiers-${s}`,[]),[w,p]=W(`browser-filters-types-${s}`,[]),T=()=>{const t=localStorage.getItem(`browser-sort-${s}`);if(t)try{return JSON.parse(t)}catch{return null}return[{field:"tier",direction:"asc"},{field:"displayType",direction:"asc"},{field:"displayDifficulty",direction:"asc"}]},[u,$]=W(`browser-sort-${s}`,T()),[j,D]=h.useState(!1),[S,C]=h.useState(!1),N=h.useRef(null),L=h.useRef(null),[y,I]=h.useState(()=>{const t=localStorage.getItem(`browser-expanded-${s}`);if(t)try{return JSON.parse(t)}catch{return null}return null});h.useEffect(()=>{y?localStorage.setItem(`browser-expanded-${s}`,JSON.stringify({id:y.id})):localStorage.removeItem(`browser-expanded-${s}`)},[y,s]);const A=t=>{$(o=>{var m;if(((m=o[0])==null?void 0:m.field)===t)return[{field:t,direction:o[0].direction==="asc"?"desc":"asc"},...o.slice(1)];const r=o.filter(z=>z.field!==t);return[{field:t,direction:"asc"},...r]})},x=t=>{t==="tier"?(D(!j),C(!1)):t==="type"&&(C(!S),D(!1))},E=d.length===0?"All":`${d.length} selected`,B=w.length===0?"All":`${w.length} selected`,k=d.length>0,P=w.length>0;return{searchTerm:l,setSearchTerm:f,selectedTiers:d,setSelectedTiers:v,selectedTypes:w,setSelectedTypes:p,sortFields:u,setSortFields:$,showTierDropdown:j,setShowTierDropdown:D,showTypeDropdown:S,setShowTypeDropdown:C,tierFilterRef:N,typeFilterRef:L,expandedCard:y,setExpandedCard:I,handleSort:A,handleFilter:x,tierTooltip:E,typeTooltip:B,isTierFiltered:k,isTypeFiltered:P,handleTierSelect:t=>{v(o=>o.includes(t)?o.filter(r=>r!==t):[...o,t])},handleTypeSelect:t=>{p(o=>o.includes(t)?o.filter(r=>r!==t):[...o,t])},getDropdownStyle:t=>{if(!(t!=null&&t.current))return{};const r=(t.current.closest("th")||t.current).getBoundingClientRect(),z=Math.max(8,r.left),q=8,G=window.innerWidth-q,K=Math.min(z,G);return{position:"fixed",top:r.bottom+4,left:K,zIndex:99999}}}}const he=({searchTerm:s,onSearchChange:l,onCreateCustom:f,type:d})=>e.jsxs("div",{className:"browser-header",children:[e.jsx("input",{type:"text",placeholder:"Search",value:s,onChange:v=>l(v.target.value),className:"browser-search-input"}),e.jsx(te,{action:"add",onClick:()=>f&&f(d),size:"sm",className:"browser-create-btn","aria-label":"Create custom",children:"Create"})]}),pe=({sortFields:s,onSort:l,tierFilterRef:f,typeFilterRef:d,isTierFiltered:v,isTypeFiltered:w,tierTooltip:p,typeTooltip:T,showTierDropdown:u,showTypeDropdown:$,onToggleTierDropdown:j,onToggleTypeDropdown:D,itemTiers:S,itemTypes:C,selectedTiers:N,selectedTypes:L,onClearTiers:y,onClearTypes:I,onTierSelect:A,onTypeSelect:x,getDropdownStyle:E})=>{var B,k,P,F,M,R,t,o;return e.jsxs("tr",{children:[e.jsx("th",{onClick:()=>l("name"),className:`sortable ${((B=s[0])==null?void 0:B.field)==="name"?"active":""} ${((k=s[0])==null?void 0:k.field)==="name"?s[0].direction:""}`,children:"Name"}),e.jsx("th",{onClick:()=>l("tier"),className:`sortable ${((P=s[0])==null?void 0:P.field)==="tier"?"active":""} ${((F=s[0])==null?void 0:F.field)==="tier"?s[0].direction:""}`,children:e.jsxs("div",{className:"header-with-filter",children:["Tier",e.jsxs("button",{ref:f,onClick:r=>{r.stopPropagation(),j()},className:`header-filter-icon ${v?"active":""}`,title:`Filter by Tier: ${p}`,children:[e.jsx(se,{size:14}),e.jsx("span",{className:"filter-active-dot","aria-hidden":"true"})]}),u&&ee.createPortal(e.jsxs("div",{className:"filter-dropdown",style:{...E(f),maxHeight:"60vh",overflow:"auto"},onMouseDown:r=>r.stopPropagation(),onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:`filter-option ${N.length===0?"selected":""}`,onClick:()=>y(),children:[e.jsx("span",{className:"check-icon",children:N.length===0?e.jsx(Q,{size:16}):e.jsx(U,{size:16})}),e.jsx("span",{className:"filter-label",children:"All"})]}),S.map(r=>{const m=N.includes(r.toString());return e.jsxs("div",{className:`filter-option ${m?"selected":""}`,onClick:()=>A(r.toString()),children:[e.jsx("span",{className:"check-icon",children:m?e.jsx(Q,{size:16}):e.jsx(U,{size:16})}),e.jsx("span",{className:"filter-label",children:r})]},r)})]}),document.body)]})}),e.jsx("th",{onClick:()=>l("displayType"),className:`sortable ${((M=s[0])==null?void 0:M.field)==="displayType"?"active":""} ${((R=s[0])==null?void 0:R.field)==="displayType"?s[0].direction:""}`,children:e.jsxs("div",{className:"header-with-filter",children:["Type",e.jsxs("button",{ref:d,onClick:r=>{r.stopPropagation(),D()},className:`header-filter-icon ${w?"active":""}`,title:`Filter by Type: ${T}`,children:[e.jsx(se,{size:14}),e.jsx("span",{className:"filter-active-dot","aria-hidden":"true"})]}),$&&ee.createPortal(e.jsxs("div",{className:"filter-dropdown",style:{...E(d),maxHeight:"60vh",overflow:"auto"},onMouseDown:r=>r.stopPropagation(),onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:`filter-option ${L.length===0?"selected":""}`,onClick:()=>I(),children:[e.jsx("span",{className:"check-icon",children:L.length===0?e.jsx(Q,{size:16}):e.jsx(U,{size:16})}),e.jsx("span",{className:"filter-label",children:"All"})]}),C.map(r=>{const m=L.includes(r);return e.jsxs("div",{className:`filter-option ${m?"selected":""}`,onClick:()=>x(r),children:[e.jsx("span",{className:"check-icon",children:m?e.jsx(Q,{size:16}):e.jsx(U,{size:16})}),e.jsx("span",{className:"filter-label",children:r})]},r)})]}),document.body)]})}),e.jsx("th",{onClick:()=>l("displayDifficulty"),className:`sortable ${((t=s[0])==null?void 0:t.field)==="displayDifficulty"?"active":""} ${((o=s[0])==null?void 0:o.field)==="displayDifficulty"?s[0].direction:""}`,children:e.jsx("div",{className:"header-with-filter",children:"Diff"})}),e.jsx("th",{})]})},ue=({item:s,isExpanded:l,onToggleExpand:f,onAdd:d,fallbackType:v})=>{var T;const w=((T=s.category)==null?void 0:T.toLowerCase())||v,p={...s,hp:0,stress:0};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"browser-row",onClick:u=>{u.preventDefault(),u.stopPropagation(),f(s)},children:[e.jsx("td",{className:"column-name","data-label":"Name",children:s.name}),e.jsx("td",{className:"column-tier","data-label":"Tier",children:s.tier}),e.jsx("td",{className:"column-type","data-label":"Type",children:s.displayType}),e.jsx("td",{className:"column-description","data-label":"Difficulty",children:s.displayDifficulty}),e.jsx("td",{className:"column-action","data-label":"Add",children:e.jsx(te,{action:"add",size:"sm",className:"table-add-btn",onClick:u=>{u.stopPropagation(),d(s)},"aria-label":`Add ${s.name}`,children:e.jsx(ce,{size:14})})})]}),l&&e.jsx("tr",{className:"condensed-card-row",children:e.jsx("td",{colSpan:5,className:"condensed-card-cell",children:e.jsx("div",{className:"condensed-card-container",children:e.jsx(Y,{item:p,type:w,mode:"compact"})})})}),l&&e.jsx("tr",{className:"expanded-card-row",children:e.jsx("td",{colSpan:5,className:"expanded-card-cell",children:e.jsx("div",{className:"expanded-card-container",children:e.jsx(Y,{item:p,type:w,mode:"expanded"})})})})]})};let X={adversaries:[]},J={environments:[]};const me=async()=>{try{const s=await Z(()=>import("./index-210cb10d.js").then(l=>l.b),["assets/index-210cb10d.js","assets/dndkit-fdc06b07.js","assets/fa-8ab3eb90.js","assets/lucide-a8a5326a.js","assets/index-880ae750.css"]);X=(s==null?void 0:s.default)||s,console.log("Loaded adversaries data:",X)}catch(s){console.warn("Failed to load adversaries.json dynamically:",s)}try{const s=await Z(()=>import("./environments-f019e73d.js"),[]);J=(s==null?void 0:s.default)||s,console.log("Loaded environments data:",J),console.log("Environments array:",J.environments)}catch(s){console.warn("Failed to load environments.json dynamically:",s)}},fe=me(),ve=({type:s,onAddItem:l,onCancel:f,onCreateCustom:d})=>{const[v,w]=h.useState(0);h.useEffect(()=>{fe.then(()=>{w(a=>a+1)})},[]),console.log("Browser component rendered with props:",{type:s,onAddItem:l,onCancel:f,onCreateCustom:d}),console.log("Browser component is being used, not List component");const{searchTerm:p,setSearchTerm:T,selectedTiers:u,setSelectedTiers:$,selectedTypes:j,setSelectedTypes:D,sortFields:S,showTierDropdown:C,setShowTierDropdown:N,showTypeDropdown:L,setShowTypeDropdown:y,tierFilterRef:I,typeFilterRef:A,expandedCard:x,setExpandedCard:E,handleSort:B,handleFilter:k,tierTooltip:P,typeTooltip:F,isTierFiltered:M,isTypeFiltered:R,handleTierSelect:t,handleTypeSelect:o,getDropdownStyle:r}=de(s),m=h.useRef(s);m.current!==s&&(m.current=s);const z=X.adversaries||[],q=J.environments||[];console.log("Browser render - type:",s,"adversaryData length:",z.length,"environmentData length:",q.length),console.log("environmentsData structure:",J);const G=s==="adversary"?z:q,K=s==="adversary"?"adversary":"environment";h.useEffect(()=>{const a=g=>{const O=g.target.closest(".filter-dropdown"),b=g.target.closest(".header-filter-icon");O||b||(N(!1),y(!1))},n=g=>{g.key==="Escape"&&(N(!1),y(!1))};return document.addEventListener("pointerdown",a,!0),document.addEventListener("mousedown",a,!0),document.addEventListener("touchstart",a,!0),document.addEventListener("click",a,!0),document.addEventListener("keydown",n,!0),()=>{document.removeEventListener("pointerdown",a,!0),document.removeEventListener("mousedown",a,!0),document.removeEventListener("touchstart",a,!0),document.removeEventListener("click",a,!0),document.removeEventListener("keydown",n,!0)}},[N,y]);const _=h.useMemo(()=>G.map(n=>({...n,category:K==="adversary"?"Adversary":"Environment",displayType:n.type,displayDifficulty:n.difficulty==="Special (see Relative Strength)"?"Relative":n.difficulty})),[G,K]),re=h.useMemo(()=>[...new Set(_.map(n=>n.displayType).filter(Boolean))].sort(),[_]),ae=h.useMemo(()=>[...new Set(_.map(n=>n.tier).filter(Boolean))].sort((n,g)=>n-g),[_]),ne=h.useMemo(()=>{let a=_.filter(n=>{const g=p===""||n.name.toLowerCase().includes(p.toLowerCase())||n.description&&n.description.toLowerCase().includes(p.toLowerCase()),O=u.length===0||u.includes(n.tier.toString()),b=j.length===0||j.includes(n.displayType);return g&&O&&b});return a.sort((n,g)=>{for(const O of S){const{field:b,direction:ie}=O;let i=n[b],c=g[b];if(b==="tier")i=parseInt(i)||0,c=parseInt(c)||0;else if(b==="displayDifficulty"){const H=parseInt(i),V=parseInt(c);!isNaN(H)&&!isNaN(V)?(i=H,c=V):!isNaN(H)&&isNaN(V)?(i=H,c=999):isNaN(H)&&!isNaN(V)?(i=999,c=V):(i=String(i||"").toLowerCase(),c=String(c||"").toLowerCase())}else typeof i=="string"&&typeof c=="string"?(i=i.toLowerCase(),c=c.toLowerCase()):(i=String(i||"").toLowerCase(),c=String(c||"").toLowerCase());if(ie==="asc"){if(i>c)return 1;if(i<c)return-1}else{if(i<c)return 1;if(i>c)return-1}}return 0}),a},[_,p,u,j,S]),oe=a=>{console.log("Browser handleAddFromDatabase called with:",a),l&&l(a,s)},le=a=>{console.log("Browser handleCardClick called:",a.name),(x==null?void 0:x.id)===a.id?(E(null),console.log("Collapsing card")):(E(a),console.log("Expanding card:",a.name,"expandedCard state:",x))};return e.jsxs("div",{className:"browser-wrapper",children:[e.jsx(he,{searchTerm:p,onSearchChange:T,onCreateCustom:d,type:s}),e.jsx("div",{className:"browser-content",children:e.jsxs("table",{className:"browser-table",children:[e.jsx("thead",{children:e.jsx(pe,{sortFields:S,onSort:B,tierFilterRef:I,typeFilterRef:A,isTierFiltered:M,isTypeFiltered:R,tierTooltip:P,typeTooltip:F,showTierDropdown:C,showTypeDropdown:L,onToggleTierDropdown:()=>k("tier"),onToggleTypeDropdown:()=>k("type"),itemTiers:ae,itemTypes:re,selectedTiers:u,selectedTypes:j,onClearTiers:()=>$([]),onClearTypes:()=>D([]),onTierSelect:a=>t(a),onTypeSelect:a=>o(a),getDropdownStyle:r})}),e.jsx("tbody",{children:ne.map(a=>e.jsx(ue,{item:a,isExpanded:(x==null?void 0:x.id)===a.id,onToggleExpand:le,onAdd:oe,fallbackType:s==="adversary"?"adversary":"environment"},a.id))})]})})]})};export{ve as default};
