import{r as j,a as ue,R as ie}from"./dndkit-57209f9c.js";import{F as Ce,f as Se,a as ke,b as Ie,c as se}from"./fa-b4bcccb0.js";import{D as J,A as ge,C as Ee,T as We,S as ze,M as Te,X as fe,E as Ae,H as re,L as De,a as Re,b as Le,F as Be,c as ae,d as le}from"./lucide-7177590b.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const y of document.querySelectorAll('link[rel="modulepreload"]'))m(y);new MutationObserver(y=>{for(const d of y)if(d.type==="childList")for(const x of d.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&m(x)}).observe(document,{childList:!0,subtree:!0});function p(y){const d={};return y.integrity&&(d.integrity=y.integrity),y.referrerPolicy&&(d.referrerPolicy=y.referrerPolicy),y.crossOrigin==="use-credentials"?d.credentials="include":y.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function m(y){if(y.ep)return;y.ep=!0;const d=p(y);fetch(y.href,d)}})();var ye={exports:{}},te={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Me=j,Ne=Symbol.for("react.element"),Fe=Symbol.for("react.fragment"),Pe=Object.prototype.hasOwnProperty,He=Me.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Oe={key:!0,ref:!0,__self:!0,__source:!0};function ve(t,n,p){var m,y={},d=null,x=null;p!==void 0&&(d=""+p),n.key!==void 0&&(d=""+n.key),n.ref!==void 0&&(x=n.ref);for(m in n)Pe.call(n,m)&&!Oe.hasOwnProperty(m)&&(y[m]=n[m]);if(t&&t.defaultProps)for(m in n=t.defaultProps,n)y[m]===void 0&&(y[m]=n[m]);return{$$typeof:Ne,type:t,key:d,ref:x,props:y,_owner:He.current}}te.Fragment=Fe;te.jsx=ve;te.jsxs=ve;ye.exports=te;var e=ye.exports,oe={},de=ue;oe.createRoot=de.createRoot,oe.hydrateRoot=de.hydrateRoot;function ne(t){const n=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return t?`${t}-${n}`:n}const be=j.createContext();function $e(t){if(typeof localStorage>"u")return null;try{const n=localStorage.getItem(t);return n==null?null:JSON.parse(n)}catch{return null}}function Ve(t,n){if(!(typeof localStorage>"u"))try{localStorage.setItem(t,JSON.stringify(n))}catch{}}const _e=({children:t})=>{const[n,p]=j.useState({fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[]});j.useEffect(()=>{var g,l,s;const a=$e("daggerheart-game-state");if(a)try{(((g=a.adversaries)==null?void 0:g.length)>0||((l=a.environments)==null?void 0:l.length)>0||((s=a.countdowns)==null?void 0:s.length)>0)&&p(a)}catch(i){console.error("Failed to load saved state:",i)}},[]),j.useEffect(()=>{Ve("daggerheart-game-state",n)},[n]);const m=a=>{p(g=>({...g,fear:{...g.fear,value:a}}))},y=()=>{p(a=>({...a,fear:{...a.fear,visible:!a.fear.visible}}))},d=j.useRef(n);j.useEffect(()=>{d.current=n},[n]);const T={gameState:n,updateFear:m,toggleFearVisibility:y,createCountdown:a=>{const g={id:ne("countdown"),name:a.name||"Countdown",max:parseInt(a.max)||1,value:0,visible:!0,type:a.type||"standard",loop:a.loop||"none",source:a.source||"campaign"};p(l=>({...l,countdowns:[...l.countdowns,g]}))},updateCountdown:(a,g)=>{p(l=>({...l,countdowns:l.countdowns.map(s=>s.id===a?{...s,...g}:s)}))},deleteCountdown:a=>{p(g=>({...g,countdowns:g.countdowns.filter(l=>l.id!==a)}))},advanceCountdown:(a,g)=>{p(l=>({...l,countdowns:l.countdowns.map(s=>{if(s.id!==a)return s;let i=g;if(s.loop==="loop")i>s.max?i=(i-1)%s.max+1:i<0&&(i=s.max);else if(s.loop==="increasing"){if(i>s.max)return{...s,max:s.max+1,value:1};if(i<0)return{...s,max:Math.max(1,s.max-1),value:1};i=Math.max(0,i)}else if(s.loop==="decreasing"){if(i>s.max)return{...s,max:Math.max(1,s.max-1),value:1};if(i<0)return{...s,max:s.max+1,value:1};i=Math.min(s.max,i)}else i=Math.max(0,Math.min(i,s.max));return{...s,value:i}})}))},incrementCountdown:(a,g=1)=>{p(l=>({...l,countdowns:l.countdowns.map(s=>{if(s.id!==a)return s;let i=s.value+g;if(s.loop==="loop")i>s.max&&(i=(i-1)%s.max+1);else if(s.loop==="increasing"){if(i>s.max)return{...s,max:s.max+1,value:1}}else if(s.loop==="decreasing"){if(i>s.max)return{...s,max:Math.max(1,s.max-1),value:1}}else i=Math.min(i,s.max);return{...s,value:i}})}))},decrementCountdown:a=>{p(g=>({...g,countdowns:g.countdowns.map(l=>{if(l.id!==a)return l;let s=l.value-1;if(l.loop==="loop")s<0&&(s=l.max);else if(l.loop==="increasing"){if(s<0)return{...l,max:Math.max(1,l.max-1),value:l.max};s=Math.max(0,s)}else if(l.loop==="decreasing"){if(s<0)return{...l,max:l.max+1,value:1}}else s=Math.max(0,s);return{...l,value:s}})}))},reorderCountdowns:a=>{p(g=>{const[l,s]=a,i=[...g.countdowns],[f]=i.splice(l,1);return i.splice(s,0,f),{...g,countdowns:i}})},createAdversary:a=>{const g=ne("adv"),l=n.adversaries||[],s=a.name||"Unknown",i=l.filter(r=>r.baseName===s);let f=1;if(i.length===0)f=1;else{const r=i.map(h=>h.duplicateNumber||1);let c=1;for(;r.includes(c);)c++;f=c}const o={...a,id:g,baseName:s,duplicateNumber:f,name:`${s} (${f})`,hp:0,stress:0,isVisible:!0};p(r=>({...r,adversaries:[...r.adversaries,o]}))},updateAdversary:(a,g)=>{p(l=>({...l,adversaries:l.adversaries.map(s=>{if(s.id===a){const i={...s,...g};if(g.baseName!==void 0){const f=g.baseName,o=i.duplicateNumber||1;i.name=o===1?f:`${f} (${o})`}return i}return s})}))},deleteAdversary:a=>{p(g=>({...g,adversaries:g.adversaries.filter(l=>l.id!==a)}))},reorderAdversaries:a=>{p(g=>{const[l,s]=a,i=[...g.adversaries],[f]=i.splice(l,1);return i.splice(s,0,f),{...g,adversaries:i}})},bulkReorderAdversaries:a=>{p(g=>({...g,adversaries:a}))},createEnvironment:a=>{const g=ne("env"),s=(n.environments||[]).filter(o=>o.name.replace(/\s+\(\d+\)$/,"")===a.name);let i=a.name||"Unknown";if(s.length===0)i=a.name;else if(s.length===1){const o=s[0],r=o.name.replace(/\s+\(\d+\)$/,""),c=n.environments.map(h=>h.id===o.id?{...h,name:`${r} (1)`}:h);p(h=>({...h,environments:c})),i=`${a.name} (2)`}else{const o=s.map(c=>{const h=c.name.match(/\((\d+)\)$/);return h?parseInt(h[1]):null}).filter(c=>c!==null);let r=1;for(;o.includes(r);)r++;i=`${a.name} (${r})`}const f={...a,id:g,name:i,isVisible:!0};p(o=>({...o,environments:[...o.environments,f]}))},updateEnvironment:(a,g)=>{p(l=>({...l,environments:l.environments.map(s=>s.id===a?{...s,...g}:s)}))},deleteEnvironment:a=>{p(g=>({...g,environments:g.environments.filter(l=>l.id!==a)}))},reorderEnvironments:a=>{p(g=>{const[l,s]=a,i=[...g.environments],[f]=i.splice(l,1);return i.splice(s,0,f),{...g,environments:i}})}};return e.jsx(be.Provider,{value:T,children:t})},Xe=()=>{const t=j.useContext(be);if(!t)return console.warn("useGameState: Context not available yet, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],updateFear:()=>{},toggleFearVisibility:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{gameState:n,...p}=t;if(!n)return console.warn("useGameState: gameState not available, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],updateFear:()=>{},toggleFearVisibility:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{fear:m,countdowns:y,adversaries:d,environments:x}=n;return{gameState:n,fear:m,countdowns:y,adversaries:d,environments:x,...p,hasCountdowns:y.length>0,hasAdversaries:d.length>0,hasEnvironments:x.length>0,getCountdownById:w=>y.find(u=>u.id===w),getAdversaryById:w=>d.find(u=>u.id===w),getEnvironmentById:w=>x.find(u=>u.id===w)}},ce={fear:{icon:Se,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"0.125rem",maxWidth:"none"},pipStyle:{fontSize:"var(--text-lg)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0,imageRendering:"crisp-edges"},filledColor:"var(--purple)",emptyColor:"var(--gray-dark)",tooltipTitle:"Click anywhere in header to adjust fear:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease fear by 1"},{text:"Right of boundary:",description:"Click to increase fear by 1"}]},hp:{icon:ke,maxValue:20,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stress:{icon:Ie,maxValue:12,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},countdown:{icon:se,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust countdown:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease countdown by 1"},{text:"Right of boundary:",description:"Click to increase countdown by 1"}]},hpDots:{maxValue:20,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--red)",borderColor:"var(--red)",boxShadow:"0 0 4px rgba(239, 68, 68, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stressDots:{maxValue:12,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--purple)",borderColor:"var(--purple)",boxShadow:"0 0 4px rgba(139, 92, 246, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},adversaryHP:{icon:J,maxValue:20,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust HP:",tooltipInstructions:[{text:"Filled pip:",description:"Click to heal (reduce damage)"},{text:"Empty pip:",description:"Click to take damage"}]},adversaryStress:{icon:ge,maxValue:12,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust stress:",tooltipInstructions:[{text:"Filled pip:",description:"Click to reduce stress"},{text:"Empty pip:",description:"Click to increase stress"}]},countdownDistributed:{icon:se,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Countdown progress:",tooltipInstructions:[{text:"Progress:",description:"Current countdown value"}]}},Ge=({type:t="fear",value:n=0,maxValue:p,onChange:m,size:y="lg",showTooltip:d=!0,containerStyle:x={},pipStyle:w={},countdownType:u=null,distributedGroups:I=null,onPipClick:S=null,enableBoundaryClick:z=!1,clickContainerWidth:F="auto",centerPips:C=!0})=>{const[v,N]=j.useState(!1),E=ce[t]||ce.fear,M=p||E.maxValue,W=Math.max(0,Math.min(M,n));let D=E.filledColor;t==="countdown"&&u&&(["progress","dynamic-progress","simple-hope"].includes(u)?D="var(--gold)":["consequence","dynamic-consequence","simple-fear"].includes(u)?D="var(--purple)":["long-term","standard"].includes(u)&&(D="var(--text-secondary)"));const k=(l,s)=>{if(S)S(l,s);else if(m){const i=l+1;m(i)}},P=l=>{if(!z||!m||S)return;l.currentTarget.getBoundingClientRect();const s=l.currentTarget.querySelector(".pip-container");if(!s)return;const i=s.getBoundingClientRect(),f=l.clientX-i.left;if(f<0){W>0&&m(W-1);return}if(f>i.width){W<M&&m(W+1);return}const o=i.width,r=o*.05,c=o-2*r,h=f-r,H=W/M,_=c*H;h<_?W>0&&m(W-1):W<M&&m(W+1)},a=(()=>{if(!I||t!=="countdownDistributed")return[{start:0,end:M,groupIndex:0}];let l=0;return I.map((s,i)=>{const f={start:l,end:l+s,groupIndex:i};return l+=s,f})})(),g=()=>e.jsxs(e.Fragment,{children:[a.map(l=>e.jsx(ie.Fragment,{children:[...Array(l.end-l.start)].map((s,i)=>{const f=l.start+i,o=f<W;if(E.isDots)return e.jsx("div",{style:{...E.pipStyle,...o?E.filledStyle:E.emptyStyle,...w,cursor:m||S?"pointer":"default"},onClick:z?void 0:()=>k(f,o),title:`${f+1} of ${M}`},f);{const r=E.icon,c=r&&typeof r=="object"&&r.iconName,h=o?D:E.emptyColor;return e.jsx("span",{className:`fear-pip ${o?"filled":"empty"}`,style:{...E.pipStyle,color:h,cursor:m||S?"pointer":"default",...w},onClick:z?void 0:()=>k(f,o),title:`${f+1} of ${M}`,children:c?e.jsx(Ce,{icon:r,size:y}):e.jsx(r,{size:16})},f)}})},l.groupIndex)),d&&e.jsx("div",{style:{position:"relative",cursor:"help",pointerEvents:"none"},children:e.jsxs("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:v?"translateX(-50%) translateY(-5px)":"translateX(-50%)",background:"rgba(15, 23, 42, 0.95)",border:"1px solid var(--gray)",borderRadius:"var(--radius-md)",padding:"var(--space-md)",minWidth:"250px",zIndex:1e3,opacity:v?1:0,visibility:v?"visible":"hidden",transition:"all 0.2s ease",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.5)"},children:[e.jsx("div",{style:{fontWeight:600,color:"var(--gray-200)",marginBottom:"0.75rem",fontSize:"var(--text-sm)"},children:E.tooltipTitle}),E.tooltipInstructions.map((l,s)=>e.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.8rem",color:"var(--gray-300)",lineHeight:1.4},children:[e.jsx("strong",{style:{color:"var(--gray-200)"},children:l.text})," ",l.description]},s))]})})]});return e.jsx("div",{style:{width:F,height:"100%",cursor:m||S?"pointer":"default",touchAction:"manipulation",userSelect:"none",display:C?"flex":"block",alignItems:C?"center":"stretch",justifyContent:C?"center":"flex-start",...x},onClick:l=>{l.stopPropagation(),l.preventDefault(),z&&P(l)},onMouseEnter:()=>N(d),onMouseLeave:()=>N(!1),children:e.jsx("div",{className:"pip-container",style:{...E.containerStyle,width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},children:g()})})},qe="/Daggerheart/assets/daggerheart-logo-fe7815ad.svg",Ye=({showFlyout:t,onFlyoutChange:n})=>{const[p,m]=j.useState(!1),[y,d]=j.useState(!1),x=t!==void 0?t:p,w=n||m;return j.useEffect(()=>{const u=I=>{I.target.closest(".help-button")||w(!1)};return document.addEventListener("click",u),()=>document.removeEventListener("click",u)},[w]),j.useEffect(()=>{const u=window.matchMedia("(max-width: 800px)"),I=S=>d(S.matches);return d(u.matches),u.addEventListener("change",I),()=>u.removeEventListener("change",I)},[]),e.jsxs("div",{className:"help-button",style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",padding:"0.5rem",color:x?"white":"var(--text-primary)",borderRadius:"50%",cursor:"pointer",transition:"all 0.2s ease",minWidth:"44px",minHeight:"44px",backgroundColor:x?"var(--purple)":"transparent"},onMouseEnter:u=>{x||(u.currentTarget.style.backgroundColor="var(--bg-secondary)")},onMouseLeave:u=>{x||(u.currentTarget.style.backgroundColor="transparent")},onClick:u=>{u.stopPropagation(),w(!x)},title:"Help & Info",children:[e.jsx("div",{style:{width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center",color:"inherit",backgroundColor:"transparent",border:"none",outline:"none"},children:e.jsx(Ee,{size:20})}),e.jsxs("div",{style:{position:"absolute",top:"50%",right:"100%",left:"auto",transform:"translateY(-50%)",background:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,opacity:x?1:0,visibility:x?"visible":"hidden",transition:"opacity 0.2s ease, visibility 0.2s ease, transform 0.2s ease",pointerEvents:x?"auto":"none",minWidth:"280px",maxWidth:y?"calc(100vw - 2rem)":"320px",marginRight:"0.5rem"},children:[e.jsxs("div",{style:{padding:"0.75rem",borderTop:"1px solid rgba(255, 255, 255, 0.1)",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",background:"var(--bg-primary)",maxWidth:"280px"},children:[e.jsx("img",{src:qe,alt:"Daggerheart Community Content Logo",style:{width:"100%",maxWidth:"200px",height:"auto",margin:"0 auto 0.75rem auto",display:"block"},onError:u=>{console.error("Failed to load Daggerheart logo:",u.target.src),u.target.style.display="none";const I=document.createElement("div");I.style.cssText="text-align: center; margin-bottom: 0.75rem; font-size: 1.5rem; font-weight: bold; color: var(--purple);",I.textContent="⚔️ DAGGERHEART ⚔️",u.target.parentNode.insertBefore(I,u.target)},onLoad:()=>{}}),e.jsxs("div",{style:{fontSize:"0.7rem",lineHeight:1.3,color:"var(--text-secondary)",textAlign:"left",wordWrap:"break-word",overflowWrap:"break-word"},children:[e.jsx("p",{children:"This product includes materials from the Daggerheart System Reference Document 1.0, © Critical Role, LLC, under the terms of the Darrington Press Community Gaming (DPCGL) License."}),e.jsxs("p",{children:["More information can be found at ",e.jsx("a",{href:"https://www.daggerheart.com",target:"_blank",rel:"noopener noreferrer",children:"daggerheart.com"})]}),e.jsx("p",{children:e.jsx("em",{children:"This project is unofficial and not endorsed by Darrington Press or Critical Role."})})]})]}),e.jsx("button",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"0.25rem 1rem",color:"var(--text-primary)",border:"none",background:"none",width:"100%",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"0.875rem",minHeight:"32px",borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},onMouseEnter:u=>{u.target.style.backgroundColor="var(--gray-dark)"},onMouseLeave:u=>{u.target.style.backgroundColor="transparent"},onClick:u=>{u.stopPropagation(),w(!1),window.open("https://github.com/Splinter714/Daggerheart","_blank")},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.25rem"},children:e.jsx("span",{children:"GitHub"})})}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"0.25rem 1rem",color:"var(--text-secondary)",border:"none",background:"none",width:"100%",textAlign:"left",cursor:"default",fontSize:"0.875rem",minHeight:"32px"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.25rem"},children:e.jsxs("span",{children:["Version ","0.3.0 (fe13f24)"]})})})]})]})},Ke=({adversaries:t,environments:n,countdowns:p,deleteAdversary:m,deleteEnvironment:y,deleteCountdown:d,isClearMode:x,setIsClearMode:w,showFlyout:u,onFlyoutChange:I})=>{const[S,z]=j.useState(!1),F=u!==void 0?u:S,C=I||z,v=((t==null?void 0:t.length)||0)>0||((n==null?void 0:n.length)||0)>0||((p==null?void 0:p.length)||0)>0,N=(t||[]).some(k=>(k.hp||0)>=(k.hpMax||1));j.useEffect(()=>{const k=P=>{P.target.closest(".delete-clear-container")||(C(!1),x&&w(!1))};return document.addEventListener("click",k),()=>document.removeEventListener("click",k)},[x,C]),j.useEffect(()=>{x&&!v&&(w(!1),C(!1))},[x,v,w,C]);const E={position:"absolute",top:"50%",right:"100%",left:"auto",transform:"translateY(-50%)",backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",padding:"0.5rem",minWidth:"200px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,display:F?"block":"none",marginRight:"0.5rem"},M={background:x||F?"var(--red)":"none",border:"none",color:x||F?"white":v?"var(--text-primary)":"var(--text-secondary)",cursor:v?"pointer":"not-allowed",padding:"0.5rem",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s",opacity:v?1:.5,minWidth:"44px",minHeight:"44px"},W={background:"none",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:"0.5rem",borderRadius:"var(--radius-sm)",width:"100%",textAlign:"left",display:"flex",alignItems:"center",gap:"0.5rem",transition:"background-color 0.2s"},D={backgroundColor:"var(--bg-hover)"};return e.jsxs("div",{className:"delete-clear-container",style:{position:"relative"},children:[e.jsx("button",{style:M,onClick:k=>{k.stopPropagation(),v&&(x?(w(!1),C(!1)):(w(!0),C(!0)))},title:v?x?"Clear Items":"Enter Clear Mode":"Nothing to clear",children:e.jsx(We,{size:20})}),e.jsxs("div",{style:E,children:[t&&t.length>0&&e.jsxs("button",{style:W,onMouseEnter:k=>Object.assign(k.target.style,D),onMouseLeave:k=>Object.assign(k.target.style,W),onClick:k=>{k.stopPropagation(),z(!1),t.forEach(P=>m(P.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Adversaries"})]}),t&&t.length>0&&N&&e.jsxs("button",{style:W,onMouseEnter:k=>Object.assign(k.target.style,D),onMouseLeave:k=>Object.assign(k.target.style,W),onClick:k=>{k.stopPropagation(),z(!1),t.filter(T=>(T.hp||0)>=(T.hpMax||1)).forEach(T=>m(T.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"Dead Adversaries"})]}),n&&n.length>0&&e.jsxs("button",{style:W,onMouseEnter:k=>Object.assign(k.target.style,D),onMouseLeave:k=>Object.assign(k.target.style,W),onClick:k=>{k.stopPropagation(),z(!1),n.forEach(P=>y(P.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Environments"})]}),p&&p.length>0&&e.jsxs("button",{style:W,onMouseEnter:k=>Object.assign(k.target.style,D),onMouseLeave:k=>Object.assign(k.target.style,W),onClick:k=>{k.stopPropagation(),z(!1),p.forEach(P=>d(P.id))},children:[e.jsx("span",{children:"×"}),e.jsx("span",{children:"All Countdowns"})]})]})]})},Ue=({adversaries:t,environments:n,countdowns:p,deleteAdversary:m,deleteEnvironment:y,deleteCountdown:d,isClearMode:x,setIsClearMode:w,sortAdversaries:u,onOpenDatabase:I})=>{const[S,z]=j.useState(!1),[F,C]=j.useState(!1),[v,N]=j.useState(!1);j.useEffect(()=>{const T=a=>{a.target.closest(".floating-menu-container")||(z(!1),C(!1),N(!1),x&&w(!1))};return document.addEventListener("click",T),()=>document.removeEventListener("click",T)},[x,w]),j.useEffect(()=>{S||(C(!1),N(!1),x&&w(!1))},[S,x,w]);const E=T=>{C(T),T&&(N(!1),x&&w(!1))},M=T=>{N(T),T&&C(!1)},D={position:"fixed",bottom:window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://")?"calc(60px + env(safe-area-inset-bottom) + 2rem)":"calc(60px + env(safe-area-inset-bottom) + 1rem)",right:"1rem",zIndex:1100,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",pointerEvents:"none",width:"56px",height:"56px"},k={width:"56px",height:"56px",borderRadius:"50%",background:S?"var(--red)":"var(--bg-secondary)",border:"2px solid var(--border)",color:S?"white":"var(--text-primary)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"all 0.3s ease",pointerEvents:"auto"},P=(T,a)=>{const i=135+T*135/(a-1),f=70,o=i*Math.PI/180,r=Math.cos(o)*f,c=Math.sin(o)*f;return{width:"48px",height:"48px",borderRadius:"50%",background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.2)",transition:"all 0.3s ease",position:"absolute",pointerEvents:"auto",transform:S?`translate(${r}px, ${c}px)`:"translate(0px, 0px)",opacity:S?1:0,visibility:S?"visible":"hidden"}};return e.jsxs("div",{className:"floating-menu-container",style:D,children:[e.jsxs("div",{style:{position:"absolute",top:"0",left:"0",width:"56px",height:"56px",pointerEvents:"none"},children:[e.jsx("div",{style:P(0,4),children:e.jsx("button",{onClick:T=>{T.stopPropagation(),I("adversaries"),z(!1)},style:{width:"100%",height:"100%",background:"none",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Browse Adversaries",children:e.jsx(ze,{size:20})})}),e.jsx("div",{style:P(1,4),children:e.jsx("button",{onClick:T=>{T.stopPropagation(),I("environments"),z(!1)},style:{width:"100%",height:"100%",background:"none",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Browse Environments",children:e.jsx(Te,{size:20})})}),e.jsx("div",{style:P(2,4),children:e.jsx(Ke,{adversaries:t,environments:n,countdowns:p,deleteAdversary:m,deleteEnvironment:y,deleteCountdown:d,isClearMode:x,setIsClearMode:w,showFlyout:v,onFlyoutChange:M})}),e.jsx("div",{style:P(3,4),children:e.jsx(Ye,{showFlyout:F,onFlyoutChange:E})})]}),e.jsx("button",{style:k,onClick:T=>{T.stopPropagation(),z(!S)},title:S?"Close Menu":"Open Menu",children:S?e.jsx(fe,{size:24}):e.jsx(Ae,{size:24})})]})},Qe=({position:t="top",children:n,onClick:p,className:m="",style:y={}})=>{const d=t==="top",x=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://"),w={background:"var(--bg-primary)",borderTop:d?"none":"1px solid var(--border)",borderBottom:d?"1px solid var(--border)":"none",padding:d?"0.25rem 0":"0.5rem",paddingBottom:d?"0.25rem":x?"calc(0.5rem + env(safe-area-inset-bottom) + 1rem)":"calc(0.5rem + env(safe-area-inset-bottom))",position:d?"relative":"sticky",[d?"top":"bottom"]:0,zIndex:d?10:100,order:d?1:3,flexShrink:0,touchAction:"manipulation",userSelect:"none",display:"flex",flexDirection:d?"column":"row",justifyContent:d?"stretch":"center",alignItems:d?"stretch":"center",gap:d?"0":"1rem",height:d?"auto":"60px",...y};return e.jsx("div",{className:m,style:w,onClick:p,children:n})},pe=({value:t})=>e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"36px",height:"24px"},children:[e.jsx("svg",{width:"32",height:"24",viewBox:"0 0 32 24",fill:"none",stroke:"var(--text-secondary)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",style:{position:"absolute"},children:e.jsx("path",{d:"M2 2h20l4 10-4 10H2l4-10-4-10z"})}),e.jsx("span",{style:{position:"absolute",fontSize:"0.7rem",fontWeight:500,color:"var(--text-primary)",textAlign:"center",zIndex:1,left:"45%",top:"50%",transform:"translate(-50%, -50%)"},children:t})]}),$={transitions:{hoverIn:"all 0.1s ease",hoverOut:"all 0.3s ease"},card:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"12px",cursor:"pointer",transition:"all 0.1s ease",position:"relative"},cardHover:{backgroundColor:"var(--bg-card-hover)"},cardDead:{opacity:.6,backgroundColor:"var(--gray-800)",borderColor:"var(--border)"},cardAtMax:{backgroundColor:"var(--success)",borderColor:"var(--success)"},rowMain:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},rowTitle:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",margin:0},rowMeta:{display:"flex",gap:"8px",alignItems:"center"},badge:{padding:"2px 6px",borderRadius:"3px",fontSize:"10px",fontWeight:"600",textTransform:"uppercase"},typeBadge:{backgroundColor:"var(--purple)",color:"var(--text-primary)"},tierBadge:{backgroundColor:"var(--info)",color:"var(--text-primary)"},damageInputPopup:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,borderRadius:"8px"},damageInputContent:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"8px",padding:"8px",display:"flex",flexDirection:"row",gap:"8px",minWidth:"200px",alignItems:"center",position:"absolute",right:"1rem",top:"50%",transform:"translateY(-50%)"},damageInput:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"4px",padding:"4px 6px",color:"var(--text-primary)",fontSize:"12px",width:"80px",textAlign:"center"},damageIndicators:{display:"flex",gap:"8px",alignItems:"center",justifyContent:"center"},damageDrop:{fontSize:"16px",color:"var(--text-secondary)",cursor:"pointer",transition:"color 0.1s ease"},applyButton:{backgroundColor:"var(--gray-600)",color:"white",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"32px",minHeight:"32px"}},Je=(t,n,p,m)=>{const[y,d]=j.useState(!1),[x,w]=j.useState("");j.useEffect(()=>{if(y){const C=v=>{v.target.closest(".damage-input-popup")||(d(!1),w(""))};return document.addEventListener("click",C),()=>document.removeEventListener("click",C)}},[y]);const u=C=>{C.stopPropagation(),C.preventDefault();const v=t.hp||0,N=t.hpMax||1,E=C.currentTarget.getBoundingClientRect(),M=C.clientX-E.left,W=E.width/N;Math.floor(M/W)<v?p&&p(t.id,1,t.hp):n&&n(t.id,1,t.hp,t.hpMax)},I=C=>{C.stopPropagation(),C.preventDefault();const v=t.stress||0,N=t.stressMax||1,E=C.currentTarget.getBoundingClientRect(),M=C.clientX-E.left,W=E.width/N;Math.floor(M/W)<v?m&&m(t.id,-1,t.stress,t.stressMax):m&&m(t.id,1,t.stress,t.stressMax)},S=C=>{C.stopPropagation(),(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")&&(d(!0),w(t.type==="Minion"?"1":""))},z=()=>{const C=parseInt(x);if(C>0){if(t.type==="Minion")n&&n(t.id,C,t.hp,t.hpMax);else{let v=0;C>=t.thresholds.severe?v=3:C>=t.thresholds.major?v=2:C>=1&&(v=1),n&&n(t.id,v,t.hp,t.hpMax)}d(!1),w("")}};return{showDamageInput:y,damageValue:x,setDamageValue:w,setShowDamageInput:d,handleHpClick:u,handleStressClick:I,handleDifficultyClick:S,applyDamage:z,handleKeyDown:C=>{C.key==="Enter"?z():C.key==="Escape"&&(d(!1),w(""))}}},Ze=({item:t,type:n,mode:p="expanded",onClick:m,onDelete:y,onApplyDamage:d,onApplyHealing:x,onApplyStressChange:w,onUpdate:u,adversaries:I=[],isSelected:S=!1,isEditMode:z=!1,instances:F=[],isEmbedded:C=!1})=>{const v=Je(t,d,x,w);(n==="adversary"||n==="adversaries")&&v.handleDifficultyClick;const[N,E]=j.useState(!1),M=()=>{E(!0)},W=()=>{E(!1)},D=(i=!1)=>{let f={...$.card};if(S?f.transition="none":f.transition=N?$.transitions.hoverIn:$.transitions.hoverOut,i){const{marginTop:o,...r}=f;f=r}return(N&&p!=="expanded"||S)&&(f={...f,...$.cardHover}),n==="adversary"&&(t.hp||0)>=(t.hpMax||1)&&(f={...f,...$.cardDead}),n==="countdown"&&(t.value||0)>=t.max&&(f={...f,...$.cardAtMax}),f},k=()=>{if(C)return"";let i="border rounded-lg";return(N&&p!=="expanded"||S)&&(i+=" border-hover"),i},P=()=>{var i,f;if(n==="adversary"||n==="adversaries"){const o=t.baseName||((i=t.name)==null?void 0:i.replace(/\s+\(\d+\)$/,""))||"",r=t.duplicateNumber||((f=t.name)!=null&&f.match(/\((\d+)\)$/)?parseInt(t.name.match(/\((\d+)\)$/)[1]):1),c=[...I];return I.some(_=>_.id===t.id)||c.push(t),c.filter(_=>_.baseName===o).length>1?`${o} (${r})`:o}return t.name},T=()=>{const i=[];return t.type&&i.push(e.jsx("span",{style:{...$.badge,...$.typeBadge},children:t.type},"type")),n==="environment"&&t.tier&&i.push(e.jsxs("span",{style:{...$.badge,...$.tierBadge},children:["Tier ",t.tier]},"tier")),i},a=()=>n!=="adversary"||!v.showDamageInput||!(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")?null:e.jsx("div",{className:"damage-input-popup",style:$.damageInputPopup,onClick:i=>{i.stopPropagation(),i.target===i.currentTarget&&(n==="adversary"||n==="adversaries")&&(v.setShowDamageInput(!1),v.setDamageValue(""))},children:e.jsxs("div",{className:"border rounded-lg",style:{...$.damageInputContent,borderColor:"var(--border)"},onClick:i=>i.stopPropagation(),children:[e.jsx("input",{type:"number",inputMode:"numeric",enterKeyHint:"done",placeholder:"dmg",min:(t.type==="Minion","0"),value:n==="adversary"||n==="adversaries"?v.damageValue:"",onChange:i=>{(n==="adversary"||n==="adversaries")&&v.setDamageValue(i.target.value)},onKeyDown:n==="adversary"||n==="adversaries"?v.handleKeyDown:void 0,className:"border rounded-sm",style:{...$.damageInput,borderColor:"var(--border)"},autoFocus:!0}),e.jsxs("div",{style:$.damageIndicators,children:[t.type==="Minion"?(()=>{var c,h;const i=parseInt(n==="adversary"||n==="adversaries"?v.damageValue:"0")||0,f=(c=t.features)==null?void 0:c.find(H=>{var _;return(_=H.name)==null?void 0:_.startsWith("Minion (")}),o=f?parseInt(((h=f.name.match(/\((\d+)\)/))==null?void 0:h[1])||"1"):1,r=Math.floor(i/o);return i>=o&&r>0?e.jsxs("span",{style:{...$.damageDrop,color:"var(--red)"},title:`${i} damage can defeat ${r+1} minion${r+1!==1?"s":""} (1 + ${r} additional)`,children:["+",r," additional minion(s)"]}):e.jsx("span",{style:$.damageDrop,title:`${i} damage defeats this minion only`,children:"+0 additional minion(s)"})})():[1,2,3].map(i=>{const f=parseInt(n==="adversary"||n==="adversaries"?v.damageValue:"0")||0;let o=!1;return i===1&&f>=1&&(o=!0),i===2&&f>=t.thresholds.major&&(o=!0),i===3&&f>=t.thresholds.severe&&(o=!0),e.jsx("span",{style:{...$.damageDrop,color:o?"var(--red)":"var(--text-secondary)"},onClick:r=>{r.stopPropagation(),(n==="adversary"||n==="adversaries")&&(i===1?v.setDamageValue("1"):i===2?v.setDamageValue(t.thresholds.major.toString()):i===3&&v.setDamageValue(t.thresholds.severe.toString()))},title:`Click to set damage to ${i===1?"1":i===2?t.thresholds.major:t.thresholds.severe}`,children:e.jsx(J,{size:16})},i)}),e.jsx("button",{style:{...$.applyButton,backgroundColor:"var(--gray-600)"},onClick:i=>{i.stopPropagation(),(n==="adversary"||n==="adversaries")&&(!v.damageValue||parseInt(v.damageValue)<1?(v.setShowDamageInput(!1),v.setDamageValue("")):v.applyDamage())},title:!v.damageValue||parseInt(v.damageValue)<1?"Close damage input":"Apply damage",children:!v.damageValue||parseInt(v.damageValue)<1?e.jsx(fe,{size:16}):e.jsx(Le,{size:16})})]})]})}),g=()=>{var o;const i=(t.hp||0)>=(t.hpMax||1),f=p==="edit";return e.jsxs("div",{className:k(),style:{...D(!0),padding:0,minHeight:"400px",opacity:i?.7:1,backgroundColor:i?"var(--gray-900)":D(!0).backgroundColor,borderColor:i?"color-mix(in srgb, var(--gray-600) 40%, transparent)":S?"var(--purple)":N&&p!=="expanded"?"var(--border-hover)":"var(--border)",borderWidth:"2px",display:"flex",flexDirection:"column",position:"relative"},onClick:m,...p!=="expanded"&&{onMouseEnter:M,onMouseLeave:W},children:[i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                45deg,
                transparent,
                transparent 8px,
                var(--gray-600) 1px,
                var(--gray-600) 9px
              )`,pointerEvents:"none",zIndex:9999}}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"var(--text-secondary)",fontSize:"1rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em",zIndex:1e4,pointerEvents:"none",textShadow:"1px 1px 2px rgba(0, 0, 0, 0.5)",backgroundColor:"var(--gray-900)",padding:"0.25rem 0.5rem",borderRadius:"0.5rem",border:"0.5px solid var(--gray-600)"},children:"DEFEATED"})]}),e.jsx("div",{className:"border-b",style:{padding:"12px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative",zIndex:i?1:"auto",borderBottomColor:S?"var(--purple)":"var(--border)"},children:e.jsx("div",{style:{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",zIndex:i?1:"auto"},children:e.jsx("h4",{style:{...$.rowTitle,color:i?"color-mix(in srgb, var(--gray-400) 80%, transparent)":$.rowTitle.color,textAlign:"left",margin:0,fontSize:"1.1rem"},children:((o=t.name)==null?void 0:o.replace(/\s+\(\d+\)$/,""))||t.name})})}),e.jsxs("div",{style:{borderRadius:"0 0 8px 8px"},children:[e.jsx("div",{style:{marginBottom:"1rem",padding:"0 12px 0.75rem 12px",borderBottom:"1px solid var(--border)"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",fontSize:"0.875rem"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px"},children:[e.jsx(re,{size:32,style:{color:"var(--text-primary)",transform:"rotate(0deg)"}}),e.jsx("span",{style:{position:"absolute",fontSize:"0.75rem",fontWeight:600,color:"var(--text-primary)",textAlign:"center"},children:t.difficulty||"~"})]}),e.jsx("span",{style:{fontSize:"0.875rem",fontWeight:500},children:"Difficulty"})]})}),(t.atk!==void 0||t.weapon||t.damage)&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[t.atk!==void 0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[e.jsx(De,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)"}}),e.jsxs("span",{style:{position:"absolute",fontSize:"0.875rem",fontWeight:600,color:"white",pointerEvents:"none"},children:[t.atk>=0?"+":"",t.atk]})]}),t.weapon&&e.jsxs("span",{children:[e.jsxs("strong",{children:[t.weapon,":"]})," ",t.range||"Melee"]}),t.damage&&e.jsxs("span",{children:[e.jsx("strong",{children:"Damage:"})," ",t.damage]})]}),t.experience&&t.experience.length>0&&e.jsxs("div",{children:[e.jsx("strong",{children:"Experience:"})," ",t.experience.map(r=>typeof r=="string"?r:`${r.name} ${r.modifier>=0?"+":""}${r.modifier}`).join(", ")]})]})}),t.features&&t.features.length>0&&e.jsxs("div",{style:{marginBottom:"1rem",padding:"0 12px"},children:[t.features.filter(r=>r.type==="Passive").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px",textAlign:"center",minWidth:"80px"},children:"Passives"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:t.features.filter(r=>r.type==="Passive").map((r,c)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:r.name}),r.description&&e.jsxs("span",{children:[" - ",r.description]})]},c))})]}),t.features.filter(r=>r.type==="Action").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px",textAlign:"center",minWidth:"80px"},children:"Actions"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:t.features.filter(r=>r.type==="Action").map((r,c)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:r.name}),r.description&&e.jsxs("span",{children:[" - ",r.description]})]},c))})]}),t.features.filter(r=>r.type==="Reaction").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px",textAlign:"center",minWidth:"80px"},children:"Reactions"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:t.features.filter(r=>r.type==="Reaction").map((r,c)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:r.name}),r.description&&e.jsxs("span",{children:[" - ",r.description]})]},c))})]})]})]}),t.type!=="Minion"&&t.thresholds&&e.jsx("div",{style:{marginTop:"1rem",padding:"0.75rem 12px 0 12px",borderTop:"1px solid var(--border)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",fontSize:"0.875rem"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"2px",marginTop:"-3px"},children:e.jsx(J,{size:16,style:{color:"var(--red)"}})}),e.jsx(pe,{value:t.thresholds.major||"7"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"2px",marginTop:"-3px"},children:[e.jsx(J,{size:16,style:{color:"var(--red)"}}),e.jsx(J,{size:16,style:{color:"var(--red)"}})]}),e.jsx(pe,{value:t.thresholds.severe||"14"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"2px",marginTop:"-3px"},children:[e.jsx(J,{size:16,style:{color:"var(--red)"}}),e.jsx(J,{size:16,style:{color:"var(--red)"}}),e.jsx(J,{size:16,style:{color:"var(--red)"}})]})]})}),F&&F.length>0&&e.jsx("div",{style:{marginTop:"1rem",borderTop:"1px solid var(--border)"},children:F.map((r,c)=>{var H,_;const h=(r.hp||0)>=(r.hpMax||1);return e.jsx("div",{children:e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",borderRadius:"4px",padding:"4px",border:"1px solid var(--border)",marginBottom:"4px",display:"flex",justifyContent:"flex-start",alignItems:"center",gap:"8px",opacity:h?.7:1,backgroundColor:h?"var(--gray-900)":"var(--bg-secondary)",borderColor:h?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--border)",position:"relative"},children:[h&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                          45deg,
                          transparent 0px,
                          transparent 8px,
                          var(--gray-600) 9px,
                          var(--gray-600) 9px
                        )`,pointerEvents:"none",zIndex:1,borderRadius:"4px"}}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"var(--text-secondary)",fontSize:"0.75rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em",zIndex:2,backgroundColor:"var(--gray-900)",padding:"0.125rem 0.25rem",borderRadius:"0.25rem",border:"0.5px solid var(--gray-600)"},children:"DEFEATED"})]}),e.jsx("div",{style:{backgroundColor:"var(--bg-secondary)",borderRadius:"6px",border:"1px solid var(--border-hover)",width:"32px",textAlign:"center",flexShrink:0,padding:"2px"},children:e.jsx("span",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)"},children:r.duplicateNumber||((_=(H=r.name)==null?void 0:H.match(/\((\d+)\)/))==null?void 0:_[1])||"1"})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"2px"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:R=>{if(R.stopPropagation(),!d||n!=="adversary")return;R.currentTarget.getBoundingClientRect();const L=R.currentTarget.querySelector(".pip-container");if(!L)return;const q=L.getBoundingClientRect(),G=R.clientX-q.left,X=r.hp||0,U=r.hpMax||1;if(G<0){X>0&&x&&x(r.id,1,X);return}if(G>q.width){X<U&&d(r.id,1,X,U);return}const Z=q.width,b=Z*.05,B=Z-2*b,O=G-b,V=X/U,Q=B*V;O<Q?X>0&&x&&x(r.id,1,X):X<U&&d(r.id,1,X,U)},children:e.jsx("div",{className:"pip-container",style:{display:"flex",gap:"2px",alignItems:"center"},children:Array.from({length:r.hpMax||1},(R,L)=>e.jsx("span",{style:{fontSize:"0.75rem",color:L<(r.hp||0)?"var(--red)":"var(--text-secondary)",transition:"all 0.1s ease"},children:e.jsx(J,{size:16})},L))})}),r.stressMax>0&&e.jsx("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:R=>{if(R.stopPropagation(),!w||n!=="adversary")return;R.currentTarget.getBoundingClientRect();const L=R.currentTarget.querySelector(".pip-container");if(!L)return;const q=L.getBoundingClientRect(),G=R.clientX-q.left,X=r.stress||0,U=r.stressMax;if(G<0){X>0&&w(r.id,-1);return}if(G>q.width){X<U&&w(r.id,1);return}const Z=q.width,b=Z*.05,B=Z-2*b,O=G-b,V=X/U,Q=B*V;O<Q?X>0&&w(r.id,-1):X<U&&w(r.id,1)},children:e.jsx("div",{className:"pip-container",style:{display:"flex",gap:"2px",alignItems:"center"},children:Array.from({length:r.stressMax},(R,L)=>e.jsx("span",{style:{fontSize:"0.75rem",color:L<(r.stress||0)?"var(--gold)":"var(--text-secondary)",transition:"all 0.1s ease"},children:e.jsx(ge,{size:16})},L))})})]})]},r.id)},r.id)})}),t.motives&&e.jsxs("div",{style:{marginTop:"1rem",padding:"0.75rem 12px 0 12px",borderTop:"1px solid var(--border)"},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:"0 0 0.5rem 0"},children:"Motives"}),f?e.jsx("textarea",{style:{width:"100%",minHeight:"80px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-secondary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"vertical",fontFamily:"inherit"},value:t.motives,onChange:r=>{u&&u(t.id,{motives:r.target.value})},placeholder:"Enter adversary motives..."}):e.jsx("p",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",margin:0,whiteSpace:"pre-wrap"},children:t.motives})]}),t.description&&e.jsxs("div",{style:{marginTop:"1rem",padding:"0.75rem 12px 0 12px",borderTop:"1px solid var(--border)"},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:"0 0 0.5rem 0"},children:"Description"}),f?e.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-secondary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"vertical",fontFamily:"inherit"},value:t.description,onChange:r=>{u&&u(t.id,{description:r.target.value})},placeholder:"Enter adversary description..."}):e.jsx("p",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",margin:0,whiteSpace:"pre-wrap"},children:t.description})]}),a()]})},l=()=>{const f=p==="edit";return e.jsxs("div",{className:k(),style:{...D(!0),padding:0,minHeight:"400px",display:"flex",flexDirection:"column",position:"relative"},onClick:m,...p!=="expanded"&&{onMouseEnter:M,onMouseLeave:W},children:[e.jsx("div",{className:"border-b",style:{padding:"12px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.25rem"},children:[e.jsx("h2",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:0},children:t.name}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[t.tier&&e.jsxs("span",{style:{fontSize:"0.75rem",fontWeight:500,color:"var(--text-secondary)",letterSpacing:"0.5px"},children:["Tier ",t.tier]}),t.type&&e.jsx("span",{style:{fontSize:"0.75rem",fontWeight:500,color:"var(--text-secondary)",letterSpacing:"0.5px"},children:t.type})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.difficulty&&e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[e.jsx(re,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)"}}),e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",fontWeight:700,color:"white",pointerEvents:"none"},children:t.difficulty})]}),!1]})]})}),e.jsxs("div",{style:{flex:1,overflowY:"auto",borderRadius:"0 0 8px 8px"},children:[t.description&&e.jsxs("div",{style:{marginBottom:"1rem",padding:"0 12px 0.75rem 12px",borderBottom:"1px solid var(--border)"},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:"0 0 0.5rem 0"},children:"Description"}),f?e.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-secondary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"vertical",fontFamily:"inherit"},value:t.description,onChange:o=>{u&&u(t.id,{description:o.target.value})},placeholder:"Enter environment description..."}):e.jsx("p",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",margin:0,whiteSpace:"pre-wrap"},children:t.description})]}),t.impulses&&e.jsxs("div",{style:{marginBottom:"1rem",padding:"0 12px 0.75rem 12px",borderBottom:"1px solid var(--border)"},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:"0 0 0.5rem 0"},children:"Impulses"}),e.jsx("p",{style:{fontSize:"0.875rem",lineHeight:1.5,color:"var(--text-secondary)",margin:0,whiteSpace:"pre-wrap"},children:t.impulses})]}),e.jsxs("div",{style:{marginBottom:"1rem",padding:"0 12px 0.75rem 12px",borderBottom:"1px solid var(--border)"},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:"0 0 0.5rem 0"},children:"Core Stats"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",fontSize:"0.875rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap",fontSize:"0.875rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px"},children:[e.jsx(re,{size:32,style:{color:"var(--text-primary)",transform:"rotate(0deg)"}}),e.jsx("span",{style:{position:"absolute",fontSize:"0.75rem",fontWeight:600,color:"var(--text-primary)",textAlign:"center"},children:t.difficulty||"~"})]}),e.jsx("span",{style:{fontSize:"0.875rem",fontWeight:500},children:"Difficulty"})]}),e.jsxs("span",{children:[e.jsx("strong",{children:"Type:"})," ",t.type]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx("span",{children:e.jsx("strong",{children:"Tier:"})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[e.jsx(Re,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)"}}),e.jsx("span",{style:{position:"absolute",fontSize:"0.875rem",fontWeight:600,color:"white",pointerEvents:"none"},children:t.tier})]})]})]}),t.potentialAdversaries&&t.potentialAdversaries.length>0&&e.jsxs("div",{children:[e.jsx("strong",{children:"Potential Adversaries:"}),e.jsx("div",{style:{marginTop:"0.25rem",display:"flex",flexDirection:"column",gap:"0.125rem"},children:t.potentialAdversaries.map((o,r)=>e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",marginLeft:"0.5rem"},children:["• ",o]},r))})]})]})]}),t.features&&t.features.length>0&&e.jsxs("div",{style:{marginBottom:"1rem",padding:"0 12px"},children:[t.features.filter(o=>o.type==="Passive").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px",textAlign:"center",minWidth:"80px"},children:"Passives"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:t.features.filter(o=>o.type==="Passive").map((o,r)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("div",{style:{fontWeight:600,color:"white",marginBottom:"0.25rem"},children:o.name}),e.jsx("div",{style:{marginBottom:"0.25rem"},children:o.description}),o.details&&o.details.length>0&&e.jsxs("div",{style:{marginLeft:"0.5rem"},children:[e.jsx("strong",{children:"Details:"}),e.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:o.details.map((c,h)=>e.jsx("li",{children:c},h))})]}),o.prompts&&o.prompts.length>0&&e.jsxs("div",{style:{marginLeft:"0.5rem"},children:[e.jsx("strong",{children:"Prompts:"}),e.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:o.prompts.map((c,h)=>e.jsxs("li",{style:{fontStyle:"italic"},children:['"',c,'"']},h))})]})]},r))})]}),t.features.filter(o=>o.type==="Action").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px",textAlign:"center",minWidth:"80px"},children:"Actions"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:t.features.filter(o=>o.type==="Action").map((o,r)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("div",{style:{fontWeight:600,color:"white",marginBottom:"0.25rem"},children:o.name}),e.jsx("div",{style:{marginBottom:"0.25rem"},children:o.description}),o.details&&o.details.length>0&&e.jsxs("div",{style:{marginLeft:"0.5rem"},children:[e.jsx("strong",{children:"Details:"}),e.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:o.details.map((c,h)=>e.jsx("li",{children:c},h))})]}),o.prompts&&o.prompts.length>0&&e.jsxs("div",{style:{marginLeft:"0.5rem"},children:[e.jsx("strong",{children:"Prompts:"}),e.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:o.prompts.map((c,h)=>e.jsxs("li",{style:{fontStyle:"italic"},children:['"',c,'"']},h))})]})]},r))})]}),t.features.filter(o=>o.type==="Reaction").length>0&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"white",margin:0,textTransform:"uppercase",letterSpacing:"0.5px",textAlign:"center",minWidth:"80px"},children:"Reactions"}),e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:t.features.filter(o=>o.type==="Reaction").map((o,r)=>e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("div",{style:{fontWeight:600,color:"white",marginBottom:"0.25rem"},children:o.name}),e.jsx("div",{style:{marginBottom:"0.25rem"},children:o.description}),o.details&&o.details.length>0&&e.jsxs("div",{style:{marginLeft:"0.5rem"},children:[e.jsx("strong",{children:"Details:"}),e.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:o.details.map((c,h)=>e.jsx("li",{children:c},h))})]}),o.prompts&&o.prompts.length>0&&e.jsxs("div",{style:{marginLeft:"0.5rem"},children:[e.jsx("strong",{children:"Prompts:"}),e.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:o.prompts.map((c,h)=>e.jsxs("li",{style:{fontStyle:"italic"},children:['"',c,'"']},h))})]})]},r))})]})]}),F&&F.length>0&&e.jsx("div",{style:{marginTop:"1rem",borderTop:"1px solid var(--border)"},children:F.map((o,r)=>{var h,H;const c=(o.hp||0)>=(o.hpMax||1);return e.jsx("div",{children:e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",borderRadius:"4px",padding:"8px",border:"1px solid var(--border)",marginBottom:"4px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"8px",opacity:c?.7:1,backgroundColor:c?"var(--gray-900)":"var(--bg-secondary)",borderColor:c?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--border)",position:"relative"},children:[c&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                            45deg,
                            transparent 0px,
                            transparent 8px,
                            var(--gray-600) 9px,
                            var(--gray-600) 9px
                          )`,pointerEvents:"none",zIndex:1,borderRadius:"4px"}}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"var(--text-secondary)",fontSize:"0.75rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em",zIndex:2,backgroundColor:"var(--gray-900)",padding:"0.125rem 0.25rem",borderRadius:"0.25rem",border:"0.5px solid var(--gray-600)"},children:"DEFEATED"})]}),e.jsx("div",{style:{backgroundColor:"var(--bg-secondary)",borderRadius:"3px",padding:"2px 6px",border:"1px solid var(--border)",minWidth:"24px",textAlign:"center"},children:e.jsx("span",{style:{fontSize:"0.75rem",fontWeight:600,color:"var(--text-primary)"},children:o.duplicateNumber||((H=(h=o.name)==null?void 0:h.match(/\((\d+)\)/))==null?void 0:H[1])||"1"})}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:1},children:e.jsxs("span",{style:{fontSize:"0.75rem",fontWeight:500,color:"var(--text-secondary)"},children:["Instance ",r+1]})})]},o.id)},o.id)})})]})]})};return(p==="expanded"||p==="edit")&&(n==="adversary"||n==="adversaries")?g():(p==="expanded"||p==="edit")&&(n==="environment"||n==="environments")?l():n==="adversary"||n==="adversaries"||n==="environment"||n==="environments"?null:e.jsxs("div",{className:k(),style:D(!0),children:[e.jsxs("div",{style:$.rowMain,children:[e.jsx("h4",{style:$.rowTitle,children:P()}),e.jsx("div",{style:$.rowMeta,children:T()})]}),e.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"12px",margin:0},children:["Expanded view coming soon for ",n]})]})},et="modulepreload",tt=function(t){return"/Daggerheart/"+t},xe={},he=function(n,p,m){if(!p||p.length===0)return n();const y=document.getElementsByTagName("link");return Promise.all(p.map(d=>{if(d=tt(d),d in xe)return;xe[d]=!0;const x=d.endsWith(".css"),w=x?'[rel="stylesheet"]':"";if(!!m)for(let S=y.length-1;S>=0;S--){const z=y[S];if(z.href===d&&(!x||z.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${w}`))return;const I=document.createElement("link");if(I.rel=x?"stylesheet":et,x||(I.as="script",I.crossOrigin=""),I.href=d,document.head.appendChild(I),x)return new Promise((S,z)=>{I.addEventListener("load",S),I.addEventListener("error",()=>z(new Error(`Unable to preload CSS for ${d}`)))})})).then(()=>n()).catch(d=>{const x=new Event("vite:preloadError",{cancelable:!0});if(x.payload=d,window.dispatchEvent(x),!x.defaultPrevented)throw d})};let je={adversaries:[]},we={environments:[]};const rt=async()=>{try{const t=await he(()=>import("./adversaries-e62ea4d8.js"),[]);je=(t==null?void 0:t.default)||t}catch(t){console.warn("Failed to load adversaries.json:",t)}try{const t=await he(()=>import("./environments-5ca1c1e1.js"),[]);we=(t==null?void 0:t.default)||t}catch(t){console.warn("Failed to load environments.json:",t)}},nt=t=>{const[n,p]=j.useState(""),[m,y]=j.useState([{field:"tier",direction:"asc"},{field:"name",direction:"asc"}]),[d,x]=j.useState([]),[w,u]=j.useState(!0),[I,S]=j.useState([]),[z,F]=j.useState([]),[C,v]=j.useState(!1),[N,E]=j.useState(!1),M=j.useRef(null),W=j.useRef(null);j.useEffect(()=>{(async()=>{await rt(),u(!1);let r=[];t==="adversary"?r=je.adversaries||[]:t==="environment"&&(r=we.environments||[]),x(r)})()},[t]);const D=o=>{const r=d.map(c=>c[o]).filter(Boolean);return[...new Set(r)].sort((c,h)=>typeof c=="number"&&typeof h=="number"?c-h:String(c).localeCompare(String(h)))},k=D("tier"),P=D("type"),T=j.useMemo(()=>{let o=d.filter(r=>{var _,R;const c=r.name.toLowerCase().includes(n.toLowerCase())||((_=r.type)==null?void 0:_.toLowerCase().includes(n.toLowerCase()))||((R=r.description)==null?void 0:R.toLowerCase().includes(n.toLowerCase())),h=I.length===0||I.includes(r.tier.toString()),H=z.length===0||z.includes(r.type);return c&&h&&H});return o.sort((r,c)=>{for(const h of m){const{field:H,direction:_}=h;let R=r[H],L=c[H];if(H==="tier")R=parseInt(R)||0,L=parseInt(L)||0;else if(H==="difficulty"){const q=parseInt(R),G=parseInt(L);!isNaN(q)&&!isNaN(G)?(R=q,L=G):!isNaN(q)&&isNaN(G)?(R=q,L=999):isNaN(q)&&!isNaN(G)?(R=999,L=G):(R=String(R||"").toLowerCase(),L=String(L||"").toLowerCase())}else typeof R=="string"&&typeof L=="string"?(R=R.toLowerCase(),L=L.toLowerCase()):(R=String(R||"").toLowerCase(),L=String(L||"").toLowerCase());if(_==="asc"){if(R>L)return 1;if(R<L)return-1}else{if(R<L)return 1;if(R>L)return-1}}return 0}),o},[d,n,m,I,z]),a=o=>{y(r=>{const c=r.findIndex(h=>h.field===o);if(c>=0)if(c===0){const h=[...r];return h[0]={...h[0],direction:h[0].direction==="asc"?"desc":"asc"},h}else{const h=[...r];return h.splice(c,1)[0],[{field:o,direction:"asc"},...h]}else return[{field:o,direction:"asc"},...r]})},g=o=>{S(o==="clear"?[]:r=>r.includes(o)?r.filter(c=>c!==o):[...r,o])},l=o=>{F(o==="clear"?[]:r=>r.includes(o)?r.filter(c=>c!==o):[...r,o])},s=I.length>0,i=z.length>0;return j.useEffect(()=>{const o=c=>{const h=c.target.closest(".filter-dropdown"),H=c.target.closest(".header-filter-icon");h||H||(v(!1),E(!1))},r=c=>{c.key==="Escape"&&(v(!1),E(!1))};return document.addEventListener("pointerdown",o,!0),document.addEventListener("mousedown",o,!0),document.addEventListener("touchstart",o,!0),document.addEventListener("click",o,!0),document.addEventListener("keydown",r,!0),()=>{document.removeEventListener("pointerdown",o,!0),document.removeEventListener("mousedown",o,!0),document.removeEventListener("touchstart",o,!0),document.removeEventListener("click",o,!0),document.removeEventListener("keydown",r,!0)}},[v,E]),{searchTerm:n,setSearchTerm:p,sortFields:m,handleSort:a,filteredAndSortedData:T,loading:w,selectedTiers:I,selectedTypes:z,showTierDropdown:C,setShowTierDropdown:v,showTypeDropdown:N,setShowTypeDropdown:E,tierFilterRef:M,typeFilterRef:W,uniqueTiers:k,uniqueTypes:P,handleTierSelect:g,handleTypeSelect:l,isTierFiltered:s,isTypeFiltered:i,getDropdownStyle:o=>{if(!o.current)return{};const r=o.current.getBoundingClientRect();return{position:"fixed",top:r.bottom+4,left:r.left-100,zIndex:99999}}}},ot=({searchTerm:t,onSearchChange:n,type:p})=>e.jsx("div",{style:A.browserHeader,children:e.jsx("input",{type:"text",placeholder:"Search",value:t,onChange:m=>n(m.target.value),style:A.searchInput})}),it=({sortFields:t,onSort:n,type:p,uniqueTiers:m,uniqueTypes:y,selectedTiers:d,selectedTypes:x,showTierDropdown:w,setShowTierDropdown:u,showTypeDropdown:I,setShowTypeDropdown:S,tierFilterRef:z,typeFilterRef:F,handleTierSelect:C,handleTypeSelect:v,isTierFiltered:N,isTypeFiltered:E,getDropdownStyle:M})=>{const[W,D]=j.useState(null),P=(()=>p==="adversary"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:p==="environment"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"},{key:"action",label:""}]:[])(),T=(a,g,l,s,i,f,o,r)=>{if(!i)return null;const c=()=>{(a==="tier"||a==="type")&&s("clear")};return ue.createPortal(e.jsxs("div",{className:"filter-dropdown",style:{...A.filterDropdown,...M(o),maxHeight:"60vh",overflow:"auto"},onMouseDown:h=>h.stopPropagation(),onClick:h=>h.stopPropagation(),children:[e.jsxs("div",{style:{...A.filterOption,...l.length===0?A.filterOptionSelected:{}},onClick:c,children:[e.jsx("span",{style:A.checkIcon,children:l.length===0?e.jsx(ae,{size:16}):e.jsx(le,{size:16})}),e.jsx("span",{style:A.filterLabel,children:"All"})]}),g.map(h=>{const H=l.includes(h.toString());return e.jsxs("div",{style:{...A.filterOption,...H?A.filterOptionSelected:{}},onClick:()=>s(h.toString()),children:[e.jsx("span",{style:A.checkIcon,children:H?e.jsx(ae,{size:16}):e.jsx(le,{size:16})}),e.jsx("span",{style:A.filterLabel,children:h})]},h)})]}),document.body)};return e.jsx("tr",{style:A.tableHeader,children:P.map(a=>e.jsxs("th",{style:{...A.tableHeaderCell,...W===a.key?A.tableHeaderCellHover:{},position:"relative",...a.key==="name"?{width:"auto",minWidth:"0"}:{},...a.key==="tier"?{width:"80px",minWidth:"80px",maxWidth:"80px"}:{},...a.key==="type"?{width:"100px",minWidth:"100px",maxWidth:"100px"}:{},...a.key==="difficulty"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...a.key==="action"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{}},onClick:()=>n(a.key),onMouseEnter:()=>D(a.key),onMouseLeave:()=>D(null),children:[a.hasFilter?e.jsxs("div",{style:A.headerWithFilter,children:[e.jsx("span",{style:{cursor:"pointer"},onClick:g=>{g.stopPropagation(),n(a.key)},children:a.label}),e.jsxs("button",{ref:a.key==="tier"?z:F,style:{...A.headerFilterIcon,...a.key==="tier"&&N?A.headerFilterIconActive:{},...a.key==="type"&&E?A.headerFilterIconActive:{}},className:"header-filter-icon",onClick:g=>{g.stopPropagation(),a.key==="tier"?(u(!w),S(!1)):a.key==="type"&&(S(!I),u(!1))},children:[e.jsx(Be,{size:14}),a.key==="tier"&&N||a.key==="type"&&E?e.jsx("span",{style:A.filterActiveDot}):null]})]}):a.label,a.key==="tier"&&T("tier",m,d,C,w,u,z),a.key==="type"&&T("type",y,x,v,I,S,F)]},a.key))})},st=({item:t,onAdd:n,type:p,onRowClick:m})=>{const[y,d]=j.useState(!1),x=()=>{n(t)},w=()=>p==="adversary"?e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...A.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:t.name}),e.jsx("td",{style:{...A.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:t.tier}),e.jsx("td",{style:{...A.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:t.type}),e.jsx("td",{style:{...A.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:t.difficulty})]}):p==="environment"?e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...A.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:t.name}),e.jsx("td",{style:{...A.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:t.tier}),e.jsx("td",{style:{...A.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:t.type}),e.jsx("td",{style:{...A.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:t.difficulty})]}):null;return e.jsx(e.Fragment,{children:e.jsxs("tr",{style:{...A.row,...y?A.rowHover:{}},onClick:()=>m&&m(t,p),onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),children:[w(),e.jsx("td",{style:{width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",boxSizing:"border-box",overflow:"visible",textOverflow:"unset",whiteSpace:"nowrap"},children:e.jsx("button",{style:A.addButton,onClick:u=>{u.stopPropagation(),x()},onMouseEnter:u=>{u.target.style.background="var(--bg-secondary)"},onMouseLeave:u=>{u.target.style.background="var(--purple)"},children:"+"})})]})})},at=({type:t,onAddItem:n,onCancel:p,onRowClick:m})=>{const{searchTerm:y,setSearchTerm:d,sortFields:x,handleSort:w,filteredAndSortedData:u,loading:I,selectedTiers:S,selectedTypes:z,showTierDropdown:F,setShowTierDropdown:C,showTypeDropdown:v,setShowTypeDropdown:N,tierFilterRef:E,typeFilterRef:M,uniqueTiers:W,uniqueTypes:D,handleTierSelect:k,handleTypeSelect:P,isTierFiltered:T,isTypeFiltered:a,getDropdownStyle:g}=nt(t);return I?e.jsx("div",{style:A.browser,children:e.jsx("div",{style:A.loading,children:"Loading..."})}):e.jsxs("div",{style:A.browserWrapper,children:[e.jsx(ot,{searchTerm:y,onSearchChange:d,type:t}),e.jsx("div",{className:"browser-content",style:A.browserContent,children:e.jsxs("table",{style:A.browserTable,children:[e.jsx("thead",{children:e.jsx(it,{sortFields:x,onSort:w,type:t,uniqueTiers:W,uniqueTypes:D,selectedTiers:S,selectedTypes:z,showTierDropdown:F,setShowTierDropdown:C,showTypeDropdown:v,setShowTypeDropdown:N,tierFilterRef:E,typeFilterRef:M,handleTierSelect:k,handleTypeSelect:P,isTierFiltered:T,isTypeFiltered:a,getDropdownStyle:g})}),e.jsx("tbody",{children:u.map(l=>e.jsx(st,{item:l,onAdd:n,type:t,onRowClick:m},l.id))})]})})]})},A={browserWrapper:{display:"flex",flexDirection:"column",background:"var(--bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border)",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserContent:{flex:1,overflowY:"auto",overflowX:"visible",padding:0,width:"100%"},tableHeaderContainer:{flexShrink:0,position:"sticky",top:0,zIndex:15,backgroundColor:"var(--bg-secondary)"},browserTable:{width:"100%",minWidth:"100%",borderCollapse:"collapse",tableLayout:"fixed",background:"var(--bg-primary)",margin:0},browserHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--gray-900)",flexShrink:0,position:"sticky",top:0,zIndex:20},browserTitle:{margin:0,color:"var(--text-primary)",fontSize:"18px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"24px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"14px",marginRight:"12px",transition:"all 0.2s ease"},searchInputFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 3px rgba(139, 92, 246, 0.1)"},tableHeader:{background:"var(--gray-900)",borderBottom:"1px solid var(--border)",boxShadow:"0 1px 0 var(--border)",position:"sticky",top:"0",zIndex:10},tableHeaderCell:{backgroundColor:"var(--gray-900)",fontWeight:"700",borderBottom:"1px solid var(--border)",cursor:"pointer",userSelect:"none",minWidth:"100px",whiteSpace:"nowrap",padding:"4px 4px",color:"var(--text-primary)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",boxShadow:"0 1px 0 var(--border)",transition:"background-color 0.2s",position:"sticky",top:"0",zIndex:10},tableHeaderCellHover:{backgroundColor:"var(--bg-hover)"},sortIndicator:{fontSize:"12px",color:"var(--text-secondary)"},tableBody:{flex:1,overflowY:"auto",padding:"8px",backgroundColor:"var(--bg-primary)"},row:{height:"35px",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s ease",cursor:"pointer",backgroundColor:"var(--gray-900)"},rowHover:{backgroundColor:"var(--bg-secondary)"},expandedRow:{backgroundColor:"var(--bg-secondary)"},rowCell:{padding:"4px 4px",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid var(--border)"},rowCellName:{fontWeight:"500",minWidth:"150px"},rowCellCenter:{textAlign:"center",justifyContent:"center",minWidth:"80px"},rowActions:{width:"80px",textAlign:"center",padding:"4px 8px",borderBottom:"1px solid var(--border)"},addButton:{width:"2rem",height:"2rem",border:"1px solid var(--purple)",borderRadius:"var(--radius-sm)",background:"var(--purple)",color:"white",cursor:"pointer",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"500"},expandedContent:{padding:"0",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)"},columnName:{width:"auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",paddingLeft:"8px",textAlign:"left"},columnTier:{width:"80px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnType:{width:"100px",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},columnDifficulty:{width:"40px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnAction:{width:"32px",minWidth:"24px",maxWidth:"24px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"visible",textOverflow:"unset"},loading:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"var(--text-primary)",fontSize:"16px"},mobileBrowser:{width:"95vw",height:"90vh",maxWidth:"none"},mobileSearchInput:{fontSize:"16px"},headerWithFilter:{display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",position:"relative"},headerFilterIcon:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"2px 4px",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",position:"relative"},headerFilterIconActive:{color:"var(--purple)"},filterIcon:{fontSize:"12px"},filterActiveDot:{position:"absolute",left:"50%",top:"2px",transform:"translateX(-50%)",width:"4px",height:"4px",borderRadius:"50%",background:"var(--purple)",pointerEvents:"none"},filterDropdown:{position:"absolute",top:"100%",left:"0",background:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",zIndex:99999,marginTop:"4px",overflow:"hidden",width:"max-content",minWidth:"120px",maxWidth:"200px"},filterOption:{padding:"8px 12px",cursor:"pointer",color:"var(--text-primary)",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background-color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},filterOptionSelected:{backgroundColor:"var(--bg-hover)"},checkIcon:{width:"16px",height:"16px",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"12px"},filterLabel:{flex:1}},lt=()=>e.jsx("div",{className:"pwa-install-prompt",style:{}}),me=({side:t="left",children:n,className:p="",style:m={}})=>{const y=t==="left",d={flex:1,minWidth:0,background:"var(--bg-primary)",overflowY:"auto",overflowX:y?"auto":"hidden",display:y?"block":"flex",flexDirection:y?"initial":"column",height:"100%",padding:y?"1rem 0 1rem 0":"0 1rem 0 0",...m};return e.jsx("div",{className:p,style:d,children:n})};class dt extends ie.Component{constructor(n){super(n),this.state={hasError:!1,error:null}}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,p){console.error("ErrorBoundary caught an error:",n,p)}render(){var n;return this.state.hasError?e.jsxs("div",{className:"p-md text-red",children:[e.jsx("h3",{children:"Something went wrong:"}),e.jsx("pre",{children:(n=this.state.error)==null?void 0:n.toString()}),e.jsx("button",{className:"btn-base btn-text",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try again"})]}):this.props.children}}const ct=()=>{const{adversaries:t,environments:n,countdowns:p,fear:m,updateFear:y,createAdversary:d,updateAdversary:x,deleteAdversary:w,createEnvironment:u,updateEnvironment:I,deleteEnvironment:S,createCountdown:z,updateCountdown:F,deleteCountdown:C,advanceCountdown:v}=Xe(),[N,E]=j.useState(!1),[M,W]=j.useState(!1),[D,k]=j.useState("adversary");j.useState(!1);const[P,T]=j.useState(!1);j.useState(!0);const[a,g]=j.useState(null),[l,s]=j.useState(0),[i,f]=j.useState(0),[o,r]=j.useState(!1);j.useEffect(()=>{const b=()=>{const O=window.matchMedia("(max-width: 800px)");E(O.matches)};b();const B=window.matchMedia("(max-width: 800px)");return B.addEventListener("change",b),()=>B.removeEventListener("change",b)},[]);const c=16,h=250,H=500,_=b=>{if(b<=0)return{visibleColumns:1,columnWidth:h};const B=c*2,O=b-B;let V={visibleColumns:1,columnWidth:Math.min(O,H)};for(let Y=1;Y<=5;Y++){const K=(Y-1)*c,ee=(O-K)/Y;ee>=h&&ee<=H&&Y*ee+K<=O&&Y>V.visibleColumns&&(V={visibleColumns:Y,columnWidth:ee})}return V.visibleColumns*V.columnWidth+(V.visibleColumns-1)*c>O&&(V={visibleColumns:1,columnWidth:Math.min(O,H)}),V},{visibleColumns:R,columnWidth:L}=_(l);j.useEffect(()=>{const b=()=>{s(window.innerWidth)};return b(),window.addEventListener("resize",b),()=>window.removeEventListener("resize",b)},[]);const q=(b="unified")=>{let B=b;b==="adversaries"?B="adversary":b==="environments"&&(B="environment"),M&&D===B?W(!1):(k(B),W(!0))},G=j.useCallback(()=>{W(!1)},[]),X=j.useCallback(b=>{f(b.target.scrollLeft)},[]);j.useCallback(()=>{r(!0)},[]),j.useCallback(()=>{setTimeout(()=>r(!1),100)},[]);const Z=(()=>{const b={};return t.forEach(B=>{var V;const O=B.baseName||((V=B.name)==null?void 0:V.replace(/\s+\(\d+\)$/,""))||B.name;b[O]||(b[O]={type:"adversary",baseName:O,instances:[]}),b[O].instances.push(B)}),n.forEach(B=>{b[B.name]||(b[B.name]={type:"environment",baseName:B.name,instances:[]}),b[B.name].instances.push(B)}),p.forEach(B=>{b[`countdown-${B.id}`]={type:"countdown",baseName:B.name,instances:[B]}}),Object.values(b)})();return Z.length,e.jsxs("div",{className:"app",onClick:b=>{b.target,b.currentTarget},children:[e.jsx(Ue,{adversaries:t,environments:n,countdowns:p,deleteAdversary:w,deleteEnvironment:S,deleteCountdown:C,isClearMode:P,setIsClearMode:T,sortAdversaries:()=>{},onOpenDatabase:q}),e.jsx("div",{className:"main-content",style:{position:"relative",width:"100%"},children:e.jsx("div",{className:"dashboard-scroll-container",style:{display:"flex",flexDirection:"row",overflowX:"auto",overflowY:"hidden",padding:`0 ${c}px`,scrollSnapType:"x mandatory",height:"100%",width:"100%"},onScroll:X,children:M?e.jsxs(me,{className:"invisible-scrollbar",style:{width:`${L+c}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:`${c}px`,paddingRight:"0",paddingTop:`${c}px`,paddingBottom:`${c}px`,scrollSnapAlign:"start",overflowY:"auto",overflowX:"hidden"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-secondary)",flexShrink:0},children:[e.jsxs("h3",{style:{margin:0,color:"var(--text-primary)"},children:["Browse ",D==="adversary"?"Adversaries":"Environments"]}),e.jsx("button",{onClick:G,style:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"1.2rem",cursor:"pointer",padding:"0.25rem",borderRadius:"var(--radius-sm)",transition:"background-color 0.2s"},onMouseEnter:b=>b.target.style.backgroundColor="var(--bg-hover)",onMouseLeave:b=>b.target.style.backgroundColor="transparent",title:"Close Browser",children:"×"})]}),e.jsx("div",{style:{flex:1,padding:"1rem",overflowY:"auto"},children:e.jsx(at,{type:D,onAddItem:b=>{D==="adversary"?(d(b),g("adversary")):D==="environment"&&(u(b),g("environment"))},onCancel:G})})]}):Z.map((b,B)=>e.jsx(me,{className:"invisible-scrollbar",style:{width:`${L+c}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:`${c}px`,paddingRight:"0",paddingTop:`${c}px`,paddingBottom:`${c}px`,scrollSnapAlign:"start",overflowY:"auto",overflowX:"hidden"},children:e.jsx(Ze,{type:b.type,item:{...b.instances[0],name:b.baseName,hp:0,stress:0,isDead:!1},mode:"expanded",instances:b.instances,onApplyDamage:b.type==="adversary"?(O,V,Q,Y)=>{const K=b.instances.find(ee=>ee.id===O);K&&x(O,{hp:Math.min(K.hpMax||1,(K.hp||0)+V)})}:void 0,onApplyHealing:b.type==="adversary"?(O,V,Q)=>{const Y=b.instances.find(K=>K.id===O);Y&&x(O,{hp:Math.max(0,(Y.hp||0)-V)})}:void 0,onApplyStressChange:b.type==="adversary"?(O,V)=>{var Q,Y;return x(O,{stress:Math.max(0,Math.min(((Q=b.instances.find(K=>K.id===O))==null?void 0:Q.stressMax)||6,(((Y=b.instances.find(K=>K.id===O))==null?void 0:Y.stress)||0)+V))})}:void 0,onUpdate:b.type==="adversary"?x:b.type==="environment"?I:F,adversaries:t})},`${b.type}-${b.baseName}`))})}),e.jsx(Qe,{position:"bottom",children:e.jsx(Ge,{type:"fear",value:(m==null?void 0:m.value)||0,maxValue:12,onChange:y,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0})}),e.jsx(lt,{})]})},pt=()=>e.jsx(dt,{children:e.jsx(ct,{})});oe.createRoot(document.getElementById("root")).render(e.jsx(ie.StrictMode,{children:e.jsx(_e,{children:e.jsx(pt,{})})}));
