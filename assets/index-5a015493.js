import{r as c,a as kt,R as nt}from"./dndkit-57209f9c.js";import{F as Xt,f as Zt,a as Qt,b as Ut,c as Wt}from"./fa-b4bcccb0.js";import{D as qt,A as er,C as zt,X as at,M as mt,P as it,a as tr,H as rr,L as nr,b as or,F as sr,S as xt,c as yt,T as Nt,d as Lt,B as Bt}from"./lucide-6ba57bd1.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const k of document.querySelectorAll('link[rel="modulepreload"]'))l(k);new MutationObserver(k=>{for(const p of k)if(p.type==="childList")for(const b of p.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&l(b)}).observe(document,{childList:!0,subtree:!0});function u(k){const p={};return k.integrity&&(p.integrity=k.integrity),k.referrerPolicy&&(p.referrerPolicy=k.referrerPolicy),k.crossOrigin==="use-credentials"?p.credentials="include":k.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function l(k){if(k.ep)return;k.ep=!0;const p=u(k);fetch(k.href,p)}})();var Vt={exports:{}},gt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ar=c,ir=Symbol.for("react.element"),lr=Symbol.for("react.fragment"),dr=Object.prototype.hasOwnProperty,cr=ar.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ur={key:!0,ref:!0,__self:!0,__source:!0};function Kt(t,o,u){var l,k={},p=null,b=null;u!==void 0&&(p=""+u),o.key!==void 0&&(p=""+o.key),o.ref!==void 0&&(b=o.ref);for(l in o)dr.call(o,l)&&!ur.hasOwnProperty(l)&&(k[l]=o[l]);if(t&&t.defaultProps)for(l in o=t.defaultProps,o)k[l]===void 0&&(k[l]=o[l]);return{$$typeof:ir,type:t,key:p,ref:b,props:k,_owner:cr.current}}gt.Fragment=lr;gt.jsx=Kt;gt.jsxs=Kt;Vt.exports=gt;var e=Vt.exports,It={},Ht=kt;It.createRoot=Ht.createRoot,It.hydrateRoot=Ht.hydrateRoot;function tt(t){const o=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return t?`${t}-${o}`:o}const Gt=c.createContext();function vt(t){if(typeof localStorage>"u")return null;try{const o=localStorage.getItem(t);return o==null?null:JSON.parse(o)}catch{return null}}function rt(t,o){if(!(typeof localStorage>"u"))try{localStorage.setItem(t,JSON.stringify(o))}catch{}}const pr=({children:t})=>{const[o,u]=c.useState({fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],currentEncounterName:"Encounter"}),[l,k]=c.useState(!1),[p,b]=c.useState({adversaries:[],environments:[]});c.useEffect(()=>{var m,s,C,L;const d=vt("daggerheart-game-state");if(d)try{(((m=d.adversaries)==null?void 0:m.length)>0||((s=d.environments)==null?void 0:s.length)>0||((C=d.countdowns)==null?void 0:C.length)>0||((L=d.savedEncounters)==null?void 0:L.length)>0)&&u(d)}catch(K){console.error("Failed to load saved state:",K)}const y=vt("daggerheart-custom-adversaries")||[],w=vt("daggerheart-custom-environments")||[];b({adversaries:y,environments:w}),k(!0)},[]),c.useEffect(()=>{rt("daggerheart-game-state",o)},[o]);const V=d=>{u(y=>({...y,fear:{...y.fear,value:d}}))},x=()=>{u(d=>({...d,fear:{...d.fear,visible:!d.fear.visible}}))},z=d=>{u(y=>({...y,partySize:Math.max(1,d)}))},O=d=>{u(y=>({...y,currentEncounterName:d||"Encounter"}))},g=d=>{if(d.id)return u(y=>({...y,savedEncounters:(y.savedEncounters||[]).map(w=>w.id===d.id?{...w,name:d.name||w.name,encounterItems:d.encounterItems||w.encounterItems,partySize:d.partySize||w.partySize,battlePointsAdjustments:d.battlePointsAdjustments||w.battlePointsAdjustments,updatedAt:new Date().toISOString()}:w)})),d.id;{const y={id:tt("encounter"),name:d.name||"Encounter",createdAt:new Date().toISOString(),encounterItems:d.encounterItems||[],partySize:d.partySize||4,battlePointsAdjustments:d.battlePointsAdjustments||{}};return u(w=>({...w,savedEncounters:[...w.savedEncounters||[],y]})),y.id}},N=d=>(o.savedEncounters||[]).find(w=>w.id===d),j=d=>{const y={id:tt("encounter"),name:d.name||`Encounter ${Date.now()}`,createdAt:new Date().toISOString(),encounterItems:d.encounterItems||[],partySize:d.partySize||4,battlePointsAdjustments:d.battlePointsAdjustments||{}};return u(w=>({...w,savedEncounters:[...w.savedEncounters||[],y]})),y.id},G=d=>{u(y=>({...y,savedEncounters:(y.savedEncounters||[]).filter(w=>w.id!==d)}))},me=c.useRef(o);c.useEffect(()=>{me.current=o},[o]);const Oe={gameState:o,isLoaded:l,customContent:p,updateFear:V,toggleFearVisibility:x,updatePartySize:z,updateCurrentEncounterName:O,saveEncounter:g,saveEncounterAs:j,loadEncounter:N,deleteEncounter:G,createCountdown:d=>{const y={id:tt("countdown"),name:d.name||"Countdown",max:parseInt(d.max)||1,value:0,visible:!0,type:d.type||"standard",loop:d.loop||"none",source:d.source||"campaign"};u(w=>({...w,countdowns:[...w.countdowns,y]}))},updateCountdown:(d,y)=>{u(w=>({...w,countdowns:w.countdowns.map(m=>m.id===d?{...m,...y}:m)}))},deleteCountdown:d=>{u(y=>({...y,countdowns:y.countdowns.filter(w=>w.id!==d)}))},advanceCountdown:(d,y)=>{u(w=>({...w,countdowns:w.countdowns.map(m=>{if(m.id!==d)return m;let s=y;if(m.loop==="loop")s>m.max?s=(s-1)%m.max+1:s<0&&(s=m.max);else if(m.loop==="increasing"){if(s>m.max)return{...m,max:m.max+1,value:1};if(s<0)return{...m,max:Math.max(1,m.max-1),value:1};s=Math.max(0,s)}else if(m.loop==="decreasing"){if(s>m.max)return{...m,max:Math.max(1,m.max-1),value:1};if(s<0)return{...m,max:m.max+1,value:1};s=Math.min(m.max,s)}else s=Math.max(0,Math.min(s,m.max));return{...m,value:s}})}))},incrementCountdown:(d,y=1)=>{u(w=>({...w,countdowns:w.countdowns.map(m=>{if(m.id!==d)return m;let s=m.value+y;if(m.loop==="loop")s>m.max&&(s=(s-1)%m.max+1);else if(m.loop==="increasing"){if(s>m.max)return{...m,max:m.max+1,value:1}}else if(m.loop==="decreasing"){if(s>m.max)return{...m,max:Math.max(1,m.max-1),value:1}}else s=Math.min(s,m.max);return{...m,value:s}})}))},decrementCountdown:d=>{u(y=>({...y,countdowns:y.countdowns.map(w=>{if(w.id!==d)return w;let m=w.value-1;if(w.loop==="loop")m<0&&(m=w.max);else if(w.loop==="increasing"){if(m<0)return{...w,max:Math.max(1,w.max-1),value:w.max};m=Math.max(0,m)}else if(w.loop==="decreasing"){if(m<0)return{...w,max:w.max+1,value:1}}else m=Math.max(0,m);return{...w,value:m}})}))},reorderCountdowns:d=>{u(y=>{const[w,m]=d,s=[...y.countdowns],[C]=s.splice(w,1);return s.splice(m,0,C),{...y,countdowns:s}})},createAdversary:d=>{var K;const y=tt("adv"),w=o.adversaries||[],m=d.baseName||((K=d.name)==null?void 0:K.replace(/\s+\(\d+\)$/,""))||d.name||"Unknown",s=w.filter(Y=>Y.baseName===m);let C=1;if(s.length===0)C=1;else{const Y=s.map(Be=>Be.duplicateNumber||1);let be=1;for(;Y.includes(be);)be++;C=be}const L={...d,id:y,baseName:m,duplicateNumber:C,name:`${m} (${C})`,hp:0,stress:0,isVisible:!0};u(Y=>({...Y,adversaries:[...Y.adversaries,L]}))},createAdversariesBulk:d=>{const y=[],w={};d.forEach(m=>{var He;const s=m.baseName||((He=m.name)==null?void 0:He.replace(/\s+\(\d+\)$/,""))||m.name||"Unknown",K=(o.adversaries||[]).filter(_e=>_e.baseName===s).length,Y=w[s]||0,be=K+Y+1;w[s]=Y+1;const Be={...m,id:tt("adv"),baseName:s,duplicateNumber:be,name:`${s} (${be})`,hp:0,stress:0,isVisible:!0};y.push(Be)}),u(m=>({...m,adversaries:[...m.adversaries,...y]}))},updateAdversary:(d,y)=>{u(w=>({...w,adversaries:w.adversaries.map(m=>{if(m.id===d){const s={...m,...y};if(y.baseName!==void 0){const C=y.baseName,L=s.duplicateNumber||1;s.name=L===1?C:`${C} (${L})`}return s}return m})}))},deleteAdversary:d=>{u(y=>({...y,adversaries:y.adversaries.filter(w=>w.id!==d)}))},clearAllAdversaries:()=>{u(d=>({...d,adversaries:[]}))},reorderAdversaries:d=>{u(y=>{const[w,m]=d,s=[...y.adversaries],[C]=s.splice(w,1);return s.splice(m,0,C),{...y,adversaries:s}})},bulkReorderAdversaries:d=>{u(y=>({...y,adversaries:d}))},createEnvironment:d=>{const y=tt("env"),m=(o.environments||[]).filter(L=>L.name.replace(/\s+\(\d+\)$/,"")===d.name);let s=d.name||"Unknown";if(m.length===0)s=d.name;else if(m.length===1){const L=m[0],K=L.name.replace(/\s+\(\d+\)$/,""),Y=o.environments.map(be=>be.id===L.id?{...be,name:`${K} (1)`}:be);u(be=>({...be,environments:Y})),s=`${d.name} (2)`}else{const L=m.map(Y=>{const be=Y.name.match(/\((\d+)\)$/);return be?parseInt(be[1]):null}).filter(Y=>Y!==null);let K=1;for(;L.includes(K);)K++;s=`${d.name} (${K})`}const C={...d,id:y,name:s,isVisible:!0};u(L=>({...L,environments:[...L.environments,C]}))},updateEnvironment:(d,y)=>{u(w=>({...w,environments:w.environments.map(m=>m.id===d?{...m,...y}:m)}))},deleteEnvironment:d=>{u(y=>({...y,environments:y.environments.filter(w=>w.id!==d)}))},reorderEnvironments:d=>{u(y=>{const[w,m]=d,s=[...y.environments],[C]=s.splice(w,1);return s.splice(m,0,C),{...y,environments:s}})},addCustomAdversary:d=>{const y={...d,id:tt("custom-adv"),source:d.source||"Homebrew",isCustom:!0};return b(w=>({...w,adversaries:[...w.adversaries,y]})),rt("daggerheart-custom-adversaries",[...p.adversaries,y]),y.id},addCustomEnvironment:d=>{const y={...d,id:tt("custom-env"),source:d.source||"Homebrew",isCustom:!0};return b(w=>({...w,environments:[...w.environments,y]})),rt("daggerheart-custom-environments",[...p.environments,y]),y.id},updateCustomAdversary:(d,y)=>{b(m=>({...m,adversaries:m.adversaries.map(s=>s.id===d?{...s,...y}:s)}));const w=p.adversaries.map(m=>m.id===d?{...m,...y}:m);rt("daggerheart-custom-adversaries",w)},updateCustomEnvironment:(d,y)=>{b(m=>({...m,environments:m.environments.map(s=>s.id===d?{...s,...y}:s)}));const w=p.environments.map(m=>m.id===d?{...m,...y}:m);rt("daggerheart-custom-environments",w)},deleteCustomAdversary:d=>{b(w=>({...w,adversaries:w.adversaries.filter(m=>m.id!==d)}));const y=p.adversaries.filter(w=>w.id!==d);rt("daggerheart-custom-adversaries",y)},deleteCustomEnvironment:d=>{b(w=>({...w,environments:w.environments.filter(m=>m.id!==d)}));const y=p.environments.filter(w=>w.id!==d);rt("daggerheart-custom-environments",y)}};return e.jsx(Gt.Provider,{value:Oe,children:t})},Tt=()=>{const t=c.useContext(Gt);if(!t)return console.warn("useGameState: Context not available yet, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{gameState:o,customContent:u,...l}=t;if(!o)return console.warn("useGameState: gameState not available, returning defaults"),{fear:{value:0,visible:!1},countdowns:[],adversaries:[],environments:[],partySize:4,savedEncounters:[],customContent:{adversaries:[],environments:[]},updateFear:()=>{},toggleFearVisibility:()=>{},updatePartySize:()=>{},updateCurrentEncounterName:()=>{},saveEncounter:()=>{},loadEncounter:()=>{},deleteEncounter:()=>{},createCountdown:()=>{},updateCountdown:()=>{},deleteCountdown:()=>{},advanceCountdown:()=>{},incrementCountdown:()=>{},decrementCountdown:()=>{},reorderCountdowns:()=>{},createAdversary:()=>{},updateAdversary:()=>{},deleteAdversary:()=>{},clearAllAdversaries:()=>{},reorderAdversaries:()=>{},createEnvironment:()=>{},updateEnvironment:()=>{},deleteEnvironment:()=>{},reorderEnvironments:()=>{},addCustomAdversary:()=>{},addCustomEnvironment:()=>{},updateCustomAdversary:()=>{},updateCustomEnvironment:()=>{},deleteCustomAdversary:()=>{},deleteCustomEnvironment:()=>{},hasCountdowns:!1,hasAdversaries:!1,hasEnvironments:!1,getCountdownById:()=>null,getAdversaryById:()=>null,getEnvironmentById:()=>null};const{fear:k,countdowns:p,adversaries:b,environments:V,partySize:x,savedEncounters:z}=o;return{gameState:o,fear:k,countdowns:p,adversaries:b,environments:V,partySize:x,savedEncounters:z,customContent:u,...l,hasCountdowns:p.length>0,hasAdversaries:b.length>0,hasEnvironments:V.length>0,getCountdownById:O=>p.find(g=>g.id===O),getAdversaryById:O=>b.find(g=>g.id===O),getEnvironmentById:O=>V.find(g=>g.id===O)}},Pt={fear:{icon:Zt,maxValue:12,containerStyle:{display:"flex",gap:"0.125rem",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:"0.125rem",maxWidth:"none"},pipStyle:{fontSize:"var(--text-lg)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0,imageRendering:"crisp-edges"},filledColor:"var(--purple)",emptyColor:"var(--gray-dark)",tooltipTitle:"Click anywhere in header to adjust fear:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease fear by 1"},{text:"Right of boundary:",description:"Click to increase fear by 1"}]},hp:{icon:Qt,maxValue:20,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stress:{icon:Ut,maxValue:12,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},countdown:{icon:Wt,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Click anywhere to adjust countdown:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease countdown by 1"},{text:"Right of boundary:",description:"Click to increase countdown by 1"}]},hpDots:{maxValue:20,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--red)",borderColor:"var(--red)",boxShadow:"0 0 4px rgba(239, 68, 68, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust HP:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease HP by 1"},{text:"Right of boundary:",description:"Click to increase HP by 1"}]},stressDots:{maxValue:12,containerStyle:{display:"flex",flexWrap:"wrap",gap:"1px",justifyContent:"center",alignItems:"center",maxWidth:"120px"},pipStyle:{width:"8px",height:"8px",borderRadius:"50%",border:"1px solid var(--border)",transition:"background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease"},filledStyle:{background:"var(--purple)",borderColor:"var(--purple)",boxShadow:"0 0 4px rgba(139, 92, 246, 0.5)"},emptyStyle:{background:"var(--bg-primary)",borderColor:"var(--border)"},isDots:!0,tooltipTitle:"Click anywhere to adjust stress:",tooltipInstructions:[{text:"Left of boundary:",description:"Click to decrease stress by 1"},{text:"Right of boundary:",description:"Click to increase stress by 1"}]},adversaryHP:{icon:qt,maxValue:20,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--red)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust HP:",tooltipInstructions:[{text:"Filled pip:",description:"Click to heal (reduce damage)"},{text:"Empty pip:",description:"Click to take damage"}]},adversaryStress:{icon:er,maxValue:12,containerStyle:{display:"flex",gap:"0px",flexWrap:"wrap",alignContent:"flex-start",rowGap:"0.03125rem",maxWidth:"100%"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"none",cursor:"pointer",width:"1rem",height:"1rem",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},filledColor:"var(--gold)",emptyColor:"var(--gray-400)",tooltipTitle:"Click to adjust stress:",tooltipInstructions:[{text:"Filled pip:",description:"Click to reduce stress"},{text:"Empty pip:",description:"Click to increase stress"}]},countdownDistributed:{icon:Wt,maxValue:6,containerStyle:{display:"inline-block",width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},pipStyle:{fontSize:"var(--text-sm)",fontWeight:600,transition:"color 0.3s ease",height:"1.5rem",width:"1.5rem",display:"inline-block",textAlign:"center",lineHeight:"1.5rem",flexShrink:0},filledColor:"var(--text-secondary)",emptyColor:"var(--text-secondary)",tooltipTitle:"Countdown progress:",tooltipInstructions:[{text:"Progress:",description:"Current countdown value"}]}},dt=({type:t="fear",value:o=0,maxValue:u,onChange:l,size:k="lg",showTooltip:p=!0,containerStyle:b={},pipStyle:V={},countdownType:x=null,distributedGroups:z=null,onPipClick:O=null,enableBoundaryClick:g=!1,clickContainerWidth:N="auto",centerPips:j=!0})=>{const[G,me]=c.useState(!1),le=Pt[t]||Pt.fear,ue=u||le.maxValue,X=Math.max(0,Math.min(ue,o));let ge=le.filledColor;t==="countdown"&&x&&(["progress","dynamic-progress","simple-hope"].includes(x)?ge="var(--gold)":["consequence","dynamic-consequence","simple-fear"].includes(x)?ge="var(--purple)":["long-term","standard"].includes(x)&&(ge="var(--text-secondary)"));const Z=(P,ve)=>{if(O)O(P,ve);else if(l){const Te=P+1;l(Te)}},ye=P=>{if(!g||!l||O)return;P.currentTarget.getBoundingClientRect();const ve=P.currentTarget.querySelector(".pip-container");if(!ve)return;const Te=ve.getBoundingClientRect(),de=P.clientX-Te.left;if(de<0){X>0&&l(X-1);return}if(de>Te.width){X<ue&&l(X+1);return}const T=Te.width,S=T*.05,te=T-2*S,re=de-S,J=X/ue,Re=te*J;re<Re?X>0&&l(X-1):X<ue&&l(X+1)},Se=(()=>{if(!z||t!=="countdownDistributed")return[{start:0,end:ue,groupIndex:0}];let P=0;return z.map((ve,Te)=>{const de={start:P,end:P+ve,groupIndex:Te};return P+=ve,de})})(),F=()=>e.jsxs(e.Fragment,{children:[Se.map(P=>e.jsx(nt.Fragment,{children:[...Array(P.end-P.start)].map((ve,Te)=>{const de=P.start+Te,T=de<X;if(le.isDots)return e.jsx("div",{style:{...le.pipStyle,...T?le.filledStyle:le.emptyStyle,...V,cursor:l||O?"pointer":"default"},onClick:g?void 0:()=>Z(de,T),title:`${de+1} of ${ue}`},de);{const S=le.icon,te=S&&typeof S=="object"&&S.iconName,re=T?ge:le.emptyColor;return e.jsx("span",{className:`fear-pip ${T?"filled":"empty"}`,style:{...le.pipStyle,color:re,cursor:l||O?"pointer":"default",...V},onClick:g?void 0:()=>Z(de,T),title:`${de+1} of ${ue}`,children:te?e.jsx(Xt,{icon:S,size:k}):e.jsx(S,{size:k==="lg"?18:16})},de)}})},P.groupIndex)),p&&e.jsx("div",{style:{position:"relative",cursor:"help",pointerEvents:"none"},children:e.jsxs("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:G?"translateX(-50%) translateY(-5px)":"translateX(-50%)",background:"rgba(15, 23, 42, 0.95)",border:"1px solid var(--gray)",borderRadius:"var(--radius-md)",padding:"var(--space-md)",minWidth:"250px",zIndex:1e3,opacity:G?1:0,visibility:G?"visible":"hidden",transition:"all 0.2s ease",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.5)"},children:[e.jsx("div",{style:{fontWeight:600,color:"var(--gray-200)",marginBottom:"0.75rem",fontSize:"var(--text-sm)"},children:le.tooltipTitle}),le.tooltipInstructions.map((P,ve)=>e.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.8rem",color:"var(--gray-300)",lineHeight:1.4},children:[e.jsx("strong",{style:{color:"var(--gray-200)"},children:P.text})," ",P.description]},ve))]})})]});return e.jsx("div",{style:{width:N,height:"100%",cursor:l||O?"pointer":"default",touchAction:"manipulation",userSelect:"none",display:j?"flex":"block",alignItems:j?"center":"stretch",justifyContent:j?"center":"flex-start",...b},onClick:P=>{P.stopPropagation(),P.preventDefault(),g&&ye(P)},onMouseEnter:()=>me(p),onMouseLeave:()=>me(!1),children:e.jsx("div",{className:"pip-container",style:{...le.containerStyle,width:"auto",height:"100%",padding:"0.125rem",textAlign:"center"},children:F()})})},mr=({position:t="top",children:o,onClick:u,className:l="",style:k={}})=>{const p=t==="top",b=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://"),V={background:"var(--bg-primary)",borderTop:p?"none":"1px solid var(--border)",borderBottom:p?"1px solid var(--border)":"none",padding:p?"0.25rem 0":"0.5rem",paddingBottom:p?"0.25rem":b?"calc(0.5rem + env(safe-area-inset-bottom) + 1rem)":"calc(0.5rem + env(safe-area-inset-bottom))",position:p?"relative":"sticky",[p?"top":"bottom"]:0,zIndex:p?10:100,order:p?1:3,flexShrink:0,touchAction:"manipulation",userSelect:"none",display:"flex",flexDirection:p?"column":"row",justifyContent:p?"stretch":"center",alignItems:p?"stretch":"center",gap:p?"0":"1rem",height:p?"auto":"60px",...k};return e.jsx("div",{className:l,style:V,onClick:u,children:o})},bt=52,At=({tabContent:t,children:o,containerStyle:u={},tabStyle:l={},showTab:k=!0,tabBackgroundColor:p="var(--bg-primary)",tabBorderColor:b="var(--border)",tabJustifyContent:V="center",containerBackgroundColor:x,containerBorderColor:z,containerBorderRadius:O="8px",containerBoxShadow:g,containerOverflow:N="hidden",reserveTabSpace:j=!1,style:G={},...me})=>{const le={display:"flex",flexDirection:"column",position:"relative",height:"100%",width:"100%",borderRadius:O,overflow:N};x&&(le.backgroundColor=x),z&&(le.border=`2px solid ${z}`),g&&(le.boxShadow=g);const ue={position:"relative",overflow:"visible",height:"100%",width:"100%",display:"flex",flexDirection:"column",boxSizing:"border-box"},X=j?"0":`-${bt}px`,ge=j&&k&&t?`${bt}px`:"0";return e.jsxs("div",{style:{...ue,...G},...me,children:[k&&t&&e.jsx("div",{style:{position:"absolute",top:X,left:"7px",right:"7px",width:"calc(100% - 14px)",display:"flex",alignItems:"center",gap:"0.5rem",justifyContent:V,flexShrink:0,zIndex:0,padding:"0.5rem 0.75rem",paddingBottom:"calc(0.5rem + 4px)",minHeight:`${bt}px`,backgroundColor:p,border:`1.5px solid ${b}`,borderBottom:"none",borderRadius:"8px 8px 0 0",boxSizing:"border-box",marginBottom:"-4px",...l},children:t}),e.jsx("div",{style:{...le,...u,zIndex:1,marginTop:ge},children:o})]})},fr="modulepreload",hr=function(t){return"/Daggerheart/"+t},Dt={},st=function(o,u,l){if(!u||u.length===0)return o();const k=document.getElementsByTagName("link");return Promise.all(u.map(p=>{if(p=hr(p),p in Dt)return;Dt[p]=!0;const b=p.endsWith(".css"),V=b?'[rel="stylesheet"]':"";if(!!l)for(let O=k.length-1;O>=0;O--){const g=k[O];if(g.href===p&&(!b||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${p}"]${V}`))return;const z=document.createElement("link");if(z.rel=b?"stylesheet":fr,b||(z.as="script",z.crossOrigin=""),z.href=p,document.head.appendChild(z),b)return new Promise((O,g)=>{z.addEventListener("load",O),z.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${p}`)))})})).then(()=>o()).catch(p=>{const b=new Event("vite:preloadError",{cancelable:!0});if(b.payload=p,window.dispatchEvent(b),!b.defaultPrevented)throw p})},Ot={Minion:{difficulty:t=>[9,12,15,18][t-1],thresholds:t=>({major:0,severe:0}),hpMax:t=>1,stressMax:t=>1,atk:t=>[-1,0,1,2][t-1],damage:t=>["2","5","8","11"][t-1],range:"Melee"},Standard:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[7,10,20,25][t-1],severe:[12,20,32,45][t-1]}),hpMax:t=>[4,5,6,7][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[1,2,3,4][t-1],damage:t=>["1d8+1","2d8+2","3d8+3","4d8+4"][t-1],range:"Melee"},Bruiser:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[8,14,22,38][t-1],severe:[15,28,40,70][t-1]}),hpMax:t=>[6,7,8,9][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[-1,0,1,2][t-1],damage:t=>["1d12+2","2d12+4","3d12+6","4d12+8"][t-1],range:"Melee"},Horde:{difficulty:t=>[10,13,16,19][t-1],thresholds:t=>({major:[7,10,20,25][t-1],severe:[12,20,32,45][t-1]}),hpMax:t=>[5,6,7,8][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[-1,0,1,2][t-1],damage:t=>["1d8+2","2d8+4","3d8+6","4d8+8"][t-1],range:"Melee"},Leader:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[7,13,21,35][t-1],severe:[14,26,38,65][t-1]}),hpMax:t=>[5,6,7,8][t-1],stressMax:t=>[5,5,6,6][t-1],atk:t=>[2,4,6,8][t-1],damage:t=>["1d10+2","2d10+4","3d10+6","4d10+8"][t-1],range:"Melee"},Ranged:{difficulty:t=>[10,13,16,19][t-1],thresholds:t=>({major:[4,8,18,22][t-1],severe:[7,16,30,42][t-1]}),hpMax:t=>[3,4,5,6][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d8+2","2d8+4","3d8+6","4d8+8"][t-1],range:"Close"},Skulk:{difficulty:t=>[12,15,18,21][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,5,6,7][t-1],stressMax:t=>[3,3,4,4][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d6+2","2d6+4","3d6+6","4d6+8"][t-1],range:"Melee"},Solo:{difficulty:t=>[12,15,18,21][t-1],thresholds:t=>({major:[7,13,21,35][t-1],severe:[14,26,38,65][t-1]}),hpMax:t=>[8,9,10,11][t-1],stressMax:t=>[5,5,6,6][t-1],atk:t=>[3,5,7,9][t-1],damage:t=>["1d10+3","2d10+6","3d10+9","4d10+12"][t-1],range:"Melee"},Support:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,4,5,5][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d4+2","2d4+4","3d4+6","4d4+8"][t-1],range:"Melee"},Social:{difficulty:t=>[11,14,17,20][t-1],thresholds:t=>({major:[5,9,19,23][t-1],severe:[10,18,31,43][t-1]}),hpMax:t=>[4,4,5,5][t-1],stressMax:t=>[4,4,5,5][t-1],atk:t=>[2,3,4,5][t-1],damage:t=>["1d4+2","2d4+4","3d4+6","4d4+8"][t-1],range:"Melee"}},ct=(t,o)=>{const u=Ot[o]||Ot.Standard;return{difficulty:u.difficulty(t),thresholds:u.thresholds(t),hpMax:u.hpMax(t),stressMax:u.stressMax(t),atk:u.atk(t),damage:u.damage(t),range:u.range}};let Jt={adversaries:[]},Ft=!1;const gr=()=>({customAdversaries:JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]")}),xr=async()=>{if(Ft)return;let t={adversaries:[]},o={adversaries:[]};try{const l=await st(()=>import("./adversaries-9c8932de.js"),[]);t=(l==null?void 0:l.default)||l}catch(l){console.warn("Failed to load adversaries.json:",l)}try{const l=await st(()=>import("./playtest-adversaries-4a099c10.js"),[]);o=(l==null?void 0:l.default)||l}catch(l){console.warn("Failed to load playtest-adversaries.json:",l)}const{customAdversaries:u}=gr();Jt={...t,adversaries:[...t.adversaries||[],...o.adversaries||[],...u]},Ft=!0},Mt=c.forwardRef(({onSave:t,onRefresh:o,onAddItem:u,editingAdversary:l,onCancelEdit:k,isStockAdversary:p=!1,autoFocus:b=!1,allAdversaries:V=[],embedded:x=!1,hideEmbeddedButtons:z=!1},O)=>{const g=c.useRef(null),N=c.useRef(null),[j,G]=c.useState(()=>{const T=ct(1,"Standard");return{name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:T.difficulty,thresholds:T.thresholds,hpMax:T.hpMax,stressMax:T.stressMax,atk:T.atk,weapon:"",range:T.range,damage:T.damage,experience:[],features:[]}}),[me,le]=c.useState(!1),[ue,X]=c.useState(!1),[ge,Z]=c.useState([]),[ye,fe]=c.useState(!1),[Se,F]=c.useState([]);c.useEffect(()=>{(async()=>{await xr(),V.length>0?F(V):F(Jt.adversaries||[])})()},[V]),c.useEffect(()=>{b&&setTimeout(()=>{var T,S,te;l&&N.current?((T=N.current)==null||T.focus(),(S=N.current)==null||S.select()):g.current&&((te=g.current)==null||te.focus())},650)},[b,l]),c.useEffect(()=>{var T;if(l){const S=l.baseName||((T=l.name)==null?void 0:T.replace(/\s+\(\d+\)$/,""))||l.name||"";G({name:S,tier:l.tier||1,type:l.type||"Standard",description:l.description||"",motives:l.motives||"",difficulty:l.difficulty||11,thresholds:l.thresholds||{major:7,severe:12},hpMax:l.hpMax||3,stressMax:l.stressMax||1,atk:l.atk||1,weapon:l.weapon||"",range:l.range||"Melee",damage:l.damage||"",experience:l.experience||[],features:l.features||[]}),X(!1)}else{const S=ct(1,"Standard");G({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:S.difficulty,thresholds:S.thresholds,hpMax:S.hpMax,stressMax:S.stressMax,atk:S.atk,weapon:"",range:S.range,damage:S.damage,experience:[],features:[]}),X(!1)}},[l]),c.useEffect(()=>{if(!l&&!ue){const T=ct(j.tier,j.type);G(S=>({...S,difficulty:T.difficulty,thresholds:T.thresholds,hpMax:T.hpMax,stressMax:T.stressMax,atk:T.atk,range:T.range,damage:T.damage}))}},[j.tier,j.type,l,ue]);const P=T=>{if(G(S=>({...S,name:T})),T.trim().length>0){const S=Se.filter(te=>{var J;return(((J=te.name)==null?void 0:J.replace(/\s+\(\d+\)$/,""))||te.name||"").toLowerCase().includes(T.toLowerCase())}).slice(0,5);Z(S),fe(S.length>0)}else Z([]),fe(!1)},ve=async()=>{if(!j.name.trim()){alert("Please enter a name for the adversary");return}le(!0);try{const T=J=>(J||[]).filter(Re=>Re.name&&Re.name.trim()!==""||Re.modifier!==void 0&&Re.modifier!==0),S=j.name.trim()||"Unknown",te=T(j.experience||[]),re={...j,experience:te,baseName:S,name:S,hp:l?l.hp:0,stress:l?l.stress:0,source:"Homebrew"};if(l){if(p){const{id:J,name:Re,...pe}=re;await t(pe),alert("Custom adversary created successfully!")}else{const J={...re,name:re.baseName};await t(J,l.id),alert("Adversary updated successfully!")}k&&k()}else{await t(re),o&&await o();const J=ct(1,"Standard");G({name:"",tier:1,type:"Standard",description:"",motives:"",difficulty:J.difficulty,thresholds:J.thresholds,hpMax:J.hpMax,stressMax:J.stressMax,atk:J.atk,weapon:"",range:J.range,damage:J.damage,experience:[],features:[]}),X(!1),alert("Custom adversary created successfully!")}}catch(T){console.error("Error saving adversary:",T),alert("Error saving adversary. Please try again.")}finally{le(!1)}};c.useImperativeHandle(O,()=>({handleSave:ve,isSaving:me,canSave:j.name.trim().length>0}));const Te={...j,id:"new-adversary",hp:0,stress:0,source:"Homebrew"},de=()=>me?l?p?"Creating...":"Saving...":"Creating...":l?p?"Save As Custom":"Save":"Create";return e.jsxs(e.Fragment,{children:[!x&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h2",{style:{color:"var(--text-primary)",fontSize:"1.5rem",fontWeight:"600",margin:0},children:l?p?"Edit Adversary (Save As Custom)":"Edit Custom Adversary":"Create Custom Adversary"}),e.jsx("button",{onClick:ve,disabled:me||!j.name.trim(),style:{padding:"0.75rem 1.5rem",backgroundColor:me||!j.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"8px",cursor:me||!j.name.trim()?"not-allowed":"pointer",fontSize:"1rem",fontWeight:"600",opacity:me||!j.name.trim()?.6:1},children:de()})]}),x&&!z&&e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",marginBottom:"0.5rem",padding:"0.5rem",borderBottom:"1px solid var(--border)"},children:[e.jsx("button",{onClick:ve,disabled:me||!j.name.trim(),style:{padding:"0.5rem 1rem",backgroundColor:me||!j.name.trim()?"var(--gray-600)":"var(--purple)",border:"none",color:"white",borderRadius:"6px",cursor:me||!j.name.trim()?"not-allowed":"pointer",fontSize:"0.875rem",fontWeight:"600",opacity:me||!j.name.trim()?.6:1,marginRight:"0.5rem"},children:de()}),k&&e.jsx("button",{onClick:k,style:{padding:"0.5rem 1rem",backgroundColor:"transparent",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"6px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600"},children:"Cancel"})]}),!l&&e.jsxs("div",{style:{marginBottom:"1rem",position:"relative"},children:[e.jsx("input",{ref:g,type:"text",value:j.name,onChange:T=>{const S=T.target.value;G(te=>({...te,name:S})),P(S)},placeholder:"Adversary name",style:{width:"100%",padding:"0.75rem",border:"1px solid var(--border)",borderRadius:"8px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"1rem",outline:"none"}}),ye&&ge.length>0&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"0 0 8px 8px",borderTop:"none",maxHeight:"200px",overflowY:"auto",zIndex:1e3,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)"},children:ge.map((T,S)=>{var re;const te=T.baseName||((re=T.name)==null?void 0:re.replace(/\s+\(\d+\)$/,""))||T.name;return e.jsxs("div",{onClick:()=>{G(J=>({...J,name:te,tier:T.tier||J.tier,type:T.type||J.type,difficulty:T.difficulty||J.difficulty,thresholds:T.thresholds||J.thresholds,hpMax:T.hpMax||J.hpMax,stressMax:T.stressMax||J.stressMax,atk:T.atk||J.atk,range:T.range||J.range,damage:T.damage||J.damage})),fe(!1),X(!0),g.current&&g.current.blur()},style:{padding:"0.75rem",cursor:"pointer",borderBottom:S<ge.length-1?"1px solid var(--border)":"none",transition:"background-color 0.2s"},onMouseEnter:J=>{J.target.style.backgroundColor="var(--bg-secondary)"},onMouseLeave:J=>{J.target.style.backgroundColor="transparent"},onMouseDown:J=>J.preventDefault(),children:[e.jsx("div",{style:{fontWeight:"600"},children:te}),e.jsxs("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",marginTop:"2px"},children:[T.type," • Tier ",T.tier]})]},S)})})]}),e.jsx(ft,{item:Te,type:"adversary",mode:"edit",nameInputRef:l?N:void 0,autoFocusNameInput:b&&l,onUpdate:(T,S)=>{G(te=>({...te,...S}))}})]})});Mt.displayName="CustomAdversaryCreator";const $t=({value:t})=>e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"44px",height:"32px",zIndex:3},children:[e.jsx("svg",{width:"40",height:"32",viewBox:"0 0 40 32",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",style:{position:"absolute",zIndex:1},children:e.jsx("path",{d:"M2 2h28l6 14-6 14H2l6-14-6-14z"})}),e.jsx("span",{style:{position:"absolute",fontSize:"0.8rem",fontWeight:500,color:"var(--text-primary)",textAlign:"center",zIndex:2,left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:t})]}),yr=({type:t,tier:o,isEditMode:u,onUpdate:l,itemId:k})=>{const b=(g=>{if(!g)return 0;const j=document.createElement("canvas").getContext("2d");return j.font="600 11px system-ui, -apple-system, sans-serif",j.measureText(g.toUpperCase()).width})(t),V=4,x=18,z=Math.max(50,b+V+x),O=z+15;return u?e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",gap:"8px",height:"32px"},children:[e.jsxs("select",{value:t||"",onChange:g=>{l&&l(k,{type:g.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",outline:"none",borderRadius:"4px",padding:"4px 8px",width:"95px",height:"24px"},children:[e.jsx("option",{value:"Standard",children:"Standard"}),e.jsx("option",{value:"Solo",children:"Solo"}),e.jsx("option",{value:"Bruiser",children:"Bruiser"}),e.jsx("option",{value:"Horde",children:"Horde"}),e.jsx("option",{value:"Minion",children:"Minion"}),e.jsx("option",{value:"Ranged",children:"Ranged"}),e.jsx("option",{value:"Leader",children:"Leader"}),e.jsx("option",{value:"Skulk",children:"Skulk"}),e.jsx("option",{value:"Social",children:"Social"}),e.jsx("option",{value:"Support",children:"Support"})]}),e.jsxs("div",{style:{position:"relative",width:"24px",height:"24px"},children:[e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",width:"20px",height:"20px",backgroundColor:"var(--bg-primary)",border:"1px solid var(--text-secondary)",borderRadius:"2px"}}),e.jsx("input",{type:"text",value:o||"",onChange:g=>{const N=g.target.value.replace(/[^1-4]/g,"");N.length<=1&&l&&l(k,{tier:N===""?"":parseInt(N)})},onKeyDown:g=>{if(g.key==="ArrowUp"){g.preventDefault();const N=parseInt(o)||1;l&&l(k,{tier:Math.min(N+1,4)})}else if(g.key==="ArrowDown"){g.preventDefault();const N=parseInt(o)||1;l&&l(k,{tier:Math.max(N-1,1)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"transparent",border:"none",color:"var(--text-primary)",fontSize:"0.8rem",fontWeight:600,width:"24px",height:"24px",textAlign:"center",outline:"none",zIndex:1},maxLength:"1"})]})]}):e.jsxs("div",{style:{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"center",height:"32px",width:`${O}px`},children:[e.jsxs("svg",{width:O,height:"32",viewBox:`0 0 ${O} 32`,style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1},children:[e.jsx("rect",{x:"1",y:"6",width:z-1,height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4",ry:"4"}),e.jsx("rect",{x:z-10,y:"6",width:"20",height:"20",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"2",ry:"2",transform:`rotate(45 ${z-1} 16)`})]}),e.jsx("span",{style:{position:"absolute",top:"50%",left:"4px",transform:"translateY(-50%)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase",color:"var(--text-primary)",zIndex:2,pointerEvents:"none"},children:t}),e.jsx("span",{style:{position:"absolute",top:"50%",left:`${z-.5}px`,transform:"translate(-50%, -50%)",fontSize:"0.8rem",fontWeight:600,color:"white",zIndex:2,pointerEvents:"none",textAlign:"center",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",width:"20px",height:"20px"},children:o})]})},wt=({feature:t,featureType:o,item:u,onUpdate:l,handleFeatureDeleteClick:k,deleteConfirmations:p,getFeatureKey:b})=>{var g,N;const V=()=>{try{const G=[...(u==null?void 0:u.features)||[]],me=G.filter(ue=>ue.type===o),le=me.findIndex(ue=>ue===t);if(le>0&&le<me.length){const ue=me[le],X=me[le-1];if(ue&&X){const ge=G.findIndex(ye=>ye===ue),Z=G.findIndex(ye=>ye===X);ge>=0&&Z>=0&&(G[ge]=X,G[Z]=ue,l&&l(u.id,{features:G}))}}}catch(j){console.error(`Error in ${o.toLowerCase()} up button:`,j)}},x=()=>{try{const G=[...(u==null?void 0:u.features)||[]],me=G.filter(ue=>ue.type===o),le=me.findIndex(ue=>ue===t);if(le<me.length-1&&le>=0){const ue=me[le],X=me[le+1];if(ue&&X){const ge=G.findIndex(ye=>ye===ue),Z=G.findIndex(ye=>ye===X);ge>=0&&Z>=0&&(G[ge]=X,G[Z]=ue,l&&l(u.id,{features:G}))}}}catch(j){console.error(`Error in ${o.toLowerCase()} down button:`,j)}},z=j=>j.type===o,O=j=>j.type===o&&j.name.trim();return e.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",alignSelf:"stretch"},children:[e.jsx("button",{onClick:V,disabled:(u.features||[]).filter(z).findIndex(j=>j===t)===0,tabIndex:"-1",style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(u.features||[]).filter(O).length>=2&&(u.features||[]).filter(z).findIndex(j=>j===t)!==0&&t.name.trim()?"white":"var(--text-secondary)",cursor:(u.features||[]).filter(O).length>=2&&(u.features||[]).filter(z).findIndex(j=>j===t)!==0&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↑"}),e.jsx("button",{onClick:()=>k(t),disabled:!t.name.trim()&&!t.description.trim(),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:p[b(t)]?"var(--danger)":"var(--gray-700)",color:!t.name.trim()&&!t.description.trim()?"var(--text-secondary)":"white",cursor:!t.name.trim()&&!t.description.trim()?"not-allowed":"pointer",opacity:!t.name.trim()&&!t.description.trim()?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"×"}),e.jsx("button",{onClick:x,disabled:(u.features||[]).filter(z).findIndex(j=>j===t)===(u.features||[]).filter(z).length-1,style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:"var(--gray-700)",color:(u.features||[]).filter(O).length>=2&&(u.features||[]).filter(z).findIndex(j=>j===t)<(u.features||[]).filter(z).length-1&&((g=(u.features||[]).filter(z)[(u.features||[]).filter(z).findIndex(j=>j===t)+1])!=null&&g.name.trim())&&t.name.trim()?"white":"var(--text-secondary)",cursor:(u.features||[]).filter(O).length>=2&&(u.features||[]).filter(z).findIndex(j=>j===t)<(u.features||[]).filter(z).length-1&&((N=(u.features||[]).filter(z)[(u.features||[]).filter(z).findIndex(j=>j===t)+1])!=null&&N.name.trim())&&t.name.trim()?"pointer":"not-allowed",fontSize:"14px",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"22px",maxHeight:"22px"},children:"↓"})]})},$e={transitions:{hoverIn:"all 0.1s ease",hoverOut:"all 0.3s ease"},card:{backgroundColor:"var(--bg-card)",borderRadius:"8px",padding:"8px",cursor:"pointer",transition:"all 0.1s ease",position:"relative",border:"none"},cardHover:{backgroundColor:"var(--bg-card-hover)"},cardDead:{opacity:.6,backgroundColor:"var(--gray-800)",borderColor:"var(--border)"},cardAtMax:{backgroundColor:"var(--success)",borderColor:"var(--success)"},rowMain:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},rowTitle:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",margin:0},rowMeta:{display:"flex",gap:"8px",alignItems:"center"},badge:{padding:"2px 6px",borderRadius:"3px",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},typeBadge:{backgroundColor:"var(--purple)",color:"var(--text-primary)"},tierBadge:{backgroundColor:"var(--info)",color:"var(--text-primary)"},damageInputPopup:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,borderRadius:"8px"},damageInputContent:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"8px",padding:"8px",display:"flex",flexDirection:"row",gap:"8px",minWidth:"200px",alignItems:"center",position:"absolute",right:"1rem",top:"50%",transform:"translateY(-50%)"},damageInput:{backgroundColor:"var(--gray-900)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--border)",borderRadius:"4px",padding:"4px 6px",color:"var(--text-primary)",fontSize:"16px",width:"80px",textAlign:"center"},damageIndicators:{display:"flex",gap:"8px",alignItems:"center",justifyContent:"center"},damageDrop:{fontSize:"16px",color:"var(--text-secondary)",cursor:"pointer",transition:"color 0.1s ease"},applyButton:{backgroundColor:"var(--gray-600)",color:"white",borderWidth:"0",borderStyle:"none",borderRadius:"4px",padding:"4px 8px",fontSize:"14px",cursor:"pointer",transition:"background-color 0.1s ease",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"32px",minHeight:"32px"}},vr=(t,o,u,l)=>{const[k,p]=c.useState(!1),[b,V]=c.useState("");c.useEffect(()=>{if(k){const j=G=>{G.target.closest(".damage-input-popup")||(p(!1),V(""))};return document.addEventListener("click",j),()=>document.removeEventListener("click",j)}},[k]);const x=j=>{j.stopPropagation(),j.preventDefault();const G=t.hp||0,me=t.hpMax||1,le=j.currentTarget.getBoundingClientRect(),ue=j.clientX-le.left,X=le.width/me;Math.floor(ue/X)<G?u&&u(t.id,1,t.hp):o&&o(t.id,1,t.hp,t.hpMax)},z=j=>{j.stopPropagation(),j.preventDefault();const G=t.stress||0,me=t.stressMax||1,le=j.currentTarget.getBoundingClientRect(),ue=j.clientX-le.left,X=le.width/me;Math.floor(ue/X)<G?l&&l(t.id,-1,t.stress,t.stressMax):l&&l(t.id,1,t.stress,t.stressMax)},O=j=>{j.stopPropagation(),(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")&&(p(!0),V(t.type==="Minion"?"1":""))},g=()=>{const j=parseInt(b);if(j>0){if(t.type==="Minion")o&&o(t.id,j,t.hp,t.hpMax);else{let G=0;j>=t.thresholds.severe?G=3:j>=t.thresholds.major?G=2:j>=1&&(G=1),o&&o(t.id,G,t.hp,t.hpMax)}p(!1),V("")}};return{showDamageInput:k,damageValue:b,setDamageValue:V,setShowDamageInput:p,handleHpClick:x,handleStressClick:z,handleDifficultyClick:O,applyDamage:g,handleKeyDown:j=>{j.key==="Enter"?g():j.key==="Escape"&&(p(!1),V(""))}}},br=({item:t,type:o,mode:u="expanded",onClick:l,onDelete:k,onApplyDamage:p,onApplyHealing:b,onApplyStressChange:V,onUpdate:x,adversaries:z=[],isSelected:O=!1,isEditMode:g=!1,instances:N=[],isEmbedded:j=!1,showAddRemoveButtons:G=!1,onAddInstance:me=null,onRemoveInstance:le=null,onEdit:ue=null,showCustomCreator:X=!1,onSaveCustomAdversary:ge=null,onCancelEdit:Z=null,isStockAdversary:ye=!1})=>{const fe=c.useRef(null),Se=c.useRef(N.length),F=c.useRef(null),P=c.useRef(null),ve=c.useRef(null),Te=c.useRef(null),de=c.useRef(null);c.useEffect(()=>{const s=fe.current;if(!s)return;const C=()=>{F.current=s.scrollHeight,P.current=s.scrollTop};s.addEventListener("scroll",C,{passive:!0});const L=setInterval(C,100);return()=>{s.removeEventListener("scroll",C),clearInterval(L)}},[]),c.useEffect(()=>()=>{fe.current&&(F.current=fe.current.scrollHeight,P.current=fe.current.scrollTop)},[N.length,N]);const[T,S]=c.useState({});c.useEffect(()=>{if(X&&Te.current){const s=setTimeout(()=>{var C,L;(C=Te.current)==null||C.focus(),(L=Te.current)==null||L.select()},650);return()=>clearTimeout(s)}},[X]),c.useLayoutEffect(()=>{const s=N.length,C=Se.current;if(s!==C&&fe.current){const L=F.current,K=P.current;if(!L||K===null){Se.current=s;return}const Y=fe.current,be=Y.scrollHeight,Be=Y.clientHeight;if(!(s<C)){if(s>C){const He=be-Be,_e=Y.scrollTop,n=He-_e;if(Math.abs(n)>.5){ve.current&&(cancelAnimationFrame(ve.current),ve.current=null);const W=400,r=performance.now(),R=xe=>{if(!Y){ve.current=null;return}const $=xe-r,ne=Math.min($/W,1),i=1-ne,A=1-i*i*i,I=_e+n*A;Y.scrollTop=I,ne<1?ve.current=requestAnimationFrame(R):(Y.scrollTop=He,ve.current=null)};ve.current=requestAnimationFrame(R)}}}Se.current=s}else Se.current=s},[N.length,N]);const te=s=>{const L=(t.features||[]).filter(K=>K.type===s.type).findIndex(K=>K===s);return`${s.type}-${L}-${s.name||"blank"}`},re=(s,C)=>`experience-${C}-${typeof s=="string"?s:s.name||"blank"}`,J=s=>!s||!Array.isArray(s)?[]:s.filter(C=>{if(typeof C=="string")return C.trim().length>0;const L=C.name||"",K=C.modifier||0;return L.trim().length>0||K>0}),Re=s=>{const C=te(s);if(T[C]){const L=t.features.filter(K=>K!==s);x&&x(t.id,{features:L}),S(K=>{const Y={...K};return delete Y[C],Y})}else S(L=>({...L,[C]:!0})),setTimeout(()=>{S(L=>{const K={...L};return delete K[C],K})},3e3)},pe=(s,C)=>{const L=re(s,C);if(T[L]){const K=[...t.experience||[]];K.splice(C,1);const Y=J(K);x&&x(t.id,{experience:Y}),S(be=>{const Be={...be};return delete Be[L],Be})}else S(K=>({...K,[L]:!0})),setTimeout(()=>{S(K=>{const Y={...K};return delete Y[L],Y})},3e3)},H=vr(t,p,b,V);(o==="adversary"||o==="adversaries")&&H.handleDifficultyClick;const ke=(s=!1)=>{let C={...$e.card};if(O?C.transition="none":C.transition=$e.transitions.hoverOut,s){const{marginTop:L,...K}=C;C=K}return O&&(C={...C,...$e.cardHover}),o==="adversary"&&(t.hp||0)>=(t.hpMax||1)&&(C={...C,...$e.cardDead}),C},Me=()=>{if(j)return"";let s="border rounded-lg";return O&&(s+=" border-hover"),s},ze=()=>{var s;if(o==="adversary"||o==="adversaries"){const C=t.baseName||((s=t.name)==null?void 0:s.replace(/\s+\(\d+\)$/,""))||"",L=t.duplicateNumber||1,K=[...z];return z.some(Be=>Be.id===t.id)||K.push(t),K.filter(Be=>Be.baseName===C).length>1?`${C} (${L})`:C}return t.name},Oe=()=>{const s=[];return t.type&&s.push(e.jsx("span",{style:{...$e.badge,...$e.typeBadge},children:t.type},"type")),s},d=()=>o!=="adversary"||!H.showDamageInput||!(t.thresholds&&t.thresholds.major&&t.thresholds.severe||t.type==="Minion")?null:e.jsx("div",{className:"damage-input-popup",style:$e.damageInputPopup,onClick:s=>{s.stopPropagation(),s.target===s.currentTarget&&(o==="adversary"||o==="adversaries")&&(H.setShowDamageInput(!1),H.setDamageValue(""))},children:e.jsxs("div",{className:"border rounded-lg",style:{...$e.damageInputContent,borderColor:"var(--border)"},onClick:s=>s.stopPropagation(),children:[e.jsx("input",{type:"number",inputMode:"numeric",enterKeyHint:"done",placeholder:"dmg",min:(t.type==="Minion","0"),value:o==="adversary"||o==="adversaries"?H.damageValue:"",onChange:s=>{(o==="adversary"||o==="adversaries")&&H.setDamageValue(s.target.value)},onKeyDown:o==="adversary"||o==="adversaries"?H.handleKeyDown:void 0,className:"border rounded-sm",style:{...$e.damageInput,borderColor:"var(--border)"},autoFocus:!0}),e.jsxs("div",{style:$e.damageIndicators,children:[t.type==="Minion"?(()=>{var Y,be;const s=parseInt(o==="adversary"||o==="adversaries"?H.damageValue:"0")||0,C=(Y=t.features)==null?void 0:Y.find(Be=>{var He;return(He=Be.name)==null?void 0:He.startsWith("Minion (")}),L=C?parseInt(((be=C.name.match(/\((\d+)\)/))==null?void 0:be[1])||"1"):1,K=Math.floor(s/L);return s>=L&&K>0?e.jsxs("span",{style:{...$e.damageDrop,color:"var(--red)"},title:`${s} damage can defeat ${K+1} minion${K+1!==1?"s":""} (1 + ${K} additional)`,children:["+",K," additional minion(s)"]}):e.jsx("span",{style:$e.damageDrop,title:`${s} damage defeats this minion only`,children:"+0 additional minion(s)"})})():[1,2,3].map(s=>{const C=parseInt(o==="adversary"||o==="adversaries"?H.damageValue:"0")||0;let L=!1;return s===1&&C>=1&&(L=!0),s===2&&C>=t.thresholds.major&&(L=!0),s===3&&C>=t.thresholds.severe&&(L=!0),e.jsx("span",{style:{...$e.damageDrop,color:L?"var(--red)":"var(--text-secondary)"},onClick:K=>{K.stopPropagation(),(o==="adversary"||o==="adversaries")&&(s===1?H.setDamageValue("1"):s===2?H.setDamageValue(t.thresholds.major.toString()):s===3&&H.setDamageValue(t.thresholds.severe.toString()))},title:`Click to set damage to ${s===1?"1":s===2?t.thresholds.major:t.thresholds.severe}`,children:e.jsx(qt,{size:16})},s)}),e.jsx("button",{style:{...$e.applyButton,backgroundColor:"var(--gray-600)"},onClick:s=>{s.stopPropagation(),(o==="adversary"||o==="adversaries")&&(!H.damageValue||parseInt(H.damageValue)<1?(H.setShowDamageInput(!1),H.setDamageValue("")):H.applyDamage())},title:!H.damageValue||parseInt(H.damageValue)<1?"Close damage input":"Apply damage",children:!H.damageValue||parseInt(H.damageValue)<1?e.jsx(at,{size:16}):e.jsx(or,{size:16})})]})]})}),y=()=>{var Y,be,Be,He,_e;const s=(t.hp||0)>=(t.hpMax||1),C=w==="edit"||X,L=o==="adversary",K=L?X?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:n=>{n.stopPropagation(),ge&&(ge(t,t.id),Z&&Z())},style:{background:"var(--purple)",border:"1px solid var(--purple)",color:"white",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:n=>{n.target.style.opacity="0.9"},onMouseLeave:n=>{n.target.style.opacity="1"},title:"Save",children:[e.jsx(zt,{size:16}),e.jsx("span",{children:"Save"})]}),Z&&e.jsxs("button",{onClick:n=>{n.stopPropagation(),Z()},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:n=>{n.target.style.backgroundColor="var(--bg-hover)",n.target.style.borderColor="var(--purple)"},onMouseLeave:n=>{n.target.style.backgroundColor="var(--bg-secondary)",n.target.style.borderColor="var(--border)"},title:"Cancel",children:[e.jsx(at,{size:16}),e.jsx("span",{children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:n=>{n.stopPropagation(),le&&le(t.id)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease"},onMouseEnter:n=>{n.currentTarget.style.backgroundColor="var(--bg-hover)",n.currentTarget.style.borderColor="var(--purple)"},onMouseLeave:n=>{n.currentTarget.style.backgroundColor="var(--bg-secondary)",n.currentTarget.style.borderColor="var(--border)"},title:"Remove one",children:e.jsx(mt,{size:16})}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"1rem",fontWeight:"500",minWidth:"24px",textAlign:"center"},children:N.length}),e.jsx("button",{onClick:n=>{n.stopPropagation(),me&&me(t)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease"},onMouseEnter:n=>{n.currentTarget.style.backgroundColor="var(--purple)",n.currentTarget.style.borderColor="var(--purple)",n.currentTarget.style.color="white"},onMouseLeave:n=>{n.currentTarget.style.backgroundColor="var(--bg-secondary)",n.currentTarget.style.borderColor="var(--border)",n.currentTarget.style.color="var(--text-primary)"},title:"Add another",children:e.jsx(it,{size:16})}),ue&&e.jsx("button",{onClick:n=>{n.stopPropagation(),ue(t.id)},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",fontSize:"0.7rem",transition:"all 0.2s ease",marginLeft:"0.25rem"},onMouseEnter:n=>{n.currentTarget.style.backgroundColor="var(--purple)",n.currentTarget.style.borderColor="var(--purple)",n.currentTarget.style.color="white"},onMouseLeave:n=>{n.currentTarget.style.backgroundColor="var(--bg-secondary)",n.currentTarget.style.borderColor="var(--border)",n.currentTarget.style.color="var(--text-primary)"},title:"Edit",children:e.jsx(tr,{size:16})})]}):null;return e.jsx(At,{tabContent:K,showTab:L,tabBorderColor:O?"var(--purple)":"var(--border)",containerBackgroundColor:s?"var(--gray-900)":ke(!0).backgroundColor,containerBorderColor:s?"color-mix(in srgb, var(--gray-600) 40%, transparent)":O?"var(--purple)":"var(--border)",containerBorderRadius:"8px",containerOverflow:"hidden",containerStyle:{padding:0,opacity:s?.7:1,height:"auto",maxHeight:L?"calc(100vh - 120px)":"calc(100vh - 68px)",minHeight:0},children:e.jsxs("div",{className:Me(),style:{...ke(!0),padding:0,display:"flex",flexDirection:"column",position:"relative",height:"100%",minHeight:0,border:"none",borderRadius:0},onClick:l,children:[s&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                45deg,
                transparent,
                transparent 8px,
                var(--gray-600) 1px,
                var(--gray-600) 9px
              )`,pointerEvents:"none",zIndex:9999}})}),e.jsx("div",{className:"border-b",style:{padding:"8px",flexShrink:0,backgroundColor:"var(--bg-card)",borderRadius:"8px 8px 0 0",position:"relative",zIndex:s?1:"auto",borderBottomColor:O?"var(--purple)":"var(--border)"},children:e.jsx("div",{style:{display:"flex",flexDirection:"column",position:"relative",zIndex:s?1:"auto",padding:"2px",gap:0},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",minHeight:"40px"},children:[C?e.jsx("input",{ref:Te,type:"text",value:t.name||"",onChange:n=>{x&&t.id&&x(t.id,{name:n.target.value})},style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"4px",color:"var(--text-primary)",fontSize:"1.1rem",fontWeight:"600",padding:"0.5rem",width:"100%",maxWidth:"300px",paddingRight:"0.625rem"},placeholder:"Name"}):e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flex:1},children:e.jsx("h4",{style:{...$e.rowTitle,color:s?"color-mix(in srgb, var(--gray-400) 80%, transparent)":$e.rowTitle.color,textAlign:"left",margin:0,fontSize:"1.1rem",paddingRight:"6px",flex:1},children:((Y=t.name)==null?void 0:Y.replace(/\s+\(\d+\)$/,""))||t.name})}),(t.type||t.tier||C)&&e.jsx(yr,{type:t.type,tier:t.tier,isEditMode:C,onUpdate:x,itemId:t.id})]})})}),e.jsxs("div",{ref:fe,style:{borderRadius:"0 0 8px 8px",flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0},className:"invisible-scrollbar",children:[(t.motives||C)&&e.jsx("div",{style:{padding:"0.5rem 8px",textAlign:"center"},children:C?e.jsx("input",{type:"text",value:t.motives||"",onChange:n=>x&&x(t.id,{motives:n.target.value}),placeholder:"Motives...",style:{width:"100%",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}):e.jsxs("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,textAlign:"center"},children:[t.motives,t.motives&&!t.motives.endsWith(".")?".":""]})}),(t.difficulty||t.atk!==void 0||t.thresholds&&t.type!=="Minion"||t.experience&&t.experience.length>0||C)&&e.jsxs("div",{style:{padding:"0.5rem 8px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[(t.difficulty||C)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[e.jsx(rr,{size:32,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(0deg)"}}),C?e.jsx("input",{type:"text",value:t.difficulty||"",onChange:n=>{const W=n.target.value.replace(/[^0-9]/g,"");W.length<=2&&x&&x(t.id,{difficulty:parseInt(W)||0})},onKeyDown:n=>{if(n.key==="ArrowUp"){n.preventDefault();const W=parseInt(t.difficulty)||0;x&&x(t.id,{difficulty:Math.min(W+1,99)})}else if(n.key==="ArrowDown"){n.preventDefault();const W=parseInt(t.difficulty)||0;x&&x(t.id,{difficulty:Math.max(W-1,0)})}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"2"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:t.difficulty})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Difficulty"})]}),(t.atk!==void 0||C)&&e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"36px"},children:[e.jsx(nr,{size:38,strokeWidth:1,style:{color:"var(--text-secondary)",transform:"rotate(45deg)"}}),C?e.jsx("input",{type:"text",value:(()=>{if(typeof t.atk=="string"&&t.atk.includes("d"))return t.atk;const n=typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0;return n>=0?`+${n}`:n.toString()})(),onChange:n=>{const W=n.target.value;if(W.includes("d"))x&&x(t.id,{atk:W});else{const r=W.replace(/[^0-9+\-]/g,"");if(r.length<=4){const R=parseInt(r.replace(/[^0-9\-]/g,""))||0;x&&x(t.id,{atk:R})}}},onKeyDown:n=>{if(!(typeof t.atk=="string"&&t.atk.includes("d"))){if(n.key==="ArrowUp"){n.preventDefault();const r=(typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0)+1;x&&x(t.id,{atk:r})}else if(n.key==="ArrowDown"){n.preventDefault();const r=(typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk||0)-1;x&&x(t.id,{atk:r})}}},style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",backgroundColor:"transparent",border:"none",color:"white",fontSize:"0.8rem",fontWeight:600,width:"20px",height:"20px",textAlign:"center",outline:"none"},maxLength:"3"}):e.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -45%)",fontSize:"0.8rem",fontWeight:600,color:"white",pointerEvents:"none"},children:(()=>{if(typeof t.atk=="string"&&t.atk.includes("d"))return t.atk;const n=typeof t.atk=="string"?parseInt(t.atk.replace(/[^0-9\-]/g,"")):t.atk;return n>=0?`+${n}`:n})()})]}),e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)",marginLeft:"44px"},children:"Attack"})]})]}),e.jsx("div",{style:{paddingTop:"0"},children:C?e.jsx("div",{style:{display:"flex",flexDirection:"column",marginTop:"-0.25rem"},children:(()=>{const n=t.experience||[],W=n.length===0?[{name:"",modifier:0}]:n;return W.map((r,R)=>{var xe,$,ne,i,A,I,se,oe,Ie,je,Ae,Ce,We,qe,Ve,Ke,Qe,Je,et,Ze,Ge,Ye,Ue,lt,f;return e.jsxs("div",{style:{position:"relative",marginBottom:"0.5rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("input",{type:"text",value:typeof r=="object"&&r.modifier>0?`+${r.modifier}`:"",onChange:h=>{const _=[...t.experience||[]],a=h.target.value.replace(/[^0-9+-]/g,""),v=a===""||a==="+"?0:parseInt(a)||0,B=Math.max(0,v);_[R]={name:typeof r=="string"?r:r.name||"",modifier:B};const U=J(_);x&&x(t.id,{experience:U})},onKeyDown:h=>{if(h.key==="ArrowUp"){h.preventDefault();const _=[...t.experience||[]],a=typeof r=="object"&&r.modifier||0;_[R]={name:typeof r=="string"?r:r.name||"",modifier:a+1};const v=J(_);x&&x(t.id,{experience:v})}else if(h.key==="ArrowDown"){h.preventDefault();const _=[...t.experience||[]],a=typeof r=="object"&&r.modifier||0;_[R]={name:typeof r=="string"?r:r.name||"",modifier:Math.max(0,a-1)};const v=J(_);x&&x(t.id,{experience:v})}},style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)",textAlign:"center",outline:"none"}})}),e.jsxs("div",{style:{marginLeft:"32px",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:typeof r=="string"?r:r.name||"",onChange:h=>{var U;const _=[...t.experience||[]],a=typeof r=="object"&&r.modifier||0;_[R]={name:h.target.value,modifier:a};let v=J(_);const B=v[v.length-1];B&&(typeof B=="string"?B.trim():(U=B.name)!=null&&U.trim())&&v.push({name:"",modifier:0}),x&&x(t.id,{experience:v})},placeholder:"Experience name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsxs("div",{style:{display:"flex",gap:"0.125rem"},children:[e.jsx("button",{onClick:()=>{var B,U;const h=[...t.experience||[]],_=typeof r=="string"?r.trim():(B=r.name)==null?void 0:B.trim(),a=h[R-1],v=typeof a=="string"?a.trim():(U=a.name)==null?void 0:U.trim();if(R>0&&R<h.length&&_&&v){h[R]=a,h[R-1]=r;const E=J(h);x&&x(t.id,{experience:E})}},disabled:R===0||!(typeof r=="string"?r.trim():(xe=r.name)!=null&&xe.trim())||!(typeof W[R-1]=="string"?W[R-1].trim():($=W[R-1].name)!=null&&$.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:R===0||!(typeof r=="string"?r.trim():(ne=r.name)!=null&&ne.trim())||!(typeof W[R-1]=="string"?W[R-1].trim():(i=W[R-1].name)!=null&&i.trim())?"var(--gray-800)":"var(--gray-700)",color:R===0||!(typeof r=="string"?r.trim():(A=r.name)!=null&&A.trim())||!(typeof W[R-1]=="string"?W[R-1].trim():(I=W[R-1].name)!=null&&I.trim())?"var(--text-secondary)":"white",cursor:R===0||!(typeof r=="string"?r.trim():(se=r.name)!=null&&se.trim())||!(typeof W[R-1]=="string"?W[R-1].trim():(oe=W[R-1].name)!=null&&oe.trim())?"not-allowed":"pointer",opacity:R===0||!(typeof r=="string"?r.trim():(Ie=r.name)!=null&&Ie.trim())||!(typeof W[R-1]=="string"?W[R-1].trim():(je=W[R-1].name)!=null&&je.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move up",children:"↑"}),e.jsx("button",{onClick:()=>{var B,U;const h=[...t.experience||[]],_=typeof r=="string"?r.trim():(B=r.name)==null?void 0:B.trim(),a=h[R+1],v=typeof a=="string"?a.trim():(U=a.name)==null?void 0:U.trim();if(R<h.length-1&&R>=0&&_&&v){h[R]=a,h[R+1]=r;const E=J(h);x&&x(t.id,{experience:E})}},disabled:R===W.length-1||!(typeof r=="string"?r.trim():(Ae=r.name)!=null&&Ae.trim())||!(typeof W[R+1]=="string"?W[R+1].trim():(Ce=W[R+1].name)!=null&&Ce.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:R===W.length-1||!(typeof r=="string"?r.trim():(We=r.name)!=null&&We.trim())||!(typeof W[R+1]=="string"?W[R+1].trim():(qe=W[R+1].name)!=null&&qe.trim())?"var(--gray-800)":"var(--gray-700)",color:R===W.length-1||!(typeof r=="string"?r.trim():(Ve=r.name)!=null&&Ve.trim())||!(typeof W[R+1]=="string"?W[R+1].trim():(Ke=W[R+1].name)!=null&&Ke.trim())?"var(--text-secondary)":"white",cursor:R===W.length-1||!(typeof r=="string"?r.trim():(Qe=r.name)!=null&&Qe.trim())||!(typeof W[R+1]=="string"?W[R+1].trim():(Je=W[R+1].name)!=null&&Je.trim())?"not-allowed":"pointer",opacity:R===W.length-1||!(typeof r=="string"?r.trim():(et=r.name)!=null&&et.trim())||!(typeof W[R+1]=="string"?W[R+1].trim():(Ze=W[R+1].name)!=null&&Ze.trim())?.5:1,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Move down",children:"↓"}),e.jsx("button",{onClick:()=>pe(r,R),disabled:!(typeof r=="string"?r.trim():(Ge=r.name)!=null&&Ge.trim()),style:{width:"22px",height:"22px",padding:"0",border:"1px solid var(--border)",borderRadius:"3px",backgroundColor:T[re(r,R)]?"var(--danger)":(typeof r=="string"?r.trim():(Ye=r.name)!=null&&Ye.trim())?"var(--gray-700)":"var(--gray-800)",color:(typeof r=="string"?r.trim():(Ue=r.name)!=null&&Ue.trim())?"white":"var(--text-secondary)",cursor:(typeof r=="string"?r.trim():(lt=r.name)!=null&&lt.trim())?"pointer":"not-allowed",opacity:(typeof r=="string"?r.trim():(f=r.name)!=null&&f.trim())?1:.5,fontWeight:"600",fontSize:"12px",lineHeight:"1",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:T[re(r,R)]?"Click again to confirm delete":"Delete experience",children:"×"})]})]})]},R)})})()}):e.jsx("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:t.experience&&t.experience.length>0?t.experience.map((n,W)=>{if(typeof n=="string"){const r=n.match(/^(.+?)\s*([+-]?\d+)$/);if(r){const[,R,xe]=r;return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:xe})})}),e.jsx("span",{style:{marginLeft:"32px"},children:R})]},W)}else return e.jsx("div",{style:{marginBottom:"0.25rem"},children:n},W)}else return e.jsxs("div",{style:{position:"relative",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",width:"24px",height:"24px"},children:e.jsx("div",{style:{width:"24px",height:"24px",border:"1px solid var(--text-secondary)",borderRadius:"4px",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px"},children:e.jsxs("span",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)"},children:[n.modifier>=0?"+":"",n.modifier]})})}),e.jsx("span",{style:{marginLeft:"32px"},children:n.name})]},W)}):null})})]}),(t.features&&t.features.length>0||C)&&e.jsxs("div",{style:{padding:"0 8px 8px 8px"},children:[(t.atk!==void 0&&t.weapon||C)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Standard Attack"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:C?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",marginTop:"0.75rem",marginBottom:"0.75rem"},children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[e.jsx("input",{type:"text",value:t.weapon||"",onChange:n=>x&&x(t.id,{weapon:n.target.value}),placeholder:"Standard attack name",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}}),e.jsxs("select",{value:t.range||"",onChange:n=>x&&x(t.id,{range:n.target.value}),style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",appearance:"none",backgroundImage:`url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",backgroundSize:"1rem",paddingRight:"2rem"},children:[e.jsx("option",{value:""}),e.jsx("option",{value:"Melee",children:"Melee"}),e.jsx("option",{value:"Very Close",children:"Very Close"}),e.jsx("option",{value:"Close",children:"Close"}),e.jsx("option",{value:"Far",children:"Far"}),e.jsx("option",{value:"Very Far",children:"Very Far"})]}),e.jsx("input",{type:"text",value:t.damage||"",onChange:n=>x&&x(t.id,{damage:n.target.value}),placeholder:"Damage (e.g., 1d6+2)",style:{flex:1,padding:"0.25rem 0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem"}})]})}):t.atk!==void 0&&t.weapon&&e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:t.weapon}),e.jsxs("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:["Make an attack against a target within ",t.range||"Melee"," range. On a success, deal ",t.damage||"damage varies","."]})]})})]}),(t.features.filter(n=>n.type==="Action").length>0||C)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Actions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const n=t.features.filter(r=>r.type==="Action");return(C&&n.length===0?[{type:"Action",name:"",description:""}]:n).map((r,R)=>C?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:r.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false","data-lpignore":"true","data-form-type":"other",name:`feature-name-${r.type.toLowerCase()}`,onChange:xe=>{const $=[...t.features||[]],ne=$.findIndex(I=>I.type==="Action"&&I===r);ne>=0?$[ne]={...$[ne],name:xe.target.value}:$.push({type:"Action",name:xe.target.value,description:r.description||""});const i=$.filter(I=>I.type==="Action"),A=i[i.length-1];A&&A.name.trim()&&$.push({type:"Action",name:"",description:""}),x&&x(t.id,{features:$})},placeholder:"Action name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:r.description||"",onChange:xe=>{const $=[...t.features||[]],ne=$.findIndex(I=>I.type==="Action"&&I===r);ne>=0?$[ne]={...$[ne],description:xe.target.value}:$.push({type:"Action",name:r.name||"",description:xe.target.value});const i=$.filter(I=>I.type==="Action"),A=i[i.length-1];A&&A.name.trim()&&$.push({type:"Action",name:"",description:""}),x&&x(t.id,{features:$})},onInput:xe=>{const $=xe.target.offsetHeight;xe.target.style.height="auto";const ne=xe.target.scrollHeight,i=ne>$?ne:$;xe.target.style.height=i+"px"},placeholder:"Action description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(wt,{feature:r,featureType:"Action",item:t,onUpdate:x,handleFeatureDeleteClick:Re,deleteConfirmations:T,getFeatureKey:te})]},R):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:r.name}),r.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:r.description})]},R))})()})]}),(t.features.filter(n=>n.type==="Passive").length>0||C)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Passives"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const n=t.features.filter(r=>r.type==="Passive");return(C&&n.length===0?[{type:"Passive",name:"",description:""}]:n).map((r,R)=>C?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:r.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:xe=>{const $=[...t.features||[]],ne=$.findIndex(I=>I.type==="Passive"&&I===r);ne>=0?$[ne]={...$[ne],name:xe.target.value}:$.push({type:"Passive",name:xe.target.value,description:r.description||""});const i=$.filter(I=>I.type==="Passive"),A=i[i.length-1];A&&A.name.trim()&&$.push({type:"Passive",name:"",description:""}),x&&x(t.id,{features:$})},placeholder:"Passive name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:r.description||"",onChange:xe=>{const $=[...t.features||[]],ne=$.findIndex(I=>I.type==="Passive"&&I===r);ne>=0?$[ne]={...$[ne],description:xe.target.value}:$.push({type:"Passive",name:r.name||"",description:xe.target.value});const i=$.filter(I=>I.type==="Passive"),A=i[i.length-1];A&&A.name.trim()&&$.push({type:"Passive",name:"",description:""}),x&&x(t.id,{features:$})},onInput:xe=>{const $=xe.target.offsetHeight;xe.target.style.height="auto";const ne=xe.target.scrollHeight,i=ne>$?ne:$;xe.target.style.height=i+"px"},placeholder:"Passive description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(wt,{feature:r,featureType:"Passive",item:t,onUpdate:x,handleFeatureDeleteClick:Re,deleteConfirmations:T,getFeatureKey:te})]},R):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:r.name}),r.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:r.description})]},R))})()})]}),(t.features.filter(n=>n.type==="Reaction").length>0||C)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Reactions"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:(()=>{const n=t.features.filter(r=>r.type==="Reaction");return(C&&n.length===0?[{type:"Reaction",name:"",description:""}]:n).map((r,R)=>C?e.jsxs("div",{style:{display:"flex",gap:"0.25rem",margin:"0.5rem 0",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-secondary)",alignItems:"stretch"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:r.name||"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:xe=>{const $=[...t.features||[]],ne=$.findIndex(I=>I.type==="Reaction"&&I===r);ne>=0?$[ne]={...$[ne],name:xe.target.value}:$.push({type:"Reaction",name:xe.target.value,description:r.description||""});const i=$.filter(I=>I.type==="Reaction"),A=i[i.length-1];A&&A.name.trim()&&$.push({type:"Reaction",name:"",description:""}),x&&x(t.id,{features:$})},placeholder:"Reaction name",style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",transition:"background-color 0.2s"}}),e.jsx("textarea",{value:r.description||"",onChange:xe=>{const $=[...t.features||[]],ne=$.findIndex(I=>I.type==="Reaction"&&I===r);ne>=0?$[ne]={...$[ne],description:xe.target.value}:$.push({type:"Reaction",name:r.name||"",description:xe.target.value});const i=$.filter(I=>I.type==="Reaction"),A=i[i.length-1];A&&A.name.trim()&&$.push({type:"Reaction",name:"",description:""}),x&&x(t.id,{features:$})},onInput:xe=>{const $=xe.target.offsetHeight;xe.target.style.height="auto";const ne=xe.target.scrollHeight,i=ne>$?ne:$;xe.target.style.height=i+"px"},placeholder:"Reaction description",rows:1,style:{padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",resize:"none",overflow:"hidden",minHeight:"2rem"}})]}),e.jsx(wt,{feature:r,featureType:"Reaction",item:t,onUpdate:x,handleFeatureDeleteClick:Re,deleteConfirmations:T,getFeatureKey:te})]},R):e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.4,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:"0.25rem",display:"block"},children:r.name}),r.description&&e.jsx("div",{style:{marginLeft:"0.25rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:r.description})]},R))})()})]})]}),(N&&N.length>0||t.type!=="Minion"&&(t.thresholds||C))&&e.jsxs("div",{style:{padding:"0 8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Status"})]}),C?e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border)"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"number",value:t.hpMax||"",onChange:n=>{const W=parseInt(n.target.value)||1;x&&x(t.id,{hpMax:W})},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),e.jsx(dt,{type:"adversaryHP",value:0,maxValue:t.hpMax||1,showTooltip:!1}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:"HP"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"number",value:t.stressMax||"",onChange:n=>{const W=parseInt(n.target.value)||1;x&&x(t.id,{stressMax:W})},min:"1",max:"99",style:{width:"40px",padding:"0.25rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}}),e.jsx(dt,{type:"adversaryStress",value:0,maxValue:t.stressMax||1,showTooltip:!1}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textTransform:"uppercase",minWidth:"40px"},children:"Stress"})]})]})})}):N&&N.length>0&&N.map((n,W)=>{const r=(n.hp||0)>=(n.hpMax||1);return e.jsx("div",{"data-instance-id":n.id,style:{marginBottom:"0.5rem"},children:e.jsxs("div",{style:{backgroundColor:r?"var(--gray-900)":"var(--bg-primary)",borderRadius:"6px",padding:"0.25rem 0.5rem",border:"1px solid",borderColor:r?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",display:"flex",justifyContent:"flex-start",alignItems:"center",gap:"0.5rem",opacity:r?.7:1,position:"relative",transition:"all 0.2s ease",minHeight:"40px"},children:[r&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:`repeating-linear-gradient(
                          45deg,
                          transparent 0px,
                          transparent 8px,
                          var(--gray-600) 9px,
                          var(--gray-600) 9px
                        )`,pointerEvents:"none",zIndex:1,borderRadius:"4px"}})}),e.jsx("div",{style:{backgroundColor:r?"var(--gray-900)":"var(--bg-card)",border:"1px solid",borderColor:r?"color-mix(in srgb, var(--gray-600) 40%, transparent)":"var(--text-secondary)",borderRadius:"50%",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",flexShrink:0,opacity:r?.5:1},children:e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:600,color:r?"var(--gray-400)":"var(--text-primary)"},children:n.duplicateNumber||1})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.125rem"},children:[e.jsx("div",{style:{opacity:r?.3:1},children:e.jsx(dt,{type:"adversaryHP",value:n.hp||0,maxValue:n.hpMax||1,onPipClick:(R,xe)=>{if(p&&o==="adversary"){const $=n.hp||0,ne=n.hpMax||1;xe?b&&b(n.id,1,$):$<ne&&p(n.id,1,$,ne)}},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})}),n.stressMax>0&&e.jsx("div",{style:{opacity:r?.3:1},children:e.jsx(dt,{type:"adversaryStress",value:n.stress||0,maxValue:n.stressMax,onPipClick:(R,xe)=>{V&&o==="adversary"&&(xe?V(n.id,-1):V(n.id,1))},containerStyle:{height:"auto",padding:"0"},pipStyle:{fontSize:"1rem",width:"1.25rem",height:"1.25rem"},size:"lg",showTooltip:!1})})]})]},n.id)},n.id)}),t.type!=="Minion"&&(t.thresholds||C)&&e.jsx("div",{style:{display:"flex",justifyContent:"center",paddingTop:"1px",marginTop:"0.5rem",marginBottom:"0.5rem"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",position:"relative"},children:e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"1px",height:"36px"},children:[e.jsx("svg",{width:"300",height:"36",viewBox:"0 0 300 36",style:{position:"absolute",zIndex:1},children:e.jsx("rect",{x:"20",y:"6",width:"260",height:"24",fill:"var(--bg-primary)",stroke:"var(--text-secondary)",strokeWidth:"1",rx:"4"})}),e.jsx("div",{style:{position:"relative",zIndex:2,display:"flex",alignItems:"center",gap:"0.5rem"},children:C?e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",fontSize:"0.8rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),e.jsx("input",{type:"number",min:"1",max:"99",value:((be=t.thresholds)==null?void 0:be.major)||"",onChange:n=>{const W=n.target.value;(W===""||parseInt(W)>=1&&parseInt(W)<=99)&&x&&x(t.id,{thresholds:{...t.thresholds,major:W===""?null:parseInt(W)}})},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),e.jsx("input",{type:"number",min:"1",max:"99",value:((Be=t.thresholds)==null?void 0:Be.severe)||"",onChange:n=>{const W=n.target.value;(W===""||parseInt(W)>=1&&parseInt(W)<=99)&&x&&x(t.id,{thresholds:{...t.thresholds,severe:W===""?null:parseInt(W)}})},style:{width:"30px",padding:"0.125rem 0.25rem",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.8rem",textAlign:"center"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Minor"}),e.jsx($t,{value:((He=t.thresholds)==null?void 0:He.major)||7}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Major"}),e.jsx($t,{value:((_e=t.thresholds)==null?void 0:_e.severe)||14}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.6875rem",fontWeight:"500",textTransform:"uppercase"},children:"Severe"})]})})]})})})]}),(C||u==="expanded"&&t.description&&t.description.trim())&&e.jsxs("div",{style:{padding:"0 8px",textAlign:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"-0.25rem"},children:[e.jsx("hr",{style:{flex:1,border:"none",borderTop:"1px solid var(--border)",margin:0}}),e.jsx("h4",{style:{margin:0,fontSize:"0.75rem",fontWeight:"500",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px",marginLeft:"0.75rem"},children:"Description"})]}),C?e.jsx("textarea",{style:{width:"100%",minHeight:"100px",padding:"0.5rem",border:"1px solid var(--border)",borderRadius:"0.5rem",backgroundColor:"var(--bg-primary)",color:"white",fontSize:"0.875rem",lineHeight:1.5,resize:"none",overflow:"hidden",fontFamily:"inherit",marginTop:"0.75rem",marginBottom:"0.75rem"},value:t.description,onChange:n=>{n.target.style.height="auto",n.target.style.height=n.target.scrollHeight+"px",x&&x(t.id,{description:n.target.value})},placeholder:"Description..."}):e.jsx("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"var(--text-secondary)",lineHeight:1.4,whiteSpace:"pre-wrap",padding:"0.5rem 0"},children:t.description})]})]}),d()]})})};if(X&&(o==="adversary"||o==="adversaries")){const s=o==="adversary",C=s?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:L=>{var K;L.stopPropagation(),(K=de.current)!=null&&K.handleSave&&de.current.handleSave()},style:{background:"var(--purple)",border:"1px solid var(--purple)",color:"white",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:L=>{L.currentTarget.style.opacity="0.9"},onMouseLeave:L=>{L.currentTarget.style.opacity="1"},title:"Save",children:[e.jsx(zt,{size:16}),e.jsx("span",{children:"Save"})]}),Z&&e.jsxs("button",{onClick:L=>{L.stopPropagation(),Z()},style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"4px",padding:"0.375rem 0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.375rem",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:L=>{L.currentTarget.style.backgroundColor="var(--bg-hover)",L.currentTarget.style.borderColor="var(--purple)"},onMouseLeave:L=>{L.currentTarget.style.backgroundColor="var(--bg-secondary)",L.currentTarget.style.borderColor="var(--border)"},title:"Cancel",children:[e.jsx(at,{size:16}),e.jsx("span",{children:"Cancel"})]})]}):null;return e.jsx(At,{tabContent:C,containerStyle:{padding:0,height:"auto",maxHeight:s?"calc(100vh - 120px)":"calc(100vh - 68px)",minHeight:0},children:e.jsx(Mt,{ref:de,editingAdversary:t,onSave:ge,onCancelEdit:Z,isStockAdversary:ye,embedded:!0,hideEmbeddedButtons:!0,allAdversaries:z,autoFocus:!t.baseName||t.baseName.trim()===""||t.baseName==="Unknown"})})}const w=X?"edit":u;return(w==="expanded"||w==="edit")&&(o==="adversary"||o==="adversaries")?y():o==="adversary"||o==="adversaries"?null:e.jsxs("div",{className:Me(),style:ke(!0),children:[e.jsxs("div",{style:$e.rowMain,children:[e.jsx("h4",{style:$e.rowTitle,children:ze()}),e.jsx("div",{style:$e.rowMeta,children:Oe()})]}),e.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"12px",margin:0},children:["Expanded view coming soon for ",o]})]})},ft=br,wr="/Daggerheart/assets/daggerheart-logo-fe7815ad.svg",Sr=(t,o)=>{const[u,l]=c.useState("max-content"),k=c.useCallback(()=>{if(!o.current||t<=3)return"max-content";const p=o.current.offsetWidth,V=Math.floor(p/120);return V<=1?"max-content":t===4?"max-content max-content":t===5||t===6?V>=2?"max-content max-content":"max-content":t===7?V>=3?"max-content max-content max-content":V>=2?"max-content max-content":"max-content":"repeat(auto-fit, minmax(80px, max-content))"},[t,o]);return c.useEffect(()=>{const p=k();l(p);const b=new ResizeObserver(()=>{const V=k();l(V)});return o.current&&b.observe(o.current),()=>{b.disconnect()}},[k]),u},Cr=({encounter:t})=>{var k,p;const o=c.useRef(null),u=((k=t.encounterItems)==null?void 0:k.length)||0,l=Sr(u,o);return e.jsx("div",{ref:o,className:"saved-encounter-adversary-list",style:{flex:1,fontSize:"0.8rem",color:"var(--text-secondary)",lineHeight:"1.3",display:"grid",gridTemplateColumns:l,gap:"0.25rem 1rem",gridAutoRows:"min-content"},children:((p=t.encounterItems)==null?void 0:p.length)>0?t.encounterItems.map((b,V)=>{var z;const x=b.item.baseName||((z=b.item.name)==null?void 0:z.replace(/\s+\(\d+\)$/,""))||b.item.name;return e.jsxs("div",{style:{marginBottom:"0.125rem"},children:[b.quantity,"x ",x]},V)}):e.jsx("div",{children:"No adversaries"})})},ut={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},pt={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1,lowerTierAdversary:1};let ot={adversaries:[]},Et={environments:[]},ht=!1;const jr=()=>{const t=JSON.parse(localStorage.getItem("daggerheart-custom-adversaries")||"[]"),o=JSON.parse(localStorage.getItem("daggerheart-custom-environments")||"[]");return{customAdversaries:t,customEnvironments:o}},St=async()=>{if(ht)return;let t={adversaries:[]},o={environments:[]},u={adversaries:[]},l={environments:[]};try{const b=await st(()=>import("./adversaries-9c8932de.js"),[]);t=(b==null?void 0:b.default)||b}catch(b){console.warn("Failed to load adversaries.json:",b)}try{const b=await st(()=>import("./environments-c340637c.js"),[]);o=(b==null?void 0:b.default)||b}catch(b){console.warn("Failed to load environments.json:",b)}try{const b=await st(()=>import("./playtest-adversaries-4a099c10.js"),[]);u=(b==null?void 0:b.default)||b}catch(b){console.warn("Failed to load playtest-adversaries.json:",b)}try{const b=await st(()=>import("./playtest-environments-d9cdffb6.js"),[]);l=(b==null?void 0:b.default)||b}catch(b){console.warn("Failed to load playtest-environments.json:",b)}const{customAdversaries:k,customEnvironments:p}=jr();ot={...t,adversaries:[...t.adversaries||[],...u.adversaries||[],...k]},Et={...o,environments:[...o.environments||[],...l.environments||[],...p]},ht=!0},kr=(t,o=[],u=4,l=1,k=!1,p=null)=>{const[b,V]=c.useState(""),[x,z]=c.useState([{field:"tier",direction:"asc"},{field:"name",direction:"asc"}]),[O,g]=c.useState([]),[N,j]=c.useState(!0),[G,me]=c.useState([]),[le,ue]=c.useState([]),[X,ge]=c.useState(!1),[Z,ye]=c.useState(!1),fe=c.useRef(null),Se=c.useRef(null);c.useEffect(()=>{(async()=>{await St(),j(!1);let H=[];t==="adversary"?H=ot.adversaries||[]:t==="environment"&&(H=Et.environments||[]),g(H)})()},[t]),c.useEffect(()=>{t==="adversary"&&p&&(async()=>{ht=!1,await St();let H=[];k?H=(ot.adversaries||[]).filter(ke=>{var Me;return ke.source==="Homebrew"||((Me=ke.id)==null?void 0:Me.startsWith("custom-"))}):H=ot.adversaries||[],g(H)})()},[p,t,k]);const F=pe=>{const H=O.map(ke=>ke[pe]).filter(Boolean);return[...new Set(H)].sort((ke,Me)=>typeof ke=="number"&&typeof Me=="number"?ke-Me:String(ke).localeCompare(String(Me)))},P=c.useCallback(async()=>{ht=!1,await St();let pe=[];t==="adversary"?k?pe=(ot.adversaries||[]).filter(H=>{var ke;return H.source==="Homebrew"||((ke=H.id)==null?void 0:ke.startsWith("custom-"))}):pe=ot.adversaries||[]:t==="environment"&&(pe=Et.environments||[]),g(pe)},[t,k]);c.useEffect(()=>{P()},[k,P]);const ve=F("tier"),Te=F("type"),de=c.useMemo(()=>{let pe=O.filter(H=>{var d,y;const Me=(H.name||H.baseName||"").toLowerCase().includes(b.toLowerCase())||((d=H.type)==null?void 0:d.toLowerCase().includes(b.toLowerCase()))||((y=H.description)==null?void 0:y.toLowerCase().includes(b.toLowerCase())),ze=G.length===0||G.includes(H.tier.toString()),Oe=le.length===0||le.includes(H.type);return Me&&ze&&Oe});return pe.sort((H,ke)=>{for(const Me of x){const{field:ze,direction:Oe}=Me;let d=H[ze],y=ke[ze];if(ze==="tier")d=parseInt(d)||0,y=parseInt(y)||0;else if(ze==="atk")d=parseInt(d)||0,y=parseInt(y)||0;else if(ze==="cost"){const w=m=>{if(t!=="adversary")return 0;const s=ut[m.type]||2;let C=0;const L=o.filter(Y=>Y.type==="adversary"&&Y.item.type==="Solo"&&Y.quantity>0).reduce((Y,be)=>Y+be.quantity,0),K=o.filter(Y=>Y.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(Y.item.type)&&Y.quantity>0).reduce((Y,be)=>Y+be.quantity,0);return m.type==="Solo"&&L===1&&(C+=2),["Bruiser","Horde","Leader","Solo"].includes(m.type)&&K===0&&(C+=1),s+C};d=w(H),y=w(ke)}else if(ze==="difficulty"){const w=parseInt(d),m=parseInt(y);!isNaN(w)&&!isNaN(m)?(d=w,y=m):!isNaN(w)&&isNaN(m)?(d=w,y=999):isNaN(w)&&!isNaN(m)?(d=999,y=m):(d=String(d||"").toLowerCase(),y=String(y||"").toLowerCase())}else typeof d=="string"&&typeof y=="string"?(d=d.toLowerCase(),y=y.toLowerCase()):(d=String(d||"").toLowerCase(),y=String(y||"").toLowerCase());if(Oe==="asc"){if(d>y)return 1;if(d<y)return-1}else{if(d<y)return 1;if(d>y)return-1}}return 0}),pe},[O,b,x,G,le,o,u,l]),T=pe=>{z(H=>{const ke=H.findIndex(Me=>Me.field===pe);if(ke>=0)if(ke===0){const Me=[...H];return Me[0]={...Me[0],direction:Me[0].direction==="asc"?"desc":"asc"},Me}else{const Me=[...H];return Me.splice(ke,1)[0],[{field:pe,direction:"asc"},...Me]}else return[{field:pe,direction:"asc"},...H]})},S=pe=>{me(pe==="clear"?[]:H=>H.includes(pe)?H.filter(ke=>ke!==pe):[...H,pe])},te=pe=>{ue(pe==="clear"?[]:H=>H.includes(pe)?H.filter(ke=>ke!==pe):[...H,pe])},re=G.length>0,J=le.length>0;return c.useEffect(()=>{const pe=ke=>{const Me=ke.target.closest(".filter-dropdown"),ze=ke.target.closest(".header-filter-icon");Me||ze||(ge(!1),ye(!1))},H=ke=>{ke.key==="Escape"&&(ge(!1),ye(!1))};return document.addEventListener("pointerdown",pe,!0),document.addEventListener("mousedown",pe,!0),document.addEventListener("touchstart",pe,!0),document.addEventListener("click",pe,!0),document.addEventListener("keydown",H,!0),()=>{document.removeEventListener("pointerdown",pe,!0),document.removeEventListener("mousedown",pe,!0),document.removeEventListener("touchstart",pe,!0),document.removeEventListener("click",pe,!0),document.removeEventListener("keydown",H,!0)}},[ge,ye]),{searchTerm:b,setSearchTerm:V,sortFields:x,handleSort:T,filteredAndSortedData:de,loading:N,refreshData:P,selectedTiers:G,selectedTypes:le,showTierDropdown:X,setShowTierDropdown:ge,showTypeDropdown:Z,setShowTypeDropdown:ye,tierFilterRef:fe,typeFilterRef:Se,uniqueTiers:ve,uniqueTypes:Te,handleTierSelect:S,handleTypeSelect:te,isTierFiltered:re,isTypeFiltered:J,getDropdownStyle:pe=>{if(!pe.current)return{};const H=pe.current.getBoundingClientRect();return{position:"fixed",top:H.bottom+4,left:H.left-100,zIndex:99999}}}},Ir=({searchTerm:t,onSearchChange:o,type:u,partyControls:l,showCustomToggle:k=!1,onToggleCustom:p,filterCustom:b=!1,onExportCustomAdversaries:V,onImportCustomAdversaries:x,autoFocus:z=!1,onClose:O=null,placeholder:g="Search"})=>{const N=c.useRef(null);return c.useEffect(()=>{z&&N.current&&setTimeout(()=>{var j;(j=N.current)==null||j.focus()},100)},[z]),e.jsxs("div",{className:"browser-header",style:he.browserHeader,children:[e.jsx("div",{style:{display:"flex",alignItems:"center",flex:1,gap:"0.5rem"},children:e.jsx("input",{ref:N,type:"text",placeholder:g,value:t,onChange:j=>o(j.target.value),style:{...he.searchInput,flex:1,marginRight:0}})}),l&&e.jsx("div",{style:he.partyControls,children:l})]})},Ar=({showCustomToggle:t=!1,onToggleCustom:o,filterCustom:u=!1,onExportCustomAdversaries:l,onImportCustomAdversaries:k})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)",flexShrink:0},children:[t&&e.jsxs("button",{onClick:()=>o&&o(!u),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:u?"var(--purple)":"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:u?"white":"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:p=>{u||(p.target.style.backgroundColor="var(--bg-hover)",p.target.style.borderColor="var(--purple)")},onMouseLeave:p=>{u||(p.target.style.backgroundColor="var(--bg-primary)",p.target.style.borderColor="var(--border)")},children:[e.jsx("span",{children:u?"✓":"○"}),"Custom Only"]}),e.jsxs("button",{onClick:l,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:p=>{p.target.style.backgroundColor="var(--bg-hover)",p.target.style.borderColor="var(--purple)"},onMouseLeave:p=>{p.target.style.backgroundColor="var(--bg-primary)",p.target.style.borderColor="var(--border)"},children:[e.jsx("span",{children:"↓"}),"Export"]}),e.jsxs("button",{onClick:()=>document.getElementById("import-file-input").click(),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",fontSize:"0.875rem",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},onMouseEnter:p=>{p.target.style.backgroundColor="var(--bg-hover)",p.target.style.borderColor="var(--purple)"},onMouseLeave:p=>{p.target.style.backgroundColor="var(--bg-primary)",p.target.style.borderColor="var(--border)"},children:[e.jsx("span",{children:"↑"}),"Import"]}),e.jsx("input",{id:"import-file-input",type:"file",accept:".csv,.json",onChange:k,style:{display:"none"}})]}),Er=({sortFields:t,onSort:o,type:u,uniqueTiers:l,uniqueTypes:k,selectedTiers:p,selectedTypes:b,showTierDropdown:V,setShowTierDropdown:x,showTypeDropdown:z,setShowTypeDropdown:O,tierFilterRef:g,typeFilterRef:N,handleTierSelect:j,handleTypeSelect:G,isTierFiltered:me,isTypeFiltered:le,getDropdownStyle:ue,costFilter:X,showCostDropdown:ge,setShowCostDropdown:Z,costFilterRef:ye,handleCostFilterSelect:fe,isCostFiltered:Se})=>{const[F,P]=c.useState(null),Te=(()=>u==="adversary"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0,hasCostFilter:!0},{key:"source",label:"Src"}]:u==="environment"?[{key:"name",label:"Name"},{key:"tier",label:"Tier",hasFilter:!0},{key:"type",label:"Type",hasFilter:!0},{key:"difficulty",label:"Diff"}]:[])(),de=()=>{if(!ge)return null;const S=[{value:"all",label:"All"},{value:"auto-grey",label:"Auto Grey"},{value:"auto-hide",label:"Auto Hide"}];return kt.createPortal(e.jsx("div",{className:"filter-dropdown",style:{...he.filterDropdown,...ue(ye),maxHeight:"60vh",overflow:"auto"},onMouseDown:te=>te.stopPropagation(),onClick:te=>te.stopPropagation(),children:S.map(te=>{const re=X===te.value;return e.jsxs("div",{style:{...he.filterOption,...re?he.filterOptionSelected:{}},onClick:()=>fe(te.value),children:[e.jsx("span",{style:he.checkIcon,children:re?e.jsx(xt,{size:16}):e.jsx(yt,{size:16})}),e.jsx("span",{style:he.filterLabel,children:te.label})]},te.value)})}),document.body)},T=(S,te,re,J,Re,pe,H,ke)=>{if(!Re)return null;const Me=()=>{(S==="tier"||S==="type")&&J("clear")};return kt.createPortal(e.jsxs("div",{className:"filter-dropdown",style:{...he.filterDropdown,...ue(H),maxHeight:"60vh",overflow:"auto"},onMouseDown:ze=>ze.stopPropagation(),onClick:ze=>ze.stopPropagation(),children:[e.jsxs("div",{style:{...he.filterOption,...re.length===0?he.filterOptionSelected:{}},onClick:Me,children:[e.jsx("span",{style:he.checkIcon,children:re.length===0?e.jsx(xt,{size:16}):e.jsx(yt,{size:16})}),e.jsx("span",{style:he.filterLabel,children:"All"})]}),te.map(ze=>{const Oe=re.includes(ze.toString());return e.jsxs("div",{style:{...he.filterOption,...Oe?he.filterOptionSelected:{}},onClick:()=>J(ze.toString()),children:[e.jsx("span",{style:he.checkIcon,children:Oe?e.jsx(xt,{size:16}):e.jsx(yt,{size:16})}),e.jsx("span",{style:he.filterLabel,children:ze})]},ze)})]}),document.body)};return e.jsx("tr",{style:he.tableHeader,children:Te.map(S=>e.jsxs("th",{style:{...he.tableHeaderCell,...F===S.key?he.tableHeaderCellHover:{},position:"relative",...S.key==="name"?{width:"auto",minWidth:"0"}:{},...S.key==="tier"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{},...S.key==="type"?{width:"80px",minWidth:"80px",maxWidth:"80px"}:{},...S.key==="source"?{width:"40px",minWidth:"40px",maxWidth:"40px"}:{}},onClick:()=>o(S.key),onMouseEnter:()=>P(S.key),onMouseLeave:()=>P(null),children:[S.hasFilter?e.jsxs("div",{style:he.headerWithFilter,children:[e.jsx("span",{style:{cursor:"pointer"},onClick:te=>{te.stopPropagation(),o(S.key)},children:S.label}),e.jsxs("button",{ref:S.key==="tier"?g:S.key==="type"&&S.hasCostFilter?ye:S.key==="type"?N:ye,style:{...he.headerFilterIcon,...S.key==="tier"&&me?he.headerFilterIconActive:{},...S.key==="type"&&(le||Se)?he.headerFilterIconActive:{},...S.key==="cost"&&Se?he.headerFilterIconActive:{}},className:"header-filter-icon",onClick:te=>{te.stopPropagation(),S.key==="tier"?(x(!V),O(!1),Z(!1)):S.key==="type"&&(S.hasCostFilter?(Z(!ge),x(!1),O(!1)):(O(!z),x(!1),Z(!1)))},children:[e.jsx(sr,{size:14}),S.key==="tier"&&me||S.key==="type"&&(le||Se)||S.key==="cost"&&Se?e.jsx("span",{style:he.filterActiveDot}):null]})]}):S.label,S.key==="tier"&&T("tier",l,p,j,V,x,g),S.key==="type"&&!S.hasCostFilter&&T("type",k,b,G,z,O,N),S.key==="type"&&S.hasCostFilter&&de()]},S.key))})},Tr=({item:t,onAdd:o,type:u,onRowClick:l,encounterItems:k=[],pcCount:p=4,playerTier:b=1,remainingBudget:V=0,costFilter:x="auto-grey",isFocused:z=!1,rowRef:O=null,onDeleteCustomAdversary:g=null,isDeleteConfirmed:N=!1})=>{const[j,G]=c.useState(!1),me=()=>{o(t)},le=()=>{if(u!=="adversary")return null;const ge=ut[t.type]||2;let Z=0;const ye=k.filter(Se=>Se.type==="adversary"&&Se.item.type==="Solo"&&Se.quantity>0).reduce((Se,F)=>Se+F.quantity,0),fe=k.filter(Se=>Se.type==="adversary"&&["Bruiser","Horde","Leader","Solo"].includes(Se.item.type)&&Se.quantity>0).reduce((Se,F)=>Se+F.quantity,0);return t.type==="Solo"&&ye===1&&(Z+=2),["Bruiser","Horde","Leader","Solo"].includes(t.type)&&fe===0&&(Z+=1),ge+Z},X=(()=>{if(u==="adversary"){const ge=le();ut[t.type];const Z=ge>V||V<=0;if(x==="auto-hide"&&Z)return null;const ye=x==="auto-grey"&&Z?{opacity:.5,color:"var(--text-secondary)"}:{};return t.description||t.motives?[[e.jsx("td",{style:{...he.rowCell,width:"auto",minWidth:"0",textAlign:"left",...ye,borderBottom:"none",padding:"0.25rem 0.25rem 0 0.5rem",outline:"none"},children:e.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%",display:"flex",alignItems:"center",gap:"0.5rem"},children:e.jsx("div",{style:{flex:1,minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx("div",{style:{fontWeight:"600"},children:t.name||t.baseName||""})})})},"name"),e.jsx("td",{style:{...he.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...ye,borderBottom:"none",padding:"0.25rem 0.25rem 0 0.25rem",outline:"none"},children:t.tier},"tier"),e.jsx("td",{style:{...he.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center",...ye,borderBottom:"none",padding:"0.25rem 0.25rem 0 0.25rem",outline:"none"},children:t.type},"type"),e.jsx("td",{style:{...he.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...ye,borderBottom:"none",outline:"none"},rowSpan:2,children:t.source==="Homebrew"||t.isCustom?(j||z||N)&&g?e.jsx("button",{onClick:fe=>{fe.stopPropagation(),g(t.id)},style:{background:N?"var(--danger)":"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"4px",padding:"0.25rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:N?"var(--text-primary)":"var(--danger)",transition:"all 0.2s ease",flexShrink:0,width:"24px",height:"24px",margin:"0 auto"},title:N?"Click again to confirm delete":"Delete custom adversary",children:e.jsx(Nt,{size:14})}):e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",margin:"0 auto"},children:e.jsx(Lt,{size:14,style:{color:"var(--text-secondary)",opacity:.7},title:"Custom adversary"})}):e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",margin:"0 auto"},children:e.jsx(Bt,{size:14,style:{color:"var(--text-secondary)",opacity:.7},title:"Stock adversary"})})},"source")],[e.jsx("td",{colSpan:3,style:{...he.rowCell,textAlign:"left",...ye,padding:"0 0.25rem 0.25rem 0.5rem",borderTop:"none",borderBottom:"none",outline:"none"},children:e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.description||t.motives||""})},"desc")]]:e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...he.rowCell,width:"auto",minWidth:"0",textAlign:"left",...ye,paddingLeft:"0.5rem"},children:e.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%",display:"flex",alignItems:"center",gap:"0.5rem"},children:e.jsx("div",{style:{flex:1,minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx("div",{style:{fontWeight:"600"},children:t.name||t.baseName||""})})})}),e.jsx("td",{style:{...he.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...ye},children:t.tier}),e.jsx("td",{style:{...he.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center",...ye},children:t.type}),e.jsx("td",{style:{...he.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center",...ye},children:t.source==="Homebrew"||t.isCustom?(j||z||N)&&g?e.jsx("button",{onClick:fe=>{fe.stopPropagation(),g(t.id)},style:{background:N?"var(--danger)":"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"4px",padding:"0.25rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:N?"var(--text-primary)":"var(--danger)",transition:"all 0.2s ease",flexShrink:0,width:"24px",height:"24px",margin:"0 auto"},title:N?"Click again to confirm delete":"Delete custom adversary",children:e.jsx(Nt,{size:14})}):e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",margin:"0 auto"},children:e.jsx(Lt,{size:14,style:{color:"var(--text-secondary)",opacity:.7},title:"Custom adversary"})}):e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",margin:"0 auto"},children:e.jsx(Bt,{size:14,style:{color:"var(--text-secondary)",opacity:.7},title:"Stock adversary"})})})]})}else if(u==="environment")return e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...he.rowCell,width:"auto",minWidth:"0",textAlign:"left"},children:t.name||t.baseName||""}),e.jsx("td",{style:{...he.rowCell,width:"80px",minWidth:"80px",maxWidth:"80px",textAlign:"center"},children:t.tier}),e.jsx("td",{style:{...he.rowCell,width:"100px",minWidth:"100px",maxWidth:"100px",textAlign:"center"},children:t.type}),e.jsx("td",{style:{...he.rowCell,width:"40px",minWidth:"40px",maxWidth:"40px",textAlign:"center"},children:t.difficulty})]});return null})();return X===null?null:Array.isArray(X)?e.jsx(e.Fragment,{children:X.map((ge,Z)=>e.jsx("tr",{ref:Z===0?O:null,style:{...he.row,...j?he.rowHover:{},...z?he.rowFocused:{},...Z===0?{borderBottom:"none"}:{},...Z===1?{borderTop:"none",height:"auto",outline:"none"}:{}},onClick:()=>{u==="adversary"?me():l&&l(t,u)},onMouseEnter:()=>G(!0),onMouseLeave:()=>G(!1),children:ge},Z))}):e.jsx(e.Fragment,{children:e.jsx("tr",{ref:O,style:{...he.row,...j?he.rowHover:{},...z?he.rowFocused:{}},onClick:()=>{u==="adversary"?me():l&&l(t,u)},onMouseEnter:()=>G(!0),onMouseLeave:()=>G(!1),children:X})})},Yt=({type:t,onAddItem:o,onCancel:u=null,onRowClick:l,encounterItems:k=[],pcCount:p=4,playerTier:b=1,partyControls:V=null,showContainer:x=!0,savedEncounters:z=[],onLoadEncounter:O,onDeleteEncounter:g,activeTab:N="adversaries",selectedCustomAdversaryId:j,onSelectCustomAdversary:G,onTabChange:me,selectedAdversary:le,onSelectAdversary:ue,filterCustom:X=!1,showCustomToggle:ge=!1,onToggleCustom:Z,onExportCustomAdversaries:ye,onImportCustomAdversaries:fe,autoFocus:Se=!1,hideImportExport:F=!1,onClose:P=null,searchPlaceholder:ve="Search"})=>{const{addCustomAdversary:Te,updateCustomAdversary:de,deleteCustomAdversary:T,customContent:S,adversaries:te,deleteAdversary:re}=Tt(),[J,Re]=c.useState(null),[pe,H]=c.useState("all"),[ke,Me]=c.useState(!1),[ze,Oe]=c.useState({}),[d,y]=c.useState({}),w=c.useRef({}),m=c.useRef({}),s=c.useRef(null),[C,L]=c.useState(-1),[K,Y]=c.useState(null),be=c.useRef({}),Be=()=>{try{const a=S.adversaries||[];if(a.length===0){alert("No custom adversaries to export.");return}const v=["name","tier","type","difficulty","threshold_major","threshold_severe","hp_max","stress_max","atk","weapon","range","damage","description","motives"],B=a.map(D=>{var q,Ee;return[D.name||"",D.tier||"",D.type||"",D.difficulty||"",((q=D.thresholds)==null?void 0:q.major)||"",((Ee=D.thresholds)==null?void 0:Ee.severe)||"",D.hpMax||"",D.stressMax||"",D.atk||"",D.weapon||"",D.range||"",D.damage||"",D.description||"",D.motives||""]}),U=D=>{const q=String(D);return q.includes(",")||q.includes('"')||q.includes(`
`)?`"${q.replace(/"/g,'""')}"`:q},E=[v.join(","),...B.map(D=>D.map(U).join(","))].join(`
`),ee=new Blob([E],{type:"text/csv;charset=utf-8;"}),ce=URL.createObjectURL(ee),M=document.createElement("a");M.href=ce,M.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(M),M.click(),document.body.removeChild(M),URL.revokeObjectURL(ce),console.log(`Exported ${a.length} custom adversaries to CSV`)}catch(a){console.error("Failed to export custom adversaries:",a),alert("Failed to export custom adversaries. Please try again.")}},He=a=>{const v=a.target.files[0];if(!v)return;const B=v.name.endsWith(".csv"),U=v.name.endsWith(".json");if(!B&&!U){alert("Please upload a CSV or JSON file."),a.target.value="";return}const E=new FileReader;E.onload=ee=>{try{let ce=[];if(B){const ie=ee.target.result.split(`
`).filter(Ne=>Ne.trim());if(ie.length<2)throw new Error("CSV file is empty or invalid.");const ae=ie[0].split(",").map(Ne=>Ne.trim().replace(/^"|"$/g,""));for(let Ne=1;Ne<ie.length;Ne++){const Q=[];let Le="",De=!1;for(let Pe=0;Pe<ie[Ne].length;Pe++){const Xe=ie[Ne][Pe],Rt=ie[Ne][Pe+1];Xe==='"'&&De&&Rt==='"'?(Le+='"',Pe++):Xe==='"'?De=!De:Xe===","&&!De?(Q.push(Le.trim()),Le=""):Le+=Xe}Q.push(Le.trim());const Fe={name:Q[ae.indexOf("name")]||"",tier:parseInt(Q[ae.indexOf("tier")])||1,type:Q[ae.indexOf("type")]||"Standard",difficulty:parseInt(Q[ae.indexOf("difficulty")])||11,thresholds:{major:parseInt(Q[ae.indexOf("threshold_major")])||7,severe:parseInt(Q[ae.indexOf("threshold_severe")])||12},hpMax:parseInt(Q[ae.indexOf("hp_max")])||3,stressMax:parseInt(Q[ae.indexOf("stress_max")])||1,atk:parseInt(Q[ae.indexOf("atk")])||1,weapon:Q[ae.indexOf("weapon")]||"",range:Q[ae.indexOf("range")]||"Melee",damage:Q[ae.indexOf("damage")]||"",description:Q[ae.indexOf("description")]||"",motives:Q[ae.indexOf("motives")]||"",source:"Homebrew"};Fe.name&&ce.push(Fe)}}else if(U){const we=JSON.parse(ee.target.result);if(!we.customAdversaries||!Array.isArray(we.customAdversaries))throw new Error("Invalid JSON format. Expected customAdversaries array.");ce=we.customAdversaries}const M=S.adversaries||[],D=[...M];let q=0,Ee=0;ce.forEach(we=>{if(M.some(ae=>ae.name===we.name&&ae.source===we.source))Ee++;else{const ae={...we,id:`custom-adv-${Date.now()}-${Math.random().toString(36).slice(2,10)}`,hp:0,stress:0};D.push(ae),q++}}),q>0?(localStorage.setItem("daggerheart-custom-adversaries",JSON.stringify(D)),window.location.reload(),alert(`Import successful! Added ${q} new adversaries${Ee>0?`, skipped ${Ee} duplicates`:""}.`)):alert("No new adversaries were added. All imported adversaries already exist.")}catch(ce){console.error("Failed to import custom adversaries:",ce),alert(`Failed to import custom adversaries: ${ce.message}`)}},E.readAsText(v),a.target.value=""},_e=()=>{Re(null)},n=async(a,v)=>{v?de(v,a):Te(a)},W=a=>{ze[a]?(g&&g(a),Oe(v=>{const B={...v};return delete B[a],B}),w.current[a]&&(clearTimeout(w.current[a]),delete w.current[a])):(Oe(v=>({...v,[a]:!0})),w.current[a]&&clearTimeout(w.current[a]),w.current[a]=setTimeout(()=>{Oe(v=>{const B={...v};return delete B[a],B}),delete w.current[a]},3e3))},r=a=>{d[a]?(te.filter(B=>B.customContentId===a).forEach(B=>{re(B.id)}),T(a),y(B=>{const U={...B};return delete U[a],U}),m.current[a]&&(clearTimeout(m.current[a]),delete m.current[a])):(y(v=>({...v,[a]:!0})),m.current[a]&&clearTimeout(m.current[a]),m.current[a]=setTimeout(()=>{y(v=>{const B={...v};return delete B[a],B}),delete m.current[a]},3e3))};c.useEffect(()=>()=>{Object.values(w.current).forEach(a=>{clearTimeout(a)}),Object.values(m.current).forEach(a=>{clearTimeout(a)})},[]);const{searchTerm:R,setSearchTerm:xe,sortFields:$,handleSort:ne,filteredAndSortedData:i,loading:A,selectedTiers:I,selectedTypes:se,showTierDropdown:oe,setShowTierDropdown:Ie,showTypeDropdown:je,setShowTypeDropdown:Ae,tierFilterRef:Ce,typeFilterRef:We,uniqueTiers:qe,uniqueTypes:Ve,handleTierSelect:Ke,handleTypeSelect:Qe,isTierFiltered:Je,isTypeFiltered:et,getDropdownStyle:Ze}=kr(t,k,p,b,X,S),Ge=c.useRef(R),Ye=c.useRef(JSON.stringify(I)),Ue=c.useRef(JSON.stringify(se));c.useEffect(()=>{const a=Ge.current!==R,v=Ye.current!==JSON.stringify(I),B=Ue.current!==JSON.stringify(se);(a||v||B)&&(L(-1),Y(null),Ge.current=R,Ye.current=JSON.stringify(I),Ue.current=JSON.stringify(se))},[R,I,se]),c.useEffect(()=>{if(N!=="adversaries")return;const a=v=>{const B=document.activeElement;if(B&&["INPUT","TEXTAREA","SELECT"].includes(B.tagName))if(v.key==="ArrowDown"||v.key==="ArrowUp"||v.key==="Enter")(v.key!=="Enter"||B.tagName!=="INPUT")&&B.blur();else return;const U=i.length-1;if(v.key==="ArrowDown")v.preventDefault(),L(E=>{var ce;const ee=E<U?E+1:E;return ee>=0&&ee<i.length&&(Y(((ce=i[ee])==null?void 0:ce.id)||null),be.current[ee]&&setTimeout(()=>{const M=be.current[ee];if(M){const D=M.closest(".browser-content");if(D){const q=D.getBoundingClientRect(),Ee=M.getBoundingClientRect(),we=M.nextElementSibling,ie=we&&we.tagName==="TR"&&we.querySelector("td[colspan]");let ae=Ee.height;ie&&(ae+=we.getBoundingClientRect().height);const Ne=Ee.bottom-q.top,Q=q.height,Le=Ne>=Q-1,De=Ee.bottom>q.bottom;if(Le||De){let Pe=M.offsetTop+ae-Q;const Xe=D.scrollHeight-Q;Pe=Math.min(Pe,Xe),Pe=Math.max(0,Pe),D.scrollTo({top:Pe,behavior:"smooth"})}}else M.scrollIntoView({behavior:"smooth",block:"end"})}},0)),ee});else if(v.key==="ArrowUp")v.preventDefault(),L(E=>{var ce;if(E<=0)return Y(null),setTimeout(()=>{const M=document.querySelector('.browser-header input[type="text"]');M==null||M.focus()},0),-1;const ee=E-1;return ee>=0&&ee<i.length?(Y(((ce=i[ee])==null?void 0:ce.id)||null),be.current[ee]&&setTimeout(()=>{const M=be.current[ee];if(M){const D=M.closest(".browser-content");if(D){const q=D.getBoundingClientRect(),Ee=M.getBoundingClientRect(),we=(()=>{const Q=M.closest("table"),Le=Q==null?void 0:Q.querySelector("thead");return Le?Le.getBoundingClientRect().height:0})(),ie=Ee.top-q.top,ae=Math.abs(ie-we)<=1;if(Ee.top<q.top||ae){const Q=M.nextElementSibling,Le=Q&&Q.tagName==="TR"&&Q.querySelector("td[colspan]");let De=Ee.height;Le&&(De+=Q.getBoundingClientRect().height);let Pe=M.offsetTop-we;const Xe=D.scrollHeight-D.clientHeight;Pe=Math.min(Pe,Xe),Pe=Math.max(0,Pe),D.scrollTo({top:Pe,behavior:"smooth"})}}else M.scrollIntoView({behavior:"smooth",block:"start"})}},0)):Y(null),ee});else if(v.key==="Enter"&&C>=0&&C<=U){v.preventDefault();const E=i[C];E&&o&&o(E)}};return document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}},[N,i,C,o]);const f=(()=>{const a=3*p+2,v=k.reduce((q,Ee)=>{if(Ee.type==="adversary"){const we=ut[Ee.item.type]||2;if(Ee.item.type==="Minion"){const ie=Math.ceil(Ee.quantity/p);return q+ie*we}else return q+Ee.quantity*we}return q},0);let B=0;k.filter(q=>q.type==="adversary"&&q.item.type==="Solo"&&q.quantity>0).reduce((q,Ee)=>q+Ee.quantity,0)>=2&&(B+=pt.twoOrMoreSolos);const E=k.some(q=>q.type==="adversary"&&q.item.type==="Bruiser"&&q.quantity>0),ee=k.some(q=>q.type==="adversary"&&q.item.type==="Horde"&&q.quantity>0),ce=k.some(q=>q.type==="adversary"&&q.item.type==="Leader"&&q.quantity>0),M=k.some(q=>q.type==="adversary"&&q.item.type==="Solo"&&q.quantity>0);return!E&&!ee&&!ce&&!M&&(B+=pt.noBruisersHordesLeadersSolos),a+B-v})(),h=a=>{H(a),Me(!1)},_=pe!=="all";return A?e.jsx("div",{style:he.browser,children:e.jsx("div",{style:he.loading,children:"Loading..."})}):e.jsx(e.Fragment,{children:e.jsxs("div",{style:x?he.browserWrapper:he.browserWrapperNoContainer,children:[N==="adversaries"&&e.jsxs(e.Fragment,{children:[e.jsx(Ir,{searchTerm:R,onSearchChange:xe,type:t,partyControls:V,autoFocus:Se,onClose:P,placeholder:ve}),!F&&e.jsx(Ar,{showCustomToggle:ge,onToggleCustom:Z,filterCustom:X,onExportCustomAdversaries:Be,onImportCustomAdversaries:He}),e.jsx("div",{className:"browser-content invisible-scrollbar",style:he.browserContent,children:e.jsxs("table",{style:he.browserTable,children:[e.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,backgroundColor:"var(--bg-primary)"},children:e.jsx(Er,{sortFields:$,onSort:ne,type:t,uniqueTiers:qe,uniqueTypes:Ve,selectedTiers:I,selectedTypes:se,showTierDropdown:oe,setShowTierDropdown:Ie,showTypeDropdown:je,setShowTypeDropdown:Ae,tierFilterRef:Ce,typeFilterRef:We,handleTierSelect:Ke,handleTypeSelect:Qe,isTierFiltered:Je,isTypeFiltered:et,getDropdownStyle:Ze,costFilter:pe,showCostDropdown:ke,setShowCostDropdown:Me,costFilterRef:s,handleCostFilterSelect:h,isCostFiltered:_})}),e.jsx("tbody",{children:i.map((a,v)=>e.jsx(Tr,{item:a,onAdd:o,type:t,onRowClick:l,encounterItems:k,pcCount:p,playerTier:b,remainingBudget:f,costFilter:pe,isFocused:K===a.id||C===v,onDeleteCustomAdversary:t==="adversary"?r:null,isDeleteConfirmed:d[a.id]||!1,rowRef:B=>{B?be.current[v]=B:delete be.current[v]}},a.id))})]})})]}),N==="encounters"&&e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:z.length===0?e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",textAlign:"center",padding:"2rem 1rem"},children:"No saved encounters yet"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:z.map(a=>e.jsxs("div",{onClick:()=>O&&O(a.id),className:"saved-encounter-card",style:{border:"1px solid var(--border)",borderRadius:"8px",padding:"8px",backgroundColor:"var(--bg-card)",transition:"background-color 0.2s ease",display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsxs("div",{style:{minWidth:"100px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",flexDirection:"column",justifyContent:"center",minHeight:"60px"},children:[e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Tier: ",(()=>{var U,E,ee,ce;const v=((ce=(ee=(E=(U=a.encounterItems)==null?void 0:U.filter(M=>M.type==="adversary"))==null?void 0:E.map(M=>M.item.tier))==null?void 0:ee.filter(M=>M!=null))==null?void 0:ce.sort((M,D)=>M-D))||[];if(v.length===0)return"N/A";if(v.length===1)return v[0];const B=[...new Set(v)];return B.length===1?B[0]:`${Math.min(...B)}-${Math.max(...B)}`})()]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.25rem"},children:["Party Size: ",a.partySize||4]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)"},children:["Balance: ",(()=>{const v=a.partySize||4,B=3*v+2;let U=0;const E=a.encounterItems||[];E.filter(ie=>ie.type==="adversary"&&ie.item.type==="Solo"&&ie.quantity>0).reduce((ie,ae)=>ie+ae.quantity,0)>=2&&(U+=pt.twoOrMoreSolos);const ce=E.some(ie=>ie.type==="adversary"&&ie.item.type==="Bruiser"&&ie.quantity>0),M=E.some(ie=>ie.type==="adversary"&&ie.item.type==="Horde"&&ie.quantity>0),D=E.some(ie=>ie.type==="adversary"&&ie.item.type==="Leader"&&ie.quantity>0),q=E.some(ie=>ie.type==="adversary"&&ie.item.type==="Solo"&&ie.quantity>0);!ce&&!M&&!D&&!q&&(U+=pt.noBruisersHordesLeadersSolos);const Ee=B+U,we=E.reduce((ie,ae)=>{if(ae.type==="adversary"){const Ne=ut[ae.item.type]||2;if(ae.item.type==="Minion"){const Q=Math.ceil(ae.quantity/v);return ie+Q*Ne}else return ie+ae.quantity*Ne}return ie},0);return we>Ee?`+${we-Ee}`:we===Ee?"0":`-${Ee-we}`})()]})]}),e.jsx("div",{style:{minWidth:"120px",borderRight:"1px solid var(--text-secondary)",paddingRight:"1rem",display:"flex",alignItems:"center",minHeight:"60px"},children:e.jsx("div",{style:{fontWeight:"500",color:"var(--text-primary)",fontSize:"0.9rem",wordWrap:"break-word",wordBreak:"break-word",width:"150px",maxWidth:"150px"},children:a.name})}),e.jsx(Cr,{encounter:a}),e.jsx("button",{onClick:v=>{v.stopPropagation(),W(a.id)},style:{background:ze[a.id]?"var(--danger)":"var(--gray-600)",border:"none",color:"white",padding:"0.4rem 0.8rem",borderRadius:"4px",fontSize:"0.75rem",cursor:"pointer",minWidth:"60px",transition:"background-color 0.2s"},children:"Delete"})]},a.id))})}),N==="create"&&e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"1rem",display:"flex",justifyContent:"center",alignItems:"flex-start",height:"100%",minHeight:0},children:e.jsx("div",{style:{maxWidth:"600px",width:"100%",height:"auto",display:"flex",flexDirection:"column",padding:"0",overflowY:"visible",overflowX:"hidden",minHeight:0},children:e.jsx(Mt,{onSave:n,onRefresh:()=>{},onAddItem:o,editingAdversary:J,onCancelEdit:_e,embedded:!1})})}),N==="info"&&e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"2rem"},children:[e.jsxs("div",{style:{marginBottom:"2rem",textAlign:"center"},children:[e.jsx("img",{src:wr,alt:"Daggerheart Community Content Logo",style:{width:"100%",maxWidth:"300px",height:"auto",margin:"0 auto 1.5rem auto",display:"block"},onError:a=>{console.error("Failed to load Daggerheart logo:",a.target.src),a.target.style.display="none"}}),e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",textAlign:"left",maxWidth:"600px",margin:"0 auto"},children:[e.jsx("p",{style:{marginTop:0},children:"This product includes materials from the Daggerheart System Reference Document 1.0, © Critical Role, LLC, under the terms of the Darrington Press Community Gaming (DPCGL) License."}),e.jsxs("p",{children:["More information can be found at ",e.jsx("a",{href:"https://www.daggerheart.com",target:"_blank",rel:"noopener noreferrer",style:{color:"var(--purple)",textDecoration:"underline"},children:"daggerheart.com"})]}),e.jsx("p",{style:{marginBottom:0},children:e.jsx("em",{children:"This project is unofficial and not endorsed by Darrington Press or Critical Role."})})]})]}),e.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto",border:"1px solid var(--border)",borderRadius:"8px",overflow:"hidden"},children:[e.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"1rem 1.5rem",color:"var(--text-primary)",border:"none",background:"var(--bg-secondary)",width:"100%",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"0.875rem",borderBottom:"1px solid var(--border)"},onMouseEnter:a=>{a.target.style.backgroundColor="var(--bg-hover)"},onMouseLeave:a=>{a.target.style.backgroundColor="var(--bg-secondary)"},onClick:a=>{a.stopPropagation(),window.open("https://github.com/Splinter714/Daggerheart","_blank")},children:[e.jsx("span",{children:"View on GitHub"}),e.jsx("span",{children:"→"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem 1.5rem",color:"var(--text-secondary)",background:"var(--bg-secondary)",fontSize:"0.875rem"},children:["Version ","0.4.12 (ddbdd7c)"]})]})]})]})})},he={browserWrapper:{display:"flex",flexDirection:"column",background:"var(--bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border)",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserWrapperNoContainer:{display:"flex",flexDirection:"column",overflow:"hidden",height:"100%",width:"100%",position:"relative"},browserContent:{flex:1,overflowY:"auto",overflowX:"visible",padding:0,width:"100%",scrollbarWidth:"none",msOverflowStyle:"none",borderRadius:"0 0 8px 8px"},tableHeaderContainer:{flexShrink:0,position:"sticky",top:0,zIndex:15,backgroundColor:"var(--bg-secondary)"},browserTable:{width:"100%",minWidth:"100%",borderCollapse:"collapse",tableLayout:"fixed",background:"var(--bg-primary)",margin:0},browserHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--gray-900)",flexShrink:0,position:"sticky",top:0,zIndex:20},browserTitle:{margin:0,color:"var(--text-primary)",fontSize:"18px",fontWeight:"600"},closeButton:{background:"none",border:"none",color:"var(--text-primary)",fontSize:"24px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",marginRight:"12px",transition:"all 0.2s ease"},partyControls:{display:"flex",alignItems:"center",gap:"12px",flexShrink:0},searchInputFocus:{outline:"none",borderColor:"var(--purple)",boxShadow:"0 0 0 3px rgba(139, 92, 246, 0.1)"},tableHeader:{background:"var(--gray-900)",borderBottom:"1px solid var(--border)",boxShadow:"0 1px 0 var(--border)",position:"sticky",top:"0",zIndex:10},tableHeaderCell:{backgroundColor:"var(--gray-900)",fontWeight:"700",borderBottom:"1px solid var(--border)",cursor:"pointer",userSelect:"none",minWidth:"100px",whiteSpace:"nowrap",padding:"4px 4px",color:"var(--text-primary)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",boxShadow:"0 1px 0 var(--border)",transition:"background-color 0.2s",position:"sticky",top:"0",zIndex:10},tableHeaderCellHover:{backgroundColor:"var(--bg-hover)"},sortIndicator:{fontSize:"12px",color:"var(--text-secondary)"},tableBody:{flex:1,overflowY:"auto",padding:"8px",backgroundColor:"var(--bg-primary)"},row:{height:"auto",minHeight:"35px",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s ease",cursor:"pointer",backgroundColor:"var(--gray-900)"},rowHover:{backgroundColor:"var(--bg-secondary)"},rowFocused:{backgroundColor:"var(--bg-secondary)",boxShadow:"inset 0 0 0 2px var(--purple)"},expandedRow:{backgroundColor:"var(--bg-secondary)"},rowCell:{padding:"4px 4px",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid var(--border)"},rowCellName:{fontWeight:"500",minWidth:"150px"},rowCellCenter:{textAlign:"center",justifyContent:"center",minWidth:"80px"},rowActions:{width:"80px",textAlign:"center",padding:"4px 8px",borderBottom:"1px solid var(--border)"},addButton:{width:"2rem",height:"2rem",border:"1px solid var(--purple)",borderRadius:"var(--radius-sm)",background:"var(--purple)",color:"white",cursor:"pointer",transition:"all 0.2s ease",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"500"},expandedContent:{padding:"0",backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border)"},columnName:{width:"auto",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",paddingLeft:"8px",textAlign:"left"},columnTier:{width:"80px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnType:{width:"100px",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},columnDifficulty:{width:"40px",textAlign:"center",overflow:"visible",textOverflow:"unset"},columnAction:{width:"32px",minWidth:"24px",maxWidth:"24px",textAlign:"center",padding:"0",margin:"0",border:"none",verticalAlign:"middle",color:"var(--text-primary)",whiteSpace:"nowrap",overflow:"visible",textOverflow:"unset"},loading:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"var(--text-primary)",fontSize:"16px"},mobileBrowser:{width:"95vw",height:"90vh",maxWidth:"none"},mobileSearchInput:{fontSize:"16px"},headerWithFilter:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0px",position:"relative"},headerFilterIcon:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"2px 4px",borderRadius:"var(--radius-sm)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",position:"relative",marginLeft:"-2px"},headerFilterIconActive:{color:"var(--purple)"},filterIcon:{fontSize:"12px"},filterActiveDot:{position:"absolute",left:"50%",top:"2px",transform:"translateX(-50%)",width:"4px",height:"4px",borderRadius:"50%",background:"var(--purple)",pointerEvents:"none"},filterDropdown:{position:"fixed",background:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"var(--radius-md)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",zIndex:99999,marginTop:"4px",overflow:"hidden",width:"max-content",minWidth:"120px",maxWidth:"200px"},filterOption:{padding:"8px 12px",cursor:"pointer",color:"var(--text-primary)",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid rgba(255,255,255,0.06)",transition:"background-color 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},filterOptionSelected:{backgroundColor:"var(--bg-hover)"},checkIcon:{width:"16px",height:"16px",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",fontSize:"12px"},filterLabel:{flex:1}},Mr=()=>e.jsx("div",{className:"pwa-install-prompt",style:{}}),Ct=({side:t="left",children:o,className:u="",style:l={}})=>{const k=t==="left",p={flex:1,minWidth:0,background:"var(--bg-primary)",overflowY:"auto",overflowX:k?"auto":"hidden",display:k?"block":"flex",flexDirection:k?"initial":"column",height:"100%",padding:k?"8px 0 8px 0":"0 8px 0 0",...l};return e.jsx("div",{className:u,style:p,children:o})},Rr=t=>3*t+2,Wr={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},jt={lessDifficult:-1,twoOrMoreSolos:-2,increasedDamage:-2,lowerTierAdversary:1,noBruisersHordesLeadersSolos:1,moreDangerous:2},zr=({isOpen:t,onClose:o,onAddAdversary:u,onAddAdversariesBulk:l,onAddEnvironment:k,onDeleteAdversary:p,onDeleteEnvironment:b,onDeleteCountdown:V,adversaries:x=[],environments:z=[],countdowns:O=[],savedEncounters:g=[],onSaveEncounter:N,onLoadEncounter:j,onDeleteEncounter:G})=>{const{partySize:me,updatePartySize:le,currentEncounterName:ue,updateCurrentEncounterName:X,customContent:ge}=Tt(),Z=me,ye=le,[fe,Se]=c.useState({lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),[F,P]=c.useState([]),[ve,Te]=c.useState(ue||"Encounter"),[de,T]=c.useState("adversaries"),[S,te]=c.useState(null),[re,J]=c.useState(null),[Re,pe]=c.useState(null),[H,ke]=c.useState(null),[Me,ze]=c.useState(!1);c.useEffect(()=>{t&&!S&&Te(ue||"Encounter")},[t,S,ue]);const Oe=()=>re?ve!==re.name||JSON.stringify(F)!==JSON.stringify(re.encounterItems)||Z!==re.partySize||JSON.stringify(fe)!==JSON.stringify(re.battlePointsAdjustments):!1,d=()=>{var i;if(F.length>0||(ve||"").trim()!=="Encounter")return!0;if(S&&Oe()){if(re){const A=F.length,I=((i=re.encounterItems)==null?void 0:i.length)||0;if(A!==I||(ve||"").trim()!==(re.name||""))return!0;const se=JSON.stringify(fe),oe=JSON.stringify(re.battlePointsAdjustments||{});return se!==oe}return!0}return!1},y=({onClick:i,children:A,variant:I="secondary",isConfirmation:se=!1})=>{const oe=I==="danger"||I==="secondary"&&se,Ie=I==="purple";return e.jsx("button",{onClick:i,style:{background:oe?"var(--danger)":Ie?"var(--purple)":"var(--bg-secondary)",border:Ie?"none":"1px solid var(--border)",color:oe||Ie?"white":"var(--text-primary)",padding:"0.375rem 0.75rem",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s",width:"70px",fontSize:"0.875rem"},children:A})},w=nt.useRef(Z),m=c.useCallback(i=>!i||i.length===0?null:g.find(I=>{var je,Ae;if(((je=I.encounterItems)==null?void 0:je.length)!==i.length)return!1;const se=Ce=>{var We;return{type:Ce.type,quantity:Ce.quantity,item:{name:Ce.item.baseName||((We=Ce.item.name)==null?void 0:We.replace(/\s+\(\d+\)$/,""))||Ce.item.name,type:Ce.item.type,tier:Ce.item.tier}}},oe=(Ae=I.encounterItems)==null?void 0:Ae.map(se).sort((Ce,We)=>Ce.item.name.localeCompare(We.item.name)||Ce.item.type.localeCompare(We.item.type)),Ie=i.map(se).sort((Ce,We)=>Ce.item.name.localeCompare(We.item.name)||Ce.item.type.localeCompare(We.item.type));return JSON.stringify(oe)===JSON.stringify(Ie)})||null,[g]);nt.useEffect(()=>{if(t&&x.length>0&&F.length===0){const i={};x.forEach(se=>{var Ie;const oe=se.baseName||((Ie=se.name)==null?void 0:Ie.replace(/\s+\(\d+\)$/,""))||se.name;i[oe]||(i[oe]={type:"adversary",item:se,quantity:0}),i[oe].quantity+=1});const A=Object.values(i);P(A);const I=m(A);I&&!S&&(te(I.id),J({name:I.name||"",encounterItems:I.encounterItems||[],partySize:I.partySize||4,battlePointsAdjustments:I.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),Te(I.name||"Encounter"),X(I.name||"Encounter"))}else t&&x.length===0&&F.length===0&&P([])},[t,m,S,X]);const s=nt.useMemo(()=>{let i=0;F.filter(je=>je.type==="adversary"&&je.item.type==="Solo"&&je.quantity>0).reduce((je,Ae)=>je+Ae.quantity,0)>=2&&(i+=jt.twoOrMoreSolos);const I=F.some(je=>je.type==="adversary"&&je.item.type==="Bruiser"&&je.quantity>0),se=F.some(je=>je.type==="adversary"&&je.item.type==="Horde"&&je.quantity>0),oe=F.some(je=>je.type==="adversary"&&je.item.type==="Leader"&&je.quantity>0),Ie=F.some(je=>je.type==="adversary"&&je.item.type==="Solo"&&je.quantity>0);return!I&&!se&&!oe&&!Ie&&(i+=jt.noBruisersHordesLeadersSolos),i},[F]),C=Rr(Z),L=Object.entries(fe).filter(([i,A])=>A).reduce((i,[A,I])=>i+jt[A],0),K=C+L+s,Y=F.reduce((i,A)=>{if(A.type==="adversary"){const I=Wr[A.item.type]||2;return A.item.type==="Minion"?i+Math.ceil(A.quantity/Z)*I:i+I*A.quantity}return i},0);nt.useEffect(()=>{const i=w.current;i!==Z&&(P(A=>A.map(I=>{if(I.type==="adversary"&&I.item.type==="Minion"){const oe=Math.ceil(I.quantity/i)*Z;return{...I,quantity:oe}}return I})),w.current=Z)},[Z]);const be=(i,A)=>{const I=F.findIndex(Ie=>Ie.item.id===i.id&&Ie.type===A),se=i.type==="Minion"?Z:1;let oe;I>=0?oe=F.map((Ie,je)=>je===I?{...Ie,quantity:Ie.quantity+se}:Ie):oe=[...F,{item:i,type:A,quantity:se}],P(oe),Be(oe)},Be=i=>{const A=x||[],I=[];i.forEach(Ae=>{for(let Ce=0;Ce<Ae.quantity;Ce++)Ae.type==="adversary"&&I.push(Ae.item)});const se={};A.forEach(Ae=>{var We;const Ce=Ae.baseName||((We=Ae.name)==null?void 0:We.replace(/\s+\(\d+\)$/,""))||Ae.name;se[Ce]||(se[Ce]=[]),se[Ce].push(Ae)});const oe={};I.forEach(Ae=>{var We;const Ce=Ae.baseName||((We=Ae.name)==null?void 0:We.replace(/\s+\(\d+\)$/,""))||Ae.name;oe[Ce]||(oe[Ce]=[]),oe[Ce].push(Ae)});const Ie=[],je=[];Object.keys(oe).forEach(Ae=>{var qe;const Ce=((qe=se[Ae])==null?void 0:qe.length)||0,We=oe[Ae].length;if(We>Ce){const Ve=We-Ce;for(let Ke=0;Ke<Ve;Ke++)Ie.push(oe[Ae][0])}else if(We<Ce){const Ve=Ce-We,Qe=[...se[Ae]].sort((Je,et)=>{const Ze=Je.duplicateNumber||1;return(et.duplicateNumber||1)-Ze});for(let Je=0;Je<Ve;Je++)je.push(Qe[Je].id)}}),Object.keys(se).forEach(Ae=>{oe[Ae]||[...se[Ae]].sort((qe,Ve)=>{const Ke=qe.duplicateNumber||1;return(Ve.duplicateNumber||1)-Ke}).forEach(qe=>{je.push(qe.id)})}),je.forEach(Ae=>{p(Ae)}),Ie.length>0&&l(Ie)},He=(i,A)=>{const I=(()=>{const se=F.findIndex(oe=>oe.item.id===i&&oe.type===A);if(se>=0){const oe=F[se];if(oe.quantity===0)return F.filter((Ae,Ce)=>Ce!==se);const Ie=oe.item.type==="Minion"?Z:1,je=Math.max(0,oe.quantity-Ie);return F.map((Ae,Ce)=>Ce===se?{...Ae,quantity:je}:Ae)}return F})();P(I),Be(I)},_e=c.useCallback(()=>{if(F.length===0)return null;const i=(ve||"").trim()||"Encounter",A=g.find(I=>{var Ie,je;if(I.name!==i||((Ie=I.encounterItems)==null?void 0:Ie.length)!==F.length)return!1;const se=JSON.stringify((je=I.encounterItems)==null?void 0:je.sort()),oe=JSON.stringify([...F].sort());return se===oe});return(A==null?void 0:A.id)||null},[g,ve,F]),n=c.useCallback(()=>{let i=(ve||"").trim(),A=S;if(A||(A=_e()),F.length===0&&(!i||i==="Encounter")&&A){G(A),te(null),J(null);return}const I={name:i,encounterItems:F,partySize:Z,battlePointsAdjustments:fe};if(A){I.id=A;const se=N(I);te(se)}else{const se=N(I);te(se)}J({name:i,encounterItems:F,partySize:Z,battlePointsAdjustments:fe})},[F,ve,Z,fe,S,N,_e,G]);c.useEffect(()=>{if(S&&Oe()){const i=setTimeout(()=>{n()},2e3);return()=>clearTimeout(i)}else if(!S&&F.length>0&&ve&&ve.trim()!==""){const i=setTimeout(()=>{n()},2e3);return()=>clearTimeout(i)}},[F,S,ve,fe,Z]);const W=()=>{d()&&(P([]),Te("Encounter"),X("Encounter"),te(null),J(null),x.forEach(i=>{p(i.id)}),z.forEach(i=>{b(i.id)}),O.forEach(i=>{V(i.id)}))},r=i=>{const A=j(i);if(A){const I=A.encounterItems||[];P(I),ye(A.partySize||4),Se(A.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}),Te(A.name||""),X(A.name||""),te(i),J({name:A.name||"",encounterItems:A.encounterItems||[],partySize:A.partySize||4,battlePointsAdjustments:A.battlePointsAdjustments||{lessDifficult:!1,increasedDamage:!1,moreDangerous:!1}}),Be(I)}},R=i=>{G(i),S===i&&(P([]),Te("Encounter"),X("Encounter"),te(null),J(null),x.forEach(A=>{p(A.id)}),z.forEach(A=>{b(A.id)}),O.forEach(A=>{V(A.id)}))},xe=()=>{try{const i={version:"1.0",exportDate:new Date().toISOString(),customAdversaries:ge.adversaries||[]},A=JSON.stringify(i,null,2),I=new Blob([A],{type:"application/json"}),se=URL.createObjectURL(I),oe=document.createElement("a");oe.href=se,oe.download=`daggerheart-custom-adversaries-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(oe),oe.click(),document.body.removeChild(oe),URL.revokeObjectURL(se),console.log("Custom adversaries exported successfully")}catch(i){console.error("Failed to export custom adversaries:",i),alert("Failed to export custom adversaries. Please try again.")}},$=i=>{const A=i.target.files[0];if(!A)return;const I=new FileReader;I.onload=se=>{try{const oe=JSON.parse(se.target.result);if(!oe.customAdversaries||!Array.isArray(oe.customAdversaries))throw new Error("Invalid file format. Expected customAdversaries array.");const Ie=ge.adversaries||[],je=oe.customAdversaries,Ae=[...Ie];let Ce=0;je.forEach(We=>{Ie.some(Ve=>Ve.name===We.name&&Ve.type===We.type)||(Ae.push({...We,id:`custom-${Date.now()}-${Math.random().toString(36).slice(2,10)}`}),Ce++)}),updateCustomContent("adversary",null,Ae),Ce>0?alert(`Successfully imported ${Ce} custom adversaries.`):alert("No new adversaries were added. All imported adversaries already exist.")}catch(oe){console.error("Failed to import custom adversaries:",oe),alert("Failed to import custom adversaries. Please check the file format and try again.")}},I.readAsText(A),i.target.value=""};if(!t)return null;const ne=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://");return e.jsx("div",{onClick:o,className:"encounter-builder-modal",style:{position:"fixed",top:0,left:0,right:0,bottom:ne?"calc(60px + env(safe-area-inset-bottom) + 1rem)":"calc(60px + env(safe-area-inset-bottom))",backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",zIndex:1e3,display:"flex",alignItems:"flex-start",justifyContent:"center",padding:"12px"},children:e.jsxs("div",{onClick:i=>i.stopPropagation(),style:{backgroundColor:"var(--bg-primary)",border:"2px solid var(--border)",borderRadius:"12px",width:"100%",maxWidth:"1200px",height:"100%",maxHeight:"100%",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"},children:[e.jsxs("div",{className:"encounter-top-bar",style:{flex:"0 0 auto",display:"flex",alignItems:"center",height:"39px",backgroundColor:"var(--bg-primary)",borderBottom:"1px solid var(--border)"},children:[e.jsx("button",{onClick:()=>T("adversaries"),style:{flex:1,background:de==="adversaries"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:de==="adversaries"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Builder"}),e.jsx("button",{onClick:()=>T("encounters"),style:{flex:1,background:de==="encounters"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:de==="encounters"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Saved Encounters"}),e.jsx("button",{onClick:()=>T("create"),style:{flex:1,background:de==="create"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:de==="create"?"500":"400",transition:"all 0.2s ease",position:"relative",borderRight:"1px solid var(--border)"},children:"Create Adversary"}),e.jsx("button",{onClick:()=>T("info"),style:{flex:1,background:de==="info"?"var(--gray-900)":"transparent",border:"none",color:"var(--text-primary)",padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:de==="info"?"500":"400",transition:"all 0.2s ease",position:"relative"},children:"Info"})]}),e.jsxs("div",{className:"encounter-builder-content",style:{flex:1,display:"flex",overflow:"hidden"},children:[e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",borderTop:"1px solid var(--border)"},children:e.jsx(Yt,{type:"adversary",onAddItem:i=>be(i,"adversary"),encounterItems:F,pcCount:Z,showContainer:!1,savedEncounters:g,onLoadEncounter:r,onDeleteEncounter:R,activeTab:de,selectedCustomAdversaryId:Re,onSelectCustomAdversary:pe,onTabChange:T,selectedAdversary:H,onSelectAdversary:ke,filterCustom:Me,showCustomToggle:!0,onToggleCustom:ze,onExportCustomAdversaries:xe,onImportCustomAdversaries:$})}),de!=="info"&&e.jsxs("div",{className:"encounter-right-panel",style:{flex:1,borderLeft:"1px solid var(--border)",display:"flex",flexDirection:"column",overflow:"hidden",position:"relative"},children:[H&&e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"var(--bg-primary)",zIndex:10,display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)",flexShrink:0},children:[e.jsx("h3",{style:{fontSize:"1rem",fontWeight:600,color:"var(--text-primary)",margin:0},children:"Adversary Preview"}),e.jsx("button",{onClick:()=>ke(null),style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease"},onMouseEnter:i=>i.target.style.color="var(--text-primary)",onMouseLeave:i=>i.target.style.color="var(--text-secondary)",title:"Close preview",children:e.jsx(at,{size:16})})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"0.75rem"},children:e.jsx(ft,{item:{...H,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...H,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}})})]}),(de==="adversaries"||de==="encounters")&&e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--bg-primary)",flexShrink:0},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:ve,onChange:i=>{Te(i.target.value),X(i.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(y,{onClick:W,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:d()?1:.5,cursor:d()?"pointer":"not-allowed"},children:"New"})]})}),(de==="adversaries"||de==="encounters")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"encounter-receipt-buttons-vertical",style:{display:"none",padding:"0.75rem",borderBottom:"1px solid var(--border)",backgroundColor:"var(--bg-primary)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[e.jsx("input",{type:"text",value:ve,onChange:i=>{Te(i.target.value),X(i.target.value)},placeholder:"Encounter Name",style:{flex:1,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:"4px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"16px",textAlign:"left",outline:"none",transition:"all 0.2s ease"}}),e.jsx(y,{onClick:W,variant:"secondary",style:{whiteSpace:"nowrap",minWidth:"fit-content",flexShrink:0,opacity:d()?1:.5,cursor:d()?"pointer":"not-allowed"},children:"New"})]})}),e.jsx("div",{className:"receipt-content",style:{padding:"1rem",display:"flex",flexDirection:"column",height:"100%"},children:e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"flex-start",overflowY:"auto",marginBottom:"0.75rem"},children:[e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>ye(Math.max(1,Z-1)),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(mt,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:Z}),e.jsx("button",{onClick:()=>ye(Z+1),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(it,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Party Size"})}),e.jsx("div",{style:{width:"120px",textAlign:"right"}})]}),F.map(i=>{var A;return i.type!=="adversary"?null:e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{className:"receipt-controls",style:{width:"60px",textAlign:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>He(i.item.id,i.type),style:{background:i.quantity===0?"var(--danger)":"var(--bg-secondary)",border:i.quantity===0?"none":"1px solid var(--border)",color:i.quantity===0?"white":"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",left:"0",top:"50%",transform:"translateY(-50%)"},children:i.quantity===0?e.jsx(at,{size:10}):e.jsx(mt,{size:10})}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:i.quantity}),e.jsx("button",{onClick:()=>be(i.item,i.type),style:{background:"var(--bg-secondary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:"3px",padding:"0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem",position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"},children:e.jsx(it,{size:10})})]}),e.jsx("div",{style:{flex:1,marginLeft:"1rem"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:i.item.baseName||((A=i.item.name)==null?void 0:A.replace(/\s+\(\d+\)$/,""))||i.item.name})}),e.jsx("div",{style:{width:"80px",textAlign:"right"},children:e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.8rem"},children:i.item.type})})]},`${i.item.id}-${i.type}`)}),e.jsxs("div",{className:"receipt-item",style:{display:"flex",alignItems:"center",padding:"0.25rem 0",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center"},children:e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.9rem"},children:"Balance"})}),e.jsx("div",{style:{width:"120px",textAlign:"right",display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsx("span",{style:{color:Y>K?"var(--danger)":Y===K?"var(--purple)":"var(--success)",fontWeight:600},children:Y>K?`+${Y-K}`:K-Y===0?"0":`-${K-Y}`})})]})]})})]}),de==="create"&&e.jsxs("div",{style:{padding:"1.5rem",overflowY:"auto",height:"100%"},children:[e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Creating Adversaries"}),e.jsxs("div",{style:{fontSize:"0.875rem",lineHeight:1.6,color:"var(--text-secondary)",display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsx("p",{children:"Use the form to create custom adversaries for your encounters."}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Adversary Types:"}),e.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Minion (1 BP):"})," Weak enemies in groups"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Standard (2 BP):"})," Average threat level"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Leader (3 BP):"})," Commands others"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Bruiser (4 BP):"})," High HP tank"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Solo (5 BP):"})," Boss-level threat"]})]})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Tips:"}),e.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[e.jsx("li",{children:"Match adversary tier to party level"}),e.jsx("li",{children:"Balance encounter difficulty with Battle Points"}),e.jsx("li",{children:"Mix adversary types for variety"}),e.jsx("li",{children:"Add features that create interesting choices"})]})]})]})]}),de==="myAdversaries"&&e.jsx("div",{style:{padding:"0.75rem",overflowY:"auto",height:"100%"},children:Re?(()=>{var A;const i=(A=ge==null?void 0:ge.adversaries)==null?void 0:A.find(I=>I.id===Re);return i?e.jsx(ft,{item:{...i,hp:0,stress:0,isVisible:!0},type:"adversary",mode:"expanded",instances:[{...i,hp:0,stress:0,isVisible:!0}],onUpdate:()=>{},onDelete:()=>{}}):e.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Adversary not found"})})():e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"var(--text-primary)",marginTop:0,marginBottom:"1rem"},children:"Adversary Preview"}),e.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",textAlign:"center",padding:"2rem 0"},children:"Select an adversary to view details"})]})})]})]})]})})},Nr=({browserOpenAtPosition:t,handleCloseBrowser:o,handleOpenBrowser:u,getEntityGroups:l,fear:k,updateFear:p})=>{const b=c.useRef(!1),V=c.useRef(null),x=c.useRef(null),z=c.useMemo(()=>({"shift+space":()=>{if(t!==null)o();else{const g=l();u(g.length)}},escape:()=>{t!==null&&o()},"+":()=>{const g=(k==null?void 0:k.value)||0,N=Math.min(12,g+1);p(N)},"=":()=>{const g=(k==null?void 0:k.value)||0,N=Math.min(12,g+1);p(N)},"-":()=>{const g=(k==null?void 0:k.value)||0,N=Math.max(0,g-1);p(N)},_:()=>{const g=(k==null?void 0:k.value)||0,N=Math.max(0,g-1);p(N)}}),[t,o,u,l,k,p]),O=c.useCallback(g=>{var Z;if(window.matchMedia("(max-width: 800px)").matches)return;const j=g.key===" "||g.key==="Space"||g.code==="Space";if(g.shiftKey&&j&&!g.ctrlKey&&!g.metaKey&&!g.altKey){if(console.log("[Keyboard] Shift+Space detected, toggling browser"),g.preventDefault(),g.stopPropagation(),g.stopImmediatePropagation(),t!==null)o();else{const ye=l();u(ye.length)}return}const me=document.activeElement;if(me&&["INPUT","TEXTAREA","SELECT"].includes(me.tagName)){const ye=g.key==="Escape",fe=g.shiftKey&&j&&!g.ctrlKey&&!g.metaKey&&!g.altKey;if(!ye&&!fe)return}const ue=[];(g.ctrlKey||g.metaKey)&&ue.push("ctrl"),g.shiftKey&&ue.push("shift"),g.altKey&&ue.push("alt");let X=g.key.toLowerCase();X===" "&&(X="space"),ue.push(X);const ge=ue.join("+");if(z[ge]){g.preventDefault(),z[ge](g);return}if(!g.ctrlKey&&!g.metaKey&&!g.shiftKey&&!g.altKey&&z[X]){g.preventDefault(),z[X](g);return}if(!g.ctrlKey&&!g.metaKey&&!g.shiftKey&&!g.altKey&&(g.key==="ArrowLeft"||g.key==="ArrowRight")){const ye=document.activeElement;if(ye&&["INPUT","TEXTAREA","SELECT"].includes(ye.tagName))return;const fe=document.querySelector(".dashboard-scroll-container");if(fe){g.preventDefault(),console.log("[Keyboard] Dashboard scroll requested:",{key:g.key,currentScrollLeft:fe.scrollLeft,containerWidth:fe.clientWidth,scrollWidth:fe.scrollWidth,scrollInProgress:b.current,browserOpen:t!==null});const Se=Array.from(fe.children).filter(F=>getComputedStyle(F).scrollSnapAlign!=="none");if(console.log("[Keyboard] Found panels:",{totalPanels:Se.length,panelDetails:Se.map((F,P)=>({index:P,offsetLeft:F.offsetLeft,offsetWidth:F.offsetWidth,scrollSnapAlign:getComputedStyle(F).scrollSnapAlign}))}),Se.length>0){const F=fe.scrollLeft;let P=0,ve=1/0;Se.forEach((T,S)=>{const te=T.offsetLeft,re=Math.abs(te-F);re<ve&&(ve=re,P=S)}),console.log("[Keyboard] Panel detection:",{currentScroll:F,currentPanelIndex:P,currentPanelOffsetLeft:(Z=Se[P])==null?void 0:Z.offsetLeft,minDistance:ve,allPanels:Se.map((T,S)=>({index:S,offsetLeft:T.offsetLeft,distance:Math.abs(T.offsetLeft-F)}))});const Te=g.key==="ArrowLeft"?-1:1,de=P+Te;if(console.log("[Keyboard] Scrolling decision:",{scrollDirection:Te,currentPanelIndex:P,nextPanelIndex:de,canScroll:de>=0&&de<Se.length}),de>=0&&de<Se.length){const T=Se[de],S=T.offsetLeft;console.log("[Keyboard] Scrolling to panel:",{index:de,offsetLeft:T.offsetLeft,offsetWidth:T.offsetWidth,targetScrollPosition:S,currentScroll:F,scrollInProgress:b.current}),V.current&&(clearTimeout(V.current),V.current=null),x.current=de,b.current?(console.log("[Keyboard] Redirecting scroll to new target",{previousTarget:x.current,newTarget:de,targetScrollPosition:S}),fe.scrollTo({left:S,behavior:"smooth"})):(b.current=!0,T.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"})),V.current=setTimeout(()=>{if(x.current===de){const te=fe.scrollLeft,re=T.offsetLeft,J=Math.abs(te-re);J>.5&&(console.log("[Keyboard] Correcting misalignment:",{finalScroll:te,expectedScroll:re,misalignment:J}),fe.scrollTo({left:re,behavior:"auto"})),b.current=!1,x.current=null,console.log("[Keyboard] Scroll after action:",{newScrollLeft:fe.scrollLeft,targetScrollPosition:S,difference:fe.scrollLeft-F,actualDifference:fe.scrollLeft-S,misalignment:J})}V.current=null},600)}else console.log("[Keyboard] Cannot scroll - panel index out of bounds")}else{console.log("[Keyboard] No panels found, using fallback scroll");const F=fe.firstElementChild;if(F){const P=F.offsetWidth,ve=g.key==="ArrowLeft"?-1:1;fe.scrollBy({left:P*ve,behavior:"smooth"})}}}else console.log("[Keyboard] Scroll container not found")}},[z,t,o,u,l]);c.useEffect(()=>(document.addEventListener("keydown",O,!0),()=>{document.removeEventListener("keydown",O,!0)}),[O])},Lr=t=>3*t+2,Br={Minion:1,Social:1,Support:1,Horde:2,Ranged:2,Skulk:2,Standard:2,Leader:3,Bruiser:4,Solo:5},_t={twoOrMoreSolos:-2,noBruisersHordesLeadersSolos:1};class Hr extends nt.Component{constructor(o){super(o),this.state={hasError:!1,error:null}}static getDerivedStateFromError(o){return{hasError:!0,error:o}}componentDidCatch(o,u){console.error("ErrorBoundary caught an error:",o,u)}render(){var o;return this.state.hasError?e.jsxs("div",{className:"p-md text-red",children:[e.jsx("h3",{children:"Something went wrong:"}),e.jsx("pre",{children:(o=this.state.error)==null?void 0:o.toString()}),e.jsx("button",{className:"btn-base btn-text",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try again"})]}):this.props.children}}const Pr=()=>{const{adversaries:t,environments:o,countdowns:u,fear:l,savedEncounters:k,partySize:p,customContent:b,updatePartySize:V,updateFear:x,createAdversary:z,createAdversariesBulk:O,updateAdversary:g,deleteAdversary:N,addCustomAdversary:j,updateCustomAdversary:G,createEnvironment:me,updateEnvironment:le,deleteEnvironment:ue,createCountdown:X,updateCountdown:ge,deleteCountdown:Z,advanceCountdown:ye,saveEncounter:fe,loadEncounter:Se,deleteEncounter:F}=Tt(),P=p||4,[ve,Te]=c.useState(!1),[de,T]=c.useState(!1);c.useState(!1),c.useState(!1),c.useState(!0);const[S,te]=c.useState(null),[re,J]=c.useState(null),[Re,pe]=c.useState(null),[H,ke]=c.useState(!1),[Me,ze]=c.useState("adversaries"),[Oe,d]=c.useState(null),[y,w]=c.useState(0),[m,s]=c.useState(0),[C,L]=c.useState(!1);c.useState(new Set);const[K,Y]=c.useState(new Set),[be,Be]=c.useState(null),[He,_e]=c.useState(!1),n=c.useRef(null),W=c.useRef(P);c.useEffect(()=>{const f=W.current;if(f!==P&&f>0){const h={};t.forEach(_=>{var v;const a=_.baseName||((v=_.name)==null?void 0:v.replace(/\s+\(\d+\)$/,""))||_.name;h[a]||(h[a]={type:"adversary",baseName:a,instances:[]}),h[a].instances.push(_)}),Object.values(h).forEach(_=>{if(_.type==="adversary"&&_.instances.length>0){const a=_.instances[0];if(a.type==="Minion"){const v=_.instances.length,U=Math.ceil(v/f)*P;if(U!==v)if(U>v){const E=U-v,ee=Array(E).fill(null).map(()=>({...a}));O(ee)}else{const E=v-U;_.instances.slice(-E).forEach(ce=>{N(ce.id)})}}}}),W.current=P}else(f===0||W.current===0)&&(W.current=P)},[P]),c.useEffect(()=>{const f=()=>{const _=window.matchMedia("(max-width: 800px)");Te(_.matches)};f();const h=window.matchMedia("(max-width: 800px)");return h.addEventListener("change",f),()=>h.removeEventListener("change",f)},[]);const r=12,R=f=>f===1?200:350,xe=f=>{if(f<=0)return{visibleColumns:1,columnWidth:R(1)};const h=r*2;let _=f-h,a=0,v={visibleColumns:1,columnWidth:_};for(let B=0;B<5;B++){const U=_-a;let E={visibleColumns:1,columnWidth:U};for(let M=1;M<=5;M++){const D=(M-1)*r,q=(U-D)/M;q>=R(M)&&M*q+D<=U&&(E={visibleColumns:M,columnWidth:q})}E.visibleColumns*E.columnWidth+(E.visibleColumns-1)*r>U&&(E={visibleColumns:1,columnWidth:U});const ce=E.columnWidth+r;if(Math.abs(ce-a)<.1)return E;a=ce,v=E}return v},{visibleColumns:$,columnWidth:ne}=xe(y);c.useEffect(()=>{const f=()=>{w(window.innerWidth)};return f(),window.addEventListener("resize",f),()=>window.removeEventListener("resize",f)},[]);const i=c.useCallback(()=>{T(!1)},[]),A=c.useCallback(f=>{let h=!1;if(n.current){const _=n.current,a=_.scrollLeft,v=_.scrollWidth-_.clientWidth;h=Math.abs(a-v)<1,h&&(_._wasAtMaxScrollOnBrowserOpen=!0)}J(f)},[]);c.useEffect(()=>{re!==null&&n.current&&n.current._wasAtMaxScrollOnBrowserOpen&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(n.current){const _=n.current,a=_.scrollWidth-_.clientWidth;_.scrollLeft=a,_._wasAtMaxScrollOnBrowserOpen=!1}})})},[re,ne,r]);const I=c.useCallback(()=>{J(null),ze("adversaries")},[]),se=c.useCallback((f,h=500,_="unknown")=>{if(console.log("[HORIZONTAL_SCROLL] smoothScrollTo called:",{targetScrollLeft:f,duration:h,reason:_,timestamp:performance.now()}),!n.current){console.log("[HORIZONTAL_SCROLL] No container ref, aborting");return}const a=n.current,v=a.scrollLeft,B=f-v;if(console.log("[HORIZONTAL_SCROLL] Scroll params:",{startScrollLeft:v,targetScrollLeft:f,distance:B,containerWidth:a.clientWidth,scrollWidth:a.scrollWidth}),Math.abs(B)<1){console.log("[HORIZONTAL_SCROLL] Distance too small, skipping animation");return}a._horizontalScrollAnimationId&&(console.log("[HORIZONTAL_SCROLL] Canceling existing animation"),cancelAnimationFrame(a._horizontalScrollAnimationId),a._horizontalScrollAnimationId=null);const E=window.getComputedStyle(a).scrollSnapType!=="none",ee=E?"x mandatory":null;console.log("[HORIZONTAL_SCROLL] Scroll-snap state:",{hasScrollSnap:E,originalScrollSnapType:ee}),E&&(a.style.scrollSnapType="none");const ce=performance.now();console.log("[HORIZONTAL_SCROLL] Starting animation at:",ce);const M=D=>{const q=D-ce,Ee=Math.min(q/h,1),we=1-Ee,ie=1-we*we*we;if(a){const ae=v+B*ie;a.scrollLeft=ae}Ee<1?a._horizontalScrollAnimationId=requestAnimationFrame(M):(console.log("[HORIZONTAL_SCROLL] Animation complete, final scrollLeft:",a.scrollLeft),a&&(a.scrollLeft=f,a._horizontalScrollAnimationId=null))};return a._horizontalScrollAnimationId=requestAnimationFrame(M),()=>{animationId&&cancelAnimationFrame(animationId),E&&a&&(a.style.scrollSnapType=ee||"")}},[]),oe=c.useCallback(()=>{const f={};return t.forEach(h=>{var a;const _=h.baseName||((a=h.name)==null?void 0:a.replace(/\s+\(\d+\)$/,""))||h.name;f[_]||(f[_]={type:"adversary",baseName:_,instances:[]}),f[_].instances.push(h)}),u.forEach(h=>{f[`countdown-${h.id}`]={type:"countdown",baseName:h.name,instances:[h]}}),Object.values(f)},[t,u]),Ie=oe();Nr({browserOpenAtPosition:re,handleCloseBrowser:I,handleOpenBrowser:A,getEntityGroups:oe,fear:l,updateFear:x});const je=c.useCallback(f=>{var D,q,Ee;const h=f.baseName||((D=f.name)==null?void 0:D.replace(/\s+\(\d+\)$/,""))||f.name,a=!Ie.find(we=>we.baseName===h&&we.type==="adversary"),v=f.type==="Minion",B=v?P:1,U=performance.now(),E=((q=n.current)==null?void 0:q.scrollWidth)??0,ee=((Ee=n.current)==null?void 0:Ee.scrollLeft)??0,ce=n.current;let M=!1;if(ce&&a&&window.getComputedStyle(ce).scrollSnapType!=="none"&&(ce.style.scrollSnapType="none",M=!0,console.log("[ADVERSARY_ADD] Disabled scroll-snap before adding adversary to prevent auto-scroll")),console.log("[ADVERSARY_ADD] handleAddAdversaryFromBrowser called:",{baseName:h,isNewAdversary:a,isMinion:v,instancesToAdd:B,timestamp:U,currentScroll:ee,scrollWidth:E,scrollSnapDisabled:M}),v&&B>1){const we=Array(B).fill(null).map(()=>({...f}));O(we)}else z(f);if(te("adversary"),a){const we=`adversary-${h}`;Y(ie=>new Set(ie).add(we)),setTimeout(()=>{Y(ie=>{const ae=new Set(ie);return ae.delete(we),ae})},10)}setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!n.current)return;const we=n.current;if(!(we.scrollWidth<=we.clientWidth))if(a){const ie=we.scrollWidth;setTimeout(()=>{if(!n.current)return;const ae=n.current;if(ae.scrollWidth!==ie)requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!n.current)return;const Q=n.current,Le=Q.scrollWidth-Q.clientWidth,De=Q.scrollLeft,Fe=Le-ee,Pe=Q.scrollWidth>E;console.log("[HORIZONTAL_SCROLL] New adversary added, scrollWidth stabilized:",{maxScroll:Le,scrollWidth:Q.scrollWidth,clientWidth:Q.clientWidth,scrollWidthBeforeAdd:E,scrollLeftBeforeAdd:ee,currentScroll:De,scrollChanged:De!==ee,scrollWidthIncreased:Pe,distance:Fe}),Pe&&Math.abs(Fe)<1?se(Le+10,500,"new-adversary"):Math.abs(Fe)>1&&se(Le,500,"new-adversary")})});else{const Q=ae.scrollWidth-ae.clientWidth,Le=ae.scrollLeft,De=Q-ee,Fe=ae.scrollWidth>E;console.log("[HORIZONTAL_SCROLL] New adversary added, scrollWidth stable:",{maxScroll:Q,scrollWidth:ae.scrollWidth,clientWidth:ae.clientWidth,scrollWidthBeforeAdd:E,scrollLeftBeforeAdd:ee,currentScroll:Le,scrollChanged:Le!==ee,scrollWidthIncreased:Fe,distance:De}),Fe&&Math.abs(De)<1?se(Q+10,500,"new-adversary"):Math.abs(De)>1&&se(Q,500,"new-adversary")}},10)}else{const ae=oe().findIndex(Ne=>Ne.baseName===h&&Ne.type==="adversary");if(ae>=0){const Ne=n.current,Q=Ne.scrollLeft,Le=Ne.clientWidth,De=re!==null?Le-(ne+r):Le,Fe=ae*(ne+r),Pe=Fe+ne+r,Xe=10;Fe>=Q-Xe&&Pe<=Q+De+Xe||se(Fe,500)}}})})},50)},[z,Ie,ne,r,se,oe,re]),Ae=c.useCallback(()=>{const h="Standard",_=ct(1,h),a={name:"",baseName:"",tier:1,type:h,description:"",motives:"",difficulty:_.difficulty,thresholds:_.thresholds,hpMax:_.hpMax,stressMax:_.stressMax,atk:_.atk,weapon:"",range:_.range,damage:_.damage,experience:[],features:[],source:"Homebrew",hp:0,stress:0,isVisible:!0};z(a),setTimeout(()=>{const v=oe();for(const B of v)if(B.type==="adversary"){const U=B.instances.find(E=>E.source==="Homebrew"&&(!E.baseName||E.baseName.trim()===""||E.baseName==="Unknown"));if(U&&!Re){pe(U.id),requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(n.current){n.current;const E=v.findIndex(ee=>ee.instances.some(ce=>ce.id===U.id));if(E>=0){const ee=E*(ne+r);se(ee,600,"new-custom-adversary")}}})});break}}},100)},[z,oe,ne,r,se,Re]),Ce=c.useCallback(f=>{pe(f),ke(!1)},[]),We=c.useCallback(()=>{pe(null),ke(!1)},[]),qe=c.useCallback(async(f,h)=>{var _,a;if(h){const v=t.find(U=>U.id===h);if((v==null?void 0:v.source)==="Homebrew"||(v==null?void 0:v.isCustom)){const U=v==null?void 0:v.customContentId,E=v==null?void 0:v.baseName,ee=U?(_=b==null?void 0:b.adversaries)==null?void 0:_.find(ce=>ce.id===U):(a=b==null?void 0:b.adversaries)==null?void 0:a.find(ce=>ce.baseName===E&&(ce.source==="Homebrew"||ce.isCustom));if(ee){const ce={...f,name:f.baseName||f.name};G(ee.id,ce);const M=f.baseName||(v==null?void 0:v.baseName);t.forEach(D=>{(D.customContentId===U||D.baseName===M&&(D.source==="Homebrew"||D.isCustom))&&g(D.id,{...f,customContentId:ee.id})})}else{const ce={...f,name:f.baseName||f.name},M=j(ce),D=f.baseName||(v==null?void 0:v.baseName);t.forEach(q=>{q.baseName===D&&(q.source==="Homebrew"||q.isCustom)&&g(q.id,{...f,customContentId:M})})}}else{const U=v==null?void 0:v.baseName,E=t.filter(M=>{const D=M.baseName===U,q=!M.source||M.source!=="Homebrew"&&!M.isCustom;return D&&q});console.log("[SAVE_AS] Found stock instances to replace:",{originalBaseName:U,stockInstancesCount:E.length,stockInstanceIds:E.map(M=>M.id)});const ee={...f,name:f.baseName||f.name},ce=j(ee);E.forEach(M=>{console.log("[SAVE_AS] Deleting stock instance:",M.id,M.name),N(M.id)}),setTimeout(()=>{const M=E.map(()=>({...f,source:"Homebrew",isCustom:!0,customContentId:ce,hp:0,stress:0}));M.length>0&&(console.log("[SAVE_AS] Creating",M.length,"custom instances to replace stock ones"),O(M))},0)}pe(null)}else if(Re){const v={...f,name:f.baseName||f.name},B=j(v),U=z({...f,source:"Homebrew",isCustom:!0,customContentId:B});return pe(null),U}else{const v={...f,name:f.baseName||f.name},B=j(v),U=z({...f,source:"Homebrew",isCustom:!0,customContentId:B});return ke(!1),U}},[Re,t,b,z,g,j,G]),Ke=c.useCallback(()=>{const f={};return t.forEach(h=>{var a;const _=h.baseName||((a=h.name)==null?void 0:a.replace(/\s+\(\d+\)$/,""))||h.name;f[_]||(f[_]={type:"adversary",item:h,quantity:0}),f[_].quantity+=1}),Object.values(f)},[t])(),Qe=Lr(P),Je=Ke.filter(f=>f.item.type==="Solo"&&f.quantity>0).reduce((f,h)=>f+h.quantity,0),et=Ke.some(f=>f.item.type&&["Bruiser","Horde","Leader","Solo"].includes(f.item.type)&&f.quantity>0);let Ze=0;Je>=2&&(Ze+=_t.twoOrMoreSolos),et||(Ze+=_t.noBruisersHordesLeadersSolos);const Ge=Qe+Ze,Ye=Ke.reduce((f,h)=>{if(h.type==="adversary"){const _=Br[h.item.type]||2;return h.item.type==="Minion"?f+Math.ceil(h.quantity/P)*_:f+_*h.quantity}return f},0),Ue=c.useRef(null),lt=c.useCallback(f=>{s(f.target.scrollLeft),Ue.current&&clearTimeout(Ue.current),Ue.current=setTimeout(()=>{const h=f.target;h&&h.style.scrollSnapType==="none"&&(h.style.scrollSnapType="x mandatory")},150)},[]);return c.useCallback(()=>{L(!0)},[]),c.useCallback(()=>{setTimeout(()=>L(!1),100)},[]),Ie.length,e.jsxs("div",{className:"app",onClick:f=>{f.target,f.currentTarget},children:[e.jsx(mr,{position:"top",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",width:"100%",justifyContent:"space-between",padding:"0 1rem"},children:[e.jsx(dt,{type:"fear",value:(l==null?void 0:l.value)||0,maxValue:12,onChange:x,showTooltip:!1,enableBoundaryClick:!0,clickContainerWidth:"100%",centerPips:!0}),e.jsx("button",{onClick:()=>{re!==null?I():A(Ie.length)},title:re!==null?"Close Browser":"Add Adversaries",style:{width:"36px",height:"36px",padding:0,backgroundColor:re!==null?"var(--purple)":"transparent",border:"1px solid var(--border)",borderRadius:"50%",color:re!==null?"white":"var(--text-primary)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",flexShrink:0},onMouseEnter:f=>{re===null&&(f.target.style.borderColor="var(--purple)",f.target.style.backgroundColor="var(--bg-secondary)")},onMouseLeave:f=>{re===null&&(f.target.style.borderColor="var(--border)",f.target.style.backgroundColor="transparent")},children:e.jsx(it,{size:18})})]})}),e.jsxs("div",{className:"main-content",style:{position:"relative",width:"100%"},children:[re!==null&&e.jsx("div",{style:{position:"absolute",top:`${r}px`,right:`${r}px`,bottom:`${r}px`,width:`${ne}px`,zIndex:100,overflow:"visible"},children:e.jsx(At,{tabContent:e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:Ae,style:{padding:"0.375rem 0.75rem",backgroundColor:"var(--purple)",border:"none",color:"white",borderRadius:"4px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",transition:"opacity 0.2s ease"},onMouseEnter:f=>{f.target.style.opacity="0.9"},onMouseLeave:f=>{f.target.style.opacity="1"},children:[e.jsx(it,{size:16}),e.jsx("span",{children:"Add Custom"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:"500"},children:"Party Size:"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",border:"1px solid var(--border)",borderRadius:"4px",padding:"0.125rem 0.25rem",backgroundColor:"var(--bg-secondary)"},children:[e.jsx("button",{onClick:()=>V(Math.max(1,P-1)),style:{background:"transparent",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:"0",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem"},onMouseEnter:f=>{f.target.style.color="var(--purple)"},onMouseLeave:f=>{f.target.style.color="var(--text-primary)"},children:e.jsx(mt,{size:12})}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:"500",minWidth:"1.5rem",textAlign:"center"},children:P}),e.jsx("button",{onClick:()=>V(P+1),style:{background:"transparent",border:"none",color:"var(--text-primary)",cursor:"pointer",padding:"0",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"18px",height:"18px",fontSize:"0.7rem"},onMouseEnter:f=>{f.target.style.color="var(--purple)"},onMouseLeave:f=>{f.target.style.color="var(--text-primary)"},children:e.jsx(it,{size:12})})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:"500"},children:"Balance:"}),e.jsx("span",{style:{color:Ye>Ge?"var(--danger)":Ye===Ge?"var(--purple)":"var(--success)",fontWeight:600,fontSize:"0.875rem"},children:Ye>Ge?`+${Ye-Ge}`:Ge-Ye===0?"0":`-${Ge-Ye}`})]}),I&&e.jsx("button",{onClick:I,style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s ease",flexShrink:0},onMouseEnter:f=>f.target.style.color="var(--text-primary)",onMouseLeave:f=>f.target.style.color="var(--text-secondary)",title:"Close browser",children:e.jsx(at,{size:16})})]}),showTab:!0,tabBackgroundColor:"var(--bg-primary)",tabBorderColor:"var(--border)",tabJustifyContent:"space-between",containerBackgroundColor:"var(--bg-primary)",containerBorderColor:"var(--border)",containerBorderRadius:"8px",containerBoxShadow:"-4px 0 12px rgba(0, 0, 0, 0.3)",containerOverflow:"hidden",reserveTabSpace:!0,containerStyle:{height:"100%"},children:e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,display:"flex",flexDirection:"column",width:"100%",minWidth:0},children:e.jsx(Yt,{type:"adversary",onAddItem:je,showContainer:!1,activeTab:Me,onTabChange:ze,pcCount:P,savedEncounters:k,onLoadEncounter:Se,onDeleteEncounter:F,selectedCustomAdversaryId:Oe,onSelectCustomAdversary:d,autoFocus:!0,hideImportExport:!0,onClose:I,searchPlaceholder:"Search adversaries"})})})}),e.jsxs("div",{ref:n,className:"dashboard-scroll-container",style:{display:"flex",flexDirection:"row",overflowX:"auto",overflowY:"hidden",padding:`0 ${r}px 0 0`,scrollSnapType:"x mandatory",height:"100%",width:"100%"},onScroll:lt,children:[Ie.length===0?null:(()=>{const f=[];if(Ie.forEach((h,_)=>{var v,B,U;if(be&&be.baseName===h.baseName&&h.type==="adversary"){f.push(e.jsx(Ct,{style:{width:He?"0px":`${ne+r}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:He?"0px":`${r}px`,paddingRight:"0",paddingTop:He?"0px":`${r}px`,paddingBottom:He?"0px":`${r}px`,scrollSnapAlign:"none",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"100%",opacity:0,transition:"width 0.3s ease, padding-left 0.3s ease, padding-top 0.3s ease, padding-bottom 0.3s ease"}},`spacer-${be.baseName}`));return}f.push(e.jsx(Ct,{style:{width:`${ne+r}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:`${r}px`,paddingRight:"0",paddingTop:`${h.type==="adversary"?r+52:r}px`,paddingBottom:`${r}px`,scrollSnapAlign:"start",overflow:h.type==="adversary"?"visible":"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"auto",opacity:K.has(`${h.type}-${h.baseName}`)?0:1,transition:(K.has(`${h.type}-${h.baseName}`),"opacity 0.2s ease")},children:e.jsx(ft,{type:h.type,item:{...h.instances[0],name:((v=h.instances[0])==null?void 0:v.name)||h.baseName,hp:0,stress:0,isDead:!1},mode:"expanded",instances:h.instances,showCustomCreator:h.type==="adversary"&&Re&&h.instances.some(E=>E.id===Re),onSaveCustomAdversary:h.type==="adversary"&&Re&&h.instances.some(E=>E.id===Re)?qe:void 0,onCancelEdit:h.type==="adversary"&&Re&&h.instances.some(E=>E.id===Re)?We:void 0,isStockAdversary:h.type==="adversary"&&Re&&h.instances.some(E=>E.id===Re)?!((B=h.instances[0])!=null&&B.source)||((U=h.instances[0])==null?void 0:U.source)!=="Homebrew":!1,onApplyDamage:h.type==="adversary"?(E,ee,ce,M)=>{const D=h.instances.find(q=>q.id===E);D&&g(E,{hp:Math.min(D.hpMax||1,(D.hp||0)+ee)})}:void 0,onApplyHealing:h.type==="adversary"?(E,ee,ce)=>{const M=h.instances.find(D=>D.id===E);M&&g(E,{hp:Math.max(0,(M.hp||0)-ee)})}:void 0,onApplyStressChange:h.type==="adversary"?(E,ee)=>{var ce,M;return g(E,{stress:Math.max(0,Math.min(((ce=h.instances.find(D=>D.id===E))==null?void 0:ce.stressMax)||6,(((M=h.instances.find(D=>D.id===E))==null?void 0:M.stress)||0)+ee))})}:void 0,onUpdate:h.type==="adversary"?g:h.type==="environment"?le:ge,adversaries:t,showAddRemoveButtons:re!==null&&h.type==="adversary",onEdit:h.type==="adversary"?E=>Ce(E):void 0,onAddInstance:h.type==="adversary"?E=>{const ee=E.type==="Minion",ce=ee?P:1;if(ee&&ce>1){const M=Array(ce).fill(null).map(()=>({...E}));O(M)}else z(E);setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(n.current){const M=n.current,D=M.scrollLeft,q=M.clientWidth,Ee=re!==null?q-(ne+r):q,ie=oe().findIndex(ae=>ae.baseName===h.baseName&&ae.type==="adversary");if(ie>=0){const ae=ie*(ne+r),Ne=ae+ne+r,Q=10;ae>=D-Q&&Ne<=D+Ee+Q||se(ae,500)}}})})},50)}:void 0,onRemoveInstance:h.type==="adversary"?E=>{const ee=h.instances[0],M=(ee==null?void 0:ee.type)==="Minion"?P:1,D=h.instances.sort((we,ie)=>{const ae=we.duplicateNumber||1;return(ie.duplicateNumber||1)-ae}),Ee=Math.max(0,D.length-M)===0;if(D.length>0){const we=D.slice(0,M);if(Ee){const ie=Ie.findIndex(Q=>Q.baseName===h.baseName&&Q.type==="adversary"),ae=ie===0;let Ne=!1;if(n.current){const Q=n.current,Le=Q.scrollLeft,De=Q.scrollWidth-Q.clientWidth;Ne=Math.abs(Le-De)<1}Be({baseName:h.baseName,groupIndex:ie}),_e(!1),ae&&n.current&&(n.current.style.scrollSnapType="none"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{n.current&&n.current.offsetHeight,we.forEach(Q=>{N(Q.id)}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{n.current&&n.current.offsetHeight,setTimeout(()=>{if(_e(!0),Ne&&n.current){const Q=performance.now(),Le=300,De=()=>{if(!n.current)return;const Fe=n.current,Pe=Fe.scrollWidth-Fe.clientWidth;Fe.scrollLeft=Pe,performance.now()-Q<Le&&requestAnimationFrame(De)};requestAnimationFrame(De)}setTimeout(()=>{if(Be(null),_e(!1),ae&&n.current&&(n.current.style.scrollSnapType="x mandatory"),Ne&&n.current){const Q=n.current;Q.scrollLeft=Q.scrollWidth-Q.clientWidth}},300)},50)})})})})}else we.forEach(ie=>{N(ie.id)})}}:void 0})},`${h.type}-${h.baseName}`))}),be&&!f.some(h=>(h==null?void 0:h.key)===`spacer-${be.baseName}`)){const h=Math.min(be.groupIndex,f.length);f.splice(h,0,e.jsx(Ct,{style:{width:He?"0px":`${ne+r}px`,flexShrink:0,flexGrow:0,flex:"none",paddingLeft:He?"0px":`${r}px`,paddingRight:"0",paddingTop:He?"0px":`${r}px`,paddingBottom:He?"0px":`${r}px`,scrollSnapAlign:"none",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"stretch",height:"100%",opacity:0,transition:"width 0.3s ease, padding-left 0.3s ease, padding-top 0.3s ease, padding-bottom 0.3s ease"}},`spacer-${be.baseName}`))}return f})(),re!==null&&e.jsx("div",{style:{width:`${ne+r}px`,flexShrink:0,flexGrow:0,flex:"none",height:"100%"}})]})]}),e.jsx(zr,{isOpen:de,onClose:i,onAddAdversary:f=>{z(f),te("adversary")},onAddAdversariesBulk:f=>{O(f),te("adversary")},onAddEnvironment:f=>{me(f),te("environment")},onDeleteAdversary:N,onDeleteEnvironment:ue,onDeleteCountdown:Z,adversaries:t,environments:o,countdowns:u,savedEncounters:k,onSaveEncounter:fe,onLoadEncounter:Se,onDeleteEncounter:F}),e.jsx(Mr,{})]})},Dr=()=>e.jsx(Hr,{children:e.jsx(Pr,{})});It.createRoot(document.getElementById("root")).render(e.jsx(nt.StrictMode,{children:e.jsx(pr,{children:e.jsx(Dr,{})})}));
